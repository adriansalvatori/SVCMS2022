!function(e){"use strict";e.fn.palleon=function(a){var n,l=e(this),t=document.body.clientWidth,i=e.extend({fontFamily:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",fontSize:60,fontWeight:"normal",fontStyle:"normal",lineHeight:1,canvasColor:"transparent",fill:"#000",stroke:"#fff",strokeWidth:0,textBackgroundColor:"rgba(255,255,255,0)",textAlign:"left",lineHeight:1.2,shapeColor:"#fff",borderColor:"#000",borderDashArray:[4,4],borderOpacityWhenMoving:.5,borderScaleFactor:2,editingBorderColor:"rgba(0,0,0,0.5)",cornerColor:"#fff",cornerSize:12,cornerStrokeColor:"#000",cornerStyle:"circle",transparentCorners:!1,cursorColor:"#000",cursorWidth:2,enableGLFiltering:!0,textureSize:4096},a),o="none",r="",s="",d="",c="",p=0,f=1,g=1,m="left",h="top",u="",b=[],v="",y="",k="",w="",x=0,C="add-to-canvas",P=["circle","square","rectangle","triangle","ellipse","trapezoid","emerald","star"],j=["square","rectangle","triangle"],I=[["Helvetica Neue","'Helvetica Neue', 'Helvetica', 'Arial', sans-serif"],["Impact","Impact, Charcoal, sans-serif"],["Georgia","Georgia, serif"],["Palatino Linotype","'Palatino Linotype', 'Book Antiqua', Palatino, serif"],["Times New Roman","'Times New Roman', Times, serif"],["Arial","Arial, Helvetica, sans-serif"],["Arial Black","'Arial Black', Gadget, sans-serif"],["Comic Sans","'Comic Sans MS', cursive, sans-serif"],["Lucida Sans","'Lucida Sans Unicode', 'Lucida Grande', sans-serif"],["Tahoma","Tahoma, Geneva, sans-serif"],["Trebuchet","'Trebuchet MS', Helvetica, sans-serif"],["Verdana","Verdana, Geneva, sans-serif"],["Courier New","'Courier New', Courier, monospace"],["Lucida Console","'Lucida Console', Monaco, monospace"]];l.find(".crop-custom").css("display","none");for(var S=new LazyLoad({callback_error:a=>{a.setAttribute("src",palleonParams.baseURL+"assets/placeholder.png"),e(a).parent().css("min-height","auto"),e(a).parent().find(".palleon-img-loader").remove()},callback_loaded:a=>{e(a).parent().css("min-height","auto"),e(a).parent().find(".palleon-img-loader").remove()}}),A=0;A<I.length;A++)l.find("#websafe-fonts").append(e('<option class="websafe-font"></option>').attr("value",I[A][1]).text(I[A][0]));function O(e){var a=e.find(">*"),n=a.length,t=parseInt(e.data("perpage"));if(n>t){a.slice(t).hide();var i='<div id="'+e.attr("id")+'-pagination" class="palleon-pagination"></div>';e.after(i),l.find("#"+e.attr("id")+"-pagination").pagination({items:n,itemsOnPage:t,prevText:'<span class="material-icons">navigate_before</span>',nextText:'<span class="material-icons">navigate_next</span>',displayedPages:3,onPageClick:function(e,n){void 0!==n&&n.preventDefault();var l=t*(e-1),i=l+t;a.hide().slice(l,i).show()}}),l.find("#"+e.attr("id")+"-pagination").pagination("selectPage",1)}}function T(e){for(var a=e.split(","),n=a[0].match(/:(.*?);/)[1],l=atob(a[1]),t=l.length,i=new Uint8Array(t);t--;)i[t]=l.charCodeAt(t);return new Blob([i],{type:n})}function R(e,a){var n=new XMLHttpRequest;n.onload=function(){var e=new FileReader;e.onloadend=function(){a(e.result)},e.readAsDataURL(n.response)},n.open("GET",e),n.responseType="blob",n.send()}function F(){l.removeClass("panel-closed"),l.find(".palleon-icon-menu-btn").removeClass("active"),l.find("#palleon-icon-menu").removeClass("closed"),l.find("#palleon-toggle-left").removeClass("closed"),l.find("#palleon-toggle-left").find(".material-icons").html("chevron_left"),l.find("#palleon-icon-panel").show()}function q(){l.addClass("panel-closed"),l.find(".palleon-icon-menu-btn").removeClass("active"),l.find("#palleon-icon-menu").addClass("closed"),l.find("#palleon-toggle-left").addClass("closed"),l.find("#palleon-toggle-left").find(".material-icons").html("chevron_right"),l.find("#palleon-icon-panel").hide()}function X(e,a){""==e&&(e=(new Date).getTime()),""==a?a="jpeg":"jpg"==a&&(a="jpeg"),l.find(".palleon-file-name").val(e),l.find(".palleon-file-name").data("default",e),l.find("#palleon-save-img-format").val(a),l.find("#palleon-save-img-format").trigger("change")}function Y(e){if(""!=l.find("#palleon-canvas-img").data("id")&&l.find("#palleon-new").remove(),l.find("#palleon-canvas-loader").css("display","flex"),l.find("#palleon-canvas-wrap, .palleon-content-bar").css("visibility","visible"),o=e,u.backgroundImage&&(b=u.backgroundImage.filters),"canvas"==o){l.find("#palleon-canvas-color").trigger("change");var a=document.createElement("canvas"),n=new fabric.Canvas(a),t=parseInt(l.find("#palleon-canvas-width").val()),i=parseInt(l.find("#palleon-canvas-height").val());""==t&&(t=800),""==i&&(i=800),n.setWidth(t),n.setHeight(i),n.backgroundColor="transparent";var v=T(n.toDataURL({format:"png",enableRetinaScaling:!1})),y=URL.createObjectURL(v);l.find("#palleon-canvas-img").attr("src",y),n.dispose()}l.find("#palleon-canvas-img-wrap").imagesLoaded(function(){r=l.find("#palleon-canvas-img")[0],s=l.find("#palleon-canvas-img").attr("src"),d=r.width,c=r.height,H(r),u.setDimensions({width:d,height:c}),fabric.Image.fromURL(s,function(e){u.setBackgroundImage(e,u.renderAll.bind(u),{objectType:"BG",mode:o,scaleX:f,scaleY:g,selectable:!1,lockMovementX:!0,lockMovementY:!0,lockRotation:!0,erasable:!0},{crossOrigin:"anonymous"})}),_(),z(),setTimeout(function(){!function(){if(p=0,f=1,g=1,m="left",h="top",l.find("#keep-data").is(":checked"))u.backgroundImage.filters=b,u.backgroundImage.applyFilters();else{u.backgroundImage.filters=[],l.find("#palleon-adjust .conditional-settings").addClass("d-none"),l.find("#palleon-brightness").prop("checked",!1),l.find("#brightness").val(0),l.find("#palleon-contrast").prop("checked",!1),l.find("#contrast").val(0),l.find("#palleon-saturation").prop("checked",!1),l.find("#saturation").val(0),l.find("#palleon-hue").prop("checked",!1),l.find("#hue").val(0),l.find("#palleon-filters input[type=checkbox]").prop("checked",!1),l.find("#palleon-gamma").prop("checked",!1),l.find("#gamma-red").val(1),l.find("#gamma-green").val(1),l.find("#gamma-blue").val(1),l.find("#palleon-blend-color").prop("checked",!1),l.find("#blend-color-mode").val("add"),l.find("#blend-color-color").spectrum("set","#ffffff"),l.find("#blend-color-alpha").val(.5),l.find("#blend-color-alpha").parent().parent().find(".slider-label span").html(.5),l.find("#palleon-duotone-color").prop("checked",!1),l.find("#duotone-light-color").spectrum("set","green"),l.find("#duotone-dark-color").spectrum("set","blue"),l.find("#palleon-swap-colors").prop("checked",!1),l.find("#palleon-blur").prop("checked",!1),l.find("#blur").val(0),l.find("#palleon-noise").prop("checked",!1),l.find("#noise").val(0),l.find("#palleon-pixelate").prop("checked",!1),l.find("#pixelate").val(1);var e=u.getObjects();e.filter(e=>"BG"!=e.objectType).forEach(e=>u.remove(e)),l.find("#palleon-layers li").remove(),L()}u.fire("selection:cleared"),u.requestRenderAll()}(),M('<span class="material-icons">flag</span>'+palleonParams.started)},100),l.find("#palleon-canvas-loader").hide()})}(e.getJSON(palleonParams.baseURL+"json/google-fonts.json",function(a){for(var n=0;n<a.items.length;n++)l.find("#google-fonts").append(e('<option class="google-font"></option>').attr("value",a.items[n].family).text(a.items[n].family))}),e.getJSON(palleonParams.baseURL+"json/material-icons.json",function(e){for(var a=palleonParams.sourceURL,n=0;n<e.categories.length;n++)for(var t=e.categories[n],i=0;i<t.icons.length;i++){var o=a+"icons/"+t.icons[i].group_id+"/"+t.icons[i].ligature;l.find("#palleon-icons .palleon-grid").append('<div class="palleon-element add-element" data-elsource="'+o+'" data-loader="no" title="'+t.icons[i].name+'"><span class="material-icons">'+t.icons[i].ligature+"</div>")}}),l.find(".palleon-select.palleon-select2").select2({theme:"dark",width:"100%",templateSelection:$,templateResult:$,allowHtml:!0}),l.find(".palleon-colorpicker.disallow-empty").spectrum({allowEmpty:!1,showInitial:!0}),l.find(".palleon-colorpicker.allow-empty").spectrum({allowEmpty:!0,showInitial:!1}),toastr.options.closeButton=!0,toastr.options.positionClass="toast-bottom-left",toastr.options.progressBar=!0,toastr.options.newestOnTop=!0,toastr.options.showEasing="swing",toastr.options.hideEasing="linear",toastr.options.closeEasing="linear",l.find("#palleon-canvas-wrap").draggable({disabled:!0}),l.find(".paginated").each(function(){O(e(this))}),l.find("#palleon-toggle-left").on("click",function(){e(this).hasClass("closed")?F():q()}),l.find("#palleon-toggle-right").on("click",function(){e(this).hasClass("closed")?(l.removeClass("layers-closed"),e(this).removeClass("closed"),e(this).find(".material-icons").html("chevron_right"),l.find("#palleon-right-col").show()):(l.addClass("layers-closed"),e(this).addClass("closed"),e(this).find(".material-icons").html("chevron_left"),l.find("#palleon-right-col").hide())}),l.find(".palleon-toggle-right").on("click",function(e){e.preventDefault(),l.find("#palleon-toggle-right").trigger("click")}),t<=1200&&(l.find("#palleon-toggle-right").trigger("click"),l.find("#palleon-toggle-left").trigger("click")),l.find(".palleon-icon-menu-btn").on("click",function(){e(this).data("target")&&(e(this).hasClass("active")?q():(F(),e(this).addClass("active"),l.find(".palleon-icon-panel-content").addClass("panel-hide"),l.find(e(this).data("target")).removeClass("panel-hide"))),"palleon-btn-elements"==e(this).attr("id")&&l.find("#palleon-all-elements-open").trigger("click")}),l.find(".palleon-dropdown-wrap").on("click",function(){e(this).hasClass("opened")?(e(this).removeClass("opened"),e(this).find(".palleon-dropdown").hide()):(e(this).addClass("opened"),e(this).find(".palleon-dropdown").show())}),l.find(".palleon-icon-panel-content ul.palleon-accordion > li > a").on("click",function(a){a.preventDefault();var n=e(this).parent().parent();e(this).parent().hasClass("opened")?n.find("li").removeClass("opened"):(n.find("li").removeClass("opened"),e(this).parent().addClass("opened"))}),l.find(".palleon-lock-unlock").on("click",function(){e(this).hasClass("active")?(e(this).removeClass("active"),e(this).find(".material-icons").html("lock_open")):(e(this).addClass("active"),e(this).find(".material-icons").html("lock"))}),l.find(".palleon-slider").on("input",function(){e(this).parent().parent().find(".slider-label span").html(e(this).val()),l.find("span.tm-count-zoom").html(e(this).val())}),l.find('input[type="checkbox"]').on("change",function(){e(this).data("conditional")&&(e(this).is(":checked")?l.find(e(this).data("conditional")).removeClass("d-none"):l.find(e(this).data("conditional")).addClass("d-none"))}),l.find(".palleon-tabs-menu li").on("click",function(){var a=e(this).data("target"),n=e(this).parent().parent();n.find("> .palleon-tab").removeClass("active"),e(a).addClass("active"),n.find("> .palleon-tabs-menu li").removeClass("active"),e(this).addClass("active")}),l.find('input[type="number"],.numeric-field').bind("input paste keyup keydown",function(){this.value=this.value.replace(/(?!^-)[^0-9.]/g,"").replace(/(\..*)\./g,"$1"),e(this).data("max")&&this.value>e(this).data("max")&&(this.value=e(this).data("max")),e(this).data("min")&&this.value<e(this).data("min")&&(this.value=e(this).data("min"))}),l.find(".palleon-counter .counter-plus").on("click",function(){var a=e(this).parent().find("input.palleon-form-field"),n=parseInt(a.val())+parseInt(a.data("step"));a.data("max")&&n>a.data("max")&&(n=a.data("max")),a.data("min")&&n<a.data("min")&&(n=a.data("min")),n<0&&(n=0),a.val(n),"palleon-img-zoom-in"==e(this).attr("id")&&_(n)}),l.find(".palleon-counter .counter-minus").on("click",function(){var a=e(this).parent().find("input.palleon-form-field"),n=parseInt(a.val())-parseInt(a.data("step"));a.data("max")&&n>a.data("max")&&(n=a.data("max")),a.data("min")&&n<a.data("min")&&(n=a.data("min")),n<0&&(n=0),a.val(n),"palleon-img-zoom-out"==e(this).attr("id")&&_(n)}),fabric.enableGLFiltering=i.enableGLFiltering,fabric.textureSize=parseInt(i.textureSize),fabric.Object.prototype.borderColor=i.borderColor,fabric.Object.prototype.borderDashArray=i.borderDashArray,fabric.Object.prototype.borderOpacityWhenMoving=i.borderOpacityWhenMoving,fabric.Object.prototype.borderScaleFactor=i.borderScaleFactor,fabric.Object.prototype.editingBorderColor=i.editingBorderColor,fabric.Object.prototype.cornerColor=i.cornerColor,fabric.Object.prototype.cornerSize=i.cornerSize,fabric.Object.prototype.cornerStrokeColor=i.cornerStrokeColor,fabric.Object.prototype.cornerStyle=i.cornerStyle,fabric.Object.prototype.transparentCorners=i.transparentCorners,fabric.Object.prototype.cursorColor=i.cursorColor,fabric.Object.prototype.cursorWidth=i.cursorWidth,fabric.Object.prototype.strokeUniform=!0,fabric.Group.prototype.padding=0,fabric.Object.prototype.erasable=!1,fabric.Image.filters.Shift=fabric.util.createClass(fabric.Image.filters.ColorMatrix,{type:"Shift",matrix:[0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0],mainParameter:!1,colorsOnly:!0}),n=l.find("#palleon-canvas")[0],(u=new fabric.Canvas(n)).backgroundColor=i.canvasColor,""!=l.find("#palleon-canvas-img").attr("src"))&&(o="image",X(l.find("#palleon-canvas-img").data("filename"),l.find("#palleon-canvas-img").attr("src").match(/\.[0-9a-z]+$/i)[0].replace(/\./g,"")),Y(o));function z(){"none"==o?(l.find("#palleon-icon-menu, #palleon-icon-panel").css("pointer-events","none"),l.find(".palleon-keep").hide(),l.find("#modal-add-new").show(),l.find("#palleon-save").prop("disabled",!0)):(l.find("#palleon-canvas-wrap, .palleon-content-bar").css("visibility","visible"),l.find("#palleon-icon-menu, #palleon-icon-panel").css("pointer-events","auto"),l.find(".palleon-keep").show(),l.find("#modal-add-new").hide(),l.find("#palleon-save").prop("disabled",!1)),"canvas"==o?(l.find("#palleon-resize-lock").removeClass("active"),l.find("#palleon-crop-lock").removeClass("active"),l.find(".hide-on-canvas-mode").hide()):(l.find("#palleon-resize-lock").addClass("active"),l.find("#palleon-crop-lock").addClass("active"),l.find(".hide-on-canvas-mode").show())}function B(a){l.find("#palleon-canvas-loader").css("display","flex"),p=a.backgroundImage.angle,f=a.backgroundImage.scaleX,g=a.backgroundImage.scaleY,m=a.backgroundImage.originX,h=a.backgroundImage.originY,u.clear(),l.find("#palleon-layers li").remove(),o=a.backgroundImage.mode;var n=T(a.backgroundImage.src);s=URL.createObjectURL(n),l.find("#palleon-canvas-img").attr("src",s),d=a.backgroundImage.width,c=a.backgroundImage.height;for(var t={width:d,height:c},r=0;r<a.objects.length;r++)"textbox"==a.objects[r].objectType&&(a.objects[r].fontFamily=a.objects[r].fontFamily+"-palleon");u.loadFromJSON(a,function(){!function(a){0!==a.length&&e.each(a,function(e,a){var n=a.fontFamily.replace("-palleon","");a.fontFamily=i.fontFamily;var l="yes";if(""==n)l="no";else for(var t=0;t<I.length;t++)if(I[t][1]==n){l="no";break}if("yes"==l){"undefined"==typeof palleonCustomFonts?WebFont.load({google:{families:[n+":regular,bold",n+":italic,regular,bold"]}}):palleonCustomFonts.fonts.includes(n)||WebFont.load({google:{families:[n+":regular,bold",n+":italic,regular,bold"]}});var o=new FontFaceObserver(n,{weight:"normal",style:"normal"}),r=new FontFaceObserver(n,{weight:"bold",style:"normal"}),s=new FontFaceObserver(n,{weight:"normal",style:"italic"}),d=new FontFaceObserver(n,{weight:"bold",style:"italic"});Promise.all([o.load(null,5e3),r.load(null,5e3),s.load(null,5e3),d.load(null,5e3)]).then(function(){a.set("fontFamily",n),u.requestRenderAll()}).catch(function(e){console.log(e)})}else a.set("fontFamily",n),u.requestRenderAll()})}(u.getObjects().filter(e=>"textbox"==e.objectType)),L(),u.requestRenderAll(),l.find("#palleon-canvas-loader").hide()},function(){},{crossOrigin:"anonymous"}),X((new Date).getTime(),""),H(t),_(),z(),u.fire("selection:cleared"),l.find("#palleon-canvas-color").spectrum("set",u.backgroundColor),l.find("#custom-image-background").spectrum("set",u.backgroundColor),setTimeout(function(){var n;l.find("#palleon-layers > li").removeClass("active"),n=a.backgroundImage.filters,l.find("#palleon-brightness").prop("checked",!1),l.find("#palleon-contrast").prop("checked",!1),l.find("#palleon-saturation").prop("checked",!1),l.find("#palleon-hue").prop("checked",!1),l.find("#grayscale").prop("checked",!1),l.find("#sepia").prop("checked",!1),l.find("#brownie").prop("checked",!1),l.find("#blackwhite").prop("checked",!1),l.find("#vintage").prop("checked",!1),l.find("#kodachrome").prop("checked",!1),l.find("#polaroid").prop("checked",!1),l.find("#technicolor").prop("checked",!1),l.find("#invert").prop("checked",!1),l.find("#sharpen").prop("checked",!1),l.find("#emboss").prop("checked",!1),l.find("#palleon-gamma").prop("checked",!1),l.find("#palleon-blend-color").prop("checked",!1),l.find("#palleon-duotone-color").prop("checked",!1),l.find("#palleon-blur").prop("checked",!1),l.find("#palleon-noise").prop("checked",!1),l.find("#palleon-pixelate").prop("checked",!1),0!==n.length&&e.each(n,function(e,a){"Brightness"==a.type?(l.find("#palleon-brightness").prop("checked",!0),l.find("#brightness").val(a.brightness),l.find("#brightness").parent().parent().find(".slider-label span").html(a.brightness)):"Contrast"==a.type?(l.find("#palleon-contrast").prop("checked",!0),l.find("#contrast").val(a.brightness),l.find("#contrast").parent().parent().find(".slider-label span").html(a.contrast)):"Saturation"==a.type?(l.find("#palleon-saturation").prop("checked",!0),l.find("#saturation").val(a.brightness),l.find("#saturation").parent().parent().find(".slider-label span").html(a.saturation)):"HueRotation"==a.type?(l.find("#palleon-hue").prop("checked",!0),l.find("#hue").val(a.rotation),l.find("#hue").parent().parent().find(".slider-label span").html(a.rotation)):"Grayscale"==a.type?l.find("#grayscale").prop("checked",!0):"Sepia"==a.type?l.find("#sepia").prop("checked",!0):"Brownie"==a.type?l.find("#brownie").prop("checked",!0):"BlackWhite"==a.type?l.find("#blackwhite").prop("checked",!0):"Vintage"==a.type?l.find("#vintage").prop("checked",!0):"Kodachrome"==a.type?l.find("#kodachrome").prop("checked",!0):"Polaroid"==a.type?l.find("#polaroid").prop("checked",!0):"Technicolor"==a.type?l.find("#technicolor").prop("checked",!0):"Invert"==a.type?l.find("#invert").prop("checked",!0):"Convolute"==a.type?"[0,-1,0,-1,5,-1,0,-1,0]"==a.matrix?l.find("#sharpen").prop("checked",!0):"[1,1,1,1,0.7,-1,-1,-1,-1]"==a.matrix?l.find("#emboss").prop("checked",!0):"[-1,0,1,-2,0,2,-1,0,1]"==a.matrix?l.find("#sobelX").prop("checked",!0):"[-1,-2,-1,0,0,0,1,2,1]"==a.matrix&&l.find("#sobelY").prop("checked",!0):"Gamma"==a.type?(l.find("#palleon-gamma").prop("checked",!0),l.find("#gamma-red").val(a.gamma[0]),l.find("#gamma-red").parent().parent().find(".slider-label span").html(a.gamma[0]),l.find("#gamma-green").val(a.gamma[1]),l.find("#gamma-green").parent().parent().find(".slider-label span").html(a.gamma[1]),l.find("#gamma-blue").val(a.gamma[2]),l.find("#gamma-blue").parent().parent().find(".slider-label span").html(a.gamma[2])):"BlendColor"==a.type?(l.find("#palleon-blend-color").prop("checked",!0),l.find("#blend-color-mode").val(a.mode),l.find("#blend-color-color").val(a.color),l.find("#blend-color-alpha").val(a.alpha),l.find("#blend-color-alpha").parent().parent().find(".slider-label span").html(a.alpha)):"Composed"==a.type?(l.find("#palleon-duotone-color").prop("checked",!0),l.find("#duotone-light-color").val(a.subFilters[1].color),l.find("#duotone-dark-color").val(a.subFilters[2].color)):"Blur"==a.type?(l.find("#palleon-blur").prop("checked",!0),l.find("#blur").val(a.blur),l.find("#blur").parent().parent().find(".slider-label span").html(a.blur)):"Noise"==a.type?(l.find("#palleon-noise").prop("checked",!0),l.find("#noise").val(a.noise),l.find("#noise").parent().parent().find(".slider-label span").html(a.noise)):"Pixelate"==a.type&&(l.find("#palleon-pixelate").prop("checked",!0),l.find("#pixelate").val(a.blocksize),l.find("#pixelate").parent().parent().find(".slider-label span").html(a.blocksize))}),l.find("#palleon-brightness").trigger("change"),l.find("#palleon-contrast").trigger("change"),l.find("#palleon-saturation").trigger("change"),l.find("#palleon-hue").trigger("change"),l.find("#palleon-gamma").trigger("change"),l.find("#palleon-blend-color").trigger("change"),l.find("#palleon-blur").trigger("change"),l.find("#palleon-noise").trigger("change"),l.find("#palleon-pixelate").trigger("change")},100)}function D(e){var a=palleonParams.object,n="category";return null==e?(a=palleonParams.object,n="category"):"textbox"==e?(a=palleonParams.text,n="title"):"drawing"==e?(a=palleonParams.freeDrawing,n="brush"):"frame"==e?(a=palleonParams.frame,n="wallpaper"):"image"==e?(a=palleonParams.image,n="image"):"circle"==e?a=palleonParams.circle:"square"==e?a=palleonParams.square:"rectangle"==e?a=palleonParams.rectangle:"triangle"==e?a=palleonParams.triangle:"ellipse"==e?a=palleonParams.ellipse:"trapezoid"==e?a=palleonParams.trapezoid:"emerald"==e?a=palleonParams.emerald:"star"==e?a=palleonParams.star:"element"==e?(a=palleonParams.element,n="star"):"BG"==e?(a=palleonParams.bg,n="image"):"customSVG"==e&&(a=palleonParams.customSvg),'<span class="material-icons">'+n+"</span>"+a}function M(e){var a=l.find("#palleon-history-list"),n=new Date,t=String(n.getHours()).padStart(2,"0")+":"+String(n.getMinutes()).padStart(2,"0")+":"+String(n.getSeconds()).padStart(2,"0"),i=u.toJSON(["objectType","gradientFill","roundedCorders","mode","selectable","lockMovementX","lockMovementY","lockRotation","crossOrigin"]);l.find("#palleon-history").prop("disabled",!1),a.find("li").removeClass("active"),a.prepend('<li class="active"><div class="info">'+e+'<span class="time">'+t+'</span></div><div><button type="button" class="palleon-btn primary"><span class="material-icons">restore</span>Restore</button><button type="button" class="palleon-btn danger"><span class="material-icons">clear</span>Delete</button><script type="text/json">'+JSON.stringify(i)+"<\/script></div></li>"),a.find("li").length>a.data("max")&&a.find("li").last().remove(),l.find("#palleon-history-count").html(a.find("li").length);var o=a.find("li.active").next("li"),r=a.find("li.active").prev("li");o.length?l.find("#palleon-undo").prop("disabled",!1):l.find("#palleon-undo").prop("disabled",!0),r.length?l.find("#palleon-redo").prop("disabled",!1):l.find("#palleon-redo").prop("disabled",!0)}z(),l.find(".palleon-modal-open").on("click",function(a){a.preventDefault();var n=e(this).data("target");l.find(".palleon-modal").hide(),l.find(n).show()}),l.find(".palleon-modal-close").on("click",function(a){a.preventDefault();var n=e(this).data("target");l.find(n).hide()}),l.find("#palleon-image-upload").on("change",function(){l.find(".palleon-modal").hide(),l.find("#palleon-canvas-wrap, .palleon-content-bar").css("visibility","visible");var e=new FileReader;e.onload=function(a){l.find("#palleon-canvas-img").attr("src",e.result),Y("image")},e.readAsDataURL(this.files[0]),X(this.files[0].name.replace(/\.[^/.]+$/,""),this.files[0].name.match(/\.[0-9a-z]+$/i)[0].replace(/\./g,""))}),l.find("#palleon-canvas-create").on("click",function(){X((new Date).getTime(),""),Y("canvas")}),l.find("#palleon-template-search").on("click",function(){e(this);var a=l.find("#palleon-template-search-keyword").val(),n=l.find("#palleon-templates-menu").val(),t={action:"templateSearch",nonce:palleonParams.nonce,keyword:a,category:n};e.ajax({url:palleonParams.ajaxurl,data:t,type:"POST",success:function(e){e&&(l.find("#palleon-templates-grid-pagination").remove(),l.find("#palleon-templates-grid").html(e),S.update(),O(l.find("#palleon-templates-grid")))},error:function(e,a,n){e.status&&400==e.status?toastr.error(e.responseText,palleonParams.error):toastr.error(palleonParams.wrong,palleonParams.error)}})}),l.find(".template-grid").on("click",".template-favorite button.star",function(){var a=e(this),n=a.data("templateid"),t="add";a.hasClass("favorited")?(l.find('*[data-templateid="'+n+'"]').removeClass("favorited"),t="remove"):l.find('*[data-templateid="'+n+'"]').addClass("favorited");var i={action:"favTemplate",nonce:palleonParams.nonce,templateid:n,mode:t};e.ajax({url:palleonParams.ajaxurl,data:i,type:"POST",success:function(e){"add"==t?(toastr.success(palleonParams.favorited,palleonParams.success),l.find('*[data-templateid="'+n+'"]').html('<span class="material-icons">star</span>')):(toastr.success(palleonParams.unfavorited,palleonParams.success),l.find('*[data-templateid="'+n+'"]').html('<span class="material-icons">star_border</span>')),e&&(l.find("#palleon-templates-favorites-grid-pagination").remove(),l.find("#palleon-templates-favorites-grid").html(e),S.update(),O(l.find("#palleon-templates-favorites-grid")))},error:function(e,a,n){e.status&&400==e.status?toastr.error(e.responseText,palleonParams.error):toastr.error(palleonParams.wrong,palleonParams.error)}})}),l.find("#palleon-json-download").on("click",function(){var e=l.find("#palleon-json-download-name").val(),a=u.toJSON(["objectType","gradientFill","roundedCorders","mode","selectable","lockMovementX","lockMovementY","lockRotation","crossOrigin"]);R(a.backgroundImage.src,function(n){a.backgroundImage.src=n;var t=JSON.stringify(a),i=document.createElement("a"),o=new Blob([t],{type:"text/plain"});i.href=URL.createObjectURL(o),i.download=e+".json",i.click(),l.find(".palleon-modal").hide()})}),l.find("#palleon-json-upload").on("change",function(e){l.find("#palleon-canvas-wrap, .palleon-content-bar").css("visibility","visible"),l.find("#palleon-canvas-loader").css("display","flex");var a=new FileReader;a.onload=function(e){B(JSON.parse(a.result)),l.find("#palleon-canvas-loader").hide(),setTimeout(function(){M('<span class="material-icons">flag</span>'+palleonParams.started)},100)},a.readAsText(e.target.files[0]),l.find(".palleon-modal").hide()}),l.find(".template-selection").on("click",".palleon-select-template",function(){l.find("#palleon-canvas-wrap, .palleon-content-bar").css("visibility","visible"),l.find(".palleon-modal").hide(),l.find("#palleon-canvas-loader").css("display","flex"),u.getObjects().filter(e=>"BG"!=e.objectType).forEach(e=>u.remove(e)),l.find("#palleon-layers li").remove(),L(),e.getJSON(e(this).data("json"),function(e){B(e),setTimeout(function(){M('<span class="material-icons">flag</span>'+palleonParams.started)},100)}).fail(function(e,a,n){toastr.error("Request Failed: "+n,palleonParams.error)}).always(function(){l.find("#palleon-canvas-loader").hide()})}),l.find(".palleon-template-list").on("click",".palleon-template-delete",function(){if(window.confirm(palleonParams.answer1)){var a=e(this).data("target"),n=new FormData;n.append("target",a),n.append("action","deleteJsonFromLibrary"),n.append("nonce",palleonParams.nonce),e.ajax({url:palleonParams.ajaxurl,type:"POST",contentType:!1,processData:!1,cache:!1,data:n,success:function(e){l.find("#palleon-my-templates-refresh").trigger("click"),toastr.success(palleonParams.deleted,palleonParams.success)},error:function(e,a,n){e.status&&400==e.status?toastr.error(e.responseText,palleonParams.error):toastr.error(palleonParams.wrong,palleonParams.error)}})}}),l.find("#palleon-my-templates-refresh").on("click",function(){var a=e(this),n={action:"loadmytemplates",nonce:palleonParams.nonce,query:templatesMyRefresh.posts};e.ajax({url:palleonParams.ajaxurl,data:n,type:"POST",beforeSend:function(e){a.html('<span class="material-icons">refresh</span>'+palleonParams.loading)},success:function(e){a.html('<span class="material-icons">refresh</span>'+palleonParams.refresh),e&&(l.find("#palleon-my-templates-pagination").remove(),l.find("#palleon-my-templates").html(e),S.update(),O(l.find("#palleon-my-templates")))},error:function(e,n,l){a.html('<span class="material-icons">refresh</span>'+palleonParams.refresh),e.status&&400==e.status?toastr.error(e.responseText,palleonParams.error):toastr.error(palleonParams.wrong,palleonParams.error)}})}),l.find("#palleon-my-templates-search").on("click",function(){var a=e(this).parent().find("input");if(l.find("#palleon-my-templates-noimg").addClass("d-none"),""!=a.val())if(e(this).hasClass("cancel"))e(this).removeClass("cancel"),e(this).find(".material-icons").html("search"),e(this).removeClass("danger"),e(this).addClass("primary"),a.val(""),l.find("#palleon-my-templates li").show(),l.find("#palleon-my-templates-pagination").length&&(l.find("#palleon-my-templates-pagination").pagination("redraw"),l.find("#palleon-my-templates-pagination").pagination("selectPage",1)),a.prop("disabled",!1);else{e(this).addClass("cancel"),e(this).find(".material-icons").html("close"),e(this).removeClass("primary"),e(this).addClass("danger");var n=a.val().toLowerCase().replace(/\s/g,"");""==n||n.length<1?(l.find("#palleon-my-templates li").show(),l.find("#palleon-my-templates-pagination").length&&(l.find("#palleon-my-templates-pagination").pagination("redraw"),l.find("#palleon-my-templates-pagination").pagination("selectPage",1))):(l.find("#palleon-my-templates-pagination").length&&l.find("#palleon-my-templates-pagination").pagination("destroy"),l.find("#palleon-my-templates li").hide().filter('[data-keyword*="'+n+'"]').show(),0===l.find("#palleon-my-templates li:visible").length&&l.find("#palleon-my-templates-noimg").removeClass("d-none")),a.prop("disabled",!0)}}),l.find("#palleon-download").on("click",function(){var e=l.find("#palleon-download-name").val(),a=parseFloat(l.find("#palleon-download-quality").val()),n=l.find("#palleon-download-format").val(),t=document.createElement("a");u.setZoom(1),l.find("#palleon-img-zoom").val(100);var i=c,o=d;0!=p&&180!=p&&-180!=p||(i=d,o=c),u.setWidth(i),u.setHeight(o);var r=T(u.toDataURL({format:n,quality:a,enableRetinaScaling:!1})),s=URL.createObjectURL(r);t.download=e+"."+n,t.href=s,t.click(),_(),u.requestRenderAll(),l.find(".palleon-modal").hide()}),l.find("#palleon-download-format").on("change",function(){"png"==e(this).val()?l.find("#palleon-download-quality").prop("disabled",!0):l.find("#palleon-download-quality").prop("disabled",!1)}),l.find("#palleon-save-img-format").on("change",function(){"png"==e(this).val()?l.find("#palleon-save-img-quality").prop("disabled",!0):l.find("#palleon-save-img-quality").prop("disabled",!1)}),l.find("#palleon-save-img").on("click",function(){var a=(new Date).getTime(),n=l.find("#palleon-save-img-name").val(),t=parseFloat(l.find("#palleon-save-img-quality").val()),i=l.find("#palleon-save-img-format").val(),o=l.find("#palleon-canvas-img").data("id");u.setZoom(1),l.find("#palleon-img-zoom").val(100);var r=c,s=d;0!=p&&180!=p&&-180!=p||(r=d,s=c),u.setWidth(r),u.setHeight(s);var f=u.toDataURL({format:i,quality:t,enableRetinaScaling:!1}),g=T(f);_(),u.requestRenderAll();var m=new FormData;m.append("id",o),m.append("name",n),m.append("filename",a),m.append("format",i),m.append("type",g.type),m.append("url",f),m.append("action","saveImage"),m.append("nonce",palleonParams.nonce),e.ajax({url:palleonParams.ajaxurl,type:"POST",contentType:!1,processData:!1,cache:!1,data:m,success:function(){toastr.success(palleonParams.imgsaved,palleonParams.success),l.find(".palleon-modal").hide()},error:function(e,a,n){e.status&&400==e.status?toastr.error(e.responseText,palleonParams.error):toastr.error(palleonParams.wrong,palleonParams.error)}})}),l.find("#palleon-json-save").on("click",function(){var a=(new Date).getTime(),n=l.find("#palleon-json-save-name").val(),t=u.toJSON(["objectType","gradientFill","roundedCorders","mode","selectable","lockMovementX","lockMovementY","lockRotation","crossOrigin"]);R(t.backgroundImage.src,function(i){t.backgroundImage.src=i;var o=JSON.stringify(t),r=new FormData;r.append("name",n),r.append("filename",a),r.append("json",o),r.append("action","saveJson"),r.append("nonce",palleonParams.nonce),e.ajax({url:palleonParams.ajaxurl,type:"POST",contentType:!1,processData:!1,cache:!1,data:r,success:function(){l.find("#palleon-my-templates-refresh").trigger("click"),toastr.success(palleonParams.tempsaved,palleonParams.success),l.find(".palleon-modal").hide()},error:function(e,a,n){e.status&&400==e.status?toastr.error(e.responseText,palleonParams.error):toastr.error(palleonParams.wrong,palleonParams.error)}})})}),l.find("#palleon-canvas-size-select").on("change",function(){var a=e(this).val();"custom"==a?(l.find("#palleon-canvas-width").prop("disabled",!1),l.find("#palleon-canvas-height").prop("disabled",!1)):(l.find("#palleon-canvas-width").prop("disabled",!0),l.find("#palleon-canvas-height").prop("disabled",!0)),"blog-banner"==a?(l.find("#palleon-canvas-width").val(2240),l.find("#palleon-canvas-height").val(1260)):"fb-cover"==a?(l.find("#palleon-canvas-width").val(851),l.find("#palleon-canvas-height").val(315)):"fb-ad"==a?(l.find("#palleon-canvas-width").val(1200),l.find("#palleon-canvas-height").val(628)):"instagram"==a?(l.find("#palleon-canvas-width").val(1080),l.find("#palleon-canvas-height").val(1080)):"pinterest"==a?(l.find("#palleon-canvas-width").val(750),l.find("#palleon-canvas-height").val(1120)):"fb-post"==a?(l.find("#palleon-canvas-width").val(940),l.find("#palleon-canvas-height").val(788)):"twitter-post"==a?(l.find("#palleon-canvas-width").val(1600),l.find("#palleon-canvas-height").val(900)):"youtube"==a?(l.find("#palleon-canvas-width").val(1280),l.find("#palleon-canvas-height").val(720)):"wallpaper"==a&&(l.find("#palleon-canvas-width").val(1920),l.find("#palleon-canvas-height").val(1080))}),l.find("#palleon-canvas-color").on("change",function(){var a=e(this).val();l.find("#custom-image-background").spectrum("set",a),""==a?(u.backgroundColor="transparent",u.requestRenderAll()):(u.backgroundColor=a,u.requestRenderAll())}),l.find("#palleon-media-library").on("click",function(){C="add-to-canvas"}),l.find("#palleon-img-media-library").on("click",function(){C="add-as-object"}),l.find("#palleon-img-replace-media-library").on("click",function(){C="replace-image"}),l.find("#modal-media-library").on("click",".media-library-grid>.palleon-masonry-item>.palleon-masonry-item-inner",function(){var a=e(this).find("img").data("full");if("add-to-canvas"==C){l.find("#palleon-canvas-img").attr("src",a);var n=a.substring(0,a.indexOf("?"));""!=n&&(a=n),X(e(this).find("img").data("filename"),a.match(/\.[0-9a-z]+$/i)[0].replace(/\./g,"")),setTimeout(function(){Y("image")},100)}else if("add-as-object"==C){l.find("#palleon-canvas-loader").css("display","flex");var t=new Image;R(a,function(e){t.src=e,t.onload=function(){var e=new fabric.Image(t,{objectType:"image",roundedCorders:0,stroke:"#fff",strokeWidth:0,top:Z()[1]/2,left:Z()[0]/2,originX:"center",originY:"center"});u.add(e),e.scaleToWidth(Z()[0]/2),e.isPartiallyOnScreen()&&e.scaleToHeight(Z()[1]/2),u.setActiveObject(e),u.requestRenderAll(),l.find("#palleon-canvas-loader").hide(),u.fire("palleon:history",{type:"image",text:palleonParams.added})}})}else if("replace-image"==C){l.find("#palleon-canvas-loader").css("display","flex");t=new Image;R(a,function(e){t.src=e,t.onload=function(){u.getActiveObject().setSrc(e),u.requestRenderAll(),l.find("#palleon-canvas-loader").hide(),u.fire("palleon:history",{type:"image",text:palleonParams.replaced})}})}l.find("#modal-media-library").hide()}),l.find("#palleon-library-my-search").on("click",function(){var a=e(this).parent().find("input");if(l.find("#palleon-library-my-noimg").addClass("d-none"),""!=a.val())if(e(this).hasClass("cancel"))e(this).removeClass("cancel"),e(this).find(".material-icons").html("search"),e(this).removeClass("danger"),e(this).addClass("primary"),a.val(""),l.find("#palleon-library-my .palleon-masonry-item").show(),l.find("#palleon-library-my-pagination").length&&(l.find("#palleon-library-my-pagination").pagination("redraw"),l.find("#palleon-library-my-pagination").pagination("selectPage",1)),a.prop("disabled",!1);else{e(this).addClass("cancel"),e(this).find(".material-icons").html("close"),e(this).removeClass("primary"),e(this).addClass("danger");var n=a.val().toLowerCase().replace(/\s/g,"");""==n||n.length<1?(l.find("#palleon-library-my .palleon-masonry-item").show(),l.find("#palleon-library-my-pagination").length&&(l.find("#palleon-library-my-pagination").pagination("redraw"),l.find("#palleon-library-my-pagination").pagination("selectPage",1))):(l.find("#palleon-library-my-pagination").length&&l.find("#palleon-library-my-pagination").pagination("destroy"),l.find("#palleon-library-my .palleon-masonry-item").hide().filter('[data-keyword*="'+n+'"]').show(),0===l.find("#palleon-library-my .palleon-masonry-item:visible").length&&l.find("#palleon-library-my-noimg").removeClass("d-none")),a.prop("disabled",!0)}}),l.find("#palleon-library-all-search").on("click",function(){var a=e(this).parent().find("input");if(l.find("#palleon-library-all-noimg").addClass("d-none"),""!=a.val())if(e(this).hasClass("cancel"))e(this).removeClass("cancel"),e(this).find(".material-icons").html("search"),e(this).removeClass("danger"),e(this).addClass("primary"),a.val(""),l.find("#palleon-library-all .palleon-masonry-item").show(),l.find("#palleon-library-all-pagination").length&&(l.find("#palleon-library-all-pagination").pagination("redraw"),l.find("#palleon-library-all-pagination").pagination("selectPage",1)),a.prop("disabled",!1);else{e(this).addClass("cancel"),e(this).find(".material-icons").html("close"),e(this).removeClass("primary"),e(this).addClass("danger");var n=a.val().toLowerCase().replace(/\s/g,"");""==n||n.length<1?(l.find("#palleon-library-all .palleon-masonry-item").show(),l.find("#palleon-library-all-pagination").length&&(l.find("#palleon-library-all-pagination").pagination("redraw"),l.find("#palleon-library-all-pagination").pagination("selectPage",1))):(l.find("#palleon-library-all-pagination").length&&l.find("#palleon-library-all-pagination").pagination("destroy"),l.find("#palleon-library-all .palleon-masonry-item").hide().filter('[data-keyword*="'+n+'"]').show(),0===l.find("#palleon-library-all .palleon-masonry-item:visible").length&&l.find("#palleon-library-all-noimg").removeClass("d-none")),a.prop("disabled",!0)}}),l.find("#palleon-library-my-refresh").on("click",function(){var a=e(this),n={action:"loadmyimgs",nonce:palleonParams.nonce,query:libraryMyRefresh.posts};e.ajax({url:palleonParams.ajaxurl,data:n,type:"POST",beforeSend:function(e){a.html('<span class="material-icons">refresh</span>'+palleonParams.loading)},success:function(e){a.html('<span class="material-icons">refresh</span>'+palleonParams.refresh),e&&(l.find("#palleon-library-my-pagination").remove(),l.find("#palleon-library-my").html(e),S.update(),O(l.find("#palleon-library-my")))},error:function(e,n,l){a.html('<span class="material-icons">refresh</span>'+palleonParams.refresh),e.status&&400==e.status?toastr.error(e.responseText,palleonParams.error):toastr.error(palleonParams.wrong,palleonParams.error)}})}),l.find("#palleon-library-all-refresh").on("click",function(){var a=e(this),n={action:"loadallimgs",nonce:palleonParams.nonce,query:libraryAllRefresh.posts};e.ajax({url:palleonParams.ajaxurl,data:n,type:"POST",beforeSend:function(e){a.html('<span class="material-icons">refresh</span>'+palleonParams.loading)},success:function(e){a.html('<span class="material-icons">refresh</span>'+palleonParams.refresh),e&&(l.find("#palleon-library-all-pagination").remove(),l.find("#palleon-library-all").html(e),S.update(),O(l.find("#palleon-library-all")))},error:function(e,n,l){a.html('<span class="material-icons">refresh</span>'+palleonParams.refresh),e.status&&400==e.status?toastr.error(e.responseText,palleonParams.error):toastr.error(palleonParams.wrong,palleonParams.error)}})}),l.find("#palleon-library-upload-img").on("change",function(a){var n=this.files[0],t=new FormData;t.append("file",n),t.append("action","uploadImgToLibrary"),t.append("nonce",palleonParams.nonce),e.ajax({url:palleonParams.ajaxurl,type:"POST",contentType:!1,processData:!1,cache:!1,data:t,success:function(e){l.find("#palleon-library-my-refresh").trigger("click")},error:function(e,a,n){e.status&&400==e.status?toastr.error(e.responseText,palleonParams.error):toastr.error(palleonParams.wrong,palleonParams.error)}}).done(function(e){!1===e.success?toastr.error(e.data,palleonParams.error):toastr.success(palleonParams.uploaded,palleonParams.success)})}),l.find(".media-library-grid").on("click",".palleon-library-delete",function(){if(window.confirm(palleonParams.answer2)){var a=e(this).data("target"),n=new FormData;n.append("target",a),n.append("action","deleteImgFromLibrary"),n.append("nonce",palleonParams.nonce),e.ajax({url:palleonParams.ajaxurl,type:"POST",contentType:!1,processData:!1,cache:!1,data:n,success:function(e){l.find("#palleon-library-my-refresh").trigger("click"),toastr.success(palleonParams.deleted,palleonParams.success)},error:function(e,a,n){e.status&&400==e.status?toastr.error(e.responseText,palleonParams.error):toastr.error(palleonParams.wrong,palleonParams.error)}})}}),l.find(".svg-library-grid").on("click",">.palleon-masonry-item>.palleon-masonry-item-inner",function(){var a=e(this).find("img").data("full");fabric.loadSVGFromURL(a,function(e,a){var n=fabric.util.groupSVGElements(e,a);n.set("originX","center"),n.set("originY","center"),n.set("left",Z()[0]/2),n.set("top",Z()[1]/2),n.set("objectType","customSVG"),n.scaleToWidth(Z()[0]/2),n.scaleToHeight(Z()[1]/2),u.add(n),u.setActiveObject(n),u.requestRenderAll()},function(){},{crossOrigin:"anonymous"}),l.find("#modal-svg-library").hide()}),l.find("#palleon-svg-library-my-search").on("click",function(){var a=e(this).parent().find("input");if(l.find("#palleon-svg-library-my-noimg").addClass("d-none"),""!=a.val())if(e(this).hasClass("cancel"))e(this).removeClass("cancel"),e(this).find(".material-icons").html("search"),e(this).removeClass("danger"),e(this).addClass("primary"),a.val(""),l.find("#palleon-svg-library-my .palleon-masonry-item").show(),l.find("#palleon-svg-library-my-pagination").length&&(l.find("#palleon-svg-library-my-pagination").pagination("redraw"),l.find("#palleon-svg-library-my-pagination").pagination("selectPage",1)),a.prop("disabled",!1);else{e(this).addClass("cancel"),e(this).find(".material-icons").html("close"),e(this).removeClass("primary"),e(this).addClass("danger");var n=a.val().toLowerCase().replace(/\s/g,"");""==n||n.length<1?(l.find("#palleon-svg-library-my .palleon-masonry-item").show(),l.find("#palleon-svg-library-my-pagination").length&&(l.find("#palleon-svg-library-my-pagination").pagination("redraw"),l.find("#palleon-svg-library-my-pagination").pagination("selectPage",1))):(l.find("#palleon-svg-library-my-pagination").length&&l.find("#palleon-svg-library-my-pagination").pagination("destroy"),l.find("#palleon-svg-library-my .palleon-masonry-item").hide().filter('[data-keyword*="'+n+'"]').show(),0===l.find("#palleon-svg-library-my .palleon-masonry-item:visible").length&&l.find("#palleon-svg-library-my-noimg").removeClass("d-none")),a.prop("disabled",!0)}}),l.find("#palleon-svg-library-all-search").on("click",function(){var a=e(this).parent().find("input");if(l.find("#palleon-library-all-noimg").addClass("d-none"),""!=a.val())if(e(this).hasClass("cancel"))e(this).removeClass("cancel"),e(this).find(".material-icons").html("search"),e(this).removeClass("danger"),e(this).addClass("primary"),a.val(""),l.find("#palleon-svg-library-all .palleon-masonry-item").show(),l.find("#palleon-svg-library-all-pagination").length&&(l.find("#palleon-svg-library-all-pagination").pagination("redraw"),l.find("#palleon-svg-library-all-pagination").pagination("selectPage",1)),a.prop("disabled",!1);else{e(this).addClass("cancel"),e(this).find(".material-icons").html("close"),e(this).removeClass("primary"),e(this).addClass("danger");var n=a.val().toLowerCase().replace(/\s/g,"");""==n||n.length<1?(l.find("#palleon-svg-library-all .palleon-masonry-item").show(),l.find("#palleon-svg-library-all-pagination").length&&(l.find("#palleon-svg-library-all-pagination").pagination("redraw"),l.find("#palleon-svg-library-all-pagination").pagination("selectPage",1))):(l.find("#palleon-svg-library-all-pagination").length&&l.find("#palleon-svg-library-all-pagination").pagination("destroy"),l.find("#palleon-svg-library-all .palleon-masonry-item").hide().filter('[data-keyword*="'+n+'"]').show(),0===l.find("#palleon-svg-library-all .palleon-masonry-item:visible").length&&l.find("#palleon-svg-library-all-noimg").removeClass("d-none")),a.prop("disabled",!0)}}),l.find("#palleon-svg-library-my-refresh").on("click",function(){var a=e(this),n={action:"loadmyimgs",nonce:palleonParams.nonce,query:SVGlibraryMyRefresh.posts};e.ajax({url:palleonParams.ajaxurl,data:n,type:"POST",beforeSend:function(e){a.html('<span class="material-icons">refresh</span>'+palleonParams.loading)},success:function(e){a.html('<span class="material-icons">refresh</span>'+palleonParams.refresh),e&&(l.find("#palleon-svg-library-my-pagination").remove(),l.find("#palleon-svg-library-my").html(e),S.update(),O(l.find("#palleon-svg-library-my")))},error:function(e,n,l){a.html('<span class="material-icons">refresh</span>'+palleonParams.refresh),e.status&&400==e.status?toastr.error(e.responseText,palleonParams.error):toastr.error(palleonParams.wrong,palleonParams.error)}})}),l.find("#palleon-svg-library-all-refresh").on("click",function(){var a=e(this),n={action:"loadallimgs",nonce:palleonParams.nonce,query:SVGlibraryAllRefresh.posts};e.ajax({url:palleonParams.ajaxurl,data:n,type:"POST",beforeSend:function(e){a.html('<span class="material-icons">refresh</span>'+palleonParams.loading)},success:function(e){a.html('<span class="material-icons">refresh</span>'+palleonParams.refresh),e&&(l.find("#palleon-svg-library-all-pagination").remove(),l.find("#palleon-svg-library-all").html(e),S.update(),O(l.find("#palleon-svg-library-all")))},error:function(e,n,l){a.html('<span class="material-icons">refresh</span>'+palleonParams.refresh),e.status&&400==e.status?toastr.error(e.responseText,palleonParams.error):toastr.error(palleonParams.wrong,palleonParams.error)}})}),l.find("#palleon-svg-library-upload-img").on("change",function(a){var n=this.files[0],t=new FormData;t.append("file",n),t.append("action","uploadSVGToLibrary"),t.append("nonce",palleonParams.nonce),e.ajax({url:palleonParams.ajaxurl,type:"POST",contentType:!1,processData:!1,cache:!1,data:t,success:function(e){l.find("#palleon-svg-library-my-refresh").trigger("click")},error:function(e,a,n){e.status&&400==e.status?toastr.error(e.responseText,palleonParams.error):toastr.error(palleonParams.wrong,palleonParams.error)}}).done(function(e){!1===e.success?toastr.error(e.data,palleonParams.error):toastr.success(palleonParams.uploaded,palleonParams.success)})}),l.find(".svg-library-grid").on("click",".palleon-svg-library-delete",function(){if(window.confirm(palleonParams.answer2)){var a=e(this).data("target"),n=new FormData;n.append("target",a),n.append("action","deleteImgFromLibrary"),n.append("nonce",palleonParams.nonce),e.ajax({url:palleonParams.ajaxurl,type:"POST",contentType:!1,processData:!1,cache:!1,data:n,success:function(e){l.find("#palleon-svg-library-my-refresh").trigger("click"),toastr.success(palleonParams.deleted,palleonParams.success)},error:function(e,a,n){e.status&&400==e.status?toastr.error(e.responseText,palleonParams.error):toastr.error(palleonParams.wrong,palleonParams.error)}})}}),l.find("#palleon-pexels-search").on("click",function(){var a=l.find("#pexels-orientation").val(),n=l.find("#pexels-color").val(),t=l.find("#palleon-pexels-keyword").val(),i={action:"pexelsSearch",nonce:palleonParams.nonce,orientation:a,color:n,keyword:t,page:"1"};e.ajax({url:palleonParams.ajaxurl,data:i,type:"POST",beforeSend:function(e){l.find("#pexels").css("pointer-events","none"),l.find("#pexels-menu,#pexels-output").css("opacity",.5)},success:function(e){e?(l.find("#pexels-output").html(e),S.update()):l.find("#pexels-output").html(e)},error:function(e,a,n){e.status&&400==e.status?toastr.error(e.responseText,palleonParams.error):toastr.error(palleonParams.wrong,palleonParams.error)}}).done(function(e){l.find("#pexels").css("pointer-events","auto"),l.find("#pexels-menu,#pexels-output").css("opacity",1)})}),l.find("#palleon-pexels-keyword").on("keyup input",function(){""==e(this).val()?(l.find("#pexels-orientation").val(""),l.find("#pexels-color").val(""),l.find("#pexels-orientation").prop("disabled",!0),l.find("#pexels-color").prop("disabled",!0)):(l.find("#pexels-orientation").prop("disabled",!1),l.find("#pexels-color").prop("disabled",!1))}),l.find("#pexels-output").on("click","#pexels-loadmore",function(){var a=l.find("#pexels-orientation").val(),n=l.find("#pexels-color").val(),t=l.find("#palleon-pexels-keyword").val(),i={action:"pexelsSearch",nonce:palleonParams.nonce,orientation:a,color:n,keyword:t,page:parseInt(e(this).data("page"))+1};e.ajax({url:palleonParams.ajaxurl,data:i,type:"POST",beforeSend:function(e){l.find("#pexels").css("pointer-events","none"),l.find("#pexels-menu,#pexels-output").css("opacity",.5),l.find("#pexels-loadmore").html(palleonParams.loading)},success:function(e){e?(l.find("#pexels-loadmore").remove(),l.find("#pexels-output > .pexels-grid:last-child").after(e),S.update()):l.find("#pexels-loadmore").prop("disabled",!1)},error:function(e,a,n){e.status&&400==e.status?toastr.error(e.responseText,palleonParams.error):toastr.error(palleonParams.wrong,palleonParams.error)}}).done(function(e){l.find("#pexels").css("pointer-events","auto"),l.find("#pexels-menu,#pexels-output").css("opacity",1),l.find("#pexels-loadmore").html(palleonParams.loadmore)})}),l.find("#palleon-undo").on("click",function(){var e=l.find("#palleon-history-list li.active").next("li");e.length?(e.find(".palleon-btn.primary").trigger("click"),l.find("#palleon-redo").prop("disabled",!1)):l.find("#palleon-undo").prop("disabled",!0)}),l.find("#palleon-redo").on("click",function(){var e=l.find("#palleon-history-list li.active").prev("li");e.length?(e.find(".palleon-btn.primary").trigger("click"),l.find("#palleon-undo").prop("disabled",!1)):l.find("#palleon-redo").prop("disabled",!0)}),l.find("#palleon-history-list").on("click",".palleon-btn.danger",function(){e(this).parent().parent().remove(),e("#palleon-history-list li").length||(l.find("#palleon-history").prop("disabled",!0),l.find("#palleon-undo").prop("disabled",!0),l.find("#palleon-redo").prop("disabled",!0),l.find(".palleon-modal").hide())}),l.find("#palleon-history-list").on("click",".palleon-btn.primary",function(){l.find("#palleon-history-list li").removeClass("active"),e(this).parent().parent().addClass("active");var a=l.find("#palleon-history-list li.active").next("li"),n=l.find("#palleon-history-list li.active").prev("li");a.length?l.find("#palleon-undo").prop("disabled",!1):l.find("#palleon-undo").prop("disabled",!0),n.length?l.find("#palleon-redo").prop("disabled",!1):l.find("#palleon-redo").prop("disabled",!0);var t=JSON.parse(e(this).parent().find("script").html());l.find(".palleon-modal").hide(),R(t.backgroundImage.src,function(e){t.backgroundImage.src=e,B(t),l.find("#palleon-canvas-loader").hide()})}),l.find("#palleon-clear-history").on("click",function(){window.confirm(palleonParams.answer3)&&(l.find("#palleon-history-list li").remove(),l.find("#palleon-history").prop("disabled",!0),l.find("#palleon-undo").prop("disabled",!0),l.find("#palleon-redo").prop("disabled",!0),l.find(".palleon-modal").hide())}),u.on("palleon:history",function(e){M(D(e.type)+" "+e.text)});var E=!1;function L(){l.find("#palleon-layers li").length?(l.find("#palleon-no-layer").hide(),l.find("#palleon-layer-delete-wrap").css("visibility","visible")):(l.find("#palleon-no-layer").show(),l.find("#palleon-layer-delete-wrap").css("visibility","hidden"))}function W(a){if(l.find("#palleon-layers li").removeClass("active"),a.length>=2)for(var n=0;n<a.length;n++)l.find("#palleon-layers #"+a[n].id).addClass("active");else(a=a[0]).objectType?("textbox"==a.objectType?(l.find("#palleon-text-settings").show(),function(e){l.find("#palleon-text-input").val(e.text),l.find("#palleon-font-family").val(e.fontFamily),l.find("#palleon-font-family").trigger("change"),"none"==e.gradientFill?(l.find("#palleon-text-gradient").val("none"),l.find("#palleon-text-color").spectrum("set",e.fill)):"vertical"==e.gradientFill?(l.find("#palleon-text-gradient").val("vertical"),4==e.fill.colorStops.length?(l.find("#text-gradient-color-1").spectrum("set",e.fill.colorStops[0].color),l.find("#text-gradient-color-2").spectrum("set",e.fill.colorStops[1].color),l.find("#text-gradient-color-3").spectrum("set",e.fill.colorStops[2].color),l.find("#text-gradient-color-4").spectrum("set",e.fill.colorStops[3].color)):3==e.fill.colorStops.length?(l.find("#text-gradient-color-1").spectrum("set",e.fill.colorStops[0].color),l.find("#text-gradient-color-2").spectrum("set",e.fill.colorStops[1].color),l.find("#text-gradient-color-3").spectrum("set",e.fill.colorStops[2].color),l.find("#text-gradient-color-4").spectrum("set","")):2==e.fill.colorStops.length&&(l.find("#text-gradient-color-1").spectrum("set",e.fill.colorStops[0].color),l.find("#text-gradient-color-2").spectrum("set",e.fill.colorStops[1].color),l.find("#text-gradient-color-3").spectrum("set",""),l.find("#text-gradient-color-4").spectrum("set",""))):"horizontal"==e.gradientFill&&(l.find("#palleon-text-gradient").val("horizontal"),4==e.fill.colorStops.length?(l.find("#text-gradient-color-1").spectrum("set",e.fill.colorStops[0].color),l.find("#text-gradient-color-2").spectrum("set",e.fill.colorStops[1].color),l.find("#text-gradient-color-3").spectrum("set",e.fill.colorStops[2].color),l.find("#text-gradient-color-4").spectrum("set",e.fill.colorStops[3].color)):3==e.fill.colorStops.length?(l.find("#text-gradient-color-1").spectrum("set",e.fill.colorStops[0].color),l.find("#text-gradient-color-2").spectrum("set",e.fill.colorStops[1].color),l.find("#text-gradient-color-3").spectrum("set",e.fill.colorStops[2].color),l.find("#text-gradient-color-4").spectrum("set","")):2==e.fill.colorStops.length&&(l.find("#text-gradient-color-1").spectrum("set",e.fill.colorStops[0].color),l.find("#text-gradient-color-2").spectrum("set",e.fill.colorStops[1].color),l.find("#text-gradient-color-3").spectrum("set",""),l.find("#text-gradient-color-4").spectrum("set","")));l.find("#palleon-text-gradient").trigger("change"),"bold"==e.fontWeight?l.find("#format-bold").addClass("active"):l.find("#format-bold").removeClass("active");"italic"==e.fontStyle?l.find("#format-italic").addClass("active"):l.find("#format-italic").removeClass("active");1==e.underline?l.find("#format-underline").addClass("active"):l.find("#format-underline").removeClass("active");"left"==e.textAlign&&(l.find(".format-align").removeClass("active"),l.find("#format-align-left").addClass("active"));"right"==e.textAlign&&(l.find(".format-align").removeClass("active"),l.find("#format-align-right").addClass("active"));"center"==e.textAlign&&(l.find(".format-align").removeClass("active"),l.find("#format-align-center").addClass("active"));"justify"==e.textAlign&&(l.find(".format-align").removeClass("active"),l.find("#format-align-justify").addClass("active"));l.find("#palleon-font-size").val(e.fontSize),l.find("#palleon-outline-size").val(e.strokeWidth),l.find("#palleon-line-height").val(e.lineHeight),l.find("#palleon-letter-spacing").val(e.charSpacing),l.find("#palleon-outline-color").spectrum("set",e.stroke),l.find("#palleon-text-background").spectrum("set",e.textBackgroundColor),null==e.shadow?l.find("#palleon-text-shadow").prop("checked",!1):(l.find("#palleon-text-shadow").prop("checked",!0),l.find("#text-shadow-color").spectrum("set",e.shadow.color),l.find("#text-shadow-blur").val(e.shadow.blur),l.find("#text-shadow-offset-x").val(e.shadow.offsetX),l.find("#text-shadow-offset-y").val(e.shadow.offsetY));l.find("#palleon-text-shadow").trigger("change"),1==e.flipX?l.find("#text-flip-x").addClass("active"):l.find("#text-flip-x").removeClass("active");1==e.flipY?l.find("#text-flip-y").addClass("active"):l.find("#text-flip-y").removeClass("active");l.find("#text-skew-x").val(e.skewX),l.find("#text-skew-x").parent().parent().find(".slider-label span").html(e.skewX),l.find("#text-skew-y").val(e.skewY),l.find("#text-skew-y").parent().parent().find(".slider-label span").html(e.skewY),l.find("#text-rotate").val(parseInt(e.angle)),l.find("#text-rotate").parent().parent().find(".slider-label span").html(parseInt(e.angle))}(a),l.find("#palleon-btn-text").hasClass("active")||l.find("#palleon-btn-text").trigger("click"),l.find("#palleon-font-family").trigger("change")):l.find("#palleon-text-settings").hide(),"image"==a.objectType?(l.find("#palleon-image-settings").show(),function(e){l.find("#img-border-radius").val(e.roundedCorders),l.find("#img-border-radius").parent().parent().find(".slider-label span").html(e.roundedCorders),null==e.shadow?l.find("#palleon-image-shadow").prop("checked",!1):(l.find("#palleon-image-shadow").prop("checked",!0),l.find("#image-shadow-color").spectrum("set",e.shadow.color),l.find("#image-shadow-blur").val(e.shadow.blur),l.find("#image-shadow-offset-x").val(e.shadow.offsetX),l.find("#image-shadow-offset-y").val(e.shadow.offsetY));l.find("#palleon-image-shadow").trigger("change"),l.find("#img-border-width").val(e.strokeWidth),l.find("#img-border-color").spectrum("set",e.stroke),l.find("#img-opacity").val(e.opacity),l.find("#img-opacity").parent().parent().find(".slider-label span").html(e.opacity),l.find("#img-skew-x").val(e.skewX),l.find("#img-skew-x").parent().parent().find(".slider-label span").html(e.skewX),l.find("#img-skew-y").val(e.skewY),l.find("#img-skew-y").parent().parent().find(".slider-label span").html(e.skewY),l.find("#img-rotate").val(parseInt(e.angle)),l.find("#img-rotate").parent().parent().find(".slider-label span").html(parseInt(e.angle))}(a),l.find("#palleon-btn-image").hasClass("active")||l.find("#palleon-btn-image").trigger("click")):l.find("#palleon-image-settings").hide(),"frame"==a.objectType&&(l.find("#palleon-btn-frames").hasClass("active")||l.find("#palleon-btn-frames").trigger("click")),"element"==a.objectType?(l.find("#palleon-custom-element-options").show(),l.find("#palleon-custom-element-options-info").hide(),function(e){"none"==e.gradientFill?(l.find("#palleon-element-gradient").val("none"),l.find("#palleon-element-color").spectrum("set",e.fill)):"vertical"==e.gradientFill?(l.find("#palleon-element-gradient").val("vertical"),4==e.fill.colorStops.length?(l.find("#element-gradient-color-1").spectrum("set",e.fill.colorStops[0].color),l.find("#element-gradient-color-2").spectrum("set",e.fill.colorStops[1].color),l.find("#element-gradient-color-3").spectrum("set",e.fill.colorStops[2].color),l.find("#element-gradient-color-4").spectrum("set",e.fill.colorStops[3].color)):3==e.fill.colorStops.length?(l.find("#element-gradient-color-1").spectrum("set",e.fill.colorStops[0].color),l.find("#element-gradient-color-2").spectrum("set",e.fill.colorStops[1].color),l.find("#element-gradient-color-3").spectrum("set",e.fill.colorStops[2].color),l.find("#element-gradient-color-4").spectrum("set","")):2==e.fill.colorStops.length&&(l.find("#element-gradient-color-1").spectrum("set",e.fill.colorStops[0].color),l.find("#element-gradient-color-2").spectrum("set",e.fill.colorStops[1].color),l.find("#element-gradient-color-3").spectrum("set",""),l.find("#element-gradient-color-4").spectrum("set",""))):"horizontal"==e.gradientFill&&(l.find("#palleon-element-gradient").val("horizontal"),4==e.fill.colorStops.length?(l.find("#element-gradient-color-1").spectrum("set",e.fill.colorStops[0].color),l.find("#element-gradient-color-2").spectrum("set",e.fill.colorStops[1].color),l.find("#element-gradient-color-3").spectrum("set",e.fill.colorStops[2].color),l.find("#element-gradient-color-4").spectrum("set",e.fill.colorStops[3].color)):3==e.fill.colorStops.length?(l.find("#element-gradient-color-1").spectrum("set",e.fill.colorStops[0].color),l.find("#element-gradient-color-2").spectrum("set",e.fill.colorStops[1].color),l.find("#element-gradient-color-3").spectrum("set",e.fill.colorStops[2].color),l.find("#element-gradient-color-4").spectrum("set","")):2==e.fill.colorStops.length&&(l.find("#element-gradient-color-1").spectrum("set",e.fill.colorStops[0].color),l.find("#element-gradient-color-2").spectrum("set",e.fill.colorStops[1].color),l.find("#element-gradient-color-3").spectrum("set",""),l.find("#element-gradient-color-4").spectrum("set","")));l.find("#palleon-element-gradient").trigger("change"),l.find("#element-opacity").val(e.opacity),l.find("#element-opacity").parent().parent().find(".slider-label span").html(e.opacity),l.find("#element-skew-x").val(e.skewX),l.find("#element-skew-x").parent().parent().find(".slider-label span").html(e.skewX),l.find("#element-skew-y").val(e.skewX),l.find("#element-skew-y").parent().parent().find(".slider-label span").html(e.skewY),l.find("#element-rotate").val(parseInt(e.angle)),l.find("#element-rotate").parent().parent().find(".slider-label span").html(parseInt(e.angle)),null==e.shadow?l.find("#palleon-element-shadow").prop("checked",!1):(l.find("#palleon-element-shadow").prop("checked",!0),l.find("#element-shadow-color").spectrum("set",e.shadow.color),l.find("#element-shadow-blur").val(e.shadow.blur),l.find("#element-shadow-offset-x").val(e.shadow.offsetX),l.find("#element-shadow-offset-y").val(e.shadow.offsetY));l.find("#palleon-element-shadow").trigger("change")}(a),l.find("#palleon-btn-elements").hasClass("active")||l.find("#palleon-btn-elements").trigger("click"),l.find("#palleon-custom-element-open").trigger("click")):(l.find("#palleon-custom-element-options").hide(),l.find("#palleon-custom-element-options-info").show()),P.includes(a.objectType)?(j.includes(a.objectType)?l.find("#shape-custom-width-wrap").show():l.find("#shape-custom-width-wrap").hide(),l.find("#palleon-shape-settings").show(),function(e){l.find("#shape-outline-width").val(e.strokeWidth),"none"==e.gradientFill?(l.find("#palleon-shape-gradient").val("none"),l.find("#palleon-shape-color").spectrum("set",e.fill)):"vertical"==e.gradientFill?(l.find("#palleon-shape-gradient").val("vertical"),4==e.fill.colorStops.length?(l.find("#shape-gradient-color-1").spectrum("set",e.fill.colorStops[0].color),l.find("#shape-gradient-color-2").spectrum("set",e.fill.colorStops[1].color),l.find("#shape-gradient-color-3").spectrum("set",e.fill.colorStops[2].color),l.find("#shape-gradient-color-4").spectrum("set",e.fill.colorStops[3].color)):3==e.fill.colorStops.length?(l.find("#shape-gradient-color-1").spectrum("set",e.fill.colorStops[0].color),l.find("#shape-gradient-color-2").spectrum("set",e.fill.colorStops[1].color),l.find("#shape-gradient-color-3").spectrum("set",e.fill.colorStops[2].color),l.find("#shape-gradient-color-4").spectrum("set","")):2==e.fill.colorStops.length&&(l.find("#shape-gradient-color-1").spectrum("set",e.fill.colorStops[0].color),l.find("#shape-gradient-color-2").spectrum("set",e.fill.colorStops[1].color),l.find("#shape-gradient-color-3").spectrum("set",""),l.find("#shape-gradient-color-4").spectrum("set",""))):"horizontal"==e.gradientFill&&(l.find("#palleon-shape-gradient").val("horizontal"),4==e.fill.colorStops.length?(l.find("#shape-gradient-color-1").spectrum("set",e.fill.colorStops[0].color),l.find("#shape-gradient-color-2").spectrum("set",e.fill.colorStops[1].color),l.find("#shape-gradient-color-3").spectrum("set",e.fill.colorStops[2].color),l.find("#shape-gradient-color-4").spectrum("set",e.fill.colorStops[3].color)):3==e.fill.colorStops.length?(l.find("#shape-gradient-color-1").spectrum("set",e.fill.colorStops[0].color),l.find("#shape-gradient-color-2").spectrum("set",e.fill.colorStops[1].color),l.find("#shape-gradient-color-3").spectrum("set",e.fill.colorStops[2].color),l.find("#shape-gradient-color-4").spectrum("set","")):2==e.fill.colorStops.length&&(l.find("#shape-gradient-color-1").spectrum("set",e.fill.colorStops[0].color),l.find("#shape-gradient-color-2").spectrum("set",e.fill.colorStops[1].color),l.find("#shape-gradient-color-3").spectrum("set",""),l.find("#shape-gradient-color-4").spectrum("set","")));l.find("#palleon-shape-gradient").trigger("change"),l.find("#shape-outline-color").spectrum("set",e.stroke),null==e.shadow?l.find("#palleon-shape-shadow").prop("checked",!1):(l.find("#palleon-shape-shadow").prop("checked",!0),l.find("#shape-shadow-color").spectrum("set",e.shadow.color),l.find("#shape-shadow-blur").val(e.shadow.blur),l.find("#shape-shadow-offset-x").val(e.shadow.offsetX),l.find("#shape-shadow-offset-y").val(e.shadow.offsetY));l.find("#palleon-shape-shadow").trigger("change"),l.find("#shape-opacity").val(e.opacity),l.find("#shape-opacity").parent().parent().find(".slider-label span").html(e.opacity),l.find("#shape-skew-x").val(e.skewX),l.find("#shape-skew-x").parent().parent().find(".slider-label span").html(e.skewX),l.find("#shape-skew-y").val(e.skewX),l.find("#shape-skew-y").parent().parent().find(".slider-label span").html(e.skewY),l.find("#shape-rotate").val(parseInt(e.angle)),l.find("#shape-rotate").parent().parent().find(".slider-label span").html(parseInt(e.angle)),l.find("#shape-custom-width").val(""),l.find("#shape-custom-height").val("")}(a),l.find("#palleon-btn-shapes").hasClass("active")||l.find("#palleon-btn-shapes").trigger("click")):l.find("#palleon-shape-settings").hide(),a.id&&l.find("#palleon-layers #"+a.id).addClass("active")):e.each(a,function(e,a){l.find("#palleon-layers #"+a.id).addClass("active")})}function G(){fabric.Image.fromURL(s,function(e){u.setBackgroundImage(e,u.renderAll.bind(u),{objectType:"BG",mode:o,top:0,left:0,scaleX:f,scaleY:g,selectable:!1,angle:p,originX:m,originY:h,lockMovementX:!0,lockMovementY:!0,lockRotation:!0,erasable:!0},{crossOrigin:"anonymous"})})}function _(e){var a=c,n=d;if(0!=p&&180!=p&&-180!=p||(a=d,n=c),e)e/=100,u.setZoom(e);else{var t=l.find("#palleon-img-zoom").val(),i=1,o=0;a<l.find("#palleon-content").width()&&n<l.find("#palleon-content").height()?(u.setZoom(1),l.find("#palleon-img-zoom").val(100)):(a>l.find("#palleon-content").width()&&t>100*(i=(l.find("#palleon-content").width()-60)/a).toFixed(2)&&(u.setZoom(i.toFixed(2)),l.find("#palleon-img-zoom").val(100*i.toFixed(2)),o=i.toFixed(2)),n>l.find("#palleon-content").height()&&t>100*(i=l.find("#palleon-content").height()/n).toFixed(2)&&(0===o||o>i.toFixed(2))&&(u.setZoom(i.toFixed(2)),l.find("#palleon-img-zoom").val(100*i.toFixed(2))))}u.setWidth(a*u.getZoom()),u.setHeight(n*u.getZoom()),!0===u.isDrawingMode&&(l.find("#palleon-erase-btn").hasClass("active")&&l.find("#eraser-width").trigger("input"),l.find("#palleon-draw-btn").hasClass("active")&&l.find("#brush-width").trigger("input"))}u.on("object:moving",function(e){E=!0}),u.on("mouse:up",function(e){var a=e.target;if(null!==a){var n=a.objectType;E&&M(D(n)+" "+palleonParams.moved)}}),u.on("object:moving",function(e){var a=c,n=d;0!=p&&180!=p&&-180!=p||(a=d,n=c);var l=e.target,t=l.getScaledWidth(),i=l.getScaledHeight();l.isPartiallyOnScreen()&&"clipPath"==l.objectType&&(l.top<0&&l.left<0?(l.top=0,l.left=0,l.lockMovementX=!0,l.lockMovementY=!0):l.top<0&&t+l.left>a?(l.top=0,l.left=a-t,l.lockMovementX=!0,l.lockMovementY=!0):i+l.top>n&&l.left<0?(l.top=n-i,l.left=0,l.lockMovementX=!0,l.lockMovementY=!0):i+l.top>n&&t+l.left>a?(l.top=n-i,l.left=a-t,l.lockMovementX=!0,l.lockMovementY=!0):l.top<0?(l.top=0,l.lockMovementY=!0):l.left<0?(l.left=0,l.lockMovementX=!0):t+l.left>a?(l.left=a-t,l.lockMovementX=!0):i+l.top>n&&(l.top=n-i,l.lockMovementY=!0),l.setCoords())}),u.on("object:scaling",function(e){var a=c,n=d;0!=p&&180!=p&&-180!=p||(a=d,n=c);var l=e.target,t=l.getScaledWidth(),i=l.getScaledHeight();l.isPartiallyOnScreen()&&"clipPath"==l.objectType&&(t>=a&&(l.set({scaleX:a/l.width}),l.lockScalingX=!0),i>=n&&(l.set({scaleY:n/l.height}),l.lockScalingY=!0),l.top<0&&(l.top=0,l.lockScalingX=!0,l.lockScalingY=!0,l.setCoords()),l.left<0&&(l.left=0,l.lockScalingX=!0,l.lockScalingY=!0,l.setCoords()),t+l.left>a&&(l.left=a-t,l.lockScalingX=!0,l.lockScalingY=!0,l.setCoords()),i+l.top>n&&(l.top=n-i,l.lockScalingX=!0,l.lockScalingY=!0,l.setCoords()))}),u.on("object:added",function(a){var n,t,i=a.target;if("clipPath"!=i.objectType&&"drawing"!=i.objectType)if(!0===u.isDrawingMode)i.set("objectType","drawing"),i.set("selectable",!1),i.set("lockMovementX",!0),i.set("lockMovementY",!0),i.set("lockRotation",!0);else{var o,r=u.getObjects().indexOf(i),s="Object",d="category",c="layer-visible",p="visibility",f="layer-unlocked",g="lock_open";0==i.visible&&(c="layer-hidden",p="visibility_off"),0==i.selectable&&(f="layer-locked",g="lock"),i.set("id",(new Date).getTime()),l.find("#palleon-layers > li").removeClass("active"),"textbox"==i.objectType?(s=i.text,d="title"):"drawing"==i.objectType?(s=palleonParams.freeDrawing,d="brush"):"frame"==i.objectType?(s=palleonParams.frame,d="wallpaper"):"image"==i.objectType?(s=palleonParams.image,d="image"):"circle"==i.objectType?s=palleonParams.circle:"square"==i.objectType?s=palleonParams.square:"rectangle"==i.objectType?s=palleonParams.rectangle:"triangle"==i.objectType?s=palleonParams.triangle:"ellipse"==i.objectType?s=palleonParams.ellipse:"trapezoid"==i.objectType?s=palleonParams.trapezoid:"emerald"==i.objectType?s=palleonParams.emerald:"star"==i.objectType?s=palleonParams.star:"element"==i.objectType?(s=palleonParams.element,d="star"):"customSVG"==i.objectType&&(s=palleonParams.customSvg),o='<li id="'+i.id+'" data-type="'+i.objectType+'" class="layer-'+i.objectType+' active" data-sort="'+r+'"><span class="material-icons">'+d+'</span><div class="layer-name">'+s+'</div><span class="material-icons layer-settings">settings</span><div class="layer-icons"><a class="material-icons lock-layer '+f+'" title="'+palleonParams.lockunlock+'">'+g+'</a><a class="material-icons text-success duplicate-layer" title="'+palleonParams.duplicate+'">content_copy</a><a class="material-icons layer-visibility '+c+'" title="'+palleonParams.showhide+'">'+p+'</a><a class="material-icons text-danger delete-layer" title="'+palleonParams.delete+'">clear</a></div></li>',l.find("#palleon-layers").prepend(o),n=i.id,(t=l.find("#palleon-layers #"+n)).find("a.delete-layer").on("click",function(e){e.preventDefault();var a=u.getObjects();a.filter(e=>e.id==n).forEach(e=>u.remove(e)),t.remove(),u.requestRenderAll(),l.find("#palleon-layers").sortable("refresh"),L(),u.fire("palleon:history",{type:t.data("type"),text:palleonParams.removed})}),function(e){var a=l.find("#palleon-layers #"+e);a.find("a.duplicate-layer").on("click",function(n){n.preventDefault();var t=u.getObjects();t.filter(a=>a.id==e).forEach(e=>e.clone(function(a){a.set("id",(new Date).getTime()),a.set("objectType",e.objectType),u.add(a),u.setActiveObject(a)})),u.requestRenderAll(),l.find("#palleon-layers").sortable("refresh"),u.fire("palleon:history",{type:a.data("type"),text:palleonParams.added})})}(i.id),function(a){l.find("#palleon-layers #"+a).find("a.layer-visibility").on("click",function(n){n.preventDefault();var l=u.getObjects();e(this).hasClass("layer-visible")?(e(this).removeClass("layer-visible"),e(this).addClass("layer-hidden"),e(this).html("visibility_off"),l.filter(e=>e.id==a).forEach(e=>e.set("visible",!1))):e(this).hasClass("layer-hidden")&&(e(this).removeClass("layer-hidden"),e(this).addClass("layer-visible"),e(this).html("visibility"),l.filter(e=>e.id==a).forEach(e=>e.set("visible",!0))),u.requestRenderAll()})}(i.id),function(a){l.find("#palleon-layers #"+a).find("a.lock-layer").on("click",function(a){a.preventDefault();var n=u.getActiveObject();e(this).hasClass("layer-unlocked")?(e(this).removeClass("layer-unlocked"),e(this).addClass("layer-locked"),e(this).html("lock"),n.set({lockMovementX:!0,lockMovementY:!0,lockRotation:!0,selectable:!1})):e(this).hasClass("layer-locked")&&(e(this).removeClass("layer-locked"),e(this).addClass("layer-unlocked"),e(this).html("lock_open"),n.set({lockMovementX:!1,lockMovementY:!1,lockRotation:!1,selectable:!0})),u.requestRenderAll()})}(i.id),function(a){l.find("#palleon-layers #"+a).on("click",function(a){var n=u.getObjects(),t=e(this).attr("id");n.filter(e=>e.id==t).forEach(e=>u.setActiveObject(e)),l.find("#palleon-layers > li").removeClass("active"),e(this).addClass("active"),u.requestRenderAll()})}(i.id),l.find("#palleon-layers").sortable("refresh"),L()}}),u.on("object:modified",function(e){var a=e.target;"textbox"==a.objectType&&a.id&&(l.find("#palleon-layers #"+a.id+" .layer-name").html(a.text),l.find("#text-rotate").val(parseInt(u.getActiveObject().angle)),l.find("#text-rotate").parent().parent().find(".slider-label span").html(parseInt(u.getActiveObject().angle))),"image"==a.objectType&&a.id&&(l.find("#img-rotate").val(parseInt(u.getActiveObject().angle)),l.find("#img-rotate").parent().parent().find(".slider-label span").html(parseInt(u.getActiveObject().angle))),"element"==a.objectType&&a.id&&(l.find("#element-rotate").val(parseInt(u.getActiveObject().angle)),l.find("#element-rotate").parent().parent().find(".slider-label span").html(parseInt(u.getActiveObject().angle))),P.includes(a.objectType)&&a.id&&(l.find("#shape-rotate").val(parseInt(u.getActiveObject().angle)),l.find("#shape-rotate").parent().parent().find(".slider-label span").html(parseInt(u.getActiveObject().angle))),"clipPath"==a.objectType&&(a.lockScalingX=!1,a.lockScalingY=!1,a.lockMovementX=!1,a.lockMovementY=!1)}),l.find(".palleon-horizontal-center").on("click",function(){var e=u.getActiveObject();e.set("originX","center"),e.set("left",Z()[0]/2),u.requestRenderAll()}),l.find(".palleon-vertical-center").on("click",function(){var e=u.getActiveObject();e.set("originY","center"),e.set("top",Z()[1]/2),u.requestRenderAll()}),u.on("selection:created",function(e){W(e.selected)}),u.on("selection:updated",function(e){W(e.selected),l.find("#palleon-font-family").trigger("change")}),u.on("selection:cleared",function(){l.find("#palleon-text-settings").hide(),l.find("#palleon-image-settings").hide(),l.find("#palleon-shape-settings").hide(),l.find("#palleon-custom-element-options").hide(),l.find("#palleon-custom-element-options-info").show(),l.find("#palleon-layers > li").removeClass("active")}),l.find("#palleon-layers").sortable({placeholder:"layer-placeholder",axis:"y",update:function(a,n){var l=u.getObjects();e("#palleon-layers li").each(function(a,n){e(this).attr("data-sort",a+1),l.filter(e=>e.id==n.id).forEach(e=>e.moveTo(-(a+1)))}),u.requestRenderAll()},create:function(e,a){L()}}).disableSelection(),l.find("#palleon-layers").on("click",".layer-settings",function(){var a=e(this).next();e(this).hasClass("active")?(e(this).removeClass("active"),a.hide()):(l.find("#palleon-layers .layer-icons").hide(),l.find("#palleon-layers .layer-settings").removeClass("active"),e(this).addClass("active"),a.show())}),l.find("#palleon-layer-delete").on("click",function(){if(window.confirm(palleonParams.answer4)){var e=l.find("#palleon-layer-select").val(),a=u.getObjects();"all"==e?(a.forEach(e=>u.remove(e)),l.find("#palleon-layers > li").remove()):(a.filter(a=>a.objectType==e).forEach(e=>u.remove(e)),l.find("#palleon-layers > li.layer-"+e).remove()),u.requestRenderAll(),l.find("#palleon-layers").sortable("refresh"),L()}}),l.find("#palleon-img-drag").on("click",function(){e(this).hasClass("active")?(e(this).removeClass("active"),l.find("#palleon-canvas-overlay").hide(),l.find("#palleon-canvas-wrap").draggable("disable")):(e(this).addClass("active"),l.find("#palleon-canvas-overlay").show(),l.find("#palleon-canvas-wrap").draggable("enable"))}),l.find(".palleon-counter input.palleon-form-field").on("input",function(){_(parseInt(e(this).val()))});var H=function(e){l.find("#palleon-resize-width").val(Math.round(e.width)),l.find("#palleon-resize-height").val(Math.round(e.height)),l.find("#palleon-img-width").html(Math.round(e.width)),l.find("#palleon-img-height").html(Math.round(e.height)),l.find("#palleon-crop-width").val(Math.round(e.width/2)),l.find("#palleon-crop-height").val(Math.round(e.height/2)),"image"==o?(l.find("#palleon-resize-width").data("max",Math.round(e.width)),l.find("#palleon-resize-height").data("max",Math.round(e.height)),l.find("#palleon-crop-width").data("max",Math.round(e.width)),l.find("#palleon-crop-height").data("max",Math.round(e.height))):(l.find("#palleon-resize-width").data("max",""),l.find("#palleon-resize-height").data("max",""))};function U(){var e=u.getObjects();e.filter(e=>"BG"!=e.objectType).forEach(e=>e.set("visible",!1)),u.backgroundColor="transparent";var a=T(u.toDataURL({format:"png",enableRetinaScaling:!1}));s=URL.createObjectURL(a),l.find("#palleon-canvas-img").attr("src",s),u.backgroundColor=l.find("#custom-image-background").val(),e.filter(e=>"BG"!=e.objectType).forEach(e=>e.set("visible",!0))}function N(){var e=u.getObjects();v.moveTo(9999),u.setActiveObject(v),l.find("#palleon-crop-btns").removeClass("disabled"),l.find(".palleon-icon-panel-content ul.palleon-accordion > li, #palleon-icon-menu, #palleon-top-bar, #palleon-right-col").css("pointer-events","none"),l.find(".palleon-icon-panel-content ul.palleon-accordion > li.accordion-crop").css("pointer-events","auto"),e.filter(e=>"clipPath"!=e.objectType&&"BG"!=e.objectType).forEach(e=>e.set("selectable",!1))}function V(e){0==p||180==p||-180==p?(u.setDimensions({width:c,height:d}),f=u.height/r.width,g=u.width/r.height):(u.setDimensions({width:d,height:c}),f=u.width/r.width,g=u.height/r.height),"right"==e?0==p?(p=90,m="left",h="bottom"):90==p?(p=180,m="right",h="bottom"):180==p?(p=270,m="right",h="top"):270==p?(p=0,m="left",h="top"):-90==p?(p=0,m="left",h="top"):-180==p?(p=-90,m="right",h="top"):-270==p&&(p=-180,m="right",h="bottom"):"left"==e&&(0==p?(p=-90,m="right",h="top"):-90==p?(p=-180,m="right",h="bottom"):-180==p?(p=-270,m="left",h="bottom"):-270==p?(p=0,m="left",h="top"):90==p?(p=0,m="left",h="top"):180==p?(p=90,m="left",h="bottom"):270==p&&(p=180,m="right",h="bottom")),u.backgroundImage.set({scaleX:f,scaleY:g,angle:p,originX:m,originY:h}),H(u),_(),u.requestRenderAll(),u.fire("palleon:history",{type:"BG",text:palleonParams.rotated})}l.find("#palleon-crop-style").on("change",function(){if(""!=e(this).val()&&e(this).select2("enable",!1),"freeform"==e(this).val())(v=new fabric.Rect({fill:"rgba(156, 39, 176, 0.3)",width:d/2,height:c/2,excludeFromExport:!0,objectType:"clipPath"})).controls={...fabric.Rect.prototype.controls,mtr:new fabric.Control({visible:!1})},u.add(v),N();else if("custom"==e(this).val()){l.find(".crop-custom").css("display","flex");var a=parseInt(l.find("#palleon-crop-width").val()),n=parseInt(l.find("#palleon-crop-height").val());(v=new fabric.Rect({fill:"rgba(156, 39, 176, 0.3)",width:a,height:n,excludeFromExport:!0,objectType:"clipPath"})).controls={...fabric.Rect.prototype.controls,mtr:new fabric.Control({visible:!1}),ml:new fabric.Control({visible:!1}),mb:new fabric.Control({visible:!1}),mr:new fabric.Control({visible:!1}),mt:new fabric.Control({visible:!1}),tl:new fabric.Control({visible:!1}),bl:new fabric.Control({visible:!1}),tr:new fabric.Control({visible:!1}),br:new fabric.Control({visible:!1})},u.add(v),N()}else if("square"==e(this).val()){var t=c/2;d>=c&&(t=d/2),(v=new fabric.Rect({fill:"rgba(156, 39, 176, 0.3)",width:t,height:t,excludeFromExport:!0,objectType:"clipPath"})).controls={...fabric.Rect.prototype.controls,mtr:new fabric.Control({visible:!1}),ml:new fabric.Control({visible:!1}),mb:new fabric.Control({visible:!1}),mr:new fabric.Control({visible:!1}),mt:new fabric.Control({visible:!1})},u.add(v),N()}else if("original"==e(this).val())(v=new fabric.Rect({fill:"rgba(156, 39, 176, 0.3)",width:d/2,height:c/2,excludeFromExport:!0,objectType:"clipPath"})).controls={...fabric.Rect.prototype.controls,mtr:new fabric.Control({visible:!1}),ml:new fabric.Control({visible:!1}),mb:new fabric.Control({visible:!1}),mr:new fabric.Control({visible:!1}),mt:new fabric.Control({visible:!1})},u.add(v),N();else{u.getObjects().filter(e=>"clipPath"!=e.objectType&&"BG"!=e.objectType&&"drawing"!=e.objectType).forEach(e=>e.set("selectable",!0)),l.find(".crop-custom").css("display","none"),l.find("#palleon-crop-btns").addClass("disabled"),l.find(".palleon-icon-panel-content ul.palleon-accordion > li, #palleon-icon-menu, #palleon-top-bar, #palleon-right-col").css("pointer-events","auto")}}),l.find("#palleon-crop-cancel").on("click",function(){l.find("#palleon-crop-btns").addClass("disabled"),l.find("#palleon-crop-style").select2("enable"),l.find("#palleon-crop-style").val(""),l.find("#palleon-crop-style").trigger("change"),u.remove(""),u.remove(v)}),l.find("#palleon-crop-apply").on("click",function(){if(window.confirm(palleonParams.answer5)){l.find("#palleon-crop-btns").addClass("disabled"),l.find("#palleon-crop-style").select2("enable"),l.find("#palleon-crop-style").val(""),l.find("#palleon-crop-style").trigger("change"),u.setZoom(1),l.find("#palleon-img-zoom").val(100);var e=v.getBoundingRect();u.setWidth(e.width-1),u.setHeight(e.height-1),u.backgroundImage.set({top:-e.top,left:-e.left}),u.remove(""),u.remove(v),U(),l.find("#palleon-canvas-img-wrap").imagesLoaded(function(){d=u.width,c=u.height,p=0,m="left",h="top",f=1,g=1,G(),H(u),_(),u.requestRenderAll()})}}),l.find("#palleon-crop-width").bind("input paste",function(){if(l.find("#palleon-crop-lock").hasClass("active")){var a=e(this).data("max")/l.find("#palleon-crop-height").data("max");l.find("#palleon-crop-height").val(Math.round(this.value/a))}v.set("width",parseInt(e(this).val())),v.set("height",parseInt(l.find("#palleon-crop-height").val())),u.requestRenderAll()}),l.find("#palleon-crop-height").bind("input paste",function(){if(l.find("#palleon-crop-lock").hasClass("active")){var a=e(this).data("max")/l.find("#palleon-crop-width").data("max");l.find("#palleon-crop-width").val(Math.round(this.value/a))}v.set("height",parseInt(e(this).val())),v.set("width",parseInt(l.find("#palleon-crop-width").val())),u.requestRenderAll()}),l.find("#palleon-resize-apply").on("click",function(){var e,a;window.confirm(palleonParams.answer6)&&(e=parseInt(l.find("#palleon-resize-width").val()),a=parseInt(l.find("#palleon-resize-height").val()),d=e,c=a,u.setZoom(1),l.find("#palleon-img-zoom").val(100),u.setWidth(e),u.setHeight(a),0==p||180==p||-180==p?(f=u.width/l.find("#palleon-canvas-img")[0].width,g=u.height/l.find("#palleon-canvas-img")[0].height):(f=u.height/l.find("#palleon-canvas-img")[0].width,g=u.width/l.find("#palleon-canvas-img")[0].height),u.backgroundImage.set({scaleX:f,scaleY:g}),U(),l.find("#palleon-canvas-img-wrap").imagesLoaded(function(){d=u.width,c=u.height,p=0,m="left",h="top",f=1,g=1,G(),H(u),_(),u.requestRenderAll()}))}),l.find("#palleon-resize-width").bind("input paste",function(){if(l.find("#palleon-resize-lock").hasClass("active")){var a=e(this).data("max")/l.find("#palleon-resize-height").data("max");l.find("#palleon-resize-height").val(Math.round(this.value/a))}}),l.find("#palleon-resize-height").bind("input paste",function(){if(l.find("#palleon-resize-lock").hasClass("active")){var a=e(this).data("max")/l.find("#palleon-resize-width").data("max");l.find("#palleon-resize-width").val(Math.round(this.value/a))}}),l.find("#palleon-rotate-right").on("click",function(){V("right")}),l.find("#palleon-rotate-left").on("click",function(){V("left")}),l.find("#palleon-flip-horizontal").on("click",function(){u.backgroundImage.toggle("flipX"),u.requestRenderAll(),u.fire("palleon:history",{type:"BG",text:palleonParams.flipped})}),l.find("#palleon-flip-vertical").on("click",function(){u.backgroundImage.toggle("flipY"),u.requestRenderAll(),u.fire("palleon:history",{type:"BG",text:palleonParams.flipped})}),l.find("#palleon-brightness").on("change",function(){e(this).is(":checked")?u.backgroundImage.filters.push(new fabric.Image.filters.Brightness):(l.find("#brightness").val(0),l.find("#brightness").parent().parent().find(".slider-label span").html(0),u.backgroundImage.filters=u.backgroundImage.filters.filter(e=>"Brightness"!=e.type),u.backgroundImage.applyFilters()),u.requestRenderAll()}),l.find("#brightness").on("input",function(){u.backgroundImage.filters.filter(e=>"Brightness"==e.type).forEach(e=>e.brightness=parseFloat(this.value)),u.backgroundImage.applyFilters(),u.requestRenderAll()}),l.find("#brightness").on("change",function(e){e.originalEvent&&M(palleonParams.bg+" "+palleonParams.edited)}),l.find("#palleon-contrast").on("change",function(){e(this).is(":checked")?u.backgroundImage.filters.push(new fabric.Image.filters.Contrast):(l.find("#contrast").val(0),l.find("#contrast").parent().parent().find(".slider-label span").html(0),u.backgroundImage.filters=u.backgroundImage.filters.filter(e=>"Contrast"!=e.type),u.backgroundImage.applyFilters()),u.requestRenderAll()}),l.find("#contrast").on("input",function(){u.backgroundImage.filters.filter(e=>"Contrast"==e.type).forEach(e=>e.contrast=parseFloat(this.value)),u.backgroundImage.applyFilters(),u.requestRenderAll()}),l.find("#contrast").on("change",function(e){e.originalEvent&&M(palleonParams.bg+" "+palleonParams.edited)}),l.find("#palleon-saturation").on("change",function(){e(this).is(":checked")?u.backgroundImage.filters.push(new fabric.Image.filters.Saturation):(l.find("#saturation").val(0),l.find("#saturation").parent().parent().find(".slider-label span").html(0),u.backgroundImage.filters=u.backgroundImage.filters.filter(e=>"Saturation"!=e.type),u.backgroundImage.applyFilters()),u.requestRenderAll()}),l.find("#saturation").on("input",function(){u.backgroundImage.filters.filter(e=>"Saturation"==e.type).forEach(e=>e.saturation=parseFloat(this.value)),u.backgroundImage.applyFilters(),u.requestRenderAll()}),l.find("#saturation").on("change",function(e){e.originalEvent&&M(palleonParams.bg+" "+palleonParams.edited)}),l.find("#palleon-hue").on("change",function(){e(this).is(":checked")?u.backgroundImage.filters.push(new fabric.Image.filters.HueRotation):(l.find("#hue").val(0),l.find("#hue").parent().parent().find(".slider-label span").html(0),u.backgroundImage.filters=u.backgroundImage.filters.filter(e=>"HueRotation"!=e.type),u.backgroundImage.applyFilters()),u.requestRenderAll()}),l.find("#hue").on("input",function(){u.backgroundImage.filters.filter(e=>"HueRotation"==e.type).forEach(e=>e.rotation=parseFloat(this.value)),u.backgroundImage.applyFilters(),u.requestRenderAll()}),l.find("#hue").on("change",function(e){e.originalEvent&&M(palleonParams.bg+" "+palleonParams.edited)}),l.find("#palleon-filters input[type=checkbox]").on("change",function(a){e(this).is(":checked")?"grayscale"==e(this).attr("id")?u.backgroundImage.filters.push(new fabric.Image.filters.Grayscale):"sepia"==e(this).attr("id")?u.backgroundImage.filters.push(new fabric.Image.filters.Sepia):"blackwhite"==e(this).attr("id")?u.backgroundImage.filters.push(new fabric.Image.filters.BlackWhite):"brownie"==e(this).attr("id")?u.backgroundImage.filters.push(new fabric.Image.filters.Brownie):"vintage"==e(this).attr("id")?u.backgroundImage.filters.push(new fabric.Image.filters.Vintage):"kodachrome"==e(this).attr("id")?u.backgroundImage.filters.push(new fabric.Image.filters.Kodachrome):"technicolor"==e(this).attr("id")?u.backgroundImage.filters.push(new fabric.Image.filters.Technicolor):"polaroid"==e(this).attr("id")?u.backgroundImage.filters.push(new fabric.Image.filters.Polaroid):"shift"==e(this).attr("id")?u.backgroundImage.filters.push(new fabric.Image.filters.Shift):"invert"==e(this).attr("id")?u.backgroundImage.filters.push(new fabric.Image.filters.Invert):"sharpen"==e(this).attr("id")?(l.find("#emboss").prop("checked",!1),l.find("#sobelX").prop("checked",!1),l.find("#sobelY").prop("checked",!1),u.backgroundImage.filters=u.backgroundImage.filters.filter(e=>"Convolute"!=e.type),u.backgroundImage.filters.push(new fabric.Image.filters.Convolute({matrix:[0,-1,0,-1,5,-1,0,-1,0]}))):"emboss"==e(this).attr("id")?(l.find("#sharpen").prop("checked",!1),l.find("#sobelX").prop("checked",!1),l.find("#sobelY").prop("checked",!1),u.backgroundImage.filters=u.backgroundImage.filters.filter(e=>"Convolute"!=e.type),u.backgroundImage.filters.push(new fabric.Image.filters.Convolute({matrix:[1,1,1,1,.7,-1,-1,-1,-1]}))):"sobelX"==e(this).attr("id")?(l.find("#emboss").prop("checked",!1),l.find("#sharpen").prop("checked",!1),l.find("#sobelY").prop("checked",!1),u.backgroundImage.filters=u.backgroundImage.filters.filter(e=>"Convolute"!=e.type),u.backgroundImage.filters.push(new fabric.Image.filters.Convolute({matrix:[-1,0,1,-2,0,2,-1,0,1]}))):"sobelY"==e(this).attr("id")&&(l.find("#emboss").prop("checked",!1),l.find("#sharpen").prop("checked",!1),l.find("#sobelX").prop("checked",!1),u.backgroundImage.filters=u.backgroundImage.filters.filter(e=>"Convolute"!=e.type),u.backgroundImage.filters.push(new fabric.Image.filters.Convolute({matrix:[-1,-2,-1,0,0,0,1,2,1]}))):"grayscale"==e(this).attr("id")?u.backgroundImage.filters=u.backgroundImage.filters.filter(e=>"Grayscale"!=e.type):"sepia"==e(this).attr("id")?u.backgroundImage.filters=u.backgroundImage.filters.filter(e=>"Sepia"!=e.type):"blackwhite"==e(this).attr("id")?u.backgroundImage.filters=u.backgroundImage.filters.filter(e=>"BlackWhite"!=e.type):"brownie"==e(this).attr("id")?u.backgroundImage.filters=u.backgroundImage.filters.filter(e=>"Brownie"!=e.type):"vintage"==e(this).attr("id")?u.backgroundImage.filters=u.backgroundImage.filters.filter(e=>"Vintage"!=e.type):"kodachrome"==e(this).attr("id")?u.backgroundImage.filters=u.backgroundImage.filters.filter(e=>"Kodachrome"!=e.type):"technicolor"==e(this).attr("id")?u.backgroundImage.filters=u.backgroundImage.filters.filter(e=>"Technicolor"!=e.type):"polaroid"==e(this).attr("id")?u.backgroundImage.filters=u.backgroundImage.filters.filter(e=>"Polaroid"!=e.type):"shift"==e(this).attr("id")?u.backgroundImage.filters=u.backgroundImage.filters.filter(e=>"Shift"!=e.type):"invert"==e(this).attr("id")?u.backgroundImage.filters=u.backgroundImage.filters.filter(e=>"Invert"!=e.type):"sharpen"==e(this).attr("id")?(l.find("#emboss").prop("checked",!1),l.find("#sobelX").prop("checked",!1),l.find("#sobelY").prop("checked",!1),u.backgroundImage.filters=u.backgroundImage.filters.filter(e=>"Convolute"!=e.type)):"emboss"==e(this).attr("id")?(l.find("#sharpen").prop("checked",!1),l.find("#sobelX").prop("checked",!1),l.find("#sobelY").prop("checked",!1),u.backgroundImage.filters=u.backgroundImage.filters.filter(e=>"Convolute"!=e.type)):"sobelX"==e(this).attr("id")?(l.find("#emboss").prop("checked",!1),l.find("#sharpen").prop("checked",!1),l.find("#sobelY").prop("checked",!1),u.backgroundImage.filters=u.backgroundImage.filters.filter(e=>"Convolute"!=e.type)):"sobelY"==e(this).attr("id")&&(l.find("#emboss").prop("checked",!1),l.find("#sharpen").prop("checked",!1),l.find("#sobelX").prop("checked",!1),u.backgroundImage.filters=u.backgroundImage.filters.filter(e=>"Convolute"!=e.type)),u.backgroundImage.applyFilters(),u.requestRenderAll(),a.originalEvent&&M(palleonParams.bg+" "+palleonParams.edited)}),l.find("#palleon-gamma").on("change",function(){e(this).is(":checked")?u.backgroundImage.filters.push(new fabric.Image.filters.Gamma):(l.find("#gamma-red").val(1),l.find("#gamma-red").parent().parent().find(".slider-label span").html(1),l.find("#gamma-green").val(1),l.find("#gamma-green").parent().parent().find(".slider-label span").html(1),l.find("#gamma-blue").val(1),l.find("#gamma-blue").parent().parent().find(".slider-label span").html(1),u.backgroundImage.filters=u.backgroundImage.filters.filter(e=>"Gamma"!=e.type),u.backgroundImage.applyFilters()),u.requestRenderAll()}),l.find("#palleon-gamma-settings input").on("input",function(){var a=[parseFloat(e("#gamma-red").val()),parseFloat(e("#gamma-green").val()),parseFloat(e("#gamma-blue").val())];u.backgroundImage.filters.filter(e=>"Gamma"==e.type).forEach(e=>e.gamma=a),u.backgroundImage.applyFilters(),u.requestRenderAll()}),l.find("#palleon-gamma-settings input").on("change",function(e){e.originalEvent&&M(palleonParams.bg+" "+palleonParams.edited)}),l.find("#palleon-blur").on("change",function(){e(this).is(":checked")?u.backgroundImage.filters.push(new fabric.Image.filters.Blur):(l.find("#blur").val(0),l.find("#blur").parent().parent().find(".slider-label span").html(0),u.backgroundImage.filters=u.backgroundImage.filters.filter(e=>"Blur"!=e.type),u.backgroundImage.applyFilters()),u.requestRenderAll()}),l.find("#blur").on("change",function(e){u.backgroundImage.filters.filter(e=>"Blur"==e.type).forEach(e=>e.blur=parseFloat(this.value)),u.backgroundImage.applyFilters(),u.requestRenderAll(),e.originalEvent&&M(palleonParams.bg+" "+palleonParams.edited)}),l.find("#palleon-noise").on("change",function(){e(this).is(":checked")?u.backgroundImage.filters.push(new fabric.Image.filters.Noise):(l.find("#noise").val(0),l.find("#noise").parent().parent().find(".slider-label span").html(0),u.backgroundImage.filters=u.backgroundImage.filters.filter(e=>"Noise"!=e.type),u.backgroundImage.applyFilters()),u.requestRenderAll()}),l.find("#noise").on("input",function(){u.backgroundImage.filters.filter(e=>"Noise"==e.type).forEach(e=>e.noise=parseInt(this.value,10)),u.backgroundImage.applyFilters(),u.requestRenderAll()}),l.find("#noise").on("change",function(e){e.originalEvent&&M(palleonParams.bg+" "+palleonParams.edited)}),l.find("#palleon-pixelate").on("change",function(){e(this).is(":checked")?u.backgroundImage.filters.push(new fabric.Image.filters.Pixelate):(l.find("#pixelate").val(1),l.find("#pixelate").parent().parent().find(".slider-label span").html(1),u.backgroundImage.filters=u.backgroundImage.filters.filter(e=>"Pixelate"!=e.type),u.backgroundImage.applyFilters()),u.requestRenderAll()}),l.find("#pixelate").on("change",function(e){u.backgroundImage.filters.filter(e=>"Pixelate"==e.type).forEach(e=>e.blocksize=parseInt(this.value,10)),u.backgroundImage.applyFilters(),u.requestRenderAll(),e.originalEvent&&M(palleonParams.bg+" "+palleonParams.edited)}),l.find("#palleon-blend-color").on("change",function(){if(e(this).is(":checked")){var a=l.find("#blend-color-mode").val(),n=l.find("#blend-color-color").val(),t=parseFloat(l.find("#blend-color-alpha").val());u.backgroundImage.filters.push(new fabric.Image.filters.BlendColor),u.backgroundImage.filters.filter(e=>"BlendColor"==e.type).forEach(e=>e.mode=a,e=>e.color=n,e=>e.alpha=parseFloat(t))}else l.find("#blend-color-mode").val("add"),l.find("#blend-color-color").spectrum("set","#ffffff"),l.find("#blend-color-alpha").val(.5),l.find("#blend-color-alpha").parent().parent().find(".slider-label span").html(.5),u.backgroundImage.filters=u.backgroundImage.filters.filter(e=>"BlendColor"!=e.type);u.backgroundImage.applyFilters(),u.requestRenderAll()}),l.find("#blend-color-mode").on("change",function(){u.backgroundImage.filters.filter(e=>"BlendColor"==e.type).forEach(e=>e.mode=this.value),u.backgroundImage.applyFilters(),u.requestRenderAll()}),l.find("#blend-color-color").on("change",function(){u.backgroundImage.filters.filter(e=>"BlendColor"==e.type).forEach(e=>e.color=this.value),u.backgroundImage.applyFilters(),u.requestRenderAll()}),l.find("#blend-color-alpha").on("input",function(){u.backgroundImage.filters.filter(e=>"BlendColor"==e.type).forEach(e=>e.alpha=parseFloat(this.value)),u.backgroundImage.applyFilters(),u.requestRenderAll()}),l.find("#palleon-duotone-color").on("change",function(){e(this).is(":checked")?(w=new fabric.Image.filters.Composed({subFilters:[new fabric.Image.filters.Grayscale({mode:"luminosity"}),new fabric.Image.filters.BlendColor({color:l.find("#duotone-light-color").val()}),new fabric.Image.filters.BlendColor({color:l.find("#duotone-dark-color").val(),mode:"lighten"})]}),u.backgroundImage.filters.push(w)):(l.find("#duotone-light-color").spectrum("set","green"),l.find("#duotone-dark-color").spectrum("set","blue"),u.backgroundImage.filters=u.backgroundImage.filters.filter(e=>"Composed"!=e.type)),u.backgroundImage.applyFilters(),u.requestRenderAll()}),l.find("#duotone-light-color").on("change",function(){u.backgroundImage.filters=u.backgroundImage.filters.filter(e=>"Composed"!=e.type),u.backgroundImage.filters.push(w),w.subFilters[1].color=e(this).val(),u.backgroundImage.applyFilters(),u.requestRenderAll()}),l.find("#duotone-dark-color").on("change",function(){u.backgroundImage.filters=u.backgroundImage.filters.filter(e=>"Composed"!=e.type),u.backgroundImage.filters.push(w),w.subFilters[2].color=e(this).val(),u.backgroundImage.applyFilters(),u.requestRenderAll()}),l.find("#palleon-swap-apply").on("click",function(){var a=new fabric.Image.filters.SwapColor({colorSource:l.find("#color-source").val(),colorDestination:l.find("#color-destination").val()});u.backgroundImage.filters.push(a),u.backgroundImage.applyFilters(),u.requestRenderAll(),e(this).prop("disabled",!0),l.find("#palleon-swap-remove").prop("disabled",!1)}),l.find("#palleon-swap-remove").on("click",function(){u.backgroundImage.filters=u.backgroundImage.filters.filter(e=>"SwapColor"!=e.type),u.backgroundImage.applyFilters(),u.requestRenderAll(),e(this).prop("disabled",!0),l.find("#palleon-swap-apply").prop("disabled",!1)}),l.find("#palleon-swap-colors").on("change",function(){e(this).is(":checked")||l.find("#palleon-swap-remove").trigger("click")});function J(e){var a=u.getActiveObject();a.set("gradientFill",l.find("#palleon-"+e+"-gradient").val());var n="";if(""==l.find("#"+e+"-gradient-color-3").val()&&""==l.find("#"+e+"-gradient-color-4").val()?n=[{offset:0,color:l.find("#"+e+"-gradient-color-1").val()},{offset:1,color:l.find("#"+e+"-gradient-color-2").val()}]:""!=l.find("#"+e+"-gradient-color-3").val()&&""==l.find("#"+e+"-gradient-color-4").val()?n=[{offset:0,color:l.find("#"+e+"-gradient-color-1").val()},{offset:.5,color:l.find("#"+e+"-gradient-color-2").val()},{offset:1,color:l.find("#"+e+"-gradient-color-3").val()}]:""!=l.find("#"+e+"-gradient-color-1").val()&&""!=l.find("#"+e+"-gradient-color-2").val()&&""!=l.find("#"+e+"-gradient-color-3").val()&&""!=l.find("#"+e+"-gradient-color-4").val()&&(n=[{offset:0,color:l.find("#"+e+"-gradient-color-1").val()},{offset:.25,color:l.find("#"+e+"-gradient-color-2").val()},{offset:.75,color:l.find("#"+e+"-gradient-color-3").val()},{offset:1,color:l.find("#"+e+"-gradient-color-4").val()}]),"vertical"==l.find("#palleon-"+e+"-gradient").val()){if(l.find("#"+e+"-gradient-settings").show(),l.find("#"+e+"-fill-color").hide(),a.set("fill",new fabric.Gradient({type:"linear",gradientUnits:"percentage",coords:{x1:0,y1:0,x2:0,y2:1},colorStops:n})),"element"==a.objectType&&a._objects)for(var t=0;t<a._objects.length;t++)""!=a._objects[t].fill&&a._objects[t].set({fill:new fabric.Gradient({type:"linear",gradientUnits:"percentage",coords:{x1:0,y1:0,x2:0,y2:1},colorStops:n})})}else if("horizontal"==l.find("#palleon-"+e+"-gradient").val()){if(l.find("#"+e+"-gradient-settings").show(),l.find("#"+e+"-fill-color").hide(),a.set("fill",new fabric.Gradient({type:"linear",gradientUnits:"percentage",coords:{x1:0,y1:0,x2:1,y2:0},colorStops:n})),"element"==a.objectType&&a._objects)for(t=0;t<a._objects.length;t++)""!=a._objects[t].fill&&a._objects[t].set({fill:new fabric.Gradient({type:"linear",gradientUnits:"percentage",coords:{x1:0,y1:0,x2:1,y2:0},colorStops:n})})}else if(l.find("#"+e+"-gradient-settings").hide(),l.find("#"+e+"-fill-color").show(),a.set("fill",l.find("#palleon-"+e+"-color").val()),"element"==a.objectType&&a._objects)for(t=0;t<a._objects.length;t++)""!=a._objects[t].fill&&a._objects[t].set("fill",l.find("#palleon-"+e+"-color").val());u.requestRenderAll()}e.each(["text","image","shape","element"],function(a,n){l.find("#palleon-"+n+"-shadow").on("change",function(){var a=new fabric.Shadow({color:l.find("#"+n+"-shadow-color").val(),blur:l.find("#"+n+"-shadow-blur").val(),offsetX:l.find("#"+n+"-shadow-offset-x").val(),offsetY:l.find("#"+n+"-shadow-offset-y").val()});e(this).is(":checked")?u.getActiveObject().shadow=a:u.getActiveObject().shadow=null,u.requestRenderAll()}),l.find("#"+n+"-shadow-color").bind("change",function(){u.getActiveObject().shadow.color=e(this).val(),u.requestRenderAll()}),l.find("#"+n+"-shadow-settings input[type=number]").bind("input paste keyup keydown",function(){var a=e(this).val();e(this).attr("id")==n+"-shadow-blur"?u.getActiveObject().shadow.blur=parseInt(a):e(this).attr("id")==n+"-shadow-offset-x"?u.getActiveObject().shadow.offsetX=parseInt(a):e(this).attr("id")==n+"-shadow-offset-y"&&(u.getActiveObject().shadow.offsetY=parseInt(a)),u.requestRenderAll()})});function Z(){var e=u.backgroundImage.getScaledHeight(),a=u.backgroundImage.getScaledWidth();return 0!=p&&180!=p&&-180!=p||(e=u.backgroundImage.getScaledWidth(),a=u.backgroundImage.getScaledHeight()),[e,a]}function $(a){var n=a.element;return e(n).data("icon")?e('<div class="select2-item"><span class="material-icons">'+e(n).data("icon")+"</span>"+a.text+"</div>"):e('<div class="select2-item">'+a.text+"</div>")}e.each(["text","shape","element"],function(e,a){l.find("#palleon-"+a+"-gradient").on("change",function(){J(a)}),l.find("#"+a+"-gradient-color-1").on("change",function(){J(a)}),l.find("#"+a+"-gradient-color-2").on("change",function(){J(a)}),l.find("#"+a+"-gradient-color-3").on("change",function(){J(a)}),l.find("#"+a+"-gradient-color-4").on("change",function(){J(a)})}),l.find("#palleon-add-text").on("click",function(){var e=new fabric.Textbox(palleonParams.textbox,{objectType:"textbox",gradientFill:"none",fontSize:i.fontSize,fontFamily:i.fontFamily,fontWeight:i.fontWeight,fontStyle:i.fontStyle,lineHeight:i.lineHeight,fill:i.fill,stroke:i.stroke,strokeWidth:i.strokeWidth,textBackgroundColor:i.textBackgroundColor,textAlign:i.textAlign,width:Z()[0]/2,top:Z()[1]/2,left:Z()[0]/2,originX:"center",originY:"center"});u.add(e),u.setActiveObject(e),u.fire("palleon:history",{type:"textbox",text:palleonParams.added})}),l.find("#palleon-text-input").bind("input paste",function(){u.getActiveObject().set("text",e(this).val()),l.find("#palleon-layers #"+u.getActiveObject().id+" .layer-name").html(u.getActiveObject().text),u.requestRenderAll()}),l.find("#palleon-text-input").bind("focusout",function(){u.fire("palleon:history",{type:"textbox",text:palleonParams.edited})}),l.find("#palleon-font-family").on("change",function(){for(var a=e(this).val(),n="yes",l=0;l<I.length;l++)if(I[l][1]==a){n="no";break}if("yes"==n){"undefined"==typeof palleonCustomFonts?WebFont.load({google:{families:[a+":regular,bold",a+":italic,regular,bold"]}}):palleonCustomFonts.fonts.includes(a)||WebFont.load({google:{families:[a+":regular,bold",a+":italic,regular,bold"]}});var t=new FontFaceObserver(a,{weight:"normal",style:"normal"}),i=new FontFaceObserver(a,{weight:"bold",style:"normal"}),o=new FontFaceObserver(a,{weight:"normal",style:"italic"}),r=new FontFaceObserver(a,{weight:"bold",style:"italic"});Promise.all([t.load(null,5e3),i.load(null,5e3),o.load(null,5e3),r.load(null,5e3)]).then(function(){u.getActiveObject().set("fontFamily",a),u.requestRenderAll()}).catch(function(e){console.log(e)})}else u.getActiveObject().set("fontFamily",a),u.requestRenderAll()}),l.find("#palleon-text-format-btns > .palleon-btn").on("click",function(){e(this).hasClass("active")?("format-bold"==e(this).attr("id")&&(u.getActiveObject().set("fontWeight","normal"),e(this).removeClass("active")),"format-italic"==e(this).attr("id")&&(u.getActiveObject().set("fontStyle","normal"),e(this).removeClass("active")),"format-underlined"==e(this).attr("id")&&(u.getActiveObject().set("underline",!1),e(this).removeClass("active"))):("format-bold"==e(this).attr("id")&&u.getActiveObject().set("fontWeight","bold"),"format-italic"==e(this).attr("id")&&u.getActiveObject().set("fontStyle","italic"),"format-underlined"==e(this).attr("id")&&u.getActiveObject().set("underline",!0),"format-align-left"==e(this).attr("id")&&u.getActiveObject().set("textAlign","left"),"format-align-right"==e(this).attr("id")&&u.getActiveObject().set("textAlign","right"),"format-align-center"==e(this).attr("id")&&u.getActiveObject().set("textAlign","center"),"format-align-justify"==e(this).attr("id")&&u.getActiveObject().set("textAlign","justify"),l.find(".format-align").removeClass("active"),e(this).addClass("active")),u.requestRenderAll(),u.fire("palleon:history",{type:"textbox",text:palleonParams.edited})}),l.find("#palleon-text-settings input[type=number]").bind("input paste keyup keydown",function(){var a=e(this).val();"palleon-font-size"==e(this).attr("id")?u.getActiveObject().set("fontSize",parseInt(a)):"palleon-outline-size"==e(this).attr("id")?u.getActiveObject().set("strokeWidth",parseInt(a)):"palleon-line-height"==e(this).attr("id")?u.getActiveObject().set("lineHeight",parseFloat(a)):"palleon-letter-spacing"==e(this).attr("id")&&u.getActiveObject().set("charSpacing",parseInt(a)),u.requestRenderAll()}),l.find("#palleon-text-settings input[type=number]").bind("input",function(){window.clearTimeout(x),x=setTimeout(function(){u.fire("palleon:history",{type:"textbox",text:palleonParams.edited})},500)}),l.find("#palleon-text-settings .palleon-colorpicker").bind("change",function(){var a=e(this).val();"palleon-text-color"==e(this).attr("id")?u.getActiveObject().set("fill",a):"palleon-outline-color"==e(this).attr("id")?u.getActiveObject().set("stroke",a):"palleon-text-background"==e(this).attr("id")&&u.getActiveObject().set("textBackgroundColor",a),u.requestRenderAll(),u.fire("palleon:history",{type:"textbox",text:palleonParams.edited})}),l.find("#palleon-text-flip-btns > .palleon-btn").on("click",function(){e(this).hasClass("active")?("text-flip-x"==e(this).attr("id")?u.getActiveObject().set("flipX",!1):"text-flip-y"==e(this).attr("id")&&u.getActiveObject().set("flipY",!1),e(this).removeClass("active")):("text-flip-x"==e(this).attr("id")?u.getActiveObject().set("flipX",!0):"text-flip-y"==e(this).attr("id")&&u.getActiveObject().set("flipY",!0),e(this).addClass("active")),u.requestRenderAll(),u.fire("palleon:history",{type:"textbox",text:palleonParams.edited})}),l.find("#palleon-text-settings input[type=range]").bind("input click",function(){var a=e(this).val();"text-skew-x"==e(this).attr("id")?u.getActiveObject().set("skewX",parseInt(a)):"text-skew-y"==e(this).attr("id")?u.getActiveObject().set("skewY",parseInt(a)):"text-rotate"==e(this).attr("id")?u.getActiveObject().set("angle",parseInt(a)):"text-opacity"==e(this).attr("id")&&u.getActiveObject().set("opacity",parseFloat(a)),u.requestRenderAll()}),l.find("#palleon-text-settings input[type=range]").bind("change",function(){u.fire("palleon:history",{type:"textbox",text:palleonParams.edited})}),l.find("#palleon-img-upload").on("change",function(e){var a=new FileReader;a.onload=function(e){var a=new Image;R(e.target.result,function(e){a.src=e,a.onload=function(){var e=new fabric.Image(a);e.set({objectType:"image",roundedCorders:0,stroke:"#fff",strokeWidth:0,top:Z()[1]/2,left:Z()[0]/2,originX:"center",originY:"center"}),u.add(e),e.scaleToWidth(Z()[0]/2),e.isPartiallyOnScreen()&&e.scaleToHeight(Z()[1]/2),u.setActiveObject(e),u.requestRenderAll()}})},a.readAsDataURL(e.target.files[0]),u.fire("palleon:history",{type:"image",text:palleonParams.added})}),l.find("#img-flip-horizontal").on("click",function(){u.getActiveObject().toggle("flipX"),u.requestRenderAll(),u.fire("palleon:history",{type:"image",text:palleonParams.edited})}),l.find("#img-flip-vertical").on("click",function(){u.getActiveObject().toggle("flipY"),u.requestRenderAll(),u.fire("palleon:history",{type:"image",text:palleonParams.edited})});l.find("#img-border-radius").on("input",function(){u.getActiveObject().set("clipPath",((e,a)=>new fabric.Rect({width:e.width,height:e.height,rx:a/e.scaleX,ry:a/e.scaleY,left:-e.width/2,top:-e.height/2}))(u.getActiveObject(),parseInt(e(this).val()))),u.getActiveObject().set("roundedCorders",parseInt(e(this).val())),u.requestRenderAll()}),l.find("#img-border-radius").bind("change",function(){u.fire("palleon:history",{type:"image",text:palleonParams.edited})}),l.find("#img-border-color").bind("change",function(){u.getActiveObject().set("stroke",e(this).val()),u.requestRenderAll(),u.fire("palleon:history",{type:"image",text:palleonParams.edited})}),l.find("#palleon-image-settings input[type=number]").on("input paste",function(){var a=parseInt(e(this).val());"img-border-width"==e(this).attr("id")&&u.getActiveObject().set("strokeWidth",a),u.requestRenderAll()}),l.find("#palleon-image-settings input[type=number]").bind("input",function(){window.clearTimeout(x),x=setTimeout(function(){u.fire("palleon:history",{type:"image",text:palleonParams.edited})},500)}),l.find("#palleon-image-settings input[type=range]").bind("input click",function(){var a=e(this).val();"img-skew-x"==e(this).attr("id")?u.getActiveObject().set("skewX",parseInt(a)):"img-skew-y"==e(this).attr("id")?u.getActiveObject().set("skewY",parseInt(a)):"img-rotate"==e(this).attr("id")?u.getActiveObject().set("angle",parseInt(a)):"img-opacity"==e(this).attr("id")&&u.getActiveObject().set("opacity",parseFloat(a)),u.requestRenderAll()}),l.find("#palleon-image-settings input[type=range]").bind("change",function(){u.fire("palleon:history",{type:"image",text:palleonParams.edited})}),l.find("#palleon-shape-select").on("change",function(){var a=e(this).val();"none"==a||"custom"==a?l.find("#palleon-shape-add").prop("disabled",!0):l.find("#palleon-shape-add").prop("disabled",!1)}),l.find("#palleon-shape-add").on("click",function(){var e=l.find("#palleon-shape-select").val(),a="",n="";"circle"==e?(a=new fabric.Circle({radius:50,fill:"#fff",stroke:"#000",strokeWidth:0,objectType:"circle",width:100,height:100,gradientFill:"none",top:Z()[1]/2,left:Z()[0]/2,originX:"center",originY:"center"})).controls={...fabric.Rect.prototype.controls,ml:new fabric.Control({visible:!1}),mb:new fabric.Control({visible:!1}),mr:new fabric.Control({visible:!1}),mt:new fabric.Control({visible:!1})}:"ellipse"==e?a=new fabric.Ellipse({rx:75,ry:50,fill:"#fff",stroke:"#000",strokeWidth:0,objectType:"ellipse",width:100,height:100,gradientFill:"none",top:Z()[1]/2,left:Z()[0]/2,originX:"center",originY:"center"}):"square"==e?(a=new fabric.Rect({radius:50,fill:"#fff",stroke:"#000",strokeWidth:0,objectType:"square",width:100,height:100,gradientFill:"none",top:Z()[1]/2,left:Z()[0]/2,originX:"center",originY:"center"})).controls={...fabric.Rect.prototype.controls,ml:new fabric.Control({visible:!1}),mb:new fabric.Control({visible:!1}),mr:new fabric.Control({visible:!1}),mt:new fabric.Control({visible:!1})}:"rectangle"==e?a=new fabric.Rect({radius:50,fill:"#fff",stroke:"#000",strokeWidth:0,objectType:"rectangle",width:200,height:150,gradientFill:"none",top:Z()[1]/2,left:Z()[0]/2,originX:"center",originY:"center"}):"triangle"==e?a=new fabric.Triangle({radius:50,fill:"#fff",stroke:"#000",strokeWidth:0,objectType:"triangle",width:100,height:100,gradientFill:"none",top:Z()[1]/2,left:Z()[0]/2,originX:"center",originY:"center"}):"trapezoid"==e?(n=[{x:-100,y:-50},{x:100,y:-50},{x:150,y:50},{x:-150,y:50}],a=new fabric.Polygon(n,{fill:"#fff",stroke:"#000",strokeWidth:0,objectType:"trapezoid",width:100,height:100,gradientFill:"none",top:Z()[1]/2,left:Z()[0]/2,originX:"center",originY:"center"})):"emerald"==e?(n=[{x:850,y:75},{x:958,y:137.5},{x:958,y:262.5},{x:850,y:325},{x:742,y:262.5},{x:742,y:137.5}],a=new fabric.Polygon(n,{fill:"#fff",stroke:"#000",strokeWidth:0,objectType:"emerald",width:100,height:100,gradientFill:"none",top:Z()[1]/2,left:Z()[0]/2,originX:"center",originY:"center"})):"star"==e&&(n=[{x:350,y:75},{x:380,y:160},{x:470,y:160},{x:400,y:215},{x:423,y:301},{x:350,y:250},{x:277,y:301},{x:303,y:215},{x:231,y:161},{x:321,y:161}],a=new fabric.Polygon(n,{fill:"#fff",stroke:"#000",strokeWidth:0,objectType:"star",width:100,height:100,gradientFill:"none",top:Z()[1]/2,left:Z()[0]/2,originX:"center",originY:"center"})),u.add(a),a.scaleToWidth(Z()[0]/6),a.isPartiallyOnScreen()&&a.scaleToHeight(Z()[1]/6),u.setActiveObject(a),u.requestRenderAll(),u.fire("palleon:history",{type:e,text:palleonParams.added})}),l.find("#palleon-shape-settings .palleon-colorpicker").bind("change",function(){var a=e(this).val();"palleon-shape-color"==e(this).attr("id")?u.getActiveObject().set("fill",a):"shape-outline-color"==e(this).attr("id")&&u.getActiveObject().set("stroke",a),u.requestRenderAll(),u.fire("palleon:history",{type:u.getActiveObject().objectType,text:palleonParams.edited})}),l.find("#palleon-shape-settings input[type=range]").bind("input click",function(){var a=e(this).val();"shape-skew-x"==e(this).attr("id")?u.getActiveObject().set("skewX",parseInt(a)):"shape-skew-y"==e(this).attr("id")?u.getActiveObject().set("skewY",parseInt(a)):"shape-rotate"==e(this).attr("id")?u.getActiveObject().set("angle",parseInt(a)):"shape-opacity"==e(this).attr("id")&&u.getActiveObject().set("opacity",parseFloat(a)),u.requestRenderAll()}),l.find("#palleon-shape-settings input[type=range]").bind("change",function(){u.fire("palleon:history",{type:u.getActiveObject().objectType,text:palleonParams.edited})}),l.find("#palleon-shape-settings input[type=number]").bind("input paste",function(){var a=parseInt(e(this).val());"shape-outline-width"==e(this).attr("id")?u.getActiveObject().set("strokeWidth",a):"shape-custom-width"==e(this).attr("id")?(u.getActiveObject().set("width",a),u.getActiveObject().set("scaleX",1)):"shape-custom-height"==e(this).attr("id")&&(u.getActiveObject().set("height",a),u.getActiveObject().set("scaleY",1)),u.requestRenderAll()}),l.find("#palleon-shape-settings input[type=number]").bind("input",function(){window.clearTimeout(x),x=setTimeout(function(){u.fire("palleon:history",{type:u.getActiveObject().objectType,text:palleonParams.edited})},500)});function K(a){var n=u.getObjects().filter(e=>"frame"==e.objectType);e.each(n,function(e,n){var l=n.angle,t=n.width,i=n.height,o=Z()[0],r=Z()[1];0!=l&&180!=l&&-180!=l||(o=Z()[1],r=Z()[0]),"right"==a?0==l?l=90:90==l?l=180:180==l?l=270:270==l?l=0:-90==l?l=0:-180==l?l=-90:-270==l&&(l=-180):"left"==a&&(0==l?l=-90:-90==l?l=-180:-180==l?l=-270:-270==l?l=0:90==l?l=0:180==l?l=90:270==l&&(l=180)),n.set("left",Z()[0]/2),n.set("top",Z()[1]/2),n.set("scaleX",o/t),n.set("scaleY",r/i),n.set("angle",l)}),u.requestRenderAll(),u.fire("palleon:history",{type:"frame",text:palleonParams.edited})}l.find("#palleon-frame-search").on("keyup input",function(){l.find("#palleon-noframes").hide();var a=e(this).val().toLowerCase().replace(/\s/g,"");""==a||a.length<1?(l.find("#palleon-frames-wrap li").show(),l.find("#palleon-frame-search-icon").html("search"),l.find("#palleon-frame-search-icon").removeClass("cancel")):(l.find("#palleon-frame-search-icon").html("clear"),l.find("#palleon-frame-search-icon").addClass("cancel"),function(e){l.find("#palleon-frames-wrap li").hide().filter('[data-keyword*="'+e+'"]').show()}(a),0===l.find("#palleon-frames-wrap li:visible").length&&l.find("#palleon-noframes").show())}),l.find("#palleon-frame-search-icon").on("click",function(){e(this).hasClass("cancel")&&(e(this).removeClass("cancel"),e(this).html("search"),l.find("#palleon-frame-search").val(""),l.find("#palleon-frames-wrap li").show(),l.find("#palleon-noframes").hide())}),l.find(".palleon-frames-grid").on("click",".palleon-frame img",function(){l.find("#palleon-canvas-loader").css("display","flex");var a=e(this).parent().parent(),n=a.data("elsource");l.find(".palleon-frames-grid .palleon-frame").removeClass("active"),a.addClass("active"),fabric.loadSVGFromURL(n,function(e,a){var n=fabric.util.groupSVGElements(e,a),t=n.width,i=n.height;n.set("originX","center"),n.set("originY","center"),n.set("left",Z()[0]/2),n.set("top",Z()[1]/2),n.set("scaleX",(Z()[0]+2)/t),n.set("scaleY",(Z()[1]+2)/i),n.set("objectType","frame"),u.add(n),u.setActiveObject(n),u.requestRenderAll(),l.find("#palleon-canvas-loader").hide()},function(){},{crossOrigin:"anonymous"}),u.fire("palleon:history",{type:"frame",text:palleonParams.added})}),l.find(".palleon-frames-grid").on("click",".frame-favorite button.star",function(){var a=e(this),n=a.data("frameid"),t="add";a.hasClass("favorited")?(l.find('*[data-frameid="'+n+'"]').removeClass("favorited"),t="remove"):l.find('*[data-frameid="'+n+'"]').addClass("favorited");var i={action:"favframe",nonce:palleonParams.nonce,frameid:n,mode:t};e.ajax({url:palleonParams.ajaxurl,data:i,type:"POST",success:function(e){"add"==t?(l.find('*[data-frameid="'+n+'"]').html('<span class="material-icons">star</span>'),toastr.success(palleonParams.favorited,palleonParams.success)):(l.find('*[data-frameid="'+n+'"]').html('<span class="material-icons">star_border</span>'),toastr.success(palleonParams.unfavorited,palleonParams.success)),e&&(l.find("#palleon-frame-favorites > div").html(e),S.update())},error:function(e,a,n){e.status&&400==e.status?toastr.error(e.responseText,palleonParams.error):toastr.error(palleonParams.wrong,palleonParams.error)}})}),l.find("#palleon-frame-color").bind("change",function(){var a=e(this).val(),n=u.getObjects().filter(e=>"frame"==e.objectType);e.each(n,function(e,n){if(""!=n.fill&&n.set("fill",a),n._objects)for(var l=0;l<n._objects.length;l++)""!=n._objects[l].fill&&n._objects[l].set({fill:a})}),u.requestRenderAll(),u.fire("palleon:history",{type:"frame",text:palleonParams.edited})}),l.find("#palleon-rotate-right-frame").on("click",function(){K("right")}),l.find("#palleon-rotate-left-frame").on("click",function(){K("left")}),l.find("#palleon-flip-horizontal-frame").on("click",function(){var a=u.getObjects().filter(e=>"frame"==e.objectType);e.each(a,function(e,a){a.toggle("flipX")}),u.requestRenderAll(),u.fire("palleon:history",{type:"frame",text:palleonParams.edited})}),l.find("#palleon-flip-vertical-frame").on("click",function(){var a=u.getObjects().filter(e=>"frame"==e.objectType);e.each(a,function(e,a){a.toggle("flipY")}),u.requestRenderAll(),u.fire("palleon:history",{type:"frame",text:palleonParams.edited})});l.find("#palleon-element-search").on("keyup input",function(){l.find("#palleon-noelements").hide();var a=e(this).val().toLowerCase().replace(/\s/g,"");""==a||a.length<1?(l.find("#palleon-elements-wrap li").show(),l.find("#palleon-element-search-icon").html("search"),l.find("#palleon-element-search-icon").removeClass("cancel")):(l.find("#palleon-element-search-icon").html("clear"),l.find("#palleon-element-search-icon").addClass("cancel"),function(e){l.find("#palleon-elements-wrap li").hide().filter('[data-keyword*="'+e+'"]').show()}(a),0===l.find("#palleon-elements-wrap li:visible").length&&l.find("#palleon-noelements").show())}),l.find("#palleon-element-search-icon").on("click",function(){e(this).hasClass("cancel")&&(e(this).removeClass("cancel"),e(this).html("search"),l.find("#palleon-element-search").val(""),l.find("#palleon-elements-wrap li").show(),l.find("#palleon-noelements").hide())}),l.find(".palleon-elements-grid").on("click",".palleon-element > *:first-child",function(){var a=e(this).parent(),n=a.data("elsource");if("palleon-icons-grid"==a.parent().attr("id")){var t=l.find("#palleon-icon-style").val();n=a.data("elsource")+"/"+t+"/24px.svg",console.log(n)}var i=a.data("loader");"yes"==i&&l.find("#palleon-canvas-loader").css("display","flex"),l.find(".palleon-elements-grid .palleon-element").removeClass("active"),a.addClass("active"),fabric.loadSVGFromURL(n,function(e,a){var n=fabric.util.groupSVGElements(e,a);n.set("originX","center"),n.set("originY","center"),n.set("left",Z()[0]/2),n.set("top",Z()[1]/2),n.set("objectType","element"),n.set("gradientFill","none"),u.add(n),n.scaleToWidth(Z()[0]/8),n.isPartiallyOnScreen()&&n.scaleToHeight(Z()[1]/8),u.setActiveObject(n),u.requestRenderAll(),"yes"==i&&l.find("#palleon-canvas-loader").hide()},function(){},{crossOrigin:"anonymous"}),u.fire("palleon:history",{type:"element",text:palleonParams.added})}),l.find("#palleon-element-upload").on("change",function(e){var a=new FileReader,n="";a.onload=function(e){n=a.result,fabric.loadSVGFromURL(n,function(e,a){var n=fabric.util.groupSVGElements(e,a);n.set("originX","center"),n.set("originY","center"),n.set("left",Z()[0]/2),n.set("top",Z()[1]/2),n.set("objectType","customSVG"),n.scaleToWidth(Z()[0]/2),n.scaleToHeight(Z()[1]/2),u.add(n),u.setActiveObject(n),u.requestRenderAll()},function(){},{crossOrigin:"anonymous"})},a.readAsDataURL(this.files[0]),u.fire("palleon:history",{type:"element",text:palleonParams.added})}),l.find("#palleon-element-color").bind("change",function(){var a=e(this).val(),n=u.getActiveObject();if(""!=n.fill&&n.set("fill",a),n._objects)for(var l=0;l<n._objects.length;l++)""!=n._objects[l].fill&&n._objects[l].set({fill:a});u.requestRenderAll(),u.fire("palleon:history",{type:"element",text:palleonParams.edited})}),l.find("#element-flip-horizontal").on("click",function(){u.getActiveObject().toggle("flipX"),u.requestRenderAll(),u.fire("palleon:history",{type:"element",text:palleonParams.edited})}),l.find("#element-flip-vertical").on("click",function(){u.getActiveObject().toggle("flipY"),u.requestRenderAll(),u.fire("palleon:history",{type:"element",text:palleonParams.edited})}),l.find("#palleon-custom-element-options input[type=range]").bind("input click",function(){var a=e(this).val();"element-skew-x"==e(this).attr("id")?u.getActiveObject().set("skewX",parseInt(a)):"element-skew-y"==e(this).attr("id")?u.getActiveObject().set("skewY",parseInt(a)):"element-rotate"==e(this).attr("id")?u.getActiveObject().set("angle",parseInt(a)):"element-opacity"==e(this).attr("id")&&u.getActiveObject().set("opacity",parseFloat(a)),u.requestRenderAll()}),l.find("#palleon-custom-element-options input[type=range]").bind("change",function(){u.fire("palleon:history",{type:"element",text:palleonParams.edited})}),l.find(".palleon-grid").on("click",".element-favorite button.star",function(){var a=e(this),n=a.data("elementid"),t="add";a.hasClass("favorited")?(l.find('*[data-elementid="'+n+'"]').removeClass("favorited"),t="remove"):l.find('*[data-elementid="'+n+'"]').addClass("favorited");var i={action:"favElement",nonce:palleonParams.nonce,elementid:n,mode:t};e.ajax({url:palleonParams.ajaxurl,data:i,type:"POST",success:function(e){"add"==t?(toastr.success(palleonParams.favorited,palleonParams.success),l.find('*[data-elementid="'+n+'"]').html('<span class="material-icons">star</span>')):(toastr.success(palleonParams.unfavorited,palleonParams.success),l.find('*[data-elementid="'+n+'"]').html('<span class="material-icons">star_border</span>')),e&&(l.find("#palleon-my-favorites > div").html(e),S.update())},error:function(e,a,n){e.status&&400==e.status?toastr.error(e.responseText,palleonParams.error):toastr.error(palleonParams.wrong,palleonParams.error)}})});function Q(a,n){e("#tm-cursor-1").remove(),l.find("#palleon-canvas-wrap").tmpointer({id:1,native_cursor:"enable",cursorSize:a,cursorColor:n})}l.find("#palleon-icon-search").on("keyup input",function(){l.find("#palleon-noicons").hide();var a=e(this).val().toLowerCase().replace(/\s/g,"");""==a||a.length<1?(l.find("#palleon-icons-grid .palleon-element").css("display","flex"),l.find("#palleon-icon-search-icon").html("search"),l.find("#palleon-icon-search-icon").removeClass("cancel")):(l.find("#palleon-icon-search-icon").html("clear"),l.find("#palleon-icon-search-icon").addClass("cancel"),function(e){l.find("#palleon-icons-grid .palleon-element").css("display","none").filter('[title*="'+e+'"]').css("display","flex")}(a),0===l.find("#palleon-icons-grid .palleon-element:visible").length&&l.find("#palleon-noicons").show())}),l.find("#palleon-icon-search-icon").on("click",function(){e(this).hasClass("cancel")&&(e(this).removeClass("cancel"),e(this).html("search"),l.find("#palleon-icon-search").val(""),l.find("#palleon-icons-grid .palleon-element").css("display","flex"),l.find("#palleon-noicons").hide())}),l.find("#palleon-draw-btn").on("click",function(){e(this).hasClass("active")?(l.find("#palleon-draw-undo").prop("disabled",!0),e("#tm-cursor-1").remove(),l.find("#palleon-draw-settings").hide(),l.find("#palleon-icon-menu").css("pointer-events","auto"),e(this).removeClass("active"),u.isDrawingMode=!1,e(this).html('<span class="material-icons">edit</span>Start Drawing')):(l.find("#palleon-draw-undo").prop("disabled",!1),l.find("#palleon-draw-settings").show(),l.find("#palleon-icon-menu").css("pointer-events","none"),e(this).addClass("active"),l.find("#palleon-brush-select").trigger("change"),u.isDrawingMode=!0,e(this).html('<span class="material-icons">close</span>Stop Drawing'))}),l.find("#palleon-brush-select").on("change",function(){var a=e(this).val();if("pencil"==a){var n=new fabric.PencilBrush(u);u.freeDrawingBrush=n}else if("circle"==a){var t=new fabric.CircleBrush(u);u.freeDrawingBrush=t}else if("spray"==a){var i=new fabric.SprayBrush(u);u.freeDrawingBrush=i}else if("hline"==a){var o=new fabric.PatternBrush(u);u.freeDrawingBrush=o,o.getPatternSrc=function(){var e=parseInt(l.find("#brush-pattern-width").val()),a=e/2,n=fabric.document.createElement("canvas");n.width=n.height=e;var t=n.getContext("2d");return t.strokeStyle=l.find("#brush-color").val(),t.lineWidth=a,t.beginPath(),t.moveTo(a,0),t.lineTo(a,e),t.closePath(),t.stroke(),n}}else if("vline"==a){var r=new fabric.PatternBrush(u);u.freeDrawingBrush=r,r.getPatternSrc=function(){var e=parseInt(l.find("#brush-pattern-width").val()),a=e/2,n=fabric.document.createElement("canvas");n.width=n.height=e;var t=n.getContext("2d");return t.strokeStyle=l.find("#brush-color").val(),t.lineWidth=a,t.beginPath(),t.moveTo(0,a),t.lineTo(e,a),t.closePath(),t.stroke(),n}}else if("square"==a){var s=new fabric.PatternBrush(u);u.freeDrawingBrush=s,s.getPatternSrc=function(){var e=parseInt(l.find("#brush-pattern-width").val()),a=parseInt(l.find("#brush-pattern-distance").val()),n=fabric.document.createElement("canvas");n.width=n.height=e+a;var t=n.getContext("2d");return t.fillStyle=l.find("#brush-color").val(),t.fillRect(0,0,e,e),n}}else if("erase"==a){var d=new fabric.EraserBrush(u);u.freeDrawingBrush=d}(y=u.freeDrawingBrush).getPatternSrc&&(y.source=y.getPatternSrc.call(y)),y.width=parseInt(l.find("#brush-width").val()),"erase"==a?(l.find("#not-erase-brush").hide(),y.shadow=null,y.color="#E91E63"):(u.freeDrawingBrush.inverted=!1,l.find("#palleon-draw-undo").removeClass("active"),l.find("#not-erase-brush").show(),y.color=l.find("#brush-color").val()),l.find("#palleon-brush-shadow").is(":checked")?y.shadow=k:y.shadow=null,Q(y.width*u.getZoom(),y.color),"hline"==a||"vline"==a||"square"==a?l.find("#palleon-brush-pattern-width").css("display","flex"):l.find("#palleon-brush-pattern-width").css("display","none"),"square"==a?l.find("#palleon-brush-pattern-distance").css("display","flex"):l.find("#palleon-brush-pattern-distance").css("display","none")}),l.find("#palleon-brush-shadow").on("change",function(){k=new fabric.Shadow({color:l.find("#brush-shadow-color").val(),blur:l.find("#brush-shadow-width").val(),offsetX:l.find("#brush-shadow-shadow-offset-x").val(),offsetY:l.find("#brush-shadow-shadow-offset-y").val()}),e(this).is(":checked")?y.shadow=k:y.shadow=null}),l.find("#palleon-draw-settings input[type=number]").bind("input paste keyup keydown",function(){"brush-width"==e(this).attr("id")?(y.width=parseInt(e(this).val()),Q(y.width*u.getZoom(),y.color)):"brush-shadow-shadow-offset-x"==e(this).attr("id")?k.offsetX=parseInt(e(this).val()):"brush-shadow-shadow-offset-y"==e(this).attr("id")?k.offsetY=parseInt(e(this).val()):"brush-shadow-width"==e(this).attr("id")?k.blur=parseInt(e(this).val()):"brush-pattern-width"==e(this).attr("id")?l.find("#palleon-brush-select").trigger("change"):"brush-pattern-distance"==e(this).attr("id")&&l.find("#palleon-brush-select").trigger("change")}),l.find("#palleon-draw-settings .palleon-colorpicker").bind("change",function(){"brush-color"==e(this).attr("id")?(y.color=e(this).val(),Q(y.width*u.getZoom(),y.color),l.find("#palleon-brush-select").trigger("change")):"brush-shadow-color"==e(this).attr("id")&&(k.color=e(this).val())}),l.find("#palleon-draw-undo").on("click",function(){if("erase"==l.find("#palleon-brush-select").val())u.backgroundImage&&(e(this).hasClass("active")?(e(this).removeClass("active"),u.freeDrawingBrush.inverted=!1):(e(this).addClass("active"),u.freeDrawingBrush.inverted=!0));else{var a=u.getObjects().filter(e=>"drawing"==e.objectType).slice(-1)[0];u.remove(a),u.requestRenderAll()}}),document.onkeydown=function(e){switch(e.keyCode){case 38:u.getActiveObject()&&(u.getActiveObject().top-=1,u.requestRenderAll());break;case 40:u.getActiveObject()&&(u.getActiveObject().top+=1,u.requestRenderAll());break;case 37:u.getActiveObject()&&(u.getActiveObject().left-=1,u.requestRenderAll());break;case 39:u.getActiveObject()&&(u.getActiveObject().left+=1,u.requestRenderAll())}},l.find("#custom-theme").on("change",function(){var a=e(this).val(),n=palleonParams.baseURL+"css/"+a+palleonParams.suffix+".css";e("#palleon-theme-link").attr("href",n)}),l.find("#custom-font-size").on("input",function(){e("html").css("font-size",e(this).val()+"px")}),l.find("#custom-background").on("change",function(){var a=e(this).val();""!=a&&l.find("#palleon-content").css("background-color",a)}),l.find("#custom-image-background").on("change",function(){var a=e(this).val();l.find("#palleon-canvas-color").spectrum("set",a),""==a?(u.backgroundColor="transparent",u.requestRenderAll()):(u.backgroundColor=a,u.requestRenderAll())}),l.find("#palleon-preferences-save").on("click",function(){var a=e(this),n={},t=[],i=[];l.find("#palleon-preferences .preference").each(function(a,n){t.push(e(this).attr("id")),i.push(e(this).val())});for(let e=0;e<t.length;e++)n[t[e]]=i[e];var o={action:"savePreferences",nonce:palleonParams.nonce,preferences:JSON.stringify(n)};e.ajax({url:palleonParams.ajaxurl,data:o,type:"POST",beforeSend:function(){a.prop("disabled",!0)},success:function(){toastr.success(palleonParams.settingsaved,palleonParams.success)},complete:function(){a.prop("disabled",!1)},error:function(e,a,n){e.status&&400==e.status?toastr.error(e.responseText,palleonParams.error):toastr.error(palleonParams.wrong,palleonParams.error)}})}),e(window).on("resize",function(){_()})},new FontFaceObserver("Material Icons").load(null,1e4).then(function(){e("#palleon").find("#palleon-main-loader").fadeOut(200),setTimeout(function(){e("#palleon").find("#palleon-main-loader").remove()},300)}).catch(function(a){console.log(a),e("#palleon").find("#palleon-main-loader").remove()}),e(document).ready(function(){e("#palleon").palleon({enableGLFiltering:palleonParams.enableGLFiltering,textureSize:palleonParams.textureSize})})}(jQuery);