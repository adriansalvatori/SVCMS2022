(()=>{"use strict";const e={modal(e={}){let{header:t="",content:i="",actionsHtml:a=""}=e;return`<div class="vi-wbe-modal-container">\n                    <div class="vi-wbe-modal-main vi-ui form small">\n                        <i class="close icon"></i>\n                        <div class="vi-wbe-modal-wrapper">\n                            <h3 class="header">${t}</h3>\n                            <div class="content">${i}</div>\n                            <div class="actions">${a}</div>\n                        </div>\n                    </div>\n                </div>`},defaultAttributes(e={}){let{html:t}=e;return`<table class="vi-ui celled table">\n                    <thead>\n                    <tr>\n                        <th>Name</th>\n                        <th>Attribute</th>\n                    </tr>\n                    </thead>\n                    <tbody>\n                    ${t}\n                    </tbody>\n                </table>`}},t={},i={};jQuery(document).ready((function(s){window.viIsEditing=!1;const n=wp.media({multiple:!0}),o=wp.media({multiple:!1}),r={galleryImage:(e,t)=>`<li class="vi-wbe-gallery-image" data-id="${t}"><i class="vi-wbe-remove-image dashicons dashicons-no-alt"> </i><img src="${e}"></li>`,fileDownload(e={}){let{id:t,name:i,file:a}=e,n=s(`<tr>\n                        <td><i class="bars icon"></i><input type="text" class="vi-wbe-file-name" value="${i||""}"></td>\n                        <td>\n                            <input type="text" class="vi-wbe-file-url" value="${a||""}">\n                            <input type="hidden" class="vi-wbe-file-hash" value="${t||""}">\n                            <span class="vi-ui button mini vi-wbe-choose-file">${l.text("Choose file")}</span>\n                            <i class="vi-wbe-remove-file dashicons dashicons-no-alt"> </i>\n                        </td>\n                    </tr>`);return n.on("click",".vi-wbe-remove-file",(function(){n.remove()})),n}};t.textEditor={type:"textEditor",createCell:(e,t,i,a)=>(e.innerHTML=l.stripHtml(i).slice(0,50),e),closeEditor(e,t){window.viIsEditing=!1;let i="";return!0===t&&(i=wp.editor.getContent("vi-wbe-text-editor"),this.isEditing||wp.editor.remove("vi-wbe-text-editor"),this.isEditing=!1),i},openEditor(e,t,i){window.viIsEditing=!0;let a=e.getAttribute("data-y"),n=e.getAttribute("data-x"),l=i.options.data[a][n],o=this,r=s(".vi-ui.modal .close.icon");s(".vi-ui.modal").modal("show"),this.tinymceInit(l),r.off("click"),s(".vi-wbe-text-editor-save").off("click").on("click",(function(){s(this).removeClass("primary"),s(this).hasClass("vi-wbe-close")?s(".vi-ui.modal").modal("hide"):o.isEditing=!0,i.closeEditor(e,!0)})),r.on("click",(function(){i.closeEditor(e,!1)})),s(".vi-ui.modal").parent().on("click",(function(t){t.target===t.delegateTarget&&i.closeEditor(e,!1)}))},updateCell:(e,t,i)=>(e.innerHTML=l.stripHtml(t).slice(0,50),t),tinymceInit(e=""){e=wp.editor.autop(e),null===tinymce.get("vi-wbe-text-editor")&&(s("#vi-wbe-text-editor").val(e),a.tinyMceOptions.tinymce.setup=function(e){e.on("keyup",(function(e){s(".vi-wbe-text-editor-save:not(.vi-wbe-close)").addClass("primary")}))},wp.editor.initialize("vi-wbe-text-editor",a.tinyMceOptions)),tinymce.get("vi-wbe-text-editor").setContent(e)}},t.image={createCell(e,t,i,n){if(i){let t=a.imgStorage[i];l.isUrl(t)?s(e).html(`<img width="40" src="${t}" data-id="${i}">`):s(e).html("")}return e},closeEditor:(e,t)=>s(e).find("img").attr("data-id")||"",openEditor(e,t,i){function n(){o.open().off("select").on("select",(function(t){let n=o.state().get("selection").first().toJSON();l.isUrl(n.url)&&(s(e).html(`<img width="40" src="${n.url}" data-id="${n.id}">`),a.imgStorage[n.id]=n.url,i.closeEditor(e,!0))}))}s(e).on("dblclick",n),n()},updateCell(e,t,i){t=parseInt(t)||"";let n=a.imgStorage[t];return l.isUrl(n)?s(e).html(`<img width="40" src="${n}" data-id="${t}">`):s(e).html(""),t}},t.gallery={type:"gallery",saveData(e){let t=[];s(e).find(".vi-wbe-gallery-image").each((function(){t.push(s(this).data("id"))})),s(e).find(".vi-wbe-ids-list").val(t.join(","))},createCell(e,t,i){let a=i.length?"vi-wbe-gallery-has-item":"";return s(e).addClass("vi-wbe-gallery"),s(e).html(`<div class="vi-wbe-gallery ${a}"><i class="images outline icon"> </i></div>`),e},closeEditor(e,t){window.viIsEditing=!1;let i=[];return t&&s(e).children().find(".vi-wbe-gallery-image").each((function(){i.push(s(this).data("id"))})),s(e).find(".vi-wbe-cell-popup").remove(),i},openEditor(e,t,i){window.viIsEditing=!0;let o=e.getAttribute("data-y"),d=e.getAttribute("data-x"),c=i.options.data[o][d],u="";if(c.length)for(let e of c){let t=a.imgStorage[e];u+=r.galleryImage(t,e)}let p=s(`<div class="vi-wbe-cell-popup-inner">\n                                    <ul class="vi-wbe-gallery-images">${u}</ul>\n                                    <span class="vi-ui button tiny vi-wbe-add-image">${l.text("Add image")}</span>\n                                    <span class="vi-ui button tiny vi-wbe-remove-gallery">${l.text("Remove all")}</span>\n                                </div>`);l.createEditor(e,"div",p),p.find(".vi-wbe-gallery-images").sortable({items:"li.vi-wbe-gallery-image",cursor:"move",scrollSensitivity:40,forcePlaceholderSize:!0,forceHelperSize:!1,helper:"clone",placeholder:"vi-wbe-sortable-placeholder",tolerance:"pointer"}),p.on("click",".vi-wbe-remove-image",(function(){s(this).parent().remove()})),p.on("click",".vi-wbe-add-image",(function(){n.open().off("select close").on("select",(function(e){n.state().get("selection").each((function(e){"image"===(e=e.toJSON()).type&&(a.imgStorage[e.id]=e.url,p.find(".vi-wbe-gallery-images").append(r.galleryImage(e.url,e.id)))}))}))})),p.on("click",".vi-wbe-remove-gallery",(function(){p.find(".vi-wbe-gallery-images").empty()})),0===c.length&&p.find(".vi-wbe-add-image").trigger("click")},updateCell(e,t,i){let a=s(e).find(".vi-wbe-gallery");return t.length?a.addClass("vi-wbe-gallery-has-item"):a.removeClass("vi-wbe-gallery-has-item"),t}},t.download={createCell:(e,t,i)=>(s(e).html('<div><i class="download icon"> </i></div>'),e),closeEditor(e,t){let i=[];if(t){let t=s(e).children();t.find("table.vi-wbe-files-download tbody tr").each((function(){let e=s(this);i.push({id:e.find(".vi-wbe-file-hash").val(),file:e.find(".vi-wbe-file-url").val(),name:e.find(".vi-wbe-file-name").val()})})),t.remove()}return i},openEditor(e,t,i){let a,n=e.getAttribute("data-y"),d=e.getAttribute("data-x"),c=i.options.data[n][d],u=s("<tbody></tbody>");if(Array.isArray(c))for(let e of c)u.append(r.fileDownload(e));let p=s(`<div class="">\n                                        <table class="vi-wbe-files-download vi-ui celled table">\n                                            <thead>\n                                            <tr>\n                                                <th>${l.text("Name")}</th>\n                                                <th>${l.text("File URL")}</th>\n                                            </tr>\n                                            </thead>\n                                        </table>\n                                        <span class="vi-ui button tiny vi-wbe-add-file">${l.text("Add file")}</span>\n                                    </div>`);p.find(".vi-wbe-files-download").append(u),l.createEditor(e,"div",p),u.sortable(),p.on("click",".vi-wbe-add-file",(()=>p.find(".vi-wbe-files-download tbody").append(r.fileDownload()))),p.on("click",".vi-wbe-choose-file",(function(){a=i.edition,i.edition=null;let e=s(this).closest("tr");o.open().off("select close").on("select",(function(t){let i=o.state().get("selection").first().toJSON();i.url&&e.find(".vi-wbe-file-url").val(i.url).trigger("change")})).on("close",(()=>i.edition=a))})),c.length||p.find(".vi-wbe-add-file").trigger("click")},updateCell:(e,t,i)=>(s(e).html('<div><i class="download icon"> </i></div>'),t)},t.tags={type:"tags",createCell:(e,t,i,a)=>(l.formatText(e,i),e),openEditor(e,t,i){let n=e.getAttribute("data-y"),o=e.getAttribute("data-x"),r=i.options.data[n][o],d=s("<select/>"),c=l.createEditor(e,"div",d);d.select2({data:r,multiple:!0,minimumInputLength:3,placeholder:l.text("Search tags..."),ajax:{url:a.ajaxUrl,type:"post",data:function(e){return{...a.ajaxData,sub_action:"search_tags",search:e.term,type:"public"}},processResults:function(e){return{results:e}}}}),d.find("option").attr("selected",!0).parent().trigger("change"),s(c).find(".select2-search__field").trigger("click")},closeEditor(e,t){let i=s(e).children(),a=i.find("select").select2("data"),n=[];if(a.length)for(let e of a)n.push({id:e.id,text:e.text});return i.remove(),s(".select2-container").remove(),n},updateCell:(e,t,i,a,s)=>(l.formatText(e,t),t)},t.link_products={createCell:(e,t,i,a)=>(l.formatText(e,i),e),closeEditor(e,t){let i=s(e).children(),a=[];if(t){let e=i.find("select").select2("data");if(e.length)for(let t of e)a.push({id:t.id,text:t.text})}return i.remove(),s(".select2-container").remove(),a},openEditor(e,t,i){let n=e.getAttribute("data-y"),o=e.getAttribute("data-x"),r=i.options.data[n][o],d=s("<select/>"),c=l.createEditor(e,"div",d);d.select2({data:r,multiple:!0,minimumInputLength:3,placeholder:l.text("Search products..."),ajax:{url:a.ajaxUrl,type:"post",delay:250,dataType:"json",data:function(e){return{...a.ajaxData,sub_action:"search_products",search:e.term,type:"public"}},processResults:function(e){var t=[];return e&&s.each(e,(function(e,i){t.push({id:e,text:i})})),{results:t}}}}),d.find("option").attr("selected",!0).parent().trigger("change"),s(c).find(".select2-search__field").trigger("click")},updateCell:(e,t,i,a,s)=>(l.formatText(e,t),t)},t.product_attributes={type:"product_attributes",createCell:(e,t,i,a)=>(s(e).html('<i class="icon edit"/>'),e),updateCell:(e,t,i,a,s)=>t,openEditor(e,t,i){let n=l.getDataFromCell(i,e),o=l.getProductTypeFromCell(e),r=this,d="";this.productType=o;let c=l.createModal({header:l.text("Edit attributes"),content:"",actions:[{class:"save-attributes",text:l.text("Save")}]});if(s(e).append(c),"variation"!==o){let{attributes:e}=a,t=`<option value="">${l.text("Custom product attribute")}</option>`;for(let i in e)t+=`<option value="${i}">${e[i].data.attribute_label}</option>`;if(t=`<div class="vi-wbe-taxonomy-header">\n                                    <select class="vi-wbe-select-taxonomy">${t}</select>\n                                    <span class="vi-ui button tiny vi-wbe-add-taxonomy">${l.text("Add")}</span>\n                                </div>`,Array.isArray(n)&&n.length)for(let e of n)d+=r.createRowTable(e);d=`${t}\n                        <table class="vi-ui celled table">\n                            <thead>\n                            <tr>\n                                <th>Name</th>\n                                <th>Attributes</th>\n                                <th width="1">Actions</th>\n                            </tr>\n                            </thead>\n                            <tbody>${d}</tbody>\n                        </table>`,c.find(".content").append(d),c.find("table select").select2({multiple:!0}),c.find("tbody").sortable({items:"tr",cursor:"move",axis:"y",scrollSensitivity:40,forcePlaceholderSize:!0,helper:"clone",handle:".icon.move"});const i=()=>{c.find("select.vi-wbe-select-taxonomy option").removeAttr("disabled"),c.find("input[type=hidden]").each((function(e,t){let i=s(t).val();c.find(`select.vi-wbe-select-taxonomy option[value='${i}']`).attr("disabled","disabled")}))};i(),c.on("click",(function(e){let t=s(e.target);if(t.hasClass("trash")&&(t.closest("tr").remove(),i()),t.hasClass("vi-wbe-add-taxonomy")){let e=s(".vi-wbe-select-taxonomy"),t=e.val(),a={name:t,options:[]};t&&(a.is_taxonomy=1);let n=s(r.createRowTable(a));c.find("table tbody").append(n),n.find("select").select2({multiple:!0}),i(),e.val("").trigger("change")}if(t.hasClass("vi-wbe-select-all-attributes")){let e=t.closest("td").find("select");e.find("option").attr("selected",!0),e.trigger("change")}if(t.hasClass("vi-wbe-select-no-attributes")){let e=t.closest("td").find("select");e.find("option").attr("selected",!1),e.trigger("change")}if(t.hasClass("vi-wbe-add-new-attribute")){let e=prompt(l.text("Enter a name for the new attribute term:"));if(!e)return;let i=t.closest("tr.vi-wbe-attribute-row"),s=i.attr("data-attr");s&&(s=JSON.parse(s),l.ajax({data:{sub_action:"add_new_attribute",taxonomy:s.name,term:e},beforeSend(){t.addClass("loading")},success(e){if(t.removeClass("loading"),e.success){let t=i.find("select");t.append(`<option value="${e.data.term_id}" selected>${e.data.name}</option>`),t.trigger("change"),a.attributes[s.name].terms[e.data.term_id]={slug:e.data.slug,text:e.data.name}}else alert(e.data.message)}}))}}))}else{let t,s=e.getAttribute("data-y"),o=i.options.data[s][1],r=i.getData();for(let e in r)if(o==r[e][0]){let s=a.idMappingFlip.attributes;t=i.options.data[e][s];break}if(t)for(let e of t){let t,i=`<option value="">${l.text("Any...")}</option>`,s=e.name;if(e.is_taxonomy){let l=a.attributes[s];for(let t of e.options){let e=l.terms[t],a=e.slug===n[s]?"selected":"";i+=`<option value="${e.slug}" ${a}>${e.text}</option>`}t=l.data.attribute_label}else{for(let t of e.options)i+=`<option value="${t}" ${t===n[s]?"selected":""}>${t}</option>`;t=s}d+=`<tr><td>${t}</td><td><select name="${s}">${i}</select></td></tr>`}d=`<table class="vi-ui celled table">\n                            <thead>\n                            <tr>\n                                <th>${l.text("Attribute")}</th>\n                                <th>${l.text("Option")}</th>\n                            </tr>\n                            </thead>\n                            <tbody>\n                            ${d}\n                            </tbody>\n                        </table>`,c.find(".content").append(d)}c.on("click",(function(t){let a=s(t.target);(a.hasClass("close")||a.hasClass("vi-wbe-modal-container"))&&i.closeEditor(e,!1),a.hasClass("save-attributes")&&i.closeEditor(e,!0)}))},closeEditor(e,t){let i=[];return!0===t&&("variation"!==this.productType?s(e).find(".vi-wbe-attribute-row").each((function(e,t){let a=s(t).data("attr");if(a.is_taxonomy)a.options=s(t).find("select").val().map(Number);else{a.name=s(t).find("input.custom-attr-name").val();let e=s(t).find("textarea.custom-attr-val").val();a.value=e.trim().replace(/\s+/g," "),a.options=e.split("|").map((e=>e.trim().replace(/\s+/g," ")))}a.visible=!!s(t).find(".attr-visibility:checked").length,a.variation=!!s(t).find(".attr-variation:checked").length,a.position=e,i.push(a)})):(i={},s(e).find("select").each((function(e,t){i[s(t).attr("name")]=s(t).val()})))),l.removeModal(e),i},createRowTable(e){let t="",i="";if(e.is_taxonomy){let s=a.attributes[e.name],n=s.terms||[],o="";if(t=`${s.data.attribute_label}<input type="hidden" value="${e.name}"/>`,Object.keys(n).length)for(let t in n)o+=`<option value="${t}" ${e.options.includes(parseInt(t))?"selected":""}>${n[t].text}</option>`;i=`<select multiple>${o}</select>\n                        <div class="vi-wbe-attributes-button-group">\n                            <span class="vi-ui button mini vi-wbe-select-all-attributes">${l.text("Select all")}</span>\n                            <span class="vi-ui button mini vi-wbe-select-no-attributes">${l.text("Select none")}</span>\n                            <span class="vi-ui button mini vi-wbe-add-new-attribute">${l.text("Add new")}</span>\n                        </div>`}else t=`<input type="text" class="custom-attr-name" value="${e.name}" placeholder="${l.text("Custom attribute name")}"/>`,i=`<textarea class="custom-attr-val" placeholder="${l.text('Enter some text, or some attributes by "|" separating values.')}">${e.value||""}</textarea>`;return t=`<div class="vi-wbe-attribute-name-label">${t}</div>`,t+=`<div>\n                            <input type="checkbox" class="attr-visibility" ${e.visible?"checked":""} value="1">\n                            <label>${l.text("Visible on the product page")}</label>\n                        </div>`,"variable"===this.productType&&(t+=`<div>\n                                <input type="checkbox" class="attr-variation" ${e.variation?"checked":""} value="1">\n                                <label>${l.text("Used for variations")}</label>\n                            </div>`),`<tr class="vi-wbe-attribute-row" data-attr='${JSON.stringify(e)}'>\n                        <td class="vi-wbe-left">${t}</td>\n                        <td>${i}</td>\n                        <td class="vi-wbe-right"><i class="icon trash"> </i> <i class="icon move"> </i></td>\n                    </tr>`}},t.default_attributes={createCell:(e,t,i,a)=>(i&&s(e).text(Object.values(i).filter(Boolean).join("; ")),e),updateCell:(e,t,i,a,n)=>(t?s(e).text(Object.values(t).filter(Boolean).join("; ")):s(e).text(""),t),openEditor(t,i,n){let o=l.getDataFromCell(n,t),r=l.getProductTypeFromCell(t),d="";if(this.productType=r,"variable"===r){let i=l.createModal({header:l.text("Set default attributes"),content:"",actions:[{class:"save-attributes",text:l.text("Save")}]});s(t).append(i);let r=t.getAttribute("data-y"),c=a.idMappingFlip.attributes,u=n.options.data[r][c];if(Array.isArray(u)&&u.length)for(let e of u){if(0===e.options.length)continue;let t="",i="";if(e.is_taxonomy){let s=a.attributes[e.name];t=s.data.attribute_label;for(let t of e.options){let a=s.terms[t],n=a.slug===o[e.name]?"selected":"";i+=`<option value="${a.slug}" ${n}>${a.text}</option>`}}else{t=e.name;for(let t of e.options)i+=`<option value="${t}" ${t===o[e.name]?"selected":""}>${t}</option>`}i=`<option value="">No default ${t}</option> ${i}`,d+=`<tr><td>${t}</td><td><select name="${e.name}" class="vi-wbe-default-attribute">${i}</select></td></tr>`}i.find(".content").append(e.defaultAttributes({html:d})),i.on("click",(function(e){let i=s(e.target);(i.hasClass("close")||i.hasClass("vi-wbe-modal-container"))&&n.closeEditor(t,!1),i.hasClass("save-attributes")&&n.closeEditor(t,!0)}))}},closeEditor(e,t){let i={};return!0===t&&s(e).find(".vi-wbe-default-attribute").each(((e,t)=>i[s(t).attr("name")]=s(t).val())),l.removeModal(e),i}},t.array={createCell:(e,t,i,a)=>(s(e).html('<i class="icon edit"/>'),e),closeEditor(e,t){let i=[];return!0===t&&(i=this.editor.get()),l.removeModal(e),i},openEditor(e,t,i){let a=l.getDataFromCell(i,e),n=l.createModal({header:l.text("Edit metadata"),content:"",actions:[{class:"save-metadata",text:l.text("Save")}]});s(e).append(n),n.find(".content").html('<div id="vi-wbe-jsoneditor"></div>');let o=n.find("#vi-wbe-jsoneditor").get(0);this.editor=new JSONEditor(o,{enableSort:!1,search:!1,enableTransform:!1}),this.editor.set(a),n.on("click",(function(t){let a=s(t.target);(a.hasClass("close")||a.hasClass("vi-wbe-modal-container"))&&i.closeEditor(e,!1),a.hasClass("save-metadata")&&i.closeEditor(e,!0)}))},updateCell:(e,t,i)=>t},t.order_notes={createCell(e,t,i,a){let n=i.length?"vi-wbe-gallery-has-item":"";return s(e).html(`<div class="${n}"><i class="icon eye"/></div>`),this.obj=a,e},closeEditor(e,t){return s(e).find(".vi-wbe-cell-popup").remove(),this.notes},openEditor(e,t,i){let a=e.getAttribute("data-y"),n=e.getAttribute("data-x"),o=i.options.data[a][n],r="";if(this.notes=o,o.length)for(let e of o){let t=e.content.replace(/(?:\r\n|\r|\n)/g,"<br>");r+=`<div class="vi-wbe-note-row">\n                                <div class="vi-wbe-note-row-content ${e.customer_note?"customer":"system"===e.added_by?"system":"private"}">${t}</div>\n                                <span class="vi-wbe-note-row-meta">\n                                    ${e.date}\n                                    <a href="#" data-comment_id="${e.id}" class="vi-wbe-note-row-delete">${l.text("Delete")}</a>\n                                </span>\n                            </div>`}let d=s(`<div class="vi-wbe-cell-popup-inner">${r}</div>`);l.createEditor(e,"div",d),d.on("click",".vi-wbe-note-row-delete",(function(){let e=s(this),t=e.data("comment_id");t&&l.ajax({data:{sub_action:"delete_order_note",id:t},beforeSend(){l.loading()},success(i){if(i.success){let i=o.findIndex((e=>e.id===t));o.splice(i,1),e.closest(".vi-wbe-note-row").remove()}l.removeLoading()}})}))},updateCell:(e,t,i)=>t},t.select2={type:"select2",createCell(e,t,i,a){let{source:s}=a.options.columns[t],n=[];return Array.isArray(s)&&s.length&&(n=s.filter((e=>i.includes(e.id)))),l.formatText(e,n),e},openEditor(e,t,i){let a=e.getAttribute("data-y"),n=e.getAttribute("data-x"),o=i.options.data[a][n],r=s("<select/>"),{source:d,multiple:c,placeholder:u}=i.options.columns[n],p=l.createEditor(e,"div",r);r.select2({data:d||[],multiple:c,placeholder:u}),r.val(o).trigger("change"),s(p).find(".select2-search__field").trigger("click")},closeEditor(e,t){let i=s(e).children(),a=i.find("select").val();return a=a.map((e=>isNaN(e)?e:+e)),i.remove(),s(".select2-container").remove(),a},updateCell(e,t,i,a,s){let{source:n}=a.options.columns[s],o=[];return Array.isArray(n)&&n.length&&(o=n.filter((e=>t.includes(e.id)))),l.formatText(e,o),t}},i.sourceForVariation=(e,t,i,a,s)=>{let n=s.options.columns[i].source;return"variation"===l.getProductTypeFromCell(t)&&(n=s.options.columns[i].subSource),n}}));const a={...wbeParams,productTypes:{},filterKey:Date.now(),selectPage:1,ajaxData:{action:"vi_wbe_ajax",vi_wbe_nonce:wbeParams.nonce},tinyMceOptions:{tinymce:{theme:"modern",skin:"lightgray",language:"en",formats:{alignleft:[{selector:"p,h1,h2,h3,h4,h5,h6,td,th,div,ul,ol,li",styles:{textAlign:"left"}},{selector:"img,table,dl.wp-caption",classes:"alignleft"}],aligncenter:[{selector:"p,h1,h2,h3,h4,h5,h6,td,th,div,ul,ol,li",styles:{textAlign:"center"}},{selector:"img,table,dl.wp-caption",classes:"aligncenter"}],alignright:[{selector:"p,h1,h2,h3,h4,h5,h6,td,th,div,ul,ol,li",styles:{textAlign:"right"}},{selector:"img,table,dl.wp-caption",classes:"alignright"}],strikethrough:{inline:"del"}},relative_urls:!1,remove_script_host:!1,convert_urls:!1,browser_spellcheck:!0,fix_list_elements:!0,entities:"38,amp,60,lt,62,gt",entity_encoding:"raw",keep_styles:!1,cache_suffix:"wp-mce-49110-20201110",resize:"vertical",menubar:!1,branding:!1,preview_styles:"font-family font-size font-weight font-style text-decoration text-transform",end_container_on_empty_block:!0,wpeditimage_html5_captions:!0,wp_lang_attr:"en-US",wp_keep_scroll_position:!1,wp_shortcut_labels:{"Heading 1":"access1","Heading 2":"access2","Heading 3":"access3","Heading 4":"access4","Heading 5":"access5","Heading 6":"access6",Paragraph:"access7",Blockquote:"accessQ",Underline:"metaU",Strikethrough:"accessD",Bold:"metaB",Italic:"metaI",Code:"accessX","Align center":"accessC","Align right":"accessR","Align left":"accessL",Justify:"accessJ",Cut:"metaX",Copy:"metaC",Paste:"metaV","Select all":"metaA",Undo:"metaZ",Redo:"metaY","Bullet list":"accessU","Numbered list":"accessO","Insert/edit image":"accessM","Insert/edit link":"metaK","Remove link":"accessS","Toolbar Toggle":"accessZ","Insert Read More tag":"accessT","Insert Page Break tag":"accessP","Distraction-free writing mode":"accessW","Add Media":"accessM","Keyboard Shortcuts":"accessH"},plugins:"charmap,colorpicker,hr,lists,media,paste,tabfocus,textcolor,fullscreen,wordpress,wpautoresize,wpeditimage,wpemoji,wpgallery,wplink,wpdialogs,wptextpattern,wpview",selector:"#vi-wbe-text-editor",wpautop:!0,indent:!1,toolbar1:"formatselect,bold,italic,bullist,numlist,blockquote,alignleft,aligncenter,alignright,link,wp_more,spellchecker,fullscreen,wp_adv",toolbar2:"strikethrough,hr,forecolor,pastetext,removeformat,charmap,outdent,indent,undo,redo,wp_help",tabfocus_elements:":prev,:next",body_class:"excerpt post-type-product post-status-publish page-template-default locale-en-us"},mediaButtons:!0,quicktags:!0},setColumns(e){try{let s=JSON.parse(e);a.columns=s.map((e=>(e&&e.editor&&t[e.editor]&&(e.editor=t[e.editor]),e&&e.filter&&i[e.filter]&&(e.filter=i[e.filter]),e)))}catch(e){console.log(e)}}};window.Attributes=a;const s=wbeI18n.i18n,n=jQuery,l={setJexcel(e){this.jexcel=e},text:e=>s[e]||e,isUrl:e=>/^(http(s?):)\/\/.*\.(?:jpg|jpeg|gif|png|webp)$/i.test(e),formatText(e,t){let i="";if(t.length)for(let e=0;e<t.length;e++)t[e]&&(i+=t[e].text+"; ");e.innerText=i},createEditor(e,t,i="",a=!0){let s=document.createElement(t);"div"===t&&n(s).append(i),s.style.minWidth="300px";let l=n(s).innerHeight(),o=n(e).offset(),r=o.left,d=o.top,c=n(e).innerWidth(),u=e.getBoundingClientRect();a?(s.style.minHeight=u.height-2+"px",s.style.maxHeight=window.innerHeight-d-50+"px"):(s.style.opacity=0,s.style.fontSize=0),s.classList.add("vi-ui","segment","vi-wbe-cell-popup","vi-wbe-editing"),e.classList.add("editor"),e.appendChild(s);let p=n(s).innerWidth();if(n(this.jexcel.el).innerWidth()<r+p+c){let e=r-p>0?r-p:10;n(s).css("left",e+"px")}else n(s).css("left",r+c+"px");if(window.innerHeight<d+l){let e=d-l<0?0:d-l;n(s).css("top",e+"px")}else n(s).css("top",d+"px");return s},createModal(t={}){let{actions:i}=t,a="";if(Array.isArray(i))for(let e of i)a+=`<span class="${e.class} vi-ui button tiny">${e.text}</span>`;return n(e.modal({...t,actionsHtml:a}))},removeModal(e){n(e).find(".vi-wbe-modal-container").remove(),n(".select2-container--open").remove()},getColFromColumnType:e=>a.idMappingFlip[e]||"",getProductTypeFromCell(e){let t=e.getAttribute("data-y"),i=this.getColFromColumnType("product_type");return this.jexcel.options.data[t][i]},getProductTypeFromY(e){let t=this.getColFromColumnType("product_type");return this.jexcel.options.data[e][t]},getColumnType:e=>a.idMapping[e],stripHtml:e=>n(`<div>${e}</div>`).text(),getDataFromCell(e,t){let i=t.getAttribute("data-y"),a=t.getAttribute("data-x");return e.options.data[i][a]},getProductIdOfCell(e,t){if("object"==typeof t){let i=t.getAttribute("data-y");return e.options.data[i][0]}return e.options.data[t][0]},ajax(e={}){let t=Object.assign({url:wbeParams.ajaxUrl,type:"post",dataType:"json"},e);t.data.action="vi_wbe_ajax",t.data.vi_wbe_nonce=wbeParams.nonce,t.data.type=wbeParams.editType,n.ajax(t)},pagination(e,t){let i="",a=`<a class="item ${1===(t=parseInt(t))?"disabled":""}" data-page="${t-1}"><i class="icon angle left"> </i></a>`,s=`<a class="item ${t===(e=parseInt(e))?"disabled":""}" data-page="${t+1}"><i class="icon angle right"> </i></a>`,n=`<input type="number" class="vi-wbe-go-to-page" value="${t}" min="1" max="${e}"/>`;for(let a=1;a<=e;a++)[1,t-1,t,t+1,e].includes(a)&&(i+=`<a class="item ${t===a?"active":""}" data-page="${a}">${a}</a>`),a===t-2&&t-2>1&&(i+='<a class="item disabled">...</a>'),a===t+2&&t+2<e&&(i+='<a class="item disabled">...</a>');return`<div class="vi-ui pagination menu">${a} ${i} ${s} </div> ${n}`},spinner:()=>n('<span class="vi-wbe-spinner"><span class="vi-wbe-spinner-inner"> </span></span>'),is_loading(){return!!this._spinner},loading(){this._spinner=this.spinner(),n(".vi-wbe-menu-bar-center").html(this._spinner)},removeLoading(){this._spinner=null,n(".vi-wbe-menu-bar-center").html("")},notice(e,t="black"){let i=n(`<div class="vi-wbe-notice" style="color:${t}">${e}</div>`);n(".vi-wbe-menu-bar-center").html(i),setTimeout((function(){i.remove()}),5e3)},generateCouponCode(){let e="";for(var t=0;t<a.couponGenerate.char_length;t++)e+=a.couponGenerate.characters.charAt(Math.floor(Math.random()*a.couponGenerate.characters.length));return e=a.couponGenerate.prefix+e+a.couponGenerate.suffix,e}},o=jQuery;let r=null;class d{constructor(e,t){r||o("body").on("mousedown keydown",this.mousedown),r=this,this.popup=o(".vi-wbe-context-popup"),this.render(e,o(t))}mousedown(e){let t=o(e.target),i=o(".vi-wbe-context-popup");(27===e.which||!t.hasClass("vi-wbe-context-popup")&&0===t.closest(".vi-wbe-context-popup").length&&i.hasClass("vi-wbe-popup-active")&&!t.hasClass("select2-search__field"))&&(i.empty().removeClass("vi-wbe-popup-active"),o(".select2-container.select2-container--default.select2-container--open").remove())}render(e,t){let{popup:i}=this,a=t.offset(),s=a.left,n=a.top,l=t.innerWidth();i.empty(),i.addClass("vi-wbe-popup-active").html(e);let r=i.innerWidth(),d=i.innerHeight();if(window.innerWidth<s+r+l){let e=s-r>0?s-r:10;i.css("left",e+"px")}else i.css("left",s+l+"px");if(o("#vi-wbe-editor").innerHeight()<n+d){let e=n-d<0?0:n-d;i.css("top",e+"px")}else i.css("top",n+"px")}hide(){this.popup.removeClass("vi-wbe-popup-active")}}const c=jQuery;class u{constructor(e,t,i,a){this._data={},this._data.jexcel=e,this._data.x=parseInt(t),this._data.y=parseInt(i),this.run()}get(e){return this._data[e]||""}run(){let e=this.content(),t=c(`td[data-x=${this.get("x")||0}][data-y=${this.get("y")||0}]`);new d(e,t),e.on("click",".vi-wbe-apply-formula",this.applyFormula.bind(this)),e.on("change",".vi-wbe-rounded",this.toggleDecimalValue)}content(){return c(`<div class="vi-wbe-formula-container" style="display: flex;">\n                    <select class="vi-wbe-operator">\n                        <option value="+">+</option>\n                        <option value="-">-</option>\n                    </select>\n                    <input type="number" min="0" class="vi-wbe-value">\n                    <select class="vi-wbe-unit">\n                        <option value="fixed">n</option>\n                        <option value="percentage">%</option>\n                    </select>\n                    <select class="vi-wbe-rounded">\n                        <option value="no_round">${l.text("No round")}</option>\n                        <option value="round">${l.text("Round with decimal")}</option>\n                        <option value="round_up">${l.text("Round up")}</option>\n                        <option value="round_down">${l.text("Round down")}</option>\n                    </select>\n                    <input type="number" min="0" max="10" class="vi-wbe-decimal" value="0">\n                    <button type="button" class="vi-ui button mini vi-wbe-apply-formula">${l.text("OK")}</button>\n                </div>`)}applyFormula(e){let t=c(e.target).closest(".vi-wbe-formula-container"),i=t.find(".vi-wbe-operator").val(),a=parseFloat(t.find(".vi-wbe-value").val()),s=t.find(".vi-wbe-unit").val(),n=t.find(".vi-wbe-rounded").val(),l=parseInt(t.find(".vi-wbe-decimal").val()),o=this.get("jexcel");if(!a)return;let r=[],d=o.selectedContainer,u=d[1],p=d[3],h=d[0];function v(e){e=parseFloat(e);let t="percentage"===s?e*a/100:a,o="-"===i?e-t:e+t;switch(n){case"round":o=o.toFixed(l);break;case"round_up":o=Math.ceil(o);break;case"round_down":o=Math.floor(o)}return o}for(let e=u;e<=p;e++)if(o.records[e][h]&&!o.records[e][h].classList.contains("readonly")&&"none"!==o.records[e][h].style.display){let t=o.options.data[e][h]||0;r.push(o.updateCell(h,e,v(t))),o.updateFormulaChain(h,e,r)}o.setHistory({action:"setValue",records:r,selection:o.selectedCell}),o.updateTable()}toggleDecimalValue(){let e=c(this).closest(".vi-wbe-formula-container");e.find(".vi-wbe-decimal").hide(),"round"===c(this).val()&&e.find(".vi-wbe-decimal").show()}}class p{constructor(e,t,i,a){this._data={},this._data.jexcel=e,this._data.x=parseInt(t),this._data.y=parseInt(i),this.run()}get(e){return this._data[e]||""}run(){let e=this.content(),t=c(`td[data-x=${this.get("x")||0}][data-y=${this.get("y")||0}]`);new d(e,t),e.on("click",".vi-wbe-apply-formula",this.applyFormula.bind(this)),e.on("change",".vi-wbe-rounded",this.toggleDecimalValue)}content(){return c(`<div class="vi-wbe-formula-container" style="display: flex;">\n                    <span class="vi-wbe-operator vi-ui button basic small icon"><i class="icon minus"> </i></span>\n                    <input type="number" min="0" class="vi-wbe-value">\n                    <select class="vi-wbe-unit">\n                        <option value="percentage">%</option>\n                        <option value="fixed">n</option>\n                    </select>\n                    <select class="vi-wbe-rounded">\n                        <option value="no_round">${l.text("No round")}</option>\n                        <option value="round">${l.text("Round with decimal")}</option>\n                        <option value="round_up">${l.text("Round up")}</option>\n                        <option value="round_down">${l.text("Round down")}</option>\n                    </select>\n                    <input type="number" min="0" max="10" class="vi-wbe-decimal" value="0">\n                    <button type="button" class="vi-ui button mini vi-wbe-apply-formula">${l.text("OK")}</button>\n                </div>`)}applyFormula(e){let t=c(e.target).closest(".vi-wbe-formula-container"),i=parseFloat(t.find(".vi-wbe-value").val()),a=t.find(".vi-wbe-unit").val(),s=t.find(".vi-wbe-rounded").val(),n=parseInt(t.find(".vi-wbe-decimal").val()),l=this.get("jexcel");if(!i)return;let o=[],r=l.selectedContainer,d=r[1],u=r[3],p=r[0];function h(e){let t=(e=parseFloat(e))-("percentage"===a?e*i/100:i);switch(t=t>0?t:0,s){case"round":t=t.toFixed(n);break;case"round_up":t=Math.ceil(t);break;case"round_down":t=Math.floor(t)}return t}for(let e=d;e<=u;e++)if(l.records[e][p]&&!l.records[e][p].classList.contains("readonly")&&"none"!==l.records[e][p].style.display){let t=l.options.data[e][p-1]||0;o.push(l.updateCell(p,e,h(t))),l.updateFormulaChain(p,e,o)}l.setHistory({action:"setValue",records:o,selection:l.selectedCell}),l.updateTable()}toggleDecimalValue(){let e=c(this).closest(".vi-wbe-formula-container");e.find(".vi-wbe-decimal").hide(),"round"===c(this).val()&&e.find(".vi-wbe-decimal").show()}}const h=jQuery,v={init(){return h(".vi-ui.menu .item").vi_tab(),this.revision={},this.sidebar=h("#vi-wbe-sidebar"),this.historyBodyTable=h("#vi-wbe-history-points-list tbody"),this.sidebar.on("click",".vi-wbe-apply-filter",this.applyFilter.bind(this)),this.sidebar.on("click",".vi-wbe-filter-label",this.filterInputLabelFocus),this.sidebar.on("focus",".vi-wbe-filter-input",this.filterInputFocus),this.sidebar.on("blur",".vi-wbe-filter-input",this.filterInputBlur),this.sidebar.on("click",".vi-wbe-get-meta-fields",this.getMetaFields.bind(this)),this.sidebar.on("click",".vi-wbe-save-meta-fields:not(.loading)",this.saveMetaFields.bind(this)),this.sidebar.on("click",".vi-wbe-add-new-meta-field",this.addNewMetaField.bind(this)),this.sidebar.find("table.vi-wbe-meta-fields-container tbody").sortable({axis:"y"}),this.sidebar.find("table.vi-wbe-meta-fields-container").on("click",".vi-wbe-remove-meta-row",this.removeMetaRow),this.sidebar.on("click",".vi-wbe-save-taxonomy-fields:not(.loading)",this.saveTaxonomyFields),this.sidebar.on("click",".vi-wbe-save-settings",this.saveSettings.bind(this)),this.sidebar.on("click",".vi-wbe-view-history-point",this.viewHistoryPoint.bind(this)),this.sidebar.on("click",".vi-wbe-recover",this.recover.bind(this)),this.sidebar.on("click",".vi-wbe-revert-this-point",this.revertAllProducts.bind(this)),this.sidebar.on("click",".vi-wbe-revert-this-key",this.revertProductAttribute.bind(this)),this.sidebar.on("click",".vi-wbe-pagination a.item",this.changePage.bind(this)),this.sidebar.on("change",".vi-wbe-go-to-page",this.changePageByInput.bind(this)),this.sidebar.on("click",".vi-wbe-multi-select-clear",this.clearMultiSelect),this.sidebar.on("change",".vi-wbe-meta-column-type",this.metaFieldChangeType),this.sidebar.on("keyup",".vi-wbe-search-metakey",this.searchMetaKey),this.filter(),this.settings(),this.metafields(),this.history(),this.sidebar},filter(){let e=h("#vi-wbe-products-filter"),t=h(".vi-wbe-filter-input"),i={top:-2},a={top:"50%"};t.each(((e,t)=>{h(t).val()&&h(t).parent().prev().css(i)})),t.on("focus",(function(){let e=h(this).prev();e.css(i),h(this).on("blur",(function(){h(this).val()||e.css(a)}))})),this.sidebar.on("click",".vi-wbe-filter-label",(function(){h(this).next().trigger("focus")}));let s=e.find(".vi-wbe.vi-ui.dropdown").dropdown({clearable:!0}),n=e.find(".vi-ui.compact.dropdown").dropdown();this.sidebar.on("click",".vi-wbe-clear-filter",(function(){h(".vi-wbe-filter-label").css(a),t.val(""),s.dropdown("clear"),n.find(".menu .item:first").trigger("click")})),this.sidebar.on("change","#vi-wbe-has_expire_date",(function(){let e=h(".vi-wbe-expire-date-group");"yes"===h(this).val()?e.show():e.hide()})),this.sidebar.find("#vi-wbe-has_expire_date").trigger("change")},settings(){h(".vi-wbe-settings-tab").find("select.dropdown").dropdown()},metafields(){this.renderMetaFieldsTable(a.metaFields)},history(){this.pagination(1)},pagination(e,t=a.historyPages){this.sidebar.find(".vi-wbe-pagination").html(l.pagination(t,e))},applyFilter(e){let t=this,i=h(e.target);i.hasClass("loading")||l.ajax({data:{sub_action:"add_filter_data",filter_data:h("#vi-wbe-products-filter").serialize(),filter_key:a.filterKey},beforeSend(){i.addClass("loading")},success(e){i.removeClass("loading"),t.sidebar.trigger("afterAddFilter",[e.data])}})},limitProductPerPage(){let e=h(this).val();e>50&&h(this).val(50),e<0&&h(this).val(0)},saveSettings(e){let t=this,i=h(e.target);i.hasClass("loading")||l.ajax({data:{sub_action:"save_settings",fields:h("form.vi-wbe-settings-tab").serialize()},beforeSend(){i.addClass("loading")},success(e){e.success&&(a.settings=e.data.settings,t.sidebar.trigger("afterSaveSettings",[e.data])),i.removeClass("loading")}})},filterInputLabelFocus(){h(this).next().find("input").trigger("focus")},filterInputFocus(){h(this).parent().prev().css({top:-2})},filterInputBlur(){h(this).val()||h(this).parent().prev().css({top:"50%"})},getMetaFields(e){let t=this,i=h(e.target);i.hasClass("loading")||l.ajax({data:{sub_action:"get_meta_fields",current_meta_fields:t.getCurrentMetaFields()},beforeSend(){i.addClass("loading")},success(e){t.renderMetaFieldsTable(e.data),a.metaFields=e.data,i.removeClass("loading")}})},renderMetaFieldsTable(e){let t="";for(let i in e)t+=this.renderRow(i,e);h(".vi-wbe-meta-fields-container tbody").html(t)},renderRow(e,t){let i=t[e]||{},a="",s=i.input_type||"",n={textinput:"Text input",texteditor:"Text editor",numberinput:"Number input",array:"Array",json:"JSON",checkbox:"Checkbox",calendar:"Calendar",image:"Image",select:"Select",multiselect:"Multiselect"},l=i.meta_value||"",o=l.slice(0,15),r=l.length>16?`<div class="vi-wbe-full-meta-value">${l}</div>`:"",d="";for(let e in n)a+=`<option value="${e}" ${e===s?"selected":""}>${n[e]}</option>`;return o+=o.length<l.length?"...":"","select"!==s&&"multiselect"!==s||(d+=`<textarea class="vi-wbe-select-options">${i.select_options}</textarea>`),`<tr>\n                    <td class="vi-wbe-meta-key">${e}</td>\n                    <td><input type="text" class="vi-wbe-meta-column-name" value="${i.column_name||""}"></td>\n                    <td>\n                        <div class="vi-wbe-display-meta-value">\n                            <div class="vi-wbe-short-meta-value">${o}</div>\n                            ${r}\n                        </div>\n                    </td>\n                    <td>\n                        <select class="vi-wbe-meta-column-type">${a}</select>\n                        ${d}\n                    </td>\n                    <td class="vi-wbe-meta-field-active-column">\n                        <div class="vi-ui toggle checkbox">\n                          <input type="checkbox" class="vi-wbe-meta-column-active" ${parseInt(i.active)?"checked":""}>\n                          <label> </label>\n                        </div>  \n                    </td>\n                    <td>\n                        <div class="vi-wbe-meta-field-actions">\n                            <span class="vi-ui button basic mini vi-wbe-remove-meta-row"><i class="icon trash"> </i></span>\n                            <span class="vi-ui button basic mini"><i class="icon move"> </i></span>\n                        </div>\n                    </td>\n                </tr>`},metaFieldChangeType(){let e=h('<textarea class="vi-wbe-select-options"></textarea>'),t=h(this).val(),i=h(this).siblings();"select"===t||"multiselect"===t?i.length||h(this).after(e):i.remove()},searchMetaKey(){let e=h(this).val().toLowerCase();h(".vi-wbe-meta-fields-container tbody tr").each((function(t,i){h(i).find(".vi-wbe-meta-key").text().trim().toLowerCase().indexOf(e)>-1?h(i).show():h(i).hide()}))},saveMetaFields(e){let t=h(e.target);t.hasClass("loading")||l.ajax({data:{sub_action:"save_meta_fields",meta_fields:this.getCurrentMetaFields()},beforeSend(){t.addClass("loading")},success(e){t.removeClass("loading"),location.reload()},error(e){console.log(e)}})},getCurrentMetaFields(){let e={},t=a.metaFields;return h("table.vi-wbe-meta-fields-container tbody tr").each((function(i,a){let s=h(a).find(".vi-wbe-meta-key").text();e[s]={column_name:h(a).find(".vi-wbe-meta-column-name").val(),input_type:h(a).find(".vi-wbe-meta-column-type").val(),active:h(a).find(".vi-wbe-meta-column-active:checked").length,meta_value:t[s]?t[s].meta_value:"",select_options:h(a).find(".vi-wbe-select-options").val()}})),e},addNewMetaField(e){let t=h(e.currentTarget).prev(),i=t.val(),s=i.match(/^[\w\d_-]*$/g);if(!i||!s||a.metaFields[i])return;let n=this.renderRow(i,{});n&&(t.val(""),h("table.vi-wbe-meta-fields-container tbody").append(n))},removeMetaRow(){h(this).closest("tr").remove()},saveTaxonomyFields(e){let t=h(e.target),i=[];h("table.vi-wbe-taxonomy-fields .vi-wbe-taxonomy-active:checked").each((function(e,t){let a=h(this).closest("tr").find(".vi-wbe-taxonomy-key").text();i.push(a)})),i.length&&l.ajax({data:{sub_action:"save_taxonomy_fields",taxonomy_fields:i},beforeSend(){t.addClass("loading")},success(e){t.removeClass("loading"),location.reload()},error(e){console.log(e)}})},viewHistoryPoint(e){let t=h(e.currentTarget),i=t.data("id"),a=this;t.hasClass("loading")||l.ajax({data:{sub_action:"view_history_point",id:i},beforeSend(){t.addClass("loading")},complete(){},success(e){if(t.removeClass("loading"),e.success&&e.data){let t=e.data.compare,s="";for(let e in t){let i=t[e];s+=`<div class="vi-wbe-history-product" data-product_id="${e}">\n                                        <div class="title">\n                                            <i class="dropdown icon"></i>\n                                            ${i.name}\n                                            <span class="vi-ui button mini basic vi-wbe-revert-this-product">\n                                                <i class="icon undo"> </i>\n                                            </span>\n                                            \n                                        </div>`;let a="";for(let t in i.fields){let s="string"==typeof i.current[t]?i.current[t]:JSON.stringify(i.current[t]),n="string"==typeof i.history[t]?i.history[t]:JSON.stringify(i.history[t]);a+=`<tr>\n                                            <td>${i.fields[t]}</td>\n                                            <td>${s}</td>\n                                            <td>${n}</td>\n                                            <td class="">\n                                                <span class="vi-ui button basic mini vi-wbe-revert-this-key" data-product_id="${e}" data-product_key="${t}">\n                                                    <i class="icon undo"> </i>\n                                                </span>\n                                            </td>\n                                        </tr>`}a=`<table id="vi-wbe-history-point-detail" class="vi-ui celled table">\n                                    <thead>\n                                    <tr>\n                                        <th>Attribute</th>\n                                        <th>Current</th>\n                                        <th>History</th>\n                                        <th class="">Revert</th>\n                                    </tr>\n                                    </thead>\n                                    <tbody>\n                                    ${a}\n                                    </tbody>\n                                </table>`,s+=`<div class="content">${a}</div></div>`}s=h(`<div class="vi-ui styled fluid accordion">${s}</div>`),h(".vi-wbe-history-review").html(s).attr("data-history_id",i).prepend(`<h4>History point: ${e.data.date}</h4>`).append(`<div class="vi-ui button tiny vi-wbe-revert-this-point">\n                                    ${l.text("Revert all product in this point")}\n                                </div>\n                                <p> ${l.text("The current value is the value of the records in database")}</p>`),s.find(".title").on("click",(e=>a.revertSingleProduct(e))),s.vi_accordion(),s.find(".title:first").trigger("click")}}})},recover(e){let t=h(e.currentTarget),i=t.data("id");t.hasClass("loading")||l.ajax({data:{sub_action:"revert_history_all_products",history_id:i},beforeSend(){t.addClass("loading")},complete(){t.removeClass("loading")},success(e){console.log(e)}})},revertSingleProduct(e){let t;if(h(e.target).hasClass("vi-wbe-revert-this-product")&&(t=h(e.target)),h(e.target).parent().hasClass("vi-wbe-revert-this-product")&&(t=h(e.target).parent()),t){e.stopImmediatePropagation();let i=t.closest(".vi-wbe-history-product").data("product_id"),a=t.closest(".vi-wbe-history-review").data("history_id");if(t.hasClass("loading"))return;l.ajax({data:{sub_action:"revert_history_single_product",history_id:a,pid:i},beforeSend(){t.addClass("loading")},complete(){t.removeClass("loading")},success(e){console.log(e)}})}},revertAllProducts(e){let t=h(e.target),i=t.closest(".vi-wbe-history-review").data("history_id");t.hasClass("loading")||l.ajax({data:{sub_action:"revert_history_all_products",history_id:i},beforeSend(){t.addClass("loading")},complete(){t.removeClass("loading")},success(e){console.log(e)}})},revertProductAttribute(e){let t=h(e.currentTarget),i=t.data("product_key"),a=t.closest(".vi-wbe-history-product").data("product_id"),s=t.closest(".vi-wbe-history-review").data("history_id");t.hasClass("loading")||l.ajax({data:{sub_action:"revert_history_product_attribute",attribute:i,history_id:s,pid:a},beforeSend(){t.addClass("loading")},complete(){t.removeClass("loading")},success(e){console.log(e)}})},changePage(e){let t=parseInt(h(e.currentTarget).attr("data-page"));h(e.currentTarget).hasClass("active")||h(e.currentTarget).hasClass("disabled")||!t||this.loadHistoryPage(t)},changePageByInput(e){let t=parseInt(h(e.target).val());t<=parseInt(h(e.target).attr("max"))&&t>0&&this.loadHistoryPage(t)},clearMultiSelect(){h(this).parent().find(".vi-ui.dropdown").dropdown("clear")},loadHistoryPage(e){let t=l.spinner(),i=this;e&&l.ajax({dataType:"text",data:{sub_action:"load_history_page",page:e},beforeSend(){i.sidebar.find(".vi-wbe-pagination").prepend(t)},complete(){t.remove()},success(t){i.pagination(e),h("#vi-wbe-history-points-list tbody").html(t)}})}},b=jQuery;class m{constructor(e,t,i,a){this._data={},this._data.jexcel=e,this._data.x=parseInt(t),this._data.y=parseInt(i),this.run()}get(e){return this._data[e]||""}run(){let e=this.content(),t=b(`td[data-x=${this.get("x")||0}][data-y=${this.get("y")||0}]`);new d(e,t),e.on("click",".vi-wbe-apply-formula",this.applyFormula.bind(this))}content(){return b(`<div class="vi-wbe-formula-container">\n                    <div class="field">\n                        <input type="text" placeholder="${l.text("Find")}" class="vi-wbe-find-string">\n                    </div>\n                    <div class="field">\n                        <input type="text" placeholder="${l.text("Replace")}" class="vi-wbe-replace-string">\n                    </div>\n                    <button type="button" class="vi-ui button mini vi-wbe-apply-formula">${l.text("Replace")}</button>\n                </div>`)}applyFormula(e){let t=b(e.target).closest(".vi-wbe-formula-container"),i=t.find(".vi-wbe-find-string").val(),a=t.find(".vi-wbe-replace-string").val(),s=this.get("jexcel");if(!i)return;let n=[],l=s.selectedContainer,o=l[1],r=l[3],d=l[0];for(let e=o;e<=r;e++)if(s.records[e][d]&&!s.records[e][d].classList.contains("readonly")&&"none"!==s.records[e][d].style.display){let t=s.options.data[e][d].replaceAll(i,a);n.push(s.updateCell(d,e,t)),s.updateFormulaChain(d,e,n)}s.setHistory({action:"setValue",records:n,selection:s.selectedCell}),s.updateTable()}}const g=jQuery;class f{constructor(e,t,i,a,s){this._data={},this._data.jexcel=e,this._data.x=parseInt(t),this._data.y=parseInt(i),this._wordWrap=s,this.run()}get(e){return this._data[e]||""}run(){let e=this.content(),t=g(`td[data-x=${this.get("x")||0}][data-y=${this.get("y")||0}]`);new d(e,t),e.on("click",".vi-wbe-apply-formula",this.applyFormula.bind(this))}content(){let e=this._wordWrap?'<textarea class="vi-wbe-text-input" rows="3"></textarea>':`<input type="text" placeholder="${l.text("Content")}" class="vi-wbe-text-input">`;return g(`<div class="vi-wbe-formula-container">\n                    <div class="field">\n                        ${e}\n                    </div>\n                    <button type="button" class="vi-ui button mini vi-wbe-apply-formula">${l.text("Save")}</button>\n                </div>`)}applyFormula(e){let t=g(e.target).closest(".vi-wbe-formula-container").find(".vi-wbe-text-input").val(),i=this.get("jexcel"),a=[],s=i.selectedContainer,n=s[1],l=s[3],o=s[0];for(let e=n;e<=l;e++)i.records[e][o]&&!i.records[e][o].classList.contains("readonly")&&"none"!==i.records[e][o].style.display&&(a.push(i.updateCell(o,e,t)),i.updateFormulaChain(o,e,a));i.setHistory({action:"setValue",records:a,selection:i.selectedCell}),i.updateTable()}}const w=jQuery;class y{constructor(e,t,i,a,s){this.cells=t,this.obj=e,this.x=parseInt(i),this.y=parseInt(a),this.searchData=[],this.run()}run(){let e=this,t=this.content(),i=this.cells[1],s=this.cells[3],n=[{id:"",text:""}];for(let e=i;e<=s;e++){let t=this.obj.options.data[e][this.x];n.push(...t)}n=n.filter(((e,t,i)=>t===i.findIndex((t=>t.id===e.id&&t.text===e.text))));let l=w(`td[data-x=${this.x||0}][data-y=${this.y||0}]`);new d(t,l),t.find(".vi-wbe-find-string").select2({data:n}),t.find(".vi-wbe-replace-string").select2({multiple:!1,minimumInputLength:3,ajax:{url:a.ajaxUrl,type:"post",data:function(e){return{...a.ajaxData,sub_action:"search_tags",search:e.term,type:"public"}},processResults:function(t){return e.searchData=t,{results:t}}}}),t.on("click",".vi-wbe-apply-formula",this.applyFormula.bind(this))}content(){return w(`<div class="vi-wbe-formula-container">\n                    <div class="field">\n                        <div>${l.text("Find")}</div>\n                        <select placeholder="" class="vi-wbe-find-string"> </select>\n                    </div>\n                    <div class="field">\n                        <div>${l.text("Replace")}</div>\n                        <select placeholder="" class="vi-wbe-replace-string"> </select>\n                    </div>\n                    <button type="button" class="vi-ui button mini vi-wbe-apply-formula">${l.text("Replace")}</button>\n                    <p>If 'Find' value is empty, add to selected cells with 'Replace' value.</p>\n                    <p>If 'Replace' value is empty, remove from selected cells with 'Find' value.</p>\n                </div>`)}applyFormula(e){let t=w(e.target).closest(".vi-wbe-formula-container"),i=t.find(".vi-wbe-find-string").val(),a=t.find(".vi-wbe-replace-string").val(),s=this.obj;if(!i&&!a)return;let n=this.searchData.filter((e=>e.id===+a)),l=[],o=this.cells,r=o[1],d=o[3],c=o[0];for(let e=r;e<=d;e++)if(s.records[e][c]&&!s.records[e][c].classList.contains("readonly")&&"none"!==s.records[e][c].style.display){let t=s.options.data[e][c];t||(t=[]);let a=t.filter((e=>e.id!==+i));t.length===a.length&&i||a.push(...n),a=a.filter(((e,t,i)=>t===i.findIndex((t=>t.id===e.id&&t.text===e.text)))),l.push(s.updateCell(c,e,a)),s.updateFormulaChain(c,e,l)}s.setHistory({action:"setValue",records:l,selection:s.selectedCell}),s.updateTable()}}const x=jQuery;class C{constructor(e,t,i,a,s){this.cells=t,this.obj=e,this.x=parseInt(i),this.y=parseInt(a),this.searchData=[],this.source=e.options.columns[i].source||[],this.run()}run(){let e=this.content(),t=x(`td[data-x=${this.x||0}][data-y=${this.y||0}]`);new d(e,t),e.find(".vi-wbe-find-string").select2({data:[{id:"",text:""},...this.source]}),e.find(".vi-wbe-replace-string").select2({data:[{id:"",text:""},...this.source]}),e.on("click",".vi-wbe-apply-formula",this.applyFormula.bind(this))}content(){return x(`<div class="vi-wbe-formula-container">\n                    <div class="field">\n                        <div>${l.text("Find")}</div>\n                        <select placeholder="" class="vi-wbe-find-string"> </select>\n                    </div>\n                    <div class="field">\n                        <div>${l.text("Replace")}</div>\n                        <select placeholder="" class="vi-wbe-replace-string"> </select>\n                    </div>\n                    <button type="button" class="vi-ui button mini vi-wbe-apply-formula">${l.text("Replace")}</button>\n                    <p>If 'Find' value is empty, add to selected cells with 'Replace' value.</p>\n                    <p>If 'Replace' value is empty, remove from selected cells with 'Find' value.</p>\n                </div>`)}applyFormula(e){let t=x(e.target).closest(".vi-wbe-formula-container"),i=t.find(".vi-wbe-find-string").val(),a=t.find(".vi-wbe-replace-string").val(),s=this.obj;if(!i&&!a)return;i=isNaN(i)?i:+i,a=isNaN(a)?a:+a;let n=[],l=this.cells,o=l[1],r=l[3],d=l[0];for(let e=o;e<=r;e++)if(s.records[e][d]&&!s.records[e][d].classList.contains("readonly")&&"none"!==s.records[e][d].style.display){let t=s.options.data[e][d];t||(t=[]);let l=t.filter((e=>e!==i));t.length===l.length&&i||l.push(a),l=[...new Set(l)],n.push(s.updateCell(d,e,l)),s.updateFormulaChain(d,e,n)}s.setHistory({action:"setValue",records:n,selection:s.selectedCell}),s.updateTable()}}class _{constructor(e,t,i,a,s){this.cells=t,this.obj=e,this.x=parseInt(i),this.y=parseInt(a),this.run()}run(){let e=this;const t=wp.media({multiple:!0});t.open().off("select close").on("select",(function(i){t.state().get("selection").each((function(t){if("image"===(t=t.toJSON()).type){let i=t.id;a.imgStorage[i]=t.url,e.addImage(i)}}))}))}addImage(e){let t=this.obj,i=[],a=this.cells,s=a[1],n=a[3],l=a[0];for(let a=s;a<=n;a++)if(t.records[a][l]&&!t.records[a][l].classList.contains("readonly")&&"none"!==t.records[a][l].style.display){let s=t.options.data[a][l];s||(s=[]);let n=[...new Set(s)];n.push(e),i.push(t.updateCell(l,a,n)),t.updateFormulaChain(l,a,i)}t.setHistory({action:"setValue",records:i,selection:t.selectedCell}),t.updateTable()}}const k=jQuery;class ${constructor(e,t,i,a,s){this.cells=t,this.obj=e,this.x=parseInt(i),this.y=parseInt(a),this.run()}run(){let e=k(`td[data-x=${this.x||0}][data-y=${this.y||0}]`),t=this,i=l.createModal({header:l.text("Attributes"),content:"",actions:[{class:"save-attributes",text:l.text("Apply")}]});this.content(i),k(e).append(i),i.on("click",(function(e){let a=k(e.target);(a.hasClass("close")||a.hasClass("vi-wbe-modal-container"))&&i.remove(),a.hasClass("save-attributes")&&t.addAttributes(i)}))}addImage(e){let t=this.obj,i=[],a=this.cells,s=a[1],n=a[3],l=a[0];for(let a=s;a<=n;a++)if(t.records[a][l]&&!t.records[a][l].classList.contains("readonly")&&"none"!==t.records[a][l].style.display){let s=t.options.data[a][l];s||(s=[]);let n=[...new Set(s)];n.push(e),i.push(t.updateCell(l,a,n)),t.updateFormulaChain(l,a,i)}t.setHistory({action:"setValue",records:i,selection:t.selectedCell}),t.updateTable()}addAttributes(e){let t=[],i=e.find(".vi-wbe-add-attributes-option").val();if(e.find(".vi-wbe-attribute-row").each((function(e,i){let a=k(i).data("attr");if(a.is_taxonomy)a.options=k(i).find("select").val().map(Number);else{a.name=k(i).find("input.custom-attr-name").val();let e=k(i).find("textarea.custom-attr-val").val();a.value=e.trim().replace(/\s+/g," "),a.options=e.split("|").map((e=>e.trim().replace(/\s+/g," ")))}a.visible=!!k(i).find(".attr-visibility:checked").length,a.variation=!!k(i).find(".attr-variation:checked").length,a.position=e,t.push(a)})),console.log(t),t.length){let e=this.obj,a=!1,s=[],n=this.cells,l=n[1],o=n[3],r=n[0];const d=(e=[],t)=>{if(e.length)for(let i in e)if(e[i].name===t)return i;return!1};for(let n=l;n<=o;n++)if(e.records[n][r]&&!e.records[n][r].classList.contains("readonly")&&"none"!==e.records[n][r].style.display&&!1===a){let a=e.options.data[n][r];a||(a=[]);let l=[...new Set(a)],o=0;for(let e of t){let t=d(l,e.name);if(!1===t)e.position=l.length+o++,l.push(e);else switch(i){case"replace":e.position=l[t].position,l[t]=e;break;case"merge_terms":let i=[...l[t].options||[],...e.options||[]];l[t].options=[...new Set(i)]}}s.push(e.updateCell(r,n,l)),e.updateFormulaChain(r,n,s)}e.setHistory({action:"setValue",records:s,selection:e.selectedCell}),e.updateTable()}e.remove()}content(e){let t=this,i="",{attributes:s}=a,n=`<option value="">${l.text("Custom product attribute")}</option>`;for(let e in s)n+=`<option value="${e}">${s[e].data.attribute_label}</option>`;n=`<div class="vi-wbe-taxonomy-header">\n                            <select class="vi-wbe-select-taxonomy">${n}</select>\n                            <span class="vi-ui button tiny vi-wbe-add-taxonomy">${l.text("Add")}</span>\n                        </div>`,i=`${n}\n                <table class="vi-ui celled table">\n                    <thead>\n                    <tr>\n                        <th>Name</th>\n                        <th>Attributes</th>\n                        <th width="1">Actions</th>\n                    </tr>\n                    </thead>\n                    <tbody>${i}</tbody>\n                </table>`,e.find(".content").append(i),e.find(".actions").append('<div>\n                                        <div class="vi-wbe-add-attributes-option-label">\n                                            Select action if exist attribute in product\n                                        </div>\n                                        <select class="vi-wbe-add-attributes-option">\n                                            <option value="none">Don\'t add</option>\n                                            <option value="replace">Replace existed attribute</option>\n                                            <option value="merge_terms">Merge terms</option>\n                                        </select>\n                                    </div>'),e.find("table select").select2({multiple:!0}),e.find("tbody").sortable({items:"tr",cursor:"move",axis:"y",scrollSensitivity:40,forcePlaceholderSize:!0,helper:"clone",handle:".icon.move"});const o=()=>{e.find("select.vi-wbe-select-taxonomy option").removeAttr("disabled"),e.find("input[type=hidden]").each((function(t,i){let a=k(i).val();e.find(`select.vi-wbe-select-taxonomy option[value='${a}']`).attr("disabled","disabled")}))};o(),e.on("click",(function(i){let s=k(i.target);if(s.hasClass("trash")&&(s.closest("tr").remove(),o()),s.hasClass("vi-wbe-add-taxonomy")){let i=k(".vi-wbe-select-taxonomy"),a=i.val(),s={name:a,options:[]};a&&(s.is_taxonomy=1);let n=k(t.createRowTable(s));e.find("table tbody").append(n),n.find("select").select2({multiple:!0}),o(),i.val("").trigger("change")}if(s.hasClass("vi-wbe-select-all-attributes")){let e=s.closest("td").find("select");e.find("option").attr("selected",!0),e.trigger("change")}if(s.hasClass("vi-wbe-select-no-attributes")){let e=s.closest("td").find("select");e.find("option").attr("selected",!1),e.trigger("change")}if(s.hasClass("vi-wbe-add-new-attribute")){let e=prompt(l.text("Enter a name for the new attribute term:"));if(!e)return;let t=s.closest("tr.vi-wbe-attribute-row"),i=t.attr("data-attr");i&&(i=JSON.parse(i),l.ajax({data:{sub_action:"add_new_attribute",taxonomy:i.name,term:e},beforeSend(){s.addClass("loading")},success(e){if(s.removeClass("loading"),e.success){let s=t.find("select");s.append(`<option value="${e.data.term_id}" selected>${e.data.name}</option>`),s.trigger("change"),a.attributes[i.name].terms[e.data.term_id]={slug:e.data.slug,text:e.data.name}}else alert(e.data.message)}}))}}))}createRowTable(e){let t="",i="";if(e.is_taxonomy){let s=a.attributes[e.name],n=s.terms||[],o="";if(t=`${s.data.attribute_label}<input type="hidden" value="${e.name}"/>`,Object.keys(n).length)for(let t in n)o+=`<option value="${t}" ${e.options.includes(parseInt(t))?"selected":""}>${n[t].text}</option>`;i=`<select multiple>${o}</select>\n                    <div class="vi-wbe-attributes-button-group">\n                        <span class="vi-ui button mini vi-wbe-select-all-attributes">${l.text("Select all")}</span>\n                        <span class="vi-ui button mini vi-wbe-select-no-attributes">${l.text("Select none")}</span>\n                        <span class="vi-ui button mini vi-wbe-add-new-attribute">${l.text("Add new")}</span>\n                    </div>`}else t=`<input type="text" class="custom-attr-name" value="${e.name}" placeholder="${l.text("Custom attribute name")}"/>`,i=`<textarea class="custom-attr-val" placeholder="${l.text('Enter some text, or some attributes by "|" separating values.')}">${e.value||""}</textarea>`;return t=`<div class="vi-wbe-attribute-name-label">${t}</div>`,t+=`<div>\n                        <input type="checkbox" class="attr-visibility" ${e.visible?"checked":""} value="1">\n                        <label>${l.text("Visible on the product page")}</label>\n                    </div>`,t+=`<div>\n                        <input type="checkbox" class="attr-variation" ${e.variation?"checked":""} value="1">\n                        <label>${l.text("Used for variations (apply for variable)")}</label>\n                    </div>`,`<tr class="vi-wbe-attribute-row" data-attr='${JSON.stringify(e)}'>\n                    <td class="vi-wbe-left">${t}</td>\n                    <td>${i}</td>\n                    <td class="vi-wbe-right"><i class="icon trash"> </i> <i class="icon move"> </i></td>\n                </tr>`}}jQuery(document).ready((function(e){new class{constructor(){this.sidebar=v.init(),this.compare=[],this.trash=[],this.unTrash=[],this.revision={},this.isAdding=!1,this.editor=e("#vi-wbe-container"),this.menubar=e("#vi-wbe-menu-bar"),this.menubar.on("click",".vi-wbe-open-sidebar",this.openMenu.bind(this)),this.menubar.on("click","a.item:not(.vi-wbe-open-sidebar)",this.closeMenu.bind(this)),this.menubar.on("click",".vi-wbe-new-products",this.addNewProduct.bind(this)),this.menubar.on("click",".vi-wbe-new-coupons",this.addNewCoupon.bind(this)),this.menubar.on("click",".vi-wbe-new-orders",this.addNewOrder.bind(this)),this.menubar.on("click",".vi-wbe-full-screen-btn",this.toggleFullScreen.bind(this)),this.menubar.on("click",".vi-wbe-save-button",this.save.bind(this)),this.menubar.on("click",".vi-wbe-pagination a.item",this.changePage.bind(this)),this.menubar.on("click",".vi-wbe-get-product",this.reloadCurrentPage.bind(this)),this.menubar.on("change",".vi-wbe-go-to-page",this.changePageByInput.bind(this)),this.editor.on("cellonchange","tr",this.cellOnChange.bind(this)),this.editor.on("click",".jexcel_content",this.removeExistingEditor.bind(this)),this.editor.on("dblclick",this.removeContextPopup),this.sidebar.on("afterAddFilter",this.afterAddFilter.bind(this)),this.sidebar.on("afterSaveSettings",this.afterSaveSettings.bind(this)),this.sidebar.on("click",".vi-wbe-close-sidebar",this.closeMenu.bind(this)),this.init(),e(document).on("keydown",this.keyDownControl.bind(this)),e(document).on("keyup",this.keyUpControl.bind(this))}removeExistingEditor(e){e.target===e.currentTarget&&this.WorkBook&&this.WorkBook.edition&&this.WorkBook.closeEditor(this.WorkBook.edition[0],!0)}keyDownControl(e){switch(!e.ctrlKey&&!e.metaKey||e.shiftKey||83===e.which&&(e.preventDefault(),this.save()),e.which){case 27:this.sidebar.removeClass("vi-wbe-open")}}keyUpControl(e){if(e.target&&!e.target.getAttribute("readonly")){let t=e.target.getAttribute("data-currency");if(t){let i=e.target.value;if(i)if(i.indexOf(t)<1){let t=i.match(/\d/g);e.target.value=t?t.join(""):""}else{let a,s=i.split(t),n="";a=s[0].match(/[\d]/g).join(""),s[1]&&(n=s[1].match(/[\d]/g),n=n?n.join(""):""),e.target.value=n?`${a}${t}${n}`:`${a}${t}`}}}}removeContextPopup(){e(".vi-wbe-context-popup").removeClass("vi-wbe-popup-active")}init(){wbeParams.columns&&a.setColumns(wbeParams.columns),this.pagination(1,1),this.workBookInit(),this.loadProducts(),l.setJexcel(this.WorkBook)}cellOnChange(t,i){let{col:s=""}=i;if(!s)return;let n=a.idMapping[s],o=e(t.target);switch(n){case"product_type":o.find("td").each((function(t,i){let a=e(i).data("x");a&&0!==a&&1!==a&&e(i).removeClass("readonly")}));let t=a.cellDependType[i.value];Array.isArray(t)&&t.forEach((function(e){let t=a.idMappingFlip[e];o.find(`td[data-x='${t}']`).addClass("readonly")}));break;case"post_date":let s=i.value,n=l.getColFromColumnType("status"),r=o.find(`td[data-x='${n}']`).get(0),d=new Date(s).getTime()>Date.now()?"future":"publish";this.WorkBook.setValue(r,d)}}workBookInit(){let t,i=this,s=0,n=l.text("Delete rows with selected cells"),o=null,r=null;function c(e,t){let i=[],a=e.selectedContainer,s=a[1],n=a[3],l=a[0];for(let a=s;a<=n;a++)e.records[a][l]&&!e.records[a][l].classList.contains("readonly")&&"none"!==e.records[a][l].style.display&&(i.push(e.updateCell(l,a,t)),e.updateFormulaChain(l,a,i));e.setHistory({action:"setValue",records:i,selection:e.selectedCell}),e.updateTable()}switch(a.editType){case"products":n=`${l.text("Delete rows with selected cells")} \n                                            <span class="vi-wbe-context-menu-note">\n                                                (${l.text("Variations cannot revert after save")})\n                                            </span>`,o=function(t,i){let s=l.getProductTypeFromY(i),n=a.cellDependType[s];Array.isArray(n)&&n.forEach((function(i){let s=a.idMappingFlip[i];e(t).find(`td[data-x='${s}']`).addClass("readonly")}))},r=function(t,i,s,n,l,o){if(i===n&&s===l){let t=this.getCellFromCoords(i,s),n=e(t).children();if(n.length&&n.hasClass("vi-wbe-gallery-has-item")){let n=this.options.data[s][i],l="";if(n.length)for(let e of n)l+=`<li class="vi-wbe-gallery-image"><img src="${a.imgStorage[e]}"></li>`;new d(`<ul class="vi-wbe-gallery-images">${l}</ul>`,e(t))}}},t=function(t,s,n,o,r){i.removeContextPopup();let d=s.selectedContainer;if(n=parseInt(n),o=parseInt(o),d[0]===d[2]&&null!==n)switch(s.options.columns[n].type){case"checkbox":t.push({title:l.text("Check"),onclick(e){c(s,!0)}}),t.push({title:l.text("Uncheck"),onclick(e){c(s,!1)}});break;case"number":t.push({title:l.text("Calculator"),onclick(e){new u(s,n,o,e)}}),n>1&&"sale_price"===s.options.columns[n].id&&"regular_price"===s.options.columns[n-1].id&&t.push({title:l.text("Calculator base on Regular price"),onclick(e){new p(s,n,o,e)}});break;case"text":t.push({title:l.text("Edit multiple cells"),onclick(e){new f(s,n,o,e,s.options.columns[n].wordWrap)}}),t.push({title:l.text("Find and Replace"),onclick(e){new m(s,n,o,e)}});break;case"calendar":let i=e(`td[data-x=${n}][data-y=${o}]`).get(0);e(i).hasClass("readonly")||t.push({title:l.text("Open date picker"),onclick(){let e=s.options.data[o][n];var t=l.createEditor(i,"input","",!1);t.value=e,t.style.left="unset";let a=s.selectedContainer,r=a[1],d=a[3];1!=s.options.tableOverflow&&1!=s.options.fullscreen||(s.options.columns[n].options.position=!0),s.options.columns[n].options.value=s.options.data[o][n],s.options.columns[n].options.opened=!0,s.options.columns[n].options.onclose=function(e,t){let i=[];t=e.value;for(let e=r;e<=d;e++)s.records[e][n]&&!s.records[e][n].classList.contains("readonly")&&"none"!==s.records[e][n].style.display&&(i.push(s.updateCell(n,e,t)),s.updateFormulaChain(n,e,i));s.setHistory({action:"setValue",records:i,selection:s.selectedCell}),s.updateTable()},jSuites.calendar(t,s.options.columns[n].options),t.focus()}});break;case"custom":switch(s.options.columns[n].editor.type){case"textEditor":t.push({title:l.text("Edit multiple cells"),onclick(){e(".vi-ui.modal").modal("show"),e(".vi-ui.modal .close.icon").off("click"),null===tinymce.get("vi-wbe-text-editor")?(e("#vi-wbe-text-editor").val(""),wp.editor.initialize("vi-wbe-text-editor",a.tinyMceOptions)):tinymce.get("vi-wbe-text-editor").setContent(""),e(".vi-wbe-text-editor-save").off("click").on("click",(function(){let t=wp.editor.getContent("vi-wbe-text-editor");c(s,t),e(this).hasClass("vi-wbe-close")&&e(".vi-ui.modal").modal("hide")}))}});break;case"tags":t.push({title:l.text("Find and replace tags"),onclick(e){new y(s,d,n,o,e)}});break;case"select2":t.push({title:l.text("Find and replace options"),onclick(e){new C(s,d,n,o,e)}});break;case"gallery":t.push({title:l.text("Add image to selected cells"),onclick(e){new _(s,d,n,o,e)}});break;case"product_attributes":t.push({title:l.text("Add attributes to products"),onclick(e){new $(s,d,n,o,e)}})}}if(t.length&&t.push({type:"line"}),d[1]===d[3]&&null!==o){let e=l.getProductTypeFromY(o);if("variable"===e&&(t.push({title:l.text("Add variation"),onclick(){l.is_loading()||l.ajax({data:{sub_action:"add_variation",pid:l.getProductIdOfCell(s,o)},beforeSend(){l.loading()},success(e){e.success&&(s.insertRow(0,o,!1,!0),s.setRowData(o+1,e.data,!0)),l.removeLoading()}})}}),t.push({title:`${l.text("Create variations from all attributes")} <span class="vi-wbe-context-menu-note">(${l.text("Save new attributes before")})</span>`,onclick(){l.is_loading()||l.ajax({data:{sub_action:"link_all_variations",pid:l.getProductIdOfCell(s,o)},beforeSend(){l.loading()},success(e){e.success&&(e.data.length&&e.data.forEach((function(e,t){s.insertRow(0,o+t,!1,!0),s.setRowData(o+t+1,e,!0)})),l.removeLoading(),l.notice(`${e.data.length} ${l.text("variations are added")}`))}})}}),t.push({type:"line"})),"variation"!==e){let e=l.getProductIdOfCell(s,o);t.push({title:l.text("Duplicate"),onclick(){l.ajax({data:{sub_action:"duplicate_product",product_id:e},beforeSend(){l.loading()},success(e){e.data.length&&e.data.forEach((function(e,t){s.insertRow(0,o+t,!0,!0),s.setRowData(o+t,e,!0)})),l.removeLoading()}})}}),t.push({title:l.text("Go to edit product page"),onclick(){window.open(`${a.adminUrl}post.php?post=${e}&action=edit`,"_blank")}}),t.push({title:l.text("View on Single product page"),onclick(){window.open(`${a.frontendUrl}?p=${e}&post_type=product&preview=true`,"_blank")}})}}return t};break;case"orders":t=function(t,i,s,n,o){let r=i.selectedContainer;if(s=parseInt(s),n=parseInt(n),null!==s&&null!==n){for(let e in a.orderActions)t.push({title:a.orderActions[e],onclick(){let t=[];for(let e=r[1];e<=r[3];e++)t.push(l.getProductIdOfCell(i,e));l.ajax({data:{sub_action:e,order_ids:t},beforeSend(){l.loading()},success(e){l.removeLoading()}})}});t.length&&t.push({type:"line"});const s=function(t=0){let a=i.getCellFromCoords(r[0],r[1]),s=e(`<div>\n                                                    <div class="field"> \n                                                        <textarea rows="3"></textarea>\n                                                    </div>\n                                                    <div class="field"> \n                                                        <span class="vi-wbe-add-note vi-ui button tiny">\n                                                            ${l.text("Add")}\n                                                        </span>\n                                                    </div>\n                                                </div>`),n=new d(s,e(a));s.on("click",".vi-wbe-add-note",(function(){let e=s.find("textarea").val();if(!e)return;let a=i.selectedContainer,o=a[1],r=a[3],d=(a[0],[]);for(let e=o;e<=r;e++)d.push(i.options.data[e][0]);n.hide(),l.ajax({data:{sub_action:"add_order_note",ids:d,note:e,is_customer_note:t},beforeSend(){l.loading()},success(e){l.removeLoading()}})}))};if(t.push({title:l.text("Add private note"),onclick(){s(0)}}),t.push({title:l.text("Add note to customer"),onclick(){s(1)}}),t.length&&t.push({type:"line"}),r[1]===r[3]){let e=l.getProductIdOfCell(i,n);t.push({title:l.text("Go to edit order page"),onclick(){window.open(`${a.adminUrl}post.php?post=${e}&action=edit`,"_blank")}}),t.length&&t.push({type:"line"})}}return t};break;case"coupons":t=function(e,t,i,a,s){let n=t.selectedContainer;return i=parseInt(i),a=parseInt(a),null!==i&&null!==a&&n[0]===n[2]&&("code"===l.getColumnType(i)&&e.push({title:l.text("Generate coupon code"),onclick(){let e=[],i=t.selectedContainer,a=i[1],s=i[3],n=i[0];for(let i=a;i<=s;i++)if(t.records[i][n]&&!t.records[i][n].classList.contains("readonly")&&"none"!==t.records[i][n].style.display){let a=l.generateCouponCode();e.push(t.updateCell(n,i,a)),t.updateFormulaChain(n,i,e)}t.setHistory({action:"setValue",records:e,selection:t.selectedCell}),t.updateTable()}}),"text"===t.options.columns[i].type&&(e.push({title:l.text("Edit multiple cells"),onclick(e){new f(t,i,a,e,t.options.columns[i].wordWrap)}}),e.push({title:l.text("Find and Replace"),onclick(e){new m(t,i,a,e)}})),"checkbox"===t.options.columns[i].type&&(e.push({title:l.text("Check"),onclick(e){c(t,!0)}}),e.push({title:l.text("Uncheck"),onclick(e){c(t,!1)}})),e.length&&e.push({type:"line"})),e}}this.WorkBook=e("#vi-wbe-spreadsheet").jexcel({allowInsertRow:!1,allowInsertColumn:!1,about:!1,freezeColumns:3,tableOverflow:!0,tableWidth:"100%",tableHeight:"100%",columns:a.columns,stripHTML:!1,allowExport:!1,allowDeleteColumn:!1,allowRenameColumn:!1,autoIncrement:!1,allowXCopy:!1,text:{deleteSelectedRows:n},oncreaterow:o,contextMenuItems:t,onselection:r,onchange(t,a,s,n,o,r){if(JSON.stringify(o)!==JSON.stringify(r)){e(a).parent().trigger("cellonchange",{cell:a,col:s,row:n,value:o});let t=this.options.data[n][0];if(i.compare.push(t),i.compare=[...new Set(i.compare)],i.menubar.find(".vi-wbe-save-button").addClass("vi-wbe-saveable"),!i.isAdding){i.revision[t]||(i.revision[t]={});let e=l.getColumnType(s);i.revision[t][e]=r}}},ondeleterow(e,t,a,s){for(let e of s)i.trash.push(e[0].innerText);i.trash.length&&i.menubar.find(".vi-wbe-save-button").addClass("vi-wbe-saveable")},onundo(e,t){if(t&&"deleteRow"===t.action)for(let e of t.rowData)i.unTrash.push(e[0])},onbeforecopy(){s=0,i.firstCellCopy=null},oncopying(e,t,a){i.firstCellCopy||(i.firstCellCopy=[t,a]),i.firstCellCopy[0]!==t&&s++},onbeforepaste(e,t){if("string"!=typeof e)return e;e=e.trim();let a=t[0],n=this.columns[a].type;if(void 0===i.firstCellCopy)return["text","number","custom"].includes(n)?"custom"===n?"textEditor"===this.columns[a].editor.type?e:"":e:"";let l=+i.firstCellCopy[0],o=+t[0],r=this.columns[l].type,d=this.columns[o].type;if(+i.firstCellCopy[0]!=+t[0]){if(s>0)return alert("Copy single column each time."),"";if(r!==d)return alert("Can not paste data with different column type."),""}return e},onscroll(t){let i=e(t).find("select.select2-hidden-accessible");i.length&&i.select2("close")},oncreateeditor(e,t,i,a,s){this.options.columns[i].currency&&s.setAttribute("data-currency",this.options.columns[i].currency)}})}closeMenu(e){this.sidebar.removeClass("vi-wbe-open")}openMenu(t){let i=e(t.currentTarget).data("menu_tab"),a=this.sidebar.find(`a.item[data-tab='${i}']`);a.hasClass("active")&&this.sidebar.hasClass("vi-wbe-open")?this.sidebar.removeClass("vi-wbe-open"):(this.sidebar.addClass("vi-wbe-open"),a.trigger("click"))}addNewProduct(){if(l.is_loading())return;let e=prompt(l.text("Please enter new product name"));if(e){let t=this;l.ajax({data:{sub_action:"add_new_product",product_name:e},beforeSend(){l.loading()},success(e){t.isAdding=!0,t.WorkBook.insertRow(0,0,!0,!0),t.WorkBook.setRowData(0,e.data,!0),l.removeLoading()},complete(){t.isAdding=!1}})}}addNewCoupon(){if(l.is_loading())return;let e=this;l.ajax({data:{sub_action:"add_new_coupon"},beforeSend(){l.loading()},success(t){e.isAdding=!0,e.WorkBook.insertRow(0,0,!0,!0),e.WorkBook.setRowData(0,t.data,!0),l.removeLoading()},complete(){e.isAdding=!1}})}addNewOrder(){window.open("post-new.php?post_type=shop_order")}toggleFullScreen(t){let i=e(".wp-admin"),s=e(t.currentTarget);i.toggleClass("vi-wbe-full-screen"),i.hasClass("vi-wbe-full-screen")?(s.find("i.icon").removeClass("external alternate").addClass("window close outline"),s.attr("title","Exit full screen")):(s.find("i.icon").removeClass("window close outline").addClass("external alternate"),s.attr("title","Full screen")),e.ajax({url:a.ajaxUrl,type:"post",dataType:"json",data:{...a.ajaxData,sub_action:"set_full_screen_option",status:i.hasClass("vi-wbe-full-screen")}})}getAllRows(){return this.WorkBook.getData(!1,!0)}save(){e("td.error").removeClass("error");let t=this,i=this.getAllRows(),a=[],s=[];for(let e of this.compare)for(let t of i)t[0]===parseInt(e)&&a.push(t);l.is_loading()||function i(n=0){let o=30*n,r=o+30,d=a.slice(o,r),c=30*(n+1)>a.length;if(d.length||t.trash.length||t.unTrash.length)l.ajax({data:{sub_action:"save_products",products:JSON.stringify(d),trash:t.trash,untrash:t.unTrash},beforeSend(){l.loading()},success(e){t.trash=[],t.unTrash=[],t.compare=[],t.menubar.find(".vi-wbe-save-button").removeClass("vi-wbe-saveable"),e.data.skuErrors&&(s=[...new Set([...s,...e.data.skuErrors])]),l.removeLoading(),i(n+1)},error(e){console.log(e)}});else if(0===n&&l.notice(l.text("Nothing change to save")),c){if(s.length){l.notice(l.text("Invalid or duplicated SKU"));let i=l.getColFromColumnType("sku"),a=t.WorkBook.getData();if(a.length)for(let n in a){let l=a[n];if(s.includes(l[0])){let a=t.WorkBook.getCellFromCoords(i,n);e(a).addClass("error")}}}let i=t.WorkBook.history;if(i.length)for(let e of i){if("deleteRow"!==e.action)continue;let t=[];for(let i in e.rowData)e.rowData[i][1]>0&&t.push(parseInt(i));t.length&&(e.rowData=e.rowData.filter(((e,i)=>!t.includes(i))),e.rowNode=e.rowNode.filter(((e,i)=>!t.includes(i))),e.rowRecords=e.rowRecords.filter(((e,i)=>!t.includes(i))),e.numOfRows=e.numOfRows-t.length)}t.saveRevision()}}()}loadProducts(e=1,t=!1){let i=this;l.is_loading()||l.ajax({data:{sub_action:"load_products",page:e,re_create:t},beforeSend(){l.loading()},success(s){s.success&&(a.imgStorage=s.data.img_storage,t&&(i.WorkBook.destroy(),s.data.columns&&a.setColumns(s.data.columns),s.data.idMapping&&(a.idMapping=s.data.idMapping),s.data.idMappingFlip&&(a.idMappingFlip=s.data.idMappingFlip),i.workBookInit()),i.WorkBook.options.data=s.data.products,i.WorkBook.setData(),i.pagination(s.data.max_num_pages,e),l.removeLoading(),s.data.products.length||l.notice(l.text("No item was found")))},error(e){console.log(e)}})}pagination(e,t){this.menubar.find(".vi-wbe-pagination").html(l.pagination(e,t))}changePage(t){let i=parseInt(e(t.currentTarget).attr("data-page"));e(t.currentTarget).hasClass("active")||e(t.currentTarget).hasClass("disabled")||!i||this.loadProducts(i)}changePageByInput(t){let i=parseInt(e(t.target).val());i<=parseInt(e(t.target).attr("max"))&&i>0&&this.loadProducts(i)}reloadCurrentPage(){this.loadProducts(this.getCurrentPage())}getCurrentPage(){return this.menubar.find(".vi-wbe-pagination .item.active").data("page")||1}afterAddFilter(e,t){a.imgStorage=t.img_storage,this.WorkBook.options.data=t.products,this.WorkBook.setData(),this.pagination(t.max_num_pages,1),t.products.length||l.notice(l.text("No item was found"))}afterSaveSettings(e,t){t.fieldsChange&&this.loadProducts(this.getCurrentPage(),!0)}saveRevision(){let t=this;if(Object.keys(t.revision).length){let i=t.sidebar.find(".vi-wbe-pagination a.item.active").data("page")||1;l.ajax({data:{sub_action:"auto_save_revision",data:t.revision,page:i||1},success(a){a.success&&(a.data.updatePage&&e("#vi-wbe-history-points-list tbody").html(a.data.updatePage),t.revision={},t.sidebar.find(".vi-wbe-pagination").html(l.pagination(a.data.pages,i)))}})}}}}))})();