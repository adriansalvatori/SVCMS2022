/******/ (() => { // webpackBootstrap
/******/ 	var __webpack_modules__ = ({

/***/ "./src/jexcel.js":
/*!***********************!*\
  !*** ./src/jexcel.js ***!
  \***********************/
/***/ (function(module) {

/**
 * jExcel v4.5.3
 *
 * Website: https://bossanova.uk/jexcel/
 * Description: Create amazing web based spreadsheets.
 *
 * This software is distribute under MIT License
 */

// if (!jSuites && typeof (require) === 'function') {
//     var jSuites = require('jsuites');
//     require('jsuites/dist/jsuites.css');
// }

;(function (global, factory) {
     true ? module.exports = factory() :
        0;
}(this, (function () {

    'use strict';

    // Jexcel core object

    var jexcel = (function (el, options) {
        // Create jexcel object
        var obj = {};
        obj.options = {};

        if (!(el instanceof Element || el instanceof HTMLDocument)) {
            console.error('JEXCEL: el is not a valid DOM element');
            return false;
        } else if (el.tagName == 'TABLE') {
            if (options = jexcel.createFromTable(el, options)) {
                var div = document.createElement('div');
                el.parentNode.insertBefore(div, el);
                el.remove();
                el = div;
            } else {
                console.error('JEXCEL: el is not a valid DOM element');
                return false;
            }
        }

        // Loading default configuration
        var defaults = {
            // External data
            url: null,
            // Ajax options
            method: 'GET',
            requestVariables: null,
            // Data
            data: null,
            // Custom sorting handler
            sorting: null,
            // Copy behavior
            copyCompatibility: false,
            root: null,
            // Rows and columns definitions
            rows: [],
            columns: [],
            // Deprected legacy options
            colHeaders: [],
            colWidths: [],
            colAlignments: [],
            nestedHeaders: null,
            // Column width that is used by default
            defaultColWidth: 50,
            defaultColAlign: 'center',
            // Spare rows and columns
            minSpareRows: 0,
            minSpareCols: 0,
            // Minimal table dimensions
            minDimensions: [0, 0],
            // Allow Export
            allowExport: true,
            // @type {boolean} - Include the header titles on download
            includeHeadersOnDownload: false,
            // @type {boolean} - Include the header titles on copy
            includeHeadersOnCopy: false,
            // Allow column sorting
            columnSorting: true,
            // Allow column dragging
            columnDrag: false,
            // Allow column resizing
            columnResize: true,
            // Allow row resizing
            rowResize: false,
            // Allow row dragging
            rowDrag: true,
            // Allow table edition
            editable: true,
            // Allow new rows
            allowInsertRow: true,
            // Allow new rows
            allowManualInsertRow: true,
            // Allow new columns
            allowInsertColumn: true,
            // Allow new rows
            allowManualInsertColumn: true,
            // Allow row delete
            allowDeleteRow: true,
            // Allow deleting of all rows
            allowDeletingAllRows: false,
            // Allow column delete
            allowDeleteColumn: true,
            // Allow rename column
            allowRenameColumn: true,
            // Allow comments
            allowComments: false,
            // Allow copy follow x axis
            allowXCopy: true,
            // Global wrap
            wordWrap: false,
            // Image options
            imageOptions: null,
            // CSV source
            csv: null,
            // Filename
            csvFileName: 'jexcel',
            // Consider first line as header
            csvHeaders: true,
            // Delimiters
            csvDelimiter: ',',
            // First row as header
            parseTableFirstRowAsHeader: false,
            parseTableAutoCellType: false,
            // Disable corner selection
            selectionCopy: true,
            // Merged cells
            mergeCells: {},
            // Create toolbar
            toolbar: null,
            // Allow search
            search: false,
            // Create pagination
            pagination: false,
            paginationOptions: null,
            // Full screen
            fullscreen: false,
            // Lazy loading
            lazyLoading: false,
            loadingSpin: false,
            // Table overflow
            tableOverflow: false,
            tableHeight: '300px',
            tableWidth: null,
            textOverflow: false,
            // Meta
            meta: null,
            // Style
            style: null,
            classes: null,
            // Execute formulas
            parseFormulas: true,
            autoIncrement: true,
            autoCasting: true,
            // Security
            secureFormulas: true,
            stripHTML: true,
            stripHTMLOnCopy: false,
            // Filters
            filters: false,
            footers: null,
            // Event handles
            onundo: null,
            onredo: null,
            onload: null,
            onchange: null,
            oncomments: null,
            onbeforechange: null,
            onafterchanges: null,
            onbeforeinsertrow: null,
            oninsertrow: null,
            onbeforeinsertcolumn: null,
            oninsertcolumn: null,
            onbeforedeleterow: null,
            ondeleterow: null,
            onbeforedeletecolumn: null,
            ondeletecolumn: null,
            onmoverow: null,
            onmovecolumn: null,
            onresizerow: null,
            onresizecolumn: null,
            onsort: null,
            onselection: null,
            onbeforecopy: null,
            oncopying: null,
            oncopy: null,
            onpaste: null,
            onbeforepaste: null,
            onmerge: null,
            onfocus: null,
            onblur: null,
            onscroll: null,
            onchangeheader: null,
            oncreateeditor: null,
            oneditionstart: null,
            oneditionend: null,
            onchangestyle: null,
            onchangemeta: null,
            onchangepage: null,
            onbeforesave: null,
            onsave: null,
            onsethistory: null,
            // Global event dispatcher
            onevent: null,
            // Persistance
            persistance: false,
            // Customize any cell behavior
            updateTable: null,
            // Detach the HTML table when calling updateTable
            detachForUpdates: false,
            freezeColumns: null,
            // Texts
            text: {
                noRecordsFound: 'No records found',
                showingPage: 'Showing page {0} of {1} entries',
                show: 'Show ',
                search: 'Search',
                entries: ' entries',
                columnName: 'Column name',
                insertANewColumnBefore: 'Insert a new column before',
                insertANewColumnAfter: 'Insert a new column after',
                deleteSelectedColumns: 'Delete selected columns',
                renameThisColumn: 'Rename this column',
                orderAscending: 'Order ascending',
                orderDescending: 'Order descending',
                insertANewRowBefore: 'Insert a new row before',
                insertANewRowAfter: 'Insert a new row after',
                deleteSelectedRows: 'Delete selected rows',
                editComments: 'Edit comments',
                addComments: 'Add comments',
                comments: 'Comments',
                clearComments: 'Clear comments',
                copy: 'Copy...',
                paste: 'Paste...',
                saveAs: 'Save as...',
                about: 'About',
                areYouSureToDeleteTheSelectedRows: 'Are you sure to delete the selected rows?',
                areYouSureToDeleteTheSelectedColumns: 'Are you sure to delete the selected columns?',
                thisActionWillDestroyAnyExistingMergedCellsAreYouSure: 'This action will destroy any existing merged cells. Are you sure?',
                thisActionWillClearYourSearchResultsAreYouSure: 'This action will clear your search results. Are you sure?',
                thereIsAConflictWithAnotherMergedCell: 'There is a conflict with another merged cell',
                invalidMergeProperties: 'Invalid merged properties',
                cellAlreadyMerged: 'Cell already merged',
                noCellsSelected: 'No cells selected',
            },
            // About message
            about: "jExcel CE Spreadsheet\nVersion 4.5.0\nWebsite: https://bossanova.uk/jexcel/v3",

            oncreatcellheader: null,
            oncreaterow: null
        };

        // Loading initial configuration from user
        for (var property in defaults) {
            if (options && options.hasOwnProperty(property)) {
                if (property === 'text') {
                    obj.options[property] = defaults[property];
                    for (var textKey in options[property]) {
                        if (options[property].hasOwnProperty(textKey)) {
                            obj.options[property][textKey] = options[property][textKey];
                        }
                    }
                } else {
                    obj.options[property] = options[property];
                }
            } else {
                obj.options[property] = defaults[property];
            }
        }

        // Global elements
        obj.el = el;
        obj.corner = null;
        obj.contextMenu = null;
        obj.textarea = null;
        obj.ads = null;
        obj.content = null;
        obj.table = null;
        obj.thead = null;
        obj.tbody = null;
        obj.rows = [];
        obj.results = null;
        obj.searchInput = null;
        obj.toolbar = null;
        obj.pagination = null;
        obj.pageNumber = null;
        obj.headerContainer = null;
        obj.colgroupContainer = null;

        // Containers
        obj.headers = [];
        obj.records = [];
        obj.history = [];
        obj.formula = [];
        obj.colgroup = [];
        obj.selection = [];
        obj.highlighted = [];
        obj.selectedCell = null;
        obj.selectedContainer = null;
        obj.style = [];
        obj.data = null;
        obj.filter = null;
        obj.filters = [];

        // Internal controllers
        obj.cursor = null;
        obj.historyIndex = -1;
        obj.ignoreEvents = false;
        obj.ignoreHistory = false;
        obj.edition = null;
        obj.hashString = null;
        obj.resizing = null;
        obj.dragging = null;

        // Lazy loading
        if (obj.options.lazyLoading == true && (obj.options.tableOverflow == false && obj.options.fullscreen == false)) {
            console.error('JEXCEL: The lazyloading only works when tableOverflow = yes or fullscreen = yes');
            obj.options.lazyLoading = false;
        }

        /**
         * Activate/Disable fullscreen
         * use programmatically : table.fullscreen(); or table.fullscreen(true); or table.fullscreen(false);
         * @Param {boolean} activate
         */
        obj.fullscreen = function (activate) {
            // If activate not defined, get reverse options.fullscreen
            if (activate == null) {
                activate = !obj.options.fullscreen;
            }

            // If change
            if (obj.options.fullscreen != activate) {
                obj.options.fullscreen = activate;

                // Test LazyLoading conflict
                if (activate == true) {
                    el.classList.add('fullscreen');
                } else {
                    el.classList.remove('fullscreen');
                }
            }
        }

        /**
         * Trigger events
         */
        obj.dispatch = function (event) {
            // Dispatch events
            if (!obj.ignoreEvents) {
                // Call global event
                if (typeof (obj.options.onevent) == 'function') {
                    var ret = obj.options.onevent.apply(this, arguments);
                }
                // Call specific events
                if (typeof (obj.options[event]) == 'function') {
                    var ret = obj.options[event].apply(this, Array.prototype.slice.call(arguments, 1));
                }
            }

            // Persistance
            if (event == 'onafterchanges' && obj.options.persistance) {
                var url = obj.options.persistance == true ? obj.options.url : obj.options.persistance;
                var data = obj.prepareJson(arguments[2]);
                obj.save(url, data);
            }

            return ret;
        }

        /**
         * Prepare the jexcel table
         *
         * @Param config
         */
        obj.prepareTable = function () {
            // Loading initial data from remote sources
            var results = [];

            // Number of columns
            var size = obj.options.columns.length;

            if (obj.options.data && typeof (obj.options.data[0]) !== 'undefined') {
                // Data keys
                var keys = Object.keys(obj.options.data[0]);

                if (keys.length > size) {
                    size = keys.length;
                }
            }

            // Minimal dimensions
            if (obj.options.minDimensions[0] > size) {
                size = obj.options.minDimensions[0];
            }

            // Requests
            var multiple = [];

            // Preparations
            for (var i = 0; i < size; i++) {
                // Deprected options. You should use only columns
                if (!obj.options.colHeaders[i]) {
                    obj.options.colHeaders[i] = '';
                }
                if (!obj.options.colWidths[i]) {
                    obj.options.colWidths[i] = obj.options.defaultColWidth;
                }
                if (!obj.options.colAlignments[i]) {
                    obj.options.colAlignments[i] = obj.options.defaultColAlign;
                }

                // Default column description
                if (!obj.options.columns[i]) {
                    obj.options.columns[i] = {type: 'text'};
                } else if (!obj.options.columns[i].type) {
                    obj.options.columns[i].type = 'text';
                }
                if (!obj.options.columns[i].name) {
                    obj.options.columns[i].name = keys && keys[i] ? keys[i] : i;
                }
                if (!obj.options.columns[i].source) {
                    obj.options.columns[i].source = [];
                }
                if (!obj.options.columns[i].options) {
                    obj.options.columns[i].options = [];
                }
                if (!obj.options.columns[i].editor) {
                    obj.options.columns[i].editor = null;
                }
                if (!obj.options.columns[i].allowEmpty) {
                    obj.options.columns[i].allowEmpty = false;
                }
                if (!obj.options.columns[i].title) {
                    obj.options.columns[i].title = obj.options.colHeaders[i] ? obj.options.colHeaders[i] : '';
                }
                if (!obj.options.columns[i].width) {
                    obj.options.columns[i].width = obj.options.colWidths[i] ? obj.options.colWidths[i] : obj.options.defaultColWidth;
                }
                if (!obj.options.columns[i].align) {
                    obj.options.columns[i].align = obj.options.colAlignments[i] ? obj.options.colAlignments[i] : 'center';
                }

                // Pre-load initial source for json autocomplete
                if (obj.options.columns[i].type == 'autocomplete' || obj.options.columns[i].type == 'dropdown') {
                    // if remote content

                    if (obj.options.columns[i].url) {
                        multiple.push({
                            url: obj.options.columns[i].url,
                            index: i,
                            method: 'GET',
                            dataType: 'json',
                            success: function (data) {
                                var source = [];
                                for (var i = 0; i < data.length; i++) {
                                    obj.options.columns[this.index].source.push(data[i]);
                                }
                            }
                        });
                    }
                } else if (obj.options.columns[i].type == 'calendar') {
                    // Default format for date columns
                    if (!obj.options.columns[i].options.format) {
                        obj.options.columns[i].options.format = 'DD/MM/YYYY';
                    }
                }
            }
            // Create the table when is ready
            if (!multiple.length) {
                obj.createTable();
            } else {
                jSuites.ajax(multiple, function () {
                    obj.createTable();
                });
            }
        }

        obj.createTable = function () {
            // Elements
            obj.table = document.createElement('table');
            obj.thead = document.createElement('thead');
            obj.tbody = document.createElement('tbody');

            // Create headers controllers
            obj.headers = [];
            obj.colgroup = [];

            // Create table container
            obj.content = document.createElement('div');
            obj.content.classList.add('jexcel_content');
            obj.content.onscroll = function (e) {
                obj.scrollControls(e);
            }
            obj.content.onwheel = function (e) {
                obj.wheelControls(e);
            }

            // Create toolbar object
            obj.toolbar = document.createElement('div');
            obj.toolbar.classList.add('jexcel_toolbar');

            // Search
            var searchContainer = document.createElement('div');
            var searchText = document.createTextNode((obj.options.text.search) + ': ');
            obj.searchInput = document.createElement('input');
            obj.searchInput.classList.add('jexcel_search');
            searchContainer.appendChild(searchText);
            searchContainer.appendChild(obj.searchInput);
            obj.searchInput.onfocus = function () {
                obj.resetSelection();
            }

            // Pagination select option
            var paginationUpdateContainer = document.createElement('div');

            if (obj.options.pagination > 0 && obj.options.paginationOptions && obj.options.paginationOptions.length > 0) {
                obj.paginationDropdown = document.createElement('select');
                obj.paginationDropdown.classList.add('jexcel_pagination_dropdown');
                obj.paginationDropdown.onchange = function () {
                    obj.options.pagination = parseInt(this.value);
                    obj.page(0);
                }

                for (var i = 0; i < obj.options.paginationOptions.length; i++) {
                    var temp = document.createElement('option');
                    temp.value = obj.options.paginationOptions[i];
                    temp.innerHTML = obj.options.paginationOptions[i];
                    obj.paginationDropdown.appendChild(temp);
                }

                // Set initial pagination value
                obj.paginationDropdown.value = obj.options.pagination;

                paginationUpdateContainer.appendChild(document.createTextNode(obj.options.text.show));
                paginationUpdateContainer.appendChild(obj.paginationDropdown);
                paginationUpdateContainer.appendChild(document.createTextNode(obj.options.text.entries));
            }

            // Filter and pagination container
            var filter = document.createElement('div');
            filter.classList.add('jexcel_filter');
            filter.appendChild(paginationUpdateContainer);
            filter.appendChild(searchContainer);

            // Colsgroup
            obj.colgroupContainer = document.createElement('colgroup');
            var tempCol = document.createElement('col');
            tempCol.setAttribute('width', '50');
            obj.colgroupContainer.appendChild(tempCol);

            // Nested
            if (obj.options.nestedHeaders && obj.options.nestedHeaders.length > 0) {
                // Flexible way to handle nestedheaders
                if (obj.options.nestedHeaders[0] && obj.options.nestedHeaders[0][0]) {
                    for (var j = 0; j < obj.options.nestedHeaders.length; j++) {
                        obj.thead.appendChild(obj.createNestedHeader(obj.options.nestedHeaders[j]));
                    }
                } else {
                    obj.thead.appendChild(obj.createNestedHeader(obj.options.nestedHeaders));
                }
            }

            // Row
            obj.headerContainer = document.createElement('tr');
            var tempCol = document.createElement('td');
            tempCol.classList.add('jexcel_selectall');
            obj.headerContainer.appendChild(tempCol);

            for (var i = 0; i < obj.options.columns.length; i++) {
                // Create header
                obj.createCellHeader(i);
                // Append cell to the container
                obj.headerContainer.appendChild(obj.headers[i]);
                obj.colgroupContainer.appendChild(obj.colgroup[i]);
            }

            obj.thead.appendChild(obj.headerContainer);

            // Filters
            if (obj.options.filters == true) {
                obj.filter = document.createElement('tr');
                var td = document.createElement('td');
                obj.filter.appendChild(td);

                for (var i = 0; i < obj.options.columns.length; i++) {
                    var td = document.createElement('td');
                    td.innerHTML = '&nbsp;';
                    td.setAttribute('data-x', i);
                    td.className = 'jexcel_column_filter';
                    if (obj.options.columns[i].type == 'hidden') {
                        td.style.display = 'none';
                    }
                    obj.filter.appendChild(td);
                }

                obj.thead.appendChild(obj.filter);
            }

            // Content table
            obj.table = document.createElement('table');
            obj.table.classList.add('jexcel');
            obj.table.setAttribute('cellpadding', '0');
            obj.table.setAttribute('cellspacing', '0');
            obj.table.setAttribute('unselectable', 'yes');
            //obj.table.setAttribute('onselectstart', 'return false');
            obj.table.appendChild(obj.colgroupContainer);
            obj.table.appendChild(obj.thead);
            obj.table.appendChild(obj.tbody);

            if (!obj.options.textOverflow) {
                obj.table.classList.add('jexcel_overflow');
            }

            // Spreadsheet corner
            obj.corner = document.createElement('div');
            obj.corner.className = 'jexcel_corner';
            obj.corner.setAttribute('unselectable', 'on');
            obj.corner.setAttribute('onselectstart', 'return false');

            if (obj.options.selectionCopy == false) {
                obj.corner.style.display = 'none';
            }

            // Textarea helper
            obj.textarea = document.createElement('textarea');
            obj.textarea.className = 'jexcel_textarea';
            obj.textarea.id = 'jexcel_textarea';
            obj.textarea.tabIndex = '-1';

            // Contextmenu container
            obj.contextMenu = document.createElement('div');
            obj.contextMenu.className = 'jexcel_contextmenu';

            // Create element
            jSuites.contextmenu(obj.contextMenu, {
                onclick: function (obj, e) {
                    if (typeof options.onClickContextMenu === 'function') {
                        options.onClickContextMenu(obj, e)
                    } else {
                        obj.close(false);
                    }
                }
            });

            // Powered by jExcel
            var ads = document.createElement('a');
            ads.setAttribute('href', 'https://bossanova.uk/jexcel/');
            obj.ads = document.createElement('div');
            obj.ads.className = 'jexcel_about';
            try {
                if (typeof (sessionStorage) !== "undefined" && !sessionStorage.getItem('jexcel')) {
                    sessionStorage.setItem('jexcel', true);
                    var img = document.createElement('img');
                    img.src = '//bossanova.uk/jexcel/logo.png';
                    ads.appendChild(img);
                }
            } catch (exception) {
            }
            var span = document.createElement('span');
            span.innerHTML = 'Jexcel spreadsheet';
            ads.appendChild(span);
            obj.ads.appendChild(ads);

            // Create table container TODO: frozen columns
            var container = document.createElement('div');
            container.classList.add('jexcel_table');

            // Pagination
            obj.pagination = document.createElement('div');
            obj.pagination.classList.add('jexcel_pagination');
            var paginationInfo = document.createElement('div');
            var paginationPages = document.createElement('div');
            obj.pagination.appendChild(paginationInfo);
            obj.pagination.appendChild(paginationPages);

            // Hide pagination if not in use
            if (!obj.options.pagination) {
                obj.pagination.style.display = 'none';
            }

            // Append containers to the table
            if (obj.options.search == true) {
                el.appendChild(filter);
            }

            // Elements
            obj.content.appendChild(obj.table);
            obj.content.appendChild(obj.corner);
            obj.content.appendChild(obj.textarea);

            el.appendChild(obj.toolbar);
            el.appendChild(obj.content);
            el.appendChild(obj.pagination);
            el.appendChild(obj.contextMenu);
            el.appendChild(obj.ads);
            el.classList.add('jexcel_container');

            // Create toolbar
            if (obj.options.toolbar && obj.options.toolbar.length) {
                obj.createToolbar();
            }

            // Fullscreen
            if (obj.options.fullscreen == true) {
                el.classList.add('fullscreen');
            } else {
                // Overflow
                if (obj.options.tableOverflow == true) {
                    if (obj.options.tableHeight) {
                        obj.content.style['overflow-y'] = 'auto';
                        obj.content.style.maxHeight = obj.options.tableHeight;
                    }
                    if (obj.options.tableWidth) {
                        obj.content.style['overflow-x'] = 'auto';
                        obj.content.style.width = obj.options.tableWidth;
                    }
                }
            }

            // With toolbars
            if (obj.options.tableOverflow != true && obj.options.toolbar) {
                el.classList.add('with-toolbar');
            }

            // Actions
            if (obj.options.columnDrag == true) {
                obj.thead.classList.add('draggable');
            }
            if (obj.options.columnResize == true) {
                obj.thead.classList.add('resizable');
            }
            if (obj.options.rowDrag == true) {
                obj.tbody.classList.add('draggable');
            }
            if (obj.options.rowResize == true) {
                obj.tbody.classList.add('resizable');
            }

            // Load data
            obj.setData();

            // Style
            if (obj.options.style) {
                obj.setStyle(obj.options.style, null, null, 1, 1);
            }

            // Classes
            if (obj.options.classes) {
                var k = Object.keys(obj.options.classes);
                for (var i = 0; i < k.length; i++) {
                    var cell = jexcel.getIdFromColumnName(k[i], true);
                    obj.records[cell[1]][cell[0]].classList.add(obj.options.classes[k[i]]);
                }
            }
        }

        /**
         * Refresh the data
         *
         * @return void
         */
        obj.refresh = function () {
            if (obj.options.url) {
                // Loading
                if (obj.options.loadingSpin == true) {
                    jSuites.loading.show();
                }

                jSuites.ajax({
                    url: obj.options.url,
                    method: obj.options.method,
                    data: obj.options.requestVariables,
                    dataType: 'json',
                    success: function (result) {
                        // Data
                        obj.options.data = (result.data) ? result.data : result;
                        // Prepare table
                        obj.setData();
                        // Hide spin
                        if (obj.options.loadingSpin == true) {
                            jSuites.loading.hide();
                        }
                    }
                });
            } else {
                obj.setData();
            }
        }

        /**
         * Set data
         *
         * @param array data In case no data is sent, default is reloaded
         * @return void
         */
        obj.setData = function (data) {
            // Update data
            if (data) {
                if (typeof (data) == 'string') {
                    data = JSON.parse(data);
                }

                obj.options.data = data;
            }

            // Data
            if (!obj.options.data) {
                obj.options.data = [];
            }

            // Prepare data
            if (obj.options.data && obj.options.data[0]) {
                if (!Array.isArray(obj.options.data[0])) {
                    var data = [];
                    for (var j = 0; j < obj.options.data.length; j++) {
                        var row = [];
                        for (var i = 0; i < obj.options.columns.length; i++) {
                            row[i] = obj.options.data[j][obj.options.columns[i].name];
                        }
                        data.push(row);
                    }

                    obj.options.data = data;
                }
            }

            // Adjust minimal dimensions
            var j = 0;
            var i = 0;
            var size_i = obj.options.columns.length;
            var size_j = obj.options.data.length;
            var min_i = obj.options.minDimensions[0];
            var min_j = obj.options.minDimensions[1];
            var max_i = min_i > size_i ? min_i : size_i;
            var max_j = min_j > size_j ? min_j : size_j;

            for (j = 0; j < max_j; j++) {
                for (i = 0; i < max_i; i++) {
                    if (obj.options.data[j] == undefined) {
                        obj.options.data[j] = [];
                    }

                    if (obj.options.data[j][i] == undefined) {
                        obj.options.data[j][i] = '';
                    }
                }
            }

            // Reset containers
            obj.rows = [];
            obj.results = null;
            obj.records = [];
            obj.history = [];

            // Reset internal controllers
            obj.historyIndex = -1;

            // Reset data
            obj.tbody.innerHTML = '';

            // Lazy loading
            if (obj.options.lazyLoading == true) {
                // Load only 100 records
                var startNumber = 0
                var finalNumber = obj.options.data.length < 100 ? obj.options.data.length : 100;

                if (obj.options.pagination) {
                    obj.options.pagination = false;
                    console.error('JEXCEL: Pagination will be disable due the lazyLoading');
                }
            } else if (obj.options.pagination) {
                // Pagination
                if (!obj.pageNumber) {
                    obj.pageNumber = 0;
                }
                var quantityPerPage = obj.options.pagination;
                startNumber = (obj.options.pagination * obj.pageNumber);
                finalNumber = (obj.options.pagination * obj.pageNumber) + obj.options.pagination;

                if (obj.options.data.length < finalNumber) {
                    finalNumber = obj.options.data.length;
                }
            } else {
                var startNumber = 0;
                var finalNumber = obj.options.data.length;
            }

            // Append nodes to the HTML
            for (j = 0; j < obj.options.data.length; j++) {
                // Create row
                var tr = obj.createRow(j, obj.options.data[j]);
                // Append line to the table
                if (j >= startNumber && j < finalNumber) {
                    obj.tbody.appendChild(tr);
                }
            }

            if (obj.options.lazyLoading == true) {
                // Do not create pagination with lazyloading activated
            } else if (obj.options.pagination) {
                obj.updatePagination();
            }

            // Merge cells
            if (obj.options.mergeCells) {
                var keys = Object.keys(obj.options.mergeCells);
                for (var i = 0; i < keys.length; i++) {
                    var num = obj.options.mergeCells[keys[i]];
                    obj.setMerge(keys[i], num[0], num[1], 1);
                }
            }

            // Updata table with custom configurations if applicable
            obj.updateTable();

            // Onload
            obj.dispatch('onload', el, obj);
        }

        /**
         * Get the whole table data
         *
         * @param bool get highlighted cells only
         * @return array data
         */
        obj.getData = function (highlighted, dataOnly) {
            // Control vars
            var dataset = [];
            var px = 0;
            var py = 0;

            // Data type
            var dataType = dataOnly == true || obj.options.copyCompatibility == false ? true : false;

            // Column and row length
            var x = obj.options.columns.length
            var y = obj.options.data.length

            // Go through the columns to get the data
            for (var j = 0; j < y; j++) {
                px = 0;
                for (var i = 0; i < x; i++) {
                    // Cell selected or fullset
                    if (!highlighted || obj.records[j][i].classList.contains('highlight')) {
                        // Get value
                        if (!dataset[py]) {
                            dataset[py] = [];
                        }
                        if (!dataType) {
                            dataset[py][px] = obj.records[j][i].innerHTML;
                        } else {
                            dataset[py][px] = obj.options.data[j][i];
                        }
                        px++;
                    }
                }
                if (px > 0) {
                    py++;
                }
            }

            return dataset;
        }

        /**
         * Get json data by row number
         *
         * @param integer row number
         * @return object
         */
        obj.getJsonRow = function (rowNumber) {
            var rowData = obj.options.data[rowNumber];
            var x = obj.options.columns.length

            var row = {};
            for (var i = 0; i < x; i++) {
                if (!obj.options.columns[i].name) {
                    obj.options.columns[i].name = i;
                }
                row[obj.options.columns[i].name] = rowData[i];
            }

            return row;
        }

        /**
         * Get the whole table data
         *
         * @param bool highlighted cells only
         * @return string value
         */
        obj.getJson = function (highlighted) {
            // Control vars
            var data = [];

            // Column and row length
            var x = obj.options.columns.length
            var y = obj.options.data.length

            // Go through the columns to get the data
            for (var j = 0; j < y; j++) {
                var row = null;
                for (var i = 0; i < x; i++) {
                    if (!highlighted || obj.records[j][i].classList.contains('highlight')) {
                        if (row == null) {
                            row = {};
                        }
                        if (!obj.options.columns[i].name) {
                            obj.options.columns[i].name = i;
                        }
                        row[obj.options.columns[i].name] = obj.options.data[j][i];
                    }
                }

                if (row != null) {
                    data.push(row);
                }
            }

            return data;
        }

        /**
         * Prepare JSON in the correct format
         */
        obj.prepareJson = function (data) {
            var rows = [];
            for (var i = 0; i < data.length; i++) {
                var x = data[i].x;
                var y = data[i].y;
                var k = obj.options.columns[x].name ? obj.options.columns[x].name : x;

                // Create row
                if (!rows[y]) {
                    rows[y] = {
                        row: y,
                        data: {},
                    };
                }
                rows[y].data[k] = data[i].newValue;
            }

            // Filter rows
            return rows.filter(function (el) {
                return el != null;
            });
        }

        /**
         * Post json to a remote server
         */
        obj.save = function (url, data) {
            // Parse anything in the data before sending to the server
            var ret = obj.dispatch('onbeforesave', el, obj, data);
            if (ret) {
                var data = ret;
            } else {
                if (ret === false) {
                    return false;
                }
            }

            // Remove update
            jSuites.ajax({
                url: url,
                method: 'POST',
                dataType: 'json',
                data: {data: JSON.stringify(data)},
                success: function (result) {
                    // Event
                    obj.dispatch('onsave', el, obj, data);
                }
            });
        }

        /**
         * Get a row data by rowNumber
         */
        obj.getRowData = function (rowNumber) {
            return obj.options.data[rowNumber];
        }

        /**
         * Set a row data by rowNumber
         */
        obj.setRowData = function (rowNumber, data, force = false) {
            for (var i = 0; i < obj.headers.length; i++) {
                // Update cell
                var columnName = jexcel.getColumnNameFromId([i, rowNumber]);
                // Set value
                if (data[i] != null) {
                    obj.setValue(columnName, data[i], force);
                }
            }
        }

        /**
         * Get a column data by columnNumber
         */
        obj.getColumnData = function (columnNumber) {
            var dataset = [];
            // Go through the rows to get the data
            for (var j = 0; j < obj.options.data.length; j++) {
                dataset.push(obj.options.data[j][columnNumber]);
            }
            return dataset;
        }

        /**
         * Set a column data by colNumber
         */
        obj.setColumnData = function (colNumber, data) {
            for (var j = 0; j < obj.rows.length; j++) {
                // Update cell
                var columnName = jexcel.getColumnNameFromId([colNumber, j]);
                // Set value
                if (data[j] != null) {
                    obj.setValue(columnName, data[j]);
                }
            }
        }

        /**
         * Create row
         */
        obj.createRow = function (j, data) {
            // Create container
            if (!obj.records[j]) {
                obj.records[j] = [];
            }
            // Default data
            if (!data) {
                var data = obj.options.data[j];
            }
            // New line of data to be append in the table
            obj.rows[j] = document.createElement('tr');
            obj.rows[j].setAttribute('data-y', j);
            // Index
            var index = null;
            // Definitions
            if (obj.options.rows[j]) {
                if (obj.options.rows[j].height) {
                    obj.rows[j].style.height = obj.options.rows[j].height;
                }
                if (obj.options.rows[j].title) {
                    index = obj.options.rows[j].title;
                }
            }
            if (!index) {
                index = parseInt(j + 1);
            }
            // Row number label
            var td = document.createElement('td');
            td.innerHTML = index;
            td.setAttribute('data-y', j);
            td.className = 'jexcel_row';
            obj.rows[j].appendChild(td);

            // Data columns
            for (var i = 0; i < obj.options.columns.length; i++) {
                // New column of data to be append in the line
                obj.records[j][i] = obj.createCell(i, j, data[i]);
                // Add column to the row
                obj.rows[j].appendChild(obj.records[j][i]);
            }

            obj.dispatch('oncreaterow', obj.rows[j], j);

            // Add row to the table body
            return obj.rows[j];
        }

        obj.parseValue = function (i, j, value) {
            if (('' + value).substr(0, 1) == '=' && obj.options.parseFormulas == true) {
                value = obj.executeFormula(value, i, j)
            }
            if (obj.options.columns[i].mask) {
                var decimal = obj.options.columns[i].decimal || '.';
                value = '' + jSuites.mask.run(value, obj.options.columns[i].mask, decimal);
            }
            return value;
        }

        /**
         * Create cell
         */
        obj.createCell = function (i, j, value) {
            // Create cell and properties
            var td = document.createElement('td');
            td.setAttribute('data-x', i);
            td.setAttribute('data-y', j);

            // Security
            if (('' + value).substr(0, 1) == '=' && obj.options.secureFormulas == true) {
                var val = secureFormula(value);
                if (val != value) {
                    // Update the data container
                    value = val;
                }
            }

            // Custom column
            if (obj.options.columns[i].editor) {
                // if (obj.options.stripHTML === false || obj.options.columns[i].stripHTML === false) {
                //     td.innerHTML = value;
                // } else {
                //     td.innerText = value;
                // }

                if (typeof (obj.options.columns[i].editor.createCell) == 'function') {
                    td = obj.options.columns[i].editor.createCell(td, i, value, obj);
                }
            } else {
                // Hidden column
                if (obj.options.columns[i].type == 'hidden') {
                    td.style.display = 'none';
                    td.innerText = value;
                } else if (obj.options.columns[i].type == 'checkbox' || obj.options.columns[i].type == 'radio') {
                    // Create input
                    var element = document.createElement('input');
                    element.type = obj.options.columns[i].type;
                    element.name = 'c' + i;
                    element.checked = (value == 1 || value == true || value == 'true') ? true : false;
                    element.onclick = function () {
                        obj.setValue(td, this.checked);
                    }

                    if (obj.options.columns[i].readOnly == true || obj.options.editable == false) {
                        element.setAttribute('disabled', 'disabled');
                    }

                    // Append to the table
                    td.appendChild(element);
                    // Make sure the values are correct
                    obj.options.data[j][i] = element.checked;
                } else if (obj.options.columns[i].type == 'calendar') {
                    // Try formatted date
                    var formatted = jSuites.calendar.extractDateFromString(value, obj.options.columns[i].options.format);
                    // Create calendar cell
                    td.innerText = jSuites.calendar.getDateString(formatted ? formatted : value, obj.options.columns[i].options.format);
                } else if (obj.options.columns[i].type == 'dropdown' || obj.options.columns[i].type == 'autocomplete') {
                    // Create dropdown cell
                    td.classList.add('jexcel_dropdown');
                    // console.log(td)

                    td.innerText = obj.getDropDownValue(i, value, j, td);
                } else if (obj.options.columns[i].type == 'color') {
                    if (obj.options.columns[i].render == 'square') {
                        var color = document.createElement('div');
                        color.className = 'color';
                        color.style.backgroundColor = value;
                        td.appendChild(color);
                    } else {
                        td.style.color = value;
                        td.innerText = value;
                    }
                } else if (obj.options.columns[i].type == 'image') {
                    if (value && value.substr(0, 10) == 'data:image') {
                        var img = document.createElement('img');
                        img.src = value;
                        td.appendChild(img);
                    }
                } else {
                    if (obj.options.columns[i].type == 'html') {
                        td.innerHTML = stripScript(obj.parseValue(i, j, value));
                    } else {
                        if (obj.options.stripHTML === false || obj.options.columns[i].stripHTML === false) {
                            td.innerHTML = stripScript(obj.parseValue(i, j, value));
                        } else {
                            td.innerText = obj.parseValue(i, j, value);
                        }
                    }
                }
            }

            // Readonly
            if (obj.options.columns[i].readOnly == true) {
                td.className = 'readonly';
            }

            // Text align
            var colAlign = obj.options.columns[i].align ? obj.options.columns[i].align : 'center';
            td.style.textAlign = colAlign;

            // Wrap option
            if (obj.options.columns[i].wordWrap != false && (obj.options.wordWrap == true || obj.options.columns[i].wordWrap == true || td.innerHTML.length > 200)) {
                td.style.whiteSpace = 'pre-wrap';
            }

            // Overflow
            if (i > 0) {
                if (this.options.textOverflow == true) {
                    if (value || td.innerHTML) {
                        obj.records[j][i - 1].style.overflow = 'hidden';
                    } else {
                        if (i == obj.options.columns.length - 1) {
                            td.style.overflow = 'hidden';
                        }
                    }
                }
            }
            return td;
        }

        obj.createCellHeader = function (colNumber) {
            // Create col global control
            var colWidth = obj.options.columns[colNumber].width ? obj.options.columns[colNumber].width : obj.options.defaultColWidth;
            var colAlign = obj.options.columns[colNumber].align ? obj.options.columns[colNumber].align : obj.options.defaultColAlign;

            // Create header cell
            obj.headers[colNumber] = document.createElement('td');

            if (obj.options.stripHTML) {
                obj.headers[colNumber].innerText = obj.options.columns[colNumber].title ? obj.options.columns[colNumber].title : jexcel.getColumnName(colNumber);
            } else {
                obj.headers[colNumber].innerHTML = obj.options.columns[colNumber].title ? obj.options.columns[colNumber].title : jexcel.getColumnName(colNumber);
            }
            obj.headers[colNumber].setAttribute('data-x', colNumber);
            obj.headers[colNumber].style.textAlign = colAlign;
            if (obj.options.columns[colNumber].title) {
                // obj.headers[colNumber].setAttribute('title', obj.options.columns[colNumber].textContent);
            }

            // Width control
            obj.colgroup[colNumber] = document.createElement('col');
            obj.colgroup[colNumber].setAttribute('width', colWidth);

            // Hidden column
            if (obj.options.columns[colNumber].type == 'hidden') {
                obj.headers[colNumber].style.display = 'none';
                obj.colgroup[colNumber].style.display = 'none';
            }

            obj.dispatch('oncreatcellheader', el, obj, colNumber);
        }

        /**
         * Update a nested header title
         */
        obj.updateNestedHeader = function (x, y, title) {
            if (obj.options.nestedHeaders[y][x].title) {
                obj.options.nestedHeaders[y][x].title = title;
                obj.options.nestedHeaders[y].element.children[x + 1].innerText = title;
            }
        }

        /**
         * Create a nested header object
         */
        obj.createNestedHeader = function (nestedInformation) {
            var tr = document.createElement('tr');
            tr.classList.add('jexcel_nested');
            var td = document.createElement('td');
            tr.appendChild(td);
            // Element
            nestedInformation.element = tr;

            var headerIndex = 0;
            for (var i = 0; i < nestedInformation.length; i++) {
                // Default values
                if (!nestedInformation[i].colspan) {
                    nestedInformation[i].colspan = 1;
                }
                if (!nestedInformation[i].align) {
                    nestedInformation[i].align = 'center';
                }
                if (!nestedInformation[i].title) {
                    nestedInformation[i].title = '';
                }

                // Number of columns
                var numberOfColumns = nestedInformation[i].colspan;

                // Classes container
                var column = [];
                // Header classes for this cell
                for (var x = 0; x < numberOfColumns; x++) {
                    if (obj.options.columns[headerIndex] && obj.options.columns[headerIndex].type == 'hidden') {
                        numberOfColumns++;
                    }
                    column.push(headerIndex);
                    headerIndex++;
                }

                // Created the nested cell
                var td = document.createElement('td');
                td.setAttribute('data-column', column.join(','));
                td.setAttribute('colspan', nestedInformation[i].colspan);
                td.setAttribute('align', nestedInformation[i].align);
                td.innerText = nestedInformation[i].title;
                tr.appendChild(td);
            }

            return tr;
        }

        /**
         * Create toolbar
         */
        obj.createToolbar = function (toolbar) {
            if (toolbar) {
                obj.options.toolbar = toolbar;
            } else {
                var toolbar = obj.options.toolbar;
            }
            for (var i = 0; i < toolbar.length; i++) {
                if (toolbar[i].type == 'i') {
                    var toolbarItem = document.createElement('i');
                    toolbarItem.classList.add('jexcel_toolbar_item');
                    toolbarItem.classList.add('material-icons');
                    toolbarItem.setAttribute('data-k', toolbar[i].k);
                    toolbarItem.setAttribute('data-v', toolbar[i].v);
                    toolbarItem.setAttribute('id', toolbar[i].id);

                    // Tooltip
                    if (toolbar[i].tooltip) {
                        toolbarItem.setAttribute('title', toolbar[i].tooltip);
                    }
                    // Handle click
                    if (toolbar[i].onclick && typeof (toolbar[i].onclick)) {
                        toolbarItem.onclick = (function (a) {
                            var b = a;
                            return function () {
                                toolbar[b].onclick(el, obj, this);
                            };
                        })(i);
                    } else {
                        toolbarItem.onclick = function () {
                            var k = this.getAttribute('data-k');
                            var v = this.getAttribute('data-v');
                            obj.setStyle(obj.highlighted, k, v);
                        }
                    }
                    // Append element
                    toolbarItem.innerText = toolbar[i].content;
                    obj.toolbar.appendChild(toolbarItem);
                } else if (toolbar[i].type == 'select') {
                    var toolbarItem = document.createElement('select');
                    toolbarItem.classList.add('jexcel_toolbar_item');
                    toolbarItem.setAttribute('data-k', toolbar[i].k);
                    // Tooltip
                    if (toolbar[i].tooltip) {
                        toolbarItem.setAttribute('title', toolbar[i].tooltip);
                    }
                    // Handle onchange
                    if (toolbar[i].onchange && typeof (toolbar[i].onchange)) {
                        toolbarItem.onchange = toolbar[i].onchange;
                    } else {
                        toolbarItem.onchange = function () {
                            var k = this.getAttribute('data-k');
                            obj.setStyle(obj.highlighted, k, this.value);
                        }
                    }
                    // Add options to the dropdown
                    for (var j = 0; j < toolbar[i].v.length; j++) {
                        var toolbarDropdownOption = document.createElement('option');
                        toolbarDropdownOption.value = toolbar[i].v[j];
                        toolbarDropdownOption.innerText = toolbar[i].v[j];
                        toolbarItem.appendChild(toolbarDropdownOption);
                    }
                    obj.toolbar.appendChild(toolbarItem);
                } else if (toolbar[i].type == 'color') {
                    var toolbarItem = document.createElement('i');
                    toolbarItem.classList.add('jexcel_toolbar_item');
                    toolbarItem.classList.add('material-icons');
                    toolbarItem.setAttribute('data-k', toolbar[i].k);
                    toolbarItem.setAttribute('data-v', '');
                    // Tooltip
                    if (toolbar[i].tooltip) {
                        toolbarItem.setAttribute('title', toolbar[i].tooltip);
                    }
                    obj.toolbar.appendChild(toolbarItem);
                    toolbarItem.innerText = toolbar[i].content;
                    jSuites.color(toolbarItem, {
                        onchange: function (o, v) {
                            var k = o.getAttribute('data-k');
                            obj.setStyle(obj.highlighted, k, v);
                        }
                    });
                }
            }
        }

        /**
         * Merge cells
         * @param cellName
         * @param colspan
         * @param rowspan
         * @param ignoreHistoryAndEvents
         */
        obj.setMerge = function (cellName, colspan, rowspan, ignoreHistoryAndEvents) {
            var test = false;

            if (!cellName) {
                if (!obj.highlighted.length) {
                    alert(obj.options.text.noCellsSelected);
                    return null;
                } else {
                    var x1 = parseInt(obj.highlighted[0].getAttribute('data-x'));
                    var y1 = parseInt(obj.highlighted[0].getAttribute('data-y'));
                    var x2 = parseInt(obj.highlighted[obj.highlighted.length - 1].getAttribute('data-x'));
                    var y2 = parseInt(obj.highlighted[obj.highlighted.length - 1].getAttribute('data-y'));
                    var cellName = jexcel.getColumnNameFromId([x1, y1]);
                    var colspan = (x2 - x1) + 1;
                    var rowspan = (y2 - y1) + 1;
                }
            }

            var cell = jexcel.getIdFromColumnName(cellName, true);

            if (obj.options.mergeCells[cellName]) {
                if (obj.records[cell[1]][cell[0]].getAttribute('data-merged')) {
                    test = obj.options.text.cellAlreadyMerged;
                }
            } else if ((!colspan || colspan < 2) && (!rowspan || rowspan < 2)) {
                test = obj.options.text.invalidMergeProperties;
            } else {
                var cells = [];
                for (var j = cell[1]; j < cell[1] + rowspan; j++) {
                    for (var i = cell[0]; i < cell[0] + colspan; i++) {
                        var columnName = jexcel.getColumnNameFromId([i, j]);
                        if (obj.records[j][i].getAttribute('data-merged')) {
                            test = obj.options.text.thereIsAConflictWithAnotherMergedCell;
                        }
                    }
                }
            }

            if (test) {
                alert(test);
            } else {
                // Add property
                if (colspan > 1) {
                    obj.records[cell[1]][cell[0]].setAttribute('colspan', colspan);
                } else {
                    colspan = 1;
                }
                if (rowspan > 1) {
                    obj.records[cell[1]][cell[0]].setAttribute('rowspan', rowspan);
                } else {
                    rowspan = 1;
                }
                // Keep links to the existing nodes
                obj.options.mergeCells[cellName] = [colspan, rowspan, []];
                // Mark cell as merged
                obj.records[cell[1]][cell[0]].setAttribute('data-merged', 'true');
                // Overflow
                obj.records[cell[1]][cell[0]].style.overflow = 'hidden';
                // History data
                var data = [];
                // Adjust the nodes
                for (var y = cell[1]; y < cell[1] + rowspan; y++) {
                    for (var x = cell[0]; x < cell[0] + colspan; x++) {
                        if (!(cell[0] == x && cell[1] == y)) {
                            data.push(obj.options.data[y][x]);
                            obj.updateCell(x, y, '', true);
                            obj.options.mergeCells[cellName][2].push(obj.records[y][x]);
                            obj.records[y][x].style.display = 'none';
                            obj.records[y][x] = obj.records[cell[1]][cell[0]];
                        }
                    }
                }
                // In the initialization is not necessary keep the history
                obj.updateSelection(obj.records[cell[1]][cell[0]]);

                if (!ignoreHistoryAndEvents) {
                    obj.setHistory({
                        action: 'setMerge',
                        column: cellName,
                        colspan: colspan,
                        rowspan: rowspan,
                        data: data,
                    });

                    obj.dispatch('onmerge', el, cellName, colspan, rowspan);
                }
            }
        }

        /**
         * Merge cells
         * @param cellName
         * @param colspan
         * @param rowspan
         * @param ignoreHistoryAndEvents
         */
        obj.getMerge = function (cellName) {
            var data = {};
            if (cellName) {
                if (obj.options.mergeCells[cellName]) {
                    data = [obj.options.mergeCells[cellName][0], obj.options.mergeCells[cellName][1]];
                } else {
                    data = null;
                }
            } else {
                if (obj.options.mergeCells) {
                    var mergedCells = obj.options.mergeCells;
                    var keys = Object.keys(obj.options.mergeCells);
                    for (var i = 0; i < keys.length; i++) {
                        data[keys[i]] = [obj.options.mergeCells[keys[i]][0], obj.options.mergeCells[keys[i]][1]];
                    }
                }
            }

            return data;
        }

        /**
         * Remove merge by cellname
         * @param cellName
         */
        obj.removeMerge = function (cellName, data, keepOptions) {
            if (obj.options.mergeCells[cellName]) {
                var cell = jexcel.getIdFromColumnName(cellName, true);
                obj.records[cell[1]][cell[0]].removeAttribute('colspan');
                obj.records[cell[1]][cell[0]].removeAttribute('rowspan');
                obj.records[cell[1]][cell[0]].removeAttribute('data-merged');
                var info = obj.options.mergeCells[cellName];

                var index = 0;
                for (var j = 0; j < info[1]; j++) {
                    for (var i = 0; i < info[0]; i++) {
                        if (j > 0 || i > 0) {
                            obj.records[cell[1] + j][cell[0] + i] = info[2][index];
                            obj.records[cell[1] + j][cell[0] + i].style.display = '';
                            // Recover data
                            if (data && data[index]) {
                                obj.updateCell(cell[0] + i, cell[1] + j, data[index]);
                            }
                            index++;
                        }
                    }
                }

                // Update selection
                obj.updateSelection(obj.records[cell[1]][cell[0]], obj.records[cell[1] + j - 1][cell[0] + i - 1]);

                if (!keepOptions) {
                    delete (obj.options.mergeCells[cellName]);
                }
            }
        }

        /**
         * Remove all merged cells
         */
        obj.destroyMerged = function (keepOptions) {
            // Remove any merged cells
            if (obj.options.mergeCells) {
                var mergedCells = obj.options.mergeCells;
                var keys = Object.keys(obj.options.mergeCells);
                for (var i = 0; i < keys.length; i++) {
                    obj.removeMerge(keys[i], null, keepOptions);
                }
            }
        }

        /**
         * Is column merged
         */
        obj.isColMerged = function (x, insertBefore) {
            var cols = [];
            // Remove any merged cells
            if (obj.options.mergeCells) {
                var keys = Object.keys(obj.options.mergeCells);
                for (var i = 0; i < keys.length; i++) {
                    var info = jexcel.getIdFromColumnName(keys[i], true);
                    var colspan = obj.options.mergeCells[keys[i]][0];
                    var x1 = info[0];
                    var x2 = info[0] + (colspan > 1 ? colspan - 1 : 0);

                    if (insertBefore == null) {
                        if ((x1 <= x && x2 >= x)) {
                            cols.push(keys[i]);
                        }
                    } else {
                        if (insertBefore) {
                            if ((x1 < x && x2 >= x)) {
                                cols.push(keys[i]);
                            }
                        } else {
                            if ((x1 <= x && x2 > x)) {
                                cols.push(keys[i]);
                            }
                        }
                    }
                }
            }

            return cols;
        }

        /**
         * Is rows merged
         */
        obj.isRowMerged = function (y, insertBefore) {
            var rows = [];
            // Remove any merged cells
            if (obj.options.mergeCells) {
                var keys = Object.keys(obj.options.mergeCells);
                for (var i = 0; i < keys.length; i++) {
                    var info = jexcel.getIdFromColumnName(keys[i], true);
                    var rowspan = obj.options.mergeCells[keys[i]][1];
                    var y1 = info[1];
                    var y2 = info[1] + (rowspan > 1 ? rowspan - 1 : 0);

                    if (insertBefore == null) {
                        if ((y1 <= y && y2 >= y)) {
                            rows.push(keys[i]);
                        }
                    } else {
                        if (insertBefore) {
                            if ((y1 < y && y2 >= y)) {
                                rows.push(keys[i]);
                            }
                        } else {
                            if ((y1 <= y && y2 > y)) {
                                rows.push(keys[i]);
                            }
                        }
                    }
                }
            }

            return rows;
        }

        /**
         * Open the column filter
         */
        obj.openFilter = function (columnId) {
            if (!obj.options.filters) {
                console.log('JEXCEL: filters not enabled.');
            } else {
                // Make sure is integer
                columnId = parseInt(columnId);
                // Reset selection
                obj.resetSelection();
                // Load options
                var optionsFiltered = [];
                if (obj.options.columns[columnId].type == 'checkbox') {
                    optionsFiltered.push({id: 'true', name: 'True'});
                    optionsFiltered.push({id: 'false', name: 'False'});
                } else {
                    var options = [];
                    var hasBlanks = false;
                    for (var j = 0; j < obj.options.data.length; j++) {
                        var k = obj.options.data[j][columnId];
                        var v = obj.records[j][columnId].innerHTML;
                        if (k && v) {
                            options[k] = v;
                        } else {
                            var hasBlanks = true;
                        }
                    }
                    var keys = Object.keys(options);
                    var optionsFiltered = [];
                    for (var j = 0; j < keys.length; j++) {
                        optionsFiltered.push({id: keys[j], name: options[keys[j]]});
                    }
                    // Has blank options
                    if (hasBlanks) {
                        optionsFiltered.push({value: '', id: '', name: '(Blanks)'});
                    }
                }

                // Create dropdown
                var div = document.createElement('div');
                obj.filter.children[columnId + 1].innerHTML = '';
                obj.filter.children[columnId + 1].appendChild(div);
                obj.filter.children[columnId + 1].style.paddingLeft = '0px';
                obj.filter.children[columnId + 1].style.paddingRight = '0px';
                obj.filter.children[columnId + 1].style.overflow = 'initial';

                var opt = {
                    data: optionsFiltered,
                    multiple: true,
                    autocomplete: true,
                    opened: true,
                    value: obj.filters[columnId] !== undefined ? obj.filters[columnId] : null,
                    width: '100%',
                    position: (obj.options.tableOverflow == true || obj.options.fullscreen == true) ? true : false,
                    onclose: function (o) {
                        obj.resetFilters();
                        obj.filters[columnId] = o.dropdown.getValue(true);
                        obj.filter.children[columnId + 1].innerHTML = o.dropdown.getText();
                        obj.filter.children[columnId + 1].style.paddingLeft = '';
                        obj.filter.children[columnId + 1].style.paddingRight = '';
                        obj.filter.children[columnId + 1].style.overflow = '';
                        obj.closeFilter(columnId);
                        obj.refreshSelection();
                    }
                };

                // Dynamic dropdown
                jSuites.dropdown(div, opt);
            }
        }

        obj.resetFilters = function () {
            if (obj.options.filters) {
                for (var i = 0; i < obj.filter.children.length; i++) {
                    obj.filter.children[i].innerHTML = '&nbsp;';
                    obj.filters[i] = null;
                }
            }
        }

        obj.closeFilter = function (columnId) {
            if (!columnId) {
                for (var i = 0; i < obj.filter.children.length; i++) {
                    if (obj.filters[i]) {
                        columnId = i;
                    }
                }
            }

            // Search filter
            var search = function (query, x, y) {
                for (var i = 0; i < query.length; i++) {
                    if ((query[i] == '' && // Blank matching
                        ((obj.options.data[y][x] === false) || // Unchecked checkbox
                            ('' + obj.options.data[y][x]) == '')) || // Blank non-checkbox value
                        ((query[i] != '' && // Normal non-blank filtering
                            (('' + obj.options.data[y][x]).search(query[i]) >= 0 ||
                                ('' + obj.records[y][x].innerHTML).search(query[i]) >= 0)))) {
                        return true;
                    }
                }
                return false;
            }

            var query = obj.filters[columnId];
            obj.results = [];
            for (var j = 0; j < obj.options.data.length; j++) {
                if (search(query, columnId, j)) {
                    obj.results.push(j);
                }
            }
            if (!obj.results.length) {
                obj.results = null;
            }

            obj.updateResult();
        }

        /**
         * Open the editor
         *
         * @param object cell
         * @return void
         */
        obj.openEditor = function (cell, empty, e) {
            // Get cell position
            var y = cell.getAttribute('data-y');
            var x = cell.getAttribute('data-x');

            // On edition start
            obj.dispatch('oneditionstart', el, cell, x, y);

            // Overflow
            if (x > 0) {
                obj.records[y][x - 1].style.overflow = 'hidden';
            }

            // Create editor
            var createEditor = function (type) {
                // Cell information
                var info = cell.getBoundingClientRect();

                // Create dropdown
                var editor = document.createElement(type);
                editor.style.width = (info.width) + 'px';
                editor.style.height = (info.height - 2) + 'px';
                editor.style.minHeight = (info.height - 2) + 'px';

                // Edit cell
                cell.classList.add('editor');
                cell.innerHTML = '';
                cell.appendChild(editor);

                // On edition start
                obj.dispatch('oncreateeditor', el, cell, x, y, editor);

                return editor;
            }

            // Readonly
            if (cell.classList.contains('readonly') == true) {
                // Do nothing
            } else {
                // Holder
                obj.edition = [obj.records[y][x], obj.records[y][x].innerHTML, x, y];

                // If there is a custom editor for it
                if (obj.options.columns[x].editor) {
                    // Custom editors
                    obj.options.columns[x].editor.openEditor(cell, el, obj);
                } else {
                    // Native functions
                    if (obj.options.columns[x].type == 'hidden') {
                        // Do nothing
                    } else if (obj.options.columns[x].type == 'checkbox' || obj.options.columns[x].type == 'radio') {
                        // Get value
                        var value = cell.children[0].checked ? false : true;
                        // Toogle value
                        obj.setValue(cell, value);
                        // Do not keep edition open
                        obj.edition = null;
                    } else if (obj.options.columns[x].type == 'dropdown' || obj.options.columns[x].type == 'autocomplete') {
                        // Get current value
                        var value = obj.options.data[y][x];
                        if (obj.options.columns[x].multiple && !Array.isArray(value)) {
                            value = value.split(';');
                        }

                        // Create dropdown
                        if (typeof (obj.options.columns[x].filter) == 'function') {
                            var source = obj.options.columns[x].filter(el, cell, x, y, obj);
                        } else {
                            var source = obj.options.columns[x].source;
                        }

                        // Do not change the original source
                        var data = [];
                        for (var j = 0; j < source.length; j++) {
                            data.push(source[j]);
                        }

                        // Create editor
                        var editor = createEditor('div');
                        var options = {
                            data: data,
                            multiple: obj.options.columns[x].multiple ? true : false,
                            autocomplete: obj.options.columns[x].autocomplete || obj.options.columns[x].type == 'autocomplete' ? true : false,
                            opened: true,
                            value: value,
                            width: '100%',
                            height: editor.style.minHeight,
                            position: (obj.options.tableOverflow == true || obj.options.fullscreen == true) ? true : false,
                            onclose: function () {
                                obj.closeEditor(cell, true);
                            }
                        };
                        if (obj.options.columns[x].options && obj.options.columns[x].options.type) {
                            options.type = obj.options.columns[x].options.type;
                        }

                        jSuites.dropdown(editor, options);
                    } else if (obj.options.columns[x].type == 'calendar' || obj.options.columns[x].type == 'color') {
                        // Value
                        var value = obj.options.data[y][x];
                        // Create editor
                        var editor = createEditor('input');
                        editor.value = value;

                        if (obj.options.tableOverflow == true || obj.options.fullscreen == true) {
                            obj.options.columns[x].options.position = true;
                        }
                        obj.options.columns[x].options.value = obj.options.data[y][x];
                        obj.options.columns[x].options.opened = true;
                        obj.options.columns[x].options.onclose = function (el, value) {
                            obj.closeEditor(cell, true);
                        }
                        // Current value
                        if (obj.options.columns[x].type == 'color') {
                            jSuites.color(editor, obj.options.columns[x].options);
                        } else {
                            jSuites.calendar(editor, obj.options.columns[x].options);
                        }
                        // Focus on editor
                        editor.focus();
                    } else if (obj.options.columns[x].type == 'html') {
                        var value = obj.options.data[y][x];
                        // Create editor
                        var editor = createEditor('div');
                        editor.style.position = 'relative';
                        var div = document.createElement('div');
                        div.classList.add('jexcel_richtext');
                        editor.appendChild(div);
                        jSuites.editor(div, {
                            focus: true,
                            value: value,
                        });
                        var rect = cell.getBoundingClientRect();
                        var rectContent = div.getBoundingClientRect();
                        if (window.innerHeight < rect.bottom + rectContent.height) {
                            div.style.top = (rect.top - (rectContent.height + 2)) + 'px';
                        } else {
                            div.style.top = (rect.top) + 'px';
                        }
                    } else if (obj.options.columns[x].type == 'image') {
                        // Value
                        var img = cell.children[0];
                        // Create editor
                        var editor = createEditor('div');
                        editor.style.position = 'relative';
                        var div = document.createElement('div');
                        div.classList.add('jclose');
                        if (img && img.src) {
                            div.appendChild(img);
                        }
                        editor.appendChild(div);
                        jSuites.image(div, obj.options.imageOptions);
                        var rect = cell.getBoundingClientRect();
                        var rectContent = div.getBoundingClientRect();
                        if (window.innerHeight < rect.bottom + rectContent.height) {
                            div.style.top = (rect.top - (rectContent.height + 2)) + 'px';
                        } else {
                            div.style.top = (rect.top) + 'px';
                        }
                    } else {
                        // Value
                        var value = empty == true ? '' : obj.options.data[y][x];

                        // Basic editor
                        if (obj.options.columns[x].wordWrap != false && (obj.options.wordWrap == true || obj.options.columns[x].wordWrap == true)) {
                            var editor = createEditor('textarea');
                        } else {
                            var editor = createEditor('input');
                            // Mask
                            if (obj.options.columns[x].mask) {
                                editor.setAttribute('data-mask', obj.options.columns[x].mask);
                            }
                        }

                        editor.onblur = function () {
                            obj.closeEditor(cell, true);
                        };
                        editor.focus();
                        editor.value = value;
                        editor.scrollLeft = editor.scrollWidth;
                    }
                }
            }
        }

        /**
         * Close the editor and save the information
         *
         * @param object cell
         * @param boolean save
         * @return void
         */
        obj.closeEditor = function (cell, save) {
            var x = parseInt(cell.getAttribute('data-x'));
            var y = parseInt(cell.getAttribute('data-y'));
            // Get cell properties
            if (save == true) {
                // If custom editor
                if (obj.options.columns[x].editor) {
                    // Custom editor
                    var value = obj.options.columns[x].editor.closeEditor(cell, save);
                } else {
                    // Native functions
                    if (obj.options.columns[x].type == 'checkbox' || obj.options.columns[x].type == 'radio' || obj.options.columns[x].type == 'hidden') {
                        // Do nothing
                    } else if (obj.options.columns[x].type == 'dropdown' || obj.options.columns[x].type == 'autocomplete') {
                        var value = cell.children[0].dropdown.close(true);
                    } else if (obj.options.columns[x].type == 'calendar') {
                        var value = cell.children[0].calendar.close(true, false);
                    } else if (obj.options.columns[x].type == 'color') {
                        var value = cell.children[0].color.close(true);
                    } else if (obj.options.columns[x].type == 'html') {
                        var value = cell.children[0].children[0].editor.getData();
                    } else if (obj.options.columns[x].type == 'image') {
                        var img = cell.children[0].children[0].children[0];
                        var value = img && img.tagName == 'IMG' ? img.src : '';
                    } else if (obj.options.columns[x].type == 'numeric') {
                        var value = cell.children[0].value;
                        if (value.substr(0, 1) != '=') {
                            if (value == '') {
                                value = obj.options.columns[x].allowEmpty ? '' : 0;
                            }
                        }
                        cell.children[0].onblur = null;
                    } else {
                        var value = cell.children[0].value;
                        cell.children[0].onblur = null;
                    }
                }

                // Ignore changes if the value is the same
                if (obj.options.data[y][x] === value) {
                    // cell.innerHTML = obj.edition[1]; //Thanh
                    if (obj.edition) cell.innerHTML = obj.edition[1];
                } else {
                    obj.setValue(cell, value);
                }
            } else {
                if (obj.options.columns[x].editor) {
                    // Custom editor
                    obj.options.columns[x].editor.closeEditor(cell, save);
                } else {
                    if (obj.options.columns[x].type == 'dropdown' || obj.options.columns[x].type == 'autocomplete') {
                        cell.children[0].dropdown.close(true);
                    } else if (obj.options.columns[x].type == 'calendar') {
                        cell.children[0].calendar.close(true);
                    } else if (obj.options.columns[x].type == 'color') {
                        cell.children[0].color.close(true);
                    } else {
                        cell.children[0].onblur = null;
                    }
                }

                // Restore value
                cell.innerHTML = obj.edition && obj.edition[1] ? obj.edition[1] : '';
            }

            // On edition end
            obj.dispatch('oneditionend', el, cell, x, y, value, save);

            // Remove editor class
            cell.classList.remove('editor');

            // Finish edition
            obj.edition = null;
        }

        /**
         * Get the cell object
         *
         * @param object cell
         * @return string value
         */
        obj.getCell = function (cell) {
            // Convert in case name is excel liked ex. A10, BB92
            cell = jexcel.getIdFromColumnName(cell, true);
            var x = cell[0];
            var y = cell[1];

            return obj.records[y][x];
        }

        /**
         * Get the cell object from coords
         *
         * @param object cell
         * @return string value
         */
        obj.getCellFromCoords = function (x, y) {
            return obj.records[y][x];
        }

        /**
         * Get label
         *
         * @param object cell
         * @return string value
         */
        obj.getLabel = function (cell) {
            // Convert in case name is excel liked ex. A10, BB92
            cell = jexcel.getIdFromColumnName(cell, true);
            var x = cell[0];
            var y = cell[1];

            return obj.records[y][x].innerHTML;
        }

        /**
         * Get labelfrom coords
         *
         * @param object cell
         * @return string value
         */
        obj.getLabelFromCoords = function (x, y) {
            return obj.records[y][x].innerHTML;
        }

        /**
         * Get the value from a cell
         *
         * @param object cell
         * @return string value
         */
        obj.getValue = function (cell, processedValue) {
            if (typeof (cell) == 'object') {
                var x = cell.getAttribute('data-x');
                var y = cell.getAttribute('data-y');
            } else {
                cell = jexcel.getIdFromColumnName(cell, true);
                var x = cell[0];
                var y = cell[1];
            }

            var value = null;

            if (x != null && y != null) {
                if (obj.records[y] && obj.records[y][x] && (processedValue || obj.options.copyCompatibility == true)) {
                    value = obj.records[y][x].innerHTML;
                } else {
                    if (obj.options.data[y] && obj.options.data[y][x] != 'undefined') {
                        value = obj.options.data[y][x];
                    }
                }
            }

            return value;
        }

        /**
         * Get the value from a coords
         *
         * @param int x
         * @param int y
         * @return string value
         */
        obj.getValueFromCoords = function (x, y, processedValue) {

            var value = null;

            if (x != null && y != null) {
                if ((obj.records[y] && obj.records[y][x]) && processedValue || obj.options.copyCompatibility == true) {
                    value = obj.records[y][x].innerHTML;
                } else {
                    if (obj.options.data[y] && obj.options.data[y][x] != 'undefined') {
                        value = obj.options.data[y][x];
                    }
                }
            }

            return value;
        }

        /**
         * Set a cell value
         *
         * @param mixed cell destination cell
         * @param string value value
         * @return void
         */
        obj.setValue = function (cell, value, force) {
            var records = [];
            if (typeof (cell) == 'string') {
                var columnId = jexcel.getIdFromColumnName(cell, true);
                var x = columnId[0];
                var y = columnId[1];
                // Update cell
                records.push(obj.updateCell(x, y, value, force));
                // Update all formulas in the chain
                obj.updateFormulaChain(x, y, records);
            } else {
                var x = null;
                var y = null;
                if (cell && cell.getAttribute) {
                    var x = cell.getAttribute('data-x');
                    var y = cell.getAttribute('data-y');
                }

                // Update cell
                if (x != null && y != null) {
                    records.push(obj.updateCell(x, y, value, force));

                    // Update all formulas in the chain
                    obj.updateFormulaChain(x, y, records);
                } else {
                    var keys = Object.keys(cell);
                    if (keys.length > 0) {
                        for (var i = 0; i < keys.length; i++) {
                            if (typeof (cell[i]) == 'string') {
                                var columnId = jexcel.getIdFromColumnName(cell[i], true);
                                var x = columnId[0];
                                var y = columnId[1];
                            } else {
                                if (cell[i].x != null && cell[i].y != null) {
                                    var x = cell[i].x;
                                    var y = cell[i].y;
                                    // Flexible setup
                                    if (cell[i].newValue != null) {
                                        value = cell[i].newValue;
                                    } else if (cell[i].value != null) {
                                        value = cell[i].value;
                                    }
                                } else {
                                    var x = cell[i].getAttribute('data-x');
                                    var y = cell[i].getAttribute('data-y');
                                }
                            }

                            // Update cell
                            if (x != null && y != null) {
                                records.push(obj.updateCell(x, y, value, force));

                                // Update all formulas in the chain
                                obj.updateFormulaChain(x, y, records);
                            }
                        }
                    }
                }
            }

            // Update history
            obj.setHistory({
                action: 'setValue',
                records: records,
                selection: obj.selectedCell,
            });

            // Update table with custom configurations if applicable
            obj.updateTable();

            // On after changes
            obj.onafterchanges(el, records);
        }

        /**
         * Set a cell value based on coordinates
         *
         * @param int x destination cell
         * @param int y destination cell
         * @param string value
         * @return void
         */
        obj.setValueFromCoords = function (x, y, value, force) {
            var records = [];
            records.push(obj.updateCell(x, y, value, force));

            // Update all formulas in the chain
            obj.updateFormulaChain(x, y, records);

            // Update history
            obj.setHistory({
                action: 'setValue',
                records: records,
                selection: obj.selectedCell,
            });

            // Update table with custom configurations if applicable
            obj.updateTable();

            // On after changes
            obj.onafterchanges(el, records);
        }

        /**
         * Toogle
         */
        obj.setCheckRadioValue = function () {
            var records = [];
            var keys = Object.keys(obj.highlighted);
            for (var i = 0; i < keys.length; i++) {
                var x = obj.highlighted[i].getAttribute('data-x');
                var y = obj.highlighted[i].getAttribute('data-y');

                if (obj.options.columns[x].type == 'checkbox' || obj.options.columns[x].type == 'radio') {
                    // Update cell
                    records.push(obj.updateCell(x, y, !obj.options.data[y][x]));
                }
            }

            if (records.length) {
                // Update history
                obj.setHistory({
                    action: 'setValue',
                    records: records,
                    selection: obj.selectedCell,
                });

                // On after changes
                obj.onafterchanges(el, records);
            }
        }
        /**
         * Strip tags
         */
        var stripScript = function (a) {
            var b = new Option;
            b.innerHTML = a;
            var c = null;
            for (a = b.getElementsByTagName('script'); c = a[0];) c.parentNode.removeChild(c);
            return b.innerHTML;
        }

        /**
         * Update cell content
         *
         * @param object cell
         * @return void
         */
        obj.updateCell = function (x, y, value, force) {
            // Changing value depending on the column type
            if (obj.records[y][x].classList.contains('readonly') == true && !force) {
                // Do nothing
                var record = {
                    x: x,
                    y: y,
                    col: x,
                    row: y
                }
            } else {
                // Security
                if (('' + value).substr(0, 1) == '=' && obj.options.secureFormulas == true) {
                    var val = secureFormula(value);
                    if (val != value) {
                        // Update the data container
                        value = val;
                    }
                }

                // On change
                var val = obj.dispatch('onbeforechange', el, obj.records[y][x], x, y, value);

                // If you return something this will overwrite the value
                if (val != undefined) {
                    value = val;
                }

                if (obj.options.columns[x].editor && typeof (obj.options.columns[x].editor.updateCell) == 'function') {
                    value = obj.options.columns[x].editor.updateCell(obj.records[y][x], value, force, obj, x);
                }

                // History format
                var record = {
                    x: x,
                    y: y,
                    col: x,
                    row: y,
                    newValue: value,
                    oldValue: obj.options.data[y][x],
                }

                if (obj.options.columns[x].editor) {
                    // Update data and cell
                    obj.options.data[y][x] = value;
                } else {
                    // Native functions
                    if (obj.options.columns[x].type == 'checkbox' || obj.options.columns[x].type == 'radio') {
                        // Unchecked all options
                        if (obj.options.columns[x].type == 'radio') {
                            for (var j = 0; j < obj.options.data.length; j++) {
                                obj.options.data[j][x] = false;
                            }
                        }

                        // Update data and cell
                        obj.records[y][x].children[0].checked = (value == 1 || value == true || value == 'true' || value == 'TRUE') ? true : false;
                        obj.options.data[y][x] = obj.records[y][x].children[0].checked;
                    } else if (obj.options.columns[x].type == 'dropdown' || obj.options.columns[x].type == 'autocomplete') {
                        // Update data and cell
                        if (obj.options.columns[x].allowEmpty || value) {
                            obj.options.data[y][x] = value;
                            obj.records[y][x].innerText = obj.getDropDownValue(x, value, y, obj.records[y][x]);
                        } else {
                            obj.records[y][x].innerText = obj.getDropDownValue(x, obj.options.data[y][x], y, obj.records[y][x]);
                        }

                    } else if (obj.options.columns[x].type == 'calendar') {
                        // Update calendar
                        var formatted = jSuites.calendar.extractDateFromString(value, obj.options.columns[x].options.format);
                        // Update data and cell
                        obj.options.data[y][x] = value;
                        obj.records[y][x].innerText = jSuites.calendar.getDateString(formatted ? formatted : value, obj.options.columns[x].options.format);
                    } else if (obj.options.columns[x].type == 'color') {
                        // Update color
                        obj.options.data[y][x] = value;
                        // Render
                        if (obj.options.columns[x].render == 'square') {
                            var color = document.createElement('div');
                            color.className = 'color';
                            color.style.backgroundColor = value;
                            obj.records[y][x].innerText = '';
                            obj.records[y][x].appendChild(color);
                        } else {
                            obj.records[y][x].style.color = value;
                            obj.records[y][x].innerText = value;
                        }
                    } else if (obj.options.columns[x].type == 'image') {
                        value = '' + value;
                        obj.options.data[y][x] = value;
                        obj.records[y][x].innerHTML = '';
                        if (value && value.substr(0, 10) == 'data:image') {
                            var img = document.createElement('img');
                            img.src = value;
                            obj.records[y][x].appendChild(img);
                        }
                    } else {
                        // Update data and cell
                        obj.options.data[y][x] = value;
                        // Label
                        if (obj.options.columns[x].type == 'html') {
                            obj.records[y][x].innerHTML = stripScript(obj.parseValue(x, y, value));
                        } else {
                            if (obj.options.stripHTML === false || obj.options.columns[x].stripHTML === false) {
                                obj.records[y][x].innerHTML = stripScript(obj.parseValue(x, y, value));
                            } else {
                                obj.records[y][x].innerText = obj.parseValue(x, y, value);
                            }
                        }
                        // Handle big text inside a cell
                        if (obj.options.columns[x].wordWrap != false && (obj.options.wordWrap == true || obj.options.columns[x].wordWrap == true || obj.records[y][x].innerHTML.length > 200)) {
                            obj.records[y][x].style.whiteSpace = 'pre-wrap';
                        } else {
                            obj.records[y][x].style.whiteSpace = '';
                        }
                    }
                }

                // Overflow
                if (x > 0) {
                    if (value) {
                        obj.records[y][x - 1].style.overflow = 'hidden';
                    } else {
                        obj.records[y][x - 1].style.overflow = '';
                    }
                }

                // On change
                obj.dispatch('onchange', el, (obj.records[y] && obj.records[y][x] ? obj.records[y][x] : null), x, y, value, record.oldValue);
            }

            return record;
        }

        /**
         * Helper function to copy data using the corner icon
         */
        obj.copyData = function (o, d) {
            // Get data from all selected cells
            var data = obj.getData(true, true);
            // Selected cells
            var h = obj.selectedContainer;
            // Cells
            var x1 = parseInt(o.getAttribute('data-x'));
            var y1 = parseInt(o.getAttribute('data-y'));
            var x2 = parseInt(d.getAttribute('data-x'));
            var y2 = parseInt(d.getAttribute('data-y'));

            if (obj.options.allowXCopy !== true) if (x1 !== h[0]) return;

            // Records
            var records = [];
            var breakControl = false;

            if (h[0] == x1) {
                // Vertical copy
                if (y1 < h[1]) {
                    var rowNumber = y1 - h[1];
                } else {
                    var rowNumber = 1;
                }
                var colNumber = 0;
            } else {
                if (x1 < h[0]) {
                    var colNumber = x1 - h[0];
                } else {
                    var colNumber = 1;
                }
                var rowNumber = 0;
            }

            // Copy data procedure
            var posx = 0;
            var posy = 0;

            for (var j = y1; j <= y2; j++) {
                // Skip hidden rows
                if (obj.rows[j] && obj.rows[j].style.display == 'none') {
                    continue;
                }

                // Controls
                if (data[posy] == undefined) {
                    posy = 0;
                }
                posx = 0;

                // Data columns
                if (h[0] != x1) {
                    if (x1 < h[0]) {
                        var colNumber = x1 - h[0];
                    } else {
                        var colNumber = 1;
                    }
                }
                // Data columns
                for (var i = x1; i <= x2; i++) {
                    // Update non-readonly
                    if (obj.records[j][i] && !obj.records[j][i].classList.contains('readonly') && obj.records[j][i].style.display != 'none' && breakControl == false) {
                        // Stop if contains value
                        if (!obj.selection.length) {
                            if (obj.options.data[j][i] != '') {
                                breakControl = true;
                                continue;
                            }
                        }

                        // Column
                        if (data[posy] == undefined) {
                            posx = 0;
                        } else if (data[posy][posx] == undefined) {
                            posx = 0;
                        }

                        // Value
                        var value = data[posy][posx];


                        if (value && !data[1] && obj.options.autoIncrement == true) {
                            if (obj.options.columns[i].type == 'text' || obj.options.columns[i].type == 'number') {
                                if (('' + value).substr(0, 1) == '=') {
                                    var tokens = value.match(/([A-Z]+[0-9]+)/g);

                                    if (tokens) {
                                        var affectedTokens = [];
                                        for (var index = 0; index < tokens.length; index++) {
                                            var position = jexcel.getIdFromColumnName(tokens[index], 1);
                                            position[0] += colNumber;
                                            position[1] += rowNumber;
                                            if (position[1] < 0) {
                                                position[1] = 0;
                                            }
                                            var token = jexcel.getColumnNameFromId([position[0], position[1]]);

                                            if (token != tokens[index]) {
                                                affectedTokens[tokens[index]] = token;
                                            }
                                        }
                                        // Update formula
                                        if (affectedTokens) {
                                            value = obj.updateFormula(value, affectedTokens)
                                        }
                                    }
                                } else {
                                    if (value == Number(value)) {
                                        value = Number(value) + rowNumber;
                                    }
                                }
                            } else if (obj.options.columns[i].type == 'calendar') {
                                var date = new Date(value);
                                date.setDate(date.getDate() + rowNumber);
                                value = date.getFullYear() + '-' + jexcel.doubleDigitFormat(parseInt(date.getMonth() + 1)) + '-' + jexcel.doubleDigitFormat(date.getDate()) + ' ' + '00:00:00';
                            }
                        }

                        records.push(obj.updateCell(i, j, value));

                        // Update all formulas in the chain
                        obj.updateFormulaChain(i, j, records);
                    }
                    posx++;
                    if (h[0] != x1) {
                        colNumber++;
                    }
                }
                posy++;
                rowNumber++;
            }

            // Update history
            obj.setHistory({
                action: 'setValue',
                records: records,
                selection: obj.selectedCell,
            });

            // Update table with custom configuration if applicable
            obj.updateTable();

            // On after changes
            obj.onafterchanges(el, records);
        }

        /**
         * Refresh current selection
         */
        obj.refreshSelection = function () {
            if (obj.selectedCell) {
                obj.updateSelectionFromCoords(obj.selectedCell[0], obj.selectedCell[1], obj.selectedCell[2], obj.selectedCell[3]);
            }
        }

        /**
         * Move coords to A1 in case ovelaps with an excluded cell
         */
        obj.conditionalSelectionUpdate = function (type, o, d) {
            if (type == 1) {
                if (obj.selectedCell && ((o >= obj.selectedCell[1] && o <= obj.selectedCell[3]) || (d >= obj.selectedCell[1] && d <= obj.selectedCell[3]))) {
                    obj.resetSelection();
                    return;
                }
            } else {
                if (obj.selectedCell && ((o >= obj.selectedCell[0] && o <= obj.selectedCell[2]) || (d >= obj.selectedCell[0] && d <= obj.selectedCell[2]))) {
                    obj.resetSelection();
                    return;
                }
            }
        }

        /**
         * Clear table selection
         */
        obj.resetSelection = function (blur) {
            // Remove style
            if (!obj.highlighted.length) {
                var previousStatus = 0;
            } else {
                var previousStatus = 1;

                for (var i = 0; i < obj.highlighted.length; i++) {
                    obj.highlighted[i].classList.remove('highlight');
                    obj.highlighted[i].classList.remove('highlight-left');
                    obj.highlighted[i].classList.remove('highlight-right');
                    obj.highlighted[i].classList.remove('highlight-top');
                    obj.highlighted[i].classList.remove('highlight-bottom');
                    obj.highlighted[i].classList.remove('highlight-selected');

                    var px = parseInt(obj.highlighted[i].getAttribute('data-x'));
                    var py = parseInt(obj.highlighted[i].getAttribute('data-y'));

                    // Check for merged cells
                    if (obj.highlighted[i].getAttribute('data-merged')) {
                        var colspan = parseInt(obj.highlighted[i].getAttribute('colspan'));
                        var rowspan = parseInt(obj.highlighted[i].getAttribute('rowspan'));
                        var ux = colspan > 0 ? px + (colspan - 1) : px;
                        var uy = rowspan > 0 ? py + (rowspan - 1) : py;
                    } else {
                        var ux = px;
                        var uy = py;
                    }

                    // Remove selected from headers
                    for (var j = px; j <= ux; j++) {
                        if (obj.headers[j]) {
                            obj.headers[j].classList.remove('selected');
                        }
                    }

                    // Remove selected from rows
                    for (var j = py; j <= uy; j++) {
                        if (obj.rows[j]) {
                            obj.rows[j].classList.remove('selected');
                        }
                    }
                }
            }

            if (blur == true && previousStatus == 1) {
                obj.dispatch('onblur', el);
            }

            // Reset highlighed cells
            obj.highlighted = [];

            // Reset
            obj.selectedCell = null;

            // Hide corner
            obj.corner.style.top = '-2000px';
            obj.corner.style.left = '-2000px';


            return previousStatus;
        }

        /**
         * Update selection based on two cells
         */
        obj.updateSelection = function (el1, el2, origin) {
            var x1 = el1.getAttribute('data-x');
            var y1 = el1.getAttribute('data-y');
            if (el2) {
                var x2 = el2.getAttribute('data-x');
                var y2 = el2.getAttribute('data-y');
            } else {
                var x2 = x1;
                var y2 = y1;
            }

            obj.updateSelectionFromCoords(x1, y1, x2, y2, origin);
        }

        /**
         * Update selection from coords
         */
        obj.updateSelectionFromCoords = function (x1, y1, x2, y2, origin) {

            // Reset Selection
            var updated = null;
            var previousState = obj.resetSelection(true);

            // Same element
            if (x2 == null) {
                x2 = x1;
            }
            if (y2 == null) {
                y2 = y1;
            }

            // Selection must be within the existing data
            if (x1 >= obj.headers.length) {
                x1 = obj.headers.length - 1;
            }
            if (y1 >= obj.rows.length) {
                y1 = obj.rows.length - 1;
            }
            if (x2 >= obj.headers.length) {
                x2 = obj.headers.length - 1;
            }
            if (y2 >= obj.rows.length) {
                y2 = obj.rows.length - 1;
            }

            // Keep selected cell
            obj.selectedCell = [x1, y1, x2, y2];

            // Select cells
            if (x1 != null) {
                // Add selected cell
                if (obj.records[y1][x1]) {
                    obj.records[y1][x1].classList.add('highlight-selected');
                }

                // Origin & Destination
                if (parseInt(x1) < parseInt(x2)) {
                    var px = parseInt(x1);
                    var ux = parseInt(x2);
                } else {
                    var px = parseInt(x2);
                    var ux = parseInt(x1);
                }

                if (parseInt(y1) < parseInt(y2)) {
                    var py = parseInt(y1);
                    var uy = parseInt(y2);
                } else {
                    var py = parseInt(y2);
                    var uy = parseInt(y1);
                }

                // Verify merged columns
                for (var i = px; i <= ux; i++) {
                    for (var j = py; j <= uy; j++) {
                        if (obj.records[j][i] && obj.records[j][i].getAttribute('data-merged')) {
                            var x = parseInt(obj.records[j][i].getAttribute('data-x'));
                            var y = parseInt(obj.records[j][i].getAttribute('data-y'));
                            var colspan = parseInt(obj.records[j][i].getAttribute('colspan'));
                            var rowspan = parseInt(obj.records[j][i].getAttribute('rowspan'));

                            if (colspan > 1) {
                                if (x < px) {
                                    px = x;
                                }
                                if (x + colspan > ux) {
                                    ux = x + colspan - 1;
                                }
                            }

                            if (rowspan) {
                                if (y < py) {
                                    py = y;

                                }
                                if (y + rowspan > uy) {
                                    uy = y + rowspan - 1;
                                }
                            }
                        }
                    }
                }

                // Limits
                var borderLeft = null;
                var borderRight = null;
                var borderTop = null;
                var borderBottom = null;

                // Vertical limits
                for (var j = py; j <= uy; j++) {
                    if (obj.rows[j].style.display != 'none') {
                        if (borderTop == null) {
                            borderTop = j;
                        }
                        borderBottom = j;
                    }
                }

                // Redefining styles
                for (var i = px; i <= ux; i++) {
                    for (var j = py; j <= uy; j++) {
                        if (obj.rows[j].style.display != 'none' && obj.records[j][i].style.display != 'none') {
                            obj.records[j][i].classList.add('highlight');
                            obj.highlighted.push(obj.records[j][i]);
                        }
                    }

                    // Horizontal limits
                    if (obj.options.columns[i].type != 'hidden') {
                        if (borderLeft == null) {
                            borderLeft = i;
                        }
                        borderRight = i;
                    }
                }

                // Create borders
                if (!borderLeft) {
                    borderLeft = 0;
                }
                if (!borderRight) {
                    borderRight = 0;
                }
                for (var i = borderLeft; i <= borderRight; i++) {
                    if (obj.options.columns[i].type != 'hidden') {
                        // Top border
                        if (obj.records[borderTop] && obj.records[borderTop][i]) {
                            obj.records[borderTop][i].classList.add('highlight-top');
                        }
                        // Bottom border
                        if (obj.records[borderBottom] && obj.records[borderBottom][i]) {
                            obj.records[borderBottom][i].classList.add('highlight-bottom');
                        }
                        // Add selected from headers
                        obj.headers[i].classList.add('selected');
                    }
                }

                for (var j = borderTop; j <= borderBottom; j++) {
                    if (obj.rows[j] && obj.rows[j].style.display != 'none') {
                        // Left border
                        obj.records[j][borderLeft].classList.add('highlight-left');
                        // Right border
                        obj.records[j][borderRight].classList.add('highlight-right');
                        // Add selected from rows
                        obj.rows[j].classList.add('selected');
                    }
                }

                obj.selectedContainer = [borderLeft, borderTop, borderRight, borderBottom];
            }

            // Handle events
            if (previousState == 0) {
                obj.dispatch('onfocus', el);

                obj.removeCopyingSelection();
            }

            obj.dispatch('onselection', el, borderLeft, borderTop, borderRight, borderBottom, origin);

            // Find corner cell
            obj.updateCornerPosition();
        }

        /**
         * Remove copy selection
         *
         * @return void
         */
        obj.removeCopySelection = function () {
            // Remove current selection
            for (var i = 0; i < obj.selection.length; i++) {
                obj.selection[i].classList.remove('selection');
                obj.selection[i].classList.remove('selection-left');
                obj.selection[i].classList.remove('selection-right');
                obj.selection[i].classList.remove('selection-top');
                obj.selection[i].classList.remove('selection-bottom');
            }

            obj.selection = [];
        }

        /**
         * Update copy selection
         *
         * @param int x, y
         * @return void
         */
        obj.updateCopySelection = function (x3, y3) {
            // Remove selection
            obj.removeCopySelection();

            // Get elements first and last
            var x1 = obj.selectedContainer[0];
            var y1 = obj.selectedContainer[1];
            var x2 = obj.selectedContainer[2];
            var y2 = obj.selectedContainer[3];

            if (x3 != null && y3 != null) {
                if (x3 - x2 > 0) {
                    var px = parseInt(x2) + 1;
                    var ux = parseInt(x3);
                } else {
                    var px = parseInt(x3);
                    var ux = parseInt(x1) - 1;
                }

                if (y3 - y2 > 0) {
                    var py = parseInt(y2) + 1;
                    var uy = parseInt(y3);
                } else {
                    var py = parseInt(y3);
                    var uy = parseInt(y1) - 1;
                }

                if (ux - px <= uy - py) {
                    var px = parseInt(x1);
                    var ux = parseInt(x2);
                } else {
                    var py = parseInt(y1);
                    var uy = parseInt(y2);
                }

                for (var j = py; j <= uy; j++) {
                    for (var i = px; i <= ux; i++) {
                        if (obj.records[j][i] && obj.rows[j].style.display != 'none' && obj.records[j][i].style.display != 'none') {
                            obj.records[j][i].classList.add('selection');
                            obj.records[py][i].classList.add('selection-top');
                            obj.records[uy][i].classList.add('selection-bottom');
                            obj.records[j][px].classList.add('selection-left');
                            obj.records[j][ux].classList.add('selection-right');

                            // Persist selected elements
                            obj.selection.push(obj.records[j][i]);
                        }
                    }
                }
            }
        }

        /**
         * Update corner position
         *
         * @return void
         */
        obj.updateCornerPosition = function () {
            // If any selected cells
            if (!obj.highlighted.length) {
                obj.corner.style.top = '-2000px';
                obj.corner.style.left = '-2000px';
            } else {
                // Get last cell
                var last = obj.highlighted[obj.highlighted.length - 1];

                var contentRect = obj.content.getBoundingClientRect();
                var x1 = contentRect.left;
                var y1 = contentRect.top;

                var lastRect = last.getBoundingClientRect();
                var x2 = lastRect.left;
                var y2 = lastRect.top;
                var w2 = lastRect.width;
                var h2 = lastRect.height;

                var x = (x2 - x1) + obj.content.scrollLeft + w2 - 4;
                var y = (y2 - y1) + obj.content.scrollTop + h2 - 4;

                // Place the corner in the correct place
                obj.corner.style.top = y + 'px';
                obj.corner.style.left = x + 'px';

                if (obj.options.freezeColumns) {
                    var width = obj.getFreezeWidth();
                    if (x2 - x1 + w2 < width) {
                        obj.corner.style.display = 'none';
                    } else {
                        if (obj.options.selectionCopy == true) {
                            obj.corner.style.display = '';
                        }
                    }
                } else {
                    if (obj.options.selectionCopy == true) {
                        obj.corner.style.display = '';
                    }
                }
            }
        }

        /**
         * Update scroll position based on the selection
         */
        obj.updateScroll = function (direction) {
            // jExcel Container information
            var contentRect = obj.content.getBoundingClientRect();
            var x1 = contentRect.left;
            var y1 = contentRect.top;
            var w1 = contentRect.width;
            var h1 = contentRect.height;

            // Direction Left or Up
            var reference = obj.records[obj.selectedCell[3]][obj.selectedCell[2]];

            // Reference
            var referenceRect = reference.getBoundingClientRect();
            var x2 = referenceRect.left;
            var y2 = referenceRect.top;
            var w2 = referenceRect.width;
            var h2 = referenceRect.height;

            // Direction
            if (direction == 0 || direction == 1) {
                var x = (x2 - x1) + obj.content.scrollLeft;
                var y = (y2 - y1) + obj.content.scrollTop - 2;
            } else {
                var x = (x2 - x1) + obj.content.scrollLeft + w2;
                var y = (y2 - y1) + obj.content.scrollTop + h2;
            }

            // Top position check
            if (y > (obj.content.scrollTop + 30) && y < (obj.content.scrollTop + h1)) {
                // In the viewport
            } else {
                // Out of viewport
                if (y < obj.content.scrollTop + 30) {
                    obj.content.scrollTop = y - h2;
                } else {
                    obj.content.scrollTop = y - (h1 - 2);
                }
            }

            // Freeze columns?
            var freezed = obj.getFreezeWidth();

            // Left position check - TODO: change that to the bottom border of the element
            if (x > (obj.content.scrollLeft + freezed) && x < (obj.content.scrollLeft + w1)) {
                // In the viewport
            } else {
                // Out of viewport
                if (x < obj.content.scrollLeft + 30) {
                    obj.content.scrollLeft = x;
                    if (obj.content.scrollLeft < 50) {
                        obj.content.scrollLeft = 0;
                    }
                } else if (x < obj.content.scrollLeft + freezed) {
                    obj.content.scrollLeft = x - freezed - 1;
                } else {
                    obj.content.scrollLeft = x - (w1 - 20);
                }
            }
        }

        /**
         * Get the column width
         *
         * @param int column column number (first column is: 0)
         * @return int current width
         */
        obj.getWidth = function (column) {
            if (!column) {
                // Get all headers
                var data = [];
                for (var i = 0; i < obj.headers.length; i++) {
                    data.push(obj.options.columns[i].width);
                }
            } else {
                // In case the column is an object
                if (typeof (column) == 'object') {
                    column = $(column).getAttribute('data-x');
                }

                data = obj.colgroup[column].getAttribute('width')
            }

            return data;
        }


        /**
         * Set the column width
         *
         * @param int column number (first column is: 0)
         * @param int new column width
         * @param int old column width
         */
        obj.setWidth = function (column, width, oldWidth) {
            if (width) {
                if (Array.isArray(column)) {
                    // Oldwidth
                    if (!oldWidth) {
                        var oldWidth = [];
                    }
                    // Set width
                    for (var i = 0; i < column.length; i++) {
                        if (!oldWidth[i]) {
                            oldWidth[i] = obj.colgroup[column[i]].getAttribute('width');
                        }
                        var w = Array.isArray(width) && width[i] ? width[i] : width;
                        obj.colgroup[column[i]].setAttribute('width', w);
                        obj.options.columns[column[i]].width = w;
                    }
                } else {
                    // Oldwidth
                    if (!oldWidth) {
                        oldWidth = obj.colgroup[column].getAttribute('width');
                    }
                    // Set width
                    obj.colgroup[column].setAttribute('width', width);
                    obj.options.columns[column].width = width;
                }

                // Keeping history of changes
                obj.setHistory({
                    action: 'setWidth',
                    column: column,
                    oldValue: oldWidth,
                    newValue: width,
                });

                // On resize column
                obj.dispatch('onresizecolumn', el, column, width, oldWidth);

                // Update corner position
                obj.updateCornerPosition();
            }
        }

        /**
         * Set the row height
         *
         * @param row - row number (first row is: 0)
         * @param height - new row height
         * @param oldHeight - old row height
         */
        obj.setHeight = function (row, height, oldHeight) {
            if (height > 0) {
                // In case the column is an object
                if (typeof (row) == 'object') {
                    row = row.getAttribute('data-y');
                }

                // Oldwidth
                if (!oldHeight) {
                    oldHeight = obj.rows[row].getAttribute('height');

                    if (!oldHeight) {
                        var rect = obj.rows[row].getBoundingClientRect();
                        oldHeight = rect.height;
                    }
                }

                // Integer
                height = parseInt(height);

                // Set width
                obj.rows[row].style.height = height + 'px';

                // Keep options updated
                if (!obj.options.rows[row]) {
                    obj.options.rows[row] = {};
                }
                obj.options.rows[row].height = height;

                // Keeping history of changes
                obj.setHistory({
                    action: 'setHeight',
                    row: row,
                    oldValue: oldHeight,
                    newValue: height,
                });

                // On resize column
                obj.dispatch('onresizerow', el, row, height, oldHeight);

                // Update corner position
                obj.updateCornerPosition();
            }
        }

        /**
         * Get the row height
         *
         * @param row - row number (first row is: 0)
         * @return height - current row height
         */
        obj.getHeight = function (row) {
            if (!row) {
                // Get height of all rows
                var data = [];
                for (var j = 0; j < obj.rows.length; j++) {
                    var h = obj.rows[j].style.height;
                    if (h) {
                        data[j] = h;
                    }
                }
            } else {
                // In case the row is an object
                if (typeof (row) == 'object') {
                    row = $(row).getAttribute('data-y');
                }

                var data = obj.rows[row].style.height;
            }

            return data;
        }

        obj.setFooter = function (data) {
            if (data) {
                obj.options.footers = data;
            }

            if (obj.options.footers) {
                if (!obj.tfoot) {
                    obj.tfoot = document.createElement('tfoot');
                    obj.table.appendChild(obj.tfoot);
                }

                for (var j = 0; j < obj.options.footers.length; j++) {
                    if (obj.tfoot.children[j]) {
                        var tr = obj.tfoot.children[j];
                    } else {
                        var tr = document.createElement('tr');
                        var td = document.createElement('td');
                        tr.appendChild(td);
                        obj.tfoot.appendChild(tr);
                    }
                    for (var i = 0; i < obj.headers.length; i++) {
                        if (!obj.options.footers[j][i]) {
                            obj.options.footers[j][i] = '';
                        }
                        if (obj.tfoot.children[j].children[i + 1]) {
                            var td = obj.tfoot.children[j].children[i + 1];
                        } else {
                            var td = document.createElement('td');
                            tr.appendChild(td);

                            // Text align
                            var colAlign = obj.options.columns[i].align ? obj.options.columns[i].align : 'center';
                            td.style.textAlign = colAlign;
                        }
                        td.innerText = obj.parseValue(i, j, obj.options.footers[j][i]);
                    }
                }
            }
        }

        /**
         * Get the column title
         *
         * @param column - column number (first column is: 0)
         * @param title - new column title
         */
        obj.getHeader = function (column) {
            return obj.headers[column].innerText;
        }

        /**
         * Set the column title
         *
         * @param column - column number (first column is: 0)
         * @param title - new column title
         */
        obj.setHeader = function (column, newValue) {
            if (obj.headers[column]) {
                var oldValue = obj.headers[column].innerText;

                if (!newValue) {
                    newValue = prompt(obj.options.text.columnName, oldValue)
                }

                if (newValue) {
                    obj.headers[column].innerText = newValue;
                    // Keep the title property
                    obj.headers[column].setAttribute('title', newValue);
                    // Update title
                    obj.options.columns[column].title = newValue;
                }

                obj.setHistory({
                    action: 'setHeader',
                    column: column,
                    oldValue: oldValue,
                    newValue: newValue
                });

                // On onchange header
                obj.dispatch('onchangeheader', el, column, oldValue, newValue);
            }
        }

        /**
         * Get the headers
         *
         * @param asArray
         * @return mixed
         */
        obj.getHeaders = function (asArray) {
            var title = [];

            for (var i = 0; i < obj.headers.length; i++) {
                title.push(obj.getHeader(i));
            }

            return asArray ? title : title.join(obj.options.csvDelimiter);
        }

        /**
         * Get meta information from cell(s)
         *
         * @return integer
         */
        obj.getMeta = function (cell, key) {
            if (!cell) {
                return obj.options.meta;
            } else {
                if (key) {
                    return obj.options.meta[cell] && obj.options.meta[cell][key] ? obj.options.meta[cell][key] : null;
                } else {
                    return obj.options.meta[cell] ? obj.options.meta[cell] : null;
                }
            }
        }

        /**
         * Set meta information to cell(s)
         *
         * @return integer
         */
        obj.setMeta = function (o, k, v) {
            if (!obj.options.meta) {
                obj.options.meta = {}
            }

            if (k && v) {
                // Set data value
                if (!obj.options.meta[o]) {
                    obj.options.meta[o] = {};
                }
                obj.options.meta[o][k] = v;
            } else {
                // Apply that for all cells
                var keys = Object.keys(o);
                for (var i = 0; i < keys.length; i++) {
                    if (!obj.options.meta[keys[i]]) {
                        obj.options.meta[keys[i]] = {};
                    }

                    var prop = Object.keys(o[keys[i]]);
                    for (var j = 0; j < prop.length; j++) {
                        obj.options.meta[keys[i]][prop[j]] = o[keys[i]][prop[j]];
                    }
                }
            }

            obj.dispatch('onchangemeta', el, o, k, v);
        }

        /**
         * Update meta information
         *
         * @return integer
         */
        obj.updateMeta = function (affectedCells) {
            if (obj.options.meta) {
                var newMeta = {};
                var keys = Object.keys(obj.options.meta);
                for (var i = 0; i < keys.length; i++) {
                    if (affectedCells[keys[i]]) {
                        newMeta[affectedCells[keys[i]]] = obj.options.meta[keys[i]];
                    } else {
                        newMeta[keys[i]] = obj.options.meta[keys[i]];
                    }
                }
                // Update meta information
                obj.options.meta = newMeta;
            }
        }

        /**
         * Get style information from cell(s)
         *
         * @return integer
         */
        obj.getStyle = function (cell, key) {
            // Cell
            if (!cell) {
                // Control vars
                var data = {};

                // Column and row length
                var x = obj.options.data[0].length;
                var y = obj.options.data.length;

                // Go through the columns to get the data
                for (var j = 0; j < y; j++) {
                    for (var i = 0; i < x; i++) {
                        // Value
                        var v = key ? obj.records[j][i].style[key] : obj.records[j][i].getAttribute('style');

                        // Any meta data for this column?
                        if (v) {
                            // Column name
                            var k = jexcel.getColumnNameFromId([i, j]);
                            // Value
                            data[k] = v;
                        }
                    }
                }

                return data;
            } else {
                cell = jexcel.getIdFromColumnName(cell, true);

                return key ? obj.records[cell[1]][cell[0]].style[key] : obj.records[cell[1]][cell[0]].getAttribute('style');
            }
        },

            obj.resetStyle = function (o, ignoreHistoryAndEvents) {
                var keys = Object.keys(o);
                for (var i = 0; i < keys.length; i++) {
                    // Position
                    var cell = jexcel.getIdFromColumnName(keys[i], true);
                    if (obj.records[cell[1]] && obj.records[cell[1]][cell[0]]) {
                        obj.records[cell[1]][cell[0]].setAttribute('style', '');
                    }
                }
                obj.setStyle(o, null, null, null, ignoreHistoryAndEvents);
            }

        /**
         * Set meta information to cell(s)
         *
         * @return integer
         */
        obj.setStyle = function (o, k, v, force, ignoreHistoryAndEvents) {
            var newValue = {};
            var oldValue = {};

            // Apply style
            var applyStyle = function (cellId, key, value) {
                // Position
                var cell = jexcel.getIdFromColumnName(cellId, true);

                if (obj.records[cell[1]] && obj.records[cell[1]][cell[0]] && (obj.records[cell[1]][cell[0]].classList.contains('readonly') == false || force)) {
                    // Current value
                    var currentValue = obj.records[cell[1]][cell[0]].style[key];

                    // Change layout
                    if (currentValue == value && !force) {
                        value = '';
                        obj.records[cell[1]][cell[0]].style[key] = '';
                    } else {
                        obj.records[cell[1]][cell[0]].style[key] = value;
                    }

                    // History
                    if (!oldValue[cellId]) {
                        oldValue[cellId] = [];
                    }
                    if (!newValue[cellId]) {
                        newValue[cellId] = [];
                    }

                    oldValue[cellId].push([key + ':' + currentValue]);
                    newValue[cellId].push([key + ':' + value]);
                }
            }

            if (k && v) {
                // Get object from string
                if (typeof (o) == 'string') {
                    applyStyle(o, k, v);
                } else {
                    // Avoid duplications
                    var oneApplication = [];
                    // Apply that for all cells
                    for (var i = 0; i < o.length; i++) {
                        var x = o[i].getAttribute('data-x');
                        var y = o[i].getAttribute('data-y');
                        var cellName = jexcel.getColumnNameFromId([x, y]);
                        // This happens when is a merged cell
                        if (!oneApplication[cellName]) {
                            applyStyle(cellName, k, v);
                            oneApplication[cellName] = true;
                        }
                    }
                }
            } else {
                var keys = Object.keys(o);
                for (var i = 0; i < keys.length; i++) {
                    var style = o[keys[i]];
                    if (typeof (style) == 'string') {
                        style = style.split(';');
                    }
                    for (var j = 0; j < style.length; j++) {
                        if (typeof (style[j]) == 'string') {
                            style[j] = style[j].split(':');
                        }
                        // Apply value
                        if (style[j][0].trim()) {
                            applyStyle(keys[i], style[j][0].trim(), style[j][1]);
                        }
                    }
                }
            }

            var keys = Object.keys(oldValue);
            for (var i = 0; i < keys.length; i++) {
                oldValue[keys[i]] = oldValue[keys[i]].join(';');
            }
            var keys = Object.keys(newValue);
            for (var i = 0; i < keys.length; i++) {
                newValue[keys[i]] = newValue[keys[i]].join(';');
            }

            if (!ignoreHistoryAndEvents) {
                // Keeping history of changes
                obj.setHistory({
                    action: 'setStyle',
                    oldValue: oldValue,
                    newValue: newValue,
                });
            }

            obj.dispatch('onchangestyle', el, o, k, v);
        }

        /**
         * Get cell comments, null cell for all
         */
        obj.getComments = function (cell, withAuthor) {
            if (cell) {
                if (typeof (cell) == 'string') {
                    var cell = jexcel.getIdFromColumnName(cell, true);
                }

                if (withAuthor) {
                    return [obj.records[cell[1]][cell[0]].getAttribute('title'), obj.records[cell[1]][cell[0]].getAttribute('author')];
                } else {
                    return obj.records[cell[1]][cell[0]].getAttribute('title') || '';
                }
            } else {
                var data = {};
                for (var j = 0; j < obj.options.data.length; j++) {
                    for (var i = 0; i < obj.options.columns.length; i++) {
                        var comments = obj.records[j][i].getAttribute('title');
                        if (comments) {
                            var cell = jexcel.getColumnNameFromId([i, j]);
                            data[cell] = comments;
                        }
                    }
                }
                return data;
            }
        }

        /**
         * Set cell comments
         */
        obj.setComments = function (cellId, comments, author) {
            if (typeof (cellId) == 'string') {
                var cell = jexcel.getIdFromColumnName(cellId, true);
            } else {
                var cell = cellId;
            }

            // Keep old value
            var title = obj.records[cell[1]][cell[0]].getAttribute('title');
            var author = obj.records[cell[1]][cell[0]].getAttribute('data-author');
            var oldValue = [title, author];

            // Set new values
            obj.records[cell[1]][cell[0]].setAttribute('title', comments ? comments : '');
            obj.records[cell[1]][cell[0]].setAttribute('data-author', author ? author : '');

            // Remove class if there is no comment
            if (comments) {
                obj.records[cell[1]][cell[0]].classList.add('jexcel_comments');
            } else {
                obj.records[cell[1]][cell[0]].classList.remove('jexcel_comments');
            }

            // Save history
            obj.setHistory({
                action: 'setComments',
                column: cellId,
                newValue: [comments, author],
                oldValue: oldValue,
            });
            // Set comments
            obj.dispatch('oncomments', el, comments, title);
        }

        /**
         * Get table config information
         */
        obj.getConfig = function () {
            var options = obj.options;
            options.style = obj.getStyle();
            options.mergeCells = obj.getMerge();
            options.comments = obj.getComments();

            return options;
        }

        /**
         * Sort data and reload table
         */
        obj.orderBy = function (column, order) {
            if (column >= 0) {
                // Merged cells
                if (Object.keys(obj.options.mergeCells).length > 0) {
                    if (!confirm(obj.options.text.thisActionWillDestroyAnyExistingMergedCellsAreYouSure)) {
                        return false;
                    } else {
                        // Remove merged cells
                        obj.destroyMerged();
                    }
                }

                // Direction
                if (order == null) {
                    order = obj.headers[column].classList.contains('arrow-down') ? 1 : 0;
                } else {
                    order = order ? 1 : 0;
                }

                // Test order
                var temp = [];
                if (obj.options.columns[column].type == 'number' || obj.options.columns[column].type == 'percentage' || obj.options.columns[column].type == 'autonumber' || obj.options.columns[column].type == 'color') {
                    for (var j = 0; j < obj.options.data.length; j++) {
                        temp[j] = [j, Number(obj.options.data[j][column])];
                    }
                } else if (obj.options.columns[column].type == 'calendar' || obj.options.columns[column].type == 'checkbox' || obj.options.columns[column].type == 'radio') {
                    for (var j = 0; j < obj.options.data.length; j++) {
                        temp[j] = [j, obj.options.data[j][column]];
                    }
                } else {
                    for (var j = 0; j < obj.options.data.length; j++) {
                        temp[j] = [j, obj.records[j][column].innerText.toLowerCase()];
                    }
                }

                // Default sorting method
                if (typeof (obj.options.sorting) !== 'function') {
                    obj.options.sorting = function (direction) {
                        return function (a, b) {
                            var valueA = a[1];
                            var valueB = b[1];

                            if (!direction) {
                                return (valueA === '' && valueB !== '') ? 1 : (valueA !== '' && valueB === '') ? -1 : (valueA > valueB) ? 1 : (valueA < valueB) ? -1 : 0;
                            } else {
                                return (valueA === '' && valueB !== '') ? 1 : (valueA !== '' && valueB === '') ? -1 : (valueA > valueB) ? -1 : (valueA < valueB) ? 1 : 0;
                            }
                        }
                    }
                }

                temp = temp.sort(obj.options.sorting(order));

                // Save history
                var newValue = [];
                for (var j = 0; j < temp.length; j++) {
                    newValue[j] = temp[j][0];
                }

                // Save history
                obj.setHistory({
                    action: 'orderBy',
                    rows: newValue,
                    column: column,
                    order: order,
                });

                // Update order
                obj.updateOrderArrow(column, order);
                obj.updateOrder(newValue);

                // On sort event
                obj.dispatch('onsort', el, column, order);

                return true;
            }
        }

        /**
         * Update order arrow
         */
        obj.updateOrderArrow = function (column, order) {
            // Remove order
            for (var i = 0; i < obj.headers.length; i++) {
                obj.headers[i].classList.remove('arrow-up');
                obj.headers[i].classList.remove('arrow-down');
            }

            // No order specified then toggle order
            if (order) {
                obj.headers[column].classList.add('arrow-up');
            } else {
                obj.headers[column].classList.add('arrow-down');
            }
        }

        /**
         * Update rows position
         */
        obj.updateOrder = function (rows) {
            // History
            var data = []
            for (var j = 0; j < rows.length; j++) {
                data[j] = obj.options.data[rows[j]];
            }
            obj.options.data = data;

            var data = []
            for (var j = 0; j < rows.length; j++) {
                data[j] = obj.records[rows[j]];
            }
            obj.records = data;

            var data = []
            for (var j = 0; j < rows.length; j++) {
                data[j] = obj.rows[rows[j]];
            }
            obj.rows = data;

            // Update references
            obj.updateTableReferences();

            // Redo search
            if (obj.results && obj.results.length) {
                if (obj.searchInput.value) {
                    obj.search(obj.searchInput.value);
                } else {
                    obj.closeFilter();
                }
            } else {
                // Create page
                obj.results = null;
                obj.pageNumber = 0;

                if (obj.options.pagination > 0) {
                    obj.page(0);
                } else if (obj.options.lazyLoading == true) {
                    obj.loadPage(0);
                } else {
                    for (var j = 0; j < obj.rows.length; j++) {
                        obj.tbody.appendChild(obj.rows[j]);
                    }
                }
            }
        }

        /**
         * Move row
         *
         * @return void
         */
        obj.moveRow = function (o, d, ignoreDom) {
            if (Object.keys(obj.options.mergeCells).length > 0) {
                if (o > d) {
                    var insertBefore = 1;
                } else {
                    var insertBefore = 0;
                }

                if (obj.isRowMerged(o).length || obj.isRowMerged(d, insertBefore).length) {
                    if (!confirm(obj.options.text.thisActionWillDestroyAnyExistingMergedCellsAreYouSure)) {
                        return false;
                    } else {
                        obj.destroyMerged();
                    }
                }
            }

            if (obj.options.search == true) {
                if (obj.results && obj.results.length != obj.rows.length) {
                    if (confirm(obj.options.text.thisActionWillClearYourSearchResultsAreYouSure)) {
                        obj.resetSearch();
                    } else {
                        return false;
                    }
                }

                obj.results = null;
            }

            if (!ignoreDom) {
                if (Array.prototype.indexOf.call(obj.tbody.children, obj.rows[d]) >= 0) {
                    if (o > d) {
                        obj.tbody.insertBefore(obj.rows[o], obj.rows[d]);
                    } else {
                        obj.tbody.insertBefore(obj.rows[o], obj.rows[d].nextSibling);
                    }
                } else {
                    obj.tbody.removeChild(obj.rows[o]);
                }
            }

            // Place references in the correct position
            obj.rows.splice(d, 0, obj.rows.splice(o, 1)[0]);
            obj.records.splice(d, 0, obj.records.splice(o, 1)[0]);
            obj.options.data.splice(d, 0, obj.options.data.splice(o, 1)[0]);

            // Respect pagination
            if (obj.options.pagination > 0 && obj.tbody.children.length != obj.options.pagination) {
                obj.page(obj.pageNumber);
            }

            // Keeping history of changes
            obj.setHistory({
                action: 'moveRow',
                oldValue: o,
                newValue: d,
            });

            // Update table references
            obj.updateTableReferences();

            // Events
            obj.dispatch('onmoverow', el, o, d);
        }

        /**
         * Insert a new row
         *
         * @param mixed - number of blank lines to be insert or a single array with the data of the new row
         * @param rowNumber
         * @param insertBefore
         * @return void
         */
        obj.insertRow = function (mixed, rowNumber, insertBefore, force) {
            // Configuration
            if (obj.options.allowInsertRow == true || force) {
                // Records
                var records = [];

                // Data to be insert
                var data = [];

                // The insert could be lead by number of rows or the array of data
                if (mixed > 0) {
                    var numOfRows = mixed;
                } else {
                    var numOfRows = 1;

                    if (mixed) {
                        data = mixed;
                    }
                }

                // Direction
                var insertBefore = insertBefore ? true : false;

                // Current column number
                var lastRow = obj.options.data.length - 1;

                if (rowNumber == undefined || rowNumber >= parseInt(lastRow) || rowNumber < 0) {
                    rowNumber = lastRow;
                }

                // Onbeforeinsertrow
                if (obj.dispatch('onbeforeinsertrow', el, rowNumber, numOfRows, insertBefore) === false) {
                    console.log('onbeforeinsertrow returned false');

                    return false;
                }

                // Merged cells
                if (Object.keys(obj.options.mergeCells).length > 0) {
                    if (obj.isRowMerged(rowNumber, insertBefore).length) {
                        if (!confirm(obj.options.text.thisActionWillDestroyAnyExistingMergedCellsAreYouSure)) {
                            return false;
                        } else {
                            obj.destroyMerged();
                        }
                    }
                }

                // Clear any search
                if (obj.options.search == true) {
                    if (obj.results && obj.results.length != obj.rows.length) {
                        if (confirm(obj.options.text.thisActionWillClearYourSearchResultsAreYouSure)) {
                            obj.resetSearch();
                        } else {
                            return false;
                        }
                    }

                    obj.results = null;
                }

                // Insertbefore
                var rowIndex = (!insertBefore) ? rowNumber + 1 : rowNumber;

                // Keep the current data
                var currentRecords = obj.records.splice(rowIndex);
                var currentData = obj.options.data.splice(rowIndex);
                var currentRows = obj.rows.splice(rowIndex);

                // Adding lines
                var rowRecords = [];
                var rowData = [];
                var rowNode = [];

                for (var row = rowIndex; row < (numOfRows + rowIndex); row++) {

                    // Push data to the data container
                    obj.options.data[row] = [];
                    for (var col = 0; col < obj.options.columns.length; col++) {
                        if (obj.options.columns[col].default) {
                            data[col] = obj.options.columns[col].default;
                        } else {
                            if (obj.options.columns[col].type === 'dropdown') {
                                if (obj.options.columns[col].multiple) {
                                    data[col] = [obj.options.columns[col].source[0].id];
                                } else {
                                    data[col] = obj.options.columns[col].source[0].id;
                                }
                            }
                        }
                        obj.options.data[row][col] = data[col] ? data[col] : '';
                    }

                    // Create row
                    var tr = obj.createRow(row, obj.options.data[row]);

                    // Append node
                    if (currentRows[0]) {
                        if (Array.prototype.indexOf.call(obj.tbody.children, currentRows[0]) >= 0) {
                            obj.tbody.insertBefore(tr, currentRows[0]);
                        }
                    } else {
                        if (Array.prototype.indexOf.call(obj.tbody.children, obj.rows[rowNumber]) >= 0) {
                            obj.tbody.appendChild(tr);
                        }
                    }

                    // Record History
                    rowRecords.push(obj.records[row]);
                    rowData.push(obj.options.data[row]);
                    rowNode.push(tr);
                }

                // Copy the data back to the main data
                Array.prototype.push.apply(obj.records, currentRecords);
                Array.prototype.push.apply(obj.options.data, currentData);
                Array.prototype.push.apply(obj.rows, currentRows);

                // Respect pagination
                if (obj.options.pagination > 0) {
                    obj.page(obj.pageNumber);
                }

                // Keep history
                obj.setHistory({
                    action: 'insertRow',
                    rowNumber: rowNumber,
                    numOfRows: numOfRows,
                    insertBefore: insertBefore,
                    rowRecords: rowRecords,
                    rowData: rowData,
                    rowNode: rowNode,
                });

                // Remove table references
                obj.updateTableReferences();

                // Events
                obj.dispatch('oninsertrow', el, rowNumber, numOfRows, rowRecords, insertBefore);
            }
        }

        /**
         * Delete a row by number
         *
         * @param integer rowNumber - row number to be excluded
         * @param integer numOfRows - number of lines
         * @return void
         */
        obj.deleteRow = function (rowNumber, numOfRows) {
            // Global Configuration
            if (obj.options.allowDeleteRow == true) {
                if (obj.options.allowDeletingAllRows == true || obj.options.data.length > 1) {
                    // Delete row definitions
                    if (rowNumber == undefined) {
                        var number = obj.getSelectedRows();

                        if (!number[0]) {
                            rowNumber = obj.options.data.length - 1;
                            numOfRows = 1;
                        } else {
                            rowNumber = parseInt(number[0].getAttribute('data-y'));
                            numOfRows = number.length;
                        }
                    }

                    // Last column
                    var lastRow = obj.options.data.length - 1;

                    if (rowNumber == undefined || rowNumber > lastRow || rowNumber < 0) {
                        rowNumber = lastRow;
                    }

                    if (!numOfRows) {
                        numOfRows = 1;
                    }

                    // Do not delete more than the number of recoreds
                    if (rowNumber + numOfRows >= obj.options.data.length) {
                        numOfRows = obj.options.data.length - rowNumber;
                    }

                    // Onbeforedeleterow
                    if (obj.dispatch('onbeforedeleterow', el, rowNumber, numOfRows) === false) {
                        console.log('onbeforedeleterow returned false');
                        return false;
                    }

                    if (parseInt(rowNumber) > -1) {
                        // Merged cells
                        var mergeExists = false;
                        if (Object.keys(obj.options.mergeCells).length > 0) {
                            for (var row = rowNumber; row < rowNumber + numOfRows; row++) {
                                if (obj.isRowMerged(row, false).length) {
                                    mergeExists = true;
                                }
                            }
                        }
                        if (mergeExists) {
                            if (!confirm(obj.options.text.thisActionWillDestroyAnyExistingMergedCellsAreYouSure)) {
                                return false;
                            } else {
                                obj.destroyMerged();
                            }
                        }

                        // Clear any search
                        if (obj.options.search == true) {
                            if (obj.results && obj.results.length != obj.rows.length) {
                                if (confirm(obj.options.text.thisActionWillClearYourSearchResultsAreYouSure)) {
                                    obj.resetSearch();
                                } else {
                                    return false;
                                }
                            }

                            obj.results = null;
                        }

                        // If delete all rows, and set allowDeletingAllRows false, will stay one row
                        if (obj.options.allowDeletingAllRows == false && lastRow + 1 === numOfRows) {
                            numOfRows--;
                            console.error('JEXCEL. It is not possible to delete the last row');
                        }

                        // Remove node
                        for (var row = rowNumber; row < rowNumber + numOfRows; row++) {
                            if (Array.prototype.indexOf.call(obj.tbody.children, obj.rows[row]) >= 0) {
                                obj.rows[row].className = '';
                                obj.rows[row].parentNode.removeChild(obj.rows[row]);
                            }
                        }

                        // Remove data
                        var rowRecords = obj.records.splice(rowNumber, numOfRows);
                        var rowData = obj.options.data.splice(rowNumber, numOfRows);
                        var rowNode = obj.rows.splice(rowNumber, numOfRows);

                        // Respect pagination
                        if (obj.options.pagination > 0 && obj.tbody.children.length != obj.options.pagination) {
                            obj.page(obj.pageNumber);
                        }

                        // Remove selection
                        obj.conditionalSelectionUpdate(1, rowNumber, (rowNumber + numOfRows) - 1);

                        // Keep history
                        obj.setHistory({
                            action: 'deleteRow',
                            rowNumber: rowNumber,
                            numOfRows: numOfRows,
                            insertBefore: 1,
                            rowRecords: rowRecords,
                            rowData: rowData,
                            rowNode: rowNode
                        });

                        // Remove table references
                        obj.updateTableReferences();
                        // Events
                        obj.dispatch('ondeleterow', el, rowNumber, numOfRows, rowRecords);
                    }
                } else {
                    console.error('JEXCEL. It is not possible to delete the last row');
                }
            }
        }


        /**
         * Move column
         *
         * @return void
         */
        obj.moveColumn = function (o, d) {
            if (Object.keys(obj.options.mergeCells).length > 0) {
                if (o > d) {
                    var insertBefore = 1;
                } else {
                    var insertBefore = 0;
                }

                if (obj.isColMerged(o).length || obj.isColMerged(d, insertBefore).length) {
                    if (!confirm(obj.options.text.thisActionWillDestroyAnyExistingMergedCellsAreYouSure)) {
                        return false;
                    } else {
                        obj.destroyMerged();
                    }
                }
            }

            var o = parseInt(o);
            var d = parseInt(d);

            if (o > d) {
                obj.headerContainer.insertBefore(obj.headers[o], obj.headers[d]);
                obj.colgroupContainer.insertBefore(obj.colgroup[o], obj.colgroup[d]);

                for (var j = 0; j < obj.rows.length; j++) {
                    obj.rows[j].insertBefore(obj.records[j][o], obj.records[j][d]);
                }
            } else {
                obj.headerContainer.insertBefore(obj.headers[o], obj.headers[d].nextSibling);
                obj.colgroupContainer.insertBefore(obj.colgroup[o], obj.colgroup[d].nextSibling);

                for (var j = 0; j < obj.rows.length; j++) {
                    obj.rows[j].insertBefore(obj.records[j][o], obj.records[j][d].nextSibling);
                }
            }

            obj.options.columns.splice(d, 0, obj.options.columns.splice(o, 1)[0]);
            obj.headers.splice(d, 0, obj.headers.splice(o, 1)[0]);
            obj.colgroup.splice(d, 0, obj.colgroup.splice(o, 1)[0]);

            for (var j = 0; j < obj.rows.length; j++) {
                obj.options.data[j].splice(d, 0, obj.options.data[j].splice(o, 1)[0]);
                obj.records[j].splice(d, 0, obj.records[j].splice(o, 1)[0]);
            }

            // Update footers position
            if (obj.options.footers) {
                for (var j = 0; j < obj.options.footers.length; j++) {
                    obj.options.footers[j].splice(d, 0, obj.options.footers[j].splice(o, 1)[0]);
                }
            }

            // Keeping history of changes
            obj.setHistory({
                action: 'moveColumn',
                oldValue: o,
                newValue: d,
            });

            // Update table references
            obj.updateTableReferences();

            // Events
            obj.dispatch('onmovecolumn', el, o, d);
        }

        /**
         * Insert a new column
         *
         * @param mixed - num of columns to be added or data to be added in one single column
         * @param int columnNumber - number of columns to be created
         * @param bool insertBefore
         * @param object properties - column properties
         * @return void
         */
        obj.insertColumn = function (mixed, columnNumber, insertBefore, properties) {
            // Configuration
            if (obj.options.allowInsertColumn == true) {
                // Records
                var records = [];

                // Data to be insert
                var data = [];

                // The insert could be lead by number of rows or the array of data
                if (mixed > 0) {
                    var numOfColumns = mixed;
                } else {
                    var numOfColumns = 1;

                    if (mixed) {
                        data = mixed;
                    }
                }

                // Direction
                var insertBefore = insertBefore ? true : false;

                // Current column number
                var lastColumn = obj.options.columns.length - 1;

                // Confirm position
                if (columnNumber == undefined || columnNumber >= parseInt(lastColumn) || columnNumber < 0) {
                    columnNumber = lastColumn;
                }

                // Onbeforeinsertcolumn
                if (obj.dispatch('onbeforeinsertcolumn', el, columnNumber, numOfColumns, insertBefore) === false) {
                    console.log('onbeforeinsertcolumn returned false');

                    return false;
                }

                // Merged cells
                if (Object.keys(obj.options.mergeCells).length > 0) {
                    if (obj.isColMerged(columnNumber, insertBefore).length) {
                        if (!confirm(obj.options.text.thisActionWillDestroyAnyExistingMergedCellsAreYouSure)) {
                            return false;
                        } else {
                            obj.destroyMerged();
                        }
                    }
                }

                // Create default properties
                if (!properties) {
                    properties = [];
                }

                for (var i = 0; i < numOfColumns; i++) {
                    if (!properties[i]) {
                        properties[i] = {type: 'text', source: [], options: [], width: obj.options.defaultColWidth, align: obj.options.defaultColAlign};
                    }
                }

                // Insert before
                var columnIndex = (!insertBefore) ? columnNumber + 1 : columnNumber;
                obj.options.columns = jexcel.injectArray(obj.options.columns, columnIndex, properties);

                // Open space in the containers
                var currentHeaders = obj.headers.splice(columnIndex);
                var currentColgroup = obj.colgroup.splice(columnIndex);

                // History
                var historyHeaders = [];
                var historyColgroup = [];
                var historyRecords = [];
                var historyData = [];
                var historyFooters = [];

                // Add new headers
                for (var col = columnIndex; col < (numOfColumns + columnIndex); col++) {
                    obj.createCellHeader(col);
                    obj.headerContainer.insertBefore(obj.headers[col], obj.headerContainer.children[col + 1]);
                    obj.colgroupContainer.insertBefore(obj.colgroup[col], obj.colgroupContainer.children[col + 1]);

                    historyHeaders.push(obj.headers[col]);
                    historyColgroup.push(obj.colgroup[col]);
                }

                // Add new footer cells
                if (obj.options.footers) {
                    for (var j = 0; j < obj.options.footers.length; j++) {
                        historyFooters[j] = [];
                        for (var i = 0; i < numOfColumns; i++) {
                            historyFooters[j].push('');
                        }
                        obj.options.footers[j].splice(columnIndex, 0, historyFooters[j]);
                    }
                }

                // Adding visual columns
                for (var row = 0; row < obj.options.data.length; row++) {
                    // Keep the current data
                    var currentData = obj.options.data[row].splice(columnIndex);
                    var currentRecord = obj.records[row].splice(columnIndex);

                    // History
                    historyData[row] = [];
                    historyRecords[row] = [];

                    for (var col = columnIndex; col < (numOfColumns + columnIndex); col++) {
                        // New value
                        var value = data[row] ? data[row] : '';
                        obj.options.data[row][col] = value;
                        // New cell
                        var td = obj.createCell(col, row, obj.options.data[row][col]);
                        obj.records[row][col] = td;
                        // Add cell to the row
                        if (obj.rows[row]) {
                            obj.rows[row].insertBefore(td, obj.rows[row].children[col + 1]);
                        }

                        // Record History
                        historyData[row].push(value);
                        historyRecords[row].push(td);
                    }

                    // Copy the data back to the main data
                    Array.prototype.push.apply(obj.options.data[row], currentData);
                    Array.prototype.push.apply(obj.records[row], currentRecord);
                }

                Array.prototype.push.apply(obj.headers, currentHeaders);
                Array.prototype.push.apply(obj.colgroup, currentColgroup);

                // Adjust nested headers
                if (obj.options.nestedHeaders && obj.options.nestedHeaders.length > 0) {
                    // Flexible way to handle nestedheaders
                    if (obj.options.nestedHeaders[0] && obj.options.nestedHeaders[0][0]) {
                        for (var j = 0; j < obj.options.nestedHeaders.length; j++) {
                            var colspan = parseInt(obj.options.nestedHeaders[j][obj.options.nestedHeaders[j].length - 1].colspan) + numOfColumns;
                            obj.options.nestedHeaders[j][obj.options.nestedHeaders[j].length - 1].colspan = colspan;
                            obj.thead.children[j].children[obj.thead.children[j].children.length - 1].setAttribute('colspan', colspan);
                        }
                    } else {
                        var colspan = parseInt(obj.options.nestedHeaders[0].colspan) + numOfColumns;
                        obj.options.nestedHeaders[0].colspan = colspan;
                        obj.thead.children[0].children[obj.thead.children[0].children.length - 1].setAttribute('colspan', colspan);
                    }
                }

                // Keep history
                obj.setHistory({
                    action: 'insertColumn',
                    columnNumber: columnNumber,
                    numOfColumns: numOfColumns,
                    insertBefore: insertBefore,
                    columns: properties,
                    headers: historyHeaders,
                    colgroup: historyColgroup,
                    records: historyRecords,
                    footers: historyFooters,
                    data: historyData,
                });

                // Remove table references
                obj.updateTableReferences();

                // Events
                obj.dispatch('oninsertcolumn', el, columnNumber, numOfColumns, historyRecords, insertBefore);
            }
        }

        /**
         * Delete a column by number
         *
         * @param integer columnNumber - reference column to be excluded
         * @param integer numOfColumns - number of columns to be excluded from the reference column
         * @return void
         */
        obj.deleteColumn = function (columnNumber, numOfColumns) {
            // Global Configuration
            if (obj.options.allowDeleteColumn == true) {
                if (obj.headers.length > 1) {
                    // Delete column definitions
                    if (columnNumber == undefined) {
                        var number = obj.getSelectedColumns(true);

                        if (!number.length) {
                            // Remove last column
                            columnNumber = obj.headers.length - 1;
                            numOfColumns = 1;
                        } else {
                            // Remove selected
                            columnNumber = parseInt(number[0]);
                            numOfColumns = parseInt(number.length);
                        }
                    }

                    // Lasat column
                    var lastColumn = obj.options.data[0].length - 1;

                    if (columnNumber == undefined || columnNumber > lastColumn || columnNumber < 0) {
                        columnNumber = lastColumn;
                    }

                    // Minimum of columns to be delete is 1
                    if (!numOfColumns) {
                        numOfColumns = 1;
                    }

                    // Can't delete more than the limit of the table
                    if (numOfColumns > obj.options.data[0].length - columnNumber) {
                        numOfColumns = obj.options.data[0].length - columnNumber;
                    }

                    // onbeforedeletecolumn
                    if (obj.dispatch('onbeforedeletecolumn', el, columnNumber, numOfColumns) === false) {
                        console.log('onbeforedeletecolumn returned false');
                        return false;
                    }

                    // Can't remove the last column
                    if (parseInt(columnNumber) > -1) {
                        // Merged cells
                        var mergeExists = false;
                        if (Object.keys(obj.options.mergeCells).length > 0) {
                            for (var col = columnNumber; col < columnNumber + numOfColumns; col++) {
                                if (obj.isColMerged(col, false).length) {
                                    mergeExists = true;
                                }
                            }
                        }
                        if (mergeExists) {
                            if (!confirm(obj.options.text.thisActionWillDestroyAnyExistingMergedCellsAreYouSure)) {
                                return false;
                            } else {
                                obj.destroyMerged();
                            }
                        }

                        // Delete the column properties
                        var columns = obj.options.columns.splice(columnNumber, numOfColumns);

                        for (var col = columnNumber; col < columnNumber + numOfColumns; col++) {
                            obj.colgroup[col].className = '';
                            obj.headers[col].className = '';
                            obj.colgroup[col].parentNode.removeChild(obj.colgroup[col]);
                            obj.headers[col].parentNode.removeChild(obj.headers[col]);
                        }

                        var historyHeaders = obj.headers.splice(columnNumber, numOfColumns);
                        var historyColgroup = obj.colgroup.splice(columnNumber, numOfColumns);
                        var historyRecords = [];
                        var historyData = [];
                        var historyFooters = [];

                        for (var row = 0; row < obj.options.data.length; row++) {
                            for (var col = columnNumber; col < columnNumber + numOfColumns; col++) {
                                obj.records[row][col].className = '';
                                obj.records[row][col].parentNode.removeChild(obj.records[row][col]);
                            }
                        }

                        // Delete headers
                        for (var row = 0; row < obj.options.data.length; row++) {
                            // History
                            historyData[row] = obj.options.data[row].splice(columnNumber, numOfColumns);
                            historyRecords[row] = obj.records[row].splice(columnNumber, numOfColumns);
                        }

                        // Delete footers
                        if (obj.options.footers) {
                            for (var row = 0; row < obj.options.footers.length; row++) {
                                historyFooters[row] = obj.options.footers[row].splice(columnNumber, numOfColumns);
                            }
                        }

                        // Remove selection
                        obj.conditionalSelectionUpdate(0, columnNumber, (columnNumber + numOfColumns) - 1);

                        // Adjust nested headers
                        if (obj.options.nestedHeaders && obj.options.nestedHeaders.length > 0) {
                            // Flexible way to handle nestedheaders
                            if (obj.options.nestedHeaders[0] && obj.options.nestedHeaders[0][0]) {
                                for (var j = 0; j < obj.options.nestedHeaders.length; j++) {
                                    var colspan = parseInt(obj.options.nestedHeaders[j][obj.options.nestedHeaders[j].length - 1].colspan) - numOfColumns;
                                    obj.options.nestedHeaders[j][obj.options.nestedHeaders[j].length - 1].colspan = colspan;
                                    obj.thead.children[j].children[obj.thead.children[j].children.length - 1].setAttribute('colspan', colspan);
                                }
                            } else {
                                var colspan = parseInt(obj.options.nestedHeaders[0].colspan) - numOfColumns;
                                obj.options.nestedHeaders[0].colspan = colspan;
                                obj.thead.children[0].children[obj.thead.children[0].children.length - 1].setAttribute('colspan', colspan);
                            }
                        }

                        // Keeping history of changes
                        obj.setHistory({
                            action: 'deleteColumn',
                            columnNumber: columnNumber,
                            numOfColumns: numOfColumns,
                            insertBefore: 1,
                            columns: columns,
                            headers: historyHeaders,
                            colgroup: historyColgroup,
                            records: historyRecords,
                            footers: historyFooters,
                            data: historyData,
                        });

                        // Update table references
                        obj.updateTableReferences();

                        // Delete
                        obj.dispatch('ondeletecolumn', el, columnNumber, numOfColumns, historyRecords);
                    }
                } else {
                    console.error('JEXCEL. It is not possible to delete the last column');
                }
            }
        }

        /**
         * Get seleted rows numbers
         *
         * @return array
         */
        obj.getSelectedRows = function (asIds) {
            var rows = [];
            // Get all selected rows
            for (var j = 0; j < obj.rows.length; j++) {
                if (obj.rows[j].classList.contains('selected')) {
                    if (asIds) {
                        rows.push(j);
                    } else {
                        rows.push(obj.rows[j]);
                    }
                }
            }

            return rows;
        },

            /**
             * Get seleted column numbers
             *
             * @return array
             */
            obj.getSelectedColumns = function () {
                var cols = [];
                // Get all selected cols
                for (var i = 0; i < obj.headers.length; i++) {
                    if (obj.headers[i].classList.contains('selected')) {
                        cols.push(i);
                    }
                }

                return cols;
            }

        /**
         * Get highlighted
         *
         * @return array
         */
        obj.getHighlighted = function () {
            return obj.highlighted;
        }

        /**
         * Update cell references
         *
         * @return void
         */
        obj.updateTableReferences = function () {
            // Update headers
            for (var i = 0; i < obj.headers.length; i++) {
                var x = obj.headers[i].getAttribute('data-x');

                if (x != i) {
                    // Update coords
                    obj.headers[i].setAttribute('data-x', i);
                    // Title
                    if (!obj.headers[i].getAttribute('title')) {
                        obj.headers[i].innerHTML = jexcel.getColumnName(i);
                    }
                }
            }

            // Update all rows
            for (var j = 0; j < obj.rows.length; j++) {
                if (obj.rows[j]) {
                    var y = obj.rows[j].getAttribute('data-y');

                    if (y != j) {
                        // Update coords
                        obj.rows[j].setAttribute('data-y', j);
                        obj.rows[j].children[0].setAttribute('data-y', j);
                        // Row number
                        obj.rows[j].children[0].innerHTML = j + 1;
                    }
                }
            }

            // Regular cells affected by this change
            var affectedTokens = [];
            var mergeCellUpdates = [];

            // Update cell
            var updatePosition = function (x, y, i, j) {
                if (x != i) {
                    obj.records[j][i].setAttribute('data-x', i);
                }
                if (y != j) {
                    obj.records[j][i].setAttribute('data-y', j);
                }

                // Other updates
                if (x != i || y != j) {
                    var columnIdFrom = jexcel.getColumnNameFromId([x, y]);
                    var columnIdTo = jexcel.getColumnNameFromId([i, j]);
                    affectedTokens[columnIdFrom] = columnIdTo;
                }
            }

            for (var j = 0; j < obj.records.length; j++) {
                for (var i = 0; i < obj.records[0].length; i++) {
                    if (obj.records[j][i]) {
                        // Current values
                        var x = obj.records[j][i].getAttribute('data-x');
                        var y = obj.records[j][i].getAttribute('data-y');

                        // Update column
                        if (obj.records[j][i].getAttribute('data-merged')) {
                            var columnIdFrom = jexcel.getColumnNameFromId([x, y]);
                            var columnIdTo = jexcel.getColumnNameFromId([i, j]);
                            if (mergeCellUpdates[columnIdFrom] == null) {
                                if (columnIdFrom == columnIdTo) {
                                    mergeCellUpdates[columnIdFrom] = false;
                                } else {
                                    var totalX = parseInt(i - x);
                                    var totalY = parseInt(j - y);
                                    mergeCellUpdates[columnIdFrom] = [columnIdTo, totalX, totalY];
                                }
                            }
                        } else {
                            updatePosition(x, y, i, j);
                        }
                    }
                }
            }

            // Update merged if applicable
            var keys = Object.keys(mergeCellUpdates);
            if (keys.length) {
                for (var i = 0; i < keys.length; i++) {
                    if (mergeCellUpdates[keys[i]]) {
                        var info = jexcel.getIdFromColumnName(keys[i], true)
                        var x = info[0];
                        var y = info[1];
                        updatePosition(x, y, x + mergeCellUpdates[keys[i]][1], y + mergeCellUpdates[keys[i]][2]);

                        var columnIdFrom = keys[i];
                        var columnIdTo = mergeCellUpdates[keys[i]][0];
                        for (var j = 0; j < obj.options.mergeCells[columnIdFrom][2].length; j++) {
                            var x = parseInt(obj.options.mergeCells[columnIdFrom][2][j].getAttribute('data-x'));
                            var y = parseInt(obj.options.mergeCells[columnIdFrom][2][j].getAttribute('data-y'));
                            obj.options.mergeCells[columnIdFrom][2][j].setAttribute('data-x', x + mergeCellUpdates[keys[i]][1]);
                            obj.options.mergeCells[columnIdFrom][2][j].setAttribute('data-y', y + mergeCellUpdates[keys[i]][2]);
                        }

                        obj.options.mergeCells[columnIdTo] = obj.options.mergeCells[columnIdFrom];
                        delete (obj.options.mergeCells[columnIdFrom]);
                    }
                }
            }

            // Update formulas
            obj.updateFormulas(affectedTokens);

            // Update meta data
            obj.updateMeta(affectedTokens);

            // Refresh selection
            obj.refreshSelection();

            // Update table with custom configuration if applicable
            obj.updateTable();
        }

        /**
         * Custom settings for the cells
         */
        obj.updateTable = function () {
            // Check for spare
            if (obj.options.minSpareRows > 0) {
                var numBlankRows = 0;
                for (var j = obj.rows.length - 1; j >= 0; j--) {
                    var test = false;
                    for (var i = 0; i < obj.headers.length; i++) {
                        if (obj.options.data[j][i]) {
                            test = true;
                        }
                    }
                    if (test) {
                        break;
                    } else {
                        numBlankRows++;
                    }
                }

                if (obj.options.minSpareRows - numBlankRows > 0) {
                    obj.insertRow(obj.options.minSpareRows - numBlankRows)
                }
            }

            if (obj.options.minSpareCols > 0) {
                var numBlankCols = 0;
                for (var i = obj.headers.length - 1; i >= 0; i--) {
                    var test = false;
                    for (var j = 0; j < obj.rows.length; j++) {
                        if (obj.options.data[j][i]) {
                            test = true;
                        }
                    }
                    if (test) {
                        break;
                    } else {
                        numBlankCols++;
                    }
                }

                if (obj.options.minSpareCols - numBlankCols > 0) {
                    obj.insertColumn(obj.options.minSpareCols - numBlankCols)
                }
            }

            // Customizations by the developer
            if (typeof (obj.options.updateTable) == 'function') {
                if (obj.options.detachForUpdates) {
                    el.removeChild(obj.content);
                }

                for (var j = 0; j < obj.rows.length; j++) {
                    for (var i = 0; i < obj.headers.length; i++) {
                        obj.options.updateTable(el, obj.records[j][i], i, j, obj.options.data[j][i], obj.records[j][i].innerText, jexcel.getColumnNameFromId([i, j]));
                    }
                }

                if (obj.options.detachForUpdates) {
                    el.insertBefore(obj.content, obj.pagination);
                }
            }

            // Update footers
            if (obj.options.footers) {
                obj.setFooter();
            }

            // Update corner position
            setTimeout(function () {
                obj.updateCornerPosition();
            }, 0);
        }

        /**
         * Readonly
         */
        obj.isReadOnly = function (cell) {
            if (cell = obj.getCell(cell)) {
                return cell.classList.contains('readonly') ? true : false;
            }
        }

        /**
         * Readonly
         */
        obj.setReadOnly = function (cell, state) {
            if (cell = obj.getCell(cell)) {
                if (state) {
                    cell.classList.add('readonly');
                } else {
                    cell.classList.remove('readonly');
                }
            }
        }

        /**
         * Show row
         */
        obj.showRow = function (rowNumber) {
            obj.rows[rowNumber].style.display = '';
        }

        /**
         * Hide row
         */
        obj.hideRow = function (rowNumber) {
            obj.rows[rowNumber].style.display = 'none';
        }

        /**
         * Show column
         */
        obj.showColumn = function (colNumber) {
            obj.headers[colNumber].style.display = '';
            obj.colgroup[colNumber].style.display = '';
            for (var j = 0; j < obj.options.data.length; j++) {
                obj.records[j][colNumber].style.display = '';
            }
        }

        /**
         * Hide column
         */
        obj.hideColumn = function (colNumber) {
            obj.headers[colNumber].style.display = 'none';
            obj.colgroup[colNumber].style.display = 'none';
            for (var j = 0; j < obj.options.data.length; j++) {
                obj.records[j][colNumber].style.display = 'none';
            }
        }

        /**
         * Show index column
         */
        obj.showIndex = function () {
            obj.table.classList.remove('jexcel_hidden_index');
        }

        /**
         * Hide index column
         */
        obj.hideIndex = function () {
            obj.table.classList.add('jexcel_hidden_index');
        }

        /**
         * Update all related cells in the chain
         */
        var chainLoopProtection = [];

        obj.updateFormulaChain = function (x, y, records) {
            var cellId = jexcel.getColumnNameFromId([x, y]);
            if (obj.formula[cellId] && obj.formula[cellId].length > 0) {
                if (chainLoopProtection[cellId]) {
                    obj.records[y][x].innerHTML = '#ERROR';
                    obj.formula[cellId] = '';
                } else {
                    // Protection
                    chainLoopProtection[cellId] = true;

                    for (var i = 0; i < obj.formula[cellId].length; i++) {
                        var cell = jexcel.getIdFromColumnName(obj.formula[cellId][i], true);
                        // Update cell
                        var value = '' + obj.options.data[cell[1]][cell[0]];
                        if (value.substr(0, 1) == '=') {
                            records.push(obj.updateCell(cell[0], cell[1], value, true));
                        } else {
                            // No longer a formula, remove from the chain
                            Object.keys(obj.formula)[i] = null;
                        }
                        obj.updateFormulaChain(cell[0], cell[1], records);
                    }
                }
            }

            chainLoopProtection = [];
        }

        /**
         * Update formulas
         */
        obj.updateFormulas = function (referencesToUpdate) {
            // Update formulas
            for (var j = 0; j < obj.options.data.length; j++) {
                for (var i = 0; i < obj.options.data[0].length; i++) {
                    var value = '' + obj.options.data[j][i];
                    // Is formula
                    if (value.substr(0, 1) == '=') {
                        // Replace tokens
                        var newFormula = obj.updateFormula(value, referencesToUpdate);
                        if (newFormula != value) {
                            obj.options.data[j][i] = newFormula;
                        }
                    }
                }
            }

            // Update formula chain
            var formula = [];
            var keys = Object.keys(obj.formula);
            for (var j = 0; j < keys.length; j++) {
                // Current key and values
                var key = keys[j];
                var value = obj.formula[key];
                // Update key
                if (referencesToUpdate[key]) {
                    key = referencesToUpdate[key];
                }
                // Update values
                formula[key] = [];
                for (var i = 0; i < value.length; i++) {
                    var letter = value[i];
                    if (referencesToUpdate[letter]) {
                        letter = referencesToUpdate[letter];
                    }
                    formula[key].push(letter);
                }
            }
            obj.formula = formula;
        }

        /**
         * Update formula
         */
        obj.updateFormula = function (formula, referencesToUpdate) {
            var testLetter = /[A-Z]/;
            var testNumber = /[0-9]/;

            var newFormula = '';
            var letter = null;
            var number = null;
            var token = '';

            for (var index = 0; index < formula.length; index++) {
                if (testLetter.exec(formula[index])) {
                    letter = 1;
                    number = 0;
                    token += formula[index];
                } else if (testNumber.exec(formula[index])) {
                    number = letter ? 1 : 0;
                    token += formula[index];
                } else {
                    if (letter && number) {
                        token = referencesToUpdate[token] ? referencesToUpdate[token] : token;
                    }
                    newFormula += token;
                    newFormula += formula[index];
                    letter = 0;
                    number = 0;
                    token = '';
                }
            }

            if (token) {
                if (letter && number) {
                    token = referencesToUpdate[token] ? referencesToUpdate[token] : token;
                }
                newFormula += token;
            }

            return newFormula;
        }

        /**
         * Secure formula
         */
        var secureFormula = function (oldValue) {
            var newValue = '';
            var inside = 0;

            for (var i = 0; i < oldValue.length; i++) {
                if (oldValue[i] == '"') {
                    if (inside == 0) {
                        inside = 1;
                    } else {
                        inside = 0;
                    }
                }

                if (inside == 1) {
                    newValue += oldValue[i];
                } else {
                    newValue += oldValue[i].toUpperCase();
                }
            }

            return newValue;
        }

        /**
         * Parse formulas
         */
        obj.executeFormula = function (expression, x, y) {

            var formulaResults = [];
            var formulaLoopProtection = [];

            // Execute formula with loop protection
            var execute = function (expression, x, y) {
                // Parent column identification
                var parentId = jexcel.getColumnNameFromId([x, y]);

                // Code protection
                if (formulaLoopProtection[parentId]) {
                    console.error('Reference loop detected');
                    return '#ERROR';
                }

                formulaLoopProtection[parentId] = true;

                // Convert range tokens
                var tokensUpdate = function (tokens) {
                    for (var index = 0; index < tokens.length; index++) {
                        var f = [];
                        var token = tokens[index].split(':');
                        var e1 = jexcel.getIdFromColumnName(token[0], true);
                        var e2 = jexcel.getIdFromColumnName(token[1], true);

                        if (e1[0] <= e2[0]) {
                            var x1 = e1[0];
                            var x2 = e2[0];
                        } else {
                            var x1 = e2[0];
                            var x2 = e1[0];
                        }

                        if (e1[1] <= e2[1]) {
                            var y1 = e1[1];
                            var y2 = e2[1];
                        } else {
                            var y1 = e2[1];
                            var y2 = e1[1];
                        }

                        for (var j = y1; j <= y2; j++) {
                            for (var i = x1; i <= x2; i++) {
                                f.push(jexcel.getColumnNameFromId([i, j]));
                            }
                        }

                        expression = expression.replace(tokens[index], f.join(','));
                    }
                }

                // Range with $ remove $
                expression = expression.replace(/\$?([A-Z]+)\$?([0-9]+)/g, "$1$2");

                var tokens = expression.match(/([A-Z]+[0-9]+)\:([A-Z]+[0-9]+)/g);
                if (tokens && tokens.length) {
                    tokensUpdate(tokens);
                }

                // String
                var evalstring = '';

                // Get tokens
                var tokens = expression.match(/([A-Z]+[0-9]+)/g);

                // Direct self-reference protection
                if (tokens && tokens.indexOf(parentId) > -1) {
                    console.error('Self Reference detected');
                    return '#ERROR';
                } else {
                    if (tokens) {
                        for (var i = 0; i < tokens.length; i++) {
                            // Keep chain
                            if (!obj.formula[tokens[i]]) {
                                obj.formula[tokens[i]] = [];
                            }
                            // Is already in the register
                            if (obj.formula[tokens[i]].indexOf(parentId) < 0) {
                                obj.formula[tokens[i]].push(parentId);
                            }

                            // Do not calculate again
                            if (eval('typeof(' + tokens[i] + ') == "undefined"')) {
                                // Coords
                                var position = jexcel.getIdFromColumnName(tokens[i], 1);
                                // Get value
                                if (typeof (obj.options.data[position[1]]) != 'undefined' && typeof (obj.options.data[position[1]][position[0]]) != 'undefined') {
                                    var value = obj.options.data[position[1]][position[0]];
                                } else {
                                    var value = '';
                                }
                                // Get column data
                                if (('' + value).substr(0, 1) == '=') {
                                    if (formulaResults[tokens[i]]) {
                                        value = formulaResults[tokens[i]];
                                    } else {
                                        value = execute(value, position[0], position[1]);
                                        formulaResults[tokens[i]] = value;
                                    }
                                }
                                // Type!
                                if (('' + value).trim() == '') {
                                    // Null
                                    evalstring += "var " + tokens[i] + " = null;";
                                } else {
                                    if (value == Number(value) && obj.options.autoCasting == true) {
                                        // Number
                                        evalstring += "var " + tokens[i] + " = " + Number(value) + ";";
                                    } else {
                                        // Trying any formatted number
                                        var number = obj.parseNumber(value, position[0])
                                        if (obj.options.autoCasting == true && number) {
                                            // Render as number
                                            evalstring += "var " + tokens[i] + " = " + number + ";";
                                        } else {
                                            // Render as string
                                            evalstring += "var " + tokens[i] + " = '" + value + "';";
                                        }
                                    }
                                }
                            }
                        }
                    }

                    // Convert formula to javascript
                    try {
                        evalstring += "function COLUMN() { return parseInt(x) + 1; }; function ROW() { return parseInt(y) + 1; }; function CELL() { return parentId; }; function TABLE() { return obj; }; function VALUE(col, row) { return obj.records[row-1][col-1].innerHTML; }; function THISROWCELL(col) { var id = jexcel.getIdFromColumnName(col+(parseInt(y)+1), true); return obj.records[id[1]][id[0]].innerHTML; }";

                        var res = eval(evalstring + expression.substr(1));
                    } catch (e) {
                        var res = '#ERROR';
                    }

                    return res;
                }
            }

            return execute(expression, x, y);
        }

        /**
         * Trying to extract a number from a string
         */
        obj.parseNumber = function (value, columnNumber) {
            // Decimal point
            var decimal = columnNumber && obj.options.columns[columnNumber].decimal ? obj.options.columns[columnNumber].decimal : '.';

            // Parse both parts of the number
            var number = ('' + value);
            number = number.split(decimal);
            number[0] = number[0].match(/[+-]?[0-9]/g);
            if (number[0]) {
                number[0] = number[0].join('');
            }
            if (number[1]) {
                number[1] = number[1].match(/[0-9]*/g).join('');
            }

            // Is a valid number
            if (number[0] && Number(number[0]) >= 0) {
                if (!number[1]) {
                    var value = Number(number[0] + '.00');
                } else {
                    var value = Number(number[0] + '.' + number[1]);
                }
            } else {
                var value = null;
            }

            return value;
        }

        /**
         * Get row number
         */
        obj.row = function (cell) {
        }

        /**
         * Get col number
         */
        obj.col = function (cell) {
        }

        obj.up = function (shiftKey, ctrlKey) {
            if (shiftKey) {
                if (obj.selectedCell[3] > 0) {
                    obj.up.visible(1, ctrlKey ? 0 : 1)
                }
            } else {
                if (obj.selectedCell[1] > 0) {
                    obj.up.visible(0, ctrlKey ? 0 : 1)
                }
                obj.selectedCell[2] = obj.selectedCell[0];
                obj.selectedCell[3] = obj.selectedCell[1];
            }

            // Update selection
            obj.updateSelectionFromCoords(obj.selectedCell[0], obj.selectedCell[1], obj.selectedCell[2], obj.selectedCell[3]);

            // Change page
            if (obj.options.lazyLoading == true) {
                if (obj.selectedCell[1] == 0 || obj.selectedCell[3] == 0) {
                    obj.loadPage(0);
                    obj.updateSelectionFromCoords(obj.selectedCell[0], obj.selectedCell[1], obj.selectedCell[2], obj.selectedCell[3]);
                } else {
                    if (obj.loadValidation()) {
                        obj.updateSelectionFromCoords(obj.selectedCell[0], obj.selectedCell[1], obj.selectedCell[2], obj.selectedCell[3]);
                    } else {
                        var item = parseInt(obj.tbody.firstChild.getAttribute('data-y'));
                        if (obj.selectedCell[1] - item < 30) {
                            obj.loadUp();
                            obj.updateSelectionFromCoords(obj.selectedCell[0], obj.selectedCell[1], obj.selectedCell[2], obj.selectedCell[3]);
                        }
                    }
                }
            } else if (obj.options.pagination > 0) {
                var pageNumber = obj.whichPage(obj.selectedCell[3]);
                if (pageNumber != obj.pageNumber) {
                    obj.page(pageNumber);
                }
            }

            obj.updateScroll(1);
        }

        obj.up.visible = function (group, direction) {
            if (group == 0) {
                var x = parseInt(obj.selectedCell[0]);
                var y = parseInt(obj.selectedCell[1]);
            } else {
                var x = parseInt(obj.selectedCell[2]);
                var y = parseInt(obj.selectedCell[3]);
            }

            if (direction == 0) {
                for (var j = 0; j < y; j++) {
                    if (obj.records[j][x].style.display != 'none' && obj.rows[j].style.display != 'none') {
                        y = j;
                        break;
                    }
                }
            } else {
                y = obj.up.get(x, y);
            }

            if (group == 0) {
                obj.selectedCell[0] = x;
                obj.selectedCell[1] = y;
            } else {
                obj.selectedCell[2] = x;
                obj.selectedCell[3] = y;
            }
        }

        obj.up.get = function (x, y) {
            var x = parseInt(x);
            var y = parseInt(y);
            for (var j = (y - 1); j >= 0; j--) {
                if (obj.records[j][x].style.display != 'none' && obj.rows[j].style.display != 'none') {
                    if (obj.records[j][x].getAttribute('data-merged')) {
                        if (obj.records[j][x] == obj.records[y][x]) {
                            continue;
                        }
                    }
                    y = j;
                    break;
                }
            }

            return y;
        }

        obj.down = function (shiftKey, ctrlKey) {
            if (shiftKey) {
                if (obj.selectedCell[3] < obj.records.length - 1) {
                    obj.down.visible(1, ctrlKey ? 0 : 1)
                }
            } else {
                if (obj.selectedCell[1] < obj.records.length - 1) {
                    obj.down.visible(0, ctrlKey ? 0 : 1)
                }
                obj.selectedCell[2] = obj.selectedCell[0];
                obj.selectedCell[3] = obj.selectedCell[1];
            }

            obj.updateSelectionFromCoords(obj.selectedCell[0], obj.selectedCell[1], obj.selectedCell[2], obj.selectedCell[3]);

            // Change page
            if (obj.options.lazyLoading == true) {
                if ((obj.selectedCell[1] == obj.records.length - 1 || obj.selectedCell[3] == obj.records.length - 1)) {
                    obj.loadPage(-1);
                    obj.updateSelectionFromCoords(obj.selectedCell[0], obj.selectedCell[1], obj.selectedCell[2], obj.selectedCell[3]);
                } else {
                    if (obj.loadValidation()) {
                        obj.updateSelectionFromCoords(obj.selectedCell[0], obj.selectedCell[1], obj.selectedCell[2], obj.selectedCell[3]);
                    } else {
                        var item = parseInt(obj.tbody.lastChild.getAttribute('data-y'));
                        if (item - obj.selectedCell[3] < 30) {
                            obj.loadDown();
                            obj.updateSelectionFromCoords(obj.selectedCell[0], obj.selectedCell[1], obj.selectedCell[2], obj.selectedCell[3]);
                        }
                    }
                }
            } else if (obj.options.pagination > 0) {
                var pageNumber = obj.whichPage(obj.selectedCell[3]);
                if (pageNumber != obj.pageNumber) {
                    obj.page(pageNumber);
                }
            }

            obj.updateScroll(3);
        }

        obj.down.visible = function (group, direction) {
            if (group == 0) {
                var x = parseInt(obj.selectedCell[0]);
                var y = parseInt(obj.selectedCell[1]);
            } else {
                var x = parseInt(obj.selectedCell[2]);
                var y = parseInt(obj.selectedCell[3]);
            }

            if (direction == 0) {
                for (var j = obj.rows.length - 1; j > y; j--) {
                    if (obj.records[j][x].style.display != 'none' && obj.rows[j].style.display != 'none') {
                        y = j;
                        break;
                    }
                }
            } else {
                y = obj.down.get(x, y);
            }

            if (group == 0) {
                obj.selectedCell[0] = x;
                obj.selectedCell[1] = y;
            } else {
                obj.selectedCell[2] = x;
                obj.selectedCell[3] = y;
            }
        }

        obj.down.get = function (x, y) {
            var x = parseInt(x);
            var y = parseInt(y);
            for (var j = (y + 1); j < obj.rows.length; j++) {
                if (obj.records[j][x].style.display != 'none' && obj.rows[j].style.display != 'none') {
                    if (obj.records[j][x].getAttribute('data-merged')) {
                        if (obj.records[j][x] == obj.records[y][x]) {
                            continue;
                        }
                    }
                    y = j;
                    break;
                }
            }

            return y;
        }

        obj.right = function (shiftKey, ctrlKey) {
            if (shiftKey) {
                if (obj.selectedCell[2] < obj.headers.length - 1) {
                    obj.right.visible(1, ctrlKey ? 0 : 1)
                }
            } else {
                if (obj.selectedCell[0] < obj.headers.length - 1) {
                    obj.right.visible(0, ctrlKey ? 0 : 1)
                }
                obj.selectedCell[2] = obj.selectedCell[0];
                obj.selectedCell[3] = obj.selectedCell[1];
            }

            obj.updateSelectionFromCoords(obj.selectedCell[0], obj.selectedCell[1], obj.selectedCell[2], obj.selectedCell[3]);
            obj.updateScroll(2);
        }

        obj.right.visible = function (group, direction) {
            if (group == 0) {
                var x = parseInt(obj.selectedCell[0]);
                var y = parseInt(obj.selectedCell[1]);
            } else {
                var x = parseInt(obj.selectedCell[2]);
                var y = parseInt(obj.selectedCell[3]);
            }

            if (direction == 0) {
                for (var i = obj.headers.length - 1; i > x; i--) {
                    if (obj.records[y][i].style.display != 'none') {
                        x = i;
                        break;
                    }
                }
            } else {
                x = obj.right.get(x, y);
            }

            if (group == 0) {
                obj.selectedCell[0] = x;
                obj.selectedCell[1] = y;
            } else {
                obj.selectedCell[2] = x;
                obj.selectedCell[3] = y;
            }
        }

        obj.right.get = function (x, y) {
            var x = parseInt(x);
            var y = parseInt(y);

            for (var i = (x + 1); i < obj.headers.length; i++) {
                if (obj.records[y][i].style.display != 'none') {
                    if (obj.records[y][i].getAttribute('data-merged')) {
                        if (obj.records[y][i] == obj.records[y][x]) {
                            continue;
                        }
                    }
                    x = i;
                    break;
                }
            }

            return x;
        }

        obj.left = function (shiftKey, ctrlKey) {
            if (shiftKey) {
                if (obj.selectedCell[2] > 0) {
                    obj.left.visible(1, ctrlKey ? 0 : 1)
                }
            } else {
                if (obj.selectedCell[0] > 0) {
                    obj.left.visible(0, ctrlKey ? 0 : 1)
                }
                obj.selectedCell[2] = obj.selectedCell[0];
                obj.selectedCell[3] = obj.selectedCell[1];
            }

            obj.updateSelectionFromCoords(obj.selectedCell[0], obj.selectedCell[1], obj.selectedCell[2], obj.selectedCell[3]);
            obj.updateScroll(0);
        }

        obj.left.visible = function (group, direction) {
            if (group == 0) {
                var x = parseInt(obj.selectedCell[0]);
                var y = parseInt(obj.selectedCell[1]);
            } else {
                var x = parseInt(obj.selectedCell[2]);
                var y = parseInt(obj.selectedCell[3]);
            }

            if (direction == 0) {
                for (var i = 0; i < x; i++) {
                    if (obj.records[y][i].style.display != 'none') {
                        x = i;
                        break;
                    }
                }
            } else {
                x = obj.left.get(x, y);
            }

            if (group == 0) {
                obj.selectedCell[0] = x;
                obj.selectedCell[1] = y;
            } else {
                obj.selectedCell[2] = x;
                obj.selectedCell[3] = y;
            }
        }

        obj.left.get = function (x, y) {
            var x = parseInt(x);
            var y = parseInt(y);
            for (var i = (x - 1); i >= 0; i--) {
                if (obj.records[y][i].style.display != 'none') {
                    if (obj.records[y][i].getAttribute('data-merged')) {
                        if (obj.records[y][i] == obj.records[y][x]) {
                            continue;
                        }
                    }
                    x = i;
                    break;
                }
            }

            return x;
        }

        obj.first = function (shiftKey, ctrlKey) {
            if (shiftKey) {
                if (ctrlKey) {
                    obj.selectedCell[3] = 0;
                } else {
                    obj.left.visible(1, 0);
                }
            } else {
                if (ctrlKey) {
                    obj.selectedCell[1] = 0;
                } else {
                    obj.left.visible(0, 0);
                }
                obj.selectedCell[2] = obj.selectedCell[0];
                obj.selectedCell[3] = obj.selectedCell[1];
            }

            // Change page
            if (obj.options.lazyLoading == true && (obj.selectedCell[1] == 0 || obj.selectedCell[3] == 0)) {
                obj.loadPage(0);
            } else if (obj.options.pagination > 0) {
                var pageNumber = obj.whichPage(obj.selectedCell[3]);
                if (pageNumber != obj.pageNumber) {
                    obj.page(pageNumber);
                }
            }

            obj.updateSelectionFromCoords(obj.selectedCell[0], obj.selectedCell[1], obj.selectedCell[2], obj.selectedCell[3]);
            obj.updateScroll(1);
        }

        obj.last = function (shiftKey, ctrlKey) {
            if (shiftKey) {
                if (ctrlKey) {
                    obj.selectedCell[3] = obj.records.length - 1;
                } else {
                    obj.right.visible(1, 0);
                }
            } else {
                if (ctrlKey) {
                    obj.selectedCell[1] = obj.records.length - 1;
                } else {
                    obj.right.visible(0, 0);
                }
                obj.selectedCell[2] = obj.selectedCell[0];
                obj.selectedCell[3] = obj.selectedCell[1];
            }

            // Change page
            if (obj.options.lazyLoading == true && (obj.selectedCell[1] == obj.records.length - 1 || obj.selectedCell[3] == obj.records.length - 1)) {
                obj.loadPage(-1);
            } else if (obj.options.pagination > 0) {
                var pageNumber = obj.whichPage(obj.selectedCell[3]);
                if (pageNumber != obj.pageNumber) {
                    obj.page(pageNumber);
                }
            }

            obj.updateSelectionFromCoords(obj.selectedCell[0], obj.selectedCell[1], obj.selectedCell[2], obj.selectedCell[3]);
            obj.updateScroll(3);
        }

        obj.selectAll = function () {
            if (!obj.selectedCell) {
                obj.selectedCell = [];
            }

            obj.selectedCell[0] = 0;
            obj.selectedCell[1] = 0;
            obj.selectedCell[2] = obj.headers.length - 1;
            obj.selectedCell[3] = obj.records.length - 1;

            obj.updateSelectionFromCoords(obj.selectedCell[0], obj.selectedCell[1], obj.selectedCell[2], obj.selectedCell[3]);
        }

        /**
         * Go to a page in a lazyLoading
         */
        obj.loadPage = function (pageNumber) {
            // Search
            if (obj.options.search == true && obj.results) {
                var results = obj.results;
            } else {
                var results = obj.rows;
            }

            // Per page
            var quantityPerPage = 100;

            // pageNumber
            if (pageNumber == null || pageNumber == -1) {
                // Last page
                pageNumber = Math.ceil(results.length / quantityPerPage) - 1;
            }

            var startRow = (pageNumber * quantityPerPage);
            var finalRow = (pageNumber * quantityPerPage) + quantityPerPage;
            if (finalRow > results.length) {
                finalRow = results.length;
            }
            startRow = finalRow - 100;
            if (startRow < 0) {
                startRow = 0;
            }

            // Appeding items
            for (var j = startRow; j < finalRow; j++) {
                if (obj.options.search == true && obj.results) {
                    obj.tbody.appendChild(obj.rows[results[j]]);
                } else {
                    obj.tbody.appendChild(obj.rows[j]);
                }

                if (obj.tbody.children.length > quantityPerPage) {
                    obj.tbody.removeChild(obj.tbody.firstChild);
                }
            }
        }

        obj.loadUp = function () {
            // Search
            if (obj.options.search == true && obj.results) {
                var results = obj.results;
            } else {
                var results = obj.rows;
            }
            var test = 0;
            if (results.length > 100) {
                // Get the first element in the page
                var item = parseInt(obj.tbody.firstChild.getAttribute('data-y'));
                if (obj.options.search == true && obj.results) {
                    item = results.indexOf(item);
                }
                if (item > 0) {
                    for (var j = 0; j < 30; j++) {
                        item = item - 1;
                        if (item > -1) {
                            if (obj.options.search == true && obj.results) {
                                obj.tbody.insertBefore(obj.rows[results[item]], obj.tbody.firstChild);
                            } else {
                                obj.tbody.insertBefore(obj.rows[item], obj.tbody.firstChild);
                            }
                            if (obj.tbody.children.length > 100) {
                                obj.tbody.removeChild(obj.tbody.lastChild);
                                test = 1;
                            }
                        }
                    }
                }
            }
            return test;
        }

        obj.loadDown = function () {
            // Search
            if (obj.options.search == true && obj.results) {
                var results = obj.results;
            } else {
                var results = obj.rows;
            }
            var test = 0;
            if (results.length > 100) {
                // Get the last element in the page
                var item = parseInt(obj.tbody.lastChild.getAttribute('data-y'));
                if (obj.options.search == true && obj.results) {
                    item = results.indexOf(item);
                }
                if (item < obj.rows.length - 1) {
                    for (var j = 0; j <= 30; j++) {
                        if (item < results.length) {
                            if (obj.options.search == true && obj.results) {
                                obj.tbody.appendChild(obj.rows[results[item]]);
                            } else {
                                obj.tbody.appendChild(obj.rows[item]);
                            }
                            if (obj.tbody.children.length > 100) {
                                obj.tbody.removeChild(obj.tbody.firstChild);
                                test = 1;
                            }
                        }
                        item = item + 1;
                    }
                }
            }

            return test;
        }

        obj.loadValidation = function () {
            if (obj.selectedCell) {
                var currentPage = parseInt(obj.tbody.firstChild.getAttribute('data-y')) / 100;
                var selectedPage = parseInt(obj.selectedCell[3] / 100);
                var totalPages = parseInt(obj.rows.length / 100);

                if (currentPage != selectedPage && selectedPage <= totalPages) {
                    if (!Array.prototype.indexOf.call(obj.tbody.children, obj.rows[obj.selectedCell[3]])) {
                        obj.loadPage(selectedPage);
                        return true;
                    }
                }
            }

            return false;
        }

        /**
         * Reset search
         */
        obj.resetSearch = function () {
            obj.searchInput.value = '';
            obj.search('');
            obj.results = null;
        }

        /**
         * Search
         */
        obj.search = function (query) {
            // Query
            if (query) {
                var query = query.toLowerCase();
            }

            // Reset any filter
            if (obj.options.filters) {
                obj.resetFilters();
            }

            // Reset selection
            obj.resetSelection();

            // Total of results
            obj.pageNumber = 0;
            obj.results = [];

            if (query) {
                // Search filter
                var search = function (item, query, index) {
                    for (var i = 0; i < item.length; i++) {
                        if (('' + item[i]).toLowerCase().search(query) >= 0 ||
                            ('' + obj.records[index][i].innerHTML).toLowerCase().search(query) >= 0) {
                            return true;
                        }
                    }
                    return false;
                }

                // Result
                var addToResult = function (k) {
                    if (obj.results.indexOf(k) == -1) {
                        obj.results.push(k);
                    }
                }

                // Filter
                var data = obj.options.data.filter(function (v, k) {
                    if (search(v, query, k)) {
                        // Merged rows found
                        var rows = obj.isRowMerged(k);
                        if (rows.length) {
                            for (var i = 0; i < rows.length; i++) {
                                var row = jexcel.getIdFromColumnName(rows[i], true);
                                for (var j = 0; j < obj.options.mergeCells[rows[i]][1]; j++) {
                                    addToResult(row[1] + j);
                                }
                            }
                        } else {
                            // Normal row found
                            addToResult(k);
                        }
                        return true;
                    } else {
                        return false;
                    }
                });
            } else {
                obj.results = null;
            }

            return obj.updateResult();
        }

        obj.updateResult = function () {
            var total = 0;
            var index = 0;

            // Page 1
            if (obj.options.lazyLoading == true) {
                total = 100;
            } else if (obj.options.pagination > 0) {
                total = obj.options.pagination;
            } else {
                if (obj.results) {
                    total = obj.results.length;
                } else {
                    total = obj.rows.length;
                }
            }

            // Reset current nodes
            while (obj.tbody.firstChild) {
                obj.tbody.removeChild(obj.tbody.firstChild);
            }

            // Hide all records from the table
            for (var j = 0; j < obj.rows.length; j++) {
                if (!obj.results || obj.results.indexOf(j) > -1) {
                    if (index < total) {
                        obj.tbody.appendChild(obj.rows[j]);
                        index++;
                    }
                    obj.rows[j].style.display = '';
                } else {
                    obj.rows[j].style.display = 'none';
                }
            }

            // Update pagination
            if (obj.options.pagination > 0) {
                obj.updatePagination();
            }

            obj.updateCornerPosition();

            return total;
        }

        /**
         * Which page the cell is
         */
        obj.whichPage = function (cell) {
            // Search
            if (obj.options.search == true && obj.results) {
                cell = obj.results.indexOf(cell);
            }

            return (Math.ceil((parseInt(cell) + 1) / parseInt(obj.options.pagination))) - 1;
        }

        /**
         * Go to page
         */
        obj.page = function (pageNumber) {
            var oldPage = obj.pageNumber;

            // Search
            if (obj.options.search == true && obj.results) {
                var results = obj.results;
            } else {
                var results = obj.rows;
            }

            // Per page
            var quantityPerPage = parseInt(obj.options.pagination);

            // pageNumber
            if (pageNumber == null || pageNumber == -1) {
                // Last page
                pageNumber = Math.ceil(results.length / quantityPerPage) - 1;
            }

            // Page number
            obj.pageNumber = pageNumber;

            var startRow = (pageNumber * quantityPerPage);
            var finalRow = (pageNumber * quantityPerPage) + quantityPerPage;
            if (finalRow > results.length) {
                finalRow = results.length;
            }
            if (startRow < 0) {
                startRow = 0;
            }

            // Reset container
            while (obj.tbody.firstChild) {
                obj.tbody.removeChild(obj.tbody.firstChild);
            }

            // Appeding items
            for (var j = startRow; j < finalRow; j++) {
                if (obj.options.search == true && obj.results) {
                    obj.tbody.appendChild(obj.rows[results[j]]);
                } else {
                    obj.tbody.appendChild(obj.rows[j]);
                }
            }

            if (obj.options.pagination > 0) {
                obj.updatePagination();
            }

            // Update corner position
            obj.updateCornerPosition();

            // Events
            obj.dispatch('onchangepage', el, pageNumber, oldPage);
        }

        /**
         * Update the pagination
         */
        obj.updatePagination = function () {
            // Reset container
            obj.pagination.children[0].innerHTML = '';
            obj.pagination.children[1].innerHTML = '';

            // Start pagination
            if (obj.options.pagination) {
                // Searchable
                if (obj.options.search == true && obj.results) {
                    var results = obj.results.length;
                } else {
                    var results = obj.rows.length;
                }

                if (!results) {
                    // No records found
                    obj.pagination.children[0].innerHTML = obj.options.text.noRecordsFound;
                } else {
                    // Pagination container
                    var quantyOfPages = Math.ceil(results / obj.options.pagination);

                    if (obj.pageNumber < 6) {
                        var startNumber = 1;
                        var finalNumber = quantyOfPages < 10 ? quantyOfPages : 10;
                    } else if (quantyOfPages - obj.pageNumber < 5) {
                        var startNumber = quantyOfPages - 9;
                        var finalNumber = quantyOfPages;
                        if (startNumber < 1) {
                            startNumber = 1;
                        }
                    } else {
                        var startNumber = obj.pageNumber - 4;
                        var finalNumber = obj.pageNumber + 5;
                    }

                    // First
                    if (startNumber > 1) {
                        var paginationItem = document.createElement('div');
                        paginationItem.className = 'jexcel_page';
                        paginationItem.innerHTML = '<';
                        paginationItem.title = 1;
                        obj.pagination.children[1].appendChild(paginationItem);
                    }

                    // Get page links
                    for (var i = startNumber; i <= finalNumber; i++) {
                        var paginationItem = document.createElement('div');
                        paginationItem.className = 'jexcel_page';
                        paginationItem.innerHTML = i;
                        obj.pagination.children[1].appendChild(paginationItem);

                        if (obj.pageNumber == (i - 1)) {
                            paginationItem.classList.add('jexcel_page_selected');
                        }
                    }

                    // Last
                    if (finalNumber < quantyOfPages) {
                        var paginationItem = document.createElement('div');
                        paginationItem.className = 'jexcel_page';
                        paginationItem.innerHTML = '>';
                        paginationItem.title = quantyOfPages;
                        obj.pagination.children[1].appendChild(paginationItem);
                    }

                    // Text
                    var format = function (format) {
                        var args = Array.prototype.slice.call(arguments, 1);
                        return format.replace(/{(\d+)}/g, function (match, number) {
                            return typeof args[number] != 'undefined'
                                ? args[number]
                                : match
                                ;
                        });
                    };

                    obj.pagination.children[0].innerHTML = format(obj.options.text.showingPage, obj.pageNumber + 1, quantyOfPages)
                }
            }
        }

        /**
         * Download CSV table
         *
         * @return null
         */
        obj.download = function (includeHeaders) {
            if (obj.options.allowExport == false) {
                console.error('Export not allowed');
            } else {
                // Data
                var data = '';
                if (includeHeaders == true || obj.options.includeHeadersOnDownload == true) {
                    data += obj.getHeaders().replace(/\s+/gm, ' ');
                    data += "\r\n";
                }

                // Get data
                data += obj.copy(false, obj.options.csvDelimiter, true);

                // Download element
                var blob = new Blob(["\uFEFF" + data], {type: 'text/csv;charset=utf-8;'});

                // IE Compatibility
                if (window.navigator && window.navigator.msSaveOrOpenBlob) {
                    window.navigator.msSaveOrOpenBlob(blob, obj.options.csvFileName + '.csv');
                } else {
                    // Download element
                    var pom = document.createElement('a');
                    var url = URL.createObjectURL(blob);
                    pom.href = url;
                    pom.setAttribute('download', obj.options.csvFileName + '.csv');
                    document.body.appendChild(pom);
                    pom.click();
                    pom.parentNode.removeChild(pom);
                }
            }
        }

        /**
         * Initializes a new history record for undo/redo
         *
         * @return null
         */
        obj.setHistory = function (changes) {
            if (obj.ignoreHistory != true) {
                // Increment and get the current history index
                var index = ++obj.historyIndex;

                // Slice the array to discard undone changes
                obj.history = (obj.history = obj.history.slice(0, index + 1));

                // changes = obj.dispatch('onsethistory', changes);

                // Keep history
                obj.history[index] = changes;
            }
        }

        /**
         * Copy method
         *
         * @param bool highlighted - Get only highlighted cells
         * @param delimiter - \t default to keep compatibility with excel
         * @return string value
         */
        obj.copy = function (highlighted, delimiter, returnData) {
            if (!delimiter) {
                delimiter = "\t";
            }

            // Controls
            var header = [];
            var col = [];
            var colLabel = [];
            var row = [];
            var rowLabel = [];
            var x = obj.options.data[0].length
            var y = obj.options.data.length
            var tmp = '';
            var copyHeader = obj.options.includeHeadersOnCopy;

            // Reset container
            obj.style = [];

            obj.dispatch('onbeforecopy');

            // Go through the columns to get the data
            for (var j = 0; j < y; j++) {
                col = [];
                colLabel = [];

                for (var i = 0; i < x; i++) {
                    // If cell is highlighted
                    if (!highlighted || obj.records[j][i].classList.contains('highlight')) {
                        if (copyHeader == true) {
                            header.push(obj.headers[i].innerText);
                        }
                        // Values
                        var value = obj.options.data[j][i];

                        if (typeof value === 'object') {
                            value = JSON.stringify(value);
                        }

                        if (value.match && (value.match(/,/g) || value.match(/\n/) || value.match(/\"/))) {
                            value = value.replace(new RegExp('"', 'g'), '""');
                            value = '"' + value + '"';
                        }

                        col.push(value);

                        obj.dispatch('oncopying', value, i, j);

                        // Labels
                        if (obj.options.columns[i].type == 'checkbox' || obj.options.columns[i].type == 'radio') {
                            var label = value;
                        } else {
                            if (obj.options.stripHTMLOnCopy == true) {
                                var label = obj.records[j][i].innerText;
                            } else {
                                var label = obj.records[j][i].innerHTML;
                            }
                            if (label.match && (label.match(/,/g) || label.match(/\n/) || label.match(/\"/))) {
                                // Scape double quotes
                                label = label.replace(new RegExp('"', 'g'), '""');
                                label = '"' + label + '"';
                            }
                        }
                        colLabel.push(label);

                        // Get style
                        tmp = obj.records[j][i].getAttribute('style');
                        tmp = tmp.replace('display: none;', '');
                        obj.style.push(tmp ? tmp : '');
                    }
                }

                if (col.length) {
                    if (copyHeader) {
                        row.push(header.join(delimiter));
                    }
                    row.push(col.join(delimiter));
                }

                if (colLabel.length) {
                    if (copyHeader) {
                        rowLabel.push(header.join(delimiter));
                    }
                    rowLabel.push(colLabel.join(delimiter));
                }
                copyHeader = false;
            }

            // Final string
            var str = row.join("\r\n");
            var strLabel = rowLabel.join("\r\n");

            // Create a hidden textarea to copy the values
            if (!returnData) {
                if (obj.options.copyCompatibility == true) {
                    obj.textarea.value = strLabel;
                } else {
                    obj.textarea.value = str;
                }
                obj.textarea.select();
                document.execCommand("copy");
            }

            // Keep data
            if (obj.options.copyCompatibility == true) {
                obj.data = strLabel;
            } else {
                obj.data = str;
            }
            // Keep non visible information
            obj.hashString = obj.hash(obj.data);

            // Any exiting border should go
            obj.removeCopyingSelection();

            // Border
            if (obj.highlighted) {
                for (var i = 0; i < obj.highlighted.length; i++) {
                    obj.highlighted[i].classList.add('copying');
                    if (obj.highlighted[i].classList.contains('highlight-left')) {
                        obj.highlighted[i].classList.add('copying-left');
                    }
                    if (obj.highlighted[i].classList.contains('highlight-right')) {
                        obj.highlighted[i].classList.add('copying-right');
                    }
                    if (obj.highlighted[i].classList.contains('highlight-top')) {
                        obj.highlighted[i].classList.add('copying-top');
                    }
                    if (obj.highlighted[i].classList.contains('highlight-bottom')) {
                        obj.highlighted[i].classList.add('copying-bottom');
                    }
                }
            }

            // Paste event
            obj.dispatch('oncopy', el, obj.options.copyCompatibility == true ? rowLabel : row, obj.hashString);

            return obj.data;
        }

        /**
         * jExcel paste method
         *
         * @param integer row number
         * @return string value
         */
        // obj.paste = function(x, y, data) {
        obj.paste = function (selectedCell, data) {
            // Paste filter
            // var ret = obj.dispatch('onbeforepaste', el, data, x, y);
            //
            // if (ret === false) {
            //     return false;
            // } else if (ret) {
            //     var data = ret;
            // }

            var x = selectedCell[0],
                y = selectedCell[1],
                w = selectedCell[2] - x + 1,
                h = selectedCell[3] - y + 1;

            // change paste range if select is from right to left
            if (selectedCell[2] < selectedCell[0]) {
                x = selectedCell[2];
                w = selectedCell[0] - x + 1;
            }
            // change paste range if select is from down to up
            if (selectedCell[3] < selectedCell[1]) {
                y = selectedCell[3];
                h = selectedCell[1] - y + 1;
            }

            if (typeof (obj.options.onbeforepaste) == 'function') {
                var data = obj.options.onbeforepaste(data, selectedCell);
            }

            if (!data) {
                obj.removeCopyingSelection();
                return;
            }

            // Controls
            var hash = obj.hash(data);
            var style = (hash == obj.hashString) ? obj.style : null;

            // Depending on the behavior
            if (obj.options.copyCompatibility == true && hash == obj.hashString) {
                var data = obj.data;
            }

            // Split new line
            var data = obj.parseCSV(data, "\t");

            if (w > 1 & Number.isInteger(w / data[0].length)) {
                style = null;
                repeats = w / data[0].length;

                var arrayB = data.map(function (row, i) {
                    var arrayC = Array.apply(null, {length: repeats * row.length})
                        .map(function (e, i) {
                            return row[i % row.length]
                        });
                    return arrayC
                });
                data = arrayB;

            }
            if (h > 1 & Number.isInteger(h / data.length)) {
                style = null;
                var repeats = h / data.length;
                var arrayB = Array.apply(null, {length: repeats * data.length})
                    .map(function (e, i) {
                        return data[i % data.length]
                    });
                data = arrayB;
            }

            if (x != null && y != null && data) {
                // Records
                var i = 0;
                var j = 0;
                var records = [];
                var newStyle = {};
                var oldStyle = {};
                var styleIndex = 0;

                // Index
                var colIndex = parseInt(x);
                var rowIndex = parseInt(y);
                var row = null;

                // Go through the columns to get the data
                while (row = data[j]) {
                    i = 0;
                    colIndex = parseInt(x);

                    while (row[i] != null) {

                        try {
                            let isObject = JSON.parse(row[i]);
                            if (isObject) row[i] = isObject;
                        } catch (e) {
                        }

                        // Update and keep history
                        var record = obj.updateCell(colIndex, rowIndex, row[i]);
                        // Keep history
                        records.push(record);
                        // Update all formulas in the chain
                        obj.updateFormulaChain(colIndex, rowIndex, records);
                        // Style
                        if (style && style[styleIndex]) {
                            var columnName = jexcel.getColumnNameFromId([colIndex, rowIndex]);
                            newStyle[columnName] = style[styleIndex];
                            oldStyle[columnName] = obj.getStyle(columnName);
                            obj.records[rowIndex][colIndex].setAttribute('style', style[styleIndex]);
                            styleIndex++
                        }
                        i++;
                        if (row[i] != null) {
                            if (colIndex >= obj.headers.length - 1) {
                                obj.insertColumn();
                            }
                            colIndex = obj.right.get(colIndex, rowIndex);
                        }
                    }

                    j++;
                    if (data[j]) {
                        if (rowIndex >= obj.rows.length - 1) {
                            obj.insertRow();
                        }
                        rowIndex = obj.down.get(x, rowIndex);
                    }
                }

                // Select the new cells
                obj.updateSelectionFromCoords(x, y, colIndex, rowIndex);

                // Update history
                obj.setHistory({
                    action: 'setValue',
                    records: records,
                    selection: obj.selectedCell,
                    newStyle: newStyle,
                    oldStyle: oldStyle,
                });

                // Update table
                obj.updateTable();

                // Paste event
                obj.dispatch('onpaste', el, data);

                // On after changes
                obj.onafterchanges(el, records);
            }

            obj.removeCopyingSelection();
        }

        /**
         * Remove copying border
         */
        obj.removeCopyingSelection = function () {
            var copying = document.querySelectorAll('.jexcel .copying');
            for (var i = 0; i < copying.length; i++) {
                copying[i].classList.remove('copying');
                copying[i].classList.remove('copying-left');
                copying[i].classList.remove('copying-right');
                copying[i].classList.remove('copying-top');
                copying[i].classList.remove('copying-bottom');
            }
        }

        /**
         * Process row
         */
        obj.historyProcessRow = function (type, historyRecord) {
            var rowIndex = (!historyRecord.insertBefore) ? historyRecord.rowNumber + 1 : historyRecord.rowNumber;

            if (obj.options.search == true) {
                if (obj.results && obj.results.length != obj.rows.length) {
                    obj.resetSearch();
                }
            }

            // Remove row
            if (type == 1) {
                var numOfRows = historyRecord.numOfRows;
                // Remove nodes
                for (var j = rowIndex; j < (numOfRows + rowIndex); j++) {
                    obj.rows[j].parentNode.removeChild(obj.rows[j]);
                }
                // Remove references
                obj.records.splice(rowIndex, numOfRows);
                obj.options.data.splice(rowIndex, numOfRows);
                obj.rows.splice(rowIndex, numOfRows);

                obj.conditionalSelectionUpdate(1, rowIndex, (numOfRows + rowIndex) - 1);
            } else {
                // Insert data
                obj.records = jexcel.injectArray(obj.records, rowIndex, historyRecord.rowRecords);
                obj.options.data = jexcel.injectArray(obj.options.data, rowIndex, historyRecord.rowData);
                obj.rows = jexcel.injectArray(obj.rows, rowIndex, historyRecord.rowNode);
                // Insert nodes
                var index = 0
                for (var j = rowIndex; j < (historyRecord.numOfRows + rowIndex); j++) {
                    obj.tbody.insertBefore(historyRecord.rowNode[index], obj.tbody.children[j]);
                    index++;
                }
            }

            // Respect pagination
            if (obj.options.pagination > 0) {
                obj.page(obj.pageNumber);
            }

            obj.updateTableReferences();
        }

        /**
         * Process column
         */
        obj.historyProcessColumn = function (type, historyRecord) {
            var columnIndex = (!historyRecord.insertBefore) ? historyRecord.columnNumber + 1 : historyRecord.columnNumber;

            // Remove column
            if (type == 1) {
                var numOfColumns = historyRecord.numOfColumns;

                obj.options.columns.splice(columnIndex, numOfColumns);
                for (var i = columnIndex; i < (numOfColumns + columnIndex); i++) {
                    obj.headers[i].parentNode.removeChild(obj.headers[i]);
                    obj.colgroup[i].parentNode.removeChild(obj.colgroup[i]);
                }
                obj.headers.splice(columnIndex, numOfColumns);
                obj.colgroup.splice(columnIndex, numOfColumns);
                for (var j = 0; j < historyRecord.data.length; j++) {
                    for (var i = columnIndex; i < (numOfColumns + columnIndex); i++) {
                        obj.records[j][i].parentNode.removeChild(obj.records[j][i]);
                    }
                    obj.records[j].splice(columnIndex, numOfColumns);
                    obj.options.data[j].splice(columnIndex, numOfColumns);
                }
                // Process footers
                if (obj.options.footers) {
                    for (var j = 0; j < obj.options.footers.length; j++) {
                        obj.options.footers[j].splice(columnIndex, numOfColumns);
                    }
                }
            } else {
                // Insert data
                obj.options.columns = jexcel.injectArray(obj.options.columns, columnIndex, historyRecord.columns);
                obj.headers = jexcel.injectArray(obj.headers, columnIndex, historyRecord.headers);
                obj.colgroup = jexcel.injectArray(obj.colgroup, columnIndex, historyRecord.colgroup);

                var index = 0
                for (var i = columnIndex; i < (historyRecord.numOfColumns + columnIndex); i++) {
                    obj.headerContainer.insertBefore(historyRecord.headers[index], obj.headerContainer.children[i + 1]);
                    obj.colgroupContainer.insertBefore(historyRecord.colgroup[index], obj.colgroupContainer.children[i + 1]);
                    index++;
                }

                for (var j = 0; j < historyRecord.data.length; j++) {
                    obj.options.data[j] = jexcel.injectArray(obj.options.data[j], columnIndex, historyRecord.data[j]);
                    obj.records[j] = jexcel.injectArray(obj.records[j], columnIndex, historyRecord.records[j]);
                    var index = 0
                    for (var i = columnIndex; i < (historyRecord.numOfColumns + columnIndex); i++) {
                        obj.rows[j].insertBefore(historyRecord.records[j][index], obj.rows[j].children[i + 1]);
                        index++;
                    }
                }
                // Process footers
                if (obj.options.footers) {
                    for (var j = 0; j < obj.options.footers.length; j++) {
                        obj.options.footers[j] = jexcel.injectArray(obj.options.footers[j], columnIndex, historyRecord.footers[j]);
                    }
                }
            }

            // Adjust nested headers
            if (obj.options.nestedHeaders && obj.options.nestedHeaders.length > 0) {
                // Flexible way to handle nestedheaders
                if (obj.options.nestedHeaders[0] && obj.options.nestedHeaders[0][0]) {
                    for (var j = 0; j < obj.options.nestedHeaders.length; j++) {
                        if (type == 1) {
                            var colspan = parseInt(obj.options.nestedHeaders[j][obj.options.nestedHeaders[j].length - 1].colspan) - historyRecord.numOfColumns;
                        } else {
                            var colspan = parseInt(obj.options.nestedHeaders[j][obj.options.nestedHeaders[j].length - 1].colspan) + historyRecord.numOfColumns;
                        }
                        obj.options.nestedHeaders[j][obj.options.nestedHeaders[j].length - 1].colspan = colspan;
                        obj.thead.children[j].children[obj.thead.children[j].children.length - 1].setAttribute('colspan', colspan);
                    }
                } else {
                    if (type == 1) {
                        var colspan = parseInt(obj.options.nestedHeaders[0].colspan) - historyRecord.numOfColumns;
                    } else {
                        var colspan = parseInt(obj.options.nestedHeaders[0].colspan) + historyRecord.numOfColumns;
                    }
                    obj.options.nestedHeaders[0].colspan = colspan;
                    obj.thead.children[0].children[obj.thead.children[0].children.length - 1].setAttribute('colspan', colspan);
                }
            }

            obj.updateTableReferences();
        }

        /**
         * Undo last action
         */
        obj.undo = function () {
            // Ignore events and history
            var ignoreEvents = obj.ignoreEvents ? true : false;
            var ignoreHistory = obj.ignoreHistory ? true : false;

            obj.ignoreEvents = true;
            obj.ignoreHistory = true;

            // Records
            var records = [];

            // Update cells
            if (obj.historyIndex >= 0) {
                // History
                var historyRecord = obj.history[obj.historyIndex--];

                if (historyRecord.action == 'insertRow') {
                    obj.historyProcessRow(1, historyRecord);
                } else if (historyRecord.action == 'deleteRow') {
                    obj.historyProcessRow(0, historyRecord);
                } else if (historyRecord.action == 'insertColumn') {
                    obj.historyProcessColumn(1, historyRecord);
                } else if (historyRecord.action == 'deleteColumn') {
                    obj.historyProcessColumn(0, historyRecord);
                } else if (historyRecord.action == 'moveRow') {
                    obj.moveRow(historyRecord.newValue, historyRecord.oldValue);
                } else if (historyRecord.action == 'moveColumn') {
                    obj.moveColumn(historyRecord.newValue, historyRecord.oldValue);
                } else if (historyRecord.action == 'setMerge') {
                    obj.removeMerge(historyRecord.column, historyRecord.data);
                } else if (historyRecord.action == 'setStyle') {
                    obj.setStyle(historyRecord.oldValue, null, null, 1);
                } else if (historyRecord.action == 'setWidth') {
                    obj.setWidth(historyRecord.column, historyRecord.oldValue);
                } else if (historyRecord.action == 'setHeight') {
                    obj.setHeight(historyRecord.row, historyRecord.oldValue);
                } else if (historyRecord.action == 'setHeader') {
                    obj.setHeader(historyRecord.column, historyRecord.oldValue);
                } else if (historyRecord.action == 'setComments') {
                    obj.setComments(historyRecord.column, historyRecord.oldValue[0], historyRecord.oldValue[1]);
                } else if (historyRecord.action == 'orderBy') {
                    var rows = [];
                    for (var j = 0; j < historyRecord.rows.length; j++) {
                        rows[historyRecord.rows[j]] = j;
                    }
                    obj.updateOrderArrow(historyRecord.column, historyRecord.order ? 0 : 1);
                    obj.updateOrder(rows);
                } else if (historyRecord.action == 'setValue') {
                    // Redo for changes in cells
                    for (var i = 0; i < historyRecord.records.length; i++) {
                        records.push({
                            x: historyRecord.records[i].x,
                            y: historyRecord.records[i].y,
                            newValue: historyRecord.records[i].oldValue,
                        });

                        if (historyRecord.oldStyle) {
                            obj.resetStyle(historyRecord.oldStyle);
                        }
                    }
                    // Update records
                    obj.setValue(records);

                    // Update selection
                    if (historyRecord.selection) {
                        obj.updateSelectionFromCoords(historyRecord.selection[0], historyRecord.selection[1], historyRecord.selection[2], historyRecord.selection[3]);
                    }
                }
            }
            obj.ignoreEvents = ignoreEvents;
            obj.ignoreHistory = ignoreHistory;

            // Events
            obj.dispatch('onundo', el, historyRecord);
        }

        /**
         * Redo previously undone action
         */
        obj.redo = function () {
            // Ignore events and history
            var ignoreEvents = obj.ignoreEvents ? true : false;
            var ignoreHistory = obj.ignoreHistory ? true : false;

            obj.ignoreEvents = true;
            obj.ignoreHistory = true;

            // Records
            var records = [];

            // Update cells
            if (obj.historyIndex < obj.history.length - 1) {
                // History
                var historyRecord = obj.history[++obj.historyIndex];

                if (historyRecord.action == 'insertRow') {
                    obj.historyProcessRow(0, historyRecord);
                } else if (historyRecord.action == 'deleteRow') {
                    obj.historyProcessRow(1, historyRecord);
                } else if (historyRecord.action == 'insertColumn') {
                    obj.historyProcessColumn(0, historyRecord);
                } else if (historyRecord.action == 'deleteColumn') {
                    obj.historyProcessColumn(1, historyRecord);
                } else if (historyRecord.action == 'moveRow') {
                    obj.moveRow(historyRecord.oldValue, historyRecord.newValue);
                } else if (historyRecord.action == 'moveColumn') {
                    obj.moveColumn(historyRecord.oldValue, historyRecord.newValue);
                } else if (historyRecord.action == 'setMerge') {
                    obj.setMerge(historyRecord.column, historyRecord.colspan, historyRecord.rowspan, 1);
                } else if (historyRecord.action == 'setStyle') {
                    obj.setStyle(historyRecord.newValue, null, null, 1);
                } else if (historyRecord.action == 'setWidth') {
                    obj.setWidth(historyRecord.column, historyRecord.newValue);
                } else if (historyRecord.action == 'setHeight') {
                    obj.setHeight(historyRecord.row, historyRecord.newValue);
                } else if (historyRecord.action == 'setHeader') {
                    obj.setHeader(historyRecord.column, historyRecord.newValue);
                } else if (historyRecord.action == 'setComments') {
                    obj.setComments(historyRecord.column, historyRecord.newValue[0], historyRecord.newValue[1]);
                } else if (historyRecord.action == 'orderBy') {
                    obj.updateOrderArrow(historyRecord.column, historyRecord.order);
                    obj.updateOrder(historyRecord.rows);
                } else if (historyRecord.action == 'setValue') {
                    obj.setValue(historyRecord.records);
                    // Redo for changes in cells
                    for (var i = 0; i < historyRecord.records.length; i++) {
                        if (historyRecord.oldStyle) {
                            obj.resetStyle(historyRecord.newStyle);
                        }
                    }
                    // Update selection
                    if (historyRecord.selection) {
                        obj.updateSelectionFromCoords(historyRecord.selection[0], historyRecord.selection[1], historyRecord.selection[2], historyRecord.selection[3]);
                    }
                }
            }
            obj.ignoreEvents = ignoreEvents;
            obj.ignoreHistory = ignoreHistory;

            // Events
            obj.dispatch('onredo', el, historyRecord);
        }

        /**
         * Get dropdown value from key
         */
        obj.getDropDownValue = function (column, key, y, cell) {
            var value = [];

            if (obj.options.columns[column] && obj.options.columns[column].source) {
                if (typeof obj.options.columns[column].filter === 'function') {
                    var source = obj.options.columns[column].filter(el, cell, column, y, obj);
                } else {
                    var source = obj.options.columns[column].source;
                }
                // Create array from source
                var combo = [];

                for (var i = 0; i < source.length; i++) {
                    if (typeof (source[i]) == 'object') {
                        combo[source[i].id] = source[i].name;
                    } else {
                        combo[source[i]] = source[i];
                    }
                }

                // Guarantee single multiple compatibility
                var keys = Array.isArray(key) ? key : ('' + key).split(';');
                for (var i = 0; i < keys.length; i++) {
                    if (typeof (keys[i]) === 'object') {
                        value.push(combo[keys[i].id]);
                    } else {
                        if (combo[keys[i]]) {
                            value.push(combo[keys[i]]);
                        }
                    }
                }
            } else {
                console.error('Invalid column');
            }

            return (value.length > 0) ? value.join('; ') : '';
        }

        /**
         * From starckoverflow contributions
         */
        obj.parseCSV = function (str, delimiter) {
            // Remove last line break
            str = str.replace(/\r?\n$|\r$|\n$/g, "");
            // Last caracter is the delimiter
            if (str.charCodeAt(str.length - 1) == 9) {
                str += "\0";
            }
            // user-supplied delimeter or default comma
            delimiter = (delimiter || ",");

            var arr = [];
            var quote = false;  // true means we're inside a quoted field
            // iterate over each character, keep track of current row and column (of the returned array)
            for (var row = 0, col = 0, c = 0; c < str.length; c++) {
                var cc = str[c], nc = str[c + 1];
                arr[row] = arr[row] || [];
                arr[row][col] = arr[row][col] || '';

                // If the current character is a quotation mark, and we're inside a quoted field, and the next character is also a quotation mark, add a quotation mark to the current column and skip the next character
                if (cc == '"' && quote && nc == '"') {
                    arr[row][col] += cc;
                    ++c;
                    continue;
                }

                // If it's just one quotation mark, begin/end quoted field
                if (cc == '"') {
                    quote = !quote;
                    continue;
                }

                // If it's a comma and we're not in a quoted field, move on to the next column
                if (cc == delimiter && !quote) {
                    ++col;
                    continue;
                }

                // If it's a newline (CRLF) and we're not in a quoted field, skip the next character and move on to the next row and move to column 0 of that new row
                if (cc == '\r' && nc == '\n' && !quote) {
                    ++row;
                    col = 0;
                    ++c;
                    continue;
                }

                // If it's a newline (LF or CR) and we're not in a quoted field, move on to the next row and move to column 0 of that new row
                if (cc == '\n' && !quote) {
                    ++row;
                    col = 0;
                    continue;
                }
                if (cc == '\r' && !quote) {
                    ++row;
                    col = 0;
                    continue;
                }

                // Otherwise, append the current character to the current column
                arr[row][col] += cc;
            }
            return arr;
        }

        obj.hash = function (str) {
            var hash = 0, i, chr;

            if (str.length === 0) {
                return hash;
            } else {
                for (i = 0; i < str.length; i++) {
                    chr = str.charCodeAt(i);
                    hash = ((hash << 5) - hash) + chr;
                    hash |= 0;
                }
            }
            return hash;
        }

        obj.onafterchanges = function (el, records) {
            // Events
            obj.dispatch('onafterchanges', el, records);
        }

        obj.destroy = function () {
            jexcel.destroy(el);
        }

        /**
         * Initialization method
         */
        obj.init = function () {
            jexcel.current = obj;

            // Build handlers
            if (typeof (jexcel.build) == 'function') {
                if (obj.options.root) {
                    jexcel.build(obj.options.root);
                } else {
                    jexcel.build(document);
                    jexcel.build = null;
                }
            }

            // Event
            el.setAttribute('tabindex', 1);
            el.addEventListener('focus', function (e) {
                if (jexcel.current && !obj.selectedCell) {
                    obj.updateSelectionFromCoords(0, 0, 0, 0);
                    obj.left();
                }
            });

            // Load the table data based on an CSV file
            if (obj.options.csv) {
                // Loading
                if (obj.options.loadingSpin == true) {
                    jSuites.loading.show();
                }

                // Load CSV file
                jSuites.ajax({
                    url: obj.options.csv,
                    method: obj.options.method,
                    data: obj.options.requestVariables,
                    dataType: 'text',
                    success: function (result) {
                        // Convert data
                        var newData = obj.parseCSV(result, obj.options.csvDelimiter)

                        // Headers
                        if (obj.options.csvHeaders == true && newData.length > 0) {
                            var headers = newData.shift();
                            for (var i = 0; i < headers.length; i++) {
                                if (!obj.options.columns[i]) {
                                    obj.options.columns[i] = {type: 'text', align: obj.options.defaultColAlign, width: obj.options.defaultColWidth};
                                }
                                // Precedence over pre-configurated titles
                                if (typeof obj.options.columns[i].title === 'undefined') {
                                    obj.options.columns[i].title = headers[i];
                                }
                            }
                        }
                        // Data
                        obj.options.data = newData;
                        // Prepare table
                        obj.prepareTable();
                        // Hide spin
                        if (obj.options.loadingSpin == true) {
                            jSuites.loading.hide();
                        }
                    }
                });
            } else if (obj.options.url) {
                // Loading
                if (obj.options.loadingSpin == true) {
                    jSuites.loading.show();
                }

                jSuites.ajax({
                    url: obj.options.url,
                    method: obj.options.method,
                    data: obj.options.requestVariables,
                    dataType: 'json',
                    success: function (result) {
                        // Data
                        obj.options.data = (result.data) ? result.data : result;
                        // Prepare table
                        obj.prepareTable();
                        // Hide spin
                        if (obj.options.loadingSpin == true) {
                            jSuites.loading.hide();
                        }
                    }
                });
            } else {
                // Prepare table
                obj.prepareTable();
            }
        }

        // Context menu
        if (options && options.contextMenu != null) {
            obj.options.contextMenu = options.contextMenu;
        } else {
            obj.options.contextMenu = function (el, x, y, e) {
                var items = [];

                if (options && typeof options.contextMenuItems === 'function') {
                    items = options.contextMenuItems(items, el, x, y, e);
                }

                if (y == null) {
                    // Insert a new column
                    if (obj.options.allowInsertColumn == true) {
                        items.push({
                            title: obj.options.text.insertANewColumnBefore,
                            onclick: function () {
                                obj.insertColumn(1, parseInt(x), 1);
                            }
                        });
                    }

                    if (obj.options.allowInsertColumn == true) {
                        items.push({
                            title: obj.options.text.insertANewColumnAfter,
                            onclick: function () {
                                obj.insertColumn(1, parseInt(x), 0);
                            }
                        });
                    }

                    // Delete a column
                    if (obj.options.allowDeleteColumn == true) {
                        items.push({
                            title: obj.options.text.deleteSelectedColumns,
                            onclick: function () {
                                obj.deleteColumn(obj.getSelectedColumns().length ? undefined : parseInt(x));
                            }
                        });
                    }

                    // Rename column
                    if (obj.options.allowRenameColumn == true) {
                        items.push({
                            title: obj.options.text.renameThisColumn,
                            onclick: function () {
                                obj.setHeader(x);
                            }
                        });
                    }

                    // Sorting
                    if (obj.options.columnSorting == true) {
                        // Line
                        items.push({type: 'line'});

                        items.push({
                            title: obj.options.text.orderAscending,
                            onclick: function () {
                                obj.orderBy(x, 0);
                            }
                        });
                        items.push({
                            title: obj.options.text.orderDescending,
                            onclick: function () {
                                obj.orderBy(x, 1);
                            }
                        });
                    }
                } else {
                    // Insert new row
                    if (obj.options.allowInsertRow == true) {
                        items.push({
                            title: obj.options.text.insertANewRowBefore,
                            onclick: function () {
                                obj.insertRow(1, parseInt(y), 1);
                            }
                        });

                        items.push({
                            title: obj.options.text.insertANewRowAfter,
                            onclick: function () {
                                obj.insertRow(1, parseInt(y));
                            }
                        });
                    }

                    if (obj.options.allowDeleteRow == true) {
                        items.push({
                            title: obj.options.text.deleteSelectedRows,
                            onclick: function () {
                                obj.deleteRow(obj.getSelectedRows().length ? undefined : parseInt(y));
                            }
                        });
                    }

                    if (x) {
                        if (obj.options.allowComments == true) {
                            items.push({type: 'line'});

                            var title = obj.records[y][x].getAttribute('title') || '';

                            items.push({
                                title: title ? obj.options.text.editComments : obj.options.text.addComments,
                                onclick: function () {
                                    var comment = prompt(obj.options.text.comments, title);
                                    if (comment) {
                                        obj.setComments([x, y], comment);
                                    }
                                }
                            });

                            if (title) {
                                items.push({
                                    title: obj.options.text.clearComments,
                                    onclick: function () {
                                        obj.setComments([x, y], '');
                                    }
                                });
                            }
                        }
                    }
                }

                // Line
                items.push({type: 'line'});

                // Copy
                items.push({
                    title: obj.options.text.copy,
                    shortcut: 'Ctrl + C',
                    onclick: function () {
                        obj.copy(true);
                    }
                });

                // Paste
                if (navigator && navigator.clipboard) {
                    items.push({
                        title: obj.options.text.paste,
                        shortcut: 'Ctrl + V',
                        onclick: function () {
                            if (obj.selectedCell) {
                                navigator.clipboard.readText().then(function (text) {
                                    if (text) {
                                        // jexcel.current.paste(obj.selectedCell[0], obj.selectedCell[1], text);
                                        jexcel.current.paste(jexcel.current.selectedCell, text);
                                    }
                                });
                            }
                        }
                    });
                }

                // Save
                if (obj.options.allowExport) {
                    items.push({
                        title: obj.options.text.saveAs,
                        shortcut: 'Ctrl + S',
                        onclick: function () {
                            obj.download();
                        }
                    });
                }

                // About
                if (obj.options.about) {
                    items.push({
                        title: obj.options.text.about,
                        onclick: function () {
                            alert(obj.options.about);
                        }
                    });
                }

                return items;
            }
        }

        obj.scrollControls = function (e) {
            obj.dispatch('onscroll', el);

            obj.wheelControls();
            if (obj.options.freezeColumns > 0 && obj.content.scrollLeft != scrollLeft) {
                obj.updateFreezePosition();
            }

            // Close editor
            if (obj.options.lazyLoading == true || obj.options.tableOverflow == true) {
                if (obj.edition && e.target.className.substr(0, 9) != 'jdropdown') {
                    obj.closeEditor(obj.edition[0], true);
                }
            }
        }

        obj.wheelControls = function (e) {
            if (obj.options.lazyLoading == true) {
                if (jexcel.timeControlLoading == null) {
                    jexcel.timeControlLoading = setTimeout(function () {
                        if (obj.content.scrollTop + obj.content.clientHeight >= obj.content.scrollHeight) {
                            if (obj.loadDown()) {
                                if (obj.content.scrollTop + obj.content.clientHeight > obj.content.scrollHeight - 10) {
                                    obj.content.scrollTop = obj.content.scrollTop - obj.content.clientHeight;
                                }
                                obj.updateCornerPosition();
                            }
                        } else if (obj.content.scrollTop <= obj.content.clientHeight) {
                            if (obj.loadUp()) {
                                if (obj.content.scrollTop < 10) {
                                    obj.content.scrollTop = obj.content.scrollTop + obj.content.clientHeight;
                                }
                                obj.updateCornerPosition();
                            }
                        }

                        jexcel.timeControlLoading = null;
                    }, 100);
                }
            }
        }

        // Get width of all freezed cells together
        obj.getFreezeWidth = function () {
            var width = 0;
            if (obj.options.freezeColumns > 0) {
                for (var i = 0; i < obj.options.freezeColumns; i++) {
                    width += parseInt(obj.options.columns[i].width);
                }
            }
            return width;
        }

        var scrollLeft = 0;

        obj.updateFreezePosition = function () {
            scrollLeft = obj.content.scrollLeft;
            var width = 0;
            if (scrollLeft > 50) {
                for (var i = 0; i < obj.options.freezeColumns; i++) {
                    if (i > 0) {
                        width += parseInt(obj.options.columns[i - 1].width);
                    }
                    obj.headers[i].classList.add('jexcel_freezed');
                    obj.headers[i].style.left = width + 'px';
                    for (var j = 0; j < obj.rows.length; j++) {
                        if (obj.rows[j] && obj.records[j][i]) {
                            var shifted = (scrollLeft + (i > 0 ? obj.records[j][i - 1].style.width : 0)) - 51 + 'px';
                            obj.records[j][i].classList.add('jexcel_freezed');
                            obj.records[j][i].style.left = shifted;
                        }
                    }
                }
            } else {
                for (var i = 0; i < obj.options.freezeColumns; i++) {
                    obj.headers[i].classList.remove('jexcel_freezed');
                    obj.headers[i].style.left = '';
                    for (var j = 0; j < obj.rows.length; j++) {
                        if (obj.records[j][i]) {
                            obj.records[j][i].classList.remove('jexcel_freezed');
                            obj.records[j][i].style.left = '';
                        }
                    }
                }
            }

            // Place the corner in the correct place
            obj.updateCornerPosition();
        }

        el.addEventListener("DOMMouseScroll", obj.wheelControls);
        el.addEventListener("mousewheel", obj.wheelControls);

        el.jexcel = obj;

        obj.init();

        return obj;
    });

    jexcel.current = null;
    jexcel.timeControl = null;
    jexcel.timeControlLoading = null;

    jexcel.destroy = function (element, destroyEventHandlers) {
        if (element.jexcel) {
            var root = element.jexcel.options.root ? element.jexcel.options.root : document;
            element.removeEventListener("DOMMouseScroll", element.jexcel.scrollControls);
            element.removeEventListener("mousewheel", element.jexcel.scrollControls);
            element.jexcel = null;
            element.innerHTML = '';

            if (destroyEventHandlers) {
                root.removeEventListener("mouseup", jexcel.mouseUpControls);
                root.removeEventListener("mousedown", jexcel.mouseDownControls);
                root.removeEventListener("mousemove", jexcel.mouseMoveControls);
                root.removeEventListener("mouseover", jexcel.mouseOverControls);
                root.removeEventListener("dblclick", jexcel.doubleClickControls);
                root.removeEventListener("paste", jexcel.pasteControls);
                root.removeEventListener("contextmenu", jexcel.contextMenuControls);
                root.removeEventListener("touchstart", jexcel.touchStartControls);
                root.removeEventListener("touchend", jexcel.touchEndControls);
                root.removeEventListener("touchcancel", jexcel.touchEndControls);
                document.removeEventListener("keydown", jexcel.keyDownControls);
                jexcel = null;
            }
        }
    }

    jexcel.build = function (root) {
        root.addEventListener("mouseup", jexcel.mouseUpControls);
        root.addEventListener("mousedown", jexcel.mouseDownControls);
        root.addEventListener("mousemove", jexcel.mouseMoveControls);
        root.addEventListener("mouseover", jexcel.mouseOverControls);
        root.addEventListener("dblclick", jexcel.doubleClickControls);
        root.addEventListener("paste", jexcel.pasteControls);
        root.addEventListener("contextmenu", jexcel.contextMenuControls);
        root.addEventListener("touchstart", jexcel.touchStartControls);
        root.addEventListener("touchend", jexcel.touchEndControls);
        root.addEventListener("touchcancel", jexcel.touchEndControls);
        root.addEventListener("touchmove", jexcel.touchEndControls);
        document.addEventListener("keydown", jexcel.keyDownControls);
    }

    /**
     * Events
     */
    jexcel.keyDownControls = function (e) {
        if (jexcel.current) {
            if (jexcel.current.edition) {
                if (e.which == 27) {
                    // Escape
                    if (jexcel.current.edition) {
                        // Exit without saving
                        jexcel.current.closeEditor(jexcel.current.edition[0], false);
                    }
                    e.preventDefault();
                } else if (e.which == 13) {

                    // Enter
                    if (jexcel.current.options.columns[jexcel.current.edition[2]].type == 'calendar') {
                        jexcel.current.closeEditor(jexcel.current.edition[0], true);
                    } else if (jexcel.current.options.columns[jexcel.current.edition[2]].type == 'dropdown' ||
                        jexcel.current.options.columns[jexcel.current.edition[2]].type == 'autocomplete') {
                        // Do nothing
                    } else {
                        // Alt enter -> do not close editor
                        if ((jexcel.current.options.wordWrap == true ||
                            jexcel.current.options.columns[jexcel.current.edition[2]].wordWrap == true ||
                            jexcel.current.options.data[jexcel.current.edition[3]][jexcel.current.edition[2]].length > 200) && e.altKey) {
                            // Add new line to the editor
                            var editorTextarea = jexcel.current.edition[0].children[0];
                            var editorValue = jexcel.current.edition[0].children[0].value;
                            var editorIndexOf = editorTextarea.selectionStart;
                            editorValue = editorValue.slice(0, editorIndexOf) + "\n" + editorValue.slice(editorIndexOf);
                            editorTextarea.value = editorValue;
                            editorTextarea.focus();
                            editorTextarea.selectionStart = editorIndexOf + 1;
                            editorTextarea.selectionEnd = editorIndexOf + 1;
                        } else {
                            jexcel.current.edition[0].children[0].blur();
                        }
                    }
                } else if (e.which == 9) {
                    // Tab
                    if (jexcel.current.options.columns[jexcel.current.edition[2]].type == 'calendar') {
                        jexcel.current.closeEditor(jexcel.current.edition[0], true);
                    } else {
                        jexcel.current.edition[0].children[0].blur();
                    }
                }
            }
            if (!jexcel.current.edition && jexcel.current.selectedCell) {
                // Which key
                if (e.which == 37) {
                    jexcel.current.left(e.shiftKey, e.ctrlKey);
                    e.preventDefault();
                } else if (e.which == 39) {
                    jexcel.current.right(e.shiftKey, e.ctrlKey);
                    e.preventDefault();
                } else if (e.which == 38) {
                    jexcel.current.up(e.shiftKey, e.ctrlKey);
                    e.preventDefault();
                } else if (e.which == 40) {
                    jexcel.current.down(e.shiftKey, e.ctrlKey);
                    e.preventDefault();
                } else if (e.which == 36) {
                    jexcel.current.first(e.shiftKey, e.ctrlKey);
                    e.preventDefault();
                } else if (e.which == 35) {
                    jexcel.current.last(e.shiftKey, e.ctrlKey);
                    e.preventDefault();
                } else if (e.which == 32) {
                    if (jexcel.current.options.editable == true) {
                        jexcel.current.setCheckRadioValue();
                    }
                    e.preventDefault();
                } else if (e.which == 46 || e.which == 8) {
                    // Delete
                    if (jexcel.current.options.editable == true) {
                        if (jexcel.current.selectedRow) {
                            if (jexcel.current.options.allowDeleteRow == true) {
                                if (confirm(jexcel.current.options.text.areYouSureToDeleteTheSelectedRows)) {
                                    jexcel.current.deleteRow();
                                }
                            }
                        } else if (jexcel.current.selectedHeader) {
                            if (jexcel.current.options.allowDeleteColumn == true) {
                                if (confirm(jexcel.current.options.text.areYouSureToDeleteTheSelectedColumns)) {
                                    jexcel.current.deleteColumn();
                                }
                            } else {
                                jexcel.current.setValue(jexcel.current.highlighted, '');
                            }
                        } else {
                            // Change value
                            jexcel.current.setValue(jexcel.current.highlighted, '');
                        }
                    }
                } else if (e.which == 13) {
                    // Move cursor
                    if (e.shiftKey) {
                        jexcel.current.up();
                    } else {
                        if (jexcel.current.options.allowInsertRow == true) {
                            if (jexcel.current.options.allowManualInsertRow == true) {
                                if (jexcel.current.selectedCell[1] == jexcel.current.options.data.length - 1) {
                                    // New record in case selectedCell in the last row
                                    jexcel.current.insertRow();
                                }
                            }
                        }

                        jexcel.current.down();
                    }
                    e.preventDefault();
                } else if (e.which == 9) {
                    // Tab
                    if (e.shiftKey) {
                        jexcel.current.left();
                    } else {
                        if (jexcel.current.options.allowInsertColumn == true) {
                            if (jexcel.current.options.allowManualInsertColumn == true) {
                                if (jexcel.current.selectedCell[0] == jexcel.current.options.data[0].length - 1) {
                                    // New record in case selectedCell in the last column
                                    jexcel.current.insertColumn();
                                }
                            }
                        }

                        jexcel.current.right();
                    }
                    e.preventDefault();
                } else {
                    if ((e.ctrlKey || e.metaKey) && !e.shiftKey) {
                        if (e.which == 65) {
                            // Ctrl + A
                            jexcel.current.selectAll();
                            e.preventDefault();
                        } else if (e.which == 83) {
                            // Ctrl + S
                            jexcel.current.download();
                            e.preventDefault();
                        } else if (e.which == 89) {
                            // Ctrl + Y
                            jexcel.current.redo();
                            e.preventDefault();
                        } else if (e.which == 90) {
                            // Ctrl + Z
                            jexcel.current.undo();
                            e.preventDefault();
                        } else if (e.which == 67) {
                            // Ctrl + C
                            jexcel.current.copy(true);
                            e.preventDefault();
                        } else if (e.which == 67) {
                            // Ctrl + C
                            jexcel.current.copy(true);
                            e.preventDefault();
                        } else if (e.which == 88) {
                            // Ctrl + X
                            if (jexcel.current.options.editable == true) {
                                jexcel.cutControls();
                            } else {
                                jexcel.copyControls();
                            }
                            e.preventDefault();
                        } else if (e.which == 86) {
                            // Ctrl + V
                            jexcel.pasteControls();
                        }
                    } else {
                        if (jexcel.current.selectedCell) {
                            if (jexcel.current.options.editable == true) {
                                var rowId = jexcel.current.selectedCell[1];
                                var columnId = jexcel.current.selectedCell[0];

                                // If is not readonly
                                if (jexcel.current.options.columns[columnId].type != 'readonly') {
                                    // Characters able to start a edition
                                    if (e.keyCode == 32) {
                                        // Space
                                        if (jexcel.current.options.columns[columnId].type == 'checkbox' ||
                                            jexcel.current.options.columns[columnId].type == 'radio') {
                                            e.preventDefault();
                                        } else {
                                            // Start edition
                                            jexcel.current.openEditor(jexcel.current.records[rowId][columnId], true);
                                        }
                                    } else if (e.keyCode == 113) {
                                        // Start edition with current content F2
                                        jexcel.current.openEditor(jexcel.current.records[rowId][columnId], false);
                                    } else if ((e.keyCode == 8) ||
                                        (e.keyCode >= 48 && e.keyCode <= 57) ||
                                        (e.keyCode >= 96 && e.keyCode <= 111) ||
                                        (e.keyCode >= 187 && e.keyCode <= 190) ||
                                        ((String.fromCharCode(e.keyCode) == e.key || String.fromCharCode(e.keyCode).toLowerCase() == e.key.toLowerCase()) && jexcel.validLetter(String.fromCharCode(e.keyCode)))) {
                                        // Start edition
                                        jexcel.current.openEditor(jexcel.current.records[rowId][columnId], true);
                                        // Prevent entries in the calendar
                                        if (jexcel.current.options.columns[columnId].type == 'calendar') {
                                            e.preventDefault();
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            } else {
                if (e.target.classList.contains('jexcel_search')) {
                    if (jexcel.timeControl) {
                        clearTimeout(jexcel.timeControl);
                    }

                    jexcel.timeControl = setTimeout(function () {
                        jexcel.current.search(e.target.value);
                    }, 200);
                }
            }
        }
    }

    jexcel.isMouseAction = false;

    jexcel.mouseDownControls = function (e) {
        e = e || window.event;
        if (e.buttons) {
            var mouseButton = e.buttons;
        } else if (e.button) {
            var mouseButton = e.button;
        } else {
            var mouseButton = e.which;
        }

        // if (window.viIsEditing) return;

        // Get elements
        var jexcelTable = jexcel.getElement(e.target);
        // console.log(e.target)
        if (jexcelTable[0]) {
            if (jexcel.current != jexcelTable[0].jexcel) {
                if (jexcel.current) {
                    if (jexcel.current.edition) {
                        jexcel.current.closeEditor(jexcel.current.edition[0], true);
                    }
                    jexcel.current.resetSelection();
                }
                jexcel.current = jexcelTable[0].jexcel;
            }
        } else {
            if (jexcel.current) {

                if (window.viIsEditing) return;

                if (jexcel.current.edition) {
                    jexcel.current.closeEditor(jexcel.current.edition[0], true);
                }

                jexcel.current.resetSelection(true);
                jexcel.current = null;
            }
        }

        if (jexcel.current && mouseButton == 1) {
            if (e.target.classList.contains('jexcel_selectall')) {
                if (jexcel.current) {
                    jexcel.current.selectAll();
                }
            } else if (e.target.classList.contains('jexcel_corner')) {
                if (jexcel.current.options.editable == true) {
                    jexcel.current.selectedCorner = true;
                }
            } else {
                // Header found
                if (jexcelTable[1] == 1) {
                    var columnId = e.target.getAttribute('data-x');

                    if (columnId) {
                        // Update cursor
                        var info = e.target.getBoundingClientRect();
                        if (jexcel.current.options.columnResize == true && info.width - e.offsetX < 6) {
                            // Resize helper
                            jexcel.current.resizing = {
                                mousePosition: e.pageX,
                                column: columnId,
                                width: info.width,
                            };

                            // Border indication
                            jexcel.current.headers[columnId].classList.add('resizing');
                            for (var j = 0; j < jexcel.current.records.length; j++) {
                                if (jexcel.current.records[j][columnId]) {
                                    jexcel.current.records[j][columnId].classList.add('resizing');
                                }
                            }
                        } else if (jexcel.current.options.columnDrag == true && info.height - e.offsetY < 6) {
                            if (jexcel.current.isColMerged(columnId).length) {
                                console.error('JEXCEL: This column is part of a merged cell.');
                            } else {
                                // Reset selection
                                jexcel.current.resetSelection();
                                // Drag helper
                                jexcel.current.dragging = {
                                    element: e.target,
                                    column: columnId,
                                    destination: columnId,
                                };
                                // Border indication
                                jexcel.current.headers[columnId].classList.add('dragging');
                                for (var j = 0; j < jexcel.current.records.length; j++) {
                                    if (jexcel.current.records[j][columnId]) {
                                        jexcel.current.records[j][columnId].classList.add('dragging');
                                    }
                                }
                            }
                        } else {
                            if (jexcel.current.selectedHeader && (e.shiftKey || e.ctrlKey)) {
                                var o = jexcel.current.selectedHeader;
                                var d = columnId;
                            } else {
                                // Press to rename
                                if (jexcel.current.selectedHeader == columnId && jexcel.current.options.allowRenameColumn == true) {
                                    jexcel.timeControl = setTimeout(function () {
                                        jexcel.current.setHeader(columnId);
                                    }, 800);
                                }

                                // Keep track of which header was selected first
                                jexcel.current.selectedHeader = columnId;

                                // Update selection single column
                                var o = columnId;
                                var d = columnId;
                            }

                            // Update selection
                            jexcel.current.updateSelectionFromCoords(o, 0, d, jexcel.current.options.data.length - 1);
                        }
                    } else {
                        if (e.target.parentNode.classList.contains('jexcel_nested')) {
                            if (e.target.getAttribute('data-column')) {
                                var column = e.target.getAttribute('data-column').split(',');
                                var c1 = parseInt(column[0]);
                                var c2 = parseInt(column[column.length - 1]);
                            } else {
                                var c1 = 0;
                                var c2 = jexcel.current.options.columns.length - 1;
                            }
                            jexcel.current.updateSelectionFromCoords(c1, 0, c2, jexcel.current.options.data.length - 1);
                        }
                    }
                } else {
                    jexcel.current.selectedHeader = false;
                }

                // Body found
                if (jexcelTable[1] == 2) {
                    var rowId = e.target.getAttribute('data-y');

                    if (e.target.classList.contains('jexcel_row')) {
                        var info = e.target.getBoundingClientRect();
                        if (jexcel.current.options.rowResize == true && info.height - e.offsetY < 6) {
                            // Resize helper
                            jexcel.current.resizing = {
                                element: e.target.parentNode,
                                mousePosition: e.pageY,
                                row: rowId,
                                height: info.height,
                            };
                            // Border indication
                            e.target.parentNode.classList.add('resizing');
                        } else if (jexcel.current.options.rowDrag == true && info.width - e.offsetX < 6) {
                            if (jexcel.current.isRowMerged(rowId).length) {
                                console.error('JEXCEL: This row is part of a merged cell');
                            } else if (jexcel.current.options.search == true && jexcel.current.results) {
                                console.error('JEXCEL: Please clear your search before perform this action');
                            } else {
                                // Reset selection
                                jexcel.current.resetSelection();
                                // Drag helper
                                jexcel.current.dragging = {
                                    element: e.target.parentNode,
                                    row: rowId,
                                    destination: rowId,
                                };
                                // Border indication
                                e.target.parentNode.classList.add('dragging');
                            }
                        } else {
                            if (jexcel.current.selectedRow && (e.shiftKey || e.ctrlKey)) {
                                var o = jexcel.current.selectedRow;
                                var d = rowId;
                            } else {
                                // Keep track of which header was selected first
                                jexcel.current.selectedRow = rowId;

                                // Update selection single column
                                var o = rowId;
                                var d = rowId;
                            }

                            // Update selection
                            jexcel.current.updateSelectionFromCoords(0, o, jexcel.current.options.data[0].length - 1, d);
                        }
                    } else {
                        // Jclose
                        if (e.target.classList.contains('jclose') && e.target.clientWidth - e.offsetX < 50 && e.offsetY < 50) {
                            jexcel.current.closeEditor(jexcel.current.edition[0], true);
                        } else {
                            var getCellCoords = function (element) {
                                var x = element.getAttribute('data-x');
                                var y = element.getAttribute('data-y');
                                if (x && y) {
                                    return [x, y];
                                } else {
                                    if (element.parentNode) {
                                        return getCellCoords(element.parentNode);
                                    }
                                }
                            };

                            var position = getCellCoords(e.target);
                            if (position) {

                                var columnId = position[0];
                                var rowId = position[1];

                                // Close edition
                                if (jexcel.current.edition) {
                                    if (jexcel.current.edition[2] != columnId || jexcel.current.edition[3] != rowId) {
                                        jexcel.current.closeEditor(jexcel.current.edition[0], true);
                                    }
                                }

                                if (!jexcel.current.edition) {
                                    // Update cell selection
                                    if (e.shiftKey) {
                                        jexcel.current.updateSelectionFromCoords(jexcel.current.selectedCell[0], jexcel.current.selectedCell[1], columnId, rowId);
                                    } else {
                                        jexcel.current.updateSelectionFromCoords(columnId, rowId);
                                    }
                                }

                                // No full row selected
                                jexcel.current.selectedHeader = null;
                                jexcel.current.selectedRow = null;
                            }
                        }
                    }
                } else {
                    jexcel.current.selectedRow = false;
                }

                // Pagination
                if (e.target.classList.contains('jexcel_page')) {
                    if (e.target.innerText == '<') {
                        jexcel.current.page(0);
                    } else if (e.target.innerText == '>') {
                        jexcel.current.page(e.target.getAttribute('title') - 1);
                    } else {
                        jexcel.current.page(e.target.innerText - 1);
                    }
                }
            }

            if (jexcel.current.edition) {
                jexcel.isMouseAction = false;
            } else {
                jexcel.isMouseAction = true;
            }
        } else {
            jexcel.isMouseAction = false;
        }
    }

    jexcel.mouseUpControls = function (e) {
        if (jexcel.current) {
            // Update cell size
            if (jexcel.current.resizing) {
                // Columns to be updated
                if (jexcel.current.resizing.column) {
                    // New width
                    var newWidth = jexcel.current.colgroup[jexcel.current.resizing.column].getAttribute('width');
                    // Columns
                    var columns = jexcel.current.getSelectedColumns();
                    if (columns.length > 1) {
                        var currentWidth = [];
                        for (var i = 0; i < columns.length; i++) {
                            currentWidth.push(parseInt(jexcel.current.colgroup[columns[i]].getAttribute('width')));
                        }
                        // Previous width
                        var index = columns.indexOf(parseInt(jexcel.current.resizing.column));
                        currentWidth[index] = jexcel.current.resizing.width;
                        jexcel.current.setWidth(columns, newWidth, currentWidth);
                    } else {
                        jexcel.current.setWidth(jexcel.current.resizing.column, newWidth, jexcel.current.resizing.width);
                    }
                    // Remove border
                    jexcel.current.headers[jexcel.current.resizing.column].classList.remove('resizing');
                    for (var j = 0; j < jexcel.current.records.length; j++) {
                        if (jexcel.current.records[j][jexcel.current.resizing.column]) {
                            jexcel.current.records[j][jexcel.current.resizing.column].classList.remove('resizing');
                        }
                    }
                } else {
                    // Remove Class
                    jexcel.current.rows[jexcel.current.resizing.row].children[0].classList.remove('resizing');
                    var newHeight = jexcel.current.rows[jexcel.current.resizing.row].getAttribute('height');
                    jexcel.current.setHeight(jexcel.current.resizing.row, newHeight, jexcel.current.resizing.height);
                    // Remove border
                    jexcel.current.resizing.element.classList.remove('resizing');
                }
                // Reset resizing helper
                jexcel.current.resizing = null;
            } else if (jexcel.current.dragging) {
                // Reset dragging helper
                if (jexcel.current.dragging) {
                    if (jexcel.current.dragging.column) {
                        // Target
                        var columnId = e.target.getAttribute('data-x');
                        // Remove move style
                        jexcel.current.headers[jexcel.current.dragging.column].classList.remove('dragging');
                        for (var j = 0; j < jexcel.current.rows.length; j++) {
                            if (jexcel.current.records[j][jexcel.current.dragging.column]) {
                                jexcel.current.records[j][jexcel.current.dragging.column].classList.remove('dragging');
                            }
                        }
                        for (var i = 0; i < jexcel.current.headers.length; i++) {
                            jexcel.current.headers[i].classList.remove('dragging-left');
                            jexcel.current.headers[i].classList.remove('dragging-right');
                        }
                        // Update position
                        if (columnId) {
                            if (jexcel.current.dragging.column != jexcel.current.dragging.destination) {
                                jexcel.current.moveColumn(jexcel.current.dragging.column, jexcel.current.dragging.destination);
                            }
                        }
                    } else {
                        if (jexcel.current.dragging.element.nextSibling) {
                            var position = parseInt(jexcel.current.dragging.element.nextSibling.getAttribute('data-y'));
                            if (jexcel.current.dragging.row < position) {
                                position -= 1;
                            }
                        } else {
                            var position = parseInt(jexcel.current.dragging.element.previousSibling.getAttribute('data-y'));
                        }
                        if (jexcel.current.dragging.row != jexcel.current.dragging.destination) {
                            jexcel.current.moveRow(jexcel.current.dragging.row, position, true);
                        }
                        jexcel.current.dragging.element.classList.remove('dragging');
                    }
                    jexcel.current.dragging = null;
                }
            } else {
                // Close any corner selection
                if (jexcel.current.selectedCorner) {
                    jexcel.current.selectedCorner = false;

                    // Data to be copied
                    if (jexcel.current.selection.length > 0) {
                        // Copy data

                        jexcel.current.copyData(jexcel.current.selection[0], jexcel.current.selection[jexcel.current.selection.length - 1]);

                        // Remove selection
                        jexcel.current.removeCopySelection();
                    }
                }
            }
        }

        // Clear any time control
        if (jexcel.timeControl) {
            clearTimeout(jexcel.timeControl);
            jexcel.timeControl = null;
        }

        // Mouse up
        jexcel.isMouseAction = false;
    }

    // Mouse move controls
    jexcel.mouseMoveControls = function (e) {
        e = e || window.event;
        if (e.buttons) {
            var mouseButton = e.buttons;
        } else if (e.button) {
            var mouseButton = e.button;
        } else {
            var mouseButton = e.which;
        }

        if (!mouseButton) {
            jexcel.isMouseAction = false;
        }

        if (jexcel.current) {
            if (jexcel.isMouseAction == true) {
                // Resizing is ongoing
                if (jexcel.current.resizing) {
                    if (jexcel.current.resizing.column) {
                        var width = e.pageX - jexcel.current.resizing.mousePosition;

                        if (jexcel.current.resizing.width + width > 0) {
                            var tempWidth = jexcel.current.resizing.width + width;
                            jexcel.current.colgroup[jexcel.current.resizing.column].setAttribute('width', tempWidth);

                            jexcel.current.updateCornerPosition();
                        }
                    } else {
                        var height = e.pageY - jexcel.current.resizing.mousePosition;

                        if (jexcel.current.resizing.height + height > 0) {
                            var tempHeight = jexcel.current.resizing.height + height;
                            jexcel.current.rows[jexcel.current.resizing.row].setAttribute('height', tempHeight);

                            jexcel.current.updateCornerPosition();
                        }
                    }
                }
            } else {
                var x = e.target.getAttribute('data-x');
                var y = e.target.getAttribute('data-y');
                var rect = e.target.getBoundingClientRect();

                if (jexcel.current.cursor) {
                    jexcel.current.cursor.style.cursor = '';
                    jexcel.current.cursor = null;
                }

                if (e.target.parentNode.parentNode && e.target.parentNode.parentNode.className) {
                    if (e.target.parentNode.parentNode.classList.contains('resizable')) {
                        if (e.target && x && !y && (rect.width - (e.clientX - rect.left) < 6)) {
                            jexcel.current.cursor = e.target;
                            jexcel.current.cursor.style.cursor = 'col-resize';
                        } else if (e.target && !x && y && (rect.height - (e.clientY - rect.top) < 6)) {
                            jexcel.current.cursor = e.target;
                            jexcel.current.cursor.style.cursor = 'row-resize';
                        }
                    }

                    if (e.target.parentNode.parentNode.classList.contains('draggable')) {
                        if (e.target && !x && y && (rect.width - (e.clientX - rect.left) < 6)) {
                            jexcel.current.cursor = e.target;
                            jexcel.current.cursor.style.cursor = 'move';
                        } else if (e.target && x && !y && (rect.height - (e.clientY - rect.top) < 6)) {
                            jexcel.current.cursor = e.target;
                            jexcel.current.cursor.style.cursor = 'move';
                        }
                    }
                }
            }
        }
    }

    jexcel.mouseOverControls = function (e) {
        e = e || window.event;
        if (e.buttons) {
            var mouseButton = e.buttons;
        } else if (e.button) {
            var mouseButton = e.button;
        } else {
            var mouseButton = e.which;
        }

        if (!mouseButton) {
            jexcel.isMouseAction = false;
        }

        if (jexcel.current && jexcel.isMouseAction == true) {
            // Get elements
            var jexcelTable = jexcel.getElement(e.target);

            if (jexcelTable[0]) {
                // Avoid cross reference
                if (jexcel.current != jexcelTable[0].jexcel) {
                    if (jexcel.current) {
                        return false;
                    }
                }

                var columnId = e.target.getAttribute('data-x');
                var rowId = e.target.getAttribute('data-y');

                if (jexcel.current.dragging) {
                    if (jexcel.current.dragging.column) {
                        if (columnId) {
                            if (jexcel.current.isColMerged(columnId).length) {
                                console.error('JEXCEL: This column is part of a merged cell.');
                            } else {
                                for (var i = 0; i < jexcel.current.headers.length; i++) {
                                    jexcel.current.headers[i].classList.remove('dragging-left');
                                    jexcel.current.headers[i].classList.remove('dragging-right');
                                }

                                if (jexcel.current.dragging.column == columnId) {
                                    jexcel.current.dragging.destination = parseInt(columnId);
                                } else {
                                    if (e.target.clientWidth / 2 > e.offsetX) {
                                        if (jexcel.current.dragging.column < columnId) {
                                            jexcel.current.dragging.destination = parseInt(columnId) - 1;
                                        } else {
                                            jexcel.current.dragging.destination = parseInt(columnId);
                                        }
                                        jexcel.current.headers[columnId].classList.add('dragging-left');
                                    } else {
                                        if (jexcel.current.dragging.column < columnId) {
                                            jexcel.current.dragging.destination = parseInt(columnId);
                                        } else {
                                            jexcel.current.dragging.destination = parseInt(columnId) + 1;
                                        }
                                        jexcel.current.headers[columnId].classList.add('dragging-right');
                                    }
                                }
                            }
                        }
                    } else {
                        if (rowId) {
                            if (jexcel.current.isRowMerged(rowId).length) {
                                console.error('JEXCEL: This row is part of a merged cell.');
                            } else {
                                var target = (e.target.clientHeight / 2 > e.offsetY) ? e.target.parentNode.nextSibling : e.target.parentNode;
                                if (jexcel.current.dragging.element != target) {
                                    e.target.parentNode.parentNode.insertBefore(jexcel.current.dragging.element, target);
                                    jexcel.current.dragging.destination = Array.prototype.indexOf.call(jexcel.current.dragging.element.parentNode.children, jexcel.current.dragging.element);
                                }
                            }
                        }
                    }
                } else if (jexcel.current.resizing) {
                } else {
                    // Header found
                    if (jexcelTable[1] == 1) {
                        if (jexcel.current.selectedHeader) {
                            var columnId = e.target.getAttribute('data-x');
                            var o = jexcel.current.selectedHeader;
                            var d = columnId;
                            // Update selection
                            jexcel.current.updateSelectionFromCoords(o, 0, d, jexcel.current.options.data.length - 1);
                        }
                    }

                    // Body found
                    if (jexcelTable[1] == 2) {
                        if (e.target.classList.contains('jexcel_row')) {
                            if (jexcel.current.selectedRow) {
                                var o = jexcel.current.selectedRow;
                                var d = rowId;
                                // Update selection
                                jexcel.current.updateSelectionFromCoords(0, o, jexcel.current.options.data[0].length - 1, d);
                            }
                        } else {
                            // Do not select edtion is in progress
                            if (!jexcel.current.edition) {
                                if (columnId && rowId) {
                                    if (jexcel.current.selectedCorner) {
                                        jexcel.current.updateCopySelection(columnId, rowId);
                                    } else {
                                        if (jexcel.current.selectedCell) {
                                            jexcel.current.updateSelectionFromCoords(jexcel.current.selectedCell[0], jexcel.current.selectedCell[1], columnId, rowId);
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }
        }

        // Clear any time control
        if (jexcel.timeControl) {
            clearTimeout(jexcel.timeControl);
            jexcel.timeControl = null;
        }
    }

    /**
     * Double click event handler: controls the double click in the corner, cell edition or column re-ordering.
     */
    jexcel.doubleClickControls = function (e) {
        // Jexcel is selected
        if (jexcel.current) {
            // Corner action
            if (e.target.classList.contains('jexcel_corner')) {
                // Any selected cells
                if (jexcel.current.highlighted.length > 0) {
                    // Copy from this
                    var x1 = jexcel.current.highlighted[0].getAttribute('data-x');
                    var y1 = parseInt(jexcel.current.highlighted[jexcel.current.highlighted.length - 1].getAttribute('data-y')) + 1;
                    // Until this
                    var x2 = jexcel.current.highlighted[jexcel.current.highlighted.length - 1].getAttribute('data-x');
                    var y2 = jexcel.current.records.length - 1
                    // Execute copy
                    jexcel.current.copyData(jexcel.current.records[y1][x1], jexcel.current.records[y2][x2]);
                }
            } else if (e.target.classList.contains('jexcel_column_filter')) {
                // Column
                var columnId = e.target.getAttribute('data-x');
                // Open filter
                jexcel.current.openFilter(columnId);

            } else {
                // Get table
                var jexcelTable = jexcel.getElement(e.target);

                // Double click over header
                if (jexcelTable[1] == 1 && jexcel.current.options.columnSorting == true) {
                    // Check valid column header coords
                    var columnId = e.target.getAttribute('data-x');
                    if (columnId) {
                        jexcel.current.orderBy(columnId);
                    }
                }

                // Double click over body
                if (jexcelTable[1] == 2 && jexcel.current.options.editable == true) {
                    if (!jexcel.current.edition) {
                        var getCellCoords = function (element) {
                            if (element.parentNode) {
                                var x = element.getAttribute('data-x');
                                var y = element.getAttribute('data-y');
                                if (x && y) {
                                    return element;
                                } else {
                                    return getCellCoords(element.parentNode);
                                }
                            }
                        }
                        var cell = getCellCoords(e.target);
                        if (cell && cell.classList.contains('highlight')) {
                            jexcel.current.openEditor(cell);
                        }
                    }
                }
            }
        }
    }

    jexcel.copyControls = function (e) {
        if (jexcel.current && jexcel.copyControls.enabled) {
            if (!jexcel.current.edition) {
                jexcel.current.copy(true);
            }
        }
    }

    jexcel.cutControls = function (e) {
        if (jexcel.current) {
            if (!jexcel.current.edition) {
                jexcel.current.copy(true);
                if (jexcel.current.options.editable == true) {
                    jexcel.current.setValue(jexcel.current.highlighted, '');
                }
            }
        }
    }

    jexcel.pasteControls = function (e) {
        if (jexcel.current && jexcel.current.selectedCell) {
            if (!jexcel.current.edition) {
                if (jexcel.current.options.editable == true) {
                    if (e && e.clipboardData) {
                        // jexcel.current.paste(jexcel.current.selectedCell[0], jexcel.current.selectedCell[1], e.clipboardData.getData('text'));//hidden
                        jexcel.current.paste(jexcel.current.selectedCell, e.clipboardData.getData('text'));
                        e.preventDefault();
                    } else if (window.clipboardData) {
                        // jexcel.current.paste(jexcel.current.selectedCell[0], jexcel.current.selectedCell[1], window.clipboardData.getData('text'));//hidden
                        jexcel.current.paste(jexcel.current.selectedCell, e.clipboardData.getData('text'));
                    }
                }
            }
        }
    }

    jexcel.contextMenuControls = function (e) {
        e = e || window.event;
        if ("buttons" in e) {
            var mouseButton = e.buttons;
        } else {
            var mouseButton = e.which || e.button;
        }
        if (jexcel.current) {
            if (jexcel.current.edition) {
                // e.preventDefault();
            } else if (jexcel.current.options.contextMenu) {
                jexcel.current.contextMenu.contextmenu.close();

                if (jexcel.current) {
                    var x = e.target.getAttribute('data-x');
                    var y = e.target.getAttribute('data-y');

                    if ((x && y) === null) {
                        let parent = e.target.parentNode;
                        if (parent.tagName === 'TD') {
                            x = parent.getAttribute('data-x');
                            y = parent.getAttribute('data-y');
                        }
                    }

                    if (x || y) {
                        if ((x < parseInt(jexcel.current.selectedCell[0])) || (x > parseInt(jexcel.current.selectedCell[2])) ||
                            (y < parseInt(jexcel.current.selectedCell[1])) || (y > parseInt(jexcel.current.selectedCell[3]))) {
                            jexcel.current.updateSelectionFromCoords(x, y, x, y);
                        }
                        // Table found
                        var items = jexcel.current.options.contextMenu(jexcel.current, x, y, e);
                        // The id is depending on header and body
                        jexcel.current.contextMenu.contextmenu.open(e, items);
                        // Avoid the real one
                        e.preventDefault();
                    }
                }
            }
        }
    }

    jexcel.touchStartControls = function (e) {
        var jexcelTable = jexcel.getElement(e.target);

        if (jexcelTable[0]) {
            if (jexcel.current != jexcelTable[0].jexcel) {
                if (jexcel.current) {
                    jexcel.current.resetSelection();
                }
                jexcel.current = jexcelTable[0].jexcel;
            }
        } else {
            if (jexcel.current) {
                jexcel.current.resetSelection();
                jexcel.current = null;
            }
        }

        if (jexcel.current) {
            if (!jexcel.current.edition) {
                var columnId = e.target.getAttribute('data-x');
                var rowId = e.target.getAttribute('data-y');

                if (columnId && rowId) {
                    jexcel.current.updateSelectionFromCoords(columnId, rowId);

                    jexcel.timeControl = setTimeout(function () {
                        // Keep temporary reference to the element
                        if (jexcel.current.options.columns[columnId].type == 'color') {
                            jexcel.tmpElement = null;
                        } else {
                            jexcel.tmpElement = e.target;
                        }
                        jexcel.current.openEditor(e.target, false, e);
                    }, 500);
                }
            }
        }
    }

    jexcel.touchEndControls = function (e) {
        // Clear any time control
        if (jexcel.timeControl) {
            clearTimeout(jexcel.timeControl);
            jexcel.timeControl = null;
            // Element
            if (jexcel.tmpElement && jexcel.tmpElement.children[0].tagName == 'INPUT') {
                jexcel.tmpElement.children[0].focus();
            }
            jexcel.tmpElement = null;
        }
    }

    /**
     * Jexcel extensions
     */

    jexcel.tabs = function (tabs, result) {
        var instances = [];
        // Create tab container
        if (!tabs.classList.contains('jexcel_tabs')) {
            tabs.innerHTML = '';
            tabs.classList.add('jexcel_tabs')
            tabs.jexcel = [];

            var div = document.createElement('div');
            var headers = tabs.appendChild(div);
            var div = document.createElement('div');
            var content = tabs.appendChild(div);
        } else {
            var headers = tabs.children[0];
            var content = tabs.children[1];
        }

        var spreadsheet = []
        var link = [];
        for (var i = 0; i < result.length; i++) {
            // Spreadsheet container
            spreadsheet[i] = document.createElement('div');
            spreadsheet[i].classList.add('jexcel_tab');
            var worksheet = jexcel(spreadsheet[i], result[i]);
            content.appendChild(spreadsheet[i]);
            instances[i] = tabs.jexcel.push(worksheet);

            // Tab link
            link[i] = document.createElement('div');
            link[i].classList.add('jexcel_tab_link');
            link[i].setAttribute('data-spreadsheet', tabs.jexcel.length - 1);
            link[i].innerHTML = result[i].sheetName;
            link[i].onclick = function () {
                for (var j = 0; j < headers.children.length; j++) {
                    headers.children[j].classList.remove('selected');
                    content.children[j].style.display = 'none';
                }
                var i = this.getAttribute('data-spreadsheet');
                content.children[i].style.display = 'block';
                headers.children[i].classList.add('selected')
            }
            headers.appendChild(link[i]);
        }

        // First tab
        for (var j = 0; j < headers.children.length; j++) {
            headers.children[j].classList.remove('selected');
            content.children[j].style.display = 'none';
        }
        headers.children[headers.children.length - 1].classList.add('selected');
        content.children[headers.children.length - 1].style.display = 'block';

        return instances;
    }

    // Compability to older versions
    jexcel.createTabs = jexcel.tabs;

    jexcel.fromSpreadsheet = function (file, __callback) {
        var convert = function (workbook) {
            var spreadsheets = [];
            workbook.SheetNames.forEach(function (sheetName) {
                var spreadsheet = {};
                spreadsheet.rows = [];
                spreadsheet.columns = [];
                spreadsheet.data = [];
                spreadsheet.style = {};
                spreadsheet.sheetName = sheetName;

                // Column widths
                var temp = workbook.Sheets[sheetName]['!cols'];
                if (temp && temp.length) {
                    for (var i = 0; i < temp.length; i++) {
                        spreadsheet.columns[i] = {};
                        if (temp[i] && temp[i].wpx) {
                            spreadsheet.columns[i].width = temp[i].wpx + 'px';
                        }
                    }
                }
                // Rows heights
                var temp = workbook.Sheets[sheetName]['!rows'];
                if (temp && temp.length) {
                    for (var i = 0; i < temp.length; i++) {
                        if (temp[i] && temp[i].hpx) {
                            spreadsheet.rows[i] = {};
                            spreadsheet.rows[i].height = temp[i].hpx + 'px';
                        }
                    }
                }
                // Merge cells
                var temp = workbook.Sheets[sheetName]['!merges'];
                if (temp && temp.length > 0) {
                    spreadsheet.mergeCells = [];
                    for (var i = 0; i < temp.length; i++) {
                        var x1 = temp[i].s.c;
                        var y1 = temp[i].s.r;
                        var x2 = temp[i].e.c;
                        var y2 = temp[i].e.r;
                        var key = jexcel.getColumnNameFromId([x1, y1]);
                        spreadsheet.mergeCells[key] = [x2 - x1 + 1, y2 - y1 + 1];
                    }
                }
                // Data container
                var max_x = 0;
                var max_y = 0;
                var temp = Object.keys(workbook.Sheets[sheetName]);
                for (var i = 0; i < temp.length; i++) {
                    if (temp[i].substr(0, 1) != '!') {
                        var cell = workbook.Sheets[sheetName][temp[i]];
                        var info = jexcel.getIdFromColumnName(temp[i], true);
                        if (!spreadsheet.data[info[1]]) {
                            spreadsheet.data[info[1]] = [];
                        }
                        spreadsheet.data[info[1]][info[0]] = cell.f ? '=' + cell.f : cell.w;
                        if (max_x < info[0]) {
                            max_x = info[0];
                        }
                        if (max_y < info[1]) {
                            max_y = info[1];
                        }
                        // Style
                        if (cell.style && Object.keys(cell.style).length > 0) {
                            spreadsheet.style[temp[i]] = cell.style;
                        }
                        if (cell.s && cell.s.fgColor) {
                            if (spreadsheet.style[temp[i]]) {
                                spreadsheet.style[temp[i]] += ';';
                            }
                            spreadsheet.style[temp[i]] += 'background-color:#' + cell.s.fgColor.rgb;
                        }
                    }
                }
                var numColumns = spreadsheet.columns;
                for (var j = 0; j <= max_y; j++) {
                    for (var i = 0; i <= max_x; i++) {
                        if (!spreadsheet.data[j]) {
                            spreadsheet.data[j] = [];
                        }
                        if (!spreadsheet.data[j][i]) {
                            if (numColumns < i) {
                                spreadsheet.data[j][i] = '';
                            }
                        }
                    }
                }
                spreadsheets.push(spreadsheet);
            });

            return spreadsheets;
        }

        var oReq;
        oReq = new XMLHttpRequest();
        oReq.open("GET", file, true);

        if (typeof Uint8Array !== 'undefined') {
            oReq.responseType = "arraybuffer";
            oReq.onload = function (e) {
                var arraybuffer = oReq.response;
                var data = new Uint8Array(arraybuffer);
                var wb = XLSX.read(data, {type: "array", cellFormula: true, cellStyles: true});
                __callback(convert(wb))
            };
        } else {
            oReq.setRequestHeader("Accept-Charset", "x-user-defined");
            oReq.onreadystatechange = function () {
                if (oReq.readyState == 4 && oReq.status == 200) {
                    var ff = convertResponseBodyToText(oReq.responseBody);
                    var wb = XLSX.read(ff, {type: "binary", cellFormula: true, cellStyles: true});
                    __callback(convert(wb))
                }
            };
        }

        oReq.send();
    }

    /**
     * Valid international letter
     */

    jexcel.validLetter = function (text) {
        var regex = /([\u0041-\u005A\u0061-\u007A\u00AA\u00B5\u00BA\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u0527\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u08A0\u08A2-\u08AC\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0977\u0979-\u097F\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C33\u0C35-\u0C39\u0C3D\u0C58\u0C59\u0C60\u0C61\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D60\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F4\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191C\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19C1-\u19C7\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2183\u2184\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005\u3006\u3031-\u3035\u303B\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FCC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA697\uA6A0-\uA6E5\uA717-\uA71F\uA722-\uA788\uA78B-\uA78E\uA790-\uA793\uA7A0-\uA7AA\uA7F8-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA80-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uABC0-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC-\u0400-\u04FF']+)/g;
        return text.match(regex) ? 1 : 0;
    }

    /**
     * Helper injectArray
     */
    jexcel.injectArray = function (o, idx, arr) {
        return o.slice(0, idx).concat(arr).concat(o.slice(idx));
    }

    /**
     * Get letter based on a number
     *
     * @param integer i
     * @return string letter
     */
    jexcel.getColumnName = function (i) {
        var letter = '';
        if (i > 701) {
            letter += String.fromCharCode(64 + parseInt(i / 676));
            letter += String.fromCharCode(64 + parseInt((i % 676) / 26));
        } else if (i > 25) {
            letter += String.fromCharCode(64 + parseInt(i / 26));
        }
        letter += String.fromCharCode(65 + (i % 26));
        return letter;
    }

    /**
     * Convert excel like column to jexcel id
     *
     * @param string id
     * @return string id
     */
    jexcel.getIdFromColumnName = function (id, arr) {
        // Get the letters
        var t = /^[a-zA-Z]+/.exec(id);

        if (t) {
            // Base 26 calculation
            var code = 0;
            for (var i = 0; i < t[0].length; i++) {
                code += parseInt(t[0].charCodeAt(i) - 64) * Math.pow(26, (t[0].length - 1 - i));
            }
            code--;
            // Make sure jexcel starts on zero
            if (code < 0) {
                code = 0;
            }

            // Number
            var number = parseInt(/[0-9]+$/.exec(id));
            if (number > 0) {
                number--;
            }

            if (arr == true) {
                id = [code, number];
            } else {
                id = code + '-' + number;
            }
        }

        return id;
    }

    /**
     * Convert jexcel id to excel like column name
     *
     * @param string id
     * @return string id
     */
    jexcel.getColumnNameFromId = function (cellId) {
        if (!Array.isArray(cellId)) {
            cellId = cellId.split('-');
        }

        return jexcel.getColumnName(parseInt(cellId[0])) + (parseInt(cellId[1]) + 1);
    }

    /**
     * Verify element inside jexcel table
     *
     * @param string id
     * @return string id
     */
    jexcel.getElement = function (element) {
        var jexcelSection = 0;
        var jexcelElement = 0;

        function path(element) {
            if (element.className) {
                if (element.classList.contains('jexcel_container')) {
                    jexcelElement = element;
                }
            }

            if (element.tagName == 'THEAD') {
                jexcelSection = 1;
            } else if (element.tagName == 'TBODY') {
                jexcelSection = 2;
            }

            if (element.parentNode) {
                if (!jexcelElement) {
                    path(element.parentNode);
                }
            }
        }

        path(element);
        return [jexcelElement, jexcelSection];
    }

    jexcel.doubleDigitFormat = function (v) {
        v = '' + v;
        if (v.length == 1) {
            v = '0' + v;
        }
        return v;
    }

    jexcel.createFromTable = function (el, options) {
        if (el.tagName != 'TABLE') {
            console.log('Element is not a table');
        } else {
            // Configuration
            if (!options) {
                options = {};
            }
            options.columns = [];
            options.data = [];

            // Colgroup
            var colgroup = el.querySelectorAll('colgroup > col');
            if (colgroup.length) {
                // Get column width
                for (var i = 0; i < colgroup.length; i++) {
                    var width = colgroup[i].style.width;
                    if (!width) {
                        var width = colgroup[i].getAttribute('width');
                    }
                    // Set column width
                    if (width) {
                        if (!options.columns[i]) {
                            options.columns[i] = {}
                        }
                        options.columns[i].width = width;
                    }
                }
            }

            // Parse header
            var parseHeader = function (header) {
                // Get width information
                var info = header.getBoundingClientRect();
                var width = info.width > 50 ? info.width : 50;

                // Create column option
                if (!options.columns[i]) {
                    options.columns[i] = {};
                }
                if (header.getAttribute('data-celltype')) {
                    options.columns[i].type = header.getAttribute('data-celltype');
                } else {
                    options.columns[i].type = 'text';
                }
                options.columns[i].width = width + 'px';
                options.columns[i].title = header.innerHTML;
                options.columns[i].align = header.style.textAlign || 'center';
            }

            // Headers
            var headers = el.querySelectorAll('thead > tr');
            if (headers.length) {
                // Get the last row in the thead
                headers = headers[headers.length - 1].children;
                // Go though the headers
                for (var i = 0; i < headers.length; i++) {
                    parseHeader(headers[i]);
                }
            }

            // Content
            var rowNumber = 0;
            var mergeCells = {};
            var rows = {};
            var style = {};
            var classes = {};

            var content = el.querySelectorAll('table > tr, tbody tr');
            for (var j = 0; j < content.length; j++) {
                options.data[rowNumber] = [];
                if (options.parseTableFirstRowAsHeader == true && !headers.length && j == 0) {
                    for (var i = 0; i < content[j].children.length; i++) {
                        parseHeader(content[j].children[i]);
                    }
                } else {
                    for (var i = 0; i < content[j].children.length; i++) {
                        // WickedGrid formula compatibility
                        var value = content[j].children[i].getAttribute('data-formula');
                        if (value) {
                            if (value.substr(0, 1) != '=') {
                                value = '=' + value;
                            }
                        } else {
                            var value = content[j].children[i].innerHTML;
                        }
                        options.data[rowNumber].push(value);

                        // Key
                        var cellName = jexcel.getColumnNameFromId([i, j]);

                        // Classes
                        var tmp = content[j].children[i].getAttribute('class');
                        if (tmp) {
                            classes[cellName] = tmp;
                        }

                        // Merged cells
                        var mergedColspan = parseInt(content[j].children[i].getAttribute('colspan')) || 0;
                        var mergedRowspan = parseInt(content[j].children[i].getAttribute('rowspan')) || 0;
                        if (mergedColspan || mergedRowspan) {
                            mergeCells[cellName] = [mergedColspan || 1, mergedRowspan || 1];
                        }

                        // Avoid problems with hidden cells
                        if (s = content[j].children[i].style && content[j].children[i].style.display == 'none') {
                            content[j].children[i].style.display = '';
                        }
                        // Get style
                        var s = content[j].children[i].getAttribute('style');
                        if (s) {
                            style[cellName] = s;
                        }
                        // Bold
                        if (content[j].children[i].classList.contains('styleBold')) {
                            if (style[cellName]) {
                                style[cellName] += '; font-weight:bold;';
                            } else {
                                style[cellName] = 'font-weight:bold;';
                            }
                        }
                    }

                    // Row Height
                    if (content[j].style && content[j].style.height) {
                        rows[j] = {height: content[j].style.height};
                    }

                    // Index
                    rowNumber++;
                }
            }

            // Style
            if (Object.keys(style).length > 0) {
                //options.style = style;
            }
            // Merged
            if (Object.keys(mergeCells).length > 0) {
                options.mergeCells = mergeCells;
            }
            // Row height
            if (Object.keys(rows).length > 0) {
                options.rows = rows;
            }
            // Classes
            if (Object.keys(classes).length > 0) {
                options.classes = classes;
            }

            // TODO: data-hiddencolumns="3,4"

            // I guess in terms the better column type
            if (options.parseTableAutoCellType == true) {
                var pattern = [];
                for (var i = 0; i < options.columns.length; i++) {
                    var test = true;
                    var testCalendar = true;
                    pattern[i] = [];
                    for (var j = 0; j < options.data.length; j++) {
                        var value = options.data[j][i];
                        if (!pattern[i][value]) {
                            pattern[i][value] = 0;
                        }
                        pattern[i][value]++;
                        if (value.length > 25) {
                            test = false;
                        }
                        if (value.length == 10) {
                            if (!(value.substr(4, 1) == '-' && value.substr(7, 1) == '-')) {
                                testCalendar = false;
                            }
                        } else {
                            testCalendar = false;
                        }
                    }

                    var keys = Object.keys(pattern[i]).length;
                    if (testCalendar) {
                        options.columns[i].type = 'calendar';
                    } else if (test == true && keys > 1 && keys <= parseInt(options.data.length * 0.1)) {
                        options.columns[i].type = 'dropdown';
                        options.columns[i].source = Object.keys(pattern[i]);
                    }
                }
            }

            return options;
        }
    }

    /**
     * Jquery Support
     */
    if (typeof (jQuery) != 'undefined') {
        (function ($) {
            $.fn.jexcel = function (method) {
                var spreadsheetContainer = $(this).get(0);
                if (!spreadsheetContainer.jexcel) {
                    return jexcel($(this).get(0), arguments[0]);
                } else {
                    return spreadsheetContainer.jexcel[method].apply(this, Array.prototype.slice.call(arguments, 1));
                }
            };

        })(jQuery);
    }


    // Based on sutoiku work (https://github.com/sutoiku)

    var error = (function () {
        var exports = {};

        exports.nil = new Error('#NULL!');
        exports.div0 = new Error('#DIV/0!');
        exports.value = new Error('#VALUE!');
        exports.ref = new Error('#REF!');
        exports.name = new Error('#NAME?');
        exports.num = new Error('#NUM!');
        exports.na = new Error('#N/A');
        exports.error = new Error('#ERROR!');
        exports.data = new Error('#GETTING_DATA');

        return exports;
    })();

    var utils = (function () {
        var exports = {};

        exports.flattenShallow = function (array) {
            if (!array || !array.reduce) {
                return array;
            }

            return array.reduce(function (a, b) {
                var aIsArray = Array.isArray(a);
                var bIsArray = Array.isArray(b);

                if (aIsArray && bIsArray) {
                    return a.concat(b);
                }
                if (aIsArray) {
                    a.push(b);

                    return a;
                }
                if (bIsArray) {
                    return [a].concat(b);
                }

                return [a, b];
            });
        };

        exports.isFlat = function (array) {
            if (!array) {
                return false;
            }

            for (var i = 0; i < array.length; ++i) {
                if (Array.isArray(array[i])) {
                    return false;
                }
            }

            return true;
        };

        exports.flatten = function () {
            var result = exports.argsToArray.apply(null, arguments);

            while (!exports.isFlat(result)) {
                result = exports.flattenShallow(result);
            }

            return result;
        };

        exports.argsToArray = function (args) {
            var result = [];

            exports.arrayEach(args, function (value) {
                result.push(value);
            });

            return result;
        };

        exports.numbers = function () {
            var possibleNumbers = this.flatten.apply(null, arguments);
            return possibleNumbers.filter(function (el) {
                return typeof el === 'number';
            });
        };

        exports.cleanFloat = function (number) {
            var power = 1e14;
            return Math.round(number * power) / power;
        };

        exports.parseBool = function (bool) {
            if (typeof bool === 'boolean') {
                return bool;
            }

            if (bool instanceof Error) {
                return bool;
            }

            if (typeof bool === 'number') {
                return bool !== 0;
            }

            if (typeof bool === 'string') {
                var up = bool.toUpperCase();
                if (up === 'TRUE') {
                    return true;
                }

                if (up === 'FALSE') {
                    return false;
                }
            }

            if (bool instanceof Date && !isNaN(bool)) {
                return true;
            }

            return error.value;
        };

        exports.parseNumber = function (string) {
            if (string === undefined || string === '') {
                return error.value;
            }
            if (!isNaN(string)) {
                return parseFloat(string);
            }

            return error.value;
        };

        exports.parseNumberArray = function (arr) {
            var len;

            if (!arr || (len = arr.length) === 0) {
                return error.value;
            }

            var parsed;

            while (len--) {
                parsed = exports.parseNumber(arr[len]);
                if (parsed === error.value) {
                    return parsed;
                }
                arr[len] = parsed;
            }

            return arr;
        };

        exports.parseMatrix = function (matrix) {
            var n;

            if (!matrix || (n = matrix.length) === 0) {
                return error.value;
            }
            var pnarr;

            for (var i = 0; i < matrix.length; i++) {
                pnarr = exports.parseNumberArray(matrix[i]);
                matrix[i] = pnarr;

                if (pnarr instanceof Error) {
                    return pnarr;
                }
            }

            return matrix;
        };

        var d1900 = new Date(Date.UTC(1900, 0, 1));
        exports.parseDate = function (date) {
            if (!isNaN(date)) {
                if (date instanceof Date) {
                    return new Date(date);
                }
                var d = parseInt(date, 10);
                if (d < 0) {
                    return error.num;
                }
                if (d <= 60) {
                    return new Date(d1900.getTime() + (d - 1) * 86400000);
                }
                return new Date(d1900.getTime() + (d - 2) * 86400000);
            }
            if (typeof date === 'string') {
                date = new Date(date);
                if (!isNaN(date)) {
                    return date;
                }
            }
            return error.value;
        };

        exports.parseDateArray = function (arr) {
            var len = arr.length;
            var parsed;
            while (len--) {
                parsed = this.parseDate(arr[len]);
                if (parsed === error.value) {
                    return parsed;
                }
                arr[len] = parsed;
            }
            return arr;
        };

        exports.anyIsError = function () {
            var n = arguments.length;
            while (n--) {
                if (arguments[n] instanceof Error) {
                    return true;
                }
            }
            return false;
        };

        exports.arrayValuesToNumbers = function (arr) {
            var n = arr.length;
            var el;
            while (n--) {
                el = arr[n];
                if (typeof el === 'number') {
                    continue;
                }
                if (el === true) {
                    arr[n] = 1;
                    continue;
                }
                if (el === false) {
                    arr[n] = 0;
                    continue;
                }
                if (typeof el === 'string') {
                    var number = this.parseNumber(el);
                    if (number instanceof Error) {
                        arr[n] = 0;
                    } else {
                        arr[n] = number;
                    }
                }
            }
            return arr;
        };

        exports.rest = function (array, idx) {
            idx = idx || 1;
            if (!array || typeof array.slice !== 'function') {
                return array;
            }
            return array.slice(idx);
        };

        exports.initial = function (array, idx) {
            idx = idx || 1;
            if (!array || typeof array.slice !== 'function') {
                return array;
            }
            return array.slice(0, array.length - idx);
        };

        exports.arrayEach = function (array, iteratee) {
            var index = -1, length = array.length;

            while (++index < length) {
                if (iteratee(array[index], index, array) === false) {
                    break;
                }
            }

            return array;
        };

        exports.transpose = function (matrix) {
            if (!matrix) {
                return error.value;
            }

            return matrix[0].map(function (col, i) {
                return matrix.map(function (row) {
                    return row[i];
                });
            });
        };

        return exports;
    })();

    jexcel.methods = {};

    jexcel.methods.datetime = (function () {
        var exports = {};

        var d1900 = new Date(1900, 0, 1);
        var WEEK_STARTS = [
            undefined,
            0,
            1,
            undefined,
            undefined,
            undefined,
            undefined,
            undefined,
            undefined,
            undefined,
            undefined,
            undefined,
            1,
            2,
            3,
            4,
            5,
            6,
            0
        ];
        var WEEK_TYPES = [
            [],
            [1, 2, 3, 4, 5, 6, 7],
            [7, 1, 2, 3, 4, 5, 6],
            [6, 0, 1, 2, 3, 4, 5],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [7, 1, 2, 3, 4, 5, 6],
            [6, 7, 1, 2, 3, 4, 5],
            [5, 6, 7, 1, 2, 3, 4],
            [4, 5, 6, 7, 1, 2, 3],
            [3, 4, 5, 6, 7, 1, 2],
            [2, 3, 4, 5, 6, 7, 1],
            [1, 2, 3, 4, 5, 6, 7]
        ];
        var WEEKEND_TYPES = [
            [],
            [6, 0],
            [0, 1],
            [1, 2],
            [2, 3],
            [3, 4],
            [4, 5],
            [5, 6],
            undefined,
            undefined,
            undefined, [0, 0],
            [1, 1],
            [2, 2],
            [3, 3],
            [4, 4],
            [5, 5],
            [6, 6]
        ];

        exports.DATE = function (year, month, day) {
            year = utils.parseNumber(year);
            month = utils.parseNumber(month);
            day = utils.parseNumber(day);
            if (utils.anyIsError(year, month, day)) {
                return error.value;
            }
            if (year < 0 || month < 0 || day < 0) {
                return error.num;
            }
            var date = new Date(year, month - 1, day);
            return date;
        };

        exports.DATEVALUE = function (date_text) {
            if (typeof date_text !== 'string') {
                return error.value;
            }
            var date = Date.parse(date_text);
            if (isNaN(date)) {
                return error.value;
            }
            if (date <= -2203891200000) {
                return (date - d1900) / 86400000 + 1;
            }
            return (date - d1900) / 86400000 + 2;
        };

        exports.DAY = function (serial_number) {
            var date = utils.parseDate(serial_number);
            if (date instanceof Error) {
                return date;
            }
            return date.getDate();
        };

        exports.DAYS = function (end_date, start_date) {
            end_date = utils.parseDate(end_date);
            start_date = utils.parseDate(start_date);
            if (end_date instanceof Error) {
                return end_date;
            }
            if (start_date instanceof Error) {
                return start_date;
            }
            return serial(end_date) - serial(start_date);
        };

        exports.DAYS360 = function (start_date, end_date, method) {
        };

        exports.EDATE = function (start_date, months) {
            start_date = utils.parseDate(start_date);
            if (start_date instanceof Error) {
                return start_date;
            }
            if (isNaN(months)) {
                return error.value;
            }
            months = parseInt(months, 10);
            start_date.setMonth(start_date.getMonth() + months);
            return serial(start_date);
        };

        exports.EOMONTH = function (start_date, months) {
            start_date = utils.parseDate(start_date);
            if (start_date instanceof Error) {
                return start_date;
            }
            if (isNaN(months)) {
                return error.value;
            }
            months = parseInt(months, 10);
            return serial(new Date(start_date.getFullYear(), start_date.getMonth() + months + 1, 0));
        };

        exports.HOUR = function (serial_number) {
            serial_number = utils.parseDate(serial_number);
            if (serial_number instanceof Error) {
                return serial_number;
            }
            return serial_number.getHours();
        };

        exports.INTERVAL = function (second) {
            if (typeof second !== 'number' && typeof second !== 'string') {
                return error.value;
            } else {
                second = parseInt(second, 10);
            }

            var year = Math.floor(second / 946080000);
            second = second % 946080000;
            var month = Math.floor(second / 2592000);
            second = second % 2592000;
            var day = Math.floor(second / 86400);
            second = second % 86400;

            var hour = Math.floor(second / 3600);
            second = second % 3600;
            var min = Math.floor(second / 60);
            second = second % 60;
            var sec = second;

            year = (year > 0) ? year + 'Y' : '';
            month = (month > 0) ? month + 'M' : '';
            day = (day > 0) ? day + 'D' : '';
            hour = (hour > 0) ? hour + 'H' : '';
            min = (min > 0) ? min + 'M' : '';
            sec = (sec > 0) ? sec + 'S' : '';

            return 'P' + year + month + day + 'T' + hour + min + sec;
        };

        exports.ISOWEEKNUM = function (date) {
            date = utils.parseDate(date);
            if (date instanceof Error) {
                return date;
            }

            date.setHours(0, 0, 0);
            date.setDate(date.getDate() + 4 - (date.getDay() || 7));
            var yearStart = new Date(date.getFullYear(), 0, 1);
            return Math.ceil((((date - yearStart) / 86400000) + 1) / 7);
        };

        exports.MINUTE = function (serial_number) {
            serial_number = utils.parseDate(serial_number);
            if (serial_number instanceof Error) {
                return serial_number;
            }
            return serial_number.getMinutes();
        };

        exports.MONTH = function (serial_number) {
            serial_number = utils.parseDate(serial_number);
            if (serial_number instanceof Error) {
                return serial_number;
            }
            return serial_number.getMonth() + 1;
        };

        exports.NETWORKDAYS = function (start_date, end_date, holidays) {
        };

        exports.NETWORKDAYS.INTL = function (start_date, end_date, weekend, holidays) {
        };

        exports.NOW = function () {
            return new Date();
        };

        exports.SECOND = function (serial_number) {
            serial_number = utils.parseDate(serial_number);
            if (serial_number instanceof Error) {
                return serial_number;
            }
            return serial_number.getSeconds();
        };

        exports.TIME = function (hour, minute, second) {
            hour = utils.parseNumber(hour);
            minute = utils.parseNumber(minute);
            second = utils.parseNumber(second);
            if (utils.anyIsError(hour, minute, second)) {
                return error.value;
            }
            if (hour < 0 || minute < 0 || second < 0) {
                return error.num;
            }
            return (3600 * hour + 60 * minute + second) / 86400;
        };

        exports.TIMEVALUE = function (time_text) {
            time_text = utils.parseDate(time_text);
            if (time_text instanceof Error) {
                return time_text;
            }
            return (3600 * time_text.getHours() + 60 * time_text.getMinutes() + time_text.getSeconds()) / 86400;
        };

        exports.TODAY = function () {
            return new Date();
        };

        exports.WEEKDAY = function (serial_number, return_type) {
            serial_number = utils.parseDate(serial_number);
            if (serial_number instanceof Error) {
                return serial_number;
            }
            if (return_type === undefined) {
                return_type = 1;
            }
            var day = serial_number.getDay();
            return WEEK_TYPES[return_type][day];
        };

        exports.WEEKNUM = function (serial_number, return_type) {
        };

        exports.WORKDAY = function (start_date, days, holidays) {
        };

        exports.WORKDAY.INTL = function (start_date, days, weekend, holidays) {
        };

        exports.YEAR = function (serial_number) {
            serial_number = utils.parseDate(serial_number);
            if (serial_number instanceof Error) {
                return serial_number;
            }
            return serial_number.getFullYear();
        };

        function isLeapYear(year) {
            return new Date(year, 1, 29).getMonth() === 1;
        }

        exports.YEARFRAC = function (start_date, end_date, basis) {
        };

        function serial(date) {
            var addOn = (date > -2203891200000) ? 2 : 1;
            return (date - d1900) / 86400000 + addOn;
        }

        return exports;
    })();

    jexcel.methods.database = (function () {
        var exports = {};

        function compact(array) {
            if (!array) {
                return array;
            }
            var result = [];
            for (var i = 0; i < array.length; ++i) {
                if (!array[i]) {
                    continue;
                }
                result.push(array[i]);
            }
            return result;
        }

        exports.FINDFIELD = function (database, title) {
            var index = null;
            for (var i = 0; i < database.length; i++) {
                if (database[i][0] === title) {
                    index = i;
                    break;
                }
            }

            // Return error if the input field title is incorrect
            if (index == null) {
                return error.value;
            }
            return index;
        };

        function findResultIndex(database, criterias) {
            var matches = {};
            for (var i = 1; i < database[0].length; ++i) {
                matches[i] = true;
            }
            var maxCriteriaLength = criterias[0].length;
            for (i = 1; i < criterias.length; ++i) {
                if (criterias[i].length > maxCriteriaLength) {
                    maxCriteriaLength = criterias[i].length;
                }
            }

            for (var k = 1; k < database.length; ++k) {
                for (var l = 1; l < database[k].length; ++l) {
                    var currentCriteriaResult = false;
                    var hasMatchingCriteria = false;
                    for (var j = 0; j < criterias.length; ++j) {
                        var criteria = criterias[j];
                        if (criteria.length < maxCriteriaLength) {
                            continue;
                        }

                        var criteriaField = criteria[0];
                        if (database[k][0] !== criteriaField) {
                            continue;
                        }
                        hasMatchingCriteria = true;
                        for (var p = 1; p < criteria.length; ++p) {
                            currentCriteriaResult = currentCriteriaResult
                                || eval(database[k][l] + criteria[p]); // jshint
                            // ignore:line
                        }
                    }
                    if (hasMatchingCriteria) {
                        matches[l] = matches[l] && currentCriteriaResult;
                    }
                }
            }

            var result = [];
            for (var n = 0; n < database[0].length; ++n) {
                if (matches[n]) {
                    result.push(n - 1);
                }
            }
            return result;
        }

        // Database functions
        exports.DAVERAGE = function (database, field, criteria) {
            // Return error if field is not a number and not a string
            if (isNaN(field) && (typeof field !== "string")) {
                return error.value;
            }
            var resultIndexes = findResultIndex(database, criteria);
            var targetFields = [];
            if (typeof field === "string") {
                var index = exports.FINDFIELD(database, field);
                targetFields = utils.rest(database[index]);
            } else {
                targetFields = utils.rest(database[field]);
            }
            var sum = 0;
            for (var i = 0; i < resultIndexes.length; i++) {
                sum += targetFields[resultIndexes[i]];
            }
            return resultIndexes.length === 0 ? error.div0 : sum / resultIndexes.length;
        };

        exports.DCOUNT = function (database, field, criteria) {
        };

        exports.DCOUNTA = function (database, field, criteria) {
        };

        exports.DGET = function (database, field, criteria) {
            // Return error if field is not a number and not a string
            if (isNaN(field) && (typeof field !== "string")) {
                return error.value;
            }
            var resultIndexes = findResultIndex(database, criteria);
            var targetFields = [];
            if (typeof field === "string") {
                var index = exports.FINDFIELD(database, field);
                targetFields = utils.rest(database[index]);
            } else {
                targetFields = utils.rest(database[field]);
            }
            // Return error if no record meets the criteria
            if (resultIndexes.length === 0) {
                return error.value;
            }
            // Returns the #NUM! error value because more than one record meets the
            // criteria
            if (resultIndexes.length > 1) {
                return error.num;
            }

            return targetFields[resultIndexes[0]];
        };

        exports.DMAX = function (database, field, criteria) {
            // Return error if field is not a number and not a string
            if (isNaN(field) && (typeof field !== "string")) {
                return error.value;
            }
            var resultIndexes = findResultIndex(database, criteria);
            var targetFields = [];
            if (typeof field === "string") {
                var index = exports.FINDFIELD(database, field);
                targetFields = utils.rest(database[index]);
            } else {
                targetFields = utils.rest(database[field]);
            }
            var maxValue = targetFields[resultIndexes[0]];
            for (var i = 1; i < resultIndexes.length; i++) {
                if (maxValue < targetFields[resultIndexes[i]]) {
                    maxValue = targetFields[resultIndexes[i]];
                }
            }
            return maxValue;
        };

        exports.DMIN = function (database, field, criteria) {
            // Return error if field is not a number and not a string
            if (isNaN(field) && (typeof field !== "string")) {
                return error.value;
            }
            var resultIndexes = findResultIndex(database, criteria);
            var targetFields = [];
            if (typeof field === "string") {
                var index = exports.FINDFIELD(database, field);
                targetFields = utils.rest(database[index]);
            } else {
                targetFields = utils.rest(database[field]);
            }
            var minValue = targetFields[resultIndexes[0]];
            for (var i = 1; i < resultIndexes.length; i++) {
                if (minValue > targetFields[resultIndexes[i]]) {
                    minValue = targetFields[resultIndexes[i]];
                }
            }
            return minValue;
        };

        exports.DPRODUCT = function (database, field, criteria) {
            // Return error if field is not a number and not a string
            if (isNaN(field) && (typeof field !== "string")) {
                return error.value;
            }
            var resultIndexes = findResultIndex(database, criteria);
            var targetFields = [];
            if (typeof field === "string") {
                var index = exports.FINDFIELD(database, field);
                targetFields = utils.rest(database[index]);
            } else {
                targetFields = utils.rest(database[field]);
            }
            var targetValues = [];
            for (var i = 0; i < resultIndexes.length; i++) {
                targetValues[i] = targetFields[resultIndexes[i]];
            }
            targetValues = compact(targetValues);
            var result = 1;
            for (i = 0; i < targetValues.length; i++) {
                result *= targetValues[i];
            }
            return result;
        };

        exports.DSTDEV = function (database, field, criteria) {
        };

        exports.DSTDEVP = function (database, field, criteria) {
        };

        exports.DSUM = function (database, field, criteria) {
        };

        exports.DVAR = function (database, field, criteria) {
        };

        exports.DVARP = function (database, field, criteria) {
        };

        exports.MATCH = function (lookupValue, lookupArray, matchType) {
            if (!lookupValue && !lookupArray) {
                return error.na;
            }
            if (arguments.length === 2) {
                matchType = 1;
            }
            if (!(lookupArray instanceof Array)) {
                return error.na;
            }
            if (matchType !== -1 && matchType !== 0 && matchType !== 1) {
                return error.na;
            }

            var index;
            var indexValue;

            for (var idx = 0; idx < lookupArray.length; idx++) {
                if (matchType === 1) {
                    if (lookupArray[idx] === lookupValue) {
                        return idx + 1;
                    } else if (lookupArray[idx] < lookupValue) {
                        if (!indexValue) {
                            index = idx + 1;
                            indexValue = lookupArray[idx];
                        } else if (lookupArray[idx] > indexValue) {
                            index = idx + 1;
                            indexValue = lookupArray[idx];
                        }
                    }
                } else if (matchType === 0) {
                    if (typeof lookupValue === 'string') {
                        lookupValue = lookupValue.replace(/\?/g, '.');
                        if (lookupArray[idx].toLowerCase().match(lookupValue.toLowerCase())) {
                            return idx + 1;
                        }
                    } else {
                        if (lookupArray[idx] === lookupValue) {
                            return idx + 1;
                        }
                    }
                } else if (matchType === -1) {
                    if (lookupArray[idx] === lookupValue) {
                        return idx + 1;
                    } else if (lookupArray[idx] > lookupValue) {
                        if (!indexValue) {
                            index = idx + 1;
                            indexValue = lookupArray[idx];
                        } else if (lookupArray[idx] < indexValue) {
                            index = idx + 1;
                            indexValue = lookupArray[idx];
                        }
                    }
                }
            }

            return index ? index : error.na;
        };

        return exports;
    })();

    jexcel.methods.engineering = (function () {
        var exports = {};

        function isValidBinaryNumber(number) {
            return (/^[01]{1,10}$/).test(number);
        }

        exports.BESSELI = function (x, n) {
        };

        exports.BESSELJ = function (x, n) {
        };

        exports.BESSELK = function (x, n) {
        };

        exports.BESSELY = function (x, n) {
        };

        exports.BIN2DEC = function (number) {
            // Return error if number is not binary or contains more than 10
            // characters (10 digits)
            if (!isValidBinaryNumber(number)) {
                return error.num;
            }

            // Convert binary number to decimal
            var result = parseInt(number, 2);

            // Handle negative numbers
            var stringified = number.toString();
            if (stringified.length === 10 && stringified.substring(0, 1) === '1') {
                return parseInt(stringified.substring(1), 2) - 512;
            } else {
                return result;
            }
        };

        exports.BIN2HEX = function (number, places) {
            // Return error if number is not binary or contains more than 10
            // characters (10 digits)
            if (!isValidBinaryNumber(number)) {
                return error.num;
            }

            // Ignore places and return a 10-character hexadecimal number if number
            // is negative
            var stringified = number.toString();
            if (stringified.length === 10 && stringified.substring(0, 1) === '1') {
                return (1099511627264 + parseInt(stringified.substring(1), 2)).toString(16);
            }

            // Convert binary number to hexadecimal
            var result = parseInt(number, 2).toString(16);

            // Return hexadecimal number using the minimum number of characters
            // necessary if places is undefined
            if (places === undefined) {
                return result;
            } else {
                // Return error if places is nonnumeric
                if (isNaN(places)) {
                    return error.value;
                }

                // Return error if places is negative
                if (places < 0) {
                    return error.num;
                }

                // Truncate places in case it is not an integer
                places = Math.floor(places);

                // Pad return value with leading 0s (zeros) if necessary (using
                // Underscore.string)
                return (places >= result.length) ? REPT('0', places - result.length) + result : error.num;
            }
        };

        exports.BIN2OCT = function (number, places) {
            // Return error if number is not binary or contains more than 10
            // characters (10 digits)
            if (!isValidBinaryNumber(number)) {
                return error.num;
            }

            // Ignore places and return a 10-character octal number if number is
            // negative
            var stringified = number.toString();
            if (stringified.length === 10 && stringified.substring(0, 1) === '1') {
                return (1073741312 + parseInt(stringified.substring(1), 2)).toString(8);
            }

            // Convert binary number to octal
            var result = parseInt(number, 2).toString(8);

            // Return octal number using the minimum number of characters necessary
            // if places is undefined
            if (places === undefined) {
                return result;
            } else {
                // Return error if places is nonnumeric
                if (isNaN(places)) {
                    return error.value;
                }

                // Return error if places is negative
                if (places < 0) {
                    return error.num;
                }

                // Truncate places in case it is not an integer
                places = Math.floor(places);

                // Pad return value with leading 0s (zeros) if necessary (using
                // Underscore.string)
                return (places >= result.length) ? REPT('0', places - result.length) + result : error.num;
            }
        };

        exports.BITAND = function (number1, number2) {
            // Return error if either number is a non-numeric value
            number1 = utils.parseNumber(number1);
            number2 = utils.parseNumber(number2);
            if (utils.anyIsError(number1, number2)) {
                return error.value;
            }

            // Return error if either number is less than 0
            if (number1 < 0 || number2 < 0) {
                return error.num;
            }

            // Return error if either number is a non-integer
            if (Math.floor(number1) !== number1 || Math.floor(number2) !== number2) {
                return error.num;
            }

            // Return error if either number is greater than (2^48)-1
            if (number1 > 281474976710655 || number2 > 281474976710655) {
                return error.num;
            }

            // Return bitwise AND of two numbers
            return number1 & number2;
        };

        exports.BITLSHIFT = function (number, shift) {
            number = utils.parseNumber(number);
            shift = utils.parseNumber(shift);
            if (utils.anyIsError(number, shift)) {
                return error.value;
            }

            // Return error if number is less than 0
            if (number < 0) {
                return error.num;
            }

            // Return error if number is a non-integer
            if (Math.floor(number) !== number) {
                return error.num;
            }

            // Return error if number is greater than (2^48)-1
            if (number > 281474976710655) {
                return error.num;
            }

            // Return error if the absolute value of shift is greater than 53
            if (Math.abs(shift) > 53) {
                return error.num;
            }

            // Return number shifted by shift bits to the left or to the right if
            // shift is negative
            return (shift >= 0) ? number << shift : number >> -shift;
        };

        exports.BITOR = function (number1, number2) {
            number1 = utils.parseNumber(number1);
            number2 = utils.parseNumber(number2);
            if (utils.anyIsError(number1, number2)) {
                return error.value;
            }

            // Return error if either number is less than 0
            if (number1 < 0 || number2 < 0) {
                return error.num;
            }

            // Return error if either number is a non-integer
            if (Math.floor(number1) !== number1 || Math.floor(number2) !== number2) {
                return error.num;
            }

            // Return error if either number is greater than (2^48)-1
            if (number1 > 281474976710655 || number2 > 281474976710655) {
                return error.num;
            }

            // Return bitwise OR of two numbers
            return number1 | number2;
        };

        exports.BITRSHIFT = function (number, shift) {
            number = utils.parseNumber(number);
            shift = utils.parseNumber(shift);
            if (utils.anyIsError(number, shift)) {
                return error.value;
            }

            // Return error if number is less than 0
            if (number < 0) {
                return error.num;
            }

            // Return error if number is a non-integer
            if (Math.floor(number) !== number) {
                return error.num;
            }

            // Return error if number is greater than (2^48)-1
            if (number > 281474976710655) {
                return error.num;
            }

            // Return error if the absolute value of shift is greater than 53
            if (Math.abs(shift) > 53) {
                return error.num;
            }

            // Return number shifted by shift bits to the right or to the left if
            // shift is negative
            return (shift >= 0) ? number >> shift : number << -shift;
        };

        exports.BITXOR = function (number1, number2) {
            number1 = utils.parseNumber(number1);
            number2 = utils.parseNumber(number2);
            if (utils.anyIsError(number1, number2)) {
                return error.value;
            }

            // Return error if either number is less than 0
            if (number1 < 0 || number2 < 0) {
                return error.num;
            }

            // Return error if either number is a non-integer
            if (Math.floor(number1) !== number1 || Math.floor(number2) !== number2) {
                return error.num;
            }

            // Return error if either number is greater than (2^48)-1
            if (number1 > 281474976710655 || number2 > 281474976710655) {
                return error.num;
            }

            // Return bitwise XOR of two numbers
            return number1 ^ number2;
        };

        exports.COMPLEX = function (real, imaginary, suffix) {
            real = utils.parseNumber(real);
            imaginary = utils.parseNumber(imaginary);
            if (utils.anyIsError(real, imaginary)) {
                return real;
            }

            // Set suffix
            suffix = (suffix === undefined) ? 'i' : suffix;

            // Return error if suffix is neither "i" nor "j"
            if (suffix !== 'i' && suffix !== 'j') {
                return error.value;
            }

            // Return complex number
            if (real === 0 && imaginary === 0) {
                return 0;
            } else if (real === 0) {
                return (imaginary === 1) ? suffix : imaginary.toString() + suffix;
            } else if (imaginary === 0) {
                return real.toString();
            } else {
                var sign = (imaginary > 0) ? '+' : '';
                return real.toString() + sign + ((imaginary === 1) ? suffix : imaginary.toString() + suffix);
            }
        };

        exports.CONVERT = function (number, from_unit, to_unit) {
            number = utils.parseNumber(number);
            if (number instanceof Error) {
                return number;
            }

            // List of units supported by CONVERT and units defined by the
            // International System of Units
            // [Name, Symbol, Alternate symbols, Quantity, ISU, CONVERT, Conversion
            // ratio]
            var units = [
                ["a.u. of action", "?", null, "action", false, false, 1.05457168181818e-34],
                ["a.u. of charge", "e", null, "electric_charge", false, false, 1.60217653141414e-19],
                ["a.u. of energy", "Eh", null, "energy", false, false, 4.35974417757576e-18],
                ["a.u. of length", "a?", null, "length", false, false, 5.29177210818182e-11],
                ["a.u. of mass", "m?", null, "mass", false, false, 9.10938261616162e-31],
                ["a.u. of time", "?/Eh", null, "time", false, false, 2.41888432650516e-17],
                ["admiralty knot", "admkn", null, "speed", false, true, 0.514773333],
                ["ampere", "A", null, "electric_current", true, false, 1],
                ["ampere per meter", "A/m", null, "magnetic_field_intensity", true, false, 1],
                ["ngstrm", "", ["ang"], "length", false, true, 1e-10],
                ["are", "ar", null, "area", false, true, 100],
                ["astronomical unit", "ua", null, "length", false, false, 1.49597870691667e-11],
                ["bar", "bar", null, "pressure", false, false, 100000],
                ["barn", "b", null, "area", false, false, 1e-28],
                ["becquerel", "Bq", null, "radioactivity", true, false, 1],
                ["bit", "bit", ["b"], "information", false, true, 1],
                ["btu", "BTU", ["btu"], "energy", false, true, 1055.05585262],
                ["byte", "byte", null, "information", false, true, 8],
                ["candela", "cd", null, "luminous_intensity", true, false, 1],
                ["candela per square metre", "cd/m?", null, "luminance", true, false, 1],
                ["coulomb", "C", null, "electric_charge", true, false, 1],
                ["cubic ngstrm", "ang3", ["ang^3"], "volume", false, true, 1e-30],
                ["cubic foot", "ft3", ["ft^3"], "volume", false, true, 0.028316846592],
                ["cubic inch", "in3", ["in^3"], "volume", false, true, 0.000016387064],
                ["cubic light-year", "ly3", ["ly^3"], "volume", false, true, 8.46786664623715e-47],
                ["cubic metre", "m?", null, "volume", true, true, 1],
                ["cubic mile", "mi3", ["mi^3"], "volume", false, true, 4168181825.44058],
                ["cubic nautical mile", "Nmi3", ["Nmi^3"], "volume", false, true, 6352182208],
                ["cubic Pica", "Pica3", ["Picapt3", "Pica^3", "Picapt^3"], "volume", false, true, 7.58660370370369e-8],
                ["cubic yard", "yd3", ["yd^3"], "volume", false, true, 0.764554857984],
                ["cup", "cup", null, "volume", false, true, 0.0002365882365],
                ["dalton", "Da", ["u"], "mass", false, false, 1.66053886282828e-27],
                ["day", "d", ["day"], "time", false, true, 86400],
                ["degree", "", null, "angle", false, false, 0.0174532925199433],
                ["degrees Rankine", "Rank", null, "temperature", false, true, 0.555555555555556],
                ["dyne", "dyn", ["dy"], "force", false, true, 0.00001],
                ["electronvolt", "eV", ["ev"], "energy", false, true, 1.60217656514141],
                ["ell", "ell", null, "length", false, true, 1.143],
                ["erg", "erg", ["e"], "energy", false, true, 1e-7],
                ["farad", "F", null, "electric_capacitance", true, false, 1],
                ["fluid ounce", "oz", null, "volume", false, true, 0.0000295735295625],
                ["foot", "ft", null, "length", false, true, 0.3048],
                ["foot-pound", "flb", null, "energy", false, true, 1.3558179483314],
                ["gal", "Gal", null, "acceleration", false, false, 0.01],
                ["gallon", "gal", null, "volume", false, true, 0.003785411784],
                ["gauss", "G", ["ga"], "magnetic_flux_density", false, true, 1],
                ["grain", "grain", null, "mass", false, true, 0.0000647989],
                ["gram", "g", null, "mass", false, true, 0.001],
                ["gray", "Gy", null, "absorbed_dose", true, false, 1],
                ["gross registered ton", "GRT", ["regton"], "volume", false, true, 2.8316846592],
                ["hectare", "ha", null, "area", false, true, 10000],
                ["henry", "H", null, "inductance", true, false, 1],
                ["hertz", "Hz", null, "frequency", true, false, 1],
                ["horsepower", "HP", ["h"], "power", false, true, 745.69987158227],
                ["horsepower-hour", "HPh", ["hh", "hph"], "energy", false, true, 2684519.538],
                ["hour", "h", ["hr"], "time", false, true, 3600],
                ["imperial gallon (U.K.)", "uk_gal", null, "volume", false, true, 0.00454609],
                ["imperial hundredweight", "lcwt", ["uk_cwt", "hweight"], "mass", false, true, 50.802345],
                ["imperial quart (U.K)", "uk_qt", null, "volume", false, true, 0.0011365225],
                ["imperial ton", "brton", ["uk_ton", "LTON"], "mass", false, true, 1016.046909],
                ["inch", "in", null, "length", false, true, 0.0254],
                ["international acre", "uk_acre", null, "area", false, true, 4046.8564224],
                ["IT calorie", "cal", null, "energy", false, true, 4.1868],
                ["joule", "J", null, "energy", true, true, 1],
                ["katal", "kat", null, "catalytic_activity", true, false, 1],
                ["kelvin", "K", ["kel"], "temperature", true, true, 1],
                ["kilogram", "kg", null, "mass", true, true, 1],
                ["knot", "kn", null, "speed", false, true, 0.514444444444444],
                ["light-year", "ly", null, "length", false, true, 9460730472580800],
                ["litre", "L", ["l", "lt"], "volume", false, true, 0.001],
                ["lumen", "lm", null, "luminous_flux", true, false, 1],
                ["lux", "lx", null, "illuminance", true, false, 1],
                ["maxwell", "Mx", null, "magnetic_flux", false, false, 1e-18],
                ["measurement ton", "MTON", null, "volume", false, true, 1.13267386368],
                ["meter per hour", "m/h", ["m/hr"], "speed", false, true, 0.00027777777777778],
                ["meter per second", "m/s", ["m/sec"], "speed", true, true, 1],
                ["meter per second squared", "m?s??", null, "acceleration", true, false, 1],
                ["parsec", "pc", ["parsec"], "length", false, true, 30856775814671900],
                ["meter squared per second", "m?/s", null, "kinematic_viscosity", true, false, 1],
                ["metre", "m", null, "length", true, true, 1],
                ["miles per hour", "mph", null, "speed", false, true, 0.44704],
                ["millimetre of mercury", "mmHg", null, "pressure", false, false, 133.322],
                ["minute", "?", null, "angle", false, false, 0.000290888208665722],
                ["minute", "min", ["mn"], "time", false, true, 60],
                ["modern teaspoon", "tspm", null, "volume", false, true, 0.000005],
                ["mole", "mol", null, "amount_of_substance", true, false, 1],
                ["morgen", "Morgen", null, "area", false, true, 2500],
                ["n.u. of action", "?", null, "action", false, false, 1.05457168181818e-34],
                ["n.u. of mass", "m?", null, "mass", false, false, 9.10938261616162e-31],
                ["n.u. of speed", "c?", null, "speed", false, false, 299792458],
                ["n.u. of time", "?/(me?c??)", null, "time", false, false, 1.28808866778687e-21],
                ["nautical mile", "M", ["Nmi"], "length", false, true, 1852],
                ["newton", "N", null, "force", true, true, 1],
                ["rsted", "Oe ", null, "magnetic_field_intensity", false, false, 79.5774715459477],
                ["ohm", "", null, "electric_resistance", true, false, 1],
                ["ounce mass", "ozm", null, "mass", false, true, 0.028349523125],
                ["pascal", "Pa", null, "pressure", true, false, 1],
                ["pascal second", "Pa?s", null, "dynamic_viscosity", true, false, 1],
                ["pferdestrke", "PS", null, "power", false, true, 735.49875],
                ["phot", "ph", null, "illuminance", false, false, 0.0001],
                ["pica (1/6 inch)", "pica", null, "length", false, true, 0.00035277777777778],
                ["pica (1/72 inch)", "Pica", ["Picapt"], "length", false, true, 0.00423333333333333],
                ["poise", "P", null, "dynamic_viscosity", false, false, 0.1],
                ["pond", "pond", null, "force", false, true, 0.00980665],
                ["pound force", "lbf", null, "force", false, true, 4.4482216152605],
                ["pound mass", "lbm", null, "mass", false, true, 0.45359237],
                ["quart", "qt", null, "volume", false, true, 0.000946352946],
                ["radian", "rad", null, "angle", true, false, 1],
                ["second", "?", null, "angle", false, false, 0.00000484813681109536],
                ["second", "s", ["sec"], "time", true, true, 1],
                ["short hundredweight", "cwt", ["shweight"], "mass", false, true, 45.359237],
                ["siemens", "S", null, "electrical_conductance", true, false, 1],
                ["sievert", "Sv", null, "equivalent_dose", true, false, 1],
                ["slug", "sg", null, "mass", false, true, 14.59390294],
                ["square ngstrm", "ang2", ["ang^2"], "area", false, true, 1e-20],
                ["square foot", "ft2", ["ft^2"], "area", false, true, 0.09290304],
                ["square inch", "in2", ["in^2"], "area", false, true, 0.00064516],
                ["square light-year", "ly2", ["ly^2"], "area", false, true, 8.95054210748189e+31],
                ["square meter", "m?", null, "area", true, true, 1],
                ["square mile", "mi2", ["mi^2"], "area", false, true, 2589988.110336],
                ["square nautical mile", "Nmi2", ["Nmi^2"], "area", false, true, 3429904],
                ["square Pica", "Pica2", ["Picapt2", "Pica^2", "Picapt^2"], "area", false, true, 0.00001792111111111],
                ["square yard", "yd2", ["yd^2"], "area", false, true, 0.83612736],
                ["statute mile", "mi", null, "length", false, true, 1609.344],
                ["steradian", "sr", null, "solid_angle", true, false, 1],
                ["stilb", "sb", null, "luminance", false, false, 0.0001],
                ["stokes", "St", null, "kinematic_viscosity", false, false, 0.0001],
                ["stone", "stone", null, "mass", false, true, 6.35029318],
                ["tablespoon", "tbs", null, "volume", false, true, 0.0000147868],
                ["teaspoon", "tsp", null, "volume", false, true, 0.00000492892],
                ["tesla", "T", null, "magnetic_flux_density", true, true, 1],
                ["thermodynamic calorie", "c", null, "energy", false, true, 4.184],
                ["ton", "ton", null, "mass", false, true, 907.18474],
                ["tonne", "t", null, "mass", false, false, 1000],
                ["U.K. pint", "uk_pt", null, "volume", false, true, 0.00056826125],
                ["U.S. bushel", "bushel", null, "volume", false, true, 0.03523907],
                ["U.S. oil barrel", "barrel", null, "volume", false, true, 0.158987295],
                ["U.S. pint", "pt", ["us_pt"], "volume", false, true, 0.000473176473],
                ["U.S. survey mile", "survey_mi", null, "length", false, true, 1609.347219],
                ["U.S. survey/statute acre", "us_acre", null, "area", false, true, 4046.87261],
                ["volt", "V", null, "voltage", true, false, 1],
                ["watt", "W", null, "power", true, true, 1],
                ["watt-hour", "Wh", ["wh"], "energy", false, true, 3600],
                ["weber", "Wb", null, "magnetic_flux", true, false, 1],
                ["yard", "yd", null, "length", false, true, 0.9144],
                ["year", "yr", null, "time", false, true, 31557600]
            ];

            // Binary prefixes
            // [Name, Prefix power of 2 value, Previx value, Abbreviation, Derived
            // from]
            var binary_prefixes = {
                Yi: ["yobi", 80, 1208925819614629174706176, "Yi", "yotta"],
                Zi: ["zebi", 70, 1180591620717411303424, "Zi", "zetta"],
                Ei: ["exbi", 60, 1152921504606846976, "Ei", "exa"],
                Pi: ["pebi", 50, 1125899906842624, "Pi", "peta"],
                Ti: ["tebi", 40, 1099511627776, "Ti", "tera"],
                Gi: ["gibi", 30, 1073741824, "Gi", "giga"],
                Mi: ["mebi", 20, 1048576, "Mi", "mega"],
                ki: ["kibi", 10, 1024, "ki", "kilo"]
            };

            // Unit prefixes
            // [Name, Multiplier, Abbreviation]
            var unit_prefixes = {
                Y: ["yotta", 1e+24, "Y"],
                Z: ["zetta", 1e+21, "Z"],
                E: ["exa", 1e+18, "E"],
                P: ["peta", 1e+15, "P"],
                T: ["tera", 1e+12, "T"],
                G: ["giga", 1e+09, "G"],
                M: ["mega", 1e+06, "M"],
                k: ["kilo", 1e+03, "k"],
                h: ["hecto", 1e+02, "h"],
                e: ["dekao", 1e+01, "e"],
                d: ["deci", 1e-01, "d"],
                c: ["centi", 1e-02, "c"],
                m: ["milli", 1e-03, "m"],
                u: ["micro", 1e-06, "u"],
                n: ["nano", 1e-09, "n"],
                p: ["pico", 1e-12, "p"],
                f: ["femto", 1e-15, "f"],
                a: ["atto", 1e-18, "a"],
                z: ["zepto", 1e-21, "z"],
                y: ["yocto", 1e-24, "y"]
            };

            // Initialize units and multipliers
            var from = null;
            var to = null;
            var base_from_unit = from_unit;
            var base_to_unit = to_unit;
            var from_multiplier = 1;
            var to_multiplier = 1;
            var alt;

            // Lookup from and to units
            for (var i = 0; i < units.length; i++) {
                alt = (units[i][2] === null) ? [] : units[i][2];
                if (units[i][1] === base_from_unit || alt.indexOf(base_from_unit) >= 0) {
                    from = units[i];
                }
                if (units[i][1] === base_to_unit || alt.indexOf(base_to_unit) >= 0) {
                    to = units[i];
                }
            }

            // Lookup from prefix
            if (from === null) {
                var from_binary_prefix = binary_prefixes[from_unit.substring(0, 2)];
                var from_unit_prefix = unit_prefixes[from_unit.substring(0, 1)];

                // Handle dekao unit prefix (only unit prefix with two characters)
                if (from_unit.substring(0, 2) === 'da') {
                    from_unit_prefix = ["dekao", 1e+01, "da"];
                }

                // Handle binary prefixes first (so that 'Yi' is processed before
                // 'Y')
                if (from_binary_prefix) {
                    from_multiplier = from_binary_prefix[2];
                    base_from_unit = from_unit.substring(2);
                } else if (from_unit_prefix) {
                    from_multiplier = from_unit_prefix[1];
                    base_from_unit = from_unit.substring(from_unit_prefix[2].length);
                }

                // Lookup from unit
                for (var j = 0; j < units.length; j++) {
                    alt = (units[j][2] === null) ? [] : units[j][2];
                    if (units[j][1] === base_from_unit || alt.indexOf(base_from_unit) >= 0) {
                        from = units[j];
                    }
                }
            }

            // Lookup to prefix
            if (to === null) {
                var to_binary_prefix = binary_prefixes[to_unit.substring(0, 2)];
                var to_unit_prefix = unit_prefixes[to_unit.substring(0, 1)];

                // Handle dekao unit prefix (only unit prefix with two characters)
                if (to_unit.substring(0, 2) === 'da') {
                    to_unit_prefix = ["dekao", 1e+01, "da"];
                }

                // Handle binary prefixes first (so that 'Yi' is processed before
                // 'Y')
                if (to_binary_prefix) {
                    to_multiplier = to_binary_prefix[2];
                    base_to_unit = to_unit.substring(2);
                } else if (to_unit_prefix) {
                    to_multiplier = to_unit_prefix[1];
                    base_to_unit = to_unit.substring(to_unit_prefix[2].length);
                }

                // Lookup to unit
                for (var k = 0; k < units.length; k++) {
                    alt = (units[k][2] === null) ? [] : units[k][2];
                    if (units[k][1] === base_to_unit || alt.indexOf(base_to_unit) >= 0) {
                        to = units[k];
                    }
                }
            }

            // Return error if a unit does not exist
            if (from === null || to === null) {
                return error.na;
            }

            // Return error if units represent different quantities
            if (from[3] !== to[3]) {
                return error.na;
            }

            // Return converted number
            return number * from[6] * from_multiplier / (to[6] * to_multiplier);
        };

        exports.DEC2BIN = function (number, places) {
            number = utils.parseNumber(number);
            if (number instanceof Error) {
                return number;
            }

            // Return error if number is not decimal, is lower than -512, or is
            // greater than 511
            if (!/^-?[0-9]{1,3}$/.test(number) || number < -512 || number > 511) {
                return error.num;
            }

            // Ignore places and return a 10-character binary number if number is
            // negative
            if (number < 0) {
                return '1' + REPT('0', 9 - (512 + number).toString(2).length) + (512 + number).toString(2);
            }

            // Convert decimal number to binary
            var result = parseInt(number, 10).toString(2);

            // Return binary number using the minimum number of characters necessary
            // if places is undefined
            if (typeof places === 'undefined') {
                return result;
            } else {
                // Return error if places is nonnumeric
                if (isNaN(places)) {
                    return error.value;
                }

                // Return error if places is negative
                if (places < 0) {
                    return error.num;
                }

                // Truncate places in case it is not an integer
                places = Math.floor(places);

                // Pad return value with leading 0s (zeros) if necessary (using
                // Underscore.string)
                return (places >= result.length) ? REPT('0', places - result.length) + result : error.num;
            }
        };

        exports.DEC2HEX = function (number, places) {
            number = utils.parseNumber(number);
            if (number instanceof Error) {
                return number;
            }

            // Return error if number is not decimal, is lower than -549755813888,
            // or is greater than 549755813887
            if (!/^-?[0-9]{1,12}$/.test(number) || number < -549755813888 || number > 549755813887) {
                return error.num;
            }

            // Ignore places and return a 10-character hexadecimal number if number
            // is negative
            if (number < 0) {
                return (1099511627776 + number).toString(16);
            }

            // Convert decimal number to hexadecimal
            var result = parseInt(number, 10).toString(16);

            // Return hexadecimal number using the minimum number of characters
            // necessary if places is undefined
            if (typeof places === 'undefined') {
                return result;
            } else {
                // Return error if places is nonnumeric
                if (isNaN(places)) {
                    return error.value;
                }

                // Return error if places is negative
                if (places < 0) {
                    return error.num;
                }

                // Truncate places in case it is not an integer
                places = Math.floor(places);

                // Pad return value with leading 0s (zeros) if necessary (using
                // Underscore.string)
                return (places >= result.length) ? REPT('0', places - result.length) + result : error.num;
            }
        };

        exports.DEC2OCT = function (number, places) {
            number = utils.parseNumber(number);
            if (number instanceof Error) {
                return number;
            }

            // Return error if number is not decimal, is lower than -549755813888,
            // or is greater than 549755813887
            if (!/^-?[0-9]{1,9}$/.test(number) || number < -536870912 || number > 536870911) {
                return error.num;
            }

            // Ignore places and return a 10-character octal number if number is
            // negative
            if (number < 0) {
                return (1073741824 + number).toString(8);
            }

            // Convert decimal number to octal
            var result = parseInt(number, 10).toString(8);

            // Return octal number using the minimum number of characters necessary
            // if places is undefined
            if (typeof places === 'undefined') {
                return result;
            } else {
                // Return error if places is nonnumeric
                if (isNaN(places)) {
                    return error.value;
                }

                // Return error if places is negative
                if (places < 0) {
                    return error.num;
                }

                // Truncate places in case it is not an integer
                places = Math.floor(places);

                // Pad return value with leading 0s (zeros) if necessary (using
                // Underscore.string)
                return (places >= result.length) ? REPT('0', places - result.length) + result : error.num;
            }
        };

        exports.DELTA = function (number1, number2) {
            // Set number2 to zero if undefined
            number2 = (number2 === undefined) ? 0 : number2;
            number1 = utils.parseNumber(number1);
            number2 = utils.parseNumber(number2);
            if (utils.anyIsError(number1, number2)) {
                return error.value;
            }

            // Return delta
            return (number1 === number2) ? 1 : 0;
        };

        exports.ERF = function (lower_bound, upper_bound) {
        };

        exports.ERF.PRECISE = function () {
        };

        exports.ERFC = function (x) {
        };

        exports.ERFC.PRECISE = function () {
        };

        exports.GESTEP = function (number, step) {
            step = step || 0;
            number = utils.parseNumber(number);
            if (utils.anyIsError(step, number)) {
                return number;
            }

            // Return delta
            return (number >= step) ? 1 : 0;
        };

        exports.HEX2BIN = function (number, places) {
            // Return error if number is not hexadecimal or contains more than ten
            // characters (10 digits)
            if (!/^[0-9A-Fa-f]{1,10}$/.test(number)) {
                return error.num;
            }

            // Check if number is negative
            var negative = (number.length === 10 && number.substring(0, 1).toLowerCase() === 'f') ? true : false;

            // Convert hexadecimal number to decimal
            var decimal = (negative) ? parseInt(number, 16) - 1099511627776 : parseInt(number, 16);

            // Return error if number is lower than -512 or greater than 511
            if (decimal < -512 || decimal > 511) {
                return error.num;
            }

            // Ignore places and return a 10-character binary number if number is
            // negative
            if (negative) {
                return '1' + REPT('0', 9 - (512 + decimal).toString(2).length) + (512 + decimal).toString(2);
            }

            // Convert decimal number to binary
            var result = decimal.toString(2);

            // Return binary number using the minimum number of characters necessary
            // if places is undefined
            if (places === undefined) {
                return result;
            } else {
                // Return error if places is nonnumeric
                if (isNaN(places)) {
                    return error.value;
                }

                // Return error if places is negative
                if (places < 0) {
                    return error.num;
                }

                // Truncate places in case it is not an integer
                places = Math.floor(places);

                // Pad return value with leading 0s (zeros) if necessary (using
                // Underscore.string)
                return (places >= result.length) ? REPT('0', places - result.length) + result : error.num;
            }
        };

        exports.HEX2DEC = function (number) {
            // Return error if number is not hexadecimal or contains more than ten
            // characters (10 digits)
            if (!/^[0-9A-Fa-f]{1,10}$/.test(number)) {
                return error.num;
            }

            // Convert hexadecimal number to decimal
            var decimal = parseInt(number, 16);

            // Return decimal number
            return (decimal >= 549755813888) ? decimal - 1099511627776 : decimal;
        };

        exports.HEX2OCT = function (number, places) {
            // Return error if number is not hexadecimal or contains more than ten
            // characters (10 digits)
            if (!/^[0-9A-Fa-f]{1,10}$/.test(number)) {
                return error.num;
            }

            // Convert hexadecimal number to decimal
            var decimal = parseInt(number, 16);

            // Return error if number is positive and greater than 0x1fffffff
            // (536870911)
            if (decimal > 536870911 && decimal < 1098974756864) {
                return error.num;
            }

            // Ignore places and return a 10-character octal number if number is
            // negative
            if (decimal >= 1098974756864) {
                return (decimal - 1098437885952).toString(8);
            }

            // Convert decimal number to octal
            var result = decimal.toString(8);

            // Return octal number using the minimum number of characters necessary
            // if places is undefined
            if (places === undefined) {
                return result;
            } else {
                // Return error if places is nonnumeric
                if (isNaN(places)) {
                    return error.value;
                }

                // Return error if places is negative
                if (places < 0) {
                    return error.num;
                }

                // Truncate places in case it is not an integer
                places = Math.floor(places);

                // Pad return value with leading 0s (zeros) if necessary (using
                // Underscore.string)
                return (places >= result.length) ? REPT('0', places - result.length) + result : error.num;
            }
        };

        exports.IMABS = function (inumber) {
            // Lookup real and imaginary coefficients using exports.js
            // [http://formulajs.org]
            var x = exports.IMREAL(inumber);
            var y = exports.IMAGINARY(inumber);

            // Return error if either coefficient is not a number
            if (utils.anyIsError(x, y)) {
                return error.value;
            }

            // Return absolute value of complex number
            return Math.sqrt(Math.pow(x, 2) + Math.pow(y, 2));
        };

        exports.IMAGINARY = function (inumber) {
            if (inumber === undefined || inumber === true || inumber === false) {
                return error.value;
            }

            // Return 0 if inumber is equal to 0
            if (inumber === 0 || inumber === '0') {
                return 0;
            }

            // Handle special cases
            if (['i', 'j'].indexOf(inumber) >= 0) {
                return 1;
            }

            // Normalize imaginary coefficient
            inumber = inumber.replace('+i', '+1i').replace('-i', '-1i').replace('+j', '+1j').replace('-j', '-1j');

            // Lookup sign
            var plus = inumber.indexOf('+');
            var minus = inumber.indexOf('-');
            if (plus === 0) {
                plus = inumber.indexOf('+', 1);
            }

            if (minus === 0) {
                minus = inumber.indexOf('-', 1);
            }

            // Lookup imaginary unit
            var last = inumber.substring(inumber.length - 1, inumber.length);
            var unit = (last === 'i' || last === 'j');

            if (plus >= 0 || minus >= 0) {
                // Return error if imaginary unit is neither i nor j
                if (!unit) {
                    return error.num;
                }

                // Return imaginary coefficient of complex number
                if (plus >= 0) {
                    return (isNaN(inumber.substring(0, plus)) || isNaN(inumber.substring(plus + 1, inumber.length - 1))) ?
                        error.num :
                        Number(inumber.substring(plus + 1, inumber.length - 1));
                } else {
                    return (isNaN(inumber.substring(0, minus)) || isNaN(inumber.substring(minus + 1, inumber.length - 1))) ?
                        error.num :
                        -Number(inumber.substring(minus + 1, inumber.length - 1));
                }
            } else {
                if (unit) {
                    return (isNaN(inumber.substring(0, inumber.length - 1))) ? error.num : inumber.substring(0, inumber.length - 1);
                } else {
                    return (isNaN(inumber)) ? error.num : 0;
                }
            }
        };

        exports.IMARGUMENT = function (inumber) {
            // Lookup real and imaginary coefficients using exports.js
            // [http://formulajs.org]
            var x = exports.IMREAL(inumber);
            var y = exports.IMAGINARY(inumber);

            // Return error if either coefficient is not a number
            if (utils.anyIsError(x, y)) {
                return error.value;
            }

            // Return error if inumber is equal to zero
            if (x === 0 && y === 0) {
                return error.div0;
            }

            // Return PI/2 if x is equal to zero and y is positive
            if (x === 0 && y > 0) {
                return Math.PI / 2;
            }

            // Return -PI/2 if x is equal to zero and y is negative
            if (x === 0 && y < 0) {
                return -Math.PI / 2;
            }

            // Return zero if x is negative and y is equal to zero
            if (y === 0 && x > 0) {
                return 0;
            }

            // Return zero if x is negative and y is equal to zero
            if (y === 0 && x < 0) {
                return -Math.PI;
            }

            // Return argument of complex number
            if (x > 0) {
                return Math.atan(y / x);
            } else if (x < 0 && y >= 0) {
                return Math.atan(y / x) + Math.PI;
            } else {
                return Math.atan(y / x) - Math.PI;
            }
        };

        exports.IMCONJUGATE = function (inumber) {
            // Lookup real and imaginary coefficients using exports.js
            // [http://formulajs.org]
            var x = exports.IMREAL(inumber);
            var y = exports.IMAGINARY(inumber);

            if (utils.anyIsError(x, y)) {
                return error.value;
            }

            // Lookup imaginary unit
            var unit = inumber.substring(inumber.length - 1);
            unit = (unit === 'i' || unit === 'j') ? unit : 'i';

            // Return conjugate of complex number
            return (y !== 0) ? exports.COMPLEX(x, -y, unit) : inumber;
        };

        exports.IMCOS = function (inumber) {
            // Lookup real and imaginary coefficients using exports.js
            // [http://formulajs.org]
            var x = exports.IMREAL(inumber);
            var y = exports.IMAGINARY(inumber);

            if (utils.anyIsError(x, y)) {
                return error.value;
            }

            // Lookup imaginary unit
            var unit = inumber.substring(inumber.length - 1);
            unit = (unit === 'i' || unit === 'j') ? unit : 'i';

            // Return cosine of complex number
            return exports.COMPLEX(Math.cos(x) * (Math.exp(y) + Math.exp(-y)) / 2, -Math.sin(x) * (Math.exp(y) - Math.exp(-y)) / 2, unit);
        };

        exports.IMCOSH = function (inumber) {
            // Lookup real and imaginary coefficients using exports.js
            // [http://formulajs.org]
            var x = exports.IMREAL(inumber);
            var y = exports.IMAGINARY(inumber);

            if (utils.anyIsError(x, y)) {
                return error.value;
            }

            // Lookup imaginary unit
            var unit = inumber.substring(inumber.length - 1);
            unit = (unit === 'i' || unit === 'j') ? unit : 'i';

            // Return hyperbolic cosine of complex number
            return exports.COMPLEX(Math.cos(y) * (Math.exp(x) + Math.exp(-x)) / 2, Math.sin(y) * (Math.exp(x) - Math.exp(-x)) / 2, unit);
        };

        exports.IMCOT = function (inumber) {
            // Lookup real and imaginary coefficients using Formula.js
            // [http://formulajs.org]
            var x = exports.IMREAL(inumber);
            var y = exports.IMAGINARY(inumber);

            if (utils.anyIsError(x, y)) {
                return error.value;
            }

            // Return cotangent of complex number
            return exports.IMDIV(exports.IMCOS(inumber), exports.IMSIN(inumber));
        };

        exports.IMDIV = function (inumber1, inumber2) {
            // Lookup real and imaginary coefficients using Formula.js
            // [http://formulajs.org]
            var a = exports.IMREAL(inumber1);
            var b = exports.IMAGINARY(inumber1);
            var c = exports.IMREAL(inumber2);
            var d = exports.IMAGINARY(inumber2);

            if (utils.anyIsError(a, b, c, d)) {
                return error.value;
            }

            // Lookup imaginary unit
            var unit1 = inumber1.substring(inumber1.length - 1);
            var unit2 = inumber2.substring(inumber2.length - 1);
            var unit = 'i';
            if (unit1 === 'j') {
                unit = 'j';
            } else if (unit2 === 'j') {
                unit = 'j';
            }

            // Return error if inumber2 is null
            if (c === 0 && d === 0) {
                return error.num;
            }

            // Return exponential of complex number
            var den = c * c + d * d;
            return exports.COMPLEX((a * c + b * d) / den, (b * c - a * d) / den, unit);
        };

        exports.IMEXP = function (inumber) {
            // Lookup real and imaginary coefficients using Formula.js
            // [http://formulajs.org]
            var x = exports.IMREAL(inumber);
            var y = exports.IMAGINARY(inumber);

            if (utils.anyIsError(x, y)) {
                return error.value;
            }

            // Lookup imaginary unit
            var unit = inumber.substring(inumber.length - 1);
            unit = (unit === 'i' || unit === 'j') ? unit : 'i';

            // Return exponential of complex number
            var e = Math.exp(x);
            return exports.COMPLEX(e * Math.cos(y), e * Math.sin(y), unit);
        };

        exports.IMLN = function (inumber) {
            // Lookup real and imaginary coefficients using Formula.js
            // [http://formulajs.org]
            var x = exports.IMREAL(inumber);
            var y = exports.IMAGINARY(inumber);

            if (utils.anyIsError(x, y)) {
                return error.value;
            }

            // Lookup imaginary unit
            var unit = inumber.substring(inumber.length - 1);
            unit = (unit === 'i' || unit === 'j') ? unit : 'i';

            // Return exponential of complex number
            return exports.COMPLEX(Math.log(Math.sqrt(x * x + y * y)), Math.atan(y / x), unit);
        };

        exports.IMLOG10 = function (inumber) {
            // Lookup real and imaginary coefficients using Formula.js
            // [http://formulajs.org]
            var x = exports.IMREAL(inumber);
            var y = exports.IMAGINARY(inumber);

            if (utils.anyIsError(x, y)) {
                return error.value;
            }

            // Lookup imaginary unit
            var unit = inumber.substring(inumber.length - 1);
            unit = (unit === 'i' || unit === 'j') ? unit : 'i';

            // Return exponential of complex number
            return exports.COMPLEX(Math.log(Math.sqrt(x * x + y * y)) / Math.log(10), Math.atan(y / x) / Math.log(10), unit);
        };

        exports.IMLOG2 = function (inumber) {
            // Lookup real and imaginary coefficients using Formula.js
            // [http://formulajs.org]
            var x = exports.IMREAL(inumber);
            var y = exports.IMAGINARY(inumber);

            if (utils.anyIsError(x, y)) {
                return error.value;
            }

            // Lookup imaginary unit
            var unit = inumber.substring(inumber.length - 1);
            unit = (unit === 'i' || unit === 'j') ? unit : 'i';

            // Return exponential of complex number
            return exports.COMPLEX(Math.log(Math.sqrt(x * x + y * y)) / Math.log(2), Math.atan(y / x) / Math.log(2), unit);
        };

        exports.IMPOWER = function (inumber, number) {
            number = utils.parseNumber(number);
            var x = exports.IMREAL(inumber);
            var y = exports.IMAGINARY(inumber);
            if (utils.anyIsError(number, x, y)) {
                return error.value;
            }

            // Lookup imaginary unit
            var unit = inumber.substring(inumber.length - 1);
            unit = (unit === 'i' || unit === 'j') ? unit : 'i';

            // Calculate power of modulus
            var p = Math.pow(exports.IMABS(inumber), number);

            // Calculate argument
            var t = exports.IMARGUMENT(inumber);

            // Return exponential of complex number
            return exports.COMPLEX(p * Math.cos(number * t), p * Math.sin(number * t), unit);
        };

        exports.IMPRODUCT = function () {
            // Initialize result
            var result = arguments[0];

            // Loop on all numbers
            for (var i = 1; i < arguments.length; i++) {
                // Lookup coefficients of two complex numbers
                var a = exports.IMREAL(result);
                var b = exports.IMAGINARY(result);
                var c = exports.IMREAL(arguments[i]);
                var d = exports.IMAGINARY(arguments[i]);

                if (utils.anyIsError(a, b, c, d)) {
                    return error.value;
                }

                // Complute product of two complex numbers
                result = exports.COMPLEX(a * c - b * d, a * d + b * c);
            }

            // Return product of complex numbers
            return result;
        };

        exports.IMREAL = function (inumber) {
            if (inumber === undefined || inumber === true || inumber === false) {
                return error.value;
            }

            // Return 0 if inumber is equal to 0
            if (inumber === 0 || inumber === '0') {
                return 0;
            }

            // Handle special cases
            if (['i', '+i', '1i', '+1i', '-i', '-1i', 'j', '+j', '1j', '+1j', '-j', '-1j'].indexOf(inumber) >= 0) {
                return 0;
            }

            // Lookup sign
            var plus = inumber.indexOf('+');
            var minus = inumber.indexOf('-');
            if (plus === 0) {
                plus = inumber.indexOf('+', 1);
            }
            if (minus === 0) {
                minus = inumber.indexOf('-', 1);
            }

            // Lookup imaginary unit
            var last = inumber.substring(inumber.length - 1, inumber.length);
            var unit = (last === 'i' || last === 'j');

            if (plus >= 0 || minus >= 0) {
                // Return error if imaginary unit is neither i nor j
                if (!unit) {
                    return error.num;
                }

                // Return real coefficient of complex number
                if (plus >= 0) {
                    return (isNaN(inumber.substring(0, plus)) || isNaN(inumber.substring(plus + 1, inumber.length - 1))) ?
                        error.num :
                        Number(inumber.substring(0, plus));
                } else {
                    return (isNaN(inumber.substring(0, minus)) || isNaN(inumber.substring(minus + 1, inumber.length - 1))) ?
                        error.num :
                        Number(inumber.substring(0, minus));
                }
            } else {
                if (unit) {
                    return (isNaN(inumber.substring(0, inumber.length - 1))) ? error.num : 0;
                } else {
                    return (isNaN(inumber)) ? error.num : inumber;
                }
            }
        };

        exports.IMSEC = function (inumber) {
            // Return error if inumber is a logical value
            if (inumber === true || inumber === false) {
                return error.value;
            }

            // Lookup real and imaginary coefficients using Formula.js
            // [http://formulajs.org]
            var x = exports.IMREAL(inumber);
            var y = exports.IMAGINARY(inumber);

            if (utils.anyIsError(x, y)) {
                return error.value;
            }

            // Return secant of complex number
            return exports.IMDIV('1', exports.IMCOS(inumber));
        };

        exports.IMSECH = function (inumber) {
            // Lookup real and imaginary coefficients using Formula.js
            // [http://formulajs.org]
            var x = exports.IMREAL(inumber);
            var y = exports.IMAGINARY(inumber);

            if (utils.anyIsError(x, y)) {
                return error.value;
            }

            // Return hyperbolic secant of complex number
            return exports.IMDIV('1', exports.IMCOSH(inumber));
        };

        exports.IMSIN = function (inumber) {
            // Lookup real and imaginary coefficients using Formula.js
            // [http://formulajs.org]
            var x = exports.IMREAL(inumber);
            var y = exports.IMAGINARY(inumber);

            if (utils.anyIsError(x, y)) {
                return error.value;
            }

            // Lookup imaginary unit
            var unit = inumber.substring(inumber.length - 1);
            unit = (unit === 'i' || unit === 'j') ? unit : 'i';

            // Return sine of complex number
            return exports.COMPLEX(Math.sin(x) * (Math.exp(y) + Math.exp(-y)) / 2, Math.cos(x) * (Math.exp(y) - Math.exp(-y)) / 2, unit);
        };

        exports.IMSINH = function (inumber) {
            // Lookup real and imaginary coefficients using Formula.js
            // [http://formulajs.org]
            var x = exports.IMREAL(inumber);
            var y = exports.IMAGINARY(inumber);

            if (utils.anyIsError(x, y)) {
                return error.value;
            }

            // Lookup imaginary unit
            var unit = inumber.substring(inumber.length - 1);
            unit = (unit === 'i' || unit === 'j') ? unit : 'i';

            // Return hyperbolic sine of complex number
            return exports.COMPLEX(Math.cos(y) * (Math.exp(x) - Math.exp(-x)) / 2, Math.sin(y) * (Math.exp(x) + Math.exp(-x)) / 2, unit);
        };

        exports.IMSQRT = function (inumber) {
            // Lookup real and imaginary coefficients using Formula.js
            // [http://formulajs.org]
            var x = exports.IMREAL(inumber);
            var y = exports.IMAGINARY(inumber);

            if (utils.anyIsError(x, y)) {
                return error.value;
            }

            // Lookup imaginary unit
            var unit = inumber.substring(inumber.length - 1);
            unit = (unit === 'i' || unit === 'j') ? unit : 'i';

            // Calculate power of modulus
            var s = Math.sqrt(exports.IMABS(inumber));

            // Calculate argument
            var t = exports.IMARGUMENT(inumber);

            // Return exponential of complex number
            return exports.COMPLEX(s * Math.cos(t / 2), s * Math.sin(t / 2), unit);
        };

        exports.IMCSC = function (inumber) {
            // Return error if inumber is a logical value
            if (inumber === true || inumber === false) {
                return error.value;
            }

            // Lookup real and imaginary coefficients using Formula.js
            // [http://formulajs.org]
            var x = exports.IMREAL(inumber);
            var y = exports.IMAGINARY(inumber);

            // Return error if either coefficient is not a number
            if (utils.anyIsError(x, y)) {
                return error.num;
            }

            // Return cosecant of complex number
            return exports.IMDIV('1', exports.IMSIN(inumber));
        };

        exports.IMCSCH = function (inumber) {
            // Return error if inumber is a logical value
            if (inumber === true || inumber === false) {
                return error.value;
            }

            // Lookup real and imaginary coefficients using Formula.js
            // [http://formulajs.org]
            var x = exports.IMREAL(inumber);
            var y = exports.IMAGINARY(inumber);

            // Return error if either coefficient is not a number
            if (utils.anyIsError(x, y)) {
                return error.num;
            }

            // Return hyperbolic cosecant of complex number
            return exports.IMDIV('1', exports.IMSINH(inumber));
        };

        exports.IMSUB = function (inumber1, inumber2) {
            // Lookup real and imaginary coefficients using Formula.js
            // [http://formulajs.org]
            var a = this.IMREAL(inumber1);
            var b = this.IMAGINARY(inumber1);
            var c = this.IMREAL(inumber2);
            var d = this.IMAGINARY(inumber2);

            if (utils.anyIsError(a, b, c, d)) {
                return error.value;
            }

            // Lookup imaginary unit
            var unit1 = inumber1.substring(inumber1.length - 1);
            var unit2 = inumber2.substring(inumber2.length - 1);
            var unit = 'i';
            if (unit1 === 'j') {
                unit = 'j';
            } else if (unit2 === 'j') {
                unit = 'j';
            }

            // Return _ of two complex numbers
            return this.COMPLEX(a - c, b - d, unit);
        };

        exports.IMSUM = function () {
            var args = utils.flatten(arguments);

            // Initialize result
            var result = args[0];

            // Loop on all numbers
            for (var i = 1; i < args.length; i++) {
                // Lookup coefficients of two complex numbers
                var a = this.IMREAL(result);
                var b = this.IMAGINARY(result);
                var c = this.IMREAL(args[i]);
                var d = this.IMAGINARY(args[i]);

                if (utils.anyIsError(a, b, c, d)) {
                    return error.value;
                }

                // Complute product of two complex numbers
                result = this.COMPLEX(a + c, b + d);
            }

            // Return sum of complex numbers
            return result;
        };

        exports.IMTAN = function (inumber) {
            // Return error if inumber is a logical value
            if (inumber === true || inumber === false) {
                return error.value;
            }

            // Lookup real and imaginary coefficients using Formula.js
            // [http://formulajs.org]
            var x = exports.IMREAL(inumber);
            var y = exports.IMAGINARY(inumber);

            if (utils.anyIsError(x, y)) {
                return error.value;
            }

            // Return tangent of complex number
            return this.IMDIV(this.IMSIN(inumber), this.IMCOS(inumber));
        };

        exports.OCT2BIN = function (number, places) {
            // Return error if number is not hexadecimal or contains more than ten
            // characters (10 digits)
            if (!/^[0-7]{1,10}$/.test(number)) {
                return error.num;
            }

            // Check if number is negative
            var negative = (number.length === 10 && number.substring(0, 1) === '7') ? true : false;

            // Convert octal number to decimal
            var decimal = (negative) ? parseInt(number, 8) - 1073741824 : parseInt(number, 8);

            // Return error if number is lower than -512 or greater than 511
            if (decimal < -512 || decimal > 511) {
                return error.num;
            }

            // Ignore places and return a 10-character binary number if number is
            // negative
            if (negative) {
                return '1' + REPT('0', 9 - (512 + decimal).toString(2).length) + (512 + decimal).toString(2);
            }

            // Convert decimal number to binary
            var result = decimal.toString(2);

            // Return binary number using the minimum number of characters necessary
            // if places is undefined
            if (typeof places === 'undefined') {
                return result;
            } else {
                // Return error if places is nonnumeric
                if (isNaN(places)) {
                    return error.value;
                }

                // Return error if places is negative
                if (places < 0) {
                    return error.num;
                }

                // Truncate places in case it is not an integer
                places = Math.floor(places);

                // Pad return value with leading 0s (zeros) if necessary (using
                // Underscore.string)
                return (places >= result.length) ? REPT('0', places - result.length) + result : error.num;
            }
        };

        exports.OCT2DEC = function (number) {
            // Return error if number is not octal or contains more than ten
            // characters (10 digits)
            if (!/^[0-7]{1,10}$/.test(number)) {
                return error.num;
            }

            // Convert octal number to decimal
            var decimal = parseInt(number, 8);

            // Return decimal number
            return (decimal >= 536870912) ? decimal - 1073741824 : decimal;
        };

        exports.OCT2HEX = function (number, places) {
            // Return error if number is not octal or contains more than ten
            // characters (10 digits)
            if (!/^[0-7]{1,10}$/.test(number)) {
                return error.num;
            }

            // Convert octal number to decimal
            var decimal = parseInt(number, 8);

            // Ignore places and return a 10-character octal number if number is
            // negative
            if (decimal >= 536870912) {
                return 'ff' + (decimal + 3221225472).toString(16);
            }

            // Convert decimal number to hexadecimal
            var result = decimal.toString(16);

            // Return hexadecimal number using the minimum number of characters
            // necessary if places is undefined
            if (places === undefined) {
                return result;
            } else {
                // Return error if places is nonnumeric
                if (isNaN(places)) {
                    return error.value;
                }

                // Return error if places is negative
                if (places < 0) {
                    return error.num;
                }

                // Truncate places in case it is not an integer
                places = Math.floor(places);

                // Pad return value with leading 0s (zeros) if necessary (using
                // Underscore.string)
                return (places >= result.length) ? REPT('0', places - result.length) + result : error.num;
            }
        };

        return exports;
    })();

    jexcel.methods.financial = (function () {
        var exports = {};

        function validDate(d) {
            return d && d.getTime && !isNaN(d.getTime());
        }

        function ensureDate(d) {
            return (d instanceof Date) ? d : new Date(d);
        }

        exports.ACCRINT = function (issue, first, settlement, rate, par, frequency, basis) {
            // Return error if either date is invalid
            issue = ensureDate(issue);
            first = ensureDate(first);
            settlement = ensureDate(settlement);
            if (!validDate(issue) || !validDate(first) || !validDate(settlement)) {
                return '#VALUE!';
            }

            // Return error if either rate or par are lower than or equal to zero
            if (rate <= 0 || par <= 0) {
                return '#NUM!';
            }

            // Return error if frequency is neither 1, 2, or 4
            if ([1, 2, 4].indexOf(frequency) === -1) {
                return '#NUM!';
            }

            // Return error if basis is neither 0, 1, 2, 3, or 4
            if ([0, 1, 2, 3, 4].indexOf(basis) === -1) {
                return '#NUM!';
            }

            // Return error if settlement is before or equal to issue
            if (settlement <= issue) {
                return '#NUM!';
            }

            // Set default values
            par = par || 0;
            basis = basis || 0;

            // Compute accrued interest
            return par * rate * YEARFRAC(issue, settlement, basis);
        };

        exports.ACCRINTM = null;

        exports.AMORDEGRC = null;

        exports.AMORLINC = null;

        exports.COUPDAYBS = null;

        exports.COUPDAYS = null;

        exports.COUPDAYSNC = null;

        exports.COUPNCD = null;

        exports.COUPNUM = null;

        exports.COUPPCD = null;

        exports.CUMIPMT = function (rate, periods, value, start, end, type) {
            // Credits: algorithm inspired by Apache OpenOffice
            // Credits: Hannes Stiebitzhofer for the translations of function and
            // variable names
            // Requires exports.FV() and exports.PMT() from exports.js
            // [http://stoic.com/exports/]

            rate = utils.parseNumber(rate);
            periods = utils.parseNumber(periods);
            value = utils.parseNumber(value);
            if (utils.anyIsError(rate, periods, value)) {
                return error.value;
            }

            // Return error if either rate, periods, or value are lower than or
            // equal to zero
            if (rate <= 0 || periods <= 0 || value <= 0) {
                return error.num;
            }

            // Return error if start < 1, end < 1, or start > end
            if (start < 1 || end < 1 || start > end) {
                return error.num;
            }

            // Return error if type is neither 0 nor 1
            if (type !== 0 && type !== 1) {
                return error.num;
            }

            // Compute cumulative interest
            var payment = exports.PMT(rate, periods, value, 0, type);
            var interest = 0;

            if (start === 1) {
                if (type === 0) {
                    interest = -value;
                    start++;
                }
            }

            for (var i = start; i <= end; i++) {
                if (type === 1) {
                    interest += exports.FV(rate, i - 2, payment, value, 1) - payment;
                } else {
                    interest += exports.FV(rate, i - 1, payment, value, 0);
                }
            }
            interest *= rate;

            // Return cumulative interest
            return interest;
        };

        exports.CUMPRINC = function (rate, periods, value, start, end, type) {
            // Credits: algorithm inspired by Apache OpenOffice
            // Credits: Hannes Stiebitzhofer for the translations of function and
            // variable names

            rate = utils.parseNumber(rate);
            periods = utils.parseNumber(periods);
            value = utils.parseNumber(value);
            if (utils.anyIsError(rate, periods, value)) {
                return error.value;
            }

            // Return error if either rate, periods, or value are lower than or
            // equal to zero
            if (rate <= 0 || periods <= 0 || value <= 0) {
                return error.num;
            }

            // Return error if start < 1, end < 1, or start > end
            if (start < 1 || end < 1 || start > end) {
                return error.num;
            }

            // Return error if type is neither 0 nor 1
            if (type !== 0 && type !== 1) {
                return error.num;
            }

            // Compute cumulative principal
            var payment = exports.PMT(rate, periods, value, 0, type);
            var principal = 0;
            if (start === 1) {
                if (type === 0) {
                    principal = payment + value * rate;
                } else {
                    principal = payment;
                }
                start++;
            }
            for (var i = start; i <= end; i++) {
                if (type > 0) {
                    principal += payment - (exports.FV(rate, i - 2, payment, value, 1) - payment) * rate;
                } else {
                    principal += payment - exports.FV(rate, i - 1, payment, value, 0) * rate;
                }
            }

            // Return cumulative principal
            return principal;
        };

        exports.DB = function (cost, salvage, life, period, month) {
            // Initialize month
            month = (month === undefined) ? 12 : month;

            cost = utils.parseNumber(cost);
            salvage = utils.parseNumber(salvage);
            life = utils.parseNumber(life);
            period = utils.parseNumber(period);
            month = utils.parseNumber(month);
            if (utils.anyIsError(cost, salvage, life, period, month)) {
                return error.value;
            }

            // Return error if any of the parameters is negative
            if (cost < 0 || salvage < 0 || life < 0 || period < 0) {
                return error.num;
            }

            // Return error if month is not an integer between 1 and 12
            if ([1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12].indexOf(month) === -1) {
                return error.num;
            }

            // Return error if period is greater than life
            if (period > life) {
                return error.num;
            }

            // Return 0 (zero) if salvage is greater than or equal to cost
            if (salvage >= cost) {
                return 0;
            }

            // Rate is rounded to three decimals places
            var rate = (1 - Math.pow(salvage / cost, 1 / life)).toFixed(3);

            // Compute initial depreciation
            var initial = cost * rate * month / 12;

            // Compute total depreciation
            var total = initial;
            var current = 0;
            var ceiling = (period === life) ? life - 1 : period;
            for (var i = 2; i <= ceiling; i++) {
                current = (cost - total) * rate;
                total += current;
            }

            // Depreciation for the first and last periods are special cases
            if (period === 1) {
                // First period
                return initial;
            } else if (period === life) {
                // Last period
                return (cost - total) * rate;
            } else {
                return current;
            }
        };

        exports.DDB = function (cost, salvage, life, period, factor) {
            // Initialize factor
            factor = (factor === undefined) ? 2 : factor;

            cost = utils.parseNumber(cost);
            salvage = utils.parseNumber(salvage);
            life = utils.parseNumber(life);
            period = utils.parseNumber(period);
            factor = utils.parseNumber(factor);
            if (utils.anyIsError(cost, salvage, life, period, factor)) {
                return error.value;
            }

            // Return error if any of the parameters is negative or if factor is
            // null
            if (cost < 0 || salvage < 0 || life < 0 || period < 0 || factor <= 0) {
                return error.num;
            }

            // Return error if period is greater than life
            if (period > life) {
                return error.num;
            }

            // Return 0 (zero) if salvage is greater than or equal to cost
            if (salvage >= cost) {
                return 0;
            }

            // Compute depreciation
            var total = 0;
            var current = 0;
            for (var i = 1; i <= period; i++) {
                current = Math.min((cost - total) * (factor / life), (cost - salvage - total));
                total += current;
            }

            // Return depreciation
            return current;
        };

        exports.DISC = null;

        exports.DOLLARDE = function (dollar, fraction) {
            // Credits: algorithm inspired by Apache OpenOffice

            dollar = utils.parseNumber(dollar);
            fraction = utils.parseNumber(fraction);
            if (utils.anyIsError(dollar, fraction)) {
                return error.value;
            }

            // Return error if fraction is negative
            if (fraction < 0) {
                return error.num;
            }

            // Return error if fraction is greater than or equal to 0 and less than
            // 1
            if (fraction >= 0 && fraction < 1) {
                return error.div0;
            }

            // Truncate fraction if it is not an integer
            fraction = parseInt(fraction, 10);

            // Compute integer part
            var result = parseInt(dollar, 10);

            // Add decimal part
            result += (dollar % 1) * Math.pow(10, Math.ceil(Math.log(fraction) / Math.LN10)) / fraction;

            // Round result
            var power = Math.pow(10, Math.ceil(Math.log(fraction) / Math.LN2) + 1);
            result = Math.round(result * power) / power;

            // Return converted dollar price
            return result;
        };

        exports.DOLLARFR = function (dollar, fraction) {
            // Credits: algorithm inspired by Apache OpenOffice

            dollar = utils.parseNumber(dollar);
            fraction = utils.parseNumber(fraction);
            if (utils.anyIsError(dollar, fraction)) {
                return error.value;
            }

            // Return error if fraction is negative
            if (fraction < 0) {
                return error.num;
            }

            // Return error if fraction is greater than or equal to 0 and less than
            // 1
            if (fraction >= 0 && fraction < 1) {
                return error.div0;
            }

            // Truncate fraction if it is not an integer
            fraction = parseInt(fraction, 10);

            // Compute integer part
            var result = parseInt(dollar, 10);

            // Add decimal part
            result += (dollar % 1) * Math.pow(10, -Math.ceil(Math.log(fraction) / Math.LN10)) * fraction;

            // Return converted dollar price
            return result;
        };

        exports.DURATION = null;

        exports.EFFECT = function (rate, periods) {
            rate = utils.parseNumber(rate);
            periods = utils.parseNumber(periods);
            if (utils.anyIsError(rate, periods)) {
                return error.value;
            }

            // Return error if rate <=0 or periods < 1
            if (rate <= 0 || periods < 1) {
                return error.num;
            }

            // Truncate periods if it is not an integer
            periods = parseInt(periods, 10);

            // Return effective annual interest rate
            return Math.pow(1 + rate / periods, periods) - 1;
        };

        exports.FV = function (rate, periods, payment, value, type) {
            // Credits: algorithm inspired by Apache OpenOffice

            value = value || 0;
            type = type || 0;

            rate = utils.parseNumber(rate);
            periods = utils.parseNumber(periods);
            payment = utils.parseNumber(payment);
            value = utils.parseNumber(value);
            type = utils.parseNumber(type);
            if (utils.anyIsError(rate, periods, payment, value, type)) {
                return error.value;
            }

            // Return future value
            var result;
            if (rate === 0) {
                result = value + payment * periods;
            } else {
                var term = Math.pow(1 + rate, periods);
                if (type === 1) {
                    result = value * term + payment * (1 + rate) * (term - 1) / rate;
                } else {
                    result = value * term + payment * (term - 1) / rate;
                }
            }
            return -result;
        };

        exports.FVSCHEDULE = function (principal, schedule) {
            principal = utils.parseNumber(principal);
            schedule = utils.parseNumberArray(utils.flatten(schedule));
            if (utils.anyIsError(principal, schedule)) {
                return error.value;
            }

            var n = schedule.length;
            var future = principal;

            // Apply all interests in schedule
            for (var i = 0; i < n; i++) {
                // Apply scheduled interest
                future *= 1 + schedule[i];
            }

            // Return future value
            return future;
        };

        exports.INTRATE = null;

        exports.IPMT = function (rate, period, periods, present, future, type) {
            // Credits: algorithm inspired by Apache OpenOffice

            future = future || 0;
            type = type || 0;

            rate = utils.parseNumber(rate);
            period = utils.parseNumber(period);
            periods = utils.parseNumber(periods);
            present = utils.parseNumber(present);
            future = utils.parseNumber(future);
            type = utils.parseNumber(type);
            if (utils.anyIsError(rate, period, periods, present, future, type)) {
                return error.value;
            }

            // Compute payment
            var payment = exports.PMT(rate, periods, present, future, type);

            // Compute interest
            var interest;
            if (period === 1) {
                if (type === 1) {
                    interest = 0;
                } else {
                    interest = -present;
                }
            } else {
                if (type === 1) {
                    interest = exports.FV(rate, period - 2, payment, present, 1) - payment;
                } else {
                    interest = exports.FV(rate, period - 1, payment, present, 0);
                }
            }

            // Return interest
            return interest * rate;
        };

        exports.IRR = function (values, guess) {
            // Credits: algorithm inspired by Apache OpenOffice

            guess = guess || 0;

            values = utils.parseNumberArray(utils.flatten(values));
            guess = utils.parseNumber(guess);
            if (utils.anyIsError(values, guess)) {
                return error.value;
            }

            // Calculates the resulting amount
            var irrResult = function (values, dates, rate) {
                var r = rate + 1;
                var result = values[0];
                for (var i = 1; i < values.length; i++) {
                    result += values[i] / Math.pow(r, (dates[i] - dates[0]) / 365);
                }
                return result;
            };

            // Calculates the first derivation
            var irrResultDeriv = function (values, dates, rate) {
                var r = rate + 1;
                var result = 0;
                for (var i = 1; i < values.length; i++) {
                    var frac = (dates[i] - dates[0]) / 365;
                    result -= frac * values[i] / Math.pow(r, frac + 1);
                }
                return result;
            };

            // Initialize dates and check that values contains at least one positive
            // value and one negative value
            var dates = [];
            var positive = false;
            var negative = false;
            for (var i = 0; i < values.length; i++) {
                dates[i] = (i === 0) ? 0 : dates[i - 1] + 365;
                if (values[i] > 0) {
                    positive = true;
                }
                if (values[i] < 0) {
                    negative = true;
                }
            }

            // Return error if values does not contain at least one positive value
            // and one negative value
            if (!positive || !negative) {
                return error.num;
            }

            // Initialize guess and resultRate
            guess = (guess === undefined) ? 0.1 : guess;
            var resultRate = guess;

            // Set maximum epsilon for end of iteration
            var epsMax = 1e-10;

            // Implement Newton's method
            var newRate, epsRate, resultValue;
            var contLoop = true;
            do {
                resultValue = irrResult(values, dates, resultRate);
                newRate = resultRate - resultValue / irrResultDeriv(values, dates, resultRate);
                epsRate = Math.abs(newRate - resultRate);
                resultRate = newRate;
                contLoop = (epsRate > epsMax) && (Math.abs(resultValue) > epsMax);
            } while (contLoop);

            // Return internal rate of return
            return resultRate;
        };

        exports.ISPMT = function (rate, period, periods, value) {
            rate = utils.parseNumber(rate);
            period = utils.parseNumber(period);
            periods = utils.parseNumber(periods);
            value = utils.parseNumber(value);
            if (utils.anyIsError(rate, period, periods, value)) {
                return error.value;
            }

            // Return interest
            return value * rate * (period / periods - 1);
        };

        exports.MDURATION = null;

        exports.MIRR = function (values, finance_rate, reinvest_rate) {
            values = utils.parseNumberArray(utils.flatten(values));
            finance_rate = utils.parseNumber(finance_rate);
            reinvest_rate = utils.parseNumber(reinvest_rate);
            if (utils.anyIsError(values, finance_rate, reinvest_rate)) {
                return error.value;
            }

            // Initialize number of values
            var n = values.length;

            // Lookup payments (negative values) and incomes (positive values)
            var payments = [];
            var incomes = [];
            for (var i = 0; i < n; i++) {
                if (values[i] < 0) {
                    payments.push(values[i]);
                } else {
                    incomes.push(values[i]);
                }
            }

            // Return modified internal rate of return
            var num = -exports.NPV(reinvest_rate, incomes) * Math.pow(1 + reinvest_rate, n - 1);
            var den = exports.NPV(finance_rate, payments) * (1 + finance_rate);
            return Math.pow(num / den, 1 / (n - 1)) - 1;
        };

        exports.NOMINAL = function (rate, periods) {
            rate = utils.parseNumber(rate);
            periods = utils.parseNumber(periods);
            if (utils.anyIsError(rate, periods)) {
                return error.value;
            }

            // Return error if rate <=0 or periods < 1
            if (rate <= 0 || periods < 1) {
                return error.num;
            }

            // Truncate periods if it is not an integer
            periods = parseInt(periods, 10);

            // Return nominal annual interest rate
            return (Math.pow(rate + 1, 1 / periods) - 1) * periods;
        };

        exports.NPER = function (rate, payment, present, future, type) {
            type = (type === undefined) ? 0 : type;
            future = (future === undefined) ? 0 : future;

            rate = utils.parseNumber(rate);
            payment = utils.parseNumber(payment);
            present = utils.parseNumber(present);
            future = utils.parseNumber(future);
            type = utils.parseNumber(type);
            if (utils.anyIsError(rate, payment, present, future, type)) {
                return error.value;
            }

            // Return number of periods
            var num = payment * (1 + rate * type) - future * rate;
            var den = (present * rate + payment * (1 + rate * type));
            return Math.log(num / den) / Math.log(1 + rate);
        };

        exports.NPV = function () {
            var args = utils.parseNumberArray(utils.flatten(arguments));
            if (args instanceof Error) {
                return args;
            }

            // Lookup rate
            var rate = args[0];

            // Initialize net present value
            var value = 0;

            // Loop on all values
            for (var j = 1; j < args.length; j++) {
                value += args[j] / Math.pow(1 + rate, j);
            }

            // Return net present value
            return value;
        };

        exports.ODDFPRICE = null;

        exports.ODDFYIELD = null;

        exports.ODDLPRICE = null;

        exports.ODDLYIELD = null;

        exports.PDURATION = function (rate, present, future) {
            rate = utils.parseNumber(rate);
            present = utils.parseNumber(present);
            future = utils.parseNumber(future);
            if (utils.anyIsError(rate, present, future)) {
                return error.value;
            }

            // Return error if rate <=0
            if (rate <= 0) {
                return error.num;
            }

            // Return number of periods
            return (Math.log(future) - Math.log(present)) / Math.log(1 + rate);
        };

        exports.PMT = function (rate, periods, present, future, type) {
            // Credits: algorithm inspired by Apache OpenOffice

            future = future || 0;
            type = type || 0;

            rate = utils.parseNumber(rate);
            periods = utils.parseNumber(periods);
            present = utils.parseNumber(present);
            future = utils.parseNumber(future);
            type = utils.parseNumber(type);
            if (utils.anyIsError(rate, periods, present, future, type)) {
                return error.value;
            }

            // Return payment
            var result;
            if (rate === 0) {
                result = (present + future) / periods;
            } else {
                var term = Math.pow(1 + rate, periods);
                if (type === 1) {
                    result = (future * rate / (term - 1) + present * rate / (1 - 1 / term)) / (1 + rate);
                } else {
                    result = future * rate / (term - 1) + present * rate / (1 - 1 / term);
                }
            }
            return -result;
        };

        exports.PPMT = function (rate, period, periods, present, future, type) {
            future = future || 0;
            type = type || 0;

            rate = utils.parseNumber(rate);
            periods = utils.parseNumber(periods);
            present = utils.parseNumber(present);
            future = utils.parseNumber(future);
            type = utils.parseNumber(type);
            if (utils.anyIsError(rate, periods, present, future, type)) {
                return error.value;
            }

            return exports.PMT(rate, periods, present, future, type) - exports.IPMT(rate, period, periods, present, future, type);
        };

        exports.PRICE = null;

        exports.PRICEDISC = null;

        exports.PRICEMAT = null;

        exports.PV = function (rate, periods, payment, future, type) {
            future = future || 0;
            type = type || 0;

            rate = utils.parseNumber(rate);
            periods = utils.parseNumber(periods);
            payment = utils.parseNumber(payment);
            future = utils.parseNumber(future);
            type = utils.parseNumber(type);
            if (utils.anyIsError(rate, periods, payment, future, type)) {
                return error.value;
            }

            // Return present value
            if (rate === 0) {
                return -payment * periods - future;
            } else {
                return (((1 - Math.pow(1 + rate, periods)) / rate) * payment * (1 + rate * type) - future) / Math.pow(1 + rate, periods);
            }
        };

        exports.RATE = function (periods, payment, present, future, type, guess) {
            // Credits: rabugento

            guess = (guess === undefined) ? 0.01 : guess;
            future = (future === undefined) ? 0 : future;
            type = (type === undefined) ? 0 : type;

            periods = utils.parseNumber(periods);
            payment = utils.parseNumber(payment);
            present = utils.parseNumber(present);
            future = utils.parseNumber(future);
            type = utils.parseNumber(type);
            guess = utils.parseNumber(guess);
            if (utils.anyIsError(periods, payment, present, future, type, guess)) {
                return error.value;
            }

            // Set maximum epsilon for end of iteration
            var epsMax = 1e-6;

            // Set maximum number of iterations
            var iterMax = 100;
            var iter = 0;
            var close = false;
            var rate = guess;

            while (iter < iterMax && !close) {
                var t1 = Math.pow(rate + 1, periods);
                var t2 = Math.pow(rate + 1, periods - 1);

                var f1 = future + t1 * present + payment * (t1 - 1) * (rate * type + 1) / rate;
                var f2 = periods * t2 * present - payment * (t1 - 1) * (rate * type + 1) / Math.pow(rate, 2);
                var f3 = periods * payment * t2 * (rate * type + 1) / rate + payment * (t1 - 1) * type / rate;

                var newRate = rate - f1 / (f2 + f3);

                if (Math.abs(newRate - rate) < epsMax) close = true;
                iter++
                rate = newRate;
            }

            if (!close) return Number.NaN + rate;
            return rate;
        };

        // TODO
        exports.RECEIVED = null;

        exports.RRI = function (periods, present, future) {
            periods = utils.parseNumber(periods);
            present = utils.parseNumber(present);
            future = utils.parseNumber(future);
            if (utils.anyIsError(periods, present, future)) {
                return error.value;
            }

            // Return error if periods or present is equal to 0 (zero)
            if (periods === 0 || present === 0) {
                return error.num;
            }

            // Return equivalent interest rate
            return Math.pow(future / present, 1 / periods) - 1;
        };

        exports.SLN = function (cost, salvage, life) {
            cost = utils.parseNumber(cost);
            salvage = utils.parseNumber(salvage);
            life = utils.parseNumber(life);
            if (utils.anyIsError(cost, salvage, life)) {
                return error.value;
            }

            // Return error if life equal to 0 (zero)
            if (life === 0) {
                return error.num;
            }

            // Return straight-line depreciation
            return (cost - salvage) / life;
        };

        exports.SYD = function (cost, salvage, life, period) {
            // Return error if any of the parameters is not a number
            cost = utils.parseNumber(cost);
            salvage = utils.parseNumber(salvage);
            life = utils.parseNumber(life);
            period = utils.parseNumber(period);
            if (utils.anyIsError(cost, salvage, life, period)) {
                return error.value;
            }

            // Return error if life equal to 0 (zero)
            if (life === 0) {
                return error.num;
            }

            // Return error if period is lower than 1 or greater than life
            if (period < 1 || period > life) {
                return error.num;
            }

            // Truncate period if it is not an integer
            period = parseInt(period, 10);

            // Return straight-line depreciation
            return ((cost - salvage) * (life - period + 1) * 2) / (life * (life + 1));
        };

        exports.TBILLEQ = function (settlement, maturity, discount) {
            settlement = utils.parseDate(settlement);
            maturity = utils.parseDate(maturity);
            discount = utils.parseNumber(discount);
            if (utils.anyIsError(settlement, maturity, discount)) {
                return error.value;
            }

            // Return error if discount is lower than or equal to zero
            if (discount <= 0) {
                return error.num;
            }

            // Return error if settlement is greater than maturity
            if (settlement > maturity) {
                return error.num;
            }

            // Return error if maturity is more than one year after settlement
            if (maturity - settlement > 365 * 24 * 60 * 60 * 1000) {
                return error.num;
            }

            // Return bond-equivalent yield
            return (365 * discount) / (360 - discount * DAYS360(settlement, maturity, false));
        };

        exports.TBILLPRICE = function (settlement, maturity, discount) {
            settlement = utils.parseDate(settlement);
            maturity = utils.parseDate(maturity);
            discount = utils.parseNumber(discount);
            if (utils.anyIsError(settlement, maturity, discount)) {
                return error.value;
            }

            // Return error if discount is lower than or equal to zero
            if (discount <= 0) {
                return error.num;
            }

            // Return error if settlement is greater than maturity
            if (settlement > maturity) {
                return error.num;
            }

            // Return error if maturity is more than one year after settlement
            if (maturity - settlement > 365 * 24 * 60 * 60 * 1000) {
                return error.num;
            }

            // Return bond-equivalent yield
            return 100 * (1 - discount * DAYS360(settlement, maturity, false) / 360);
        };

        exports.TBILLYIELD = function (settlement, maturity, price) {
            settlement = utils.parseDate(settlement);
            maturity = utils.parseDate(maturity);
            price = utils.parseNumber(price);
            if (utils.anyIsError(settlement, maturity, price)) {
                return error.value;
            }

            // Return error if price is lower than or equal to zero
            if (price <= 0) {
                return error.num;
            }

            // Return error if settlement is greater than maturity
            if (settlement > maturity) {
                return error.num;
            }

            // Return error if maturity is more than one year after settlement
            if (maturity - settlement > 365 * 24 * 60 * 60 * 1000) {
                return error.num;
            }

            // Return bond-equivalent yield
            return (100 - price) * 360 / (price * DAYS360(settlement, maturity, false));
        };

        exports.VDB = null;

        exports.XIRR = function (values, dates, guess) {
            // Credits: algorithm inspired by Apache OpenOffice

            values = utils.parseNumberArray(utils.flatten(values));
            dates = utils.parseDateArray(utils.flatten(dates));
            guess = utils.parseNumber(guess);
            if (utils.anyIsError(values, dates, guess)) {
                return error.value;
            }

            // Calculates the resulting amount
            var irrResult = function (values, dates, rate) {
                var r = rate + 1;
                var result = values[0];
                for (var i = 1; i < values.length; i++) {
                    result += values[i] / Math.pow(r, DAYS(dates[i], dates[0]) / 365);
                }
                return result;
            };

            // Calculates the first derivation
            var irrResultDeriv = function (values, dates, rate) {
                var r = rate + 1;
                var result = 0;
                for (var i = 1; i < values.length; i++) {
                    var frac = DAYS(dates[i], dates[0]) / 365;
                    result -= frac * values[i] / Math.pow(r, frac + 1);
                }
                return result;
            };

            // Check that values contains at least one positive value and one
            // negative value
            var positive = false;
            var negative = false;
            for (var i = 0; i < values.length; i++) {
                if (values[i] > 0) {
                    positive = true;
                }
                if (values[i] < 0) {
                    negative = true;
                }
            }

            // Return error if values does not contain at least one positive value
            // and one negative value
            if (!positive || !negative) {
                return error.num;
            }

            // Initialize guess and resultRate
            guess = guess || 0.1;
            var resultRate = guess;

            // Set maximum epsilon for end of iteration
            var epsMax = 1e-10;

            // Implement Newton's method
            var newRate, epsRate, resultValue;
            var contLoop = true;
            do {
                resultValue = irrResult(values, dates, resultRate);
                newRate = resultRate - resultValue / irrResultDeriv(values, dates, resultRate);
                epsRate = Math.abs(newRate - resultRate);
                resultRate = newRate;
                contLoop = (epsRate > epsMax) && (Math.abs(resultValue) > epsMax);
            } while (contLoop);

            // Return internal rate of return
            return resultRate;
        };

        exports.XNPV = function (rate, values, dates) {
            rate = utils.parseNumber(rate);
            values = utils.parseNumberArray(utils.flatten(values));
            dates = utils.parseDateArray(utils.flatten(dates));
            if (utils.anyIsError(rate, values, dates)) {
                return error.value;
            }

            var result = 0;
            for (var i = 0; i < values.length; i++) {
                result += values[i] / Math.pow(1 + rate, DAYS(dates[i], dates[0]) / 365);
            }
            return result;
        };

        exports.YIELD = null;

        exports.YIELDDISC = null;

        exports.YIELDMAT = null;

        return exports;
    })();

    jexcel.methods.information = (function () {
        var exports = {};
        exports.CELL = null;

        exports.ERROR = {};
        exports.ERROR.TYPE = function (error_val) {
            switch (error_val) {
                case error.nil:
                    return 1;
                case error.div0:
                    return 2;
                case error.value:
                    return 3;
                case error.ref:
                    return 4;
                case error.name:
                    return 5;
                case error.num:
                    return 6;
                case error.na:
                    return 7;
                case error.data:
                    return 8;
            }
            return error.na;
        };

        exports.INFO = null;

        exports.ISBLANK = function (value) {
            return value === null;
        };

        exports.ISBINARY = function (number) {
            return (/^[01]{1,10}$/).test(number);
        };

        exports.ISERR = function (value) {
            return ([error.value, error.ref, error.div0, error.num, error.name, error.nil]).indexOf(value) >= 0 ||
                (typeof value === 'number' && (isNaN(value) || !isFinite(value)));
        };

        exports.ISERROR = function (value) {
            return exports.ISERR(value) || value === error.na;
        };

        exports.ISEVEN = function (number) {
            return (Math.floor(Math.abs(number)) & 1) ? false : true;
        };

        // TODO
        exports.ISFORMULA = null;

        exports.ISLOGICAL = function (value) {
            return value === true || value === false;
        };

        exports.ISNA = function (value) {
            return value === error.na;
        };

        exports.ISNONTEXT = function (value) {
            return typeof (value) !== 'string';
        };

        exports.ISNUMBER = function (value) {
            return typeof (value) === 'number' && !isNaN(value) && isFinite(value);
        };

        exports.ISODD = function (number) {
            return (Math.floor(Math.abs(number)) & 1) ? true : false;
        };

        exports.ISREF = null;

        exports.ISTEXT = function (value) {
            return typeof (value) === 'string';
        };

        exports.N = function (value) {
            if (this.ISNUMBER(value)) {
                return value;
            }
            if (value instanceof Date) {
                return value.getTime();
            }
            if (value === true) {
                return 1;
            }
            if (value === false) {
                return 0;
            }
            if (this.ISERROR(value)) {
                return value;
            }
            return 0;
        };

        exports.NA = function () {
            return error.na;
        };

        exports.SHEET = null;

        exports.SHEETS = null;

        exports.TYPE = function (value) {
            if (this.ISNUMBER(value)) {
                return 1;
            }
            if (this.ISTEXT(value)) {
                return 2;
            }
            if (this.ISLOGICAL(value)) {
                return 4;
            }
            if (this.ISERROR(value)) {
                return 16;
            }
            if (Array.isArray(value)) {
                return 64;
            }
        };

        return exports;
    })();

    jexcel.methods.logical = (function () {
        var exports = {};

        exports.AND = function () {
            var args = utils.flatten(arguments);
            var result = true;
            for (var i = 0; i < args.length; i++) {
                if (!args[i]) {
                    result = false;
                }
            }
            return result;
        };

        exports.CHOOSE = function () {
            if (arguments.length < 2) {
                return error.na;
            }

            var index = arguments[0];
            if (index < 1 || index > 254) {
                return error.value;
            }

            if (arguments.length < index + 1) {
                return error.value;
            }

            return arguments[index];
        };

        exports.FALSE = function () {
            return false;
        };

        exports.IF = function (test, then_value, otherwise_value) {
            return test ? then_value : otherwise_value;
        };

        exports.IFERROR = function (value, valueIfError) {
            if (ISERROR(value)) {
                return valueIfError;
            }
            return value;
        };

        exports.IFNA = function (value, value_if_na) {
            return value === error.na ? value_if_na : value;
        };

        exports.NOT = function (logical) {
            return !logical;
        };

        exports.OR = function () {
            var args = utils.flatten(arguments);
            var result = false;
            for (var i = 0; i < args.length; i++) {
                if (args[i]) {
                    result = true;
                }
            }
            return result;
        };

        exports.TRUE = function () {
            return true;
        };

        exports.XOR = function () {
            var args = utils.flatten(arguments);
            var result = 0;
            for (var i = 0; i < args.length; i++) {
                if (args[i]) {
                    result++;
                }
            }
            return (Math.floor(Math.abs(result)) & 1) ? true : false;
        };

        exports.SWITCH = function () {
            var result;
            if (arguments.length > 0) {
                var targetValue = arguments[0];
                var argc = arguments.length - 1;
                var switchCount = Math.floor(argc / 2);
                var switchSatisfied = false;
                var defaultClause = argc % 2 === 0 ? null : arguments[arguments.length - 1];

                if (switchCount) {
                    for (var index = 0; index < switchCount; index++) {
                        if (targetValue === arguments[index * 2 + 1]) {
                            result = arguments[index * 2 + 2];
                            switchSatisfied = true;
                            break;
                        }
                    }
                }

                if (!switchSatisfied && defaultClause) {
                    result = defaultClause;
                }
            }

            return result;
        };

        return exports;
    })();

    jexcel.methods.math = (function () {
        var exports = {};

        exports.ABS = function (number) {
            number = utils.parseNumber(number);
            if (number instanceof Error) {
                return number;
            }
            return Math.abs(utils.parseNumber(number));
        };

        exports.ACOS = function (number) {
            number = utils.parseNumber(number);
            if (number instanceof Error) {
                return number;
            }
            return Math.acos(number);
        };

        exports.ACOSH = function (number) {
            number = utils.parseNumber(number);
            if (number instanceof Error) {
                return number;
            }
            return Math.log(number + Math.sqrt(number * number - 1));
        };

        exports.ACOT = function (number) {
            number = utils.parseNumber(number);
            if (number instanceof Error) {
                return number;
            }
            return Math.atan(1 / number);
        };

        exports.ACOTH = function (number) {
            number = utils.parseNumber(number);
            if (number instanceof Error) {
                return number;
            }
            return 0.5 * Math.log((number + 1) / (number - 1));
        };

        exports.AGGREGATE = null

        exports.ARABIC = function (text) {
            // Credits: Rafa? Kukawski
            if (!/^M*(?:D?C{0,3}|C[MD])(?:L?X{0,3}|X[CL])(?:V?I{0,3}|I[XV])$/.test(text)) {
                return error.value;
            }
            var r = 0;
            text.replace(/[MDLV]|C[MD]?|X[CL]?|I[XV]?/g, function (i) {
                r += {
                    M: 1000,
                    CM: 900,
                    D: 500,
                    CD: 400,
                    C: 100,
                    XC: 90,
                    L: 50,
                    XL: 40,
                    X: 10,
                    IX: 9,
                    V: 5,
                    IV: 4,
                    I: 1
                }[i];
            });
            return r;
        };

        exports.ASIN = function (number) {
            number = utils.parseNumber(number);
            if (number instanceof Error) {
                return number;
            }
            return Math.asin(number);
        };

        exports.ASINH = function (number) {
            number = utils.parseNumber(number);
            if (number instanceof Error) {
                return number;
            }
            return Math.log(number + Math.sqrt(number * number + 1));
        };

        exports.ATAN = function (number) {
            number = utils.parseNumber(number);
            if (number instanceof Error) {
                return number;
            }
            return Math.atan(number);
        };

        exports.ATAN2 = function (number_x, number_y) {
            number_x = utils.parseNumber(number_x);
            number_y = utils.parseNumber(number_y);
            if (utils.anyIsError(number_x, number_y)) {
                return error.value;
            }
            return Math.atan2(number_x, number_y);
        };

        exports.ATANH = function (number) {
            number = utils.parseNumber(number);
            if (number instanceof Error) {
                return number;
            }
            return Math.log((1 + number) / (1 - number)) / 2;
        };

        exports.BASE = function (number, radix, min_length) {
            min_length = min_length || 0;

            number = utils.parseNumber(number);
            radix = utils.parseNumber(radix);
            min_length = utils.parseNumber(min_length);
            if (utils.anyIsError(number, radix, min_length)) {
                return error.value;
            }
            min_length = (min_length === undefined) ? 0 : min_length;
            var result = number.toString(radix);
            return new Array(Math.max(min_length + 1 - result.length, 0)).join('0') + result;
        };

        exports.CEILING = function (number, significance, mode) {
            significance = (significance === undefined) ? 1 : significance;
            mode = (mode === undefined) ? 0 : mode;

            number = utils.parseNumber(number);
            significance = utils.parseNumber(significance);
            mode = utils.parseNumber(mode);
            if (utils.anyIsError(number, significance, mode)) {
                return error.value;
            }
            if (significance === 0) {
                return 0;
            }

            significance = Math.abs(significance);
            if (number >= 0) {
                return Math.ceil(number / significance) * significance;
            } else {
                if (mode === 0) {
                    return -1 * Math.floor(Math.abs(number) / significance) * significance;
                } else {
                    return -1 * Math.ceil(Math.abs(number) / significance) * significance;
                }
            }
        };

        exports.CEILING.MATH = exports.CEILING;

        exports.CEILING.PRECISE = exports.CEILING;

        exports.COMBIN = function (number, number_chosen) {
            number = utils.parseNumber(number);
            number_chosen = utils.parseNumber(number_chosen);
            if (utils.anyIsError(number, number_chosen)) {
                return error.value;
            }
            return exports.FACT(number) / (exports.FACT(number_chosen) * exports.FACT(number - number_chosen));
        };

        exports.COMBINA = function (number, number_chosen) {
            number = utils.parseNumber(number);
            number_chosen = utils.parseNumber(number_chosen);
            if (utils.anyIsError(number, number_chosen)) {
                return error.value;
            }
            return (number === 0 && number_chosen === 0) ? 1 : exports.COMBIN(number + number_chosen - 1, number - 1);
        };

        exports.COS = function (number) {
            number = utils.parseNumber(number);
            if (number instanceof Error) {
                return number;
            }
            return Math.cos(number);
        };

        exports.COSH = function (number) {
            number = utils.parseNumber(number);
            if (number instanceof Error) {
                return number;
            }
            return (Math.exp(number) + Math.exp(-number)) / 2;
        };

        exports.COT = function (number) {
            number = utils.parseNumber(number);
            if (number instanceof Error) {
                return number;
            }
            return 1 / Math.tan(number);
        };

        exports.COTH = function (number) {
            number = utils.parseNumber(number);
            if (number instanceof Error) {
                return number;
            }
            var e2 = Math.exp(2 * number);
            return (e2 + 1) / (e2 - 1);
        };

        exports.CSC = function (number) {
            number = utils.parseNumber(number);
            if (number instanceof Error) {
                return number;
            }
            return 1 / Math.sin(number);
        };

        exports.CSCH = function (number) {
            number = utils.parseNumber(number);
            if (number instanceof Error) {
                return number;
            }
            return 2 / (Math.exp(number) - Math.exp(-number));
        };

        exports.DECIMAL = function (number, radix) {
            if (arguments.length < 1) {
                return error.value;
            }


            return parseInt(number, radix);
        };

        exports.DEGREES = function (number) {
            number = utils.parseNumber(number);
            if (number instanceof Error) {
                return number;
            }
            return number * 180 / Math.PI;
        };

        exports.EVEN = function (number) {
            number = utils.parseNumber(number);
            if (number instanceof Error) {
                return number;
            }
            return exports.CEILING(number, -2, -1);
        };

        exports.EXP = Math.exp;

        var MEMOIZED_FACT = [];
        exports.FACT = function (number) {
            number = utils.parseNumber(number);
            if (number instanceof Error) {
                return number;
            }
            var n = Math.floor(number);
            if (n === 0 || n === 1) {
                return 1;
            } else if (MEMOIZED_FACT[n] > 0) {
                return MEMOIZED_FACT[n];
            } else {
                MEMOIZED_FACT[n] = exports.FACT(n - 1) * n;
                return MEMOIZED_FACT[n];
            }
        };

        exports.FACTDOUBLE = function (number) {
            number = utils.parseNumber(number);
            if (number instanceof Error) {
                return number;
            }
            var n = Math.floor(number);
            if (n <= 0) {
                return 1;
            } else {
                return n * exports.FACTDOUBLE(n - 2);
            }
        };

        exports.FLOOR = function (number, significance, mode) {
            significance = (significance === undefined) ? 1 : significance;
            mode = (mode === undefined) ? 0 : mode;

            number = utils.parseNumber(number);
            significance = utils.parseNumber(significance);
            mode = utils.parseNumber(mode);
            if (utils.anyIsError(number, significance, mode)) {
                return error.value;
            }
            if (significance === 0) {
                return 0;
            }

            significance = Math.abs(significance);
            if (number >= 0) {
                return Math.floor(number / significance) * significance;
            } else {
                if (mode === 0) {
                    return -1 * Math.ceil(Math.abs(number) / significance) * significance;
                } else {
                    return -1 * Math.floor(Math.abs(number) / significance) * significance;
                }
            }
        };

        exports.FLOOR.MATH = exports.FLOOR;

        exports.GCD = null;

        exports.INT = function (number) {
            number = utils.parseNumber(number);
            if (number instanceof Error) {
                return number;
            }
            return Math.floor(number);
        };

        exports.LCM = function () {
            // Credits: Jonas Raoni Soares Silva
            var o = utils.parseNumberArray(utils.flatten(arguments));
            if (o instanceof Error) {
                return o;
            }
            for (var i, j, n, d, r = 1;
                 (n = o.pop()) !== undefined;) {
                while (n > 1) {
                    if (n % 2) {
                        for (i = 3, j = Math.floor(Math.sqrt(n)); i <= j && n % i; i += 2) {
                            //empty
                        }
                        d = (i <= j) ? i : n;
                    } else {
                        d = 2;
                    }
                    for (n /= d, r *= d, i = o.length; i;
                         (o[--i] % d) === 0 && (o[i] /= d) === 1 && o.splice(i, 1)) {
                        //empty
                    }
                }
            }
            return r;
        };

        exports.LN = function (number) {
            number = utils.parseNumber(number);
            if (number instanceof Error) {
                return number;
            }
            return Math.log(number);
        };

        exports.LOG = function (number, base) {
            number = utils.parseNumber(number);
            base = (base === undefined) ? 10 : utils.parseNumber(base);

            if (utils.anyIsError(number, base)) {
                return error.value;
            }

            return Math.log(number) / Math.log(base);
        };

        exports.LOG10 = function (number) {
            number = utils.parseNumber(number);
            if (number instanceof Error) {
                return number;
            }
            return Math.log(number) / Math.log(10);
        };

        exports.MDETERM = null;

        exports.MINVERSE = null;

        exports.MMULT = null;

        exports.MOD = function (dividend, divisor) {
            dividend = utils.parseNumber(dividend);
            divisor = utils.parseNumber(divisor);
            if (utils.anyIsError(dividend, divisor)) {
                return error.value;
            }
            if (divisor === 0) {
                return error.div0;
            }
            var modulus = Math.abs(dividend % divisor);
            return (divisor > 0) ? modulus : -modulus;
        };

        exports.MROUND = function (number, multiple) {
            number = utils.parseNumber(number);
            multiple = utils.parseNumber(multiple);
            if (utils.anyIsError(number, multiple)) {
                return error.value;
            }
            if (number * multiple < 0) {
                return error.num;
            }

            return Math.round(number / multiple) * multiple;
        };

        exports.MULTINOMIAL = function () {
            var args = utils.parseNumberArray(utils.flatten(arguments));
            if (args instanceof Error) {
                return args;
            }
            var sum = 0;
            var divisor = 1;
            for (var i = 0; i < args.length; i++) {
                sum += args[i];
                divisor *= exports.FACT(args[i]);
            }
            return exports.FACT(sum) / divisor;
        };

        exports.MUNIT = null;

        exports.ODD = function (number) {
            number = utils.parseNumber(number);
            if (number instanceof Error) {
                return number;
            }
            var temp = Math.ceil(Math.abs(number));
            temp = (temp & 1) ? temp : temp + 1;
            return (number > 0) ? temp : -temp;
        };

        exports.PI = function () {
            return Math.PI;
        };

        exports.POWER = function (number, power) {
            number = utils.parseNumber(number);
            power = utils.parseNumber(power);
            if (utils.anyIsError(number, power)) {
                return error.value;
            }
            var result = Math.pow(number, power);
            if (isNaN(result)) {
                return error.num;
            }

            return result;
        };

        exports.PRODUCT = function () {
            var args = utils.parseNumberArray(utils.flatten(arguments));
            if (args instanceof Error) {
                return args;
            }
            var result = 1;
            for (var i = 0; i < args.length; i++) {
                result *= args[i];
            }
            return result;
        };

        exports.QUOTIENT = function (numerator, denominator) {
            numerator = utils.parseNumber(numerator);
            denominator = utils.parseNumber(denominator);
            if (utils.anyIsError(numerator, denominator)) {
                return error.value;
            }
            return parseInt(numerator / denominator, 10);
        };

        exports.RADIANS = function (number) {
            number = utils.parseNumber(number);
            if (number instanceof Error) {
                return number;
            }
            return number * Math.PI / 180;
        };

        exports.RAND = function () {
            return Math.random();
        };

        exports.RANDBETWEEN = function (bottom, top) {
            bottom = utils.parseNumber(bottom);
            top = utils.parseNumber(top);
            if (utils.anyIsError(bottom, top)) {
                return error.value;
            }
            // Creative Commons Attribution 3.0 License
            // Copyright (c) 2012 eqcode
            return bottom + Math.ceil((top - bottom + 1) * Math.random()) - 1;
        };

        exports.ROMAN = null;

        exports.ROUND = function (number, digits) {
            number = utils.parseNumber(number);
            digits = utils.parseNumber(digits);
            if (utils.anyIsError(number, digits)) {
                return error.value;
            }
            return Math.round(number * Math.pow(10, digits)) / Math.pow(10, digits);
        };

        exports.ROUNDDOWN = function (number, digits) {
            number = utils.parseNumber(number);
            digits = utils.parseNumber(digits);
            if (utils.anyIsError(number, digits)) {
                return error.value;
            }
            var sign = (number > 0) ? 1 : -1;
            return sign * (Math.floor(Math.abs(number) * Math.pow(10, digits))) / Math.pow(10, digits);
        };

        exports.ROUNDUP = function (number, digits) {
            number = utils.parseNumber(number);
            digits = utils.parseNumber(digits);
            if (utils.anyIsError(number, digits)) {
                return error.value;
            }
            var sign = (number > 0) ? 1 : -1;
            return sign * (Math.ceil(Math.abs(number) * Math.pow(10, digits))) / Math.pow(10, digits);
        };

        exports.SEC = function (number) {
            number = utils.parseNumber(number);
            if (number instanceof Error) {
                return number;
            }
            return 1 / Math.cos(number);
        };

        exports.SECH = function (number) {
            number = utils.parseNumber(number);
            if (number instanceof Error) {
                return number;
            }
            return 2 / (Math.exp(number) + Math.exp(-number));
        };

        exports.SERIESSUM = function (x, n, m, coefficients) {
            x = utils.parseNumber(x);
            n = utils.parseNumber(n);
            m = utils.parseNumber(m);
            coefficients = utils.parseNumberArray(coefficients);
            if (utils.anyIsError(x, n, m, coefficients)) {
                return error.value;
            }
            var result = coefficients[0] * Math.pow(x, n);
            for (var i = 1; i < coefficients.length; i++) {
                result += coefficients[i] * Math.pow(x, n + i * m);
            }
            return result;
        };

        exports.SIGN = function (number) {
            number = utils.parseNumber(number);
            if (number instanceof Error) {
                return number;
            }
            if (number < 0) {
                return -1;
            } else if (number === 0) {
                return 0;
            } else {
                return 1;
            }
        };

        exports.SIN = function (number) {
            number = utils.parseNumber(number);
            if (number instanceof Error) {
                return number;
            }
            return Math.sin(number);
        };

        exports.SINH = function (number) {
            number = utils.parseNumber(number);
            if (number instanceof Error) {
                return number;
            }
            return (Math.exp(number) - Math.exp(-number)) / 2;
        };

        exports.SQRT = function (number) {
            number = utils.parseNumber(number);
            if (number instanceof Error) {
                return number;
            }
            if (number < 0) {
                return error.num;
            }
            return Math.sqrt(number);
        };

        exports.SQRTPI = function (number) {
            number = utils.parseNumber(number);
            if (number instanceof Error) {
                return number;
            }
            return Math.sqrt(number * Math.PI);
        };

        exports.SUBTOTAL = null;

        exports.ADD = function (num1, num2) {
            if (arguments.length !== 2) {
                return error.na;
            }

            num1 = utils.parseNumber(num1);
            num2 = utils.parseNumber(num2);
            if (utils.anyIsError(num1, num2)) {
                return error.value;
            }

            return num1 + num2;
        };

        exports.MINUS = function (num1, num2) {
            if (arguments.length !== 2) {
                return error.na;
            }

            num1 = utils.parseNumber(num1);
            num2 = utils.parseNumber(num2);
            if (utils.anyIsError(num1, num2)) {
                return error.value;
            }

            return num1 - num2;
        };

        exports.DIVIDE = function (dividend, divisor) {
            if (arguments.length !== 2) {
                return error.na;
            }

            dividend = utils.parseNumber(dividend);
            divisor = utils.parseNumber(divisor);
            if (utils.anyIsError(dividend, divisor)) {
                return error.value;
            }

            if (divisor === 0) {
                return error.div0;
            }

            return dividend / divisor;
        };

        exports.MULTIPLY = function (factor1, factor2) {
            if (arguments.length !== 2) {
                return error.na;
            }

            factor1 = utils.parseNumber(factor1);
            factor2 = utils.parseNumber(factor2);
            if (utils.anyIsError(factor1, factor2)) {
                return error.value;
            }

            return factor1 * factor2;
        };

        exports.GTE = function (num1, num2) {
            if (arguments.length !== 2) {
                return error.na;
            }

            num1 = utils.parseNumber(num1);
            num2 = utils.parseNumber(num2);
            if (utils.anyIsError(num1, num2)) {
                return error.error;
            }

            return num1 >= num2;
        };

        exports.LT = function (num1, num2) {
            if (arguments.length !== 2) {
                return error.na;
            }

            num1 = utils.parseNumber(num1);
            num2 = utils.parseNumber(num2);
            if (utils.anyIsError(num1, num2)) {
                return error.error;
            }

            return num1 < num2;
        };

        exports.LTE = function (num1, num2) {
            if (arguments.length !== 2) {
                return error.na;
            }

            num1 = utils.parseNumber(num1);
            num2 = utils.parseNumber(num2);
            if (utils.anyIsError(num1, num2)) {
                return error.error;
            }

            return num1 <= num2;
        };

        exports.EQ = function (value1, value2) {
            if (arguments.length !== 2) {
                return error.na;
            }

            return value1 === value2;
        };

        exports.NE = function (value1, value2) {
            if (arguments.length !== 2) {
                return error.na;
            }

            return value1 !== value2;
        };

        exports.POW = function (base, exponent) {
            if (arguments.length !== 2) {
                return error.na;
            }

            base = utils.parseNumber(base);
            exponent = utils.parseNumber(exponent);
            if (utils.anyIsError(base, exponent)) {
                return error.error;
            }

            return exports.POWER(base, exponent);
        };

        exports.SUM = function () {
            var result = 0;
            var argsKeys = Object.keys(arguments);
            for (var i = 0; i < argsKeys.length; ++i) {
                var elt = arguments[argsKeys[i]];
                if (typeof elt === 'number') {
                    result += elt;
                } else if (typeof elt === 'string') {
                    var parsed = parseFloat(elt);
                    !isNaN(parsed) && (result += parsed);
                } else if (Array.isArray(elt)) {
                    result += exports.SUM.apply(null, elt);
                }
            }
            return result;
        };

        exports.SUMIF = function (range, criteria) {
            range = utils.parseNumberArray(utils.flatten(range));
            if (range instanceof Error) {
                return range;
            }
            var result = 0;
            for (var i = 0; i < range.length; i++) {
                result += (eval(range[i] + criteria)) ? range[i] : 0; // jshint ignore:line
            }
            return result;
        };

        exports.SUMIFS = function () {
            var args = utils.argsToArray(arguments);
            var range = utils.parseNumberArray(utils.flatten(args.shift()));
            if (range instanceof Error) {
                return range;
            }
            var criteria = args;

            var n_range_elements = range.length;
            var n_criterias = criteria.length;

            var result = 0;
            for (var i = 0; i < n_range_elements; i++) {
                var el = range[i];
                var condition = '';
                for (var c = 0; c < n_criterias; c++) {
                    condition += el + criteria[c];
                    if (c !== n_criterias - 1) {
                        condition += '&&';
                    }
                }
                if (eval(condition)) { // jshint ignore:line
                    result += el;
                }
            }
            return result;
        };

        exports.SUMPRODUCT = null;

        exports.SUMSQ = function () {
            var numbers = utils.parseNumberArray(utils.flatten(arguments));
            if (numbers instanceof Error) {
                return numbers;
            }
            var result = 0;
            var length = numbers.length;
            for (var i = 0; i < length; i++) {
                result += (ISNUMBER(numbers[i])) ? numbers[i] * numbers[i] : 0;
            }
            return result;
        };

        exports.SUMX2MY2 = function (array_x, array_y) {
            array_x = utils.parseNumberArray(utils.flatten(array_x));
            array_y = utils.parseNumberArray(utils.flatten(array_y));
            if (utils.anyIsError(array_x, array_y)) {
                return error.value;
            }
            var result = 0;
            for (var i = 0; i < array_x.length; i++) {
                result += array_x[i] * array_x[i] - array_y[i] * array_y[i];
            }
            return result;
        };

        exports.SUMX2PY2 = function (array_x, array_y) {
            array_x = utils.parseNumberArray(utils.flatten(array_x));
            array_y = utils.parseNumberArray(utils.flatten(array_y));
            if (utils.anyIsError(array_x, array_y)) {
                return error.value;
            }
            var result = 0;
            array_x = utils.parseNumberArray(utils.flatten(array_x));
            array_y = utils.parseNumberArray(utils.flatten(array_y));
            for (var i = 0; i < array_x.length; i++) {
                result += array_x[i] * array_x[i] + array_y[i] * array_y[i];
            }
            return result;
        };

        exports.SUMXMY2 = function (array_x, array_y) {
            array_x = utils.parseNumberArray(utils.flatten(array_x));
            array_y = utils.parseNumberArray(utils.flatten(array_y));
            if (utils.anyIsError(array_x, array_y)) {
                return error.value;
            }
            var result = 0;
            array_x = utils.flatten(array_x);
            array_y = utils.flatten(array_y);
            for (var i = 0; i < array_x.length; i++) {
                result += Math.pow(array_x[i] - array_y[i], 2);
            }
            return result;
        };

        exports.TAN = function (number) {
            number = utils.parseNumber(number);
            if (number instanceof Error) {
                return number;
            }
            return Math.tan(number);
        };

        exports.TANH = function (number) {
            number = utils.parseNumber(number);
            if (number instanceof Error) {
                return number;
            }
            var e2 = Math.exp(2 * number);
            return (e2 - 1) / (e2 + 1);
        };

        exports.TRUNC = function (number, digits) {
            digits = (digits === undefined) ? 0 : digits;
            number = utils.parseNumber(number);
            digits = utils.parseNumber(digits);
            if (utils.anyIsError(number, digits)) {
                return error.value;
            }
            var sign = (number > 0) ? 1 : -1;
            return sign * (Math.floor(Math.abs(number) * Math.pow(10, digits))) / Math.pow(10, digits);
        };

        return exports;
    })();

    jexcel.methods.misc = (function () {
        var exports = {};

        exports.UNIQUE = function () {
            var result = [];
            for (var i = 0; i < arguments.length; ++i) {
                var hasElement = false;
                var element = arguments[i];

                // Check if we've already seen this element.
                for (var j = 0; j < result.length; ++j) {
                    hasElement = result[j] === element;
                    if (hasElement) {
                        break;
                    }
                }

                // If we did not find it, add it to the result.
                if (!hasElement) {
                    result.push(element);
                }
            }
            return result;
        };

        exports.FLATTEN = utils.flatten;

        exports.ARGS2ARRAY = function () {
            return Array.prototype.slice.call(arguments, 0);
        };

        exports.REFERENCE = function (context, reference) {
            try {
                var path = reference.split('.');
                var result = context;
                for (var i = 0; i < path.length; ++i) {
                    var step = path[i];
                    if (step[step.length - 1] === ']') {
                        var opening = step.indexOf('[');
                        var index = step.substring(opening + 1, step.length - 1);
                        result = result[step.substring(0, opening)][index];
                    } else {
                        result = result[step];
                    }
                }
                return result;
            } catch (error) {
            }
        };

        exports.JOIN = function (array, separator) {
            return array.join(separator);
        };

        exports.NUMBERS = function () {
            var possibleNumbers = utils.flatten(arguments);
            return possibleNumbers.filter(function (el) {
                return typeof el === 'number';
            });
        };

        exports.NUMERAL = null;

        return exports;
    })();

    jexcel.methods.text = (function () {
        var exports = {};

        exports.ASC = null;

        exports.BAHTTEXT = null;

        exports.CHAR = function (number) {
            number = utils.parseNumber(number);
            if (number instanceof Error) {
                return number;
            }
            return String.fromCharCode(number);
        };

        exports.CLEAN = function (text) {
            text = text || '';
            var re = /[\0-\x1F]/g;
            return text.replace(re, "");
        };

        exports.CODE = function (text) {
            text = text || '';
            return text.charCodeAt(0);
        };

        exports.CONCATENATE = function () {
            var args = utils.flatten(arguments);

            var trueFound = 0;
            while ((trueFound = args.indexOf(true)) > -1) {
                args[trueFound] = 'TRUE';
            }

            var falseFound = 0;
            while ((falseFound = args.indexOf(false)) > -1) {
                args[falseFound] = 'FALSE';
            }

            return args.join('');
        };

        exports.DBCS = null;

        exports.DOLLAR = null;

        exports.EXACT = function (text1, text2) {
            return text1 === text2;
        };

        exports.FIND = function (find_text, within_text, position) {
            position = (position === undefined) ? 0 : position;
            return within_text ? within_text.indexOf(find_text, position - 1) + 1 : null;
        };

        exports.FIXED = null;

        exports.HTML2TEXT = function (value) {
            var result = '';

            if (value) {
                if (value instanceof Array) {
                    value.forEach(function (line) {
                        if (result !== '') {
                            result += '\n';
                        }
                        result += (line.replace(/<(?:.|\n)*?>/gm, ''));
                    });
                } else {
                    result = value.replace(/<(?:.|\n)*?>/gm, '');
                }
            }

            return result;
        };

        exports.LEFT = function (text, number) {
            number = (number === undefined) ? 1 : number;
            number = utils.parseNumber(number);
            if (number instanceof Error || typeof text !== 'string') {
                return error.value;
            }
            return text ? text.substring(0, number) : null;
        };

        exports.LEN = function (text) {
            if (arguments.length === 0) {
                return error.error;
            }

            if (typeof text === 'string') {
                return text ? text.length : 0;
            }

            if (text.length) {
                return text.length;
            }

            return error.value;
        };

        exports.LOWER = function (text) {
            if (typeof text !== 'string') {
                return error.value;
            }
            return text ? text.toLowerCase() : text;
        };

        exports.MID = function (text, start, number) {
            start = utils.parseNumber(start);
            number = utils.parseNumber(number);
            if (utils.anyIsError(start, number) || typeof text !== 'string') {
                return number;
            }

            var begin = start - 1;
            var end = begin + number;

            return text.substring(begin, end);
        };

        exports.NUMBERVALUE = null;

        exports.PRONETIC = null;

        exports.PROPER = function (text) {
            if (text === undefined || text.length === 0) {
                return error.value;
            }
            if (text === true) {
                text = 'TRUE';
            }
            if (text === false) {
                text = 'FALSE';
            }
            if (isNaN(text) && typeof text === 'number') {
                return error.value;
            }
            if (typeof text === 'number') {
                text = '' + text;
            }

            return text.replace(/\w\S*/g, function (txt) {
                return txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase();
            });
        };

        exports.REGEXEXTRACT = function (text, regular_expression) {
            var match = text.match(new RegExp(regular_expression));
            return match ? (match[match.length > 1 ? match.length - 1 : 0]) : null;
        };

        exports.REGEXMATCH = function (text, regular_expression, full) {
            var match = text.match(new RegExp(regular_expression));
            return full ? match : !!match;
        };

        exports.REGEXREPLACE = function (text, regular_expression, replacement) {
            return text.replace(new RegExp(regular_expression), replacement);
        };

        exports.REPLACE = function (text, position, length, new_text) {
            position = utils.parseNumber(position);
            length = utils.parseNumber(length);
            if (utils.anyIsError(position, length) ||
                typeof text !== 'string' ||
                typeof new_text !== 'string') {
                return error.value;
            }
            return text.substr(0, position - 1) + new_text + text.substr(position - 1 + length);
        };

        exports.REPT = function (text, number) {
            number = utils.parseNumber(number);
            if (number instanceof Error) {
                return number;
            }
            return new Array(number + 1).join(text);
        };

        exports.RIGHT = function (text, number) {
            number = (number === undefined) ? 1 : number;
            number = utils.parseNumber(number);
            if (number instanceof Error) {
                return number;
            }
            return text ? text.substring(text.length - number) : null;
        };

        exports.SEARCH = function (find_text, within_text, position) {
            var foundAt;
            if (typeof find_text !== 'string' || typeof within_text !== 'string') {
                return error.value;
            }
            position = (position === undefined) ? 0 : position;
            foundAt = within_text.toLowerCase().indexOf(find_text.toLowerCase(), position - 1) + 1;
            return (foundAt === 0) ? error.value : foundAt;
        };

        exports.SPLIT = function (text, separator) {
            return text.split(separator);
        };

        exports.SUBSTITUTE = function (text, old_text, new_text, occurrence) {
            if (!text || !old_text || !new_text) {
                return text;
            } else if (occurrence === undefined) {
                return text.replace(new RegExp(old_text, 'g'), new_text);
            } else {
                var index = 0;
                var i = 0;
                while (text.indexOf(old_text, index) > 0) {
                    index = text.indexOf(old_text, index + 1);
                    i++;
                    if (i === occurrence) {
                        return text.substring(0, index) + new_text + text.substring(index + old_text.length);
                    }
                }
            }
        };

        exports.T = function (value) {
            return (typeof value === "string") ? value : '';
        };

        exports.TEXT = null;

        exports.TRIM = function (text) {
            if (typeof text !== 'string') {
                return error.value;
            }
            return text.replace(/ +/g, ' ').trim();
        };

        exports.UNICHAR = exports.CHAR;

        exports.UNICODE = exports.CODE;

        exports.UPPER = function (text) {
            if (typeof text !== 'string') {
                return error.value;
            }
            return text.toUpperCase();
        };

        exports.VALUE = null;

        return exports;
    })();

    jexcel.methods.stats = (function () {
        var exports = {};

        var SQRT2PI = 2.5066282746310002;

        exports.AVEDEV = null;

        exports.AVERAGE = function () {
            var range = utils.numbers(utils.flatten(arguments));
            var n = range.length;
            var sum = 0;
            var count = 0;
            for (var i = 0; i < n; i++) {
                sum += range[i];
                count += 1;
            }
            return sum / count;
        };

        exports.AVERAGEA = function () {
            var range = utils.flatten(arguments);
            var n = range.length;
            var sum = 0;
            var count = 0;
            for (var i = 0; i < n; i++) {
                var el = range[i];
                if (typeof el === 'number') {
                    sum += el;
                }
                if (el === true) {
                    sum++;
                }
                if (el !== null) {
                    count++;
                }
            }
            return sum / count;
        };

        exports.AVERAGEIF = function (range, criteria, average_range) {
            average_range = average_range || range;
            range = utils.flatten(range);
            average_range = utils.parseNumberArray(utils.flatten(average_range));
            if (average_range instanceof Error) {
                return average_range;
            }
            var average_count = 0;
            var result = 0;
            for (var i = 0; i < range.length; i++) {
                if (eval(range[i] + criteria)) { // jshint ignore:line
                    result += average_range[i];
                    average_count++;
                }
            }
            return result / average_count;
        };

        exports.AVERAGEIFS = null;

        exports.COUNT = function () {
            return utils.numbers(utils.flatten(arguments)).length;
        };

        exports.COUNTA = function () {
            var range = utils.flatten(arguments);
            return range.length - exports.COUNTBLANK(range);
        };

        exports.COUNTIN = function (range, value) {
            var result = 0;
            for (var i = 0; i < range.length; i++) {
                if (range[i] === value) {
                    result++;
                }
            }
            return result;
        };

        exports.COUNTBLANK = function () {
            var range = utils.flatten(arguments);
            var blanks = 0;
            var element;
            for (var i = 0; i < range.length; i++) {
                element = range[i];
                if (element === null || element === '') {
                    blanks++;
                }
            }
            return blanks;
        };

        exports.COUNTIF = function (range, criteria) {
            range = utils.flatten(range);
            if (!/[<>=!]/.test(criteria)) {
                criteria = '=="' + criteria + '"';
            }
            var matches = 0;
            for (var i = 0; i < range.length; i++) {
                if (typeof range[i] !== 'string') {
                    if (eval(range[i] + criteria)) { // jshint ignore:line
                        matches++;
                    }
                } else {
                    if (eval('"' + range[i] + '"' + criteria)) { // jshint ignore:line
                        matches++;
                    }
                }
            }
            return matches;
        };

        exports.COUNTIFS = function () {
            var args = utils.argsToArray(arguments);
            var results = new Array(utils.flatten(args[0]).length);
            for (var i = 0; i < results.length; i++) {
                results[i] = true;
            }
            for (i = 0; i < args.length; i += 2) {
                var range = utils.flatten(args[i]);
                var criteria = args[i + 1];
                if (!/[<>=!]/.test(criteria)) {
                    criteria = '=="' + criteria + '"';
                }
                for (var j = 0; j < range.length; j++) {
                    if (typeof range[j] !== 'string') {
                        results[j] = results[j] && eval(range[j] + criteria); // jshint ignore:line
                    } else {
                        results[j] = results[j] && eval('"' + range[j] + '"' + criteria); // jshint ignore:line
                    }
                }
            }
            var result = 0;
            for (i = 0; i < results.length; i++) {
                if (results[i]) {
                    result++;
                }
            }
            return result;
        };

        exports.COUNTUNIQUE = function () {
            return UNIQUE.apply(null, utils.flatten(arguments)).length;
        };

        exports.FISHER = function (x) {
            x = utils.parseNumber(x);
            if (x instanceof Error) {
                return x;
            }
            return Math.log((1 + x) / (1 - x)) / 2;
        };

        exports.FISHERINV = function (y) {
            y = utils.parseNumber(y);
            if (y instanceof Error) {
                return y;
            }
            var e2y = Math.exp(2 * y);
            return (e2y - 1) / (e2y + 1);
        };

        exports.FREQUENCY = function (data, bins) {
            data = utils.parseNumberArray(utils.flatten(data));
            bins = utils.parseNumberArray(utils.flatten(bins));
            if (utils.anyIsError(data, bins)) {
                return error.value;
            }
            var n = data.length;
            var b = bins.length;
            var r = [];
            for (var i = 0; i <= b; i++) {
                r[i] = 0;
                for (var j = 0; j < n; j++) {
                    if (i === 0) {
                        if (data[j] <= bins[0]) {
                            r[0] += 1;
                        }
                    } else if (i < b) {
                        if (data[j] > bins[i - 1] && data[j] <= bins[i]) {
                            r[i] += 1;
                        }
                    } else if (i === b) {
                        if (data[j] > bins[b - 1]) {
                            r[b] += 1;
                        }
                    }
                }
            }
            return r;
        };

        exports.LARGE = function (range, k) {
            range = utils.parseNumberArray(utils.flatten(range));
            k = utils.parseNumber(k);
            if (utils.anyIsError(range, k)) {
                return range;
            }
            return range.sort(function (a, b) {
                return b - a;
            })[k - 1];
        };

        exports.MAX = function () {
            var range = utils.numbers(utils.flatten(arguments));
            return (range.length === 0) ? 0 : Math.max.apply(Math, range);
        };

        exports.MAXA = function () {
            var range = utils.arrayValuesToNumbers(utils.flatten(arguments));
            return (range.length === 0) ? 0 : Math.max.apply(Math, range);
        };

        exports.MIN = function () {
            var range = utils.numbers(utils.flatten(arguments));
            return (range.length === 0) ? 0 : Math.min.apply(Math, range);
        };

        exports.MINA = function () {
            var range = utils.arrayValuesToNumbers(utils.flatten(arguments));
            return (range.length === 0) ? 0 : Math.min.apply(Math, range);
        };

        exports.MODE = {};

        exports.MODE.MULT = function () {
            // Credits: Ronan
            var range = utils.parseNumberArray(utils.flatten(arguments));
            if (range instanceof Error) {
                return range;
            }
            var n = range.length;
            var count = {};
            var maxItems = [];
            var max = 0;
            var currentItem;

            for (var i = 0; i < n; i++) {
                currentItem = range[i];
                count[currentItem] = count[currentItem] ? count[currentItem] + 1 : 1;
                if (count[currentItem] > max) {
                    max = count[currentItem];
                    maxItems = [];
                }
                if (count[currentItem] === max) {
                    maxItems[maxItems.length] = currentItem;
                }
            }
            return maxItems;
        };

        exports.MODE.SNGL = function () {
            var range = utils.parseNumberArray(utils.flatten(arguments));
            if (range instanceof Error) {
                return range;
            }
            return exports.MODE.MULT(range).sort(function (a, b) {
                return a - b;
            })[0];
        };

        exports.PERCENTILE = {};

        exports.PERCENTILE.EXC = function (array, k) {
            array = utils.parseNumberArray(utils.flatten(array));
            k = utils.parseNumber(k);
            if (utils.anyIsError(array, k)) {
                return error.value;
            }
            array = array.sort(function (a, b) {
                {
                    return a - b;
                }
            });
            var n = array.length;
            if (k < 1 / (n + 1) || k > 1 - 1 / (n + 1)) {
                return error.num;
            }
            var l = k * (n + 1) - 1;
            var fl = Math.floor(l);
            return utils.cleanFloat((l === fl) ? array[l] : array[fl] + (l - fl) * (array[fl + 1] - array[fl]));
        };

        exports.PERCENTILE.INC = function (array, k) {
            array = utils.parseNumberArray(utils.flatten(array));
            k = utils.parseNumber(k);
            if (utils.anyIsError(array, k)) {
                return error.value;
            }
            array = array.sort(function (a, b) {
                return a - b;
            });
            var n = array.length;
            var l = k * (n - 1);
            var fl = Math.floor(l);
            return utils.cleanFloat((l === fl) ? array[l] : array[fl] + (l - fl) * (array[fl + 1] - array[fl]));
        };

        exports.PERCENTRANK = {};

        exports.PERCENTRANK.EXC = function (array, x, significance) {
            significance = (significance === undefined) ? 3 : significance;
            array = utils.parseNumberArray(utils.flatten(array));
            x = utils.parseNumber(x);
            significance = utils.parseNumber(significance);
            if (utils.anyIsError(array, x, significance)) {
                return error.value;
            }
            array = array.sort(function (a, b) {
                return a - b;
            });
            var uniques = UNIQUE.apply(null, array);
            var n = array.length;
            var m = uniques.length;
            var power = Math.pow(10, significance);
            var result = 0;
            var match = false;
            var i = 0;
            while (!match && i < m) {
                if (x === uniques[i]) {
                    result = (array.indexOf(uniques[i]) + 1) / (n + 1);
                    match = true;
                } else if (x >= uniques[i] && (x < uniques[i + 1] || i === m - 1)) {
                    result = (array.indexOf(uniques[i]) + 1 + (x - uniques[i]) / (uniques[i + 1] - uniques[i])) / (n + 1);
                    match = true;
                }
                i++;
            }
            return Math.floor(result * power) / power;
        };

        exports.PERCENTRANK.INC = function (array, x, significance) {
            significance = (significance === undefined) ? 3 : significance;
            array = utils.parseNumberArray(utils.flatten(array));
            x = utils.parseNumber(x);
            significance = utils.parseNumber(significance);
            if (utils.anyIsError(array, x, significance)) {
                return error.value;
            }
            array = array.sort(function (a, b) {
                return a - b;
            });
            var uniques = UNIQUE.apply(null, array);
            var n = array.length;
            var m = uniques.length;
            var power = Math.pow(10, significance);
            var result = 0;
            var match = false;
            var i = 0;
            while (!match && i < m) {
                if (x === uniques[i]) {
                    result = array.indexOf(uniques[i]) / (n - 1);
                    match = true;
                } else if (x >= uniques[i] && (x < uniques[i + 1] || i === m - 1)) {
                    result = (array.indexOf(uniques[i]) + (x - uniques[i]) / (uniques[i + 1] - uniques[i])) / (n - 1);
                    match = true;
                }
                i++;
            }
            return Math.floor(result * power) / power;
        };

        exports.PERMUT = function (number, number_chosen) {
            number = utils.parseNumber(number);
            number_chosen = utils.parseNumber(number_chosen);
            if (utils.anyIsError(number, number_chosen)) {
                return error.value;
            }
            return FACT(number) / FACT(number - number_chosen);
        };

        exports.PERMUTATIONA = function (number, number_chosen) {
            number = utils.parseNumber(number);
            number_chosen = utils.parseNumber(number_chosen);
            if (utils.anyIsError(number, number_chosen)) {
                return error.value;
            }
            return Math.pow(number, number_chosen);
        };

        exports.PHI = function (x) {
            x = utils.parseNumber(x);
            if (x instanceof Error) {
                return error.value;
            }
            return Math.exp(-0.5 * x * x) / SQRT2PI;
        };

        exports.PROB = function (range, probability, lower, upper) {
            if (lower === undefined) {
                return 0;
            }
            upper = (upper === undefined) ? lower : upper;

            range = utils.parseNumberArray(utils.flatten(range));
            probability = utils.parseNumberArray(utils.flatten(probability));
            lower = utils.parseNumber(lower);
            upper = utils.parseNumber(upper);
            if (utils.anyIsError(range, probability, lower, upper)) {
                return error.value;
            }

            if (lower === upper) {
                return (range.indexOf(lower) >= 0) ? probability[range.indexOf(lower)] : 0;
            }

            var sorted = range.sort(function (a, b) {
                return a - b;
            });
            var n = sorted.length;
            var result = 0;
            for (var i = 0; i < n; i++) {
                if (sorted[i] >= lower && sorted[i] <= upper) {
                    result += probability[range.indexOf(sorted[i])];
                }
            }
            return result;
        };

        exports.QUARTILE = {};

        exports.QUARTILE.EXC = function (range, quart) {
            range = utils.parseNumberArray(utils.flatten(range));
            quart = utils.parseNumber(quart);
            if (utils.anyIsError(range, quart)) {
                return error.value;
            }
            switch (quart) {
                case 1:
                    return exports.PERCENTILE.EXC(range, 0.25);
                case 2:
                    return exports.PERCENTILE.EXC(range, 0.5);
                case 3:
                    return exports.PERCENTILE.EXC(range, 0.75);
                default:
                    return error.num;
            }
        };

        exports.QUARTILE.INC = function (range, quart) {
            range = utils.parseNumberArray(utils.flatten(range));
            quart = utils.parseNumber(quart);
            if (utils.anyIsError(range, quart)) {
                return error.value;
            }
            switch (quart) {
                case 1:
                    return exports.PERCENTILE.INC(range, 0.25);
                case 2:
                    return exports.PERCENTILE.INC(range, 0.5);
                case 3:
                    return exports.PERCENTILE.INC(range, 0.75);
                default:
                    return error.num;
            }
        };

        exports.RANK = {};

        exports.RANK.AVG = function (number, range, order) {
            number = utils.parseNumber(number);
            range = utils.parseNumberArray(utils.flatten(range));
            if (utils.anyIsError(number, range)) {
                return error.value;
            }
            range = utils.flatten(range);
            order = order || false;
            var sort = (order) ? function (a, b) {
                return a - b;
            } : function (a, b) {
                return b - a;
            };
            range = range.sort(sort);

            var length = range.length;
            var count = 0;
            for (var i = 0; i < length; i++) {
                if (range[i] === number) {
                    count++;
                }
            }

            return (count > 1) ? (2 * range.indexOf(number) + count + 1) / 2 : range.indexOf(number) + 1;
        };

        exports.RANK.EQ = function (number, range, order) {
            number = utils.parseNumber(number);
            range = utils.parseNumberArray(utils.flatten(range));
            if (utils.anyIsError(number, range)) {
                return error.value;
            }
            order = order || false;
            var sort = (order) ? function (a, b) {
                return a - b;
            } : function (a, b) {
                return b - a;
            };
            range = range.sort(sort);
            return range.indexOf(number) + 1;
        };

        exports.RSQ = function (data_x, data_y) { // no need to flatten here, PEARSON will take care of that
            data_x = utils.parseNumberArray(utils.flatten(data_x));
            data_y = utils.parseNumberArray(utils.flatten(data_y));
            if (utils.anyIsError(data_x, data_y)) {
                return error.value;
            }
            return Math.pow(exports.PEARSON(data_x, data_y), 2);
        };

        exports.SMALL = function (range, k) {
            range = utils.parseNumberArray(utils.flatten(range));
            k = utils.parseNumber(k);
            if (utils.anyIsError(range, k)) {
                return range;
            }
            return range.sort(function (a, b) {
                return a - b;
            })[k - 1];
        };

        exports.STANDARDIZE = function (x, mean, sd) {
            x = utils.parseNumber(x);
            mean = utils.parseNumber(mean);
            sd = utils.parseNumber(sd);
            if (utils.anyIsError(x, mean, sd)) {
                return error.value;
            }
            return (x - mean) / sd;
        };

        exports.STDEV = {};

        exports.STDEV.P = function () {
            var v = exports.VAR.P.apply(this, arguments);
            return Math.sqrt(v);
        };

        exports.STDEV.S = function () {
            var v = exports.VAR.S.apply(this, arguments);
            return Math.sqrt(v);
        };

        exports.STDEVA = function () {
            var v = exports.VARA.apply(this, arguments);
            return Math.sqrt(v);
        };

        exports.STDEVPA = function () {
            var v = exports.VARPA.apply(this, arguments);
            return Math.sqrt(v);
        };

        exports.VAR = {};

        exports.VAR.P = function () {
            var range = utils.numbers(utils.flatten(arguments));
            var n = range.length;
            var sigma = 0;
            var mean = exports.AVERAGE(range);
            for (var i = 0; i < n; i++) {
                sigma += Math.pow(range[i] - mean, 2);
            }
            return sigma / n;
        };

        exports.VAR.S = function () {
            var range = utils.numbers(utils.flatten(arguments));
            var n = range.length;
            var sigma = 0;
            var mean = exports.AVERAGE(range);
            for (var i = 0; i < n; i++) {
                sigma += Math.pow(range[i] - mean, 2);
            }
            return sigma / (n - 1);
        };

        exports.VARA = function () {
            var range = utils.flatten(arguments);
            var n = range.length;
            var sigma = 0;
            var count = 0;
            var mean = exports.AVERAGEA(range);
            for (var i = 0; i < n; i++) {
                var el = range[i];
                if (typeof el === 'number') {
                    sigma += Math.pow(el - mean, 2);
                } else if (el === true) {
                    sigma += Math.pow(1 - mean, 2);
                } else {
                    sigma += Math.pow(0 - mean, 2);
                }

                if (el !== null) {
                    count++;
                }
            }
            return sigma / (count - 1);
        };

        exports.VARPA = function () {
            var range = utils.flatten(arguments);
            var n = range.length;
            var sigma = 0;
            var count = 0;
            var mean = exports.AVERAGEA(range);
            for (var i = 0; i < n; i++) {
                var el = range[i];
                if (typeof el === 'number') {
                    sigma += Math.pow(el - mean, 2);
                } else if (el === true) {
                    sigma += Math.pow(1 - mean, 2);
                } else {
                    sigma += Math.pow(0 - mean, 2);
                }

                if (el !== null) {
                    count++;
                }
            }
            return sigma / count;
        };

        exports.WEIBULL = {};

        exports.WEIBULL.DIST = function (x, alpha, beta, cumulative) {
            x = utils.parseNumber(x);
            alpha = utils.parseNumber(alpha);
            beta = utils.parseNumber(beta);
            if (utils.anyIsError(x, alpha, beta)) {
                return error.value;
            }
            return (cumulative) ? 1 - Math.exp(-Math.pow(x / beta, alpha)) : Math.pow(x, alpha - 1) * Math.exp(-Math.pow(x / beta, alpha)) * alpha / Math.pow(beta, alpha);
        };

        exports.Z = {};

        exports.Z.TEST = function (range, x, sd) {
            range = utils.parseNumberArray(utils.flatten(range));
            x = utils.parseNumber(x);
            if (utils.anyIsError(range, x)) {
                return error.value;
            }

            sd = sd || exports.STDEV.S(range);
            var n = range.length;
            return 1 - exports.NORM.S.DIST((exports.AVERAGE(range) - x) / (sd / Math.sqrt(n)), true);
        };

        return exports;
    })();

    jexcel.methods.utils = (function () {
        var exports = {};

        exports.PROGRESS = function (p, c) {
            var color = c ? c : 'red';
            var value = p ? p : '0';

            return '<div style="width:' + value + '%;height:4px;background-color:' + color + ';margin-top:1px;"></div>';
        };

        exports.RATING = function (v) {
            var html = '<div class="jrating">';
            for (var i = 0; i < 5; i++) {
                if (i < v) {
                    html += '<div class="jrating-selected"></div>';
                } else {
                    html += '<div></div>';
                }
            }
            html += '</div>';
            return html;
        }

        return exports;
    })();

    for (var i = 0; i < Object.keys(jexcel.methods).length; i++) {
        var methods = jexcel.methods[Object.keys(jexcel.methods)[i]];
        for (var j = 0; j < Object.keys(methods).length; j++) {
            if (typeof (methods[Object.keys(methods)[j]]) == 'function') {
                window[Object.keys(methods)[j]] = methods[Object.keys(methods)[j]];
            } else {
                window[Object.keys(methods)[j]] = function () {
                    return Object.keys(methods)[j] + 'Not implemented';
                }
            }
        }
    }

    return jexcel;
})));

/***/ })

/******/ 	});
/************************************************************************/
/******/ 	// The module cache
/******/ 	var __webpack_module_cache__ = {};
/******/ 	
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/ 		// Check if module is in cache
/******/ 		var cachedModule = __webpack_module_cache__[moduleId];
/******/ 		if (cachedModule !== undefined) {
/******/ 			return cachedModule.exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = __webpack_module_cache__[moduleId] = {
/******/ 			// no module.id needed
/******/ 			// no module.loaded needed
/******/ 			exports: {}
/******/ 		};
/******/ 	
/******/ 		// Execute the module function
/******/ 		__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);
/******/ 	
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/ 	
/************************************************************************/
/******/ 	
/******/ 	// startup
/******/ 	// Load entry module and return exports
/******/ 	// This entry module is referenced by other modules so it can't be inlined
/******/ 	var __webpack_exports__ = __webpack_require__("./src/jexcel.js");
/******/ 	
/******/ })()
;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9hc3NldHMvLi9zcmMvamV4Y2VsLmpzIiwid2VicGFjazovL2Fzc2V0cy93ZWJwYWNrL2Jvb3RzdHJhcCIsIndlYnBhY2s6Ly9hc3NldHMvd2VicGFjay9zdGFydHVwIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7OztBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsQ0FBQztBQUNELElBQUksS0FBNEQ7QUFDaEUsUUFBUSxDQUM2QjtBQUNyQyxDQUFDOztBQUVEOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxzQkFBc0IsUUFBUTtBQUM5QjtBQUNBLHNCQUFzQixRQUFRO0FBQzlCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDBCQUEwQjtBQUMxQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNENBQTRDLEVBQUUsS0FBSyxFQUFFO0FBQ3JEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7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O0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCLGFBQWE7QUFDYjs7QUFFQTtBQUNBLEtBQUs7O0FBRUw7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtB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O0FBQ2hDOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0EsYUFBYTtBQUNiO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLDJCQUEyQixrQkFBa0I7QUFDN0M7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLCtCQUErQixrQkFBa0I7QUFDakQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBOztBQUVBO0FBQ0EsK0JBQStCLGtCQUFrQjtBQUNqRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLDJCQUEyQixJQUFJO0FBQy9CO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSwyQkFBMkIsS0FBSztBQUNoQztBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsMkJBQTJCLElBQUk7QUFDL0I7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSwrQkFBK0IsS0FBSztBQUNwQztBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLCtCQUErQixLQUFLO0FBQ3BDO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsK0JBQStCLEtBQUs7QUFDcEM7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSwyQkFBMkIsc0JBQXNCO0FBQ2pEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBLDJCQUEyQixpQkFBaUI7QUFDNUM7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EseUJBQXlCLEtBQUs7QUFDOUI7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSx5QkFBeUIsS0FBSztBQUM5QjtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLHlCQUF5QixLQUFLO0FBQzlCO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsS0FBSzs7QUFFTDtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLCtCQUErQixVQUFVO0FBQ3pDO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBLCtCQUErQixVQUFVO0FBQ3pDO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSwyQkFBMkIsY0FBYztBQUN6QztBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSwyQkFBMkIsYUFBYTtBQUN4QztBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBLDJCQUEyQixPQUFPO0FBQ2xDO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsK0JBQStCLG1CQUFtQjtBQUNsRDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLCtCQUErQixtQkFBbUI7QUFDbEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMkJBQTJCLG1CQUFtQjtBQUM5QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTs7QUFFYjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSwyQkFBMkIsT0FBTztBQUNsQztBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0EsMkJBQTJCLGlCQUFpQjtBQUM1QztBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLCtCQUErQixtQkFBbUI7QUFDbEQ7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSwrQkFBK0IsbUJBQW1CO0FBQ2xEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSwyQkFBMkIsbUJBQW1CO0FBQzlDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTs7QUFFYjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSwyQkFBMkIsbUJBQW1CO0FBQzlDO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0EsS0FBSzs7QUFFTDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0EsMkJBQTJCLEtBQUs7QUFDaEM7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLEtBQUs7O0FBRUw7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSwyQkFBMkIsaUJBQWlCO0FBQzVDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLDJCQUEyQixpQkFBaUI7QUFDNUM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSwyQkFBMkIsaUJBQWlCO0FBQzVDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsdUNBQXVDLHFCQUFxQjtBQUM1RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0EsS0FBSzs7QUFFTDtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQSw0QkFBNEIsSUFBSSxjQUFjLElBQUksY0FBYyxJQUFJO0FBQ3BFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQixhQUFhO0FBQ2I7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7O0FBR0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDZDQUE2QztBQUM3QztBQUNBO0FBQ0EsaUVBQWlFLGlCQUFpQjtBQUNsRjtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBLHNEQUFzRDtBQUN0RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMkJBQTJCLGlCQUFpQjtBQUM1QztBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwyQkFBMkIsaUJBQWlCO0FBQzVDO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwyQkFBMkIseUJBQXlCO0FBQ3BEO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsMkJBQTJCLHFCQUFxQjtBQUNoRDtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDJCQUEyQixrQkFBa0I7QUFDN0MscUVBQXFFO0FBQ3JFO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0EsMkJBQTJCLHNCQUFzQjtBQUNqRDtBQUNBO0FBQ0EsK0JBQStCLGlCQUFpQjtBQUNoRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esc0NBQXNDO0FBQ3RDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwyQkFBMkIsWUFBWTtBQUN2QztBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDJCQUEyQixvQkFBb0I7QUFDL0M7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMkJBQTJCLG9CQUFvQjtBQUMvQztBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwyQkFBMkIsb0JBQW9CO0FBQy9DO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxLQUFLOztBQUVMO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLDJCQUEyQixzQkFBc0I7QUFDakQ7QUFDQTs7QUFFQTtBQUNBLCtCQUErQixtQkFBbUI7QUFDbEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSwrQkFBK0IsaUJBQWlCO0FBQ2hEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7O0FBRUE7O0FBRUE7QUFDQSxLQUFLOztBQUVMO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckIsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBLEtBQUs7O0FBRUw7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMkJBQTJCLE9BQU87QUFDbEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMkJBQTJCLE9BQU87QUFDbEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMkJBQTJCLGtCQUFrQjtBQUM3QyxnREFBZ0Q7QUFDaEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsMkJBQTJCLGtCQUFrQjtBQUM3QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSwyQkFBMkIsa0JBQWtCO0FBQzdDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDJCQUEyQixrQkFBa0I7QUFDN0M7QUFDQSxvREFBb0Q7QUFDcEQ7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQixnRUFBZ0U7QUFDaEU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLDJCQUEyQixvQkFBb0I7QUFDL0M7QUFDQTtBQUNBLHVCQUF1QixpQkFBaUI7QUFDeEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLCtCQUErQixrQkFBa0I7QUFDakQ7QUFDQSw2RUFBNkU7QUFDN0UscUJBQXFCO0FBQ3JCLHlGQUF5RjtBQUN6RjtBQUNBO0FBQ0E7QUFDQTtBQUNBLHVCQUF1QixvQkFBb0I7QUFDM0M7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDJCQUEyQixRQUFRO0FBQ25DO0FBQ0EsK0JBQStCLE9BQU87QUFDdEM7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLDJCQUEyQixPQUFPO0FBQ2xDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLDJCQUEyQixPQUFPO0FBQ2xDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSwyQkFBMkIsWUFBWTtBQUN2QztBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLGlEQUFpRDtBQUNqRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMkJBQTJCLE9BQU87QUFDbEM7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDJCQUEyQixPQUFPO0FBQ2xDO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDJCQUEyQixPQUFPO0FBQ2xDO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwyQkFBMkIsT0FBTztBQUNsQztBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLEtBQUs7O0FBRUw7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUEscURBQXFELFdBQVcsK0JBQStCLGVBQWU7QUFDOUc7O0FBRUE7QUFDQTtBQUNBLDJCQUEyQixPQUFPO0FBQ2xDO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsS0FBSzs7QUFFTCxtQkFBbUIsd0NBQXdDO0FBQzNEO0FBQ0EsdUJBQXVCLGlDQUFpQztBQUN4RDtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLENBQUMsSTs7Ozs7O1VDdjliRDtVQUNBOztVQUVBO1VBQ0E7VUFDQTtVQUNBO1VBQ0E7VUFDQTtVQUNBO1VBQ0E7VUFDQTtVQUNBO1VBQ0E7VUFDQTtVQUNBOztVQUVBO1VBQ0E7O1VBRUE7VUFDQTtVQUNBOzs7O1VDdEJBO1VBQ0E7VUFDQTtVQUNBIiwiZmlsZSI6ImpleGNlbC5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxyXG4gKiBqRXhjZWwgdjQuNS4zXHJcbiAqXHJcbiAqIFdlYnNpdGU6IGh0dHBzOi8vYm9zc2Fub3ZhLnVrL2pleGNlbC9cclxuICogRGVzY3JpcHRpb246IENyZWF0ZSBhbWF6aW5nIHdlYiBiYXNlZCBzcHJlYWRzaGVldHMuXHJcbiAqXHJcbiAqIFRoaXMgc29mdHdhcmUgaXMgZGlzdHJpYnV0ZSB1bmRlciBNSVQgTGljZW5zZVxyXG4gKi9cclxuXHJcbi8vIGlmICghalN1aXRlcyAmJiB0eXBlb2YgKHJlcXVpcmUpID09PSAnZnVuY3Rpb24nKSB7XHJcbi8vICAgICB2YXIgalN1aXRlcyA9IHJlcXVpcmUoJ2pzdWl0ZXMnKTtcclxuLy8gICAgIHJlcXVpcmUoJ2pzdWl0ZXMvZGlzdC9qc3VpdGVzLmNzcycpO1xyXG4vLyB9XHJcblxyXG47KGZ1bmN0aW9uIChnbG9iYWwsIGZhY3RvcnkpIHtcclxuICAgIHR5cGVvZiBleHBvcnRzID09PSAnb2JqZWN0JyAmJiB0eXBlb2YgbW9kdWxlICE9PSAndW5kZWZpbmVkJyA/IG1vZHVsZS5leHBvcnRzID0gZmFjdG9yeSgpIDpcclxuICAgICAgICB0eXBlb2YgZGVmaW5lID09PSAnZnVuY3Rpb24nICYmIGRlZmluZS5hbWQgPyBkZWZpbmUoZmFjdG9yeSkgOlxyXG4gICAgICAgICAgICBnbG9iYWwuamV4Y2VsID0gZmFjdG9yeSgpO1xyXG59KHRoaXMsIChmdW5jdGlvbiAoKSB7XHJcblxyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIC8vIEpleGNlbCBjb3JlIG9iamVjdFxyXG5cclxuICAgIHZhciBqZXhjZWwgPSAoZnVuY3Rpb24gKGVsLCBvcHRpb25zKSB7XHJcbiAgICAgICAgLy8gQ3JlYXRlIGpleGNlbCBvYmplY3RcclxuICAgICAgICB2YXIgb2JqID0ge307XHJcbiAgICAgICAgb2JqLm9wdGlvbnMgPSB7fTtcclxuXHJcbiAgICAgICAgaWYgKCEoZWwgaW5zdGFuY2VvZiBFbGVtZW50IHx8IGVsIGluc3RhbmNlb2YgSFRNTERvY3VtZW50KSkge1xyXG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKCdKRVhDRUw6IGVsIGlzIG5vdCBhIHZhbGlkIERPTSBlbGVtZW50Jyk7XHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICB9IGVsc2UgaWYgKGVsLnRhZ05hbWUgPT0gJ1RBQkxFJykge1xyXG4gICAgICAgICAgICBpZiAob3B0aW9ucyA9IGpleGNlbC5jcmVhdGVGcm9tVGFibGUoZWwsIG9wdGlvbnMpKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgZGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcbiAgICAgICAgICAgICAgICBlbC5wYXJlbnROb2RlLmluc2VydEJlZm9yZShkaXYsIGVsKTtcclxuICAgICAgICAgICAgICAgIGVsLnJlbW92ZSgpO1xyXG4gICAgICAgICAgICAgICAgZWwgPSBkaXY7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCdKRVhDRUw6IGVsIGlzIG5vdCBhIHZhbGlkIERPTSBlbGVtZW50Jyk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIExvYWRpbmcgZGVmYXVsdCBjb25maWd1cmF0aW9uXHJcbiAgICAgICAgdmFyIGRlZmF1bHRzID0ge1xyXG4gICAgICAgICAgICAvLyBFeHRlcm5hbCBkYXRhXHJcbiAgICAgICAgICAgIHVybDogbnVsbCxcclxuICAgICAgICAgICAgLy8gQWpheCBvcHRpb25zXHJcbiAgICAgICAgICAgIG1ldGhvZDogJ0dFVCcsXHJcbiAgICAgICAgICAgIHJlcXVlc3RWYXJpYWJsZXM6IG51bGwsXHJcbiAgICAgICAgICAgIC8vIERhdGFcclxuICAgICAgICAgICAgZGF0YTogbnVsbCxcclxuICAgICAgICAgICAgLy8gQ3VzdG9tIHNvcnRpbmcgaGFuZGxlclxyXG4gICAgICAgICAgICBzb3J0aW5nOiBudWxsLFxyXG4gICAgICAgICAgICAvLyBDb3B5IGJlaGF2aW9yXHJcbiAgICAgICAgICAgIGNvcHlDb21wYXRpYmlsaXR5OiBmYWxzZSxcclxuICAgICAgICAgICAgcm9vdDogbnVsbCxcclxuICAgICAgICAgICAgLy8gUm93cyBhbmQgY29sdW1ucyBkZWZpbml0aW9uc1xyXG4gICAgICAgICAgICByb3dzOiBbXSxcclxuICAgICAgICAgICAgY29sdW1uczogW10sXHJcbiAgICAgICAgICAgIC8vIERlcHJlY3RlZCBsZWdhY3kgb3B0aW9uc1xyXG4gICAgICAgICAgICBjb2xIZWFkZXJzOiBbXSxcclxuICAgICAgICAgICAgY29sV2lkdGhzOiBbXSxcclxuICAgICAgICAgICAgY29sQWxpZ25tZW50czogW10sXHJcbiAgICAgICAgICAgIG5lc3RlZEhlYWRlcnM6IG51bGwsXHJcbiAgICAgICAgICAgIC8vIENvbHVtbiB3aWR0aCB0aGF0IGlzIHVzZWQgYnkgZGVmYXVsdFxyXG4gICAgICAgICAgICBkZWZhdWx0Q29sV2lkdGg6IDUwLFxyXG4gICAgICAgICAgICBkZWZhdWx0Q29sQWxpZ246ICdjZW50ZXInLFxyXG4gICAgICAgICAgICAvLyBTcGFyZSByb3dzIGFuZCBjb2x1bW5zXHJcbiAgICAgICAgICAgIG1pblNwYXJlUm93czogMCxcclxuICAgICAgICAgICAgbWluU3BhcmVDb2xzOiAwLFxyXG4gICAgICAgICAgICAvLyBNaW5pbWFsIHRhYmxlIGRpbWVuc2lvbnNcclxuICAgICAgICAgICAgbWluRGltZW5zaW9uczogWzAsIDBdLFxyXG4gICAgICAgICAgICAvLyBBbGxvdyBFeHBvcnRcclxuICAgICAgICAgICAgYWxsb3dFeHBvcnQ6IHRydWUsXHJcbiAgICAgICAgICAgIC8vIEB0eXBlIHtib29sZWFufSAtIEluY2x1ZGUgdGhlIGhlYWRlciB0aXRsZXMgb24gZG93bmxvYWRcclxuICAgICAgICAgICAgaW5jbHVkZUhlYWRlcnNPbkRvd25sb2FkOiBmYWxzZSxcclxuICAgICAgICAgICAgLy8gQHR5cGUge2Jvb2xlYW59IC0gSW5jbHVkZSB0aGUgaGVhZGVyIHRpdGxlcyBvbiBjb3B5XHJcbiAgICAgICAgICAgIGluY2x1ZGVIZWFkZXJzT25Db3B5OiBmYWxzZSxcclxuICAgICAgICAgICAgLy8gQWxsb3cgY29sdW1uIHNvcnRpbmdcclxuICAgICAgICAgICAgY29sdW1uU29ydGluZzogdHJ1ZSxcclxuICAgICAgICAgICAgLy8gQWxsb3cgY29sdW1uIGRyYWdnaW5nXHJcbiAgICAgICAgICAgIGNvbHVtbkRyYWc6IGZhbHNlLFxyXG4gICAgICAgICAgICAvLyBBbGxvdyBjb2x1bW4gcmVzaXppbmdcclxuICAgICAgICAgICAgY29sdW1uUmVzaXplOiB0cnVlLFxyXG4gICAgICAgICAgICAvLyBBbGxvdyByb3cgcmVzaXppbmdcclxuICAgICAgICAgICAgcm93UmVzaXplOiBmYWxzZSxcclxuICAgICAgICAgICAgLy8gQWxsb3cgcm93IGRyYWdnaW5nXHJcbiAgICAgICAgICAgIHJvd0RyYWc6IHRydWUsXHJcbiAgICAgICAgICAgIC8vIEFsbG93IHRhYmxlIGVkaXRpb25cclxuICAgICAgICAgICAgZWRpdGFibGU6IHRydWUsXHJcbiAgICAgICAgICAgIC8vIEFsbG93IG5ldyByb3dzXHJcbiAgICAgICAgICAgIGFsbG93SW5zZXJ0Um93OiB0cnVlLFxyXG4gICAgICAgICAgICAvLyBBbGxvdyBuZXcgcm93c1xyXG4gICAgICAgICAgICBhbGxvd01hbnVhbEluc2VydFJvdzogdHJ1ZSxcclxuICAgICAgICAgICAgLy8gQWxsb3cgbmV3IGNvbHVtbnNcclxuICAgICAgICAgICAgYWxsb3dJbnNlcnRDb2x1bW46IHRydWUsXHJcbiAgICAgICAgICAgIC8vIEFsbG93IG5ldyByb3dzXHJcbiAgICAgICAgICAgIGFsbG93TWFudWFsSW5zZXJ0Q29sdW1uOiB0cnVlLFxyXG4gICAgICAgICAgICAvLyBBbGxvdyByb3cgZGVsZXRlXHJcbiAgICAgICAgICAgIGFsbG93RGVsZXRlUm93OiB0cnVlLFxyXG4gICAgICAgICAgICAvLyBBbGxvdyBkZWxldGluZyBvZiBhbGwgcm93c1xyXG4gICAgICAgICAgICBhbGxvd0RlbGV0aW5nQWxsUm93czogZmFsc2UsXHJcbiAgICAgICAgICAgIC8vIEFsbG93IGNvbHVtbiBkZWxldGVcclxuICAgICAgICAgICAgYWxsb3dEZWxldGVDb2x1bW46IHRydWUsXHJcbiAgICAgICAgICAgIC8vIEFsbG93IHJlbmFtZSBjb2x1bW5cclxuICAgICAgICAgICAgYWxsb3dSZW5hbWVDb2x1bW46IHRydWUsXHJcbiAgICAgICAgICAgIC8vIEFsbG93IGNvbW1lbnRzXHJcbiAgICAgICAgICAgIGFsbG93Q29tbWVudHM6IGZhbHNlLFxyXG4gICAgICAgICAgICAvLyBBbGxvdyBjb3B5IGZvbGxvdyB4IGF4aXNcclxuICAgICAgICAgICAgYWxsb3dYQ29weTogdHJ1ZSxcclxuICAgICAgICAgICAgLy8gR2xvYmFsIHdyYXBcclxuICAgICAgICAgICAgd29yZFdyYXA6IGZhbHNlLFxyXG4gICAgICAgICAgICAvLyBJbWFnZSBvcHRpb25zXHJcbiAgICAgICAgICAgIGltYWdlT3B0aW9uczogbnVsbCxcclxuICAgICAgICAgICAgLy8gQ1NWIHNvdXJjZVxyXG4gICAgICAgICAgICBjc3Y6IG51bGwsXHJcbiAgICAgICAgICAgIC8vIEZpbGVuYW1lXHJcbiAgICAgICAgICAgIGNzdkZpbGVOYW1lOiAnamV4Y2VsJyxcclxuICAgICAgICAgICAgLy8gQ29uc2lkZXIgZmlyc3QgbGluZSBhcyBoZWFkZXJcclxuICAgICAgICAgICAgY3N2SGVhZGVyczogdHJ1ZSxcclxuICAgICAgICAgICAgLy8gRGVsaW1pdGVyc1xyXG4gICAgICAgICAgICBjc3ZEZWxpbWl0ZXI6ICcsJyxcclxuICAgICAgICAgICAgLy8gRmlyc3Qgcm93IGFzIGhlYWRlclxyXG4gICAgICAgICAgICBwYXJzZVRhYmxlRmlyc3RSb3dBc0hlYWRlcjogZmFsc2UsXHJcbiAgICAgICAgICAgIHBhcnNlVGFibGVBdXRvQ2VsbFR5cGU6IGZhbHNlLFxyXG4gICAgICAgICAgICAvLyBEaXNhYmxlIGNvcm5lciBzZWxlY3Rpb25cclxuICAgICAgICAgICAgc2VsZWN0aW9uQ29weTogdHJ1ZSxcclxuICAgICAgICAgICAgLy8gTWVyZ2VkIGNlbGxzXHJcbiAgICAgICAgICAgIG1lcmdlQ2VsbHM6IHt9LFxyXG4gICAgICAgICAgICAvLyBDcmVhdGUgdG9vbGJhclxyXG4gICAgICAgICAgICB0b29sYmFyOiBudWxsLFxyXG4gICAgICAgICAgICAvLyBBbGxvdyBzZWFyY2hcclxuICAgICAgICAgICAgc2VhcmNoOiBmYWxzZSxcclxuICAgICAgICAgICAgLy8gQ3JlYXRlIHBhZ2luYXRpb25cclxuICAgICAgICAgICAgcGFnaW5hdGlvbjogZmFsc2UsXHJcbiAgICAgICAgICAgIHBhZ2luYXRpb25PcHRpb25zOiBudWxsLFxyXG4gICAgICAgICAgICAvLyBGdWxsIHNjcmVlblxyXG4gICAgICAgICAgICBmdWxsc2NyZWVuOiBmYWxzZSxcclxuICAgICAgICAgICAgLy8gTGF6eSBsb2FkaW5nXHJcbiAgICAgICAgICAgIGxhenlMb2FkaW5nOiBmYWxzZSxcclxuICAgICAgICAgICAgbG9hZGluZ1NwaW46IGZhbHNlLFxyXG4gICAgICAgICAgICAvLyBUYWJsZSBvdmVyZmxvd1xyXG4gICAgICAgICAgICB0YWJsZU92ZXJmbG93OiBmYWxzZSxcclxuICAgICAgICAgICAgdGFibGVIZWlnaHQ6ICczMDBweCcsXHJcbiAgICAgICAgICAgIHRhYmxlV2lkdGg6IG51bGwsXHJcbiAgICAgICAgICAgIHRleHRPdmVyZmxvdzogZmFsc2UsXHJcbiAgICAgICAgICAgIC8vIE1ldGFcclxuICAgICAgICAgICAgbWV0YTogbnVsbCxcclxuICAgICAgICAgICAgLy8gU3R5bGVcclxuICAgICAgICAgICAgc3R5bGU6IG51bGwsXHJcbiAgICAgICAgICAgIGNsYXNzZXM6IG51bGwsXHJcbiAgICAgICAgICAgIC8vIEV4ZWN1dGUgZm9ybXVsYXNcclxuICAgICAgICAgICAgcGFyc2VGb3JtdWxhczogdHJ1ZSxcclxuICAgICAgICAgICAgYXV0b0luY3JlbWVudDogdHJ1ZSxcclxuICAgICAgICAgICAgYXV0b0Nhc3Rpbmc6IHRydWUsXHJcbiAgICAgICAgICAgIC8vIFNlY3VyaXR5XHJcbiAgICAgICAgICAgIHNlY3VyZUZvcm11bGFzOiB0cnVlLFxyXG4gICAgICAgICAgICBzdHJpcEhUTUw6IHRydWUsXHJcbiAgICAgICAgICAgIHN0cmlwSFRNTE9uQ29weTogZmFsc2UsXHJcbiAgICAgICAgICAgIC8vIEZpbHRlcnNcclxuICAgICAgICAgICAgZmlsdGVyczogZmFsc2UsXHJcbiAgICAgICAgICAgIGZvb3RlcnM6IG51bGwsXHJcbiAgICAgICAgICAgIC8vIEV2ZW50IGhhbmRsZXNcclxuICAgICAgICAgICAgb251bmRvOiBudWxsLFxyXG4gICAgICAgICAgICBvbnJlZG86IG51bGwsXHJcbiAgICAgICAgICAgIG9ubG9hZDogbnVsbCxcclxuICAgICAgICAgICAgb25jaGFuZ2U6IG51bGwsXHJcbiAgICAgICAgICAgIG9uY29tbWVudHM6IG51bGwsXHJcbiAgICAgICAgICAgIG9uYmVmb3JlY2hhbmdlOiBudWxsLFxyXG4gICAgICAgICAgICBvbmFmdGVyY2hhbmdlczogbnVsbCxcclxuICAgICAgICAgICAgb25iZWZvcmVpbnNlcnRyb3c6IG51bGwsXHJcbiAgICAgICAgICAgIG9uaW5zZXJ0cm93OiBudWxsLFxyXG4gICAgICAgICAgICBvbmJlZm9yZWluc2VydGNvbHVtbjogbnVsbCxcclxuICAgICAgICAgICAgb25pbnNlcnRjb2x1bW46IG51bGwsXHJcbiAgICAgICAgICAgIG9uYmVmb3JlZGVsZXRlcm93OiBudWxsLFxyXG4gICAgICAgICAgICBvbmRlbGV0ZXJvdzogbnVsbCxcclxuICAgICAgICAgICAgb25iZWZvcmVkZWxldGVjb2x1bW46IG51bGwsXHJcbiAgICAgICAgICAgIG9uZGVsZXRlY29sdW1uOiBudWxsLFxyXG4gICAgICAgICAgICBvbm1vdmVyb3c6IG51bGwsXHJcbiAgICAgICAgICAgIG9ubW92ZWNvbHVtbjogbnVsbCxcclxuICAgICAgICAgICAgb25yZXNpemVyb3c6IG51bGwsXHJcbiAgICAgICAgICAgIG9ucmVzaXplY29sdW1uOiBudWxsLFxyXG4gICAgICAgICAgICBvbnNvcnQ6IG51bGwsXHJcbiAgICAgICAgICAgIG9uc2VsZWN0aW9uOiBudWxsLFxyXG4gICAgICAgICAgICBvbmJlZm9yZWNvcHk6IG51bGwsXHJcbiAgICAgICAgICAgIG9uY29weWluZzogbnVsbCxcclxuICAgICAgICAgICAgb25jb3B5OiBudWxsLFxyXG4gICAgICAgICAgICBvbnBhc3RlOiBudWxsLFxyXG4gICAgICAgICAgICBvbmJlZm9yZXBhc3RlOiBudWxsLFxyXG4gICAgICAgICAgICBvbm1lcmdlOiBudWxsLFxyXG4gICAgICAgICAgICBvbmZvY3VzOiBudWxsLFxyXG4gICAgICAgICAgICBvbmJsdXI6IG51bGwsXHJcbiAgICAgICAgICAgIG9uc2Nyb2xsOiBudWxsLFxyXG4gICAgICAgICAgICBvbmNoYW5nZWhlYWRlcjogbnVsbCxcclxuICAgICAgICAgICAgb25jcmVhdGVlZGl0b3I6IG51bGwsXHJcbiAgICAgICAgICAgIG9uZWRpdGlvbnN0YXJ0OiBudWxsLFxyXG4gICAgICAgICAgICBvbmVkaXRpb25lbmQ6IG51bGwsXHJcbiAgICAgICAgICAgIG9uY2hhbmdlc3R5bGU6IG51bGwsXHJcbiAgICAgICAgICAgIG9uY2hhbmdlbWV0YTogbnVsbCxcclxuICAgICAgICAgICAgb25jaGFuZ2VwYWdlOiBudWxsLFxyXG4gICAgICAgICAgICBvbmJlZm9yZXNhdmU6IG51bGwsXHJcbiAgICAgICAgICAgIG9uc2F2ZTogbnVsbCxcclxuICAgICAgICAgICAgb25zZXRoaXN0b3J5OiBudWxsLFxyXG4gICAgICAgICAgICAvLyBHbG9iYWwgZXZlbnQgZGlzcGF0Y2hlclxyXG4gICAgICAgICAgICBvbmV2ZW50OiBudWxsLFxyXG4gICAgICAgICAgICAvLyBQZXJzaXN0YW5jZVxyXG4gICAgICAgICAgICBwZXJzaXN0YW5jZTogZmFsc2UsXHJcbiAgICAgICAgICAgIC8vIEN1c3RvbWl6ZSBhbnkgY2VsbCBiZWhhdmlvclxyXG4gICAgICAgICAgICB1cGRhdGVUYWJsZTogbnVsbCxcclxuICAgICAgICAgICAgLy8gRGV0YWNoIHRoZSBIVE1MIHRhYmxlIHdoZW4gY2FsbGluZyB1cGRhdGVUYWJsZVxyXG4gICAgICAgICAgICBkZXRhY2hGb3JVcGRhdGVzOiBmYWxzZSxcclxuICAgICAgICAgICAgZnJlZXplQ29sdW1uczogbnVsbCxcclxuICAgICAgICAgICAgLy8gVGV4dHNcclxuICAgICAgICAgICAgdGV4dDoge1xyXG4gICAgICAgICAgICAgICAgbm9SZWNvcmRzRm91bmQ6ICdObyByZWNvcmRzIGZvdW5kJyxcclxuICAgICAgICAgICAgICAgIHNob3dpbmdQYWdlOiAnU2hvd2luZyBwYWdlIHswfSBvZiB7MX0gZW50cmllcycsXHJcbiAgICAgICAgICAgICAgICBzaG93OiAnU2hvdyAnLFxyXG4gICAgICAgICAgICAgICAgc2VhcmNoOiAnU2VhcmNoJyxcclxuICAgICAgICAgICAgICAgIGVudHJpZXM6ICcgZW50cmllcycsXHJcbiAgICAgICAgICAgICAgICBjb2x1bW5OYW1lOiAnQ29sdW1uIG5hbWUnLFxyXG4gICAgICAgICAgICAgICAgaW5zZXJ0QU5ld0NvbHVtbkJlZm9yZTogJ0luc2VydCBhIG5ldyBjb2x1bW4gYmVmb3JlJyxcclxuICAgICAgICAgICAgICAgIGluc2VydEFOZXdDb2x1bW5BZnRlcjogJ0luc2VydCBhIG5ldyBjb2x1bW4gYWZ0ZXInLFxyXG4gICAgICAgICAgICAgICAgZGVsZXRlU2VsZWN0ZWRDb2x1bW5zOiAnRGVsZXRlIHNlbGVjdGVkIGNvbHVtbnMnLFxyXG4gICAgICAgICAgICAgICAgcmVuYW1lVGhpc0NvbHVtbjogJ1JlbmFtZSB0aGlzIGNvbHVtbicsXHJcbiAgICAgICAgICAgICAgICBvcmRlckFzY2VuZGluZzogJ09yZGVyIGFzY2VuZGluZycsXHJcbiAgICAgICAgICAgICAgICBvcmRlckRlc2NlbmRpbmc6ICdPcmRlciBkZXNjZW5kaW5nJyxcclxuICAgICAgICAgICAgICAgIGluc2VydEFOZXdSb3dCZWZvcmU6ICdJbnNlcnQgYSBuZXcgcm93IGJlZm9yZScsXHJcbiAgICAgICAgICAgICAgICBpbnNlcnRBTmV3Um93QWZ0ZXI6ICdJbnNlcnQgYSBuZXcgcm93IGFmdGVyJyxcclxuICAgICAgICAgICAgICAgIGRlbGV0ZVNlbGVjdGVkUm93czogJ0RlbGV0ZSBzZWxlY3RlZCByb3dzJyxcclxuICAgICAgICAgICAgICAgIGVkaXRDb21tZW50czogJ0VkaXQgY29tbWVudHMnLFxyXG4gICAgICAgICAgICAgICAgYWRkQ29tbWVudHM6ICdBZGQgY29tbWVudHMnLFxyXG4gICAgICAgICAgICAgICAgY29tbWVudHM6ICdDb21tZW50cycsXHJcbiAgICAgICAgICAgICAgICBjbGVhckNvbW1lbnRzOiAnQ2xlYXIgY29tbWVudHMnLFxyXG4gICAgICAgICAgICAgICAgY29weTogJ0NvcHkuLi4nLFxyXG4gICAgICAgICAgICAgICAgcGFzdGU6ICdQYXN0ZS4uLicsXHJcbiAgICAgICAgICAgICAgICBzYXZlQXM6ICdTYXZlIGFzLi4uJyxcclxuICAgICAgICAgICAgICAgIGFib3V0OiAnQWJvdXQnLFxyXG4gICAgICAgICAgICAgICAgYXJlWW91U3VyZVRvRGVsZXRlVGhlU2VsZWN0ZWRSb3dzOiAnQXJlIHlvdSBzdXJlIHRvIGRlbGV0ZSB0aGUgc2VsZWN0ZWQgcm93cz8nLFxyXG4gICAgICAgICAgICAgICAgYXJlWW91U3VyZVRvRGVsZXRlVGhlU2VsZWN0ZWRDb2x1bW5zOiAnQXJlIHlvdSBzdXJlIHRvIGRlbGV0ZSB0aGUgc2VsZWN0ZWQgY29sdW1ucz8nLFxyXG4gICAgICAgICAgICAgICAgdGhpc0FjdGlvbldpbGxEZXN0cm95QW55RXhpc3RpbmdNZXJnZWRDZWxsc0FyZVlvdVN1cmU6ICdUaGlzIGFjdGlvbiB3aWxsIGRlc3Ryb3kgYW55IGV4aXN0aW5nIG1lcmdlZCBjZWxscy4gQXJlIHlvdSBzdXJlPycsXHJcbiAgICAgICAgICAgICAgICB0aGlzQWN0aW9uV2lsbENsZWFyWW91clNlYXJjaFJlc3VsdHNBcmVZb3VTdXJlOiAnVGhpcyBhY3Rpb24gd2lsbCBjbGVhciB5b3VyIHNlYXJjaCByZXN1bHRzLiBBcmUgeW91IHN1cmU/JyxcclxuICAgICAgICAgICAgICAgIHRoZXJlSXNBQ29uZmxpY3RXaXRoQW5vdGhlck1lcmdlZENlbGw6ICdUaGVyZSBpcyBhIGNvbmZsaWN0IHdpdGggYW5vdGhlciBtZXJnZWQgY2VsbCcsXHJcbiAgICAgICAgICAgICAgICBpbnZhbGlkTWVyZ2VQcm9wZXJ0aWVzOiAnSW52YWxpZCBtZXJnZWQgcHJvcGVydGllcycsXHJcbiAgICAgICAgICAgICAgICBjZWxsQWxyZWFkeU1lcmdlZDogJ0NlbGwgYWxyZWFkeSBtZXJnZWQnLFxyXG4gICAgICAgICAgICAgICAgbm9DZWxsc1NlbGVjdGVkOiAnTm8gY2VsbHMgc2VsZWN0ZWQnLFxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAvLyBBYm91dCBtZXNzYWdlXHJcbiAgICAgICAgICAgIGFib3V0OiBcImpFeGNlbCBDRSBTcHJlYWRzaGVldFxcblZlcnNpb24gNC41LjBcXG5XZWJzaXRlOiBodHRwczovL2Jvc3Nhbm92YS51ay9qZXhjZWwvdjNcIixcclxuXHJcbiAgICAgICAgICAgIG9uY3JlYXRjZWxsaGVhZGVyOiBudWxsLFxyXG4gICAgICAgICAgICBvbmNyZWF0ZXJvdzogbnVsbFxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIC8vIExvYWRpbmcgaW5pdGlhbCBjb25maWd1cmF0aW9uIGZyb20gdXNlclxyXG4gICAgICAgIGZvciAodmFyIHByb3BlcnR5IGluIGRlZmF1bHRzKSB7XHJcbiAgICAgICAgICAgIGlmIChvcHRpb25zICYmIG9wdGlvbnMuaGFzT3duUHJvcGVydHkocHJvcGVydHkpKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAocHJvcGVydHkgPT09ICd0ZXh0Jykge1xyXG4gICAgICAgICAgICAgICAgICAgIG9iai5vcHRpb25zW3Byb3BlcnR5XSA9IGRlZmF1bHRzW3Byb3BlcnR5XTtcclxuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciB0ZXh0S2V5IGluIG9wdGlvbnNbcHJvcGVydHldKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChvcHRpb25zW3Byb3BlcnR5XS5oYXNPd25Qcm9wZXJ0eSh0ZXh0S2V5KSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb2JqLm9wdGlvbnNbcHJvcGVydHldW3RleHRLZXldID0gb3B0aW9uc1twcm9wZXJ0eV1bdGV4dEtleV07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIG9iai5vcHRpb25zW3Byb3BlcnR5XSA9IG9wdGlvbnNbcHJvcGVydHldO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgb2JqLm9wdGlvbnNbcHJvcGVydHldID0gZGVmYXVsdHNbcHJvcGVydHldO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBHbG9iYWwgZWxlbWVudHNcclxuICAgICAgICBvYmouZWwgPSBlbDtcclxuICAgICAgICBvYmouY29ybmVyID0gbnVsbDtcclxuICAgICAgICBvYmouY29udGV4dE1lbnUgPSBudWxsO1xyXG4gICAgICAgIG9iai50ZXh0YXJlYSA9IG51bGw7XHJcbiAgICAgICAgb2JqLmFkcyA9IG51bGw7XHJcbiAgICAgICAgb2JqLmNvbnRlbnQgPSBudWxsO1xyXG4gICAgICAgIG9iai50YWJsZSA9IG51bGw7XHJcbiAgICAgICAgb2JqLnRoZWFkID0gbnVsbDtcclxuICAgICAgICBvYmoudGJvZHkgPSBudWxsO1xyXG4gICAgICAgIG9iai5yb3dzID0gW107XHJcbiAgICAgICAgb2JqLnJlc3VsdHMgPSBudWxsO1xyXG4gICAgICAgIG9iai5zZWFyY2hJbnB1dCA9IG51bGw7XHJcbiAgICAgICAgb2JqLnRvb2xiYXIgPSBudWxsO1xyXG4gICAgICAgIG9iai5wYWdpbmF0aW9uID0gbnVsbDtcclxuICAgICAgICBvYmoucGFnZU51bWJlciA9IG51bGw7XHJcbiAgICAgICAgb2JqLmhlYWRlckNvbnRhaW5lciA9IG51bGw7XHJcbiAgICAgICAgb2JqLmNvbGdyb3VwQ29udGFpbmVyID0gbnVsbDtcclxuXHJcbiAgICAgICAgLy8gQ29udGFpbmVyc1xyXG4gICAgICAgIG9iai5oZWFkZXJzID0gW107XHJcbiAgICAgICAgb2JqLnJlY29yZHMgPSBbXTtcclxuICAgICAgICBvYmouaGlzdG9yeSA9IFtdO1xyXG4gICAgICAgIG9iai5mb3JtdWxhID0gW107XHJcbiAgICAgICAgb2JqLmNvbGdyb3VwID0gW107XHJcbiAgICAgICAgb2JqLnNlbGVjdGlvbiA9IFtdO1xyXG4gICAgICAgIG9iai5oaWdobGlnaHRlZCA9IFtdO1xyXG4gICAgICAgIG9iai5zZWxlY3RlZENlbGwgPSBudWxsO1xyXG4gICAgICAgIG9iai5zZWxlY3RlZENvbnRhaW5lciA9IG51bGw7XHJcbiAgICAgICAgb2JqLnN0eWxlID0gW107XHJcbiAgICAgICAgb2JqLmRhdGEgPSBudWxsO1xyXG4gICAgICAgIG9iai5maWx0ZXIgPSBudWxsO1xyXG4gICAgICAgIG9iai5maWx0ZXJzID0gW107XHJcblxyXG4gICAgICAgIC8vIEludGVybmFsIGNvbnRyb2xsZXJzXHJcbiAgICAgICAgb2JqLmN1cnNvciA9IG51bGw7XHJcbiAgICAgICAgb2JqLmhpc3RvcnlJbmRleCA9IC0xO1xyXG4gICAgICAgIG9iai5pZ25vcmVFdmVudHMgPSBmYWxzZTtcclxuICAgICAgICBvYmouaWdub3JlSGlzdG9yeSA9IGZhbHNlO1xyXG4gICAgICAgIG9iai5lZGl0aW9uID0gbnVsbDtcclxuICAgICAgICBvYmouaGFzaFN0cmluZyA9IG51bGw7XHJcbiAgICAgICAgb2JqLnJlc2l6aW5nID0gbnVsbDtcclxuICAgICAgICBvYmouZHJhZ2dpbmcgPSBudWxsO1xyXG5cclxuICAgICAgICAvLyBMYXp5IGxvYWRpbmdcclxuICAgICAgICBpZiAob2JqLm9wdGlvbnMubGF6eUxvYWRpbmcgPT0gdHJ1ZSAmJiAob2JqLm9wdGlvbnMudGFibGVPdmVyZmxvdyA9PSBmYWxzZSAmJiBvYmoub3B0aW9ucy5mdWxsc2NyZWVuID09IGZhbHNlKSkge1xyXG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKCdKRVhDRUw6IFRoZSBsYXp5bG9hZGluZyBvbmx5IHdvcmtzIHdoZW4gdGFibGVPdmVyZmxvdyA9IHllcyBvciBmdWxsc2NyZWVuID0geWVzJyk7XHJcbiAgICAgICAgICAgIG9iai5vcHRpb25zLmxhenlMb2FkaW5nID0gZmFsc2U7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvKipcclxuICAgICAgICAgKiBBY3RpdmF0ZS9EaXNhYmxlIGZ1bGxzY3JlZW5cclxuICAgICAgICAgKiB1c2UgcHJvZ3JhbW1hdGljYWxseSA6IHRhYmxlLmZ1bGxzY3JlZW4oKTsgb3IgdGFibGUuZnVsbHNjcmVlbih0cnVlKTsgb3IgdGFibGUuZnVsbHNjcmVlbihmYWxzZSk7XHJcbiAgICAgICAgICogQFBhcmFtIHtib29sZWFufSBhY3RpdmF0ZVxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIG9iai5mdWxsc2NyZWVuID0gZnVuY3Rpb24gKGFjdGl2YXRlKSB7XHJcbiAgICAgICAgICAgIC8vIElmIGFjdGl2YXRlIG5vdCBkZWZpbmVkLCBnZXQgcmV2ZXJzZSBvcHRpb25zLmZ1bGxzY3JlZW5cclxuICAgICAgICAgICAgaWYgKGFjdGl2YXRlID09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgIGFjdGl2YXRlID0gIW9iai5vcHRpb25zLmZ1bGxzY3JlZW47XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIElmIGNoYW5nZVxyXG4gICAgICAgICAgICBpZiAob2JqLm9wdGlvbnMuZnVsbHNjcmVlbiAhPSBhY3RpdmF0ZSkge1xyXG4gICAgICAgICAgICAgICAgb2JqLm9wdGlvbnMuZnVsbHNjcmVlbiA9IGFjdGl2YXRlO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIFRlc3QgTGF6eUxvYWRpbmcgY29uZmxpY3RcclxuICAgICAgICAgICAgICAgIGlmIChhY3RpdmF0ZSA9PSB0cnVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZWwuY2xhc3NMaXN0LmFkZCgnZnVsbHNjcmVlbicpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBlbC5jbGFzc0xpc3QucmVtb3ZlKCdmdWxsc2NyZWVuJyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIFRyaWdnZXIgZXZlbnRzXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgb2JqLmRpc3BhdGNoID0gZnVuY3Rpb24gKGV2ZW50KSB7XHJcbiAgICAgICAgICAgIC8vIERpc3BhdGNoIGV2ZW50c1xyXG4gICAgICAgICAgICBpZiAoIW9iai5pZ25vcmVFdmVudHMpIHtcclxuICAgICAgICAgICAgICAgIC8vIENhbGwgZ2xvYmFsIGV2ZW50XHJcbiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIChvYmoub3B0aW9ucy5vbmV2ZW50KSA9PSAnZnVuY3Rpb24nKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHJldCA9IG9iai5vcHRpb25zLm9uZXZlbnQuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIC8vIENhbGwgc3BlY2lmaWMgZXZlbnRzXHJcbiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIChvYmoub3B0aW9uc1tldmVudF0pID09ICdmdW5jdGlvbicpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgcmV0ID0gb2JqLm9wdGlvbnNbZXZlbnRdLmFwcGx5KHRoaXMsIEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cywgMSkpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBQZXJzaXN0YW5jZVxyXG4gICAgICAgICAgICBpZiAoZXZlbnQgPT0gJ29uYWZ0ZXJjaGFuZ2VzJyAmJiBvYmoub3B0aW9ucy5wZXJzaXN0YW5jZSkge1xyXG4gICAgICAgICAgICAgICAgdmFyIHVybCA9IG9iai5vcHRpb25zLnBlcnNpc3RhbmNlID09IHRydWUgPyBvYmoub3B0aW9ucy51cmwgOiBvYmoub3B0aW9ucy5wZXJzaXN0YW5jZTtcclxuICAgICAgICAgICAgICAgIHZhciBkYXRhID0gb2JqLnByZXBhcmVKc29uKGFyZ3VtZW50c1syXSk7XHJcbiAgICAgICAgICAgICAgICBvYmouc2F2ZSh1cmwsIGRhdGEpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gcmV0O1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogUHJlcGFyZSB0aGUgamV4Y2VsIHRhYmxlXHJcbiAgICAgICAgICpcclxuICAgICAgICAgKiBAUGFyYW0gY29uZmlnXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgb2JqLnByZXBhcmVUYWJsZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgLy8gTG9hZGluZyBpbml0aWFsIGRhdGEgZnJvbSByZW1vdGUgc291cmNlc1xyXG4gICAgICAgICAgICB2YXIgcmVzdWx0cyA9IFtdO1xyXG5cclxuICAgICAgICAgICAgLy8gTnVtYmVyIG9mIGNvbHVtbnNcclxuICAgICAgICAgICAgdmFyIHNpemUgPSBvYmoub3B0aW9ucy5jb2x1bW5zLmxlbmd0aDtcclxuXHJcbiAgICAgICAgICAgIGlmIChvYmoub3B0aW9ucy5kYXRhICYmIHR5cGVvZiAob2JqLm9wdGlvbnMuZGF0YVswXSkgIT09ICd1bmRlZmluZWQnKSB7XHJcbiAgICAgICAgICAgICAgICAvLyBEYXRhIGtleXNcclxuICAgICAgICAgICAgICAgIHZhciBrZXlzID0gT2JqZWN0LmtleXMob2JqLm9wdGlvbnMuZGF0YVswXSk7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKGtleXMubGVuZ3RoID4gc2l6ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHNpemUgPSBrZXlzLmxlbmd0aDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gTWluaW1hbCBkaW1lbnNpb25zXHJcbiAgICAgICAgICAgIGlmIChvYmoub3B0aW9ucy5taW5EaW1lbnNpb25zWzBdID4gc2l6ZSkge1xyXG4gICAgICAgICAgICAgICAgc2l6ZSA9IG9iai5vcHRpb25zLm1pbkRpbWVuc2lvbnNbMF07XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIFJlcXVlc3RzXHJcbiAgICAgICAgICAgIHZhciBtdWx0aXBsZSA9IFtdO1xyXG5cclxuICAgICAgICAgICAgLy8gUHJlcGFyYXRpb25zXHJcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc2l6ZTsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAvLyBEZXByZWN0ZWQgb3B0aW9ucy4gWW91IHNob3VsZCB1c2Ugb25seSBjb2x1bW5zXHJcbiAgICAgICAgICAgICAgICBpZiAoIW9iai5vcHRpb25zLmNvbEhlYWRlcnNbaV0pIHtcclxuICAgICAgICAgICAgICAgICAgICBvYmoub3B0aW9ucy5jb2xIZWFkZXJzW2ldID0gJyc7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAoIW9iai5vcHRpb25zLmNvbFdpZHRoc1tpXSkge1xyXG4gICAgICAgICAgICAgICAgICAgIG9iai5vcHRpb25zLmNvbFdpZHRoc1tpXSA9IG9iai5vcHRpb25zLmRlZmF1bHRDb2xXaWR0aDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmICghb2JqLm9wdGlvbnMuY29sQWxpZ25tZW50c1tpXSkge1xyXG4gICAgICAgICAgICAgICAgICAgIG9iai5vcHRpb25zLmNvbEFsaWdubWVudHNbaV0gPSBvYmoub3B0aW9ucy5kZWZhdWx0Q29sQWxpZ247XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gRGVmYXVsdCBjb2x1bW4gZGVzY3JpcHRpb25cclxuICAgICAgICAgICAgICAgIGlmICghb2JqLm9wdGlvbnMuY29sdW1uc1tpXSkge1xyXG4gICAgICAgICAgICAgICAgICAgIG9iai5vcHRpb25zLmNvbHVtbnNbaV0gPSB7dHlwZTogJ3RleHQnfTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoIW9iai5vcHRpb25zLmNvbHVtbnNbaV0udHlwZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIG9iai5vcHRpb25zLmNvbHVtbnNbaV0udHlwZSA9ICd0ZXh0JztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmICghb2JqLm9wdGlvbnMuY29sdW1uc1tpXS5uYW1lKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgb2JqLm9wdGlvbnMuY29sdW1uc1tpXS5uYW1lID0ga2V5cyAmJiBrZXlzW2ldID8ga2V5c1tpXSA6IGk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAoIW9iai5vcHRpb25zLmNvbHVtbnNbaV0uc291cmNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgb2JqLm9wdGlvbnMuY29sdW1uc1tpXS5zb3VyY2UgPSBbXTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmICghb2JqLm9wdGlvbnMuY29sdW1uc1tpXS5vcHRpb25zKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgb2JqLm9wdGlvbnMuY29sdW1uc1tpXS5vcHRpb25zID0gW107XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAoIW9iai5vcHRpb25zLmNvbHVtbnNbaV0uZWRpdG9yKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgb2JqLm9wdGlvbnMuY29sdW1uc1tpXS5lZGl0b3IgPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKCFvYmoub3B0aW9ucy5jb2x1bW5zW2ldLmFsbG93RW1wdHkpIHtcclxuICAgICAgICAgICAgICAgICAgICBvYmoub3B0aW9ucy5jb2x1bW5zW2ldLmFsbG93RW1wdHkgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmICghb2JqLm9wdGlvbnMuY29sdW1uc1tpXS50aXRsZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIG9iai5vcHRpb25zLmNvbHVtbnNbaV0udGl0bGUgPSBvYmoub3B0aW9ucy5jb2xIZWFkZXJzW2ldID8gb2JqLm9wdGlvbnMuY29sSGVhZGVyc1tpXSA6ICcnO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKCFvYmoub3B0aW9ucy5jb2x1bW5zW2ldLndpZHRoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgb2JqLm9wdGlvbnMuY29sdW1uc1tpXS53aWR0aCA9IG9iai5vcHRpb25zLmNvbFdpZHRoc1tpXSA/IG9iai5vcHRpb25zLmNvbFdpZHRoc1tpXSA6IG9iai5vcHRpb25zLmRlZmF1bHRDb2xXaWR0aDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmICghb2JqLm9wdGlvbnMuY29sdW1uc1tpXS5hbGlnbikge1xyXG4gICAgICAgICAgICAgICAgICAgIG9iai5vcHRpb25zLmNvbHVtbnNbaV0uYWxpZ24gPSBvYmoub3B0aW9ucy5jb2xBbGlnbm1lbnRzW2ldID8gb2JqLm9wdGlvbnMuY29sQWxpZ25tZW50c1tpXSA6ICdjZW50ZXInO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIC8vIFByZS1sb2FkIGluaXRpYWwgc291cmNlIGZvciBqc29uIGF1dG9jb21wbGV0ZVxyXG4gICAgICAgICAgICAgICAgaWYgKG9iai5vcHRpb25zLmNvbHVtbnNbaV0udHlwZSA9PSAnYXV0b2NvbXBsZXRlJyB8fCBvYmoub3B0aW9ucy5jb2x1bW5zW2ldLnR5cGUgPT0gJ2Ryb3Bkb3duJykge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIGlmIHJlbW90ZSBjb250ZW50XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChvYmoub3B0aW9ucy5jb2x1bW5zW2ldLnVybCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBtdWx0aXBsZS5wdXNoKHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVybDogb2JqLm9wdGlvbnMuY29sdW1uc1tpXS51cmwsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbmRleDogaSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1ldGhvZDogJ0dFVCcsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhVHlwZTogJ2pzb24nLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgc291cmNlID0gW107XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBkYXRhLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9iai5vcHRpb25zLmNvbHVtbnNbdGhpcy5pbmRleF0uc291cmNlLnB1c2goZGF0YVtpXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKG9iai5vcHRpb25zLmNvbHVtbnNbaV0udHlwZSA9PSAnY2FsZW5kYXInKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gRGVmYXVsdCBmb3JtYXQgZm9yIGRhdGUgY29sdW1uc1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICghb2JqLm9wdGlvbnMuY29sdW1uc1tpXS5vcHRpb25zLmZvcm1hdCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBvYmoub3B0aW9ucy5jb2x1bW5zW2ldLm9wdGlvbnMuZm9ybWF0ID0gJ0REL01NL1lZWVknO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAvLyBDcmVhdGUgdGhlIHRhYmxlIHdoZW4gaXMgcmVhZHlcclxuICAgICAgICAgICAgaWYgKCFtdWx0aXBsZS5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgIG9iai5jcmVhdGVUYWJsZSgpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgalN1aXRlcy5hamF4KG11bHRpcGxlLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgb2JqLmNyZWF0ZVRhYmxlKCk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgb2JqLmNyZWF0ZVRhYmxlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAvLyBFbGVtZW50c1xyXG4gICAgICAgICAgICBvYmoudGFibGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0YWJsZScpO1xyXG4gICAgICAgICAgICBvYmoudGhlYWQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0aGVhZCcpO1xyXG4gICAgICAgICAgICBvYmoudGJvZHkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0Ym9keScpO1xyXG5cclxuICAgICAgICAgICAgLy8gQ3JlYXRlIGhlYWRlcnMgY29udHJvbGxlcnNcclxuICAgICAgICAgICAgb2JqLmhlYWRlcnMgPSBbXTtcclxuICAgICAgICAgICAgb2JqLmNvbGdyb3VwID0gW107XHJcblxyXG4gICAgICAgICAgICAvLyBDcmVhdGUgdGFibGUgY29udGFpbmVyXHJcbiAgICAgICAgICAgIG9iai5jb250ZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcbiAgICAgICAgICAgIG9iai5jb250ZW50LmNsYXNzTGlzdC5hZGQoJ2pleGNlbF9jb250ZW50Jyk7XHJcbiAgICAgICAgICAgIG9iai5jb250ZW50Lm9uc2Nyb2xsID0gZnVuY3Rpb24gKGUpIHtcclxuICAgICAgICAgICAgICAgIG9iai5zY3JvbGxDb250cm9scyhlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBvYmouY29udGVudC5vbndoZWVsID0gZnVuY3Rpb24gKGUpIHtcclxuICAgICAgICAgICAgICAgIG9iai53aGVlbENvbnRyb2xzKGUpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBDcmVhdGUgdG9vbGJhciBvYmplY3RcclxuICAgICAgICAgICAgb2JqLnRvb2xiYXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuICAgICAgICAgICAgb2JqLnRvb2xiYXIuY2xhc3NMaXN0LmFkZCgnamV4Y2VsX3Rvb2xiYXInKTtcclxuXHJcbiAgICAgICAgICAgIC8vIFNlYXJjaFxyXG4gICAgICAgICAgICB2YXIgc2VhcmNoQ29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcbiAgICAgICAgICAgIHZhciBzZWFyY2hUZXh0ID0gZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoKG9iai5vcHRpb25zLnRleHQuc2VhcmNoKSArICc6ICcpO1xyXG4gICAgICAgICAgICBvYmouc2VhcmNoSW5wdXQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbnB1dCcpO1xyXG4gICAgICAgICAgICBvYmouc2VhcmNoSW5wdXQuY2xhc3NMaXN0LmFkZCgnamV4Y2VsX3NlYXJjaCcpO1xyXG4gICAgICAgICAgICBzZWFyY2hDb250YWluZXIuYXBwZW5kQ2hpbGQoc2VhcmNoVGV4dCk7XHJcbiAgICAgICAgICAgIHNlYXJjaENvbnRhaW5lci5hcHBlbmRDaGlsZChvYmouc2VhcmNoSW5wdXQpO1xyXG4gICAgICAgICAgICBvYmouc2VhcmNoSW5wdXQub25mb2N1cyA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIG9iai5yZXNldFNlbGVjdGlvbigpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBQYWdpbmF0aW9uIHNlbGVjdCBvcHRpb25cclxuICAgICAgICAgICAgdmFyIHBhZ2luYXRpb25VcGRhdGVDb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuXHJcbiAgICAgICAgICAgIGlmIChvYmoub3B0aW9ucy5wYWdpbmF0aW9uID4gMCAmJiBvYmoub3B0aW9ucy5wYWdpbmF0aW9uT3B0aW9ucyAmJiBvYmoub3B0aW9ucy5wYWdpbmF0aW9uT3B0aW9ucy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgICAgICBvYmoucGFnaW5hdGlvbkRyb3Bkb3duID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc2VsZWN0Jyk7XHJcbiAgICAgICAgICAgICAgICBvYmoucGFnaW5hdGlvbkRyb3Bkb3duLmNsYXNzTGlzdC5hZGQoJ2pleGNlbF9wYWdpbmF0aW9uX2Ryb3Bkb3duJyk7XHJcbiAgICAgICAgICAgICAgICBvYmoucGFnaW5hdGlvbkRyb3Bkb3duLm9uY2hhbmdlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIG9iai5vcHRpb25zLnBhZ2luYXRpb24gPSBwYXJzZUludCh0aGlzLnZhbHVlKTtcclxuICAgICAgICAgICAgICAgICAgICBvYmoucGFnZSgwKTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG9iai5vcHRpb25zLnBhZ2luYXRpb25PcHRpb25zLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHRlbXAgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdvcHRpb24nKTtcclxuICAgICAgICAgICAgICAgICAgICB0ZW1wLnZhbHVlID0gb2JqLm9wdGlvbnMucGFnaW5hdGlvbk9wdGlvbnNbaV07XHJcbiAgICAgICAgICAgICAgICAgICAgdGVtcC5pbm5lckhUTUwgPSBvYmoub3B0aW9ucy5wYWdpbmF0aW9uT3B0aW9uc1tpXTtcclxuICAgICAgICAgICAgICAgICAgICBvYmoucGFnaW5hdGlvbkRyb3Bkb3duLmFwcGVuZENoaWxkKHRlbXApO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIC8vIFNldCBpbml0aWFsIHBhZ2luYXRpb24gdmFsdWVcclxuICAgICAgICAgICAgICAgIG9iai5wYWdpbmF0aW9uRHJvcGRvd24udmFsdWUgPSBvYmoub3B0aW9ucy5wYWdpbmF0aW9uO1xyXG5cclxuICAgICAgICAgICAgICAgIHBhZ2luYXRpb25VcGRhdGVDb250YWluZXIuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUob2JqLm9wdGlvbnMudGV4dC5zaG93KSk7XHJcbiAgICAgICAgICAgICAgICBwYWdpbmF0aW9uVXBkYXRlQ29udGFpbmVyLmFwcGVuZENoaWxkKG9iai5wYWdpbmF0aW9uRHJvcGRvd24pO1xyXG4gICAgICAgICAgICAgICAgcGFnaW5hdGlvblVwZGF0ZUNvbnRhaW5lci5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZShvYmoub3B0aW9ucy50ZXh0LmVudHJpZXMpKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gRmlsdGVyIGFuZCBwYWdpbmF0aW9uIGNvbnRhaW5lclxyXG4gICAgICAgICAgICB2YXIgZmlsdGVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcbiAgICAgICAgICAgIGZpbHRlci5jbGFzc0xpc3QuYWRkKCdqZXhjZWxfZmlsdGVyJyk7XHJcbiAgICAgICAgICAgIGZpbHRlci5hcHBlbmRDaGlsZChwYWdpbmF0aW9uVXBkYXRlQ29udGFpbmVyKTtcclxuICAgICAgICAgICAgZmlsdGVyLmFwcGVuZENoaWxkKHNlYXJjaENvbnRhaW5lcik7XHJcblxyXG4gICAgICAgICAgICAvLyBDb2xzZ3JvdXBcclxuICAgICAgICAgICAgb2JqLmNvbGdyb3VwQ29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnY29sZ3JvdXAnKTtcclxuICAgICAgICAgICAgdmFyIHRlbXBDb2wgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdjb2wnKTtcclxuICAgICAgICAgICAgdGVtcENvbC5zZXRBdHRyaWJ1dGUoJ3dpZHRoJywgJzUwJyk7XHJcbiAgICAgICAgICAgIG9iai5jb2xncm91cENvbnRhaW5lci5hcHBlbmRDaGlsZCh0ZW1wQ29sKTtcclxuXHJcbiAgICAgICAgICAgIC8vIE5lc3RlZFxyXG4gICAgICAgICAgICBpZiAob2JqLm9wdGlvbnMubmVzdGVkSGVhZGVycyAmJiBvYmoub3B0aW9ucy5uZXN0ZWRIZWFkZXJzLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgIC8vIEZsZXhpYmxlIHdheSB0byBoYW5kbGUgbmVzdGVkaGVhZGVyc1xyXG4gICAgICAgICAgICAgICAgaWYgKG9iai5vcHRpb25zLm5lc3RlZEhlYWRlcnNbMF0gJiYgb2JqLm9wdGlvbnMubmVzdGVkSGVhZGVyc1swXVswXSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgb2JqLm9wdGlvbnMubmVzdGVkSGVhZGVycy5sZW5ndGg7IGorKykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBvYmoudGhlYWQuYXBwZW5kQ2hpbGQob2JqLmNyZWF0ZU5lc3RlZEhlYWRlcihvYmoub3B0aW9ucy5uZXN0ZWRIZWFkZXJzW2pdKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBvYmoudGhlYWQuYXBwZW5kQ2hpbGQob2JqLmNyZWF0ZU5lc3RlZEhlYWRlcihvYmoub3B0aW9ucy5uZXN0ZWRIZWFkZXJzKSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIFJvd1xyXG4gICAgICAgICAgICBvYmouaGVhZGVyQ29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndHInKTtcclxuICAgICAgICAgICAgdmFyIHRlbXBDb2wgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0ZCcpO1xyXG4gICAgICAgICAgICB0ZW1wQ29sLmNsYXNzTGlzdC5hZGQoJ2pleGNlbF9zZWxlY3RhbGwnKTtcclxuICAgICAgICAgICAgb2JqLmhlYWRlckNvbnRhaW5lci5hcHBlbmRDaGlsZCh0ZW1wQ29sKTtcclxuXHJcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgb2JqLm9wdGlvbnMuY29sdW1ucy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgLy8gQ3JlYXRlIGhlYWRlclxyXG4gICAgICAgICAgICAgICAgb2JqLmNyZWF0ZUNlbGxIZWFkZXIoaSk7XHJcbiAgICAgICAgICAgICAgICAvLyBBcHBlbmQgY2VsbCB0byB0aGUgY29udGFpbmVyXHJcbiAgICAgICAgICAgICAgICBvYmouaGVhZGVyQ29udGFpbmVyLmFwcGVuZENoaWxkKG9iai5oZWFkZXJzW2ldKTtcclxuICAgICAgICAgICAgICAgIG9iai5jb2xncm91cENvbnRhaW5lci5hcHBlbmRDaGlsZChvYmouY29sZ3JvdXBbaV0pO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBvYmoudGhlYWQuYXBwZW5kQ2hpbGQob2JqLmhlYWRlckNvbnRhaW5lcik7XHJcblxyXG4gICAgICAgICAgICAvLyBGaWx0ZXJzXHJcbiAgICAgICAgICAgIGlmIChvYmoub3B0aW9ucy5maWx0ZXJzID09IHRydWUpIHtcclxuICAgICAgICAgICAgICAgIG9iai5maWx0ZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0cicpO1xyXG4gICAgICAgICAgICAgICAgdmFyIHRkID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGQnKTtcclxuICAgICAgICAgICAgICAgIG9iai5maWx0ZXIuYXBwZW5kQ2hpbGQodGQpO1xyXG5cclxuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgb2JqLm9wdGlvbnMuY29sdW1ucy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciB0ZCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RkJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGQuaW5uZXJIVE1MID0gJyZuYnNwOyc7XHJcbiAgICAgICAgICAgICAgICAgICAgdGQuc2V0QXR0cmlidXRlKCdkYXRhLXgnLCBpKTtcclxuICAgICAgICAgICAgICAgICAgICB0ZC5jbGFzc05hbWUgPSAnamV4Y2VsX2NvbHVtbl9maWx0ZXInO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChvYmoub3B0aW9ucy5jb2x1bW5zW2ldLnR5cGUgPT0gJ2hpZGRlbicpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGQuc3R5bGUuZGlzcGxheSA9ICdub25lJztcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgb2JqLmZpbHRlci5hcHBlbmRDaGlsZCh0ZCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgb2JqLnRoZWFkLmFwcGVuZENoaWxkKG9iai5maWx0ZXIpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBDb250ZW50IHRhYmxlXHJcbiAgICAgICAgICAgIG9iai50YWJsZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RhYmxlJyk7XHJcbiAgICAgICAgICAgIG9iai50YWJsZS5jbGFzc0xpc3QuYWRkKCdqZXhjZWwnKTtcclxuICAgICAgICAgICAgb2JqLnRhYmxlLnNldEF0dHJpYnV0ZSgnY2VsbHBhZGRpbmcnLCAnMCcpO1xyXG4gICAgICAgICAgICBvYmoudGFibGUuc2V0QXR0cmlidXRlKCdjZWxsc3BhY2luZycsICcwJyk7XHJcbiAgICAgICAgICAgIG9iai50YWJsZS5zZXRBdHRyaWJ1dGUoJ3Vuc2VsZWN0YWJsZScsICd5ZXMnKTtcclxuICAgICAgICAgICAgLy9vYmoudGFibGUuc2V0QXR0cmlidXRlKCdvbnNlbGVjdHN0YXJ0JywgJ3JldHVybiBmYWxzZScpO1xyXG4gICAgICAgICAgICBvYmoudGFibGUuYXBwZW5kQ2hpbGQob2JqLmNvbGdyb3VwQ29udGFpbmVyKTtcclxuICAgICAgICAgICAgb2JqLnRhYmxlLmFwcGVuZENoaWxkKG9iai50aGVhZCk7XHJcbiAgICAgICAgICAgIG9iai50YWJsZS5hcHBlbmRDaGlsZChvYmoudGJvZHkpO1xyXG5cclxuICAgICAgICAgICAgaWYgKCFvYmoub3B0aW9ucy50ZXh0T3ZlcmZsb3cpIHtcclxuICAgICAgICAgICAgICAgIG9iai50YWJsZS5jbGFzc0xpc3QuYWRkKCdqZXhjZWxfb3ZlcmZsb3cnKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gU3ByZWFkc2hlZXQgY29ybmVyXHJcbiAgICAgICAgICAgIG9iai5jb3JuZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuICAgICAgICAgICAgb2JqLmNvcm5lci5jbGFzc05hbWUgPSAnamV4Y2VsX2Nvcm5lcic7XHJcbiAgICAgICAgICAgIG9iai5jb3JuZXIuc2V0QXR0cmlidXRlKCd1bnNlbGVjdGFibGUnLCAnb24nKTtcclxuICAgICAgICAgICAgb2JqLmNvcm5lci5zZXRBdHRyaWJ1dGUoJ29uc2VsZWN0c3RhcnQnLCAncmV0dXJuIGZhbHNlJyk7XHJcblxyXG4gICAgICAgICAgICBpZiAob2JqLm9wdGlvbnMuc2VsZWN0aW9uQ29weSA9PSBmYWxzZSkge1xyXG4gICAgICAgICAgICAgICAgb2JqLmNvcm5lci5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBUZXh0YXJlYSBoZWxwZXJcclxuICAgICAgICAgICAgb2JqLnRleHRhcmVhID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGV4dGFyZWEnKTtcclxuICAgICAgICAgICAgb2JqLnRleHRhcmVhLmNsYXNzTmFtZSA9ICdqZXhjZWxfdGV4dGFyZWEnO1xyXG4gICAgICAgICAgICBvYmoudGV4dGFyZWEuaWQgPSAnamV4Y2VsX3RleHRhcmVhJztcclxuICAgICAgICAgICAgb2JqLnRleHRhcmVhLnRhYkluZGV4ID0gJy0xJztcclxuXHJcbiAgICAgICAgICAgIC8vIENvbnRleHRtZW51IGNvbnRhaW5lclxyXG4gICAgICAgICAgICBvYmouY29udGV4dE1lbnUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuICAgICAgICAgICAgb2JqLmNvbnRleHRNZW51LmNsYXNzTmFtZSA9ICdqZXhjZWxfY29udGV4dG1lbnUnO1xyXG5cclxuICAgICAgICAgICAgLy8gQ3JlYXRlIGVsZW1lbnRcclxuICAgICAgICAgICAgalN1aXRlcy5jb250ZXh0bWVudShvYmouY29udGV4dE1lbnUsIHtcclxuICAgICAgICAgICAgICAgIG9uY2xpY2s6IGZ1bmN0aW9uIChvYmosIGUpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIG9wdGlvbnMub25DbGlja0NvbnRleHRNZW51ID09PSAnZnVuY3Rpb24nKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMub25DbGlja0NvbnRleHRNZW51KG9iaiwgZSlcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBvYmouY2xvc2UoZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAvLyBQb3dlcmVkIGJ5IGpFeGNlbFxyXG4gICAgICAgICAgICB2YXIgYWRzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYScpO1xyXG4gICAgICAgICAgICBhZHMuc2V0QXR0cmlidXRlKCdocmVmJywgJ2h0dHBzOi8vYm9zc2Fub3ZhLnVrL2pleGNlbC8nKTtcclxuICAgICAgICAgICAgb2JqLmFkcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG4gICAgICAgICAgICBvYmouYWRzLmNsYXNzTmFtZSA9ICdqZXhjZWxfYWJvdXQnO1xyXG4gICAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAgICAgaWYgKHR5cGVvZiAoc2Vzc2lvblN0b3JhZ2UpICE9PSBcInVuZGVmaW5lZFwiICYmICFzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKCdqZXhjZWwnKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHNlc3Npb25TdG9yYWdlLnNldEl0ZW0oJ2pleGNlbCcsIHRydWUpO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBpbWcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbWcnKTtcclxuICAgICAgICAgICAgICAgICAgICBpbWcuc3JjID0gJy8vYm9zc2Fub3ZhLnVrL2pleGNlbC9sb2dvLnBuZyc7XHJcbiAgICAgICAgICAgICAgICAgICAgYWRzLmFwcGVuZENoaWxkKGltZyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0gY2F0Y2ggKGV4Y2VwdGlvbikge1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHZhciBzcGFuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3BhbicpO1xyXG4gICAgICAgICAgICBzcGFuLmlubmVySFRNTCA9ICdKZXhjZWwgc3ByZWFkc2hlZXQnO1xyXG4gICAgICAgICAgICBhZHMuYXBwZW5kQ2hpbGQoc3Bhbik7XHJcbiAgICAgICAgICAgIG9iai5hZHMuYXBwZW5kQ2hpbGQoYWRzKTtcclxuXHJcbiAgICAgICAgICAgIC8vIENyZWF0ZSB0YWJsZSBjb250YWluZXIgVE9ETzogZnJvemVuIGNvbHVtbnNcclxuICAgICAgICAgICAgdmFyIGNvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG4gICAgICAgICAgICBjb250YWluZXIuY2xhc3NMaXN0LmFkZCgnamV4Y2VsX3RhYmxlJyk7XHJcblxyXG4gICAgICAgICAgICAvLyBQYWdpbmF0aW9uXHJcbiAgICAgICAgICAgIG9iai5wYWdpbmF0aW9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcbiAgICAgICAgICAgIG9iai5wYWdpbmF0aW9uLmNsYXNzTGlzdC5hZGQoJ2pleGNlbF9wYWdpbmF0aW9uJyk7XHJcbiAgICAgICAgICAgIHZhciBwYWdpbmF0aW9uSW5mbyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG4gICAgICAgICAgICB2YXIgcGFnaW5hdGlvblBhZ2VzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcbiAgICAgICAgICAgIG9iai5wYWdpbmF0aW9uLmFwcGVuZENoaWxkKHBhZ2luYXRpb25JbmZvKTtcclxuICAgICAgICAgICAgb2JqLnBhZ2luYXRpb24uYXBwZW5kQ2hpbGQocGFnaW5hdGlvblBhZ2VzKTtcclxuXHJcbiAgICAgICAgICAgIC8vIEhpZGUgcGFnaW5hdGlvbiBpZiBub3QgaW4gdXNlXHJcbiAgICAgICAgICAgIGlmICghb2JqLm9wdGlvbnMucGFnaW5hdGlvbikge1xyXG4gICAgICAgICAgICAgICAgb2JqLnBhZ2luYXRpb24uc3R5bGUuZGlzcGxheSA9ICdub25lJztcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gQXBwZW5kIGNvbnRhaW5lcnMgdG8gdGhlIHRhYmxlXHJcbiAgICAgICAgICAgIGlmIChvYmoub3B0aW9ucy5zZWFyY2ggPT0gdHJ1ZSkge1xyXG4gICAgICAgICAgICAgICAgZWwuYXBwZW5kQ2hpbGQoZmlsdGVyKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gRWxlbWVudHNcclxuICAgICAgICAgICAgb2JqLmNvbnRlbnQuYXBwZW5kQ2hpbGQob2JqLnRhYmxlKTtcclxuICAgICAgICAgICAgb2JqLmNvbnRlbnQuYXBwZW5kQ2hpbGQob2JqLmNvcm5lcik7XHJcbiAgICAgICAgICAgIG9iai5jb250ZW50LmFwcGVuZENoaWxkKG9iai50ZXh0YXJlYSk7XHJcblxyXG4gICAgICAgICAgICBlbC5hcHBlbmRDaGlsZChvYmoudG9vbGJhcik7XHJcbiAgICAgICAgICAgIGVsLmFwcGVuZENoaWxkKG9iai5jb250ZW50KTtcclxuICAgICAgICAgICAgZWwuYXBwZW5kQ2hpbGQob2JqLnBhZ2luYXRpb24pO1xyXG4gICAgICAgICAgICBlbC5hcHBlbmRDaGlsZChvYmouY29udGV4dE1lbnUpO1xyXG4gICAgICAgICAgICBlbC5hcHBlbmRDaGlsZChvYmouYWRzKTtcclxuICAgICAgICAgICAgZWwuY2xhc3NMaXN0LmFkZCgnamV4Y2VsX2NvbnRhaW5lcicpO1xyXG5cclxuICAgICAgICAgICAgLy8gQ3JlYXRlIHRvb2xiYXJcclxuICAgICAgICAgICAgaWYgKG9iai5vcHRpb25zLnRvb2xiYXIgJiYgb2JqLm9wdGlvbnMudG9vbGJhci5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgIG9iai5jcmVhdGVUb29sYmFyKCk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIEZ1bGxzY3JlZW5cclxuICAgICAgICAgICAgaWYgKG9iai5vcHRpb25zLmZ1bGxzY3JlZW4gPT0gdHJ1ZSkge1xyXG4gICAgICAgICAgICAgICAgZWwuY2xhc3NMaXN0LmFkZCgnZnVsbHNjcmVlbicpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgLy8gT3ZlcmZsb3dcclxuICAgICAgICAgICAgICAgIGlmIChvYmoub3B0aW9ucy50YWJsZU92ZXJmbG93ID09IHRydWUpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAob2JqLm9wdGlvbnMudGFibGVIZWlnaHQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgb2JqLmNvbnRlbnQuc3R5bGVbJ292ZXJmbG93LXknXSA9ICdhdXRvJztcclxuICAgICAgICAgICAgICAgICAgICAgICAgb2JqLmNvbnRlbnQuc3R5bGUubWF4SGVpZ2h0ID0gb2JqLm9wdGlvbnMudGFibGVIZWlnaHQ7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChvYmoub3B0aW9ucy50YWJsZVdpZHRoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9iai5jb250ZW50LnN0eWxlWydvdmVyZmxvdy14J10gPSAnYXV0byc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9iai5jb250ZW50LnN0eWxlLndpZHRoID0gb2JqLm9wdGlvbnMudGFibGVXaWR0aDtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIFdpdGggdG9vbGJhcnNcclxuICAgICAgICAgICAgaWYgKG9iai5vcHRpb25zLnRhYmxlT3ZlcmZsb3cgIT0gdHJ1ZSAmJiBvYmoub3B0aW9ucy50b29sYmFyKSB7XHJcbiAgICAgICAgICAgICAgICBlbC5jbGFzc0xpc3QuYWRkKCd3aXRoLXRvb2xiYXInKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gQWN0aW9uc1xyXG4gICAgICAgICAgICBpZiAob2JqLm9wdGlvbnMuY29sdW1uRHJhZyA9PSB0cnVlKSB7XHJcbiAgICAgICAgICAgICAgICBvYmoudGhlYWQuY2xhc3NMaXN0LmFkZCgnZHJhZ2dhYmxlJyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKG9iai5vcHRpb25zLmNvbHVtblJlc2l6ZSA9PSB0cnVlKSB7XHJcbiAgICAgICAgICAgICAgICBvYmoudGhlYWQuY2xhc3NMaXN0LmFkZCgncmVzaXphYmxlJyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKG9iai5vcHRpb25zLnJvd0RyYWcgPT0gdHJ1ZSkge1xyXG4gICAgICAgICAgICAgICAgb2JqLnRib2R5LmNsYXNzTGlzdC5hZGQoJ2RyYWdnYWJsZScpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChvYmoub3B0aW9ucy5yb3dSZXNpemUgPT0gdHJ1ZSkge1xyXG4gICAgICAgICAgICAgICAgb2JqLnRib2R5LmNsYXNzTGlzdC5hZGQoJ3Jlc2l6YWJsZScpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBMb2FkIGRhdGFcclxuICAgICAgICAgICAgb2JqLnNldERhdGEoKTtcclxuXHJcbiAgICAgICAgICAgIC8vIFN0eWxlXHJcbiAgICAgICAgICAgIGlmIChvYmoub3B0aW9ucy5zdHlsZSkge1xyXG4gICAgICAgICAgICAgICAgb2JqLnNldFN0eWxlKG9iai5vcHRpb25zLnN0eWxlLCBudWxsLCBudWxsLCAxLCAxKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gQ2xhc3Nlc1xyXG4gICAgICAgICAgICBpZiAob2JqLm9wdGlvbnMuY2xhc3Nlcykge1xyXG4gICAgICAgICAgICAgICAgdmFyIGsgPSBPYmplY3Qua2V5cyhvYmoub3B0aW9ucy5jbGFzc2VzKTtcclxuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgay5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBjZWxsID0gamV4Y2VsLmdldElkRnJvbUNvbHVtbk5hbWUoa1tpXSwgdHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgb2JqLnJlY29yZHNbY2VsbFsxXV1bY2VsbFswXV0uY2xhc3NMaXN0LmFkZChvYmoub3B0aW9ucy5jbGFzc2VzW2tbaV1dKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogUmVmcmVzaCB0aGUgZGF0YVxyXG4gICAgICAgICAqXHJcbiAgICAgICAgICogQHJldHVybiB2b2lkXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgb2JqLnJlZnJlc2ggPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIGlmIChvYmoub3B0aW9ucy51cmwpIHtcclxuICAgICAgICAgICAgICAgIC8vIExvYWRpbmdcclxuICAgICAgICAgICAgICAgIGlmIChvYmoub3B0aW9ucy5sb2FkaW5nU3BpbiA9PSB0cnVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgalN1aXRlcy5sb2FkaW5nLnNob3coKTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBqU3VpdGVzLmFqYXgoe1xyXG4gICAgICAgICAgICAgICAgICAgIHVybDogb2JqLm9wdGlvbnMudXJsLFxyXG4gICAgICAgICAgICAgICAgICAgIG1ldGhvZDogb2JqLm9wdGlvbnMubWV0aG9kLFxyXG4gICAgICAgICAgICAgICAgICAgIGRhdGE6IG9iai5vcHRpb25zLnJlcXVlc3RWYXJpYWJsZXMsXHJcbiAgICAgICAgICAgICAgICAgICAgZGF0YVR5cGU6ICdqc29uJyxcclxuICAgICAgICAgICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiAocmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIERhdGFcclxuICAgICAgICAgICAgICAgICAgICAgICAgb2JqLm9wdGlvbnMuZGF0YSA9IChyZXN1bHQuZGF0YSkgPyByZXN1bHQuZGF0YSA6IHJlc3VsdDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gUHJlcGFyZSB0YWJsZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBvYmouc2V0RGF0YSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBIaWRlIHNwaW5cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG9iai5vcHRpb25zLmxvYWRpbmdTcGluID09IHRydWUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGpTdWl0ZXMubG9hZGluZy5oaWRlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIG9iai5zZXREYXRhKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIFNldCBkYXRhXHJcbiAgICAgICAgICpcclxuICAgICAgICAgKiBAcGFyYW0gYXJyYXkgZGF0YSBJbiBjYXNlIG5vIGRhdGEgaXMgc2VudCwgZGVmYXVsdCBpcyByZWxvYWRlZFxyXG4gICAgICAgICAqIEByZXR1cm4gdm9pZFxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIG9iai5zZXREYXRhID0gZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgLy8gVXBkYXRlIGRhdGFcclxuICAgICAgICAgICAgaWYgKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgKGRhdGEpID09ICdzdHJpbmcnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZGF0YSA9IEpTT04ucGFyc2UoZGF0YSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgb2JqLm9wdGlvbnMuZGF0YSA9IGRhdGE7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIERhdGFcclxuICAgICAgICAgICAgaWYgKCFvYmoub3B0aW9ucy5kYXRhKSB7XHJcbiAgICAgICAgICAgICAgICBvYmoub3B0aW9ucy5kYXRhID0gW107XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIFByZXBhcmUgZGF0YVxyXG4gICAgICAgICAgICBpZiAob2JqLm9wdGlvbnMuZGF0YSAmJiBvYmoub3B0aW9ucy5kYXRhWzBdKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoIUFycmF5LmlzQXJyYXkob2JqLm9wdGlvbnMuZGF0YVswXSkpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgZGF0YSA9IFtdO1xyXG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgb2JqLm9wdGlvbnMuZGF0YS5sZW5ndGg7IGorKykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgcm93ID0gW107XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgb2JqLm9wdGlvbnMuY29sdW1ucy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcm93W2ldID0gb2JqLm9wdGlvbnMuZGF0YVtqXVtvYmoub3B0aW9ucy5jb2x1bW5zW2ldLm5hbWVdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEucHVzaChyb3cpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgb2JqLm9wdGlvbnMuZGF0YSA9IGRhdGE7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIEFkanVzdCBtaW5pbWFsIGRpbWVuc2lvbnNcclxuICAgICAgICAgICAgdmFyIGogPSAwO1xyXG4gICAgICAgICAgICB2YXIgaSA9IDA7XHJcbiAgICAgICAgICAgIHZhciBzaXplX2kgPSBvYmoub3B0aW9ucy5jb2x1bW5zLmxlbmd0aDtcclxuICAgICAgICAgICAgdmFyIHNpemVfaiA9IG9iai5vcHRpb25zLmRhdGEubGVuZ3RoO1xyXG4gICAgICAgICAgICB2YXIgbWluX2kgPSBvYmoub3B0aW9ucy5taW5EaW1lbnNpb25zWzBdO1xyXG4gICAgICAgICAgICB2YXIgbWluX2ogPSBvYmoub3B0aW9ucy5taW5EaW1lbnNpb25zWzFdO1xyXG4gICAgICAgICAgICB2YXIgbWF4X2kgPSBtaW5faSA+IHNpemVfaSA/IG1pbl9pIDogc2l6ZV9pO1xyXG4gICAgICAgICAgICB2YXIgbWF4X2ogPSBtaW5faiA+IHNpemVfaiA/IG1pbl9qIDogc2l6ZV9qO1xyXG5cclxuICAgICAgICAgICAgZm9yIChqID0gMDsgaiA8IG1heF9qOyBqKyspIHtcclxuICAgICAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBtYXhfaTsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKG9iai5vcHRpb25zLmRhdGFbal0gPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9iai5vcHRpb25zLmRhdGFbal0gPSBbXTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChvYmoub3B0aW9ucy5kYXRhW2pdW2ldID09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBvYmoub3B0aW9ucy5kYXRhW2pdW2ldID0gJyc7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBSZXNldCBjb250YWluZXJzXHJcbiAgICAgICAgICAgIG9iai5yb3dzID0gW107XHJcbiAgICAgICAgICAgIG9iai5yZXN1bHRzID0gbnVsbDtcclxuICAgICAgICAgICAgb2JqLnJlY29yZHMgPSBbXTtcclxuICAgICAgICAgICAgb2JqLmhpc3RvcnkgPSBbXTtcclxuXHJcbiAgICAgICAgICAgIC8vIFJlc2V0IGludGVybmFsIGNvbnRyb2xsZXJzXHJcbiAgICAgICAgICAgIG9iai5oaXN0b3J5SW5kZXggPSAtMTtcclxuXHJcbiAgICAgICAgICAgIC8vIFJlc2V0IGRhdGFcclxuICAgICAgICAgICAgb2JqLnRib2R5LmlubmVySFRNTCA9ICcnO1xyXG5cclxuICAgICAgICAgICAgLy8gTGF6eSBsb2FkaW5nXHJcbiAgICAgICAgICAgIGlmIChvYmoub3B0aW9ucy5sYXp5TG9hZGluZyA9PSB0cnVlKSB7XHJcbiAgICAgICAgICAgICAgICAvLyBMb2FkIG9ubHkgMTAwIHJlY29yZHNcclxuICAgICAgICAgICAgICAgIHZhciBzdGFydE51bWJlciA9IDBcclxuICAgICAgICAgICAgICAgIHZhciBmaW5hbE51bWJlciA9IG9iai5vcHRpb25zLmRhdGEubGVuZ3RoIDwgMTAwID8gb2JqLm9wdGlvbnMuZGF0YS5sZW5ndGggOiAxMDA7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKG9iai5vcHRpb25zLnBhZ2luYXRpb24pIHtcclxuICAgICAgICAgICAgICAgICAgICBvYmoub3B0aW9ucy5wYWdpbmF0aW9uID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignSkVYQ0VMOiBQYWdpbmF0aW9uIHdpbGwgYmUgZGlzYWJsZSBkdWUgdGhlIGxhenlMb2FkaW5nJyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAob2JqLm9wdGlvbnMucGFnaW5hdGlvbikge1xyXG4gICAgICAgICAgICAgICAgLy8gUGFnaW5hdGlvblxyXG4gICAgICAgICAgICAgICAgaWYgKCFvYmoucGFnZU51bWJlcikge1xyXG4gICAgICAgICAgICAgICAgICAgIG9iai5wYWdlTnVtYmVyID0gMDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHZhciBxdWFudGl0eVBlclBhZ2UgPSBvYmoub3B0aW9ucy5wYWdpbmF0aW9uO1xyXG4gICAgICAgICAgICAgICAgc3RhcnROdW1iZXIgPSAob2JqLm9wdGlvbnMucGFnaW5hdGlvbiAqIG9iai5wYWdlTnVtYmVyKTtcclxuICAgICAgICAgICAgICAgIGZpbmFsTnVtYmVyID0gKG9iai5vcHRpb25zLnBhZ2luYXRpb24gKiBvYmoucGFnZU51bWJlcikgKyBvYmoub3B0aW9ucy5wYWdpbmF0aW9uO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmIChvYmoub3B0aW9ucy5kYXRhLmxlbmd0aCA8IGZpbmFsTnVtYmVyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZmluYWxOdW1iZXIgPSBvYmoub3B0aW9ucy5kYXRhLmxlbmd0aDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHZhciBzdGFydE51bWJlciA9IDA7XHJcbiAgICAgICAgICAgICAgICB2YXIgZmluYWxOdW1iZXIgPSBvYmoub3B0aW9ucy5kYXRhLmxlbmd0aDtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gQXBwZW5kIG5vZGVzIHRvIHRoZSBIVE1MXHJcbiAgICAgICAgICAgIGZvciAoaiA9IDA7IGogPCBvYmoub3B0aW9ucy5kYXRhLmxlbmd0aDsgaisrKSB7XHJcbiAgICAgICAgICAgICAgICAvLyBDcmVhdGUgcm93XHJcbiAgICAgICAgICAgICAgICB2YXIgdHIgPSBvYmouY3JlYXRlUm93KGosIG9iai5vcHRpb25zLmRhdGFbal0pO1xyXG4gICAgICAgICAgICAgICAgLy8gQXBwZW5kIGxpbmUgdG8gdGhlIHRhYmxlXHJcbiAgICAgICAgICAgICAgICBpZiAoaiA+PSBzdGFydE51bWJlciAmJiBqIDwgZmluYWxOdW1iZXIpIHtcclxuICAgICAgICAgICAgICAgICAgICBvYmoudGJvZHkuYXBwZW5kQ2hpbGQodHIpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAob2JqLm9wdGlvbnMubGF6eUxvYWRpbmcgPT0gdHJ1ZSkge1xyXG4gICAgICAgICAgICAgICAgLy8gRG8gbm90IGNyZWF0ZSBwYWdpbmF0aW9uIHdpdGggbGF6eWxvYWRpbmcgYWN0aXZhdGVkXHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAob2JqLm9wdGlvbnMucGFnaW5hdGlvbikge1xyXG4gICAgICAgICAgICAgICAgb2JqLnVwZGF0ZVBhZ2luYXRpb24oKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gTWVyZ2UgY2VsbHNcclxuICAgICAgICAgICAgaWYgKG9iai5vcHRpb25zLm1lcmdlQ2VsbHMpIHtcclxuICAgICAgICAgICAgICAgIHZhciBrZXlzID0gT2JqZWN0LmtleXMob2JqLm9wdGlvbnMubWVyZ2VDZWxscyk7XHJcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGtleXMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgbnVtID0gb2JqLm9wdGlvbnMubWVyZ2VDZWxsc1trZXlzW2ldXTtcclxuICAgICAgICAgICAgICAgICAgICBvYmouc2V0TWVyZ2Uoa2V5c1tpXSwgbnVtWzBdLCBudW1bMV0sIDEpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBVcGRhdGEgdGFibGUgd2l0aCBjdXN0b20gY29uZmlndXJhdGlvbnMgaWYgYXBwbGljYWJsZVxyXG4gICAgICAgICAgICBvYmoudXBkYXRlVGFibGUoKTtcclxuXHJcbiAgICAgICAgICAgIC8vIE9ubG9hZFxyXG4gICAgICAgICAgICBvYmouZGlzcGF0Y2goJ29ubG9hZCcsIGVsLCBvYmopO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogR2V0IHRoZSB3aG9sZSB0YWJsZSBkYXRhXHJcbiAgICAgICAgICpcclxuICAgICAgICAgKiBAcGFyYW0gYm9vbCBnZXQgaGlnaGxpZ2h0ZWQgY2VsbHMgb25seVxyXG4gICAgICAgICAqIEByZXR1cm4gYXJyYXkgZGF0YVxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIG9iai5nZXREYXRhID0gZnVuY3Rpb24gKGhpZ2hsaWdodGVkLCBkYXRhT25seSkge1xyXG4gICAgICAgICAgICAvLyBDb250cm9sIHZhcnNcclxuICAgICAgICAgICAgdmFyIGRhdGFzZXQgPSBbXTtcclxuICAgICAgICAgICAgdmFyIHB4ID0gMDtcclxuICAgICAgICAgICAgdmFyIHB5ID0gMDtcclxuXHJcbiAgICAgICAgICAgIC8vIERhdGEgdHlwZVxyXG4gICAgICAgICAgICB2YXIgZGF0YVR5cGUgPSBkYXRhT25seSA9PSB0cnVlIHx8IG9iai5vcHRpb25zLmNvcHlDb21wYXRpYmlsaXR5ID09IGZhbHNlID8gdHJ1ZSA6IGZhbHNlO1xyXG5cclxuICAgICAgICAgICAgLy8gQ29sdW1uIGFuZCByb3cgbGVuZ3RoXHJcbiAgICAgICAgICAgIHZhciB4ID0gb2JqLm9wdGlvbnMuY29sdW1ucy5sZW5ndGhcclxuICAgICAgICAgICAgdmFyIHkgPSBvYmoub3B0aW9ucy5kYXRhLmxlbmd0aFxyXG5cclxuICAgICAgICAgICAgLy8gR28gdGhyb3VnaCB0aGUgY29sdW1ucyB0byBnZXQgdGhlIGRhdGFcclxuICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCB5OyBqKyspIHtcclxuICAgICAgICAgICAgICAgIHB4ID0gMDtcclxuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgeDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gQ2VsbCBzZWxlY3RlZCBvciBmdWxsc2V0XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFoaWdobGlnaHRlZCB8fCBvYmoucmVjb3Jkc1tqXVtpXS5jbGFzc0xpc3QuY29udGFpbnMoJ2hpZ2hsaWdodCcpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEdldCB2YWx1ZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWRhdGFzZXRbcHldKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhc2V0W3B5XSA9IFtdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghZGF0YVR5cGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFzZXRbcHldW3B4XSA9IG9iai5yZWNvcmRzW2pdW2ldLmlubmVySFRNTDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFzZXRbcHldW3B4XSA9IG9iai5vcHRpb25zLmRhdGFbal1baV07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgcHgrKztcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAocHggPiAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcHkrKztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgcmV0dXJuIGRhdGFzZXQ7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvKipcclxuICAgICAgICAgKiBHZXQganNvbiBkYXRhIGJ5IHJvdyBudW1iZXJcclxuICAgICAgICAgKlxyXG4gICAgICAgICAqIEBwYXJhbSBpbnRlZ2VyIHJvdyBudW1iZXJcclxuICAgICAgICAgKiBAcmV0dXJuIG9iamVjdFxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIG9iai5nZXRKc29uUm93ID0gZnVuY3Rpb24gKHJvd051bWJlcikge1xyXG4gICAgICAgICAgICB2YXIgcm93RGF0YSA9IG9iai5vcHRpb25zLmRhdGFbcm93TnVtYmVyXTtcclxuICAgICAgICAgICAgdmFyIHggPSBvYmoub3B0aW9ucy5jb2x1bW5zLmxlbmd0aFxyXG5cclxuICAgICAgICAgICAgdmFyIHJvdyA9IHt9O1xyXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgaWYgKCFvYmoub3B0aW9ucy5jb2x1bW5zW2ldLm5hbWUpIHtcclxuICAgICAgICAgICAgICAgICAgICBvYmoub3B0aW9ucy5jb2x1bW5zW2ldLm5hbWUgPSBpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgcm93W29iai5vcHRpb25zLmNvbHVtbnNbaV0ubmFtZV0gPSByb3dEYXRhW2ldO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gcm93O1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogR2V0IHRoZSB3aG9sZSB0YWJsZSBkYXRhXHJcbiAgICAgICAgICpcclxuICAgICAgICAgKiBAcGFyYW0gYm9vbCBoaWdobGlnaHRlZCBjZWxscyBvbmx5XHJcbiAgICAgICAgICogQHJldHVybiBzdHJpbmcgdmFsdWVcclxuICAgICAgICAgKi9cclxuICAgICAgICBvYmouZ2V0SnNvbiA9IGZ1bmN0aW9uIChoaWdobGlnaHRlZCkge1xyXG4gICAgICAgICAgICAvLyBDb250cm9sIHZhcnNcclxuICAgICAgICAgICAgdmFyIGRhdGEgPSBbXTtcclxuXHJcbiAgICAgICAgICAgIC8vIENvbHVtbiBhbmQgcm93IGxlbmd0aFxyXG4gICAgICAgICAgICB2YXIgeCA9IG9iai5vcHRpb25zLmNvbHVtbnMubGVuZ3RoXHJcbiAgICAgICAgICAgIHZhciB5ID0gb2JqLm9wdGlvbnMuZGF0YS5sZW5ndGhcclxuXHJcbiAgICAgICAgICAgIC8vIEdvIHRocm91Z2ggdGhlIGNvbHVtbnMgdG8gZ2V0IHRoZSBkYXRhXHJcbiAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgeTsgaisrKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgcm93ID0gbnVsbDtcclxuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgeDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFoaWdobGlnaHRlZCB8fCBvYmoucmVjb3Jkc1tqXVtpXS5jbGFzc0xpc3QuY29udGFpbnMoJ2hpZ2hsaWdodCcpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyb3cgPT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcm93ID0ge307XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFvYmoub3B0aW9ucy5jb2x1bW5zW2ldLm5hbWUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9iai5vcHRpb25zLmNvbHVtbnNbaV0ubmFtZSA9IGk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgcm93W29iai5vcHRpb25zLmNvbHVtbnNbaV0ubmFtZV0gPSBvYmoub3B0aW9ucy5kYXRhW2pdW2ldO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBpZiAocm93ICE9IG51bGwpIHtcclxuICAgICAgICAgICAgICAgICAgICBkYXRhLnB1c2gocm93KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgcmV0dXJuIGRhdGE7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvKipcclxuICAgICAgICAgKiBQcmVwYXJlIEpTT04gaW4gdGhlIGNvcnJlY3QgZm9ybWF0XHJcbiAgICAgICAgICovXHJcbiAgICAgICAgb2JqLnByZXBhcmVKc29uID0gZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgdmFyIHJvd3MgPSBbXTtcclxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBkYXRhLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgeCA9IGRhdGFbaV0ueDtcclxuICAgICAgICAgICAgICAgIHZhciB5ID0gZGF0YVtpXS55O1xyXG4gICAgICAgICAgICAgICAgdmFyIGsgPSBvYmoub3B0aW9ucy5jb2x1bW5zW3hdLm5hbWUgPyBvYmoub3B0aW9ucy5jb2x1bW5zW3hdLm5hbWUgOiB4O1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIENyZWF0ZSByb3dcclxuICAgICAgICAgICAgICAgIGlmICghcm93c1t5XSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJvd3NbeV0gPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJvdzogeSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGF0YToge30sXHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHJvd3NbeV0uZGF0YVtrXSA9IGRhdGFbaV0ubmV3VmFsdWU7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIEZpbHRlciByb3dzXHJcbiAgICAgICAgICAgIHJldHVybiByb3dzLmZpbHRlcihmdW5jdGlvbiAoZWwpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBlbCAhPSBudWxsO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIFBvc3QganNvbiB0byBhIHJlbW90ZSBzZXJ2ZXJcclxuICAgICAgICAgKi9cclxuICAgICAgICBvYmouc2F2ZSA9IGZ1bmN0aW9uICh1cmwsIGRhdGEpIHtcclxuICAgICAgICAgICAgLy8gUGFyc2UgYW55dGhpbmcgaW4gdGhlIGRhdGEgYmVmb3JlIHNlbmRpbmcgdG8gdGhlIHNlcnZlclxyXG4gICAgICAgICAgICB2YXIgcmV0ID0gb2JqLmRpc3BhdGNoKCdvbmJlZm9yZXNhdmUnLCBlbCwgb2JqLCBkYXRhKTtcclxuICAgICAgICAgICAgaWYgKHJldCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGRhdGEgPSByZXQ7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBpZiAocmV0ID09PSBmYWxzZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gUmVtb3ZlIHVwZGF0ZVxyXG4gICAgICAgICAgICBqU3VpdGVzLmFqYXgoe1xyXG4gICAgICAgICAgICAgICAgdXJsOiB1cmwsXHJcbiAgICAgICAgICAgICAgICBtZXRob2Q6ICdQT1NUJyxcclxuICAgICAgICAgICAgICAgIGRhdGFUeXBlOiAnanNvbicsXHJcbiAgICAgICAgICAgICAgICBkYXRhOiB7ZGF0YTogSlNPTi5zdHJpbmdpZnkoZGF0YSl9LFxyXG4gICAgICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24gKHJlc3VsdCkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIEV2ZW50XHJcbiAgICAgICAgICAgICAgICAgICAgb2JqLmRpc3BhdGNoKCdvbnNhdmUnLCBlbCwgb2JqLCBkYXRhKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvKipcclxuICAgICAgICAgKiBHZXQgYSByb3cgZGF0YSBieSByb3dOdW1iZXJcclxuICAgICAgICAgKi9cclxuICAgICAgICBvYmouZ2V0Um93RGF0YSA9IGZ1bmN0aW9uIChyb3dOdW1iZXIpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG9iai5vcHRpb25zLmRhdGFbcm93TnVtYmVyXTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIFNldCBhIHJvdyBkYXRhIGJ5IHJvd051bWJlclxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIG9iai5zZXRSb3dEYXRhID0gZnVuY3Rpb24gKHJvd051bWJlciwgZGF0YSwgZm9yY2UgPSBmYWxzZSkge1xyXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG9iai5oZWFkZXJzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAvLyBVcGRhdGUgY2VsbFxyXG4gICAgICAgICAgICAgICAgdmFyIGNvbHVtbk5hbWUgPSBqZXhjZWwuZ2V0Q29sdW1uTmFtZUZyb21JZChbaSwgcm93TnVtYmVyXSk7XHJcbiAgICAgICAgICAgICAgICAvLyBTZXQgdmFsdWVcclxuICAgICAgICAgICAgICAgIGlmIChkYXRhW2ldICE9IG51bGwpIHtcclxuICAgICAgICAgICAgICAgICAgICBvYmouc2V0VmFsdWUoY29sdW1uTmFtZSwgZGF0YVtpXSwgZm9yY2UpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvKipcclxuICAgICAgICAgKiBHZXQgYSBjb2x1bW4gZGF0YSBieSBjb2x1bW5OdW1iZXJcclxuICAgICAgICAgKi9cclxuICAgICAgICBvYmouZ2V0Q29sdW1uRGF0YSA9IGZ1bmN0aW9uIChjb2x1bW5OdW1iZXIpIHtcclxuICAgICAgICAgICAgdmFyIGRhdGFzZXQgPSBbXTtcclxuICAgICAgICAgICAgLy8gR28gdGhyb3VnaCB0aGUgcm93cyB0byBnZXQgdGhlIGRhdGFcclxuICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBvYmoub3B0aW9ucy5kYXRhLmxlbmd0aDsgaisrKSB7XHJcbiAgICAgICAgICAgICAgICBkYXRhc2V0LnB1c2gob2JqLm9wdGlvbnMuZGF0YVtqXVtjb2x1bW5OdW1iZXJdKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gZGF0YXNldDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIFNldCBhIGNvbHVtbiBkYXRhIGJ5IGNvbE51bWJlclxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIG9iai5zZXRDb2x1bW5EYXRhID0gZnVuY3Rpb24gKGNvbE51bWJlciwgZGF0YSkge1xyXG4gICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IG9iai5yb3dzLmxlbmd0aDsgaisrKSB7XHJcbiAgICAgICAgICAgICAgICAvLyBVcGRhdGUgY2VsbFxyXG4gICAgICAgICAgICAgICAgdmFyIGNvbHVtbk5hbWUgPSBqZXhjZWwuZ2V0Q29sdW1uTmFtZUZyb21JZChbY29sTnVtYmVyLCBqXSk7XHJcbiAgICAgICAgICAgICAgICAvLyBTZXQgdmFsdWVcclxuICAgICAgICAgICAgICAgIGlmIChkYXRhW2pdICE9IG51bGwpIHtcclxuICAgICAgICAgICAgICAgICAgICBvYmouc2V0VmFsdWUoY29sdW1uTmFtZSwgZGF0YVtqXSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIENyZWF0ZSByb3dcclxuICAgICAgICAgKi9cclxuICAgICAgICBvYmouY3JlYXRlUm93ID0gZnVuY3Rpb24gKGosIGRhdGEpIHtcclxuICAgICAgICAgICAgLy8gQ3JlYXRlIGNvbnRhaW5lclxyXG4gICAgICAgICAgICBpZiAoIW9iai5yZWNvcmRzW2pdKSB7XHJcbiAgICAgICAgICAgICAgICBvYmoucmVjb3Jkc1tqXSA9IFtdO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIC8vIERlZmF1bHQgZGF0YVxyXG4gICAgICAgICAgICBpZiAoIWRhdGEpIHtcclxuICAgICAgICAgICAgICAgIHZhciBkYXRhID0gb2JqLm9wdGlvbnMuZGF0YVtqXTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAvLyBOZXcgbGluZSBvZiBkYXRhIHRvIGJlIGFwcGVuZCBpbiB0aGUgdGFibGVcclxuICAgICAgICAgICAgb2JqLnJvd3Nbal0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0cicpO1xyXG4gICAgICAgICAgICBvYmoucm93c1tqXS5zZXRBdHRyaWJ1dGUoJ2RhdGEteScsIGopO1xyXG4gICAgICAgICAgICAvLyBJbmRleFxyXG4gICAgICAgICAgICB2YXIgaW5kZXggPSBudWxsO1xyXG4gICAgICAgICAgICAvLyBEZWZpbml0aW9uc1xyXG4gICAgICAgICAgICBpZiAob2JqLm9wdGlvbnMucm93c1tqXSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKG9iai5vcHRpb25zLnJvd3Nbal0uaGVpZ2h0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgb2JqLnJvd3Nbal0uc3R5bGUuaGVpZ2h0ID0gb2JqLm9wdGlvbnMucm93c1tqXS5oZWlnaHQ7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAob2JqLm9wdGlvbnMucm93c1tqXS50aXRsZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGluZGV4ID0gb2JqLm9wdGlvbnMucm93c1tqXS50aXRsZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoIWluZGV4KSB7XHJcbiAgICAgICAgICAgICAgICBpbmRleCA9IHBhcnNlSW50KGogKyAxKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAvLyBSb3cgbnVtYmVyIGxhYmVsXHJcbiAgICAgICAgICAgIHZhciB0ZCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RkJyk7XHJcbiAgICAgICAgICAgIHRkLmlubmVySFRNTCA9IGluZGV4O1xyXG4gICAgICAgICAgICB0ZC5zZXRBdHRyaWJ1dGUoJ2RhdGEteScsIGopO1xyXG4gICAgICAgICAgICB0ZC5jbGFzc05hbWUgPSAnamV4Y2VsX3Jvdyc7XHJcbiAgICAgICAgICAgIG9iai5yb3dzW2pdLmFwcGVuZENoaWxkKHRkKTtcclxuXHJcbiAgICAgICAgICAgIC8vIERhdGEgY29sdW1uc1xyXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG9iai5vcHRpb25zLmNvbHVtbnMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgIC8vIE5ldyBjb2x1bW4gb2YgZGF0YSB0byBiZSBhcHBlbmQgaW4gdGhlIGxpbmVcclxuICAgICAgICAgICAgICAgIG9iai5yZWNvcmRzW2pdW2ldID0gb2JqLmNyZWF0ZUNlbGwoaSwgaiwgZGF0YVtpXSk7XHJcbiAgICAgICAgICAgICAgICAvLyBBZGQgY29sdW1uIHRvIHRoZSByb3dcclxuICAgICAgICAgICAgICAgIG9iai5yb3dzW2pdLmFwcGVuZENoaWxkKG9iai5yZWNvcmRzW2pdW2ldKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgb2JqLmRpc3BhdGNoKCdvbmNyZWF0ZXJvdycsIG9iai5yb3dzW2pdLCBqKTtcclxuXHJcbiAgICAgICAgICAgIC8vIEFkZCByb3cgdG8gdGhlIHRhYmxlIGJvZHlcclxuICAgICAgICAgICAgcmV0dXJuIG9iai5yb3dzW2pdO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgb2JqLnBhcnNlVmFsdWUgPSBmdW5jdGlvbiAoaSwgaiwgdmFsdWUpIHtcclxuICAgICAgICAgICAgaWYgKCgnJyArIHZhbHVlKS5zdWJzdHIoMCwgMSkgPT0gJz0nICYmIG9iai5vcHRpb25zLnBhcnNlRm9ybXVsYXMgPT0gdHJ1ZSkge1xyXG4gICAgICAgICAgICAgICAgdmFsdWUgPSBvYmouZXhlY3V0ZUZvcm11bGEodmFsdWUsIGksIGopXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKG9iai5vcHRpb25zLmNvbHVtbnNbaV0ubWFzaykge1xyXG4gICAgICAgICAgICAgICAgdmFyIGRlY2ltYWwgPSBvYmoub3B0aW9ucy5jb2x1bW5zW2ldLmRlY2ltYWwgfHwgJy4nO1xyXG4gICAgICAgICAgICAgICAgdmFsdWUgPSAnJyArIGpTdWl0ZXMubWFzay5ydW4odmFsdWUsIG9iai5vcHRpb25zLmNvbHVtbnNbaV0ubWFzaywgZGVjaW1hbCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIHZhbHVlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogQ3JlYXRlIGNlbGxcclxuICAgICAgICAgKi9cclxuICAgICAgICBvYmouY3JlYXRlQ2VsbCA9IGZ1bmN0aW9uIChpLCBqLCB2YWx1ZSkge1xyXG4gICAgICAgICAgICAvLyBDcmVhdGUgY2VsbCBhbmQgcHJvcGVydGllc1xyXG4gICAgICAgICAgICB2YXIgdGQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0ZCcpO1xyXG4gICAgICAgICAgICB0ZC5zZXRBdHRyaWJ1dGUoJ2RhdGEteCcsIGkpO1xyXG4gICAgICAgICAgICB0ZC5zZXRBdHRyaWJ1dGUoJ2RhdGEteScsIGopO1xyXG5cclxuICAgICAgICAgICAgLy8gU2VjdXJpdHlcclxuICAgICAgICAgICAgaWYgKCgnJyArIHZhbHVlKS5zdWJzdHIoMCwgMSkgPT0gJz0nICYmIG9iai5vcHRpb25zLnNlY3VyZUZvcm11bGFzID09IHRydWUpIHtcclxuICAgICAgICAgICAgICAgIHZhciB2YWwgPSBzZWN1cmVGb3JtdWxhKHZhbHVlKTtcclxuICAgICAgICAgICAgICAgIGlmICh2YWwgIT0gdmFsdWUpIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBVcGRhdGUgdGhlIGRhdGEgY29udGFpbmVyXHJcbiAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSB2YWw7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIEN1c3RvbSBjb2x1bW5cclxuICAgICAgICAgICAgaWYgKG9iai5vcHRpb25zLmNvbHVtbnNbaV0uZWRpdG9yKSB7XHJcbiAgICAgICAgICAgICAgICAvLyBpZiAob2JqLm9wdGlvbnMuc3RyaXBIVE1MID09PSBmYWxzZSB8fCBvYmoub3B0aW9ucy5jb2x1bW5zW2ldLnN0cmlwSFRNTCA9PT0gZmFsc2UpIHtcclxuICAgICAgICAgICAgICAgIC8vICAgICB0ZC5pbm5lckhUTUwgPSB2YWx1ZTtcclxuICAgICAgICAgICAgICAgIC8vIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAvLyAgICAgdGQuaW5uZXJUZXh0ID0gdmFsdWU7XHJcbiAgICAgICAgICAgICAgICAvLyB9XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKHR5cGVvZiAob2JqLm9wdGlvbnMuY29sdW1uc1tpXS5lZGl0b3IuY3JlYXRlQ2VsbCkgPT0gJ2Z1bmN0aW9uJykge1xyXG4gICAgICAgICAgICAgICAgICAgIHRkID0gb2JqLm9wdGlvbnMuY29sdW1uc1tpXS5lZGl0b3IuY3JlYXRlQ2VsbCh0ZCwgaSwgdmFsdWUsIG9iaik7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAvLyBIaWRkZW4gY29sdW1uXHJcbiAgICAgICAgICAgICAgICBpZiAob2JqLm9wdGlvbnMuY29sdW1uc1tpXS50eXBlID09ICdoaWRkZW4nKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGQuc3R5bGUuZGlzcGxheSA9ICdub25lJztcclxuICAgICAgICAgICAgICAgICAgICB0ZC5pbm5lclRleHQgPSB2YWx1ZTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAob2JqLm9wdGlvbnMuY29sdW1uc1tpXS50eXBlID09ICdjaGVja2JveCcgfHwgb2JqLm9wdGlvbnMuY29sdW1uc1tpXS50eXBlID09ICdyYWRpbycpIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBDcmVhdGUgaW5wdXRcclxuICAgICAgICAgICAgICAgICAgICB2YXIgZWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2lucHV0Jyk7XHJcbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudC50eXBlID0gb2JqLm9wdGlvbnMuY29sdW1uc1tpXS50eXBlO1xyXG4gICAgICAgICAgICAgICAgICAgIGVsZW1lbnQubmFtZSA9ICdjJyArIGk7XHJcbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5jaGVja2VkID0gKHZhbHVlID09IDEgfHwgdmFsdWUgPT0gdHJ1ZSB8fCB2YWx1ZSA9PSAndHJ1ZScpID8gdHJ1ZSA6IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgIGVsZW1lbnQub25jbGljayA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgb2JqLnNldFZhbHVlKHRkLCB0aGlzLmNoZWNrZWQpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKG9iai5vcHRpb25zLmNvbHVtbnNbaV0ucmVhZE9ubHkgPT0gdHJ1ZSB8fCBvYmoub3B0aW9ucy5lZGl0YWJsZSA9PSBmYWxzZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBlbGVtZW50LnNldEF0dHJpYnV0ZSgnZGlzYWJsZWQnLCAnZGlzYWJsZWQnKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIC8vIEFwcGVuZCB0byB0aGUgdGFibGVcclxuICAgICAgICAgICAgICAgICAgICB0ZC5hcHBlbmRDaGlsZChlbGVtZW50KTtcclxuICAgICAgICAgICAgICAgICAgICAvLyBNYWtlIHN1cmUgdGhlIHZhbHVlcyBhcmUgY29ycmVjdFxyXG4gICAgICAgICAgICAgICAgICAgIG9iai5vcHRpb25zLmRhdGFbal1baV0gPSBlbGVtZW50LmNoZWNrZWQ7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKG9iai5vcHRpb25zLmNvbHVtbnNbaV0udHlwZSA9PSAnY2FsZW5kYXInKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gVHJ5IGZvcm1hdHRlZCBkYXRlXHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGZvcm1hdHRlZCA9IGpTdWl0ZXMuY2FsZW5kYXIuZXh0cmFjdERhdGVGcm9tU3RyaW5nKHZhbHVlLCBvYmoub3B0aW9ucy5jb2x1bW5zW2ldLm9wdGlvbnMuZm9ybWF0KTtcclxuICAgICAgICAgICAgICAgICAgICAvLyBDcmVhdGUgY2FsZW5kYXIgY2VsbFxyXG4gICAgICAgICAgICAgICAgICAgIHRkLmlubmVyVGV4dCA9IGpTdWl0ZXMuY2FsZW5kYXIuZ2V0RGF0ZVN0cmluZyhmb3JtYXR0ZWQgPyBmb3JtYXR0ZWQgOiB2YWx1ZSwgb2JqLm9wdGlvbnMuY29sdW1uc1tpXS5vcHRpb25zLmZvcm1hdCk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKG9iai5vcHRpb25zLmNvbHVtbnNbaV0udHlwZSA9PSAnZHJvcGRvd24nIHx8IG9iai5vcHRpb25zLmNvbHVtbnNbaV0udHlwZSA9PSAnYXV0b2NvbXBsZXRlJykge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIENyZWF0ZSBkcm9wZG93biBjZWxsXHJcbiAgICAgICAgICAgICAgICAgICAgdGQuY2xhc3NMaXN0LmFkZCgnamV4Y2VsX2Ryb3Bkb3duJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2codGQpXHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHRkLmlubmVyVGV4dCA9IG9iai5nZXREcm9wRG93blZhbHVlKGksIHZhbHVlLCBqLCB0ZCk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKG9iai5vcHRpb25zLmNvbHVtbnNbaV0udHlwZSA9PSAnY29sb3InKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKG9iai5vcHRpb25zLmNvbHVtbnNbaV0ucmVuZGVyID09ICdzcXVhcmUnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjb2xvciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb2xvci5jbGFzc05hbWUgPSAnY29sb3InO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb2xvci5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSB2YWx1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGQuYXBwZW5kQ2hpbGQoY29sb3IpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRkLnN0eWxlLmNvbG9yID0gdmFsdWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRkLmlubmVyVGV4dCA9IHZhbHVlO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAob2JqLm9wdGlvbnMuY29sdW1uc1tpXS50eXBlID09ICdpbWFnZScpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodmFsdWUgJiYgdmFsdWUuc3Vic3RyKDAsIDEwKSA9PSAnZGF0YTppbWFnZScpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGltZyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2ltZycpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpbWcuc3JjID0gdmFsdWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRkLmFwcGVuZENoaWxkKGltZyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAob2JqLm9wdGlvbnMuY29sdW1uc1tpXS50eXBlID09ICdodG1sJykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0ZC5pbm5lckhUTUwgPSBzdHJpcFNjcmlwdChvYmoucGFyc2VWYWx1ZShpLCBqLCB2YWx1ZSkpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChvYmoub3B0aW9ucy5zdHJpcEhUTUwgPT09IGZhbHNlIHx8IG9iai5vcHRpb25zLmNvbHVtbnNbaV0uc3RyaXBIVE1MID09PSBmYWxzZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGQuaW5uZXJIVE1MID0gc3RyaXBTY3JpcHQob2JqLnBhcnNlVmFsdWUoaSwgaiwgdmFsdWUpKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRkLmlubmVyVGV4dCA9IG9iai5wYXJzZVZhbHVlKGksIGosIHZhbHVlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gUmVhZG9ubHlcclxuICAgICAgICAgICAgaWYgKG9iai5vcHRpb25zLmNvbHVtbnNbaV0ucmVhZE9ubHkgPT0gdHJ1ZSkge1xyXG4gICAgICAgICAgICAgICAgdGQuY2xhc3NOYW1lID0gJ3JlYWRvbmx5JztcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gVGV4dCBhbGlnblxyXG4gICAgICAgICAgICB2YXIgY29sQWxpZ24gPSBvYmoub3B0aW9ucy5jb2x1bW5zW2ldLmFsaWduID8gb2JqLm9wdGlvbnMuY29sdW1uc1tpXS5hbGlnbiA6ICdjZW50ZXInO1xyXG4gICAgICAgICAgICB0ZC5zdHlsZS50ZXh0QWxpZ24gPSBjb2xBbGlnbjtcclxuXHJcbiAgICAgICAgICAgIC8vIFdyYXAgb3B0aW9uXHJcbiAgICAgICAgICAgIGlmIChvYmoub3B0aW9ucy5jb2x1bW5zW2ldLndvcmRXcmFwICE9IGZhbHNlICYmIChvYmoub3B0aW9ucy53b3JkV3JhcCA9PSB0cnVlIHx8IG9iai5vcHRpb25zLmNvbHVtbnNbaV0ud29yZFdyYXAgPT0gdHJ1ZSB8fCB0ZC5pbm5lckhUTUwubGVuZ3RoID4gMjAwKSkge1xyXG4gICAgICAgICAgICAgICAgdGQuc3R5bGUud2hpdGVTcGFjZSA9ICdwcmUtd3JhcCc7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIE92ZXJmbG93XHJcbiAgICAgICAgICAgIGlmIChpID4gMCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMub3B0aW9ucy50ZXh0T3ZlcmZsb3cgPT0gdHJ1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZSB8fCB0ZC5pbm5lckhUTUwpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgb2JqLnJlY29yZHNbal1baSAtIDFdLnN0eWxlLm92ZXJmbG93ID0gJ2hpZGRlbic7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGkgPT0gb2JqLm9wdGlvbnMuY29sdW1ucy5sZW5ndGggLSAxKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZC5zdHlsZS5vdmVyZmxvdyA9ICdoaWRkZW4nO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiB0ZDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIG9iai5jcmVhdGVDZWxsSGVhZGVyID0gZnVuY3Rpb24gKGNvbE51bWJlcikge1xyXG4gICAgICAgICAgICAvLyBDcmVhdGUgY29sIGdsb2JhbCBjb250cm9sXHJcbiAgICAgICAgICAgIHZhciBjb2xXaWR0aCA9IG9iai5vcHRpb25zLmNvbHVtbnNbY29sTnVtYmVyXS53aWR0aCA/IG9iai5vcHRpb25zLmNvbHVtbnNbY29sTnVtYmVyXS53aWR0aCA6IG9iai5vcHRpb25zLmRlZmF1bHRDb2xXaWR0aDtcclxuICAgICAgICAgICAgdmFyIGNvbEFsaWduID0gb2JqLm9wdGlvbnMuY29sdW1uc1tjb2xOdW1iZXJdLmFsaWduID8gb2JqLm9wdGlvbnMuY29sdW1uc1tjb2xOdW1iZXJdLmFsaWduIDogb2JqLm9wdGlvbnMuZGVmYXVsdENvbEFsaWduO1xyXG5cclxuICAgICAgICAgICAgLy8gQ3JlYXRlIGhlYWRlciBjZWxsXHJcbiAgICAgICAgICAgIG9iai5oZWFkZXJzW2NvbE51bWJlcl0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0ZCcpO1xyXG5cclxuICAgICAgICAgICAgaWYgKG9iai5vcHRpb25zLnN0cmlwSFRNTCkge1xyXG4gICAgICAgICAgICAgICAgb2JqLmhlYWRlcnNbY29sTnVtYmVyXS5pbm5lclRleHQgPSBvYmoub3B0aW9ucy5jb2x1bW5zW2NvbE51bWJlcl0udGl0bGUgPyBvYmoub3B0aW9ucy5jb2x1bW5zW2NvbE51bWJlcl0udGl0bGUgOiBqZXhjZWwuZ2V0Q29sdW1uTmFtZShjb2xOdW1iZXIpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgb2JqLmhlYWRlcnNbY29sTnVtYmVyXS5pbm5lckhUTUwgPSBvYmoub3B0aW9ucy5jb2x1bW5zW2NvbE51bWJlcl0udGl0bGUgPyBvYmoub3B0aW9ucy5jb2x1bW5zW2NvbE51bWJlcl0udGl0bGUgOiBqZXhjZWwuZ2V0Q29sdW1uTmFtZShjb2xOdW1iZXIpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIG9iai5oZWFkZXJzW2NvbE51bWJlcl0uc2V0QXR0cmlidXRlKCdkYXRhLXgnLCBjb2xOdW1iZXIpO1xyXG4gICAgICAgICAgICBvYmouaGVhZGVyc1tjb2xOdW1iZXJdLnN0eWxlLnRleHRBbGlnbiA9IGNvbEFsaWduO1xyXG4gICAgICAgICAgICBpZiAob2JqLm9wdGlvbnMuY29sdW1uc1tjb2xOdW1iZXJdLnRpdGxlKSB7XHJcbiAgICAgICAgICAgICAgICAvLyBvYmouaGVhZGVyc1tjb2xOdW1iZXJdLnNldEF0dHJpYnV0ZSgndGl0bGUnLCBvYmoub3B0aW9ucy5jb2x1bW5zW2NvbE51bWJlcl0udGV4dENvbnRlbnQpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBXaWR0aCBjb250cm9sXHJcbiAgICAgICAgICAgIG9iai5jb2xncm91cFtjb2xOdW1iZXJdID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnY29sJyk7XHJcbiAgICAgICAgICAgIG9iai5jb2xncm91cFtjb2xOdW1iZXJdLnNldEF0dHJpYnV0ZSgnd2lkdGgnLCBjb2xXaWR0aCk7XHJcblxyXG4gICAgICAgICAgICAvLyBIaWRkZW4gY29sdW1uXHJcbiAgICAgICAgICAgIGlmIChvYmoub3B0aW9ucy5jb2x1bW5zW2NvbE51bWJlcl0udHlwZSA9PSAnaGlkZGVuJykge1xyXG4gICAgICAgICAgICAgICAgb2JqLmhlYWRlcnNbY29sTnVtYmVyXS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnO1xyXG4gICAgICAgICAgICAgICAgb2JqLmNvbGdyb3VwW2NvbE51bWJlcl0uc3R5bGUuZGlzcGxheSA9ICdub25lJztcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgb2JqLmRpc3BhdGNoKCdvbmNyZWF0Y2VsbGhlYWRlcicsIGVsLCBvYmosIGNvbE51bWJlcik7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvKipcclxuICAgICAgICAgKiBVcGRhdGUgYSBuZXN0ZWQgaGVhZGVyIHRpdGxlXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgb2JqLnVwZGF0ZU5lc3RlZEhlYWRlciA9IGZ1bmN0aW9uICh4LCB5LCB0aXRsZSkge1xyXG4gICAgICAgICAgICBpZiAob2JqLm9wdGlvbnMubmVzdGVkSGVhZGVyc1t5XVt4XS50aXRsZSkge1xyXG4gICAgICAgICAgICAgICAgb2JqLm9wdGlvbnMubmVzdGVkSGVhZGVyc1t5XVt4XS50aXRsZSA9IHRpdGxlO1xyXG4gICAgICAgICAgICAgICAgb2JqLm9wdGlvbnMubmVzdGVkSGVhZGVyc1t5XS5lbGVtZW50LmNoaWxkcmVuW3ggKyAxXS5pbm5lclRleHQgPSB0aXRsZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogQ3JlYXRlIGEgbmVzdGVkIGhlYWRlciBvYmplY3RcclxuICAgICAgICAgKi9cclxuICAgICAgICBvYmouY3JlYXRlTmVzdGVkSGVhZGVyID0gZnVuY3Rpb24gKG5lc3RlZEluZm9ybWF0aW9uKSB7XHJcbiAgICAgICAgICAgIHZhciB0ciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RyJyk7XHJcbiAgICAgICAgICAgIHRyLmNsYXNzTGlzdC5hZGQoJ2pleGNlbF9uZXN0ZWQnKTtcclxuICAgICAgICAgICAgdmFyIHRkID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGQnKTtcclxuICAgICAgICAgICAgdHIuYXBwZW5kQ2hpbGQodGQpO1xyXG4gICAgICAgICAgICAvLyBFbGVtZW50XHJcbiAgICAgICAgICAgIG5lc3RlZEluZm9ybWF0aW9uLmVsZW1lbnQgPSB0cjtcclxuXHJcbiAgICAgICAgICAgIHZhciBoZWFkZXJJbmRleCA9IDA7XHJcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbmVzdGVkSW5mb3JtYXRpb24ubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgIC8vIERlZmF1bHQgdmFsdWVzXHJcbiAgICAgICAgICAgICAgICBpZiAoIW5lc3RlZEluZm9ybWF0aW9uW2ldLmNvbHNwYW4pIHtcclxuICAgICAgICAgICAgICAgICAgICBuZXN0ZWRJbmZvcm1hdGlvbltpXS5jb2xzcGFuID0gMTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmICghbmVzdGVkSW5mb3JtYXRpb25baV0uYWxpZ24pIHtcclxuICAgICAgICAgICAgICAgICAgICBuZXN0ZWRJbmZvcm1hdGlvbltpXS5hbGlnbiA9ICdjZW50ZXInO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKCFuZXN0ZWRJbmZvcm1hdGlvbltpXS50aXRsZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIG5lc3RlZEluZm9ybWF0aW9uW2ldLnRpdGxlID0gJyc7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gTnVtYmVyIG9mIGNvbHVtbnNcclxuICAgICAgICAgICAgICAgIHZhciBudW1iZXJPZkNvbHVtbnMgPSBuZXN0ZWRJbmZvcm1hdGlvbltpXS5jb2xzcGFuO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIENsYXNzZXMgY29udGFpbmVyXHJcbiAgICAgICAgICAgICAgICB2YXIgY29sdW1uID0gW107XHJcbiAgICAgICAgICAgICAgICAvLyBIZWFkZXIgY2xhc3NlcyBmb3IgdGhpcyBjZWxsXHJcbiAgICAgICAgICAgICAgICBmb3IgKHZhciB4ID0gMDsgeCA8IG51bWJlck9mQ29sdW1uczsgeCsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKG9iai5vcHRpb25zLmNvbHVtbnNbaGVhZGVySW5kZXhdICYmIG9iai5vcHRpb25zLmNvbHVtbnNbaGVhZGVySW5kZXhdLnR5cGUgPT0gJ2hpZGRlbicpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbnVtYmVyT2ZDb2x1bW5zKys7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGNvbHVtbi5wdXNoKGhlYWRlckluZGV4KTtcclxuICAgICAgICAgICAgICAgICAgICBoZWFkZXJJbmRleCsrO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIC8vIENyZWF0ZWQgdGhlIG5lc3RlZCBjZWxsXHJcbiAgICAgICAgICAgICAgICB2YXIgdGQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0ZCcpO1xyXG4gICAgICAgICAgICAgICAgdGQuc2V0QXR0cmlidXRlKCdkYXRhLWNvbHVtbicsIGNvbHVtbi5qb2luKCcsJykpO1xyXG4gICAgICAgICAgICAgICAgdGQuc2V0QXR0cmlidXRlKCdjb2xzcGFuJywgbmVzdGVkSW5mb3JtYXRpb25baV0uY29sc3Bhbik7XHJcbiAgICAgICAgICAgICAgICB0ZC5zZXRBdHRyaWJ1dGUoJ2FsaWduJywgbmVzdGVkSW5mb3JtYXRpb25baV0uYWxpZ24pO1xyXG4gICAgICAgICAgICAgICAgdGQuaW5uZXJUZXh0ID0gbmVzdGVkSW5mb3JtYXRpb25baV0udGl0bGU7XHJcbiAgICAgICAgICAgICAgICB0ci5hcHBlbmRDaGlsZCh0ZCk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHJldHVybiB0cjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIENyZWF0ZSB0b29sYmFyXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgb2JqLmNyZWF0ZVRvb2xiYXIgPSBmdW5jdGlvbiAodG9vbGJhcikge1xyXG4gICAgICAgICAgICBpZiAodG9vbGJhcikge1xyXG4gICAgICAgICAgICAgICAgb2JqLm9wdGlvbnMudG9vbGJhciA9IHRvb2xiYXI7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgdG9vbGJhciA9IG9iai5vcHRpb25zLnRvb2xiYXI7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0b29sYmFyLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAodG9vbGJhcltpXS50eXBlID09ICdpJykge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciB0b29sYmFySXRlbSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2knKTtcclxuICAgICAgICAgICAgICAgICAgICB0b29sYmFySXRlbS5jbGFzc0xpc3QuYWRkKCdqZXhjZWxfdG9vbGJhcl9pdGVtJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgdG9vbGJhckl0ZW0uY2xhc3NMaXN0LmFkZCgnbWF0ZXJpYWwtaWNvbnMnKTtcclxuICAgICAgICAgICAgICAgICAgICB0b29sYmFySXRlbS5zZXRBdHRyaWJ1dGUoJ2RhdGEtaycsIHRvb2xiYXJbaV0uayk7XHJcbiAgICAgICAgICAgICAgICAgICAgdG9vbGJhckl0ZW0uc2V0QXR0cmlidXRlKCdkYXRhLXYnLCB0b29sYmFyW2ldLnYpO1xyXG4gICAgICAgICAgICAgICAgICAgIHRvb2xiYXJJdGVtLnNldEF0dHJpYnV0ZSgnaWQnLCB0b29sYmFyW2ldLmlkKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgLy8gVG9vbHRpcFxyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0b29sYmFyW2ldLnRvb2x0aXApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdG9vbGJhckl0ZW0uc2V0QXR0cmlidXRlKCd0aXRsZScsIHRvb2xiYXJbaV0udG9vbHRpcCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIC8vIEhhbmRsZSBjbGlja1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0b29sYmFyW2ldLm9uY2xpY2sgJiYgdHlwZW9mICh0b29sYmFyW2ldLm9uY2xpY2spKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRvb2xiYXJJdGVtLm9uY2xpY2sgPSAoZnVuY3Rpb24gKGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBiID0gYTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9vbGJhcltiXS5vbmNsaWNrKGVsLCBvYmosIHRoaXMpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSkoaSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdG9vbGJhckl0ZW0ub25jbGljayA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBrID0gdGhpcy5nZXRBdHRyaWJ1dGUoJ2RhdGEtaycpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHYgPSB0aGlzLmdldEF0dHJpYnV0ZSgnZGF0YS12Jyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmouc2V0U3R5bGUob2JqLmhpZ2hsaWdodGVkLCBrLCB2KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAvLyBBcHBlbmQgZWxlbWVudFxyXG4gICAgICAgICAgICAgICAgICAgIHRvb2xiYXJJdGVtLmlubmVyVGV4dCA9IHRvb2xiYXJbaV0uY29udGVudDtcclxuICAgICAgICAgICAgICAgICAgICBvYmoudG9vbGJhci5hcHBlbmRDaGlsZCh0b29sYmFySXRlbSk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHRvb2xiYXJbaV0udHlwZSA9PSAnc2VsZWN0Jykge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciB0b29sYmFySXRlbSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NlbGVjdCcpO1xyXG4gICAgICAgICAgICAgICAgICAgIHRvb2xiYXJJdGVtLmNsYXNzTGlzdC5hZGQoJ2pleGNlbF90b29sYmFyX2l0ZW0nKTtcclxuICAgICAgICAgICAgICAgICAgICB0b29sYmFySXRlbS5zZXRBdHRyaWJ1dGUoJ2RhdGEtaycsIHRvb2xiYXJbaV0uayk7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gVG9vbHRpcFxyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0b29sYmFyW2ldLnRvb2x0aXApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdG9vbGJhckl0ZW0uc2V0QXR0cmlidXRlKCd0aXRsZScsIHRvb2xiYXJbaV0udG9vbHRpcCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIC8vIEhhbmRsZSBvbmNoYW5nZVxyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0b29sYmFyW2ldLm9uY2hhbmdlICYmIHR5cGVvZiAodG9vbGJhcltpXS5vbmNoYW5nZSkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdG9vbGJhckl0ZW0ub25jaGFuZ2UgPSB0b29sYmFyW2ldLm9uY2hhbmdlO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRvb2xiYXJJdGVtLm9uY2hhbmdlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGsgPSB0aGlzLmdldEF0dHJpYnV0ZSgnZGF0YS1rJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmouc2V0U3R5bGUob2JqLmhpZ2hsaWdodGVkLCBrLCB0aGlzLnZhbHVlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAvLyBBZGQgb3B0aW9ucyB0byB0aGUgZHJvcGRvd25cclxuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IHRvb2xiYXJbaV0udi5sZW5ndGg7IGorKykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgdG9vbGJhckRyb3Bkb3duT3B0aW9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnb3B0aW9uJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRvb2xiYXJEcm9wZG93bk9wdGlvbi52YWx1ZSA9IHRvb2xiYXJbaV0udltqXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdG9vbGJhckRyb3Bkb3duT3B0aW9uLmlubmVyVGV4dCA9IHRvb2xiYXJbaV0udltqXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdG9vbGJhckl0ZW0uYXBwZW5kQ2hpbGQodG9vbGJhckRyb3Bkb3duT3B0aW9uKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgb2JqLnRvb2xiYXIuYXBwZW5kQ2hpbGQodG9vbGJhckl0ZW0pO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0b29sYmFyW2ldLnR5cGUgPT0gJ2NvbG9yJykge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciB0b29sYmFySXRlbSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2knKTtcclxuICAgICAgICAgICAgICAgICAgICB0b29sYmFySXRlbS5jbGFzc0xpc3QuYWRkKCdqZXhjZWxfdG9vbGJhcl9pdGVtJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgdG9vbGJhckl0ZW0uY2xhc3NMaXN0LmFkZCgnbWF0ZXJpYWwtaWNvbnMnKTtcclxuICAgICAgICAgICAgICAgICAgICB0b29sYmFySXRlbS5zZXRBdHRyaWJ1dGUoJ2RhdGEtaycsIHRvb2xiYXJbaV0uayk7XHJcbiAgICAgICAgICAgICAgICAgICAgdG9vbGJhckl0ZW0uc2V0QXR0cmlidXRlKCdkYXRhLXYnLCAnJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gVG9vbHRpcFxyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0b29sYmFyW2ldLnRvb2x0aXApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdG9vbGJhckl0ZW0uc2V0QXR0cmlidXRlKCd0aXRsZScsIHRvb2xiYXJbaV0udG9vbHRpcCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIG9iai50b29sYmFyLmFwcGVuZENoaWxkKHRvb2xiYXJJdGVtKTtcclxuICAgICAgICAgICAgICAgICAgICB0b29sYmFySXRlbS5pbm5lclRleHQgPSB0b29sYmFyW2ldLmNvbnRlbnQ7XHJcbiAgICAgICAgICAgICAgICAgICAgalN1aXRlcy5jb2xvcih0b29sYmFySXRlbSwge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBvbmNoYW5nZTogZnVuY3Rpb24gKG8sIHYpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBrID0gby5nZXRBdHRyaWJ1dGUoJ2RhdGEtaycpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb2JqLnNldFN0eWxlKG9iai5oaWdobGlnaHRlZCwgaywgdik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogTWVyZ2UgY2VsbHNcclxuICAgICAgICAgKiBAcGFyYW0gY2VsbE5hbWVcclxuICAgICAgICAgKiBAcGFyYW0gY29sc3BhblxyXG4gICAgICAgICAqIEBwYXJhbSByb3dzcGFuXHJcbiAgICAgICAgICogQHBhcmFtIGlnbm9yZUhpc3RvcnlBbmRFdmVudHNcclxuICAgICAgICAgKi9cclxuICAgICAgICBvYmouc2V0TWVyZ2UgPSBmdW5jdGlvbiAoY2VsbE5hbWUsIGNvbHNwYW4sIHJvd3NwYW4sIGlnbm9yZUhpc3RvcnlBbmRFdmVudHMpIHtcclxuICAgICAgICAgICAgdmFyIHRlc3QgPSBmYWxzZTtcclxuXHJcbiAgICAgICAgICAgIGlmICghY2VsbE5hbWUpIHtcclxuICAgICAgICAgICAgICAgIGlmICghb2JqLmhpZ2hsaWdodGVkLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGFsZXJ0KG9iai5vcHRpb25zLnRleHQubm9DZWxsc1NlbGVjdGVkKTtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHgxID0gcGFyc2VJbnQob2JqLmhpZ2hsaWdodGVkWzBdLmdldEF0dHJpYnV0ZSgnZGF0YS14JykpO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciB5MSA9IHBhcnNlSW50KG9iai5oaWdobGlnaHRlZFswXS5nZXRBdHRyaWJ1dGUoJ2RhdGEteScpKTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgeDIgPSBwYXJzZUludChvYmouaGlnaGxpZ2h0ZWRbb2JqLmhpZ2hsaWdodGVkLmxlbmd0aCAtIDFdLmdldEF0dHJpYnV0ZSgnZGF0YS14JykpO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciB5MiA9IHBhcnNlSW50KG9iai5oaWdobGlnaHRlZFtvYmouaGlnaGxpZ2h0ZWQubGVuZ3RoIC0gMV0uZ2V0QXR0cmlidXRlKCdkYXRhLXknKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGNlbGxOYW1lID0gamV4Y2VsLmdldENvbHVtbk5hbWVGcm9tSWQoW3gxLCB5MV0pO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBjb2xzcGFuID0gKHgyIC0geDEpICsgMTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgcm93c3BhbiA9ICh5MiAtIHkxKSArIDE7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHZhciBjZWxsID0gamV4Y2VsLmdldElkRnJvbUNvbHVtbk5hbWUoY2VsbE5hbWUsIHRydWUpO1xyXG5cclxuICAgICAgICAgICAgaWYgKG9iai5vcHRpb25zLm1lcmdlQ2VsbHNbY2VsbE5hbWVdKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAob2JqLnJlY29yZHNbY2VsbFsxXV1bY2VsbFswXV0uZ2V0QXR0cmlidXRlKCdkYXRhLW1lcmdlZCcpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGVzdCA9IG9iai5vcHRpb25zLnRleHQuY2VsbEFscmVhZHlNZXJnZWQ7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoKCFjb2xzcGFuIHx8IGNvbHNwYW4gPCAyKSAmJiAoIXJvd3NwYW4gfHwgcm93c3BhbiA8IDIpKSB7XHJcbiAgICAgICAgICAgICAgICB0ZXN0ID0gb2JqLm9wdGlvbnMudGV4dC5pbnZhbGlkTWVyZ2VQcm9wZXJ0aWVzO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdmFyIGNlbGxzID0gW107XHJcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBqID0gY2VsbFsxXTsgaiA8IGNlbGxbMV0gKyByb3dzcGFuOyBqKyspIHtcclxuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gY2VsbFswXTsgaSA8IGNlbGxbMF0gKyBjb2xzcGFuOyBpKyspIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNvbHVtbk5hbWUgPSBqZXhjZWwuZ2V0Q29sdW1uTmFtZUZyb21JZChbaSwgal0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAob2JqLnJlY29yZHNbal1baV0uZ2V0QXR0cmlidXRlKCdkYXRhLW1lcmdlZCcpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZXN0ID0gb2JqLm9wdGlvbnMudGV4dC50aGVyZUlzQUNvbmZsaWN0V2l0aEFub3RoZXJNZXJnZWRDZWxsO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAodGVzdCkge1xyXG4gICAgICAgICAgICAgICAgYWxlcnQodGVzdCk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAvLyBBZGQgcHJvcGVydHlcclxuICAgICAgICAgICAgICAgIGlmIChjb2xzcGFuID4gMSkge1xyXG4gICAgICAgICAgICAgICAgICAgIG9iai5yZWNvcmRzW2NlbGxbMV1dW2NlbGxbMF1dLnNldEF0dHJpYnV0ZSgnY29sc3BhbicsIGNvbHNwYW4pO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBjb2xzcGFuID0gMTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmIChyb3dzcGFuID4gMSkge1xyXG4gICAgICAgICAgICAgICAgICAgIG9iai5yZWNvcmRzW2NlbGxbMV1dW2NlbGxbMF1dLnNldEF0dHJpYnV0ZSgncm93c3BhbicsIHJvd3NwYW4pO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICByb3dzcGFuID0gMTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIC8vIEtlZXAgbGlua3MgdG8gdGhlIGV4aXN0aW5nIG5vZGVzXHJcbiAgICAgICAgICAgICAgICBvYmoub3B0aW9ucy5tZXJnZUNlbGxzW2NlbGxOYW1lXSA9IFtjb2xzcGFuLCByb3dzcGFuLCBbXV07XHJcbiAgICAgICAgICAgICAgICAvLyBNYXJrIGNlbGwgYXMgbWVyZ2VkXHJcbiAgICAgICAgICAgICAgICBvYmoucmVjb3Jkc1tjZWxsWzFdXVtjZWxsWzBdXS5zZXRBdHRyaWJ1dGUoJ2RhdGEtbWVyZ2VkJywgJ3RydWUnKTtcclxuICAgICAgICAgICAgICAgIC8vIE92ZXJmbG93XHJcbiAgICAgICAgICAgICAgICBvYmoucmVjb3Jkc1tjZWxsWzFdXVtjZWxsWzBdXS5zdHlsZS5vdmVyZmxvdyA9ICdoaWRkZW4nO1xyXG4gICAgICAgICAgICAgICAgLy8gSGlzdG9yeSBkYXRhXHJcbiAgICAgICAgICAgICAgICB2YXIgZGF0YSA9IFtdO1xyXG4gICAgICAgICAgICAgICAgLy8gQWRqdXN0IHRoZSBub2Rlc1xyXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgeSA9IGNlbGxbMV07IHkgPCBjZWxsWzFdICsgcm93c3BhbjsgeSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgeCA9IGNlbGxbMF07IHggPCBjZWxsWzBdICsgY29sc3BhbjsgeCsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghKGNlbGxbMF0gPT0geCAmJiBjZWxsWzFdID09IHkpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhLnB1c2gob2JqLm9wdGlvbnMuZGF0YVt5XVt4XSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmoudXBkYXRlQ2VsbCh4LCB5LCAnJywgdHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmoub3B0aW9ucy5tZXJnZUNlbGxzW2NlbGxOYW1lXVsyXS5wdXNoKG9iai5yZWNvcmRzW3ldW3hdKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9iai5yZWNvcmRzW3ldW3hdLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmoucmVjb3Jkc1t5XVt4XSA9IG9iai5yZWNvcmRzW2NlbGxbMV1dW2NlbGxbMF1dO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgLy8gSW4gdGhlIGluaXRpYWxpemF0aW9uIGlzIG5vdCBuZWNlc3Nhcnkga2VlcCB0aGUgaGlzdG9yeVxyXG4gICAgICAgICAgICAgICAgb2JqLnVwZGF0ZVNlbGVjdGlvbihvYmoucmVjb3Jkc1tjZWxsWzFdXVtjZWxsWzBdXSk7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKCFpZ25vcmVIaXN0b3J5QW5kRXZlbnRzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgb2JqLnNldEhpc3Rvcnkoe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBhY3Rpb246ICdzZXRNZXJnZScsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbHVtbjogY2VsbE5hbWUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbHNwYW46IGNvbHNwYW4sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJvd3NwYW46IHJvd3NwYW4sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGE6IGRhdGEsXHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIG9iai5kaXNwYXRjaCgnb25tZXJnZScsIGVsLCBjZWxsTmFtZSwgY29sc3Bhbiwgcm93c3Bhbik7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIE1lcmdlIGNlbGxzXHJcbiAgICAgICAgICogQHBhcmFtIGNlbGxOYW1lXHJcbiAgICAgICAgICogQHBhcmFtIGNvbHNwYW5cclxuICAgICAgICAgKiBAcGFyYW0gcm93c3BhblxyXG4gICAgICAgICAqIEBwYXJhbSBpZ25vcmVIaXN0b3J5QW5kRXZlbnRzXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgb2JqLmdldE1lcmdlID0gZnVuY3Rpb24gKGNlbGxOYW1lKSB7XHJcbiAgICAgICAgICAgIHZhciBkYXRhID0ge307XHJcbiAgICAgICAgICAgIGlmIChjZWxsTmFtZSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKG9iai5vcHRpb25zLm1lcmdlQ2VsbHNbY2VsbE5hbWVdKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZGF0YSA9IFtvYmoub3B0aW9ucy5tZXJnZUNlbGxzW2NlbGxOYW1lXVswXSwgb2JqLm9wdGlvbnMubWVyZ2VDZWxsc1tjZWxsTmFtZV1bMV1dO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBkYXRhID0gbnVsbDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGlmIChvYmoub3B0aW9ucy5tZXJnZUNlbGxzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIG1lcmdlZENlbGxzID0gb2JqLm9wdGlvbnMubWVyZ2VDZWxscztcclxuICAgICAgICAgICAgICAgICAgICB2YXIga2V5cyA9IE9iamVjdC5rZXlzKG9iai5vcHRpb25zLm1lcmdlQ2VsbHMpO1xyXG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwga2V5cy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRhW2tleXNbaV1dID0gW29iai5vcHRpb25zLm1lcmdlQ2VsbHNba2V5c1tpXV1bMF0sIG9iai5vcHRpb25zLm1lcmdlQ2VsbHNba2V5c1tpXV1bMV1dO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgcmV0dXJuIGRhdGE7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvKipcclxuICAgICAgICAgKiBSZW1vdmUgbWVyZ2UgYnkgY2VsbG5hbWVcclxuICAgICAgICAgKiBAcGFyYW0gY2VsbE5hbWVcclxuICAgICAgICAgKi9cclxuICAgICAgICBvYmoucmVtb3ZlTWVyZ2UgPSBmdW5jdGlvbiAoY2VsbE5hbWUsIGRhdGEsIGtlZXBPcHRpb25zKSB7XHJcbiAgICAgICAgICAgIGlmIChvYmoub3B0aW9ucy5tZXJnZUNlbGxzW2NlbGxOYW1lXSkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGNlbGwgPSBqZXhjZWwuZ2V0SWRGcm9tQ29sdW1uTmFtZShjZWxsTmFtZSwgdHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICBvYmoucmVjb3Jkc1tjZWxsWzFdXVtjZWxsWzBdXS5yZW1vdmVBdHRyaWJ1dGUoJ2NvbHNwYW4nKTtcclxuICAgICAgICAgICAgICAgIG9iai5yZWNvcmRzW2NlbGxbMV1dW2NlbGxbMF1dLnJlbW92ZUF0dHJpYnV0ZSgncm93c3BhbicpO1xyXG4gICAgICAgICAgICAgICAgb2JqLnJlY29yZHNbY2VsbFsxXV1bY2VsbFswXV0ucmVtb3ZlQXR0cmlidXRlKCdkYXRhLW1lcmdlZCcpO1xyXG4gICAgICAgICAgICAgICAgdmFyIGluZm8gPSBvYmoub3B0aW9ucy5tZXJnZUNlbGxzW2NlbGxOYW1lXTtcclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgaW5kZXggPSAwO1xyXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBpbmZvWzFdOyBqKyspIHtcclxuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGluZm9bMF07IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoaiA+IDAgfHwgaSA+IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9iai5yZWNvcmRzW2NlbGxbMV0gKyBqXVtjZWxsWzBdICsgaV0gPSBpbmZvWzJdW2luZGV4XTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9iai5yZWNvcmRzW2NlbGxbMV0gKyBqXVtjZWxsWzBdICsgaV0uc3R5bGUuZGlzcGxheSA9ICcnO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gUmVjb3ZlciBkYXRhXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YSAmJiBkYXRhW2luZGV4XSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9iai51cGRhdGVDZWxsKGNlbGxbMF0gKyBpLCBjZWxsWzFdICsgaiwgZGF0YVtpbmRleF0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5kZXgrKztcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAvLyBVcGRhdGUgc2VsZWN0aW9uXHJcbiAgICAgICAgICAgICAgICBvYmoudXBkYXRlU2VsZWN0aW9uKG9iai5yZWNvcmRzW2NlbGxbMV1dW2NlbGxbMF1dLCBvYmoucmVjb3Jkc1tjZWxsWzFdICsgaiAtIDFdW2NlbGxbMF0gKyBpIC0gMV0pO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmICgha2VlcE9wdGlvbnMpIHtcclxuICAgICAgICAgICAgICAgICAgICBkZWxldGUgKG9iai5vcHRpb25zLm1lcmdlQ2VsbHNbY2VsbE5hbWVdKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogUmVtb3ZlIGFsbCBtZXJnZWQgY2VsbHNcclxuICAgICAgICAgKi9cclxuICAgICAgICBvYmouZGVzdHJveU1lcmdlZCA9IGZ1bmN0aW9uIChrZWVwT3B0aW9ucykge1xyXG4gICAgICAgICAgICAvLyBSZW1vdmUgYW55IG1lcmdlZCBjZWxsc1xyXG4gICAgICAgICAgICBpZiAob2JqLm9wdGlvbnMubWVyZ2VDZWxscykge1xyXG4gICAgICAgICAgICAgICAgdmFyIG1lcmdlZENlbGxzID0gb2JqLm9wdGlvbnMubWVyZ2VDZWxscztcclxuICAgICAgICAgICAgICAgIHZhciBrZXlzID0gT2JqZWN0LmtleXMob2JqLm9wdGlvbnMubWVyZ2VDZWxscyk7XHJcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGtleXMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgICAgICBvYmoucmVtb3ZlTWVyZ2Uoa2V5c1tpXSwgbnVsbCwga2VlcE9wdGlvbnMpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvKipcclxuICAgICAgICAgKiBJcyBjb2x1bW4gbWVyZ2VkXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgb2JqLmlzQ29sTWVyZ2VkID0gZnVuY3Rpb24gKHgsIGluc2VydEJlZm9yZSkge1xyXG4gICAgICAgICAgICB2YXIgY29scyA9IFtdO1xyXG4gICAgICAgICAgICAvLyBSZW1vdmUgYW55IG1lcmdlZCBjZWxsc1xyXG4gICAgICAgICAgICBpZiAob2JqLm9wdGlvbnMubWVyZ2VDZWxscykge1xyXG4gICAgICAgICAgICAgICAgdmFyIGtleXMgPSBPYmplY3Qua2V5cyhvYmoub3B0aW9ucy5tZXJnZUNlbGxzKTtcclxuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwga2V5cy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBpbmZvID0gamV4Y2VsLmdldElkRnJvbUNvbHVtbk5hbWUoa2V5c1tpXSwgdHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGNvbHNwYW4gPSBvYmoub3B0aW9ucy5tZXJnZUNlbGxzW2tleXNbaV1dWzBdO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciB4MSA9IGluZm9bMF07XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHgyID0gaW5mb1swXSArIChjb2xzcGFuID4gMSA/IGNvbHNwYW4gLSAxIDogMCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChpbnNlcnRCZWZvcmUgPT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoKHgxIDw9IHggJiYgeDIgPj0geCkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbHMucHVzaChrZXlzW2ldKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpbnNlcnRCZWZvcmUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgoeDEgPCB4ICYmIHgyID49IHgpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29scy5wdXNoKGtleXNbaV0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCh4MSA8PSB4ICYmIHgyID4geCkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2xzLnB1c2goa2V5c1tpXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHJldHVybiBjb2xzO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogSXMgcm93cyBtZXJnZWRcclxuICAgICAgICAgKi9cclxuICAgICAgICBvYmouaXNSb3dNZXJnZWQgPSBmdW5jdGlvbiAoeSwgaW5zZXJ0QmVmb3JlKSB7XHJcbiAgICAgICAgICAgIHZhciByb3dzID0gW107XHJcbiAgICAgICAgICAgIC8vIFJlbW92ZSBhbnkgbWVyZ2VkIGNlbGxzXHJcbiAgICAgICAgICAgIGlmIChvYmoub3B0aW9ucy5tZXJnZUNlbGxzKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIga2V5cyA9IE9iamVjdC5rZXlzKG9iai5vcHRpb25zLm1lcmdlQ2VsbHMpO1xyXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBrZXlzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGluZm8gPSBqZXhjZWwuZ2V0SWRGcm9tQ29sdW1uTmFtZShrZXlzW2ldLCB0cnVlKTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgcm93c3BhbiA9IG9iai5vcHRpb25zLm1lcmdlQ2VsbHNba2V5c1tpXV1bMV07XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHkxID0gaW5mb1sxXTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgeTIgPSBpbmZvWzFdICsgKHJvd3NwYW4gPiAxID8gcm93c3BhbiAtIDEgOiAwKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGluc2VydEJlZm9yZSA9PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgoeTEgPD0geSAmJiB5MiA+PSB5KSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcm93cy5wdXNoKGtleXNbaV0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGluc2VydEJlZm9yZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCh5MSA8IHkgJiYgeTIgPj0geSkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByb3dzLnB1c2goa2V5c1tpXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoKHkxIDw9IHkgJiYgeTIgPiB5KSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJvd3MucHVzaChrZXlzW2ldKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgcmV0dXJuIHJvd3M7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvKipcclxuICAgICAgICAgKiBPcGVuIHRoZSBjb2x1bW4gZmlsdGVyXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgb2JqLm9wZW5GaWx0ZXIgPSBmdW5jdGlvbiAoY29sdW1uSWQpIHtcclxuICAgICAgICAgICAgaWYgKCFvYmoub3B0aW9ucy5maWx0ZXJzKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnSkVYQ0VMOiBmaWx0ZXJzIG5vdCBlbmFibGVkLicpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgLy8gTWFrZSBzdXJlIGlzIGludGVnZXJcclxuICAgICAgICAgICAgICAgIGNvbHVtbklkID0gcGFyc2VJbnQoY29sdW1uSWQpO1xyXG4gICAgICAgICAgICAgICAgLy8gUmVzZXQgc2VsZWN0aW9uXHJcbiAgICAgICAgICAgICAgICBvYmoucmVzZXRTZWxlY3Rpb24oKTtcclxuICAgICAgICAgICAgICAgIC8vIExvYWQgb3B0aW9uc1xyXG4gICAgICAgICAgICAgICAgdmFyIG9wdGlvbnNGaWx0ZXJlZCA9IFtdO1xyXG4gICAgICAgICAgICAgICAgaWYgKG9iai5vcHRpb25zLmNvbHVtbnNbY29sdW1uSWRdLnR5cGUgPT0gJ2NoZWNrYm94Jykge1xyXG4gICAgICAgICAgICAgICAgICAgIG9wdGlvbnNGaWx0ZXJlZC5wdXNoKHtpZDogJ3RydWUnLCBuYW1lOiAnVHJ1ZSd9KTtcclxuICAgICAgICAgICAgICAgICAgICBvcHRpb25zRmlsdGVyZWQucHVzaCh7aWQ6ICdmYWxzZScsIG5hbWU6ICdGYWxzZSd9KTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIG9wdGlvbnMgPSBbXTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgaGFzQmxhbmtzID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBvYmoub3B0aW9ucy5kYXRhLmxlbmd0aDsgaisrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBrID0gb2JqLm9wdGlvbnMuZGF0YVtqXVtjb2x1bW5JZF07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB2ID0gb2JqLnJlY29yZHNbal1bY29sdW1uSWRdLmlubmVySFRNTDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGsgJiYgdikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9uc1trXSA9IHY7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgaGFzQmxhbmtzID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB2YXIga2V5cyA9IE9iamVjdC5rZXlzKG9wdGlvbnMpO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBvcHRpb25zRmlsdGVyZWQgPSBbXTtcclxuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IGtleXMubGVuZ3RoOyBqKyspIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9uc0ZpbHRlcmVkLnB1c2goe2lkOiBrZXlzW2pdLCBuYW1lOiBvcHRpb25zW2tleXNbal1dfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIC8vIEhhcyBibGFuayBvcHRpb25zXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGhhc0JsYW5rcykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zRmlsdGVyZWQucHVzaCh7dmFsdWU6ICcnLCBpZDogJycsIG5hbWU6ICcoQmxhbmtzKSd9KTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gQ3JlYXRlIGRyb3Bkb3duXHJcbiAgICAgICAgICAgICAgICB2YXIgZGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcbiAgICAgICAgICAgICAgICBvYmouZmlsdGVyLmNoaWxkcmVuW2NvbHVtbklkICsgMV0uaW5uZXJIVE1MID0gJyc7XHJcbiAgICAgICAgICAgICAgICBvYmouZmlsdGVyLmNoaWxkcmVuW2NvbHVtbklkICsgMV0uYXBwZW5kQ2hpbGQoZGl2KTtcclxuICAgICAgICAgICAgICAgIG9iai5maWx0ZXIuY2hpbGRyZW5bY29sdW1uSWQgKyAxXS5zdHlsZS5wYWRkaW5nTGVmdCA9ICcwcHgnO1xyXG4gICAgICAgICAgICAgICAgb2JqLmZpbHRlci5jaGlsZHJlbltjb2x1bW5JZCArIDFdLnN0eWxlLnBhZGRpbmdSaWdodCA9ICcwcHgnO1xyXG4gICAgICAgICAgICAgICAgb2JqLmZpbHRlci5jaGlsZHJlbltjb2x1bW5JZCArIDFdLnN0eWxlLm92ZXJmbG93ID0gJ2luaXRpYWwnO1xyXG5cclxuICAgICAgICAgICAgICAgIHZhciBvcHQgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZGF0YTogb3B0aW9uc0ZpbHRlcmVkLFxyXG4gICAgICAgICAgICAgICAgICAgIG11bHRpcGxlOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgICAgIGF1dG9jb21wbGV0ZTogdHJ1ZSxcclxuICAgICAgICAgICAgICAgICAgICBvcGVuZWQ6IHRydWUsXHJcbiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IG9iai5maWx0ZXJzW2NvbHVtbklkXSAhPT0gdW5kZWZpbmVkID8gb2JqLmZpbHRlcnNbY29sdW1uSWRdIDogbnVsbCxcclxuICAgICAgICAgICAgICAgICAgICB3aWR0aDogJzEwMCUnLFxyXG4gICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uOiAob2JqLm9wdGlvbnMudGFibGVPdmVyZmxvdyA9PSB0cnVlIHx8IG9iai5vcHRpb25zLmZ1bGxzY3JlZW4gPT0gdHJ1ZSkgPyB0cnVlIDogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICAgICAgb25jbG9zZTogZnVuY3Rpb24gKG8pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgb2JqLnJlc2V0RmlsdGVycygpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBvYmouZmlsdGVyc1tjb2x1bW5JZF0gPSBvLmRyb3Bkb3duLmdldFZhbHVlKHRydWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBvYmouZmlsdGVyLmNoaWxkcmVuW2NvbHVtbklkICsgMV0uaW5uZXJIVE1MID0gby5kcm9wZG93bi5nZXRUZXh0KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9iai5maWx0ZXIuY2hpbGRyZW5bY29sdW1uSWQgKyAxXS5zdHlsZS5wYWRkaW5nTGVmdCA9ICcnO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBvYmouZmlsdGVyLmNoaWxkcmVuW2NvbHVtbklkICsgMV0uc3R5bGUucGFkZGluZ1JpZ2h0ID0gJyc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9iai5maWx0ZXIuY2hpbGRyZW5bY29sdW1uSWQgKyAxXS5zdHlsZS5vdmVyZmxvdyA9ICcnO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBvYmouY2xvc2VGaWx0ZXIoY29sdW1uSWQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBvYmoucmVmcmVzaFNlbGVjdGlvbigpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gRHluYW1pYyBkcm9wZG93blxyXG4gICAgICAgICAgICAgICAgalN1aXRlcy5kcm9wZG93bihkaXYsIG9wdCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIG9iai5yZXNldEZpbHRlcnMgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIGlmIChvYmoub3B0aW9ucy5maWx0ZXJzKSB7XHJcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG9iai5maWx0ZXIuY2hpbGRyZW4ubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgICAgICBvYmouZmlsdGVyLmNoaWxkcmVuW2ldLmlubmVySFRNTCA9ICcmbmJzcDsnO1xyXG4gICAgICAgICAgICAgICAgICAgIG9iai5maWx0ZXJzW2ldID0gbnVsbDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgb2JqLmNsb3NlRmlsdGVyID0gZnVuY3Rpb24gKGNvbHVtbklkKSB7XHJcbiAgICAgICAgICAgIGlmICghY29sdW1uSWQpIHtcclxuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgb2JqLmZpbHRlci5jaGlsZHJlbi5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChvYmouZmlsdGVyc1tpXSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb2x1bW5JZCA9IGk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBTZWFyY2ggZmlsdGVyXHJcbiAgICAgICAgICAgIHZhciBzZWFyY2ggPSBmdW5jdGlvbiAocXVlcnksIHgsIHkpIHtcclxuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcXVlcnkubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoKHF1ZXJ5W2ldID09ICcnICYmIC8vIEJsYW5rIG1hdGNoaW5nXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICgob2JqLm9wdGlvbnMuZGF0YVt5XVt4XSA9PT0gZmFsc2UpIHx8IC8vIFVuY2hlY2tlZCBjaGVja2JveFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgKCcnICsgb2JqLm9wdGlvbnMuZGF0YVt5XVt4XSkgPT0gJycpKSB8fCAvLyBCbGFuayBub24tY2hlY2tib3ggdmFsdWVcclxuICAgICAgICAgICAgICAgICAgICAgICAgKChxdWVyeVtpXSAhPSAnJyAmJiAvLyBOb3JtYWwgbm9uLWJsYW5rIGZpbHRlcmluZ1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgKCgnJyArIG9iai5vcHRpb25zLmRhdGFbeV1beF0pLnNlYXJjaChxdWVyeVtpXSkgPj0gMCB8fFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICgnJyArIG9iai5yZWNvcmRzW3ldW3hdLmlubmVySFRNTCkuc2VhcmNoKHF1ZXJ5W2ldKSA+PSAwKSkpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgdmFyIHF1ZXJ5ID0gb2JqLmZpbHRlcnNbY29sdW1uSWRdO1xyXG4gICAgICAgICAgICBvYmoucmVzdWx0cyA9IFtdO1xyXG4gICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IG9iai5vcHRpb25zLmRhdGEubGVuZ3RoOyBqKyspIHtcclxuICAgICAgICAgICAgICAgIGlmIChzZWFyY2gocXVlcnksIGNvbHVtbklkLCBqKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIG9iai5yZXN1bHRzLnB1c2goaik7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKCFvYmoucmVzdWx0cy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgIG9iai5yZXN1bHRzID0gbnVsbDtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgb2JqLnVwZGF0ZVJlc3VsdCgpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogT3BlbiB0aGUgZWRpdG9yXHJcbiAgICAgICAgICpcclxuICAgICAgICAgKiBAcGFyYW0gb2JqZWN0IGNlbGxcclxuICAgICAgICAgKiBAcmV0dXJuIHZvaWRcclxuICAgICAgICAgKi9cclxuICAgICAgICBvYmoub3BlbkVkaXRvciA9IGZ1bmN0aW9uIChjZWxsLCBlbXB0eSwgZSkge1xyXG4gICAgICAgICAgICAvLyBHZXQgY2VsbCBwb3NpdGlvblxyXG4gICAgICAgICAgICB2YXIgeSA9IGNlbGwuZ2V0QXR0cmlidXRlKCdkYXRhLXknKTtcclxuICAgICAgICAgICAgdmFyIHggPSBjZWxsLmdldEF0dHJpYnV0ZSgnZGF0YS14Jyk7XHJcblxyXG4gICAgICAgICAgICAvLyBPbiBlZGl0aW9uIHN0YXJ0XHJcbiAgICAgICAgICAgIG9iai5kaXNwYXRjaCgnb25lZGl0aW9uc3RhcnQnLCBlbCwgY2VsbCwgeCwgeSk7XHJcblxyXG4gICAgICAgICAgICAvLyBPdmVyZmxvd1xyXG4gICAgICAgICAgICBpZiAoeCA+IDApIHtcclxuICAgICAgICAgICAgICAgIG9iai5yZWNvcmRzW3ldW3ggLSAxXS5zdHlsZS5vdmVyZmxvdyA9ICdoaWRkZW4nO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBDcmVhdGUgZWRpdG9yXHJcbiAgICAgICAgICAgIHZhciBjcmVhdGVFZGl0b3IgPSBmdW5jdGlvbiAodHlwZSkge1xyXG4gICAgICAgICAgICAgICAgLy8gQ2VsbCBpbmZvcm1hdGlvblxyXG4gICAgICAgICAgICAgICAgdmFyIGluZm8gPSBjZWxsLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIENyZWF0ZSBkcm9wZG93blxyXG4gICAgICAgICAgICAgICAgdmFyIGVkaXRvciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQodHlwZSk7XHJcbiAgICAgICAgICAgICAgICBlZGl0b3Iuc3R5bGUud2lkdGggPSAoaW5mby53aWR0aCkgKyAncHgnO1xyXG4gICAgICAgICAgICAgICAgZWRpdG9yLnN0eWxlLmhlaWdodCA9IChpbmZvLmhlaWdodCAtIDIpICsgJ3B4JztcclxuICAgICAgICAgICAgICAgIGVkaXRvci5zdHlsZS5taW5IZWlnaHQgPSAoaW5mby5oZWlnaHQgLSAyKSArICdweCc7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gRWRpdCBjZWxsXHJcbiAgICAgICAgICAgICAgICBjZWxsLmNsYXNzTGlzdC5hZGQoJ2VkaXRvcicpO1xyXG4gICAgICAgICAgICAgICAgY2VsbC5pbm5lckhUTUwgPSAnJztcclxuICAgICAgICAgICAgICAgIGNlbGwuYXBwZW5kQ2hpbGQoZWRpdG9yKTtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyBPbiBlZGl0aW9uIHN0YXJ0XHJcbiAgICAgICAgICAgICAgICBvYmouZGlzcGF0Y2goJ29uY3JlYXRlZWRpdG9yJywgZWwsIGNlbGwsIHgsIHksIGVkaXRvcik7XHJcblxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGVkaXRvcjtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gUmVhZG9ubHlcclxuICAgICAgICAgICAgaWYgKGNlbGwuY2xhc3NMaXN0LmNvbnRhaW5zKCdyZWFkb25seScpID09IHRydWUpIHtcclxuICAgICAgICAgICAgICAgIC8vIERvIG5vdGhpbmdcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIC8vIEhvbGRlclxyXG4gICAgICAgICAgICAgICAgb2JqLmVkaXRpb24gPSBbb2JqLnJlY29yZHNbeV1beF0sIG9iai5yZWNvcmRzW3ldW3hdLmlubmVySFRNTCwgeCwgeV07XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gSWYgdGhlcmUgaXMgYSBjdXN0b20gZWRpdG9yIGZvciBpdFxyXG4gICAgICAgICAgICAgICAgaWYgKG9iai5vcHRpb25zLmNvbHVtbnNbeF0uZWRpdG9yKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gQ3VzdG9tIGVkaXRvcnNcclxuICAgICAgICAgICAgICAgICAgICBvYmoub3B0aW9ucy5jb2x1bW5zW3hdLmVkaXRvci5vcGVuRWRpdG9yKGNlbGwsIGVsLCBvYmopO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBOYXRpdmUgZnVuY3Rpb25zXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKG9iai5vcHRpb25zLmNvbHVtbnNbeF0udHlwZSA9PSAnaGlkZGVuJykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBEbyBub3RoaW5nXHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChvYmoub3B0aW9ucy5jb2x1bW5zW3hdLnR5cGUgPT0gJ2NoZWNrYm94JyB8fCBvYmoub3B0aW9ucy5jb2x1bW5zW3hdLnR5cGUgPT0gJ3JhZGlvJykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBHZXQgdmFsdWVcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHZhbHVlID0gY2VsbC5jaGlsZHJlblswXS5jaGVja2VkID8gZmFsc2UgOiB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBUb29nbGUgdmFsdWVcclxuICAgICAgICAgICAgICAgICAgICAgICAgb2JqLnNldFZhbHVlKGNlbGwsIHZhbHVlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gRG8gbm90IGtlZXAgZWRpdGlvbiBvcGVuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9iai5lZGl0aW9uID0gbnVsbDtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKG9iai5vcHRpb25zLmNvbHVtbnNbeF0udHlwZSA9PSAnZHJvcGRvd24nIHx8IG9iai5vcHRpb25zLmNvbHVtbnNbeF0udHlwZSA9PSAnYXV0b2NvbXBsZXRlJykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBHZXQgY3VycmVudCB2YWx1ZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgdmFsdWUgPSBvYmoub3B0aW9ucy5kYXRhW3ldW3hdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAob2JqLm9wdGlvbnMuY29sdW1uc1t4XS5tdWx0aXBsZSAmJiAhQXJyYXkuaXNBcnJheSh2YWx1ZSkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlID0gdmFsdWUuc3BsaXQoJzsnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gQ3JlYXRlIGRyb3Bkb3duXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgKG9iai5vcHRpb25zLmNvbHVtbnNbeF0uZmlsdGVyKSA9PSAnZnVuY3Rpb24nKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgc291cmNlID0gb2JqLm9wdGlvbnMuY29sdW1uc1t4XS5maWx0ZXIoZWwsIGNlbGwsIHgsIHksIG9iaik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgc291cmNlID0gb2JqLm9wdGlvbnMuY29sdW1uc1t4XS5zb3VyY2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIERvIG5vdCBjaGFuZ2UgdGhlIG9yaWdpbmFsIHNvdXJjZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgZGF0YSA9IFtdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IHNvdXJjZS5sZW5ndGg7IGorKykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YS5wdXNoKHNvdXJjZVtqXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIENyZWF0ZSBlZGl0b3JcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGVkaXRvciA9IGNyZWF0ZUVkaXRvcignZGl2Jyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBvcHRpb25zID0ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YTogZGF0YSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG11bHRpcGxlOiBvYmoub3B0aW9ucy5jb2x1bW5zW3hdLm11bHRpcGxlID8gdHJ1ZSA6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYXV0b2NvbXBsZXRlOiBvYmoub3B0aW9ucy5jb2x1bW5zW3hdLmF1dG9jb21wbGV0ZSB8fCBvYmoub3B0aW9ucy5jb2x1bW5zW3hdLnR5cGUgPT0gJ2F1dG9jb21wbGV0ZScgPyB0cnVlIDogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcGVuZWQ6IHRydWUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdmFsdWUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aWR0aDogJzEwMCUnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiBlZGl0b3Iuc3R5bGUubWluSGVpZ2h0LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9zaXRpb246IChvYmoub3B0aW9ucy50YWJsZU92ZXJmbG93ID09IHRydWUgfHwgb2JqLm9wdGlvbnMuZnVsbHNjcmVlbiA9PSB0cnVlKSA/IHRydWUgOiBmYWxzZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uY2xvc2U6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmouY2xvc2VFZGl0b3IoY2VsbCwgdHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChvYmoub3B0aW9ucy5jb2x1bW5zW3hdLm9wdGlvbnMgJiYgb2JqLm9wdGlvbnMuY29sdW1uc1t4XS5vcHRpb25zLnR5cGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMudHlwZSA9IG9iai5vcHRpb25zLmNvbHVtbnNbeF0ub3B0aW9ucy50eXBlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBqU3VpdGVzLmRyb3Bkb3duKGVkaXRvciwgb3B0aW9ucyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChvYmoub3B0aW9ucy5jb2x1bW5zW3hdLnR5cGUgPT0gJ2NhbGVuZGFyJyB8fCBvYmoub3B0aW9ucy5jb2x1bW5zW3hdLnR5cGUgPT0gJ2NvbG9yJykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBWYWx1ZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgdmFsdWUgPSBvYmoub3B0aW9ucy5kYXRhW3ldW3hdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBDcmVhdGUgZWRpdG9yXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBlZGl0b3IgPSBjcmVhdGVFZGl0b3IoJ2lucHV0Jyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVkaXRvci52YWx1ZSA9IHZhbHVlO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG9iai5vcHRpb25zLnRhYmxlT3ZlcmZsb3cgPT0gdHJ1ZSB8fCBvYmoub3B0aW9ucy5mdWxsc2NyZWVuID09IHRydWUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9iai5vcHRpb25zLmNvbHVtbnNbeF0ub3B0aW9ucy5wb3NpdGlvbiA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgb2JqLm9wdGlvbnMuY29sdW1uc1t4XS5vcHRpb25zLnZhbHVlID0gb2JqLm9wdGlvbnMuZGF0YVt5XVt4XTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgb2JqLm9wdGlvbnMuY29sdW1uc1t4XS5vcHRpb25zLm9wZW5lZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9iai5vcHRpb25zLmNvbHVtbnNbeF0ub3B0aW9ucy5vbmNsb3NlID0gZnVuY3Rpb24gKGVsLCB2YWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb2JqLmNsb3NlRWRpdG9yKGNlbGwsIHRydWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEN1cnJlbnQgdmFsdWVcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG9iai5vcHRpb25zLmNvbHVtbnNbeF0udHlwZSA9PSAnY29sb3InKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBqU3VpdGVzLmNvbG9yKGVkaXRvciwgb2JqLm9wdGlvbnMuY29sdW1uc1t4XS5vcHRpb25zKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGpTdWl0ZXMuY2FsZW5kYXIoZWRpdG9yLCBvYmoub3B0aW9ucy5jb2x1bW5zW3hdLm9wdGlvbnMpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEZvY3VzIG9uIGVkaXRvclxyXG4gICAgICAgICAgICAgICAgICAgICAgICBlZGl0b3IuZm9jdXMoKTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKG9iai5vcHRpb25zLmNvbHVtbnNbeF0udHlwZSA9PSAnaHRtbCcpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHZhbHVlID0gb2JqLm9wdGlvbnMuZGF0YVt5XVt4XTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gQ3JlYXRlIGVkaXRvclxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgZWRpdG9yID0gY3JlYXRlRWRpdG9yKCdkaXYnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZWRpdG9yLnN0eWxlLnBvc2l0aW9uID0gJ3JlbGF0aXZlJztcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGRpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBkaXYuY2xhc3NMaXN0LmFkZCgnamV4Y2VsX3JpY2h0ZXh0Jyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVkaXRvci5hcHBlbmRDaGlsZChkaXYpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBqU3VpdGVzLmVkaXRvcihkaXYsIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvY3VzOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHZhbHVlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHJlY3QgPSBjZWxsLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgcmVjdENvbnRlbnQgPSBkaXYuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh3aW5kb3cuaW5uZXJIZWlnaHQgPCByZWN0LmJvdHRvbSArIHJlY3RDb250ZW50LmhlaWdodCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGl2LnN0eWxlLnRvcCA9IChyZWN0LnRvcCAtIChyZWN0Q29udGVudC5oZWlnaHQgKyAyKSkgKyAncHgnO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGl2LnN0eWxlLnRvcCA9IChyZWN0LnRvcCkgKyAncHgnO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChvYmoub3B0aW9ucy5jb2x1bW5zW3hdLnR5cGUgPT0gJ2ltYWdlJykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBWYWx1ZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgaW1nID0gY2VsbC5jaGlsZHJlblswXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gQ3JlYXRlIGVkaXRvclxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgZWRpdG9yID0gY3JlYXRlRWRpdG9yKCdkaXYnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZWRpdG9yLnN0eWxlLnBvc2l0aW9uID0gJ3JlbGF0aXZlJztcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGRpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBkaXYuY2xhc3NMaXN0LmFkZCgnamNsb3NlJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpbWcgJiYgaW1nLnNyYykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGl2LmFwcGVuZENoaWxkKGltZyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgZWRpdG9yLmFwcGVuZENoaWxkKGRpdik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGpTdWl0ZXMuaW1hZ2UoZGl2LCBvYmoub3B0aW9ucy5pbWFnZU9wdGlvbnMpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgcmVjdCA9IGNlbGwuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciByZWN0Q29udGVudCA9IGRpdi5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHdpbmRvdy5pbm5lckhlaWdodCA8IHJlY3QuYm90dG9tICsgcmVjdENvbnRlbnQuaGVpZ2h0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkaXYuc3R5bGUudG9wID0gKHJlY3QudG9wIC0gKHJlY3RDb250ZW50LmhlaWdodCArIDIpKSArICdweCc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkaXYuc3R5bGUudG9wID0gKHJlY3QudG9wKSArICdweCc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBWYWx1ZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgdmFsdWUgPSBlbXB0eSA9PSB0cnVlID8gJycgOiBvYmoub3B0aW9ucy5kYXRhW3ldW3hdO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gQmFzaWMgZWRpdG9yXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChvYmoub3B0aW9ucy5jb2x1bW5zW3hdLndvcmRXcmFwICE9IGZhbHNlICYmIChvYmoub3B0aW9ucy53b3JkV3JhcCA9PSB0cnVlIHx8IG9iai5vcHRpb25zLmNvbHVtbnNbeF0ud29yZFdyYXAgPT0gdHJ1ZSkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBlZGl0b3IgPSBjcmVhdGVFZGl0b3IoJ3RleHRhcmVhJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZWRpdG9yID0gY3JlYXRlRWRpdG9yKCdpbnB1dCcpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gTWFza1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG9iai5vcHRpb25zLmNvbHVtbnNbeF0ubWFzaykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVkaXRvci5zZXRBdHRyaWJ1dGUoJ2RhdGEtbWFzaycsIG9iai5vcHRpb25zLmNvbHVtbnNbeF0ubWFzayk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVkaXRvci5vbmJsdXIgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmouY2xvc2VFZGl0b3IoY2VsbCwgdHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVkaXRvci5mb2N1cygpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBlZGl0b3IudmFsdWUgPSB2YWx1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZWRpdG9yLnNjcm9sbExlZnQgPSBlZGl0b3Iuc2Nyb2xsV2lkdGg7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvKipcclxuICAgICAgICAgKiBDbG9zZSB0aGUgZWRpdG9yIGFuZCBzYXZlIHRoZSBpbmZvcm1hdGlvblxyXG4gICAgICAgICAqXHJcbiAgICAgICAgICogQHBhcmFtIG9iamVjdCBjZWxsXHJcbiAgICAgICAgICogQHBhcmFtIGJvb2xlYW4gc2F2ZVxyXG4gICAgICAgICAqIEByZXR1cm4gdm9pZFxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIG9iai5jbG9zZUVkaXRvciA9IGZ1bmN0aW9uIChjZWxsLCBzYXZlKSB7XHJcbiAgICAgICAgICAgIHZhciB4ID0gcGFyc2VJbnQoY2VsbC5nZXRBdHRyaWJ1dGUoJ2RhdGEteCcpKTtcclxuICAgICAgICAgICAgdmFyIHkgPSBwYXJzZUludChjZWxsLmdldEF0dHJpYnV0ZSgnZGF0YS15JykpO1xyXG4gICAgICAgICAgICAvLyBHZXQgY2VsbCBwcm9wZXJ0aWVzXHJcbiAgICAgICAgICAgIGlmIChzYXZlID09IHRydWUpIHtcclxuICAgICAgICAgICAgICAgIC8vIElmIGN1c3RvbSBlZGl0b3JcclxuICAgICAgICAgICAgICAgIGlmIChvYmoub3B0aW9ucy5jb2x1bW5zW3hdLmVkaXRvcikge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIEN1c3RvbSBlZGl0b3JcclxuICAgICAgICAgICAgICAgICAgICB2YXIgdmFsdWUgPSBvYmoub3B0aW9ucy5jb2x1bW5zW3hdLmVkaXRvci5jbG9zZUVkaXRvcihjZWxsLCBzYXZlKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gTmF0aXZlIGZ1bmN0aW9uc1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChvYmoub3B0aW9ucy5jb2x1bW5zW3hdLnR5cGUgPT0gJ2NoZWNrYm94JyB8fCBvYmoub3B0aW9ucy5jb2x1bW5zW3hdLnR5cGUgPT0gJ3JhZGlvJyB8fCBvYmoub3B0aW9ucy5jb2x1bW5zW3hdLnR5cGUgPT0gJ2hpZGRlbicpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gRG8gbm90aGluZ1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAob2JqLm9wdGlvbnMuY29sdW1uc1t4XS50eXBlID09ICdkcm9wZG93bicgfHwgb2JqLm9wdGlvbnMuY29sdW1uc1t4XS50eXBlID09ICdhdXRvY29tcGxldGUnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB2YWx1ZSA9IGNlbGwuY2hpbGRyZW5bMF0uZHJvcGRvd24uY2xvc2UodHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChvYmoub3B0aW9ucy5jb2x1bW5zW3hdLnR5cGUgPT0gJ2NhbGVuZGFyJykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgdmFsdWUgPSBjZWxsLmNoaWxkcmVuWzBdLmNhbGVuZGFyLmNsb3NlKHRydWUsIGZhbHNlKTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKG9iai5vcHRpb25zLmNvbHVtbnNbeF0udHlwZSA9PSAnY29sb3InKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB2YWx1ZSA9IGNlbGwuY2hpbGRyZW5bMF0uY29sb3IuY2xvc2UodHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChvYmoub3B0aW9ucy5jb2x1bW5zW3hdLnR5cGUgPT0gJ2h0bWwnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB2YWx1ZSA9IGNlbGwuY2hpbGRyZW5bMF0uY2hpbGRyZW5bMF0uZWRpdG9yLmdldERhdGEoKTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKG9iai5vcHRpb25zLmNvbHVtbnNbeF0udHlwZSA9PSAnaW1hZ2UnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpbWcgPSBjZWxsLmNoaWxkcmVuWzBdLmNoaWxkcmVuWzBdLmNoaWxkcmVuWzBdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgdmFsdWUgPSBpbWcgJiYgaW1nLnRhZ05hbWUgPT0gJ0lNRycgPyBpbWcuc3JjIDogJyc7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChvYmoub3B0aW9ucy5jb2x1bW5zW3hdLnR5cGUgPT0gJ251bWVyaWMnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB2YWx1ZSA9IGNlbGwuY2hpbGRyZW5bMF0udmFsdWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZS5zdWJzdHIoMCwgMSkgIT0gJz0nKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodmFsdWUgPT0gJycpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IG9iai5vcHRpb25zLmNvbHVtbnNbeF0uYWxsb3dFbXB0eSA/ICcnIDogMDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjZWxsLmNoaWxkcmVuWzBdLm9uYmx1ciA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHZhbHVlID0gY2VsbC5jaGlsZHJlblswXS52YWx1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2VsbC5jaGlsZHJlblswXS5vbmJsdXIgPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAvLyBJZ25vcmUgY2hhbmdlcyBpZiB0aGUgdmFsdWUgaXMgdGhlIHNhbWVcclxuICAgICAgICAgICAgICAgIGlmIChvYmoub3B0aW9ucy5kYXRhW3ldW3hdID09PSB2YWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIGNlbGwuaW5uZXJIVE1MID0gb2JqLmVkaXRpb25bMV07IC8vVGhhbmhcclxuICAgICAgICAgICAgICAgICAgICBpZiAob2JqLmVkaXRpb24pIGNlbGwuaW5uZXJIVE1MID0gb2JqLmVkaXRpb25bMV07XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIG9iai5zZXRWYWx1ZShjZWxsLCB2YWx1ZSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBpZiAob2JqLm9wdGlvbnMuY29sdW1uc1t4XS5lZGl0b3IpIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBDdXN0b20gZWRpdG9yXHJcbiAgICAgICAgICAgICAgICAgICAgb2JqLm9wdGlvbnMuY29sdW1uc1t4XS5lZGl0b3IuY2xvc2VFZGl0b3IoY2VsbCwgc2F2ZSk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChvYmoub3B0aW9ucy5jb2x1bW5zW3hdLnR5cGUgPT0gJ2Ryb3Bkb3duJyB8fCBvYmoub3B0aW9ucy5jb2x1bW5zW3hdLnR5cGUgPT0gJ2F1dG9jb21wbGV0ZScpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2VsbC5jaGlsZHJlblswXS5kcm9wZG93bi5jbG9zZSh0cnVlKTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKG9iai5vcHRpb25zLmNvbHVtbnNbeF0udHlwZSA9PSAnY2FsZW5kYXInKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNlbGwuY2hpbGRyZW5bMF0uY2FsZW5kYXIuY2xvc2UodHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChvYmoub3B0aW9ucy5jb2x1bW5zW3hdLnR5cGUgPT0gJ2NvbG9yJykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjZWxsLmNoaWxkcmVuWzBdLmNvbG9yLmNsb3NlKHRydWUpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNlbGwuY2hpbGRyZW5bMF0ub25ibHVyID0gbnVsbDtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gUmVzdG9yZSB2YWx1ZVxyXG4gICAgICAgICAgICAgICAgY2VsbC5pbm5lckhUTUwgPSBvYmouZWRpdGlvbiAmJiBvYmouZWRpdGlvblsxXSA/IG9iai5lZGl0aW9uWzFdIDogJyc7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIE9uIGVkaXRpb24gZW5kXHJcbiAgICAgICAgICAgIG9iai5kaXNwYXRjaCgnb25lZGl0aW9uZW5kJywgZWwsIGNlbGwsIHgsIHksIHZhbHVlLCBzYXZlKTtcclxuXHJcbiAgICAgICAgICAgIC8vIFJlbW92ZSBlZGl0b3IgY2xhc3NcclxuICAgICAgICAgICAgY2VsbC5jbGFzc0xpc3QucmVtb3ZlKCdlZGl0b3InKTtcclxuXHJcbiAgICAgICAgICAgIC8vIEZpbmlzaCBlZGl0aW9uXHJcbiAgICAgICAgICAgIG9iai5lZGl0aW9uID0gbnVsbDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIEdldCB0aGUgY2VsbCBvYmplY3RcclxuICAgICAgICAgKlxyXG4gICAgICAgICAqIEBwYXJhbSBvYmplY3QgY2VsbFxyXG4gICAgICAgICAqIEByZXR1cm4gc3RyaW5nIHZhbHVlXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgb2JqLmdldENlbGwgPSBmdW5jdGlvbiAoY2VsbCkge1xyXG4gICAgICAgICAgICAvLyBDb252ZXJ0IGluIGNhc2UgbmFtZSBpcyBleGNlbCBsaWtlZCBleC4gQTEwLCBCQjkyXHJcbiAgICAgICAgICAgIGNlbGwgPSBqZXhjZWwuZ2V0SWRGcm9tQ29sdW1uTmFtZShjZWxsLCB0cnVlKTtcclxuICAgICAgICAgICAgdmFyIHggPSBjZWxsWzBdO1xyXG4gICAgICAgICAgICB2YXIgeSA9IGNlbGxbMV07XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gb2JqLnJlY29yZHNbeV1beF07XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvKipcclxuICAgICAgICAgKiBHZXQgdGhlIGNlbGwgb2JqZWN0IGZyb20gY29vcmRzXHJcbiAgICAgICAgICpcclxuICAgICAgICAgKiBAcGFyYW0gb2JqZWN0IGNlbGxcclxuICAgICAgICAgKiBAcmV0dXJuIHN0cmluZyB2YWx1ZVxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIG9iai5nZXRDZWxsRnJvbUNvb3JkcyA9IGZ1bmN0aW9uICh4LCB5KSB7XHJcbiAgICAgICAgICAgIHJldHVybiBvYmoucmVjb3Jkc1t5XVt4XTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIEdldCBsYWJlbFxyXG4gICAgICAgICAqXHJcbiAgICAgICAgICogQHBhcmFtIG9iamVjdCBjZWxsXHJcbiAgICAgICAgICogQHJldHVybiBzdHJpbmcgdmFsdWVcclxuICAgICAgICAgKi9cclxuICAgICAgICBvYmouZ2V0TGFiZWwgPSBmdW5jdGlvbiAoY2VsbCkge1xyXG4gICAgICAgICAgICAvLyBDb252ZXJ0IGluIGNhc2UgbmFtZSBpcyBleGNlbCBsaWtlZCBleC4gQTEwLCBCQjkyXHJcbiAgICAgICAgICAgIGNlbGwgPSBqZXhjZWwuZ2V0SWRGcm9tQ29sdW1uTmFtZShjZWxsLCB0cnVlKTtcclxuICAgICAgICAgICAgdmFyIHggPSBjZWxsWzBdO1xyXG4gICAgICAgICAgICB2YXIgeSA9IGNlbGxbMV07XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gb2JqLnJlY29yZHNbeV1beF0uaW5uZXJIVE1MO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogR2V0IGxhYmVsZnJvbSBjb29yZHNcclxuICAgICAgICAgKlxyXG4gICAgICAgICAqIEBwYXJhbSBvYmplY3QgY2VsbFxyXG4gICAgICAgICAqIEByZXR1cm4gc3RyaW5nIHZhbHVlXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgb2JqLmdldExhYmVsRnJvbUNvb3JkcyA9IGZ1bmN0aW9uICh4LCB5KSB7XHJcbiAgICAgICAgICAgIHJldHVybiBvYmoucmVjb3Jkc1t5XVt4XS5pbm5lckhUTUw7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvKipcclxuICAgICAgICAgKiBHZXQgdGhlIHZhbHVlIGZyb20gYSBjZWxsXHJcbiAgICAgICAgICpcclxuICAgICAgICAgKiBAcGFyYW0gb2JqZWN0IGNlbGxcclxuICAgICAgICAgKiBAcmV0dXJuIHN0cmluZyB2YWx1ZVxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIG9iai5nZXRWYWx1ZSA9IGZ1bmN0aW9uIChjZWxsLCBwcm9jZXNzZWRWYWx1ZSkge1xyXG4gICAgICAgICAgICBpZiAodHlwZW9mIChjZWxsKSA9PSAnb2JqZWN0Jykge1xyXG4gICAgICAgICAgICAgICAgdmFyIHggPSBjZWxsLmdldEF0dHJpYnV0ZSgnZGF0YS14Jyk7XHJcbiAgICAgICAgICAgICAgICB2YXIgeSA9IGNlbGwuZ2V0QXR0cmlidXRlKCdkYXRhLXknKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGNlbGwgPSBqZXhjZWwuZ2V0SWRGcm9tQ29sdW1uTmFtZShjZWxsLCB0cnVlKTtcclxuICAgICAgICAgICAgICAgIHZhciB4ID0gY2VsbFswXTtcclxuICAgICAgICAgICAgICAgIHZhciB5ID0gY2VsbFsxXTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgdmFyIHZhbHVlID0gbnVsbDtcclxuXHJcbiAgICAgICAgICAgIGlmICh4ICE9IG51bGwgJiYgeSAhPSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAob2JqLnJlY29yZHNbeV0gJiYgb2JqLnJlY29yZHNbeV1beF0gJiYgKHByb2Nlc3NlZFZhbHVlIHx8IG9iai5vcHRpb25zLmNvcHlDb21wYXRpYmlsaXR5ID09IHRydWUpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSBvYmoucmVjb3Jkc1t5XVt4XS5pbm5lckhUTUw7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChvYmoub3B0aW9ucy5kYXRhW3ldICYmIG9iai5vcHRpb25zLmRhdGFbeV1beF0gIT0gJ3VuZGVmaW5lZCcpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSBvYmoub3B0aW9ucy5kYXRhW3ldW3hdO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgcmV0dXJuIHZhbHVlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogR2V0IHRoZSB2YWx1ZSBmcm9tIGEgY29vcmRzXHJcbiAgICAgICAgICpcclxuICAgICAgICAgKiBAcGFyYW0gaW50IHhcclxuICAgICAgICAgKiBAcGFyYW0gaW50IHlcclxuICAgICAgICAgKiBAcmV0dXJuIHN0cmluZyB2YWx1ZVxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIG9iai5nZXRWYWx1ZUZyb21Db29yZHMgPSBmdW5jdGlvbiAoeCwgeSwgcHJvY2Vzc2VkVmFsdWUpIHtcclxuXHJcbiAgICAgICAgICAgIHZhciB2YWx1ZSA9IG51bGw7XHJcblxyXG4gICAgICAgICAgICBpZiAoeCAhPSBudWxsICYmIHkgIT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKChvYmoucmVjb3Jkc1t5XSAmJiBvYmoucmVjb3Jkc1t5XVt4XSkgJiYgcHJvY2Vzc2VkVmFsdWUgfHwgb2JqLm9wdGlvbnMuY29weUNvbXBhdGliaWxpdHkgPT0gdHJ1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhbHVlID0gb2JqLnJlY29yZHNbeV1beF0uaW5uZXJIVE1MO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAob2JqLm9wdGlvbnMuZGF0YVt5XSAmJiBvYmoub3B0aW9ucy5kYXRhW3ldW3hdICE9ICd1bmRlZmluZWQnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlID0gb2JqLm9wdGlvbnMuZGF0YVt5XVt4XTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHJldHVybiB2YWx1ZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIFNldCBhIGNlbGwgdmFsdWVcclxuICAgICAgICAgKlxyXG4gICAgICAgICAqIEBwYXJhbSBtaXhlZCBjZWxsIGRlc3RpbmF0aW9uIGNlbGxcclxuICAgICAgICAgKiBAcGFyYW0gc3RyaW5nIHZhbHVlIHZhbHVlXHJcbiAgICAgICAgICogQHJldHVybiB2b2lkXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgb2JqLnNldFZhbHVlID0gZnVuY3Rpb24gKGNlbGwsIHZhbHVlLCBmb3JjZSkge1xyXG4gICAgICAgICAgICB2YXIgcmVjb3JkcyA9IFtdO1xyXG4gICAgICAgICAgICBpZiAodHlwZW9mIChjZWxsKSA9PSAnc3RyaW5nJykge1xyXG4gICAgICAgICAgICAgICAgdmFyIGNvbHVtbklkID0gamV4Y2VsLmdldElkRnJvbUNvbHVtbk5hbWUoY2VsbCwgdHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICB2YXIgeCA9IGNvbHVtbklkWzBdO1xyXG4gICAgICAgICAgICAgICAgdmFyIHkgPSBjb2x1bW5JZFsxXTtcclxuICAgICAgICAgICAgICAgIC8vIFVwZGF0ZSBjZWxsXHJcbiAgICAgICAgICAgICAgICByZWNvcmRzLnB1c2gob2JqLnVwZGF0ZUNlbGwoeCwgeSwgdmFsdWUsIGZvcmNlKSk7XHJcbiAgICAgICAgICAgICAgICAvLyBVcGRhdGUgYWxsIGZvcm11bGFzIGluIHRoZSBjaGFpblxyXG4gICAgICAgICAgICAgICAgb2JqLnVwZGF0ZUZvcm11bGFDaGFpbih4LCB5LCByZWNvcmRzKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHZhciB4ID0gbnVsbDtcclxuICAgICAgICAgICAgICAgIHZhciB5ID0gbnVsbDtcclxuICAgICAgICAgICAgICAgIGlmIChjZWxsICYmIGNlbGwuZ2V0QXR0cmlidXRlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHggPSBjZWxsLmdldEF0dHJpYnV0ZSgnZGF0YS14Jyk7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHkgPSBjZWxsLmdldEF0dHJpYnV0ZSgnZGF0YS15Jyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gVXBkYXRlIGNlbGxcclxuICAgICAgICAgICAgICAgIGlmICh4ICE9IG51bGwgJiYgeSAhPSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVjb3Jkcy5wdXNoKG9iai51cGRhdGVDZWxsKHgsIHksIHZhbHVlLCBmb3JjZSkpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAvLyBVcGRhdGUgYWxsIGZvcm11bGFzIGluIHRoZSBjaGFpblxyXG4gICAgICAgICAgICAgICAgICAgIG9iai51cGRhdGVGb3JtdWxhQ2hhaW4oeCwgeSwgcmVjb3Jkcyk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBrZXlzID0gT2JqZWN0LmtleXMoY2VsbCk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGtleXMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGtleXMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgKGNlbGxbaV0pID09ICdzdHJpbmcnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNvbHVtbklkID0gamV4Y2VsLmdldElkRnJvbUNvbHVtbk5hbWUoY2VsbFtpXSwgdHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHggPSBjb2x1bW5JZFswXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgeSA9IGNvbHVtbklkWzFdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoY2VsbFtpXS54ICE9IG51bGwgJiYgY2VsbFtpXS55ICE9IG51bGwpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHggPSBjZWxsW2ldLng7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB5ID0gY2VsbFtpXS55O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBGbGV4aWJsZSBzZXR1cFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoY2VsbFtpXS5uZXdWYWx1ZSAhPSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IGNlbGxbaV0ubmV3VmFsdWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoY2VsbFtpXS52YWx1ZSAhPSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IGNlbGxbaV0udmFsdWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgeCA9IGNlbGxbaV0uZ2V0QXR0cmlidXRlKCdkYXRhLXgnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHkgPSBjZWxsW2ldLmdldEF0dHJpYnV0ZSgnZGF0YS15Jyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFVwZGF0ZSBjZWxsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoeCAhPSBudWxsICYmIHkgIT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlY29yZHMucHVzaChvYmoudXBkYXRlQ2VsbCh4LCB5LCB2YWx1ZSwgZm9yY2UpKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gVXBkYXRlIGFsbCBmb3JtdWxhcyBpbiB0aGUgY2hhaW5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmoudXBkYXRlRm9ybXVsYUNoYWluKHgsIHksIHJlY29yZHMpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBVcGRhdGUgaGlzdG9yeVxyXG4gICAgICAgICAgICBvYmouc2V0SGlzdG9yeSh7XHJcbiAgICAgICAgICAgICAgICBhY3Rpb246ICdzZXRWYWx1ZScsXHJcbiAgICAgICAgICAgICAgICByZWNvcmRzOiByZWNvcmRzLFxyXG4gICAgICAgICAgICAgICAgc2VsZWN0aW9uOiBvYmouc2VsZWN0ZWRDZWxsLFxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIC8vIFVwZGF0ZSB0YWJsZSB3aXRoIGN1c3RvbSBjb25maWd1cmF0aW9ucyBpZiBhcHBsaWNhYmxlXHJcbiAgICAgICAgICAgIG9iai51cGRhdGVUYWJsZSgpO1xyXG5cclxuICAgICAgICAgICAgLy8gT24gYWZ0ZXIgY2hhbmdlc1xyXG4gICAgICAgICAgICBvYmoub25hZnRlcmNoYW5nZXMoZWwsIHJlY29yZHMpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogU2V0IGEgY2VsbCB2YWx1ZSBiYXNlZCBvbiBjb29yZGluYXRlc1xyXG4gICAgICAgICAqXHJcbiAgICAgICAgICogQHBhcmFtIGludCB4IGRlc3RpbmF0aW9uIGNlbGxcclxuICAgICAgICAgKiBAcGFyYW0gaW50IHkgZGVzdGluYXRpb24gY2VsbFxyXG4gICAgICAgICAqIEBwYXJhbSBzdHJpbmcgdmFsdWVcclxuICAgICAgICAgKiBAcmV0dXJuIHZvaWRcclxuICAgICAgICAgKi9cclxuICAgICAgICBvYmouc2V0VmFsdWVGcm9tQ29vcmRzID0gZnVuY3Rpb24gKHgsIHksIHZhbHVlLCBmb3JjZSkge1xyXG4gICAgICAgICAgICB2YXIgcmVjb3JkcyA9IFtdO1xyXG4gICAgICAgICAgICByZWNvcmRzLnB1c2gob2JqLnVwZGF0ZUNlbGwoeCwgeSwgdmFsdWUsIGZvcmNlKSk7XHJcblxyXG4gICAgICAgICAgICAvLyBVcGRhdGUgYWxsIGZvcm11bGFzIGluIHRoZSBjaGFpblxyXG4gICAgICAgICAgICBvYmoudXBkYXRlRm9ybXVsYUNoYWluKHgsIHksIHJlY29yZHMpO1xyXG5cclxuICAgICAgICAgICAgLy8gVXBkYXRlIGhpc3RvcnlcclxuICAgICAgICAgICAgb2JqLnNldEhpc3Rvcnkoe1xyXG4gICAgICAgICAgICAgICAgYWN0aW9uOiAnc2V0VmFsdWUnLFxyXG4gICAgICAgICAgICAgICAgcmVjb3JkczogcmVjb3JkcyxcclxuICAgICAgICAgICAgICAgIHNlbGVjdGlvbjogb2JqLnNlbGVjdGVkQ2VsbCxcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAvLyBVcGRhdGUgdGFibGUgd2l0aCBjdXN0b20gY29uZmlndXJhdGlvbnMgaWYgYXBwbGljYWJsZVxyXG4gICAgICAgICAgICBvYmoudXBkYXRlVGFibGUoKTtcclxuXHJcbiAgICAgICAgICAgIC8vIE9uIGFmdGVyIGNoYW5nZXNcclxuICAgICAgICAgICAgb2JqLm9uYWZ0ZXJjaGFuZ2VzKGVsLCByZWNvcmRzKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIFRvb2dsZVxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIG9iai5zZXRDaGVja1JhZGlvVmFsdWUgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHZhciByZWNvcmRzID0gW107XHJcbiAgICAgICAgICAgIHZhciBrZXlzID0gT2JqZWN0LmtleXMob2JqLmhpZ2hsaWdodGVkKTtcclxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBrZXlzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgeCA9IG9iai5oaWdobGlnaHRlZFtpXS5nZXRBdHRyaWJ1dGUoJ2RhdGEteCcpO1xyXG4gICAgICAgICAgICAgICAgdmFyIHkgPSBvYmouaGlnaGxpZ2h0ZWRbaV0uZ2V0QXR0cmlidXRlKCdkYXRhLXknKTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAob2JqLm9wdGlvbnMuY29sdW1uc1t4XS50eXBlID09ICdjaGVja2JveCcgfHwgb2JqLm9wdGlvbnMuY29sdW1uc1t4XS50eXBlID09ICdyYWRpbycpIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBVcGRhdGUgY2VsbFxyXG4gICAgICAgICAgICAgICAgICAgIHJlY29yZHMucHVzaChvYmoudXBkYXRlQ2VsbCh4LCB5LCAhb2JqLm9wdGlvbnMuZGF0YVt5XVt4XSkpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAocmVjb3Jkcy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgIC8vIFVwZGF0ZSBoaXN0b3J5XHJcbiAgICAgICAgICAgICAgICBvYmouc2V0SGlzdG9yeSh7XHJcbiAgICAgICAgICAgICAgICAgICAgYWN0aW9uOiAnc2V0VmFsdWUnLFxyXG4gICAgICAgICAgICAgICAgICAgIHJlY29yZHM6IHJlY29yZHMsXHJcbiAgICAgICAgICAgICAgICAgICAgc2VsZWN0aW9uOiBvYmouc2VsZWN0ZWRDZWxsLFxyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gT24gYWZ0ZXIgY2hhbmdlc1xyXG4gICAgICAgICAgICAgICAgb2JqLm9uYWZ0ZXJjaGFuZ2VzKGVsLCByZWNvcmRzKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICAvKipcclxuICAgICAgICAgKiBTdHJpcCB0YWdzXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgdmFyIHN0cmlwU2NyaXB0ID0gZnVuY3Rpb24gKGEpIHtcclxuICAgICAgICAgICAgdmFyIGIgPSBuZXcgT3B0aW9uO1xyXG4gICAgICAgICAgICBiLmlubmVySFRNTCA9IGE7XHJcbiAgICAgICAgICAgIHZhciBjID0gbnVsbDtcclxuICAgICAgICAgICAgZm9yIChhID0gYi5nZXRFbGVtZW50c0J5VGFnTmFtZSgnc2NyaXB0Jyk7IGMgPSBhWzBdOykgYy5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKGMpO1xyXG4gICAgICAgICAgICByZXR1cm4gYi5pbm5lckhUTUw7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvKipcclxuICAgICAgICAgKiBVcGRhdGUgY2VsbCBjb250ZW50XHJcbiAgICAgICAgICpcclxuICAgICAgICAgKiBAcGFyYW0gb2JqZWN0IGNlbGxcclxuICAgICAgICAgKiBAcmV0dXJuIHZvaWRcclxuICAgICAgICAgKi9cclxuICAgICAgICBvYmoudXBkYXRlQ2VsbCA9IGZ1bmN0aW9uICh4LCB5LCB2YWx1ZSwgZm9yY2UpIHtcclxuICAgICAgICAgICAgLy8gQ2hhbmdpbmcgdmFsdWUgZGVwZW5kaW5nIG9uIHRoZSBjb2x1bW4gdHlwZVxyXG4gICAgICAgICAgICBpZiAob2JqLnJlY29yZHNbeV1beF0uY2xhc3NMaXN0LmNvbnRhaW5zKCdyZWFkb25seScpID09IHRydWUgJiYgIWZvcmNlKSB7XHJcbiAgICAgICAgICAgICAgICAvLyBEbyBub3RoaW5nXHJcbiAgICAgICAgICAgICAgICB2YXIgcmVjb3JkID0ge1xyXG4gICAgICAgICAgICAgICAgICAgIHg6IHgsXHJcbiAgICAgICAgICAgICAgICAgICAgeTogeSxcclxuICAgICAgICAgICAgICAgICAgICBjb2w6IHgsXHJcbiAgICAgICAgICAgICAgICAgICAgcm93OiB5XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAvLyBTZWN1cml0eVxyXG4gICAgICAgICAgICAgICAgaWYgKCgnJyArIHZhbHVlKS5zdWJzdHIoMCwgMSkgPT0gJz0nICYmIG9iai5vcHRpb25zLnNlY3VyZUZvcm11bGFzID09IHRydWUpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgdmFsID0gc2VjdXJlRm9ybXVsYSh2YWx1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHZhbCAhPSB2YWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBVcGRhdGUgdGhlIGRhdGEgY29udGFpbmVyXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlID0gdmFsO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAvLyBPbiBjaGFuZ2VcclxuICAgICAgICAgICAgICAgIHZhciB2YWwgPSBvYmouZGlzcGF0Y2goJ29uYmVmb3JlY2hhbmdlJywgZWwsIG9iai5yZWNvcmRzW3ldW3hdLCB4LCB5LCB2YWx1ZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gSWYgeW91IHJldHVybiBzb21ldGhpbmcgdGhpcyB3aWxsIG92ZXJ3cml0ZSB0aGUgdmFsdWVcclxuICAgICAgICAgICAgICAgIGlmICh2YWwgIT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSB2YWw7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKG9iai5vcHRpb25zLmNvbHVtbnNbeF0uZWRpdG9yICYmIHR5cGVvZiAob2JqLm9wdGlvbnMuY29sdW1uc1t4XS5lZGl0b3IudXBkYXRlQ2VsbCkgPT0gJ2Z1bmN0aW9uJykge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhbHVlID0gb2JqLm9wdGlvbnMuY29sdW1uc1t4XS5lZGl0b3IudXBkYXRlQ2VsbChvYmoucmVjb3Jkc1t5XVt4XSwgdmFsdWUsIGZvcmNlLCBvYmosIHgpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIC8vIEhpc3RvcnkgZm9ybWF0XHJcbiAgICAgICAgICAgICAgICB2YXIgcmVjb3JkID0ge1xyXG4gICAgICAgICAgICAgICAgICAgIHg6IHgsXHJcbiAgICAgICAgICAgICAgICAgICAgeTogeSxcclxuICAgICAgICAgICAgICAgICAgICBjb2w6IHgsXHJcbiAgICAgICAgICAgICAgICAgICAgcm93OiB5LFxyXG4gICAgICAgICAgICAgICAgICAgIG5ld1ZhbHVlOiB2YWx1ZSxcclxuICAgICAgICAgICAgICAgICAgICBvbGRWYWx1ZTogb2JqLm9wdGlvbnMuZGF0YVt5XVt4XSxcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBpZiAob2JqLm9wdGlvbnMuY29sdW1uc1t4XS5lZGl0b3IpIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBVcGRhdGUgZGF0YSBhbmQgY2VsbFxyXG4gICAgICAgICAgICAgICAgICAgIG9iai5vcHRpb25zLmRhdGFbeV1beF0gPSB2YWx1ZTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gTmF0aXZlIGZ1bmN0aW9uc1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChvYmoub3B0aW9ucy5jb2x1bW5zW3hdLnR5cGUgPT0gJ2NoZWNrYm94JyB8fCBvYmoub3B0aW9ucy5jb2x1bW5zW3hdLnR5cGUgPT0gJ3JhZGlvJykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBVbmNoZWNrZWQgYWxsIG9wdGlvbnNcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG9iai5vcHRpb25zLmNvbHVtbnNbeF0udHlwZSA9PSAncmFkaW8nKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IG9iai5vcHRpb25zLmRhdGEubGVuZ3RoOyBqKyspIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmoub3B0aW9ucy5kYXRhW2pdW3hdID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFVwZGF0ZSBkYXRhIGFuZCBjZWxsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9iai5yZWNvcmRzW3ldW3hdLmNoaWxkcmVuWzBdLmNoZWNrZWQgPSAodmFsdWUgPT0gMSB8fCB2YWx1ZSA9PSB0cnVlIHx8IHZhbHVlID09ICd0cnVlJyB8fCB2YWx1ZSA9PSAnVFJVRScpID8gdHJ1ZSA6IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBvYmoub3B0aW9ucy5kYXRhW3ldW3hdID0gb2JqLnJlY29yZHNbeV1beF0uY2hpbGRyZW5bMF0uY2hlY2tlZDtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKG9iai5vcHRpb25zLmNvbHVtbnNbeF0udHlwZSA9PSAnZHJvcGRvd24nIHx8IG9iai5vcHRpb25zLmNvbHVtbnNbeF0udHlwZSA9PSAnYXV0b2NvbXBsZXRlJykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBVcGRhdGUgZGF0YSBhbmQgY2VsbFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAob2JqLm9wdGlvbnMuY29sdW1uc1t4XS5hbGxvd0VtcHR5IHx8IHZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmoub3B0aW9ucy5kYXRhW3ldW3hdID0gdmFsdWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmoucmVjb3Jkc1t5XVt4XS5pbm5lclRleHQgPSBvYmouZ2V0RHJvcERvd25WYWx1ZSh4LCB2YWx1ZSwgeSwgb2JqLnJlY29yZHNbeV1beF0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb2JqLnJlY29yZHNbeV1beF0uaW5uZXJUZXh0ID0gb2JqLmdldERyb3BEb3duVmFsdWUoeCwgb2JqLm9wdGlvbnMuZGF0YVt5XVt4XSwgeSwgb2JqLnJlY29yZHNbeV1beF0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAob2JqLm9wdGlvbnMuY29sdW1uc1t4XS50eXBlID09ICdjYWxlbmRhcicpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gVXBkYXRlIGNhbGVuZGFyXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBmb3JtYXR0ZWQgPSBqU3VpdGVzLmNhbGVuZGFyLmV4dHJhY3REYXRlRnJvbVN0cmluZyh2YWx1ZSwgb2JqLm9wdGlvbnMuY29sdW1uc1t4XS5vcHRpb25zLmZvcm1hdCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFVwZGF0ZSBkYXRhIGFuZCBjZWxsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9iai5vcHRpb25zLmRhdGFbeV1beF0gPSB2YWx1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgb2JqLnJlY29yZHNbeV1beF0uaW5uZXJUZXh0ID0galN1aXRlcy5jYWxlbmRhci5nZXREYXRlU3RyaW5nKGZvcm1hdHRlZCA/IGZvcm1hdHRlZCA6IHZhbHVlLCBvYmoub3B0aW9ucy5jb2x1bW5zW3hdLm9wdGlvbnMuZm9ybWF0KTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKG9iai5vcHRpb25zLmNvbHVtbnNbeF0udHlwZSA9PSAnY29sb3InKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFVwZGF0ZSBjb2xvclxyXG4gICAgICAgICAgICAgICAgICAgICAgICBvYmoub3B0aW9ucy5kYXRhW3ldW3hdID0gdmFsdWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFJlbmRlclxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAob2JqLm9wdGlvbnMuY29sdW1uc1t4XS5yZW5kZXIgPT0gJ3NxdWFyZScpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjb2xvciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sb3IuY2xhc3NOYW1lID0gJ2NvbG9yJztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbG9yLnN0eWxlLmJhY2tncm91bmRDb2xvciA9IHZhbHVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb2JqLnJlY29yZHNbeV1beF0uaW5uZXJUZXh0ID0gJyc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmoucmVjb3Jkc1t5XVt4XS5hcHBlbmRDaGlsZChjb2xvcik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmoucmVjb3Jkc1t5XVt4XS5zdHlsZS5jb2xvciA9IHZhbHVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb2JqLnJlY29yZHNbeV1beF0uaW5uZXJUZXh0ID0gdmFsdWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKG9iai5vcHRpb25zLmNvbHVtbnNbeF0udHlwZSA9PSAnaW1hZ2UnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlID0gJycgKyB2YWx1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgb2JqLm9wdGlvbnMuZGF0YVt5XVt4XSA9IHZhbHVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBvYmoucmVjb3Jkc1t5XVt4XS5pbm5lckhUTUwgPSAnJztcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlICYmIHZhbHVlLnN1YnN0cigwLCAxMCkgPT0gJ2RhdGE6aW1hZ2UnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgaW1nID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW1nJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbWcuc3JjID0gdmFsdWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmoucmVjb3Jkc1t5XVt4XS5hcHBlbmRDaGlsZChpbWcpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gVXBkYXRlIGRhdGEgYW5kIGNlbGxcclxuICAgICAgICAgICAgICAgICAgICAgICAgb2JqLm9wdGlvbnMuZGF0YVt5XVt4XSA9IHZhbHVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBMYWJlbFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAob2JqLm9wdGlvbnMuY29sdW1uc1t4XS50eXBlID09ICdodG1sJykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb2JqLnJlY29yZHNbeV1beF0uaW5uZXJIVE1MID0gc3RyaXBTY3JpcHQob2JqLnBhcnNlVmFsdWUoeCwgeSwgdmFsdWUpKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChvYmoub3B0aW9ucy5zdHJpcEhUTUwgPT09IGZhbHNlIHx8IG9iai5vcHRpb25zLmNvbHVtbnNbeF0uc3RyaXBIVE1MID09PSBmYWxzZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9iai5yZWNvcmRzW3ldW3hdLmlubmVySFRNTCA9IHN0cmlwU2NyaXB0KG9iai5wYXJzZVZhbHVlKHgsIHksIHZhbHVlKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9iai5yZWNvcmRzW3ldW3hdLmlubmVyVGV4dCA9IG9iai5wYXJzZVZhbHVlKHgsIHksIHZhbHVlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBIYW5kbGUgYmlnIHRleHQgaW5zaWRlIGEgY2VsbFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAob2JqLm9wdGlvbnMuY29sdW1uc1t4XS53b3JkV3JhcCAhPSBmYWxzZSAmJiAob2JqLm9wdGlvbnMud29yZFdyYXAgPT0gdHJ1ZSB8fCBvYmoub3B0aW9ucy5jb2x1bW5zW3hdLndvcmRXcmFwID09IHRydWUgfHwgb2JqLnJlY29yZHNbeV1beF0uaW5uZXJIVE1MLmxlbmd0aCA+IDIwMCkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9iai5yZWNvcmRzW3ldW3hdLnN0eWxlLndoaXRlU3BhY2UgPSAncHJlLXdyYXAnO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb2JqLnJlY29yZHNbeV1beF0uc3R5bGUud2hpdGVTcGFjZSA9ICcnO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIC8vIE92ZXJmbG93XHJcbiAgICAgICAgICAgICAgICBpZiAoeCA+IDApIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodmFsdWUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgb2JqLnJlY29yZHNbeV1beCAtIDFdLnN0eWxlLm92ZXJmbG93ID0gJ2hpZGRlbic7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgb2JqLnJlY29yZHNbeV1beCAtIDFdLnN0eWxlLm92ZXJmbG93ID0gJyc7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIC8vIE9uIGNoYW5nZVxyXG4gICAgICAgICAgICAgICAgb2JqLmRpc3BhdGNoKCdvbmNoYW5nZScsIGVsLCAob2JqLnJlY29yZHNbeV0gJiYgb2JqLnJlY29yZHNbeV1beF0gPyBvYmoucmVjb3Jkc1t5XVt4XSA6IG51bGwpLCB4LCB5LCB2YWx1ZSwgcmVjb3JkLm9sZFZhbHVlKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgcmV0dXJuIHJlY29yZDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIEhlbHBlciBmdW5jdGlvbiB0byBjb3B5IGRhdGEgdXNpbmcgdGhlIGNvcm5lciBpY29uXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgb2JqLmNvcHlEYXRhID0gZnVuY3Rpb24gKG8sIGQpIHtcclxuICAgICAgICAgICAgLy8gR2V0IGRhdGEgZnJvbSBhbGwgc2VsZWN0ZWQgY2VsbHNcclxuICAgICAgICAgICAgdmFyIGRhdGEgPSBvYmouZ2V0RGF0YSh0cnVlLCB0cnVlKTtcclxuICAgICAgICAgICAgLy8gU2VsZWN0ZWQgY2VsbHNcclxuICAgICAgICAgICAgdmFyIGggPSBvYmouc2VsZWN0ZWRDb250YWluZXI7XHJcbiAgICAgICAgICAgIC8vIENlbGxzXHJcbiAgICAgICAgICAgIHZhciB4MSA9IHBhcnNlSW50KG8uZ2V0QXR0cmlidXRlKCdkYXRhLXgnKSk7XHJcbiAgICAgICAgICAgIHZhciB5MSA9IHBhcnNlSW50KG8uZ2V0QXR0cmlidXRlKCdkYXRhLXknKSk7XHJcbiAgICAgICAgICAgIHZhciB4MiA9IHBhcnNlSW50KGQuZ2V0QXR0cmlidXRlKCdkYXRhLXgnKSk7XHJcbiAgICAgICAgICAgIHZhciB5MiA9IHBhcnNlSW50KGQuZ2V0QXR0cmlidXRlKCdkYXRhLXknKSk7XHJcblxyXG4gICAgICAgICAgICBpZiAob2JqLm9wdGlvbnMuYWxsb3dYQ29weSAhPT0gdHJ1ZSkgaWYgKHgxICE9PSBoWzBdKSByZXR1cm47XHJcblxyXG4gICAgICAgICAgICAvLyBSZWNvcmRzXHJcbiAgICAgICAgICAgIHZhciByZWNvcmRzID0gW107XHJcbiAgICAgICAgICAgIHZhciBicmVha0NvbnRyb2wgPSBmYWxzZTtcclxuXHJcbiAgICAgICAgICAgIGlmIChoWzBdID09IHgxKSB7XHJcbiAgICAgICAgICAgICAgICAvLyBWZXJ0aWNhbCBjb3B5XHJcbiAgICAgICAgICAgICAgICBpZiAoeTEgPCBoWzFdKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHJvd051bWJlciA9IHkxIC0gaFsxXTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHJvd051bWJlciA9IDE7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB2YXIgY29sTnVtYmVyID0gMDtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGlmICh4MSA8IGhbMF0pIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgY29sTnVtYmVyID0geDEgLSBoWzBdO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgY29sTnVtYmVyID0gMTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHZhciByb3dOdW1iZXIgPSAwO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBDb3B5IGRhdGEgcHJvY2VkdXJlXHJcbiAgICAgICAgICAgIHZhciBwb3N4ID0gMDtcclxuICAgICAgICAgICAgdmFyIHBvc3kgPSAwO1xyXG5cclxuICAgICAgICAgICAgZm9yICh2YXIgaiA9IHkxOyBqIDw9IHkyOyBqKyspIHtcclxuICAgICAgICAgICAgICAgIC8vIFNraXAgaGlkZGVuIHJvd3NcclxuICAgICAgICAgICAgICAgIGlmIChvYmoucm93c1tqXSAmJiBvYmoucm93c1tqXS5zdHlsZS5kaXNwbGF5ID09ICdub25lJykge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIC8vIENvbnRyb2xzXHJcbiAgICAgICAgICAgICAgICBpZiAoZGF0YVtwb3N5XSA9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICBwb3N5ID0gMDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHBvc3ggPSAwO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIERhdGEgY29sdW1uc1xyXG4gICAgICAgICAgICAgICAgaWYgKGhbMF0gIT0geDEpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoeDEgPCBoWzBdKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjb2xOdW1iZXIgPSB4MSAtIGhbMF07XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNvbE51bWJlciA9IDE7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgLy8gRGF0YSBjb2x1bW5zXHJcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0geDE7IGkgPD0geDI7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIFVwZGF0ZSBub24tcmVhZG9ubHlcclxuICAgICAgICAgICAgICAgICAgICBpZiAob2JqLnJlY29yZHNbal1baV0gJiYgIW9iai5yZWNvcmRzW2pdW2ldLmNsYXNzTGlzdC5jb250YWlucygncmVhZG9ubHknKSAmJiBvYmoucmVjb3Jkc1tqXVtpXS5zdHlsZS5kaXNwbGF5ICE9ICdub25lJyAmJiBicmVha0NvbnRyb2wgPT0gZmFsc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gU3RvcCBpZiBjb250YWlucyB2YWx1ZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIW9iai5zZWxlY3Rpb24ubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAob2JqLm9wdGlvbnMuZGF0YVtqXVtpXSAhPSAnJykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrQ29udHJvbCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIENvbHVtblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YVtwb3N5XSA9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvc3ggPSAwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGRhdGFbcG9zeV1bcG9zeF0gPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb3N4ID0gMDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gVmFsdWVcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHZhbHVlID0gZGF0YVtwb3N5XVtwb3N4XTtcclxuXHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodmFsdWUgJiYgIWRhdGFbMV0gJiYgb2JqLm9wdGlvbnMuYXV0b0luY3JlbWVudCA9PSB0cnVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAob2JqLm9wdGlvbnMuY29sdW1uc1tpXS50eXBlID09ICd0ZXh0JyB8fCBvYmoub3B0aW9ucy5jb2x1bW5zW2ldLnR5cGUgPT0gJ251bWJlcicpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoKCcnICsgdmFsdWUpLnN1YnN0cigwLCAxKSA9PSAnPScpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHRva2VucyA9IHZhbHVlLm1hdGNoKC8oW0EtWl0rWzAtOV0rKS9nKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0b2tlbnMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBhZmZlY3RlZFRva2VucyA9IFtdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaW5kZXggPSAwOyBpbmRleCA8IHRva2Vucy5sZW5ndGg7IGluZGV4KyspIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgcG9zaXRpb24gPSBqZXhjZWwuZ2V0SWRGcm9tQ29sdW1uTmFtZSh0b2tlbnNbaW5kZXhdLCAxKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb3NpdGlvblswXSArPSBjb2xOdW1iZXI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9zaXRpb25bMV0gKz0gcm93TnVtYmVyO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwb3NpdGlvblsxXSA8IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9zaXRpb25bMV0gPSAwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgdG9rZW4gPSBqZXhjZWwuZ2V0Q29sdW1uTmFtZUZyb21JZChbcG9zaXRpb25bMF0sIHBvc2l0aW9uWzFdXSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0b2tlbiAhPSB0b2tlbnNbaW5kZXhdKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFmZmVjdGVkVG9rZW5zW3Rva2Vuc1tpbmRleF1dID0gdG9rZW47XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gVXBkYXRlIGZvcm11bGFcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhZmZlY3RlZFRva2Vucykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlID0gb2JqLnVwZGF0ZUZvcm11bGEodmFsdWUsIGFmZmVjdGVkVG9rZW5zKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlID09IE51bWJlcih2YWx1ZSkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlID0gTnVtYmVyKHZhbHVlKSArIHJvd051bWJlcjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAob2JqLm9wdGlvbnMuY29sdW1uc1tpXS50eXBlID09ICdjYWxlbmRhcicpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZGF0ZSA9IG5ldyBEYXRlKHZhbHVlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRlLnNldERhdGUoZGF0ZS5nZXREYXRlKCkgKyByb3dOdW1iZXIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlID0gZGF0ZS5nZXRGdWxsWWVhcigpICsgJy0nICsgamV4Y2VsLmRvdWJsZURpZ2l0Rm9ybWF0KHBhcnNlSW50KGRhdGUuZ2V0TW9udGgoKSArIDEpKSArICctJyArIGpleGNlbC5kb3VibGVEaWdpdEZvcm1hdChkYXRlLmdldERhdGUoKSkgKyAnICcgKyAnMDA6MDA6MDAnO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZWNvcmRzLnB1c2gob2JqLnVwZGF0ZUNlbGwoaSwgaiwgdmFsdWUpKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFVwZGF0ZSBhbGwgZm9ybXVsYXMgaW4gdGhlIGNoYWluXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9iai51cGRhdGVGb3JtdWxhQ2hhaW4oaSwgaiwgcmVjb3Jkcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIHBvc3grKztcclxuICAgICAgICAgICAgICAgICAgICBpZiAoaFswXSAhPSB4MSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb2xOdW1iZXIrKztcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBwb3N5Kys7XHJcbiAgICAgICAgICAgICAgICByb3dOdW1iZXIrKztcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gVXBkYXRlIGhpc3RvcnlcclxuICAgICAgICAgICAgb2JqLnNldEhpc3Rvcnkoe1xyXG4gICAgICAgICAgICAgICAgYWN0aW9uOiAnc2V0VmFsdWUnLFxyXG4gICAgICAgICAgICAgICAgcmVjb3JkczogcmVjb3JkcyxcclxuICAgICAgICAgICAgICAgIHNlbGVjdGlvbjogb2JqLnNlbGVjdGVkQ2VsbCxcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAvLyBVcGRhdGUgdGFibGUgd2l0aCBjdXN0b20gY29uZmlndXJhdGlvbiBpZiBhcHBsaWNhYmxlXHJcbiAgICAgICAgICAgIG9iai51cGRhdGVUYWJsZSgpO1xyXG5cclxuICAgICAgICAgICAgLy8gT24gYWZ0ZXIgY2hhbmdlc1xyXG4gICAgICAgICAgICBvYmoub25hZnRlcmNoYW5nZXMoZWwsIHJlY29yZHMpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogUmVmcmVzaCBjdXJyZW50IHNlbGVjdGlvblxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIG9iai5yZWZyZXNoU2VsZWN0aW9uID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBpZiAob2JqLnNlbGVjdGVkQ2VsbCkge1xyXG4gICAgICAgICAgICAgICAgb2JqLnVwZGF0ZVNlbGVjdGlvbkZyb21Db29yZHMob2JqLnNlbGVjdGVkQ2VsbFswXSwgb2JqLnNlbGVjdGVkQ2VsbFsxXSwgb2JqLnNlbGVjdGVkQ2VsbFsyXSwgb2JqLnNlbGVjdGVkQ2VsbFszXSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIE1vdmUgY29vcmRzIHRvIEExIGluIGNhc2Ugb3ZlbGFwcyB3aXRoIGFuIGV4Y2x1ZGVkIGNlbGxcclxuICAgICAgICAgKi9cclxuICAgICAgICBvYmouY29uZGl0aW9uYWxTZWxlY3Rpb25VcGRhdGUgPSBmdW5jdGlvbiAodHlwZSwgbywgZCkge1xyXG4gICAgICAgICAgICBpZiAodHlwZSA9PSAxKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAob2JqLnNlbGVjdGVkQ2VsbCAmJiAoKG8gPj0gb2JqLnNlbGVjdGVkQ2VsbFsxXSAmJiBvIDw9IG9iai5zZWxlY3RlZENlbGxbM10pIHx8IChkID49IG9iai5zZWxlY3RlZENlbGxbMV0gJiYgZCA8PSBvYmouc2VsZWN0ZWRDZWxsWzNdKSkpIHtcclxuICAgICAgICAgICAgICAgICAgICBvYmoucmVzZXRTZWxlY3Rpb24oKTtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBpZiAob2JqLnNlbGVjdGVkQ2VsbCAmJiAoKG8gPj0gb2JqLnNlbGVjdGVkQ2VsbFswXSAmJiBvIDw9IG9iai5zZWxlY3RlZENlbGxbMl0pIHx8IChkID49IG9iai5zZWxlY3RlZENlbGxbMF0gJiYgZCA8PSBvYmouc2VsZWN0ZWRDZWxsWzJdKSkpIHtcclxuICAgICAgICAgICAgICAgICAgICBvYmoucmVzZXRTZWxlY3Rpb24oKTtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIENsZWFyIHRhYmxlIHNlbGVjdGlvblxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIG9iai5yZXNldFNlbGVjdGlvbiA9IGZ1bmN0aW9uIChibHVyKSB7XHJcbiAgICAgICAgICAgIC8vIFJlbW92ZSBzdHlsZVxyXG4gICAgICAgICAgICBpZiAoIW9iai5oaWdobGlnaHRlZC5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgIHZhciBwcmV2aW91c1N0YXR1cyA9IDA7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgcHJldmlvdXNTdGF0dXMgPSAxO1xyXG5cclxuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgb2JqLmhpZ2hsaWdodGVkLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgb2JqLmhpZ2hsaWdodGVkW2ldLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZ2hsaWdodCcpO1xyXG4gICAgICAgICAgICAgICAgICAgIG9iai5oaWdobGlnaHRlZFtpXS5jbGFzc0xpc3QucmVtb3ZlKCdoaWdobGlnaHQtbGVmdCcpO1xyXG4gICAgICAgICAgICAgICAgICAgIG9iai5oaWdobGlnaHRlZFtpXS5jbGFzc0xpc3QucmVtb3ZlKCdoaWdobGlnaHQtcmlnaHQnKTtcclxuICAgICAgICAgICAgICAgICAgICBvYmouaGlnaGxpZ2h0ZWRbaV0uY2xhc3NMaXN0LnJlbW92ZSgnaGlnaGxpZ2h0LXRvcCcpO1xyXG4gICAgICAgICAgICAgICAgICAgIG9iai5oaWdobGlnaHRlZFtpXS5jbGFzc0xpc3QucmVtb3ZlKCdoaWdobGlnaHQtYm90dG9tJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgb2JqLmhpZ2hsaWdodGVkW2ldLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZ2hsaWdodC1zZWxlY3RlZCcpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICB2YXIgcHggPSBwYXJzZUludChvYmouaGlnaGxpZ2h0ZWRbaV0uZ2V0QXR0cmlidXRlKCdkYXRhLXgnKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHB5ID0gcGFyc2VJbnQob2JqLmhpZ2hsaWdodGVkW2ldLmdldEF0dHJpYnV0ZSgnZGF0YS15JykpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAvLyBDaGVjayBmb3IgbWVyZ2VkIGNlbGxzXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKG9iai5oaWdobGlnaHRlZFtpXS5nZXRBdHRyaWJ1dGUoJ2RhdGEtbWVyZ2VkJykpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNvbHNwYW4gPSBwYXJzZUludChvYmouaGlnaGxpZ2h0ZWRbaV0uZ2V0QXR0cmlidXRlKCdjb2xzcGFuJykpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgcm93c3BhbiA9IHBhcnNlSW50KG9iai5oaWdobGlnaHRlZFtpXS5nZXRBdHRyaWJ1dGUoJ3Jvd3NwYW4nKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB1eCA9IGNvbHNwYW4gPiAwID8gcHggKyAoY29sc3BhbiAtIDEpIDogcHg7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB1eSA9IHJvd3NwYW4gPiAwID8gcHkgKyAocm93c3BhbiAtIDEpIDogcHk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHV4ID0gcHg7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB1eSA9IHB5O1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgLy8gUmVtb3ZlIHNlbGVjdGVkIGZyb20gaGVhZGVyc1xyXG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGogPSBweDsgaiA8PSB1eDsgaisrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChvYmouaGVhZGVyc1tqXSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb2JqLmhlYWRlcnNbal0uY2xhc3NMaXN0LnJlbW92ZSgnc2VsZWN0ZWQnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgLy8gUmVtb3ZlIHNlbGVjdGVkIGZyb20gcm93c1xyXG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGogPSBweTsgaiA8PSB1eTsgaisrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChvYmoucm93c1tqXSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb2JqLnJvd3Nbal0uY2xhc3NMaXN0LnJlbW92ZSgnc2VsZWN0ZWQnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKGJsdXIgPT0gdHJ1ZSAmJiBwcmV2aW91c1N0YXR1cyA9PSAxKSB7XHJcbiAgICAgICAgICAgICAgICBvYmouZGlzcGF0Y2goJ29uYmx1cicsIGVsKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gUmVzZXQgaGlnaGxpZ2hlZCBjZWxsc1xyXG4gICAgICAgICAgICBvYmouaGlnaGxpZ2h0ZWQgPSBbXTtcclxuXHJcbiAgICAgICAgICAgIC8vIFJlc2V0XHJcbiAgICAgICAgICAgIG9iai5zZWxlY3RlZENlbGwgPSBudWxsO1xyXG5cclxuICAgICAgICAgICAgLy8gSGlkZSBjb3JuZXJcclxuICAgICAgICAgICAgb2JqLmNvcm5lci5zdHlsZS50b3AgPSAnLTIwMDBweCc7XHJcbiAgICAgICAgICAgIG9iai5jb3JuZXIuc3R5bGUubGVmdCA9ICctMjAwMHB4JztcclxuXHJcblxyXG4gICAgICAgICAgICByZXR1cm4gcHJldmlvdXNTdGF0dXM7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvKipcclxuICAgICAgICAgKiBVcGRhdGUgc2VsZWN0aW9uIGJhc2VkIG9uIHR3byBjZWxsc1xyXG4gICAgICAgICAqL1xyXG4gICAgICAgIG9iai51cGRhdGVTZWxlY3Rpb24gPSBmdW5jdGlvbiAoZWwxLCBlbDIsIG9yaWdpbikge1xyXG4gICAgICAgICAgICB2YXIgeDEgPSBlbDEuZ2V0QXR0cmlidXRlKCdkYXRhLXgnKTtcclxuICAgICAgICAgICAgdmFyIHkxID0gZWwxLmdldEF0dHJpYnV0ZSgnZGF0YS15Jyk7XHJcbiAgICAgICAgICAgIGlmIChlbDIpIHtcclxuICAgICAgICAgICAgICAgIHZhciB4MiA9IGVsMi5nZXRBdHRyaWJ1dGUoJ2RhdGEteCcpO1xyXG4gICAgICAgICAgICAgICAgdmFyIHkyID0gZWwyLmdldEF0dHJpYnV0ZSgnZGF0YS15Jyk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgeDIgPSB4MTtcclxuICAgICAgICAgICAgICAgIHZhciB5MiA9IHkxO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBvYmoudXBkYXRlU2VsZWN0aW9uRnJvbUNvb3Jkcyh4MSwgeTEsIHgyLCB5Miwgb3JpZ2luKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIFVwZGF0ZSBzZWxlY3Rpb24gZnJvbSBjb29yZHNcclxuICAgICAgICAgKi9cclxuICAgICAgICBvYmoudXBkYXRlU2VsZWN0aW9uRnJvbUNvb3JkcyA9IGZ1bmN0aW9uICh4MSwgeTEsIHgyLCB5Miwgb3JpZ2luKSB7XHJcblxyXG4gICAgICAgICAgICAvLyBSZXNldCBTZWxlY3Rpb25cclxuICAgICAgICAgICAgdmFyIHVwZGF0ZWQgPSBudWxsO1xyXG4gICAgICAgICAgICB2YXIgcHJldmlvdXNTdGF0ZSA9IG9iai5yZXNldFNlbGVjdGlvbih0cnVlKTtcclxuXHJcbiAgICAgICAgICAgIC8vIFNhbWUgZWxlbWVudFxyXG4gICAgICAgICAgICBpZiAoeDIgPT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgeDIgPSB4MTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoeTIgPT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgeTIgPSB5MTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gU2VsZWN0aW9uIG11c3QgYmUgd2l0aGluIHRoZSBleGlzdGluZyBkYXRhXHJcbiAgICAgICAgICAgIGlmICh4MSA+PSBvYmouaGVhZGVycy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgIHgxID0gb2JqLmhlYWRlcnMubGVuZ3RoIC0gMTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoeTEgPj0gb2JqLnJvd3MubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICB5MSA9IG9iai5yb3dzLmxlbmd0aCAtIDE7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKHgyID49IG9iai5oZWFkZXJzLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgeDIgPSBvYmouaGVhZGVycy5sZW5ndGggLSAxO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICh5MiA+PSBvYmoucm93cy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgIHkyID0gb2JqLnJvd3MubGVuZ3RoIC0gMTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gS2VlcCBzZWxlY3RlZCBjZWxsXHJcbiAgICAgICAgICAgIG9iai5zZWxlY3RlZENlbGwgPSBbeDEsIHkxLCB4MiwgeTJdO1xyXG5cclxuICAgICAgICAgICAgLy8gU2VsZWN0IGNlbGxzXHJcbiAgICAgICAgICAgIGlmICh4MSAhPSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAvLyBBZGQgc2VsZWN0ZWQgY2VsbFxyXG4gICAgICAgICAgICAgICAgaWYgKG9iai5yZWNvcmRzW3kxXVt4MV0pIHtcclxuICAgICAgICAgICAgICAgICAgICBvYmoucmVjb3Jkc1t5MV1beDFdLmNsYXNzTGlzdC5hZGQoJ2hpZ2hsaWdodC1zZWxlY3RlZCcpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIC8vIE9yaWdpbiAmIERlc3RpbmF0aW9uXHJcbiAgICAgICAgICAgICAgICBpZiAocGFyc2VJbnQoeDEpIDwgcGFyc2VJbnQoeDIpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHB4ID0gcGFyc2VJbnQoeDEpO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciB1eCA9IHBhcnNlSW50KHgyKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHB4ID0gcGFyc2VJbnQoeDIpO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciB1eCA9IHBhcnNlSW50KHgxKTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBpZiAocGFyc2VJbnQoeTEpIDwgcGFyc2VJbnQoeTIpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHB5ID0gcGFyc2VJbnQoeTEpO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciB1eSA9IHBhcnNlSW50KHkyKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHB5ID0gcGFyc2VJbnQoeTIpO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciB1eSA9IHBhcnNlSW50KHkxKTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAvLyBWZXJpZnkgbWVyZ2VkIGNvbHVtbnNcclxuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSBweDsgaSA8PSB1eDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaiA9IHB5OyBqIDw9IHV5OyBqKyspIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG9iai5yZWNvcmRzW2pdW2ldICYmIG9iai5yZWNvcmRzW2pdW2ldLmdldEF0dHJpYnV0ZSgnZGF0YS1tZXJnZWQnKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHggPSBwYXJzZUludChvYmoucmVjb3Jkc1tqXVtpXS5nZXRBdHRyaWJ1dGUoJ2RhdGEteCcpKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB5ID0gcGFyc2VJbnQob2JqLnJlY29yZHNbal1baV0uZ2V0QXR0cmlidXRlKCdkYXRhLXknKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgY29sc3BhbiA9IHBhcnNlSW50KG9iai5yZWNvcmRzW2pdW2ldLmdldEF0dHJpYnV0ZSgnY29sc3BhbicpKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciByb3dzcGFuID0gcGFyc2VJbnQob2JqLnJlY29yZHNbal1baV0uZ2V0QXR0cmlidXRlKCdyb3dzcGFuJykpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjb2xzcGFuID4gMSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh4IDwgcHgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHggPSB4O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoeCArIGNvbHNwYW4gPiB1eCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1eCA9IHggKyBjb2xzcGFuIC0gMTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJvd3NwYW4pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoeSA8IHB5KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHB5ID0geTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh5ICsgcm93c3BhbiA+IHV5KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHV5ID0geSArIHJvd3NwYW4gLSAxO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAvLyBMaW1pdHNcclxuICAgICAgICAgICAgICAgIHZhciBib3JkZXJMZWZ0ID0gbnVsbDtcclxuICAgICAgICAgICAgICAgIHZhciBib3JkZXJSaWdodCA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICB2YXIgYm9yZGVyVG9wID0gbnVsbDtcclxuICAgICAgICAgICAgICAgIHZhciBib3JkZXJCb3R0b20gPSBudWxsO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIFZlcnRpY2FsIGxpbWl0c1xyXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaiA9IHB5OyBqIDw9IHV5OyBqKyspIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAob2JqLnJvd3Nbal0uc3R5bGUuZGlzcGxheSAhPSAnbm9uZScpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGJvcmRlclRvcCA9PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBib3JkZXJUb3AgPSBqO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJvcmRlckJvdHRvbSA9IGo7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIC8vIFJlZGVmaW5pbmcgc3R5bGVzXHJcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gcHg7IGkgPD0gdXg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGogPSBweTsgaiA8PSB1eTsgaisrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChvYmoucm93c1tqXS5zdHlsZS5kaXNwbGF5ICE9ICdub25lJyAmJiBvYmoucmVjb3Jkc1tqXVtpXS5zdHlsZS5kaXNwbGF5ICE9ICdub25lJykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb2JqLnJlY29yZHNbal1baV0uY2xhc3NMaXN0LmFkZCgnaGlnaGxpZ2h0Jyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmouaGlnaGxpZ2h0ZWQucHVzaChvYmoucmVjb3Jkc1tqXVtpXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIC8vIEhvcml6b250YWwgbGltaXRzXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKG9iai5vcHRpb25zLmNvbHVtbnNbaV0udHlwZSAhPSAnaGlkZGVuJykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoYm9yZGVyTGVmdCA9PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBib3JkZXJMZWZ0ID0gaTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBib3JkZXJSaWdodCA9IGk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIC8vIENyZWF0ZSBib3JkZXJzXHJcbiAgICAgICAgICAgICAgICBpZiAoIWJvcmRlckxlZnQpIHtcclxuICAgICAgICAgICAgICAgICAgICBib3JkZXJMZWZ0ID0gMDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmICghYm9yZGVyUmlnaHQpIHtcclxuICAgICAgICAgICAgICAgICAgICBib3JkZXJSaWdodCA9IDA7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gYm9yZGVyTGVmdDsgaSA8PSBib3JkZXJSaWdodDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKG9iai5vcHRpb25zLmNvbHVtbnNbaV0udHlwZSAhPSAnaGlkZGVuJykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBUb3AgYm9yZGVyXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChvYmoucmVjb3Jkc1tib3JkZXJUb3BdICYmIG9iai5yZWNvcmRzW2JvcmRlclRvcF1baV0pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9iai5yZWNvcmRzW2JvcmRlclRvcF1baV0uY2xhc3NMaXN0LmFkZCgnaGlnaGxpZ2h0LXRvcCcpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEJvdHRvbSBib3JkZXJcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG9iai5yZWNvcmRzW2JvcmRlckJvdHRvbV0gJiYgb2JqLnJlY29yZHNbYm9yZGVyQm90dG9tXVtpXSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb2JqLnJlY29yZHNbYm9yZGVyQm90dG9tXVtpXS5jbGFzc0xpc3QuYWRkKCdoaWdobGlnaHQtYm90dG9tJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gQWRkIHNlbGVjdGVkIGZyb20gaGVhZGVyc1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBvYmouaGVhZGVyc1tpXS5jbGFzc0xpc3QuYWRkKCdzZWxlY3RlZCcpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBqID0gYm9yZGVyVG9wOyBqIDw9IGJvcmRlckJvdHRvbTsgaisrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKG9iai5yb3dzW2pdICYmIG9iai5yb3dzW2pdLnN0eWxlLmRpc3BsYXkgIT0gJ25vbmUnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIExlZnQgYm9yZGVyXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9iai5yZWNvcmRzW2pdW2JvcmRlckxlZnRdLmNsYXNzTGlzdC5hZGQoJ2hpZ2hsaWdodC1sZWZ0Jyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFJpZ2h0IGJvcmRlclxyXG4gICAgICAgICAgICAgICAgICAgICAgICBvYmoucmVjb3Jkc1tqXVtib3JkZXJSaWdodF0uY2xhc3NMaXN0LmFkZCgnaGlnaGxpZ2h0LXJpZ2h0Jyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEFkZCBzZWxlY3RlZCBmcm9tIHJvd3NcclxuICAgICAgICAgICAgICAgICAgICAgICAgb2JqLnJvd3Nbal0uY2xhc3NMaXN0LmFkZCgnc2VsZWN0ZWQnKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgb2JqLnNlbGVjdGVkQ29udGFpbmVyID0gW2JvcmRlckxlZnQsIGJvcmRlclRvcCwgYm9yZGVyUmlnaHQsIGJvcmRlckJvdHRvbV07XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIEhhbmRsZSBldmVudHNcclxuICAgICAgICAgICAgaWYgKHByZXZpb3VzU3RhdGUgPT0gMCkge1xyXG4gICAgICAgICAgICAgICAgb2JqLmRpc3BhdGNoKCdvbmZvY3VzJywgZWwpO1xyXG5cclxuICAgICAgICAgICAgICAgIG9iai5yZW1vdmVDb3B5aW5nU2VsZWN0aW9uKCk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIG9iai5kaXNwYXRjaCgnb25zZWxlY3Rpb24nLCBlbCwgYm9yZGVyTGVmdCwgYm9yZGVyVG9wLCBib3JkZXJSaWdodCwgYm9yZGVyQm90dG9tLCBvcmlnaW4pO1xyXG5cclxuICAgICAgICAgICAgLy8gRmluZCBjb3JuZXIgY2VsbFxyXG4gICAgICAgICAgICBvYmoudXBkYXRlQ29ybmVyUG9zaXRpb24oKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIFJlbW92ZSBjb3B5IHNlbGVjdGlvblxyXG4gICAgICAgICAqXHJcbiAgICAgICAgICogQHJldHVybiB2b2lkXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgb2JqLnJlbW92ZUNvcHlTZWxlY3Rpb24gPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIC8vIFJlbW92ZSBjdXJyZW50IHNlbGVjdGlvblxyXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG9iai5zZWxlY3Rpb24ubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgIG9iai5zZWxlY3Rpb25baV0uY2xhc3NMaXN0LnJlbW92ZSgnc2VsZWN0aW9uJyk7XHJcbiAgICAgICAgICAgICAgICBvYmouc2VsZWN0aW9uW2ldLmNsYXNzTGlzdC5yZW1vdmUoJ3NlbGVjdGlvbi1sZWZ0Jyk7XHJcbiAgICAgICAgICAgICAgICBvYmouc2VsZWN0aW9uW2ldLmNsYXNzTGlzdC5yZW1vdmUoJ3NlbGVjdGlvbi1yaWdodCcpO1xyXG4gICAgICAgICAgICAgICAgb2JqLnNlbGVjdGlvbltpXS5jbGFzc0xpc3QucmVtb3ZlKCdzZWxlY3Rpb24tdG9wJyk7XHJcbiAgICAgICAgICAgICAgICBvYmouc2VsZWN0aW9uW2ldLmNsYXNzTGlzdC5yZW1vdmUoJ3NlbGVjdGlvbi1ib3R0b20nKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgb2JqLnNlbGVjdGlvbiA9IFtdO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogVXBkYXRlIGNvcHkgc2VsZWN0aW9uXHJcbiAgICAgICAgICpcclxuICAgICAgICAgKiBAcGFyYW0gaW50IHgsIHlcclxuICAgICAgICAgKiBAcmV0dXJuIHZvaWRcclxuICAgICAgICAgKi9cclxuICAgICAgICBvYmoudXBkYXRlQ29weVNlbGVjdGlvbiA9IGZ1bmN0aW9uICh4MywgeTMpIHtcclxuICAgICAgICAgICAgLy8gUmVtb3ZlIHNlbGVjdGlvblxyXG4gICAgICAgICAgICBvYmoucmVtb3ZlQ29weVNlbGVjdGlvbigpO1xyXG5cclxuICAgICAgICAgICAgLy8gR2V0IGVsZW1lbnRzIGZpcnN0IGFuZCBsYXN0XHJcbiAgICAgICAgICAgIHZhciB4MSA9IG9iai5zZWxlY3RlZENvbnRhaW5lclswXTtcclxuICAgICAgICAgICAgdmFyIHkxID0gb2JqLnNlbGVjdGVkQ29udGFpbmVyWzFdO1xyXG4gICAgICAgICAgICB2YXIgeDIgPSBvYmouc2VsZWN0ZWRDb250YWluZXJbMl07XHJcbiAgICAgICAgICAgIHZhciB5MiA9IG9iai5zZWxlY3RlZENvbnRhaW5lclszXTtcclxuXHJcbiAgICAgICAgICAgIGlmICh4MyAhPSBudWxsICYmIHkzICE9IG51bGwpIHtcclxuICAgICAgICAgICAgICAgIGlmICh4MyAtIHgyID4gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBweCA9IHBhcnNlSW50KHgyKSArIDE7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHV4ID0gcGFyc2VJbnQoeDMpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgcHggPSBwYXJzZUludCh4Myk7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHV4ID0gcGFyc2VJbnQoeDEpIC0gMTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoeTMgLSB5MiA+IDApIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgcHkgPSBwYXJzZUludCh5MikgKyAxO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciB1eSA9IHBhcnNlSW50KHkzKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHB5ID0gcGFyc2VJbnQoeTMpO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciB1eSA9IHBhcnNlSW50KHkxKSAtIDE7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKHV4IC0gcHggPD0gdXkgLSBweSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBweCA9IHBhcnNlSW50KHgxKTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgdXggPSBwYXJzZUludCh4Mik7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBweSA9IHBhcnNlSW50KHkxKTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgdXkgPSBwYXJzZUludCh5Mik7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaiA9IHB5OyBqIDw9IHV5OyBqKyspIHtcclxuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gcHg7IGkgPD0gdXg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAob2JqLnJlY29yZHNbal1baV0gJiYgb2JqLnJvd3Nbal0uc3R5bGUuZGlzcGxheSAhPSAnbm9uZScgJiYgb2JqLnJlY29yZHNbal1baV0uc3R5bGUuZGlzcGxheSAhPSAnbm9uZScpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9iai5yZWNvcmRzW2pdW2ldLmNsYXNzTGlzdC5hZGQoJ3NlbGVjdGlvbicpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb2JqLnJlY29yZHNbcHldW2ldLmNsYXNzTGlzdC5hZGQoJ3NlbGVjdGlvbi10b3AnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9iai5yZWNvcmRzW3V5XVtpXS5jbGFzc0xpc3QuYWRkKCdzZWxlY3Rpb24tYm90dG9tJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmoucmVjb3Jkc1tqXVtweF0uY2xhc3NMaXN0LmFkZCgnc2VsZWN0aW9uLWxlZnQnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9iai5yZWNvcmRzW2pdW3V4XS5jbGFzc0xpc3QuYWRkKCdzZWxlY3Rpb24tcmlnaHQnKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBQZXJzaXN0IHNlbGVjdGVkIGVsZW1lbnRzXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmouc2VsZWN0aW9uLnB1c2gob2JqLnJlY29yZHNbal1baV0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvKipcclxuICAgICAgICAgKiBVcGRhdGUgY29ybmVyIHBvc2l0aW9uXHJcbiAgICAgICAgICpcclxuICAgICAgICAgKiBAcmV0dXJuIHZvaWRcclxuICAgICAgICAgKi9cclxuICAgICAgICBvYmoudXBkYXRlQ29ybmVyUG9zaXRpb24gPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIC8vIElmIGFueSBzZWxlY3RlZCBjZWxsc1xyXG4gICAgICAgICAgICBpZiAoIW9iai5oaWdobGlnaHRlZC5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgIG9iai5jb3JuZXIuc3R5bGUudG9wID0gJy0yMDAwcHgnO1xyXG4gICAgICAgICAgICAgICAgb2JqLmNvcm5lci5zdHlsZS5sZWZ0ID0gJy0yMDAwcHgnO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgLy8gR2V0IGxhc3QgY2VsbFxyXG4gICAgICAgICAgICAgICAgdmFyIGxhc3QgPSBvYmouaGlnaGxpZ2h0ZWRbb2JqLmhpZ2hsaWdodGVkLmxlbmd0aCAtIDFdO1xyXG5cclxuICAgICAgICAgICAgICAgIHZhciBjb250ZW50UmVjdCA9IG9iai5jb250ZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xyXG4gICAgICAgICAgICAgICAgdmFyIHgxID0gY29udGVudFJlY3QubGVmdDtcclxuICAgICAgICAgICAgICAgIHZhciB5MSA9IGNvbnRlbnRSZWN0LnRvcDtcclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgbGFzdFJlY3QgPSBsYXN0LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xyXG4gICAgICAgICAgICAgICAgdmFyIHgyID0gbGFzdFJlY3QubGVmdDtcclxuICAgICAgICAgICAgICAgIHZhciB5MiA9IGxhc3RSZWN0LnRvcDtcclxuICAgICAgICAgICAgICAgIHZhciB3MiA9IGxhc3RSZWN0LndpZHRoO1xyXG4gICAgICAgICAgICAgICAgdmFyIGgyID0gbGFzdFJlY3QuaGVpZ2h0O1xyXG5cclxuICAgICAgICAgICAgICAgIHZhciB4ID0gKHgyIC0geDEpICsgb2JqLmNvbnRlbnQuc2Nyb2xsTGVmdCArIHcyIC0gNDtcclxuICAgICAgICAgICAgICAgIHZhciB5ID0gKHkyIC0geTEpICsgb2JqLmNvbnRlbnQuc2Nyb2xsVG9wICsgaDIgLSA0O1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIFBsYWNlIHRoZSBjb3JuZXIgaW4gdGhlIGNvcnJlY3QgcGxhY2VcclxuICAgICAgICAgICAgICAgIG9iai5jb3JuZXIuc3R5bGUudG9wID0geSArICdweCc7XHJcbiAgICAgICAgICAgICAgICBvYmouY29ybmVyLnN0eWxlLmxlZnQgPSB4ICsgJ3B4JztcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAob2JqLm9wdGlvbnMuZnJlZXplQ29sdW1ucykge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciB3aWR0aCA9IG9iai5nZXRGcmVlemVXaWR0aCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh4MiAtIHgxICsgdzIgPCB3aWR0aCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBvYmouY29ybmVyLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG9iai5vcHRpb25zLnNlbGVjdGlvbkNvcHkgPT0gdHJ1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb2JqLmNvcm5lci5zdHlsZS5kaXNwbGF5ID0gJyc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChvYmoub3B0aW9ucy5zZWxlY3Rpb25Db3B5ID09IHRydWUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgb2JqLmNvcm5lci5zdHlsZS5kaXNwbGF5ID0gJyc7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvKipcclxuICAgICAgICAgKiBVcGRhdGUgc2Nyb2xsIHBvc2l0aW9uIGJhc2VkIG9uIHRoZSBzZWxlY3Rpb25cclxuICAgICAgICAgKi9cclxuICAgICAgICBvYmoudXBkYXRlU2Nyb2xsID0gZnVuY3Rpb24gKGRpcmVjdGlvbikge1xyXG4gICAgICAgICAgICAvLyBqRXhjZWwgQ29udGFpbmVyIGluZm9ybWF0aW9uXHJcbiAgICAgICAgICAgIHZhciBjb250ZW50UmVjdCA9IG9iai5jb250ZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xyXG4gICAgICAgICAgICB2YXIgeDEgPSBjb250ZW50UmVjdC5sZWZ0O1xyXG4gICAgICAgICAgICB2YXIgeTEgPSBjb250ZW50UmVjdC50b3A7XHJcbiAgICAgICAgICAgIHZhciB3MSA9IGNvbnRlbnRSZWN0LndpZHRoO1xyXG4gICAgICAgICAgICB2YXIgaDEgPSBjb250ZW50UmVjdC5oZWlnaHQ7XHJcblxyXG4gICAgICAgICAgICAvLyBEaXJlY3Rpb24gTGVmdCBvciBVcFxyXG4gICAgICAgICAgICB2YXIgcmVmZXJlbmNlID0gb2JqLnJlY29yZHNbb2JqLnNlbGVjdGVkQ2VsbFszXV1bb2JqLnNlbGVjdGVkQ2VsbFsyXV07XHJcblxyXG4gICAgICAgICAgICAvLyBSZWZlcmVuY2VcclxuICAgICAgICAgICAgdmFyIHJlZmVyZW5jZVJlY3QgPSByZWZlcmVuY2UuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XHJcbiAgICAgICAgICAgIHZhciB4MiA9IHJlZmVyZW5jZVJlY3QubGVmdDtcclxuICAgICAgICAgICAgdmFyIHkyID0gcmVmZXJlbmNlUmVjdC50b3A7XHJcbiAgICAgICAgICAgIHZhciB3MiA9IHJlZmVyZW5jZVJlY3Qud2lkdGg7XHJcbiAgICAgICAgICAgIHZhciBoMiA9IHJlZmVyZW5jZVJlY3QuaGVpZ2h0O1xyXG5cclxuICAgICAgICAgICAgLy8gRGlyZWN0aW9uXHJcbiAgICAgICAgICAgIGlmIChkaXJlY3Rpb24gPT0gMCB8fCBkaXJlY3Rpb24gPT0gMSkge1xyXG4gICAgICAgICAgICAgICAgdmFyIHggPSAoeDIgLSB4MSkgKyBvYmouY29udGVudC5zY3JvbGxMZWZ0O1xyXG4gICAgICAgICAgICAgICAgdmFyIHkgPSAoeTIgLSB5MSkgKyBvYmouY29udGVudC5zY3JvbGxUb3AgLSAyO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdmFyIHggPSAoeDIgLSB4MSkgKyBvYmouY29udGVudC5zY3JvbGxMZWZ0ICsgdzI7XHJcbiAgICAgICAgICAgICAgICB2YXIgeSA9ICh5MiAtIHkxKSArIG9iai5jb250ZW50LnNjcm9sbFRvcCArIGgyO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBUb3AgcG9zaXRpb24gY2hlY2tcclxuICAgICAgICAgICAgaWYgKHkgPiAob2JqLmNvbnRlbnQuc2Nyb2xsVG9wICsgMzApICYmIHkgPCAob2JqLmNvbnRlbnQuc2Nyb2xsVG9wICsgaDEpKSB7XHJcbiAgICAgICAgICAgICAgICAvLyBJbiB0aGUgdmlld3BvcnRcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIC8vIE91dCBvZiB2aWV3cG9ydFxyXG4gICAgICAgICAgICAgICAgaWYgKHkgPCBvYmouY29udGVudC5zY3JvbGxUb3AgKyAzMCkge1xyXG4gICAgICAgICAgICAgICAgICAgIG9iai5jb250ZW50LnNjcm9sbFRvcCA9IHkgLSBoMjtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgb2JqLmNvbnRlbnQuc2Nyb2xsVG9wID0geSAtIChoMSAtIDIpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBGcmVlemUgY29sdW1ucz9cclxuICAgICAgICAgICAgdmFyIGZyZWV6ZWQgPSBvYmouZ2V0RnJlZXplV2lkdGgoKTtcclxuXHJcbiAgICAgICAgICAgIC8vIExlZnQgcG9zaXRpb24gY2hlY2sgLSBUT0RPOiBjaGFuZ2UgdGhhdCB0byB0aGUgYm90dG9tIGJvcmRlciBvZiB0aGUgZWxlbWVudFxyXG4gICAgICAgICAgICBpZiAoeCA+IChvYmouY29udGVudC5zY3JvbGxMZWZ0ICsgZnJlZXplZCkgJiYgeCA8IChvYmouY29udGVudC5zY3JvbGxMZWZ0ICsgdzEpKSB7XHJcbiAgICAgICAgICAgICAgICAvLyBJbiB0aGUgdmlld3BvcnRcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIC8vIE91dCBvZiB2aWV3cG9ydFxyXG4gICAgICAgICAgICAgICAgaWYgKHggPCBvYmouY29udGVudC5zY3JvbGxMZWZ0ICsgMzApIHtcclxuICAgICAgICAgICAgICAgICAgICBvYmouY29udGVudC5zY3JvbGxMZWZ0ID0geDtcclxuICAgICAgICAgICAgICAgICAgICBpZiAob2JqLmNvbnRlbnQuc2Nyb2xsTGVmdCA8IDUwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9iai5jb250ZW50LnNjcm9sbExlZnQgPSAwO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoeCA8IG9iai5jb250ZW50LnNjcm9sbExlZnQgKyBmcmVlemVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgb2JqLmNvbnRlbnQuc2Nyb2xsTGVmdCA9IHggLSBmcmVlemVkIC0gMTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgb2JqLmNvbnRlbnQuc2Nyb2xsTGVmdCA9IHggLSAodzEgLSAyMCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIEdldCB0aGUgY29sdW1uIHdpZHRoXHJcbiAgICAgICAgICpcclxuICAgICAgICAgKiBAcGFyYW0gaW50IGNvbHVtbiBjb2x1bW4gbnVtYmVyIChmaXJzdCBjb2x1bW4gaXM6IDApXHJcbiAgICAgICAgICogQHJldHVybiBpbnQgY3VycmVudCB3aWR0aFxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIG9iai5nZXRXaWR0aCA9IGZ1bmN0aW9uIChjb2x1bW4pIHtcclxuICAgICAgICAgICAgaWYgKCFjb2x1bW4pIHtcclxuICAgICAgICAgICAgICAgIC8vIEdldCBhbGwgaGVhZGVyc1xyXG4gICAgICAgICAgICAgICAgdmFyIGRhdGEgPSBbXTtcclxuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgb2JqLmhlYWRlcnMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgICAgICBkYXRhLnB1c2gob2JqLm9wdGlvbnMuY29sdW1uc1tpXS53aWR0aCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAvLyBJbiBjYXNlIHRoZSBjb2x1bW4gaXMgYW4gb2JqZWN0XHJcbiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIChjb2x1bW4pID09ICdvYmplY3QnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29sdW1uID0gJChjb2x1bW4pLmdldEF0dHJpYnV0ZSgnZGF0YS14Jyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgZGF0YSA9IG9iai5jb2xncm91cFtjb2x1bW5dLmdldEF0dHJpYnV0ZSgnd2lkdGgnKVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gZGF0YTtcclxuICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICAvKipcclxuICAgICAgICAgKiBTZXQgdGhlIGNvbHVtbiB3aWR0aFxyXG4gICAgICAgICAqXHJcbiAgICAgICAgICogQHBhcmFtIGludCBjb2x1bW4gbnVtYmVyIChmaXJzdCBjb2x1bW4gaXM6IDApXHJcbiAgICAgICAgICogQHBhcmFtIGludCBuZXcgY29sdW1uIHdpZHRoXHJcbiAgICAgICAgICogQHBhcmFtIGludCBvbGQgY29sdW1uIHdpZHRoXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgb2JqLnNldFdpZHRoID0gZnVuY3Rpb24gKGNvbHVtbiwgd2lkdGgsIG9sZFdpZHRoKSB7XHJcbiAgICAgICAgICAgIGlmICh3aWR0aCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkoY29sdW1uKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIE9sZHdpZHRoXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFvbGRXaWR0aCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgb2xkV2lkdGggPSBbXTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gU2V0IHdpZHRoXHJcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBjb2x1bW4ubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFvbGRXaWR0aFtpXSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb2xkV2lkdGhbaV0gPSBvYmouY29sZ3JvdXBbY29sdW1uW2ldXS5nZXRBdHRyaWJ1dGUoJ3dpZHRoJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHcgPSBBcnJheS5pc0FycmF5KHdpZHRoKSAmJiB3aWR0aFtpXSA/IHdpZHRoW2ldIDogd2lkdGg7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9iai5jb2xncm91cFtjb2x1bW5baV1dLnNldEF0dHJpYnV0ZSgnd2lkdGgnLCB3KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgb2JqLm9wdGlvbnMuY29sdW1uc1tjb2x1bW5baV1dLndpZHRoID0gdztcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIE9sZHdpZHRoXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFvbGRXaWR0aCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBvbGRXaWR0aCA9IG9iai5jb2xncm91cFtjb2x1bW5dLmdldEF0dHJpYnV0ZSgnd2lkdGgnKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gU2V0IHdpZHRoXHJcbiAgICAgICAgICAgICAgICAgICAgb2JqLmNvbGdyb3VwW2NvbHVtbl0uc2V0QXR0cmlidXRlKCd3aWR0aCcsIHdpZHRoKTtcclxuICAgICAgICAgICAgICAgICAgICBvYmoub3B0aW9ucy5jb2x1bW5zW2NvbHVtbl0ud2lkdGggPSB3aWR0aDtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAvLyBLZWVwaW5nIGhpc3Rvcnkgb2YgY2hhbmdlc1xyXG4gICAgICAgICAgICAgICAgb2JqLnNldEhpc3Rvcnkoe1xyXG4gICAgICAgICAgICAgICAgICAgIGFjdGlvbjogJ3NldFdpZHRoJyxcclxuICAgICAgICAgICAgICAgICAgICBjb2x1bW46IGNvbHVtbixcclxuICAgICAgICAgICAgICAgICAgICBvbGRWYWx1ZTogb2xkV2lkdGgsXHJcbiAgICAgICAgICAgICAgICAgICAgbmV3VmFsdWU6IHdpZHRoLFxyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gT24gcmVzaXplIGNvbHVtblxyXG4gICAgICAgICAgICAgICAgb2JqLmRpc3BhdGNoKCdvbnJlc2l6ZWNvbHVtbicsIGVsLCBjb2x1bW4sIHdpZHRoLCBvbGRXaWR0aCk7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gVXBkYXRlIGNvcm5lciBwb3NpdGlvblxyXG4gICAgICAgICAgICAgICAgb2JqLnVwZGF0ZUNvcm5lclBvc2l0aW9uKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIFNldCB0aGUgcm93IGhlaWdodFxyXG4gICAgICAgICAqXHJcbiAgICAgICAgICogQHBhcmFtIHJvdyAtIHJvdyBudW1iZXIgKGZpcnN0IHJvdyBpczogMClcclxuICAgICAgICAgKiBAcGFyYW0gaGVpZ2h0IC0gbmV3IHJvdyBoZWlnaHRcclxuICAgICAgICAgKiBAcGFyYW0gb2xkSGVpZ2h0IC0gb2xkIHJvdyBoZWlnaHRcclxuICAgICAgICAgKi9cclxuICAgICAgICBvYmouc2V0SGVpZ2h0ID0gZnVuY3Rpb24gKHJvdywgaGVpZ2h0LCBvbGRIZWlnaHQpIHtcclxuICAgICAgICAgICAgaWYgKGhlaWdodCA+IDApIHtcclxuICAgICAgICAgICAgICAgIC8vIEluIGNhc2UgdGhlIGNvbHVtbiBpcyBhbiBvYmplY3RcclxuICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgKHJvdykgPT0gJ29iamVjdCcpIHtcclxuICAgICAgICAgICAgICAgICAgICByb3cgPSByb3cuZ2V0QXR0cmlidXRlKCdkYXRhLXknKTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAvLyBPbGR3aWR0aFxyXG4gICAgICAgICAgICAgICAgaWYgKCFvbGRIZWlnaHQpIHtcclxuICAgICAgICAgICAgICAgICAgICBvbGRIZWlnaHQgPSBvYmoucm93c1tyb3ddLmdldEF0dHJpYnV0ZSgnaGVpZ2h0Jyk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmICghb2xkSGVpZ2h0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciByZWN0ID0gb2JqLnJvd3Nbcm93XS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgb2xkSGVpZ2h0ID0gcmVjdC5oZWlnaHQ7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIC8vIEludGVnZXJcclxuICAgICAgICAgICAgICAgIGhlaWdodCA9IHBhcnNlSW50KGhlaWdodCk7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gU2V0IHdpZHRoXHJcbiAgICAgICAgICAgICAgICBvYmoucm93c1tyb3ddLnN0eWxlLmhlaWdodCA9IGhlaWdodCArICdweCc7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gS2VlcCBvcHRpb25zIHVwZGF0ZWRcclxuICAgICAgICAgICAgICAgIGlmICghb2JqLm9wdGlvbnMucm93c1tyb3ddKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgb2JqLm9wdGlvbnMucm93c1tyb3ddID0ge307XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBvYmoub3B0aW9ucy5yb3dzW3Jvd10uaGVpZ2h0ID0gaGVpZ2h0O1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIEtlZXBpbmcgaGlzdG9yeSBvZiBjaGFuZ2VzXHJcbiAgICAgICAgICAgICAgICBvYmouc2V0SGlzdG9yeSh7XHJcbiAgICAgICAgICAgICAgICAgICAgYWN0aW9uOiAnc2V0SGVpZ2h0JyxcclxuICAgICAgICAgICAgICAgICAgICByb3c6IHJvdyxcclxuICAgICAgICAgICAgICAgICAgICBvbGRWYWx1ZTogb2xkSGVpZ2h0LFxyXG4gICAgICAgICAgICAgICAgICAgIG5ld1ZhbHVlOiBoZWlnaHQsXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyBPbiByZXNpemUgY29sdW1uXHJcbiAgICAgICAgICAgICAgICBvYmouZGlzcGF0Y2goJ29ucmVzaXplcm93JywgZWwsIHJvdywgaGVpZ2h0LCBvbGRIZWlnaHQpO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIFVwZGF0ZSBjb3JuZXIgcG9zaXRpb25cclxuICAgICAgICAgICAgICAgIG9iai51cGRhdGVDb3JuZXJQb3NpdGlvbigpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvKipcclxuICAgICAgICAgKiBHZXQgdGhlIHJvdyBoZWlnaHRcclxuICAgICAgICAgKlxyXG4gICAgICAgICAqIEBwYXJhbSByb3cgLSByb3cgbnVtYmVyIChmaXJzdCByb3cgaXM6IDApXHJcbiAgICAgICAgICogQHJldHVybiBoZWlnaHQgLSBjdXJyZW50IHJvdyBoZWlnaHRcclxuICAgICAgICAgKi9cclxuICAgICAgICBvYmouZ2V0SGVpZ2h0ID0gZnVuY3Rpb24gKHJvdykge1xyXG4gICAgICAgICAgICBpZiAoIXJvdykge1xyXG4gICAgICAgICAgICAgICAgLy8gR2V0IGhlaWdodCBvZiBhbGwgcm93c1xyXG4gICAgICAgICAgICAgICAgdmFyIGRhdGEgPSBbXTtcclxuICAgICAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgb2JqLnJvd3MubGVuZ3RoOyBqKyspIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgaCA9IG9iai5yb3dzW2pdLnN0eWxlLmhlaWdodDtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoaCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRhW2pdID0gaDtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAvLyBJbiBjYXNlIHRoZSByb3cgaXMgYW4gb2JqZWN0XHJcbiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIChyb3cpID09ICdvYmplY3QnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcm93ID0gJChyb3cpLmdldEF0dHJpYnV0ZSgnZGF0YS15Jyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIGRhdGEgPSBvYmoucm93c1tyb3ddLnN0eWxlLmhlaWdodDtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgcmV0dXJuIGRhdGE7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBvYmouc2V0Rm9vdGVyID0gZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgaWYgKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgIG9iai5vcHRpb25zLmZvb3RlcnMgPSBkYXRhO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAob2JqLm9wdGlvbnMuZm9vdGVycykge1xyXG4gICAgICAgICAgICAgICAgaWYgKCFvYmoudGZvb3QpIHtcclxuICAgICAgICAgICAgICAgICAgICBvYmoudGZvb3QgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0Zm9vdCcpO1xyXG4gICAgICAgICAgICAgICAgICAgIG9iai50YWJsZS5hcHBlbmRDaGlsZChvYmoudGZvb3QpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgb2JqLm9wdGlvbnMuZm9vdGVycy5sZW5ndGg7IGorKykge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChvYmoudGZvb3QuY2hpbGRyZW5bal0pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHRyID0gb2JqLnRmb290LmNoaWxkcmVuW2pdO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0ciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RyJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0ZCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RkJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRyLmFwcGVuZENoaWxkKHRkKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgb2JqLnRmb290LmFwcGVuZENoaWxkKHRyKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBvYmouaGVhZGVycy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIW9iai5vcHRpb25zLmZvb3RlcnNbal1baV0pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9iai5vcHRpb25zLmZvb3RlcnNbal1baV0gPSAnJztcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAob2JqLnRmb290LmNoaWxkcmVuW2pdLmNoaWxkcmVuW2kgKyAxXSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHRkID0gb2JqLnRmb290LmNoaWxkcmVuW2pdLmNoaWxkcmVuW2kgKyAxXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0ZCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RkJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ci5hcHBlbmRDaGlsZCh0ZCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gVGV4dCBhbGlnblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNvbEFsaWduID0gb2JqLm9wdGlvbnMuY29sdW1uc1tpXS5hbGlnbiA/IG9iai5vcHRpb25zLmNvbHVtbnNbaV0uYWxpZ24gOiAnY2VudGVyJztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRkLnN0eWxlLnRleHRBbGlnbiA9IGNvbEFsaWduO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRkLmlubmVyVGV4dCA9IG9iai5wYXJzZVZhbHVlKGksIGosIG9iai5vcHRpb25zLmZvb3RlcnNbal1baV0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogR2V0IHRoZSBjb2x1bW4gdGl0bGVcclxuICAgICAgICAgKlxyXG4gICAgICAgICAqIEBwYXJhbSBjb2x1bW4gLSBjb2x1bW4gbnVtYmVyIChmaXJzdCBjb2x1bW4gaXM6IDApXHJcbiAgICAgICAgICogQHBhcmFtIHRpdGxlIC0gbmV3IGNvbHVtbiB0aXRsZVxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIG9iai5nZXRIZWFkZXIgPSBmdW5jdGlvbiAoY29sdW1uKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBvYmouaGVhZGVyc1tjb2x1bW5dLmlubmVyVGV4dDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIFNldCB0aGUgY29sdW1uIHRpdGxlXHJcbiAgICAgICAgICpcclxuICAgICAgICAgKiBAcGFyYW0gY29sdW1uIC0gY29sdW1uIG51bWJlciAoZmlyc3QgY29sdW1uIGlzOiAwKVxyXG4gICAgICAgICAqIEBwYXJhbSB0aXRsZSAtIG5ldyBjb2x1bW4gdGl0bGVcclxuICAgICAgICAgKi9cclxuICAgICAgICBvYmouc2V0SGVhZGVyID0gZnVuY3Rpb24gKGNvbHVtbiwgbmV3VmFsdWUpIHtcclxuICAgICAgICAgICAgaWYgKG9iai5oZWFkZXJzW2NvbHVtbl0pIHtcclxuICAgICAgICAgICAgICAgIHZhciBvbGRWYWx1ZSA9IG9iai5oZWFkZXJzW2NvbHVtbl0uaW5uZXJUZXh0O1xyXG5cclxuICAgICAgICAgICAgICAgIGlmICghbmV3VmFsdWUpIHtcclxuICAgICAgICAgICAgICAgICAgICBuZXdWYWx1ZSA9IHByb21wdChvYmoub3B0aW9ucy50ZXh0LmNvbHVtbk5hbWUsIG9sZFZhbHVlKVxyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGlmIChuZXdWYWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIG9iai5oZWFkZXJzW2NvbHVtbl0uaW5uZXJUZXh0ID0gbmV3VmFsdWU7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gS2VlcCB0aGUgdGl0bGUgcHJvcGVydHlcclxuICAgICAgICAgICAgICAgICAgICBvYmouaGVhZGVyc1tjb2x1bW5dLnNldEF0dHJpYnV0ZSgndGl0bGUnLCBuZXdWYWx1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gVXBkYXRlIHRpdGxlXHJcbiAgICAgICAgICAgICAgICAgICAgb2JqLm9wdGlvbnMuY29sdW1uc1tjb2x1bW5dLnRpdGxlID0gbmV3VmFsdWU7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgb2JqLnNldEhpc3Rvcnkoe1xyXG4gICAgICAgICAgICAgICAgICAgIGFjdGlvbjogJ3NldEhlYWRlcicsXHJcbiAgICAgICAgICAgICAgICAgICAgY29sdW1uOiBjb2x1bW4sXHJcbiAgICAgICAgICAgICAgICAgICAgb2xkVmFsdWU6IG9sZFZhbHVlLFxyXG4gICAgICAgICAgICAgICAgICAgIG5ld1ZhbHVlOiBuZXdWYWx1ZVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gT24gb25jaGFuZ2UgaGVhZGVyXHJcbiAgICAgICAgICAgICAgICBvYmouZGlzcGF0Y2goJ29uY2hhbmdlaGVhZGVyJywgZWwsIGNvbHVtbiwgb2xkVmFsdWUsIG5ld1ZhbHVlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogR2V0IHRoZSBoZWFkZXJzXHJcbiAgICAgICAgICpcclxuICAgICAgICAgKiBAcGFyYW0gYXNBcnJheVxyXG4gICAgICAgICAqIEByZXR1cm4gbWl4ZWRcclxuICAgICAgICAgKi9cclxuICAgICAgICBvYmouZ2V0SGVhZGVycyA9IGZ1bmN0aW9uIChhc0FycmF5KSB7XHJcbiAgICAgICAgICAgIHZhciB0aXRsZSA9IFtdO1xyXG5cclxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBvYmouaGVhZGVycy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgdGl0bGUucHVzaChvYmouZ2V0SGVhZGVyKGkpKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgcmV0dXJuIGFzQXJyYXkgPyB0aXRsZSA6IHRpdGxlLmpvaW4ob2JqLm9wdGlvbnMuY3N2RGVsaW1pdGVyKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIEdldCBtZXRhIGluZm9ybWF0aW9uIGZyb20gY2VsbChzKVxyXG4gICAgICAgICAqXHJcbiAgICAgICAgICogQHJldHVybiBpbnRlZ2VyXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgb2JqLmdldE1ldGEgPSBmdW5jdGlvbiAoY2VsbCwga2V5KSB7XHJcbiAgICAgICAgICAgIGlmICghY2VsbCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG9iai5vcHRpb25zLm1ldGE7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoa2V5KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG9iai5vcHRpb25zLm1ldGFbY2VsbF0gJiYgb2JqLm9wdGlvbnMubWV0YVtjZWxsXVtrZXldID8gb2JqLm9wdGlvbnMubWV0YVtjZWxsXVtrZXldIDogbnVsbDtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG9iai5vcHRpb25zLm1ldGFbY2VsbF0gPyBvYmoub3B0aW9ucy5tZXRhW2NlbGxdIDogbnVsbDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogU2V0IG1ldGEgaW5mb3JtYXRpb24gdG8gY2VsbChzKVxyXG4gICAgICAgICAqXHJcbiAgICAgICAgICogQHJldHVybiBpbnRlZ2VyXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgb2JqLnNldE1ldGEgPSBmdW5jdGlvbiAobywgaywgdikge1xyXG4gICAgICAgICAgICBpZiAoIW9iai5vcHRpb25zLm1ldGEpIHtcclxuICAgICAgICAgICAgICAgIG9iai5vcHRpb25zLm1ldGEgPSB7fVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAoayAmJiB2KSB7XHJcbiAgICAgICAgICAgICAgICAvLyBTZXQgZGF0YSB2YWx1ZVxyXG4gICAgICAgICAgICAgICAgaWYgKCFvYmoub3B0aW9ucy5tZXRhW29dKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgb2JqLm9wdGlvbnMubWV0YVtvXSA9IHt9O1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgb2JqLm9wdGlvbnMubWV0YVtvXVtrXSA9IHY7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAvLyBBcHBseSB0aGF0IGZvciBhbGwgY2VsbHNcclxuICAgICAgICAgICAgICAgIHZhciBrZXlzID0gT2JqZWN0LmtleXMobyk7XHJcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGtleXMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoIW9iai5vcHRpb25zLm1ldGFba2V5c1tpXV0pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgb2JqLm9wdGlvbnMubWV0YVtrZXlzW2ldXSA9IHt9O1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHByb3AgPSBPYmplY3Qua2V5cyhvW2tleXNbaV1dKTtcclxuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IHByb3AubGVuZ3RoOyBqKyspIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgb2JqLm9wdGlvbnMubWV0YVtrZXlzW2ldXVtwcm9wW2pdXSA9IG9ba2V5c1tpXV1bcHJvcFtqXV07XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBvYmouZGlzcGF0Y2goJ29uY2hhbmdlbWV0YScsIGVsLCBvLCBrLCB2KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIFVwZGF0ZSBtZXRhIGluZm9ybWF0aW9uXHJcbiAgICAgICAgICpcclxuICAgICAgICAgKiBAcmV0dXJuIGludGVnZXJcclxuICAgICAgICAgKi9cclxuICAgICAgICBvYmoudXBkYXRlTWV0YSA9IGZ1bmN0aW9uIChhZmZlY3RlZENlbGxzKSB7XHJcbiAgICAgICAgICAgIGlmIChvYmoub3B0aW9ucy5tZXRhKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgbmV3TWV0YSA9IHt9O1xyXG4gICAgICAgICAgICAgICAgdmFyIGtleXMgPSBPYmplY3Qua2V5cyhvYmoub3B0aW9ucy5tZXRhKTtcclxuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwga2V5cy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChhZmZlY3RlZENlbGxzW2tleXNbaV1dKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG5ld01ldGFbYWZmZWN0ZWRDZWxsc1trZXlzW2ldXV0gPSBvYmoub3B0aW9ucy5tZXRhW2tleXNbaV1dO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG5ld01ldGFba2V5c1tpXV0gPSBvYmoub3B0aW9ucy5tZXRhW2tleXNbaV1dO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIC8vIFVwZGF0ZSBtZXRhIGluZm9ybWF0aW9uXHJcbiAgICAgICAgICAgICAgICBvYmoub3B0aW9ucy5tZXRhID0gbmV3TWV0YTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogR2V0IHN0eWxlIGluZm9ybWF0aW9uIGZyb20gY2VsbChzKVxyXG4gICAgICAgICAqXHJcbiAgICAgICAgICogQHJldHVybiBpbnRlZ2VyXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgb2JqLmdldFN0eWxlID0gZnVuY3Rpb24gKGNlbGwsIGtleSkge1xyXG4gICAgICAgICAgICAvLyBDZWxsXHJcbiAgICAgICAgICAgIGlmICghY2VsbCkge1xyXG4gICAgICAgICAgICAgICAgLy8gQ29udHJvbCB2YXJzXHJcbiAgICAgICAgICAgICAgICB2YXIgZGF0YSA9IHt9O1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIENvbHVtbiBhbmQgcm93IGxlbmd0aFxyXG4gICAgICAgICAgICAgICAgdmFyIHggPSBvYmoub3B0aW9ucy5kYXRhWzBdLmxlbmd0aDtcclxuICAgICAgICAgICAgICAgIHZhciB5ID0gb2JqLm9wdGlvbnMuZGF0YS5sZW5ndGg7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gR28gdGhyb3VnaCB0aGUgY29sdW1ucyB0byBnZXQgdGhlIGRhdGFcclxuICAgICAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgeTsgaisrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB4OyBpKyspIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gVmFsdWVcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHYgPSBrZXkgPyBvYmoucmVjb3Jkc1tqXVtpXS5zdHlsZVtrZXldIDogb2JqLnJlY29yZHNbal1baV0uZ2V0QXR0cmlidXRlKCdzdHlsZScpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gQW55IG1ldGEgZGF0YSBmb3IgdGhpcyBjb2x1bW4/XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBDb2x1bW4gbmFtZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGsgPSBqZXhjZWwuZ2V0Q29sdW1uTmFtZUZyb21JZChbaSwgal0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gVmFsdWVcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFba10gPSB2O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIHJldHVybiBkYXRhO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgY2VsbCA9IGpleGNlbC5nZXRJZEZyb21Db2x1bW5OYW1lKGNlbGwsIHRydWUpO1xyXG5cclxuICAgICAgICAgICAgICAgIHJldHVybiBrZXkgPyBvYmoucmVjb3Jkc1tjZWxsWzFdXVtjZWxsWzBdXS5zdHlsZVtrZXldIDogb2JqLnJlY29yZHNbY2VsbFsxXV1bY2VsbFswXV0uZ2V0QXR0cmlidXRlKCdzdHlsZScpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSxcclxuXHJcbiAgICAgICAgICAgIG9iai5yZXNldFN0eWxlID0gZnVuY3Rpb24gKG8sIGlnbm9yZUhpc3RvcnlBbmRFdmVudHMpIHtcclxuICAgICAgICAgICAgICAgIHZhciBrZXlzID0gT2JqZWN0LmtleXMobyk7XHJcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGtleXMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBQb3NpdGlvblxyXG4gICAgICAgICAgICAgICAgICAgIHZhciBjZWxsID0gamV4Y2VsLmdldElkRnJvbUNvbHVtbk5hbWUoa2V5c1tpXSwgdHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKG9iai5yZWNvcmRzW2NlbGxbMV1dICYmIG9iai5yZWNvcmRzW2NlbGxbMV1dW2NlbGxbMF1dKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9iai5yZWNvcmRzW2NlbGxbMV1dW2NlbGxbMF1dLnNldEF0dHJpYnV0ZSgnc3R5bGUnLCAnJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgb2JqLnNldFN0eWxlKG8sIG51bGwsIG51bGwsIG51bGwsIGlnbm9yZUhpc3RvcnlBbmRFdmVudHMpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIFNldCBtZXRhIGluZm9ybWF0aW9uIHRvIGNlbGwocylcclxuICAgICAgICAgKlxyXG4gICAgICAgICAqIEByZXR1cm4gaW50ZWdlclxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIG9iai5zZXRTdHlsZSA9IGZ1bmN0aW9uIChvLCBrLCB2LCBmb3JjZSwgaWdub3JlSGlzdG9yeUFuZEV2ZW50cykge1xyXG4gICAgICAgICAgICB2YXIgbmV3VmFsdWUgPSB7fTtcclxuICAgICAgICAgICAgdmFyIG9sZFZhbHVlID0ge307XHJcblxyXG4gICAgICAgICAgICAvLyBBcHBseSBzdHlsZVxyXG4gICAgICAgICAgICB2YXIgYXBwbHlTdHlsZSA9IGZ1bmN0aW9uIChjZWxsSWQsIGtleSwgdmFsdWUpIHtcclxuICAgICAgICAgICAgICAgIC8vIFBvc2l0aW9uXHJcbiAgICAgICAgICAgICAgICB2YXIgY2VsbCA9IGpleGNlbC5nZXRJZEZyb21Db2x1bW5OYW1lKGNlbGxJZCwgdHJ1ZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKG9iai5yZWNvcmRzW2NlbGxbMV1dICYmIG9iai5yZWNvcmRzW2NlbGxbMV1dW2NlbGxbMF1dICYmIChvYmoucmVjb3Jkc1tjZWxsWzFdXVtjZWxsWzBdXS5jbGFzc0xpc3QuY29udGFpbnMoJ3JlYWRvbmx5JykgPT0gZmFsc2UgfHwgZm9yY2UpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gQ3VycmVudCB2YWx1ZVxyXG4gICAgICAgICAgICAgICAgICAgIHZhciBjdXJyZW50VmFsdWUgPSBvYmoucmVjb3Jkc1tjZWxsWzFdXVtjZWxsWzBdXS5zdHlsZVtrZXldO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAvLyBDaGFuZ2UgbGF5b3V0XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGN1cnJlbnRWYWx1ZSA9PSB2YWx1ZSAmJiAhZm9yY2UpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSAnJztcclxuICAgICAgICAgICAgICAgICAgICAgICAgb2JqLnJlY29yZHNbY2VsbFsxXV1bY2VsbFswXV0uc3R5bGVba2V5XSA9ICcnO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9iai5yZWNvcmRzW2NlbGxbMV1dW2NlbGxbMF1dLnN0eWxlW2tleV0gPSB2YWx1ZTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIC8vIEhpc3RvcnlcclxuICAgICAgICAgICAgICAgICAgICBpZiAoIW9sZFZhbHVlW2NlbGxJZF0pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgb2xkVmFsdWVbY2VsbElkXSA9IFtdO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBpZiAoIW5ld1ZhbHVlW2NlbGxJZF0pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbmV3VmFsdWVbY2VsbElkXSA9IFtdO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgb2xkVmFsdWVbY2VsbElkXS5wdXNoKFtrZXkgKyAnOicgKyBjdXJyZW50VmFsdWVdKTtcclxuICAgICAgICAgICAgICAgICAgICBuZXdWYWx1ZVtjZWxsSWRdLnB1c2goW2tleSArICc6JyArIHZhbHVlXSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmIChrICYmIHYpIHtcclxuICAgICAgICAgICAgICAgIC8vIEdldCBvYmplY3QgZnJvbSBzdHJpbmdcclxuICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgKG8pID09ICdzdHJpbmcnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgYXBwbHlTdHlsZShvLCBrLCB2KTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gQXZvaWQgZHVwbGljYXRpb25zXHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIG9uZUFwcGxpY2F0aW9uID0gW107XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gQXBwbHkgdGhhdCBmb3IgYWxsIGNlbGxzXHJcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBvLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB4ID0gb1tpXS5nZXRBdHRyaWJ1dGUoJ2RhdGEteCcpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgeSA9IG9baV0uZ2V0QXR0cmlidXRlKCdkYXRhLXknKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNlbGxOYW1lID0gamV4Y2VsLmdldENvbHVtbk5hbWVGcm9tSWQoW3gsIHldKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gVGhpcyBoYXBwZW5zIHdoZW4gaXMgYSBtZXJnZWQgY2VsbFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIW9uZUFwcGxpY2F0aW9uW2NlbGxOYW1lXSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYXBwbHlTdHlsZShjZWxsTmFtZSwgaywgdik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbmVBcHBsaWNhdGlvbltjZWxsTmFtZV0gPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdmFyIGtleXMgPSBPYmplY3Qua2V5cyhvKTtcclxuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwga2V5cy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBzdHlsZSA9IG9ba2V5c1tpXV07XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiAoc3R5bGUpID09ICdzdHJpbmcnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0eWxlID0gc3R5bGUuc3BsaXQoJzsnKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBzdHlsZS5sZW5ndGg7IGorKykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIChzdHlsZVtqXSkgPT0gJ3N0cmluZycpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0eWxlW2pdID0gc3R5bGVbal0uc3BsaXQoJzonKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBBcHBseSB2YWx1ZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoc3R5bGVbal1bMF0udHJpbSgpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcHBseVN0eWxlKGtleXNbaV0sIHN0eWxlW2pdWzBdLnRyaW0oKSwgc3R5bGVbal1bMV0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB2YXIga2V5cyA9IE9iamVjdC5rZXlzKG9sZFZhbHVlKTtcclxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBrZXlzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICBvbGRWYWx1ZVtrZXlzW2ldXSA9IG9sZFZhbHVlW2tleXNbaV1dLmpvaW4oJzsnKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB2YXIga2V5cyA9IE9iamVjdC5rZXlzKG5ld1ZhbHVlKTtcclxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBrZXlzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICBuZXdWYWx1ZVtrZXlzW2ldXSA9IG5ld1ZhbHVlW2tleXNbaV1dLmpvaW4oJzsnKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKCFpZ25vcmVIaXN0b3J5QW5kRXZlbnRzKSB7XHJcbiAgICAgICAgICAgICAgICAvLyBLZWVwaW5nIGhpc3Rvcnkgb2YgY2hhbmdlc1xyXG4gICAgICAgICAgICAgICAgb2JqLnNldEhpc3Rvcnkoe1xyXG4gICAgICAgICAgICAgICAgICAgIGFjdGlvbjogJ3NldFN0eWxlJyxcclxuICAgICAgICAgICAgICAgICAgICBvbGRWYWx1ZTogb2xkVmFsdWUsXHJcbiAgICAgICAgICAgICAgICAgICAgbmV3VmFsdWU6IG5ld1ZhbHVlLFxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIG9iai5kaXNwYXRjaCgnb25jaGFuZ2VzdHlsZScsIGVsLCBvLCBrLCB2KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIEdldCBjZWxsIGNvbW1lbnRzLCBudWxsIGNlbGwgZm9yIGFsbFxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIG9iai5nZXRDb21tZW50cyA9IGZ1bmN0aW9uIChjZWxsLCB3aXRoQXV0aG9yKSB7XHJcbiAgICAgICAgICAgIGlmIChjZWxsKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIChjZWxsKSA9PSAnc3RyaW5nJykge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBjZWxsID0gamV4Y2VsLmdldElkRnJvbUNvbHVtbk5hbWUoY2VsbCwgdHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKHdpdGhBdXRob3IpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gW29iai5yZWNvcmRzW2NlbGxbMV1dW2NlbGxbMF1dLmdldEF0dHJpYnV0ZSgndGl0bGUnKSwgb2JqLnJlY29yZHNbY2VsbFsxXV1bY2VsbFswXV0uZ2V0QXR0cmlidXRlKCdhdXRob3InKV07XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBvYmoucmVjb3Jkc1tjZWxsWzFdXVtjZWxsWzBdXS5nZXRBdHRyaWJ1dGUoJ3RpdGxlJykgfHwgJyc7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgZGF0YSA9IHt9O1xyXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBvYmoub3B0aW9ucy5kYXRhLmxlbmd0aDsgaisrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBvYmoub3B0aW9ucy5jb2x1bW5zLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjb21tZW50cyA9IG9iai5yZWNvcmRzW2pdW2ldLmdldEF0dHJpYnV0ZSgndGl0bGUnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNvbW1lbnRzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgY2VsbCA9IGpleGNlbC5nZXRDb2x1bW5OYW1lRnJvbUlkKFtpLCBqXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhW2NlbGxdID0gY29tbWVudHM7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZGF0YTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogU2V0IGNlbGwgY29tbWVudHNcclxuICAgICAgICAgKi9cclxuICAgICAgICBvYmouc2V0Q29tbWVudHMgPSBmdW5jdGlvbiAoY2VsbElkLCBjb21tZW50cywgYXV0aG9yKSB7XHJcbiAgICAgICAgICAgIGlmICh0eXBlb2YgKGNlbGxJZCkgPT0gJ3N0cmluZycpIHtcclxuICAgICAgICAgICAgICAgIHZhciBjZWxsID0gamV4Y2VsLmdldElkRnJvbUNvbHVtbk5hbWUoY2VsbElkLCB0cnVlKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHZhciBjZWxsID0gY2VsbElkO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBLZWVwIG9sZCB2YWx1ZVxyXG4gICAgICAgICAgICB2YXIgdGl0bGUgPSBvYmoucmVjb3Jkc1tjZWxsWzFdXVtjZWxsWzBdXS5nZXRBdHRyaWJ1dGUoJ3RpdGxlJyk7XHJcbiAgICAgICAgICAgIHZhciBhdXRob3IgPSBvYmoucmVjb3Jkc1tjZWxsWzFdXVtjZWxsWzBdXS5nZXRBdHRyaWJ1dGUoJ2RhdGEtYXV0aG9yJyk7XHJcbiAgICAgICAgICAgIHZhciBvbGRWYWx1ZSA9IFt0aXRsZSwgYXV0aG9yXTtcclxuXHJcbiAgICAgICAgICAgIC8vIFNldCBuZXcgdmFsdWVzXHJcbiAgICAgICAgICAgIG9iai5yZWNvcmRzW2NlbGxbMV1dW2NlbGxbMF1dLnNldEF0dHJpYnV0ZSgndGl0bGUnLCBjb21tZW50cyA/IGNvbW1lbnRzIDogJycpO1xyXG4gICAgICAgICAgICBvYmoucmVjb3Jkc1tjZWxsWzFdXVtjZWxsWzBdXS5zZXRBdHRyaWJ1dGUoJ2RhdGEtYXV0aG9yJywgYXV0aG9yID8gYXV0aG9yIDogJycpO1xyXG5cclxuICAgICAgICAgICAgLy8gUmVtb3ZlIGNsYXNzIGlmIHRoZXJlIGlzIG5vIGNvbW1lbnRcclxuICAgICAgICAgICAgaWYgKGNvbW1lbnRzKSB7XHJcbiAgICAgICAgICAgICAgICBvYmoucmVjb3Jkc1tjZWxsWzFdXVtjZWxsWzBdXS5jbGFzc0xpc3QuYWRkKCdqZXhjZWxfY29tbWVudHMnKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIG9iai5yZWNvcmRzW2NlbGxbMV1dW2NlbGxbMF1dLmNsYXNzTGlzdC5yZW1vdmUoJ2pleGNlbF9jb21tZW50cycpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBTYXZlIGhpc3RvcnlcclxuICAgICAgICAgICAgb2JqLnNldEhpc3Rvcnkoe1xyXG4gICAgICAgICAgICAgICAgYWN0aW9uOiAnc2V0Q29tbWVudHMnLFxyXG4gICAgICAgICAgICAgICAgY29sdW1uOiBjZWxsSWQsXHJcbiAgICAgICAgICAgICAgICBuZXdWYWx1ZTogW2NvbW1lbnRzLCBhdXRob3JdLFxyXG4gICAgICAgICAgICAgICAgb2xkVmFsdWU6IG9sZFZhbHVlLFxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgLy8gU2V0IGNvbW1lbnRzXHJcbiAgICAgICAgICAgIG9iai5kaXNwYXRjaCgnb25jb21tZW50cycsIGVsLCBjb21tZW50cywgdGl0bGUpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogR2V0IHRhYmxlIGNvbmZpZyBpbmZvcm1hdGlvblxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIG9iai5nZXRDb25maWcgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHZhciBvcHRpb25zID0gb2JqLm9wdGlvbnM7XHJcbiAgICAgICAgICAgIG9wdGlvbnMuc3R5bGUgPSBvYmouZ2V0U3R5bGUoKTtcclxuICAgICAgICAgICAgb3B0aW9ucy5tZXJnZUNlbGxzID0gb2JqLmdldE1lcmdlKCk7XHJcbiAgICAgICAgICAgIG9wdGlvbnMuY29tbWVudHMgPSBvYmouZ2V0Q29tbWVudHMoKTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiBvcHRpb25zO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogU29ydCBkYXRhIGFuZCByZWxvYWQgdGFibGVcclxuICAgICAgICAgKi9cclxuICAgICAgICBvYmoub3JkZXJCeSA9IGZ1bmN0aW9uIChjb2x1bW4sIG9yZGVyKSB7XHJcbiAgICAgICAgICAgIGlmIChjb2x1bW4gPj0gMCkge1xyXG4gICAgICAgICAgICAgICAgLy8gTWVyZ2VkIGNlbGxzXHJcbiAgICAgICAgICAgICAgICBpZiAoT2JqZWN0LmtleXMob2JqLm9wdGlvbnMubWVyZ2VDZWxscykubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICghY29uZmlybShvYmoub3B0aW9ucy50ZXh0LnRoaXNBY3Rpb25XaWxsRGVzdHJveUFueUV4aXN0aW5nTWVyZ2VkQ2VsbHNBcmVZb3VTdXJlKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gUmVtb3ZlIG1lcmdlZCBjZWxsc1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBvYmouZGVzdHJveU1lcmdlZCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAvLyBEaXJlY3Rpb25cclxuICAgICAgICAgICAgICAgIGlmIChvcmRlciA9PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgb3JkZXIgPSBvYmouaGVhZGVyc1tjb2x1bW5dLmNsYXNzTGlzdC5jb250YWlucygnYXJyb3ctZG93bicpID8gMSA6IDA7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIG9yZGVyID0gb3JkZXIgPyAxIDogMDtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAvLyBUZXN0IG9yZGVyXHJcbiAgICAgICAgICAgICAgICB2YXIgdGVtcCA9IFtdO1xyXG4gICAgICAgICAgICAgICAgaWYgKG9iai5vcHRpb25zLmNvbHVtbnNbY29sdW1uXS50eXBlID09ICdudW1iZXInIHx8IG9iai5vcHRpb25zLmNvbHVtbnNbY29sdW1uXS50eXBlID09ICdwZXJjZW50YWdlJyB8fCBvYmoub3B0aW9ucy5jb2x1bW5zW2NvbHVtbl0udHlwZSA9PSAnYXV0b251bWJlcicgfHwgb2JqLm9wdGlvbnMuY29sdW1uc1tjb2x1bW5dLnR5cGUgPT0gJ2NvbG9yJykge1xyXG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgb2JqLm9wdGlvbnMuZGF0YS5sZW5ndGg7IGorKykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0ZW1wW2pdID0gW2osIE51bWJlcihvYmoub3B0aW9ucy5kYXRhW2pdW2NvbHVtbl0pXTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKG9iai5vcHRpb25zLmNvbHVtbnNbY29sdW1uXS50eXBlID09ICdjYWxlbmRhcicgfHwgb2JqLm9wdGlvbnMuY29sdW1uc1tjb2x1bW5dLnR5cGUgPT0gJ2NoZWNrYm94JyB8fCBvYmoub3B0aW9ucy5jb2x1bW5zW2NvbHVtbl0udHlwZSA9PSAncmFkaW8nKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBvYmoub3B0aW9ucy5kYXRhLmxlbmd0aDsgaisrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRlbXBbal0gPSBbaiwgb2JqLm9wdGlvbnMuZGF0YVtqXVtjb2x1bW5dXTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgb2JqLm9wdGlvbnMuZGF0YS5sZW5ndGg7IGorKykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0ZW1wW2pdID0gW2osIG9iai5yZWNvcmRzW2pdW2NvbHVtbl0uaW5uZXJUZXh0LnRvTG93ZXJDYXNlKCldO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAvLyBEZWZhdWx0IHNvcnRpbmcgbWV0aG9kXHJcbiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIChvYmoub3B0aW9ucy5zb3J0aW5nKSAhPT0gJ2Z1bmN0aW9uJykge1xyXG4gICAgICAgICAgICAgICAgICAgIG9iai5vcHRpb25zLnNvcnRpbmcgPSBmdW5jdGlvbiAoZGlyZWN0aW9uKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbiAoYSwgYikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHZhbHVlQSA9IGFbMV07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgdmFsdWVCID0gYlsxXTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWRpcmVjdGlvbikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAodmFsdWVBID09PSAnJyAmJiB2YWx1ZUIgIT09ICcnKSA/IDEgOiAodmFsdWVBICE9PSAnJyAmJiB2YWx1ZUIgPT09ICcnKSA/IC0xIDogKHZhbHVlQSA+IHZhbHVlQikgPyAxIDogKHZhbHVlQSA8IHZhbHVlQikgPyAtMSA6IDA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAodmFsdWVBID09PSAnJyAmJiB2YWx1ZUIgIT09ICcnKSA/IDEgOiAodmFsdWVBICE9PSAnJyAmJiB2YWx1ZUIgPT09ICcnKSA/IC0xIDogKHZhbHVlQSA+IHZhbHVlQikgPyAtMSA6ICh2YWx1ZUEgPCB2YWx1ZUIpID8gMSA6IDA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgdGVtcCA9IHRlbXAuc29ydChvYmoub3B0aW9ucy5zb3J0aW5nKG9yZGVyKSk7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gU2F2ZSBoaXN0b3J5XHJcbiAgICAgICAgICAgICAgICB2YXIgbmV3VmFsdWUgPSBbXTtcclxuICAgICAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgdGVtcC5sZW5ndGg7IGorKykge1xyXG4gICAgICAgICAgICAgICAgICAgIG5ld1ZhbHVlW2pdID0gdGVtcFtqXVswXTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAvLyBTYXZlIGhpc3RvcnlcclxuICAgICAgICAgICAgICAgIG9iai5zZXRIaXN0b3J5KHtcclxuICAgICAgICAgICAgICAgICAgICBhY3Rpb246ICdvcmRlckJ5JyxcclxuICAgICAgICAgICAgICAgICAgICByb3dzOiBuZXdWYWx1ZSxcclxuICAgICAgICAgICAgICAgICAgICBjb2x1bW46IGNvbHVtbixcclxuICAgICAgICAgICAgICAgICAgICBvcmRlcjogb3JkZXIsXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyBVcGRhdGUgb3JkZXJcclxuICAgICAgICAgICAgICAgIG9iai51cGRhdGVPcmRlckFycm93KGNvbHVtbiwgb3JkZXIpO1xyXG4gICAgICAgICAgICAgICAgb2JqLnVwZGF0ZU9yZGVyKG5ld1ZhbHVlKTtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyBPbiBzb3J0IGV2ZW50XHJcbiAgICAgICAgICAgICAgICBvYmouZGlzcGF0Y2goJ29uc29ydCcsIGVsLCBjb2x1bW4sIG9yZGVyKTtcclxuXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogVXBkYXRlIG9yZGVyIGFycm93XHJcbiAgICAgICAgICovXHJcbiAgICAgICAgb2JqLnVwZGF0ZU9yZGVyQXJyb3cgPSBmdW5jdGlvbiAoY29sdW1uLCBvcmRlcikge1xyXG4gICAgICAgICAgICAvLyBSZW1vdmUgb3JkZXJcclxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBvYmouaGVhZGVycy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgb2JqLmhlYWRlcnNbaV0uY2xhc3NMaXN0LnJlbW92ZSgnYXJyb3ctdXAnKTtcclxuICAgICAgICAgICAgICAgIG9iai5oZWFkZXJzW2ldLmNsYXNzTGlzdC5yZW1vdmUoJ2Fycm93LWRvd24nKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gTm8gb3JkZXIgc3BlY2lmaWVkIHRoZW4gdG9nZ2xlIG9yZGVyXHJcbiAgICAgICAgICAgIGlmIChvcmRlcikge1xyXG4gICAgICAgICAgICAgICAgb2JqLmhlYWRlcnNbY29sdW1uXS5jbGFzc0xpc3QuYWRkKCdhcnJvdy11cCcpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgb2JqLmhlYWRlcnNbY29sdW1uXS5jbGFzc0xpc3QuYWRkKCdhcnJvdy1kb3duJyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIFVwZGF0ZSByb3dzIHBvc2l0aW9uXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgb2JqLnVwZGF0ZU9yZGVyID0gZnVuY3Rpb24gKHJvd3MpIHtcclxuICAgICAgICAgICAgLy8gSGlzdG9yeVxyXG4gICAgICAgICAgICB2YXIgZGF0YSA9IFtdXHJcbiAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgcm93cy5sZW5ndGg7IGorKykge1xyXG4gICAgICAgICAgICAgICAgZGF0YVtqXSA9IG9iai5vcHRpb25zLmRhdGFbcm93c1tqXV07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgb2JqLm9wdGlvbnMuZGF0YSA9IGRhdGE7XHJcblxyXG4gICAgICAgICAgICB2YXIgZGF0YSA9IFtdXHJcbiAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgcm93cy5sZW5ndGg7IGorKykge1xyXG4gICAgICAgICAgICAgICAgZGF0YVtqXSA9IG9iai5yZWNvcmRzW3Jvd3Nbal1dO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIG9iai5yZWNvcmRzID0gZGF0YTtcclxuXHJcbiAgICAgICAgICAgIHZhciBkYXRhID0gW11cclxuICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCByb3dzLmxlbmd0aDsgaisrKSB7XHJcbiAgICAgICAgICAgICAgICBkYXRhW2pdID0gb2JqLnJvd3Nbcm93c1tqXV07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgb2JqLnJvd3MgPSBkYXRhO1xyXG5cclxuICAgICAgICAgICAgLy8gVXBkYXRlIHJlZmVyZW5jZXNcclxuICAgICAgICAgICAgb2JqLnVwZGF0ZVRhYmxlUmVmZXJlbmNlcygpO1xyXG5cclxuICAgICAgICAgICAgLy8gUmVkbyBzZWFyY2hcclxuICAgICAgICAgICAgaWYgKG9iai5yZXN1bHRzICYmIG9iai5yZXN1bHRzLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKG9iai5zZWFyY2hJbnB1dC52YWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIG9iai5zZWFyY2gob2JqLnNlYXJjaElucHV0LnZhbHVlKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgb2JqLmNsb3NlRmlsdGVyKCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAvLyBDcmVhdGUgcGFnZVxyXG4gICAgICAgICAgICAgICAgb2JqLnJlc3VsdHMgPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgb2JqLnBhZ2VOdW1iZXIgPSAwO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmIChvYmoub3B0aW9ucy5wYWdpbmF0aW9uID4gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgIG9iai5wYWdlKDApO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChvYmoub3B0aW9ucy5sYXp5TG9hZGluZyA9PSB0cnVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgb2JqLmxvYWRQYWdlKDApO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IG9iai5yb3dzLmxlbmd0aDsgaisrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9iai50Ym9keS5hcHBlbmRDaGlsZChvYmoucm93c1tqXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvKipcclxuICAgICAgICAgKiBNb3ZlIHJvd1xyXG4gICAgICAgICAqXHJcbiAgICAgICAgICogQHJldHVybiB2b2lkXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgb2JqLm1vdmVSb3cgPSBmdW5jdGlvbiAobywgZCwgaWdub3JlRG9tKSB7XHJcbiAgICAgICAgICAgIGlmIChPYmplY3Qua2V5cyhvYmoub3B0aW9ucy5tZXJnZUNlbGxzKS5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAobyA+IGQpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgaW5zZXJ0QmVmb3JlID0gMTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGluc2VydEJlZm9yZSA9IDA7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKG9iai5pc1Jvd01lcmdlZChvKS5sZW5ndGggfHwgb2JqLmlzUm93TWVyZ2VkKGQsIGluc2VydEJlZm9yZSkubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFjb25maXJtKG9iai5vcHRpb25zLnRleHQudGhpc0FjdGlvbldpbGxEZXN0cm95QW55RXhpc3RpbmdNZXJnZWRDZWxsc0FyZVlvdVN1cmUpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBvYmouZGVzdHJveU1lcmdlZCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKG9iai5vcHRpb25zLnNlYXJjaCA9PSB0cnVlKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAob2JqLnJlc3VsdHMgJiYgb2JqLnJlc3VsdHMubGVuZ3RoICE9IG9iai5yb3dzLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChjb25maXJtKG9iai5vcHRpb25zLnRleHQudGhpc0FjdGlvbldpbGxDbGVhcllvdXJTZWFyY2hSZXN1bHRzQXJlWW91U3VyZSkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgb2JqLnJlc2V0U2VhcmNoKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBvYmoucmVzdWx0cyA9IG51bGw7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmICghaWdub3JlRG9tKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoQXJyYXkucHJvdG90eXBlLmluZGV4T2YuY2FsbChvYmoudGJvZHkuY2hpbGRyZW4sIG9iai5yb3dzW2RdKSA+PSAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKG8gPiBkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9iai50Ym9keS5pbnNlcnRCZWZvcmUob2JqLnJvd3Nbb10sIG9iai5yb3dzW2RdKTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBvYmoudGJvZHkuaW5zZXJ0QmVmb3JlKG9iai5yb3dzW29dLCBvYmoucm93c1tkXS5uZXh0U2libGluZyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBvYmoudGJvZHkucmVtb3ZlQ2hpbGQob2JqLnJvd3Nbb10pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBQbGFjZSByZWZlcmVuY2VzIGluIHRoZSBjb3JyZWN0IHBvc2l0aW9uXHJcbiAgICAgICAgICAgIG9iai5yb3dzLnNwbGljZShkLCAwLCBvYmoucm93cy5zcGxpY2UobywgMSlbMF0pO1xyXG4gICAgICAgICAgICBvYmoucmVjb3Jkcy5zcGxpY2UoZCwgMCwgb2JqLnJlY29yZHMuc3BsaWNlKG8sIDEpWzBdKTtcclxuICAgICAgICAgICAgb2JqLm9wdGlvbnMuZGF0YS5zcGxpY2UoZCwgMCwgb2JqLm9wdGlvbnMuZGF0YS5zcGxpY2UobywgMSlbMF0pO1xyXG5cclxuICAgICAgICAgICAgLy8gUmVzcGVjdCBwYWdpbmF0aW9uXHJcbiAgICAgICAgICAgIGlmIChvYmoub3B0aW9ucy5wYWdpbmF0aW9uID4gMCAmJiBvYmoudGJvZHkuY2hpbGRyZW4ubGVuZ3RoICE9IG9iai5vcHRpb25zLnBhZ2luYXRpb24pIHtcclxuICAgICAgICAgICAgICAgIG9iai5wYWdlKG9iai5wYWdlTnVtYmVyKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gS2VlcGluZyBoaXN0b3J5IG9mIGNoYW5nZXNcclxuICAgICAgICAgICAgb2JqLnNldEhpc3Rvcnkoe1xyXG4gICAgICAgICAgICAgICAgYWN0aW9uOiAnbW92ZVJvdycsXHJcbiAgICAgICAgICAgICAgICBvbGRWYWx1ZTogbyxcclxuICAgICAgICAgICAgICAgIG5ld1ZhbHVlOiBkLFxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIC8vIFVwZGF0ZSB0YWJsZSByZWZlcmVuY2VzXHJcbiAgICAgICAgICAgIG9iai51cGRhdGVUYWJsZVJlZmVyZW5jZXMoKTtcclxuXHJcbiAgICAgICAgICAgIC8vIEV2ZW50c1xyXG4gICAgICAgICAgICBvYmouZGlzcGF0Y2goJ29ubW92ZXJvdycsIGVsLCBvLCBkKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIEluc2VydCBhIG5ldyByb3dcclxuICAgICAgICAgKlxyXG4gICAgICAgICAqIEBwYXJhbSBtaXhlZCAtIG51bWJlciBvZiBibGFuayBsaW5lcyB0byBiZSBpbnNlcnQgb3IgYSBzaW5nbGUgYXJyYXkgd2l0aCB0aGUgZGF0YSBvZiB0aGUgbmV3IHJvd1xyXG4gICAgICAgICAqIEBwYXJhbSByb3dOdW1iZXJcclxuICAgICAgICAgKiBAcGFyYW0gaW5zZXJ0QmVmb3JlXHJcbiAgICAgICAgICogQHJldHVybiB2b2lkXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgb2JqLmluc2VydFJvdyA9IGZ1bmN0aW9uIChtaXhlZCwgcm93TnVtYmVyLCBpbnNlcnRCZWZvcmUsIGZvcmNlKSB7XHJcbiAgICAgICAgICAgIC8vIENvbmZpZ3VyYXRpb25cclxuICAgICAgICAgICAgaWYgKG9iai5vcHRpb25zLmFsbG93SW5zZXJ0Um93ID09IHRydWUgfHwgZm9yY2UpIHtcclxuICAgICAgICAgICAgICAgIC8vIFJlY29yZHNcclxuICAgICAgICAgICAgICAgIHZhciByZWNvcmRzID0gW107XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gRGF0YSB0byBiZSBpbnNlcnRcclxuICAgICAgICAgICAgICAgIHZhciBkYXRhID0gW107XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gVGhlIGluc2VydCBjb3VsZCBiZSBsZWFkIGJ5IG51bWJlciBvZiByb3dzIG9yIHRoZSBhcnJheSBvZiBkYXRhXHJcbiAgICAgICAgICAgICAgICBpZiAobWl4ZWQgPiAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIG51bU9mUm93cyA9IG1peGVkO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgbnVtT2ZSb3dzID0gMTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKG1peGVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEgPSBtaXhlZDtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gRGlyZWN0aW9uXHJcbiAgICAgICAgICAgICAgICB2YXIgaW5zZXJ0QmVmb3JlID0gaW5zZXJ0QmVmb3JlID8gdHJ1ZSA6IGZhbHNlO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIEN1cnJlbnQgY29sdW1uIG51bWJlclxyXG4gICAgICAgICAgICAgICAgdmFyIGxhc3RSb3cgPSBvYmoub3B0aW9ucy5kYXRhLmxlbmd0aCAtIDE7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKHJvd051bWJlciA9PSB1bmRlZmluZWQgfHwgcm93TnVtYmVyID49IHBhcnNlSW50KGxhc3RSb3cpIHx8IHJvd051bWJlciA8IDApIHtcclxuICAgICAgICAgICAgICAgICAgICByb3dOdW1iZXIgPSBsYXN0Um93O1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIC8vIE9uYmVmb3JlaW5zZXJ0cm93XHJcbiAgICAgICAgICAgICAgICBpZiAob2JqLmRpc3BhdGNoKCdvbmJlZm9yZWluc2VydHJvdycsIGVsLCByb3dOdW1iZXIsIG51bU9mUm93cywgaW5zZXJ0QmVmb3JlKSA9PT0gZmFsc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnb25iZWZvcmVpbnNlcnRyb3cgcmV0dXJuZWQgZmFsc2UnKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIC8vIE1lcmdlZCBjZWxsc1xyXG4gICAgICAgICAgICAgICAgaWYgKE9iamVjdC5rZXlzKG9iai5vcHRpb25zLm1lcmdlQ2VsbHMpLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAob2JqLmlzUm93TWVyZ2VkKHJvd051bWJlciwgaW5zZXJ0QmVmb3JlKS5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFjb25maXJtKG9iai5vcHRpb25zLnRleHQudGhpc0FjdGlvbldpbGxEZXN0cm95QW55RXhpc3RpbmdNZXJnZWRDZWxsc0FyZVlvdVN1cmUpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmouZGVzdHJveU1lcmdlZCgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIC8vIENsZWFyIGFueSBzZWFyY2hcclxuICAgICAgICAgICAgICAgIGlmIChvYmoub3B0aW9ucy5zZWFyY2ggPT0gdHJ1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChvYmoucmVzdWx0cyAmJiBvYmoucmVzdWx0cy5sZW5ndGggIT0gb2JqLnJvd3MubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjb25maXJtKG9iai5vcHRpb25zLnRleHQudGhpc0FjdGlvbldpbGxDbGVhcllvdXJTZWFyY2hSZXN1bHRzQXJlWW91U3VyZSkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9iai5yZXNldFNlYXJjaCgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICBvYmoucmVzdWx0cyA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gSW5zZXJ0YmVmb3JlXHJcbiAgICAgICAgICAgICAgICB2YXIgcm93SW5kZXggPSAoIWluc2VydEJlZm9yZSkgPyByb3dOdW1iZXIgKyAxIDogcm93TnVtYmVyO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIEtlZXAgdGhlIGN1cnJlbnQgZGF0YVxyXG4gICAgICAgICAgICAgICAgdmFyIGN1cnJlbnRSZWNvcmRzID0gb2JqLnJlY29yZHMuc3BsaWNlKHJvd0luZGV4KTtcclxuICAgICAgICAgICAgICAgIHZhciBjdXJyZW50RGF0YSA9IG9iai5vcHRpb25zLmRhdGEuc3BsaWNlKHJvd0luZGV4KTtcclxuICAgICAgICAgICAgICAgIHZhciBjdXJyZW50Um93cyA9IG9iai5yb3dzLnNwbGljZShyb3dJbmRleCk7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gQWRkaW5nIGxpbmVzXHJcbiAgICAgICAgICAgICAgICB2YXIgcm93UmVjb3JkcyA9IFtdO1xyXG4gICAgICAgICAgICAgICAgdmFyIHJvd0RhdGEgPSBbXTtcclxuICAgICAgICAgICAgICAgIHZhciByb3dOb2RlID0gW107XHJcblxyXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgcm93ID0gcm93SW5kZXg7IHJvdyA8IChudW1PZlJvd3MgKyByb3dJbmRleCk7IHJvdysrKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIC8vIFB1c2ggZGF0YSB0byB0aGUgZGF0YSBjb250YWluZXJcclxuICAgICAgICAgICAgICAgICAgICBvYmoub3B0aW9ucy5kYXRhW3Jvd10gPSBbXTtcclxuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBjb2wgPSAwOyBjb2wgPCBvYmoub3B0aW9ucy5jb2x1bW5zLmxlbmd0aDsgY29sKyspIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG9iai5vcHRpb25zLmNvbHVtbnNbY29sXS5kZWZhdWx0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhW2NvbF0gPSBvYmoub3B0aW9ucy5jb2x1bW5zW2NvbF0uZGVmYXVsdDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChvYmoub3B0aW9ucy5jb2x1bW5zW2NvbF0udHlwZSA9PT0gJ2Ryb3Bkb3duJykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChvYmoub3B0aW9ucy5jb2x1bW5zW2NvbF0ubXVsdGlwbGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVtjb2xdID0gW29iai5vcHRpb25zLmNvbHVtbnNbY29sXS5zb3VyY2VbMF0uaWRdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFbY29sXSA9IG9iai5vcHRpb25zLmNvbHVtbnNbY29sXS5zb3VyY2VbMF0uaWQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9iai5vcHRpb25zLmRhdGFbcm93XVtjb2xdID0gZGF0YVtjb2xdID8gZGF0YVtjb2xdIDogJyc7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAvLyBDcmVhdGUgcm93XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHRyID0gb2JqLmNyZWF0ZVJvdyhyb3csIG9iai5vcHRpb25zLmRhdGFbcm93XSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIC8vIEFwcGVuZCBub2RlXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGN1cnJlbnRSb3dzWzBdKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChBcnJheS5wcm90b3R5cGUuaW5kZXhPZi5jYWxsKG9iai50Ym9keS5jaGlsZHJlbiwgY3VycmVudFJvd3NbMF0pID49IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9iai50Ym9keS5pbnNlcnRCZWZvcmUodHIsIGN1cnJlbnRSb3dzWzBdKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChBcnJheS5wcm90b3R5cGUuaW5kZXhPZi5jYWxsKG9iai50Ym9keS5jaGlsZHJlbiwgb2JqLnJvd3Nbcm93TnVtYmVyXSkgPj0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb2JqLnRib2R5LmFwcGVuZENoaWxkKHRyKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgLy8gUmVjb3JkIEhpc3RvcnlcclxuICAgICAgICAgICAgICAgICAgICByb3dSZWNvcmRzLnB1c2gob2JqLnJlY29yZHNbcm93XSk7XHJcbiAgICAgICAgICAgICAgICAgICAgcm93RGF0YS5wdXNoKG9iai5vcHRpb25zLmRhdGFbcm93XSk7XHJcbiAgICAgICAgICAgICAgICAgICAgcm93Tm9kZS5wdXNoKHRyKTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAvLyBDb3B5IHRoZSBkYXRhIGJhY2sgdG8gdGhlIG1haW4gZGF0YVxyXG4gICAgICAgICAgICAgICAgQXJyYXkucHJvdG90eXBlLnB1c2guYXBwbHkob2JqLnJlY29yZHMsIGN1cnJlbnRSZWNvcmRzKTtcclxuICAgICAgICAgICAgICAgIEFycmF5LnByb3RvdHlwZS5wdXNoLmFwcGx5KG9iai5vcHRpb25zLmRhdGEsIGN1cnJlbnREYXRhKTtcclxuICAgICAgICAgICAgICAgIEFycmF5LnByb3RvdHlwZS5wdXNoLmFwcGx5KG9iai5yb3dzLCBjdXJyZW50Um93cyk7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gUmVzcGVjdCBwYWdpbmF0aW9uXHJcbiAgICAgICAgICAgICAgICBpZiAob2JqLm9wdGlvbnMucGFnaW5hdGlvbiA+IDApIHtcclxuICAgICAgICAgICAgICAgICAgICBvYmoucGFnZShvYmoucGFnZU51bWJlcik7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gS2VlcCBoaXN0b3J5XHJcbiAgICAgICAgICAgICAgICBvYmouc2V0SGlzdG9yeSh7XHJcbiAgICAgICAgICAgICAgICAgICAgYWN0aW9uOiAnaW5zZXJ0Um93JyxcclxuICAgICAgICAgICAgICAgICAgICByb3dOdW1iZXI6IHJvd051bWJlcixcclxuICAgICAgICAgICAgICAgICAgICBudW1PZlJvd3M6IG51bU9mUm93cyxcclxuICAgICAgICAgICAgICAgICAgICBpbnNlcnRCZWZvcmU6IGluc2VydEJlZm9yZSxcclxuICAgICAgICAgICAgICAgICAgICByb3dSZWNvcmRzOiByb3dSZWNvcmRzLFxyXG4gICAgICAgICAgICAgICAgICAgIHJvd0RhdGE6IHJvd0RhdGEsXHJcbiAgICAgICAgICAgICAgICAgICAgcm93Tm9kZTogcm93Tm9kZSxcclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIFJlbW92ZSB0YWJsZSByZWZlcmVuY2VzXHJcbiAgICAgICAgICAgICAgICBvYmoudXBkYXRlVGFibGVSZWZlcmVuY2VzKCk7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gRXZlbnRzXHJcbiAgICAgICAgICAgICAgICBvYmouZGlzcGF0Y2goJ29uaW5zZXJ0cm93JywgZWwsIHJvd051bWJlciwgbnVtT2ZSb3dzLCByb3dSZWNvcmRzLCBpbnNlcnRCZWZvcmUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvKipcclxuICAgICAgICAgKiBEZWxldGUgYSByb3cgYnkgbnVtYmVyXHJcbiAgICAgICAgICpcclxuICAgICAgICAgKiBAcGFyYW0gaW50ZWdlciByb3dOdW1iZXIgLSByb3cgbnVtYmVyIHRvIGJlIGV4Y2x1ZGVkXHJcbiAgICAgICAgICogQHBhcmFtIGludGVnZXIgbnVtT2ZSb3dzIC0gbnVtYmVyIG9mIGxpbmVzXHJcbiAgICAgICAgICogQHJldHVybiB2b2lkXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgb2JqLmRlbGV0ZVJvdyA9IGZ1bmN0aW9uIChyb3dOdW1iZXIsIG51bU9mUm93cykge1xyXG4gICAgICAgICAgICAvLyBHbG9iYWwgQ29uZmlndXJhdGlvblxyXG4gICAgICAgICAgICBpZiAob2JqLm9wdGlvbnMuYWxsb3dEZWxldGVSb3cgPT0gdHJ1ZSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKG9iai5vcHRpb25zLmFsbG93RGVsZXRpbmdBbGxSb3dzID09IHRydWUgfHwgb2JqLm9wdGlvbnMuZGF0YS5sZW5ndGggPiAxKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gRGVsZXRlIHJvdyBkZWZpbml0aW9uc1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChyb3dOdW1iZXIgPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBudW1iZXIgPSBvYmouZ2V0U2VsZWN0ZWRSb3dzKCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIW51bWJlclswXSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcm93TnVtYmVyID0gb2JqLm9wdGlvbnMuZGF0YS5sZW5ndGggLSAxO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbnVtT2ZSb3dzID0gMTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJvd051bWJlciA9IHBhcnNlSW50KG51bWJlclswXS5nZXRBdHRyaWJ1dGUoJ2RhdGEteScpKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG51bU9mUm93cyA9IG51bWJlci5sZW5ndGg7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIC8vIExhc3QgY29sdW1uXHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGxhc3RSb3cgPSBvYmoub3B0aW9ucy5kYXRhLmxlbmd0aCAtIDE7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChyb3dOdW1iZXIgPT0gdW5kZWZpbmVkIHx8IHJvd051bWJlciA+IGxhc3RSb3cgfHwgcm93TnVtYmVyIDwgMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByb3dOdW1iZXIgPSBsYXN0Um93O1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFudW1PZlJvd3MpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbnVtT2ZSb3dzID0gMTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIC8vIERvIG5vdCBkZWxldGUgbW9yZSB0aGFuIHRoZSBudW1iZXIgb2YgcmVjb3JlZHNcclxuICAgICAgICAgICAgICAgICAgICBpZiAocm93TnVtYmVyICsgbnVtT2ZSb3dzID49IG9iai5vcHRpb25zLmRhdGEubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG51bU9mUm93cyA9IG9iai5vcHRpb25zLmRhdGEubGVuZ3RoIC0gcm93TnVtYmVyO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgLy8gT25iZWZvcmVkZWxldGVyb3dcclxuICAgICAgICAgICAgICAgICAgICBpZiAob2JqLmRpc3BhdGNoKCdvbmJlZm9yZWRlbGV0ZXJvdycsIGVsLCByb3dOdW1iZXIsIG51bU9mUm93cykgPT09IGZhbHNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdvbmJlZm9yZWRlbGV0ZXJvdyByZXR1cm5lZCBmYWxzZScpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICBpZiAocGFyc2VJbnQocm93TnVtYmVyKSA+IC0xKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIE1lcmdlZCBjZWxsc1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgbWVyZ2VFeGlzdHMgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKE9iamVjdC5rZXlzKG9iai5vcHRpb25zLm1lcmdlQ2VsbHMpLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIHJvdyA9IHJvd051bWJlcjsgcm93IDwgcm93TnVtYmVyICsgbnVtT2ZSb3dzOyByb3crKykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChvYmouaXNSb3dNZXJnZWQocm93LCBmYWxzZSkubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lcmdlRXhpc3RzID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG1lcmdlRXhpc3RzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWNvbmZpcm0ob2JqLm9wdGlvbnMudGV4dC50aGlzQWN0aW9uV2lsbERlc3Ryb3lBbnlFeGlzdGluZ01lcmdlZENlbGxzQXJlWW91U3VyZSkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9iai5kZXN0cm95TWVyZ2VkKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIENsZWFyIGFueSBzZWFyY2hcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG9iai5vcHRpb25zLnNlYXJjaCA9PSB0cnVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAob2JqLnJlc3VsdHMgJiYgb2JqLnJlc3VsdHMubGVuZ3RoICE9IG9iai5yb3dzLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjb25maXJtKG9iai5vcHRpb25zLnRleHQudGhpc0FjdGlvbldpbGxDbGVhcllvdXJTZWFyY2hSZXN1bHRzQXJlWW91U3VyZSkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb2JqLnJlc2V0U2VhcmNoKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmoucmVzdWx0cyA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIElmIGRlbGV0ZSBhbGwgcm93cywgYW5kIHNldCBhbGxvd0RlbGV0aW5nQWxsUm93cyBmYWxzZSwgd2lsbCBzdGF5IG9uZSByb3dcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG9iai5vcHRpb25zLmFsbG93RGVsZXRpbmdBbGxSb3dzID09IGZhbHNlICYmIGxhc3RSb3cgKyAxID09PSBudW1PZlJvd3MpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG51bU9mUm93cy0tO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignSkVYQ0VMLiBJdCBpcyBub3QgcG9zc2libGUgdG8gZGVsZXRlIHRoZSBsYXN0IHJvdycpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBSZW1vdmUgbm9kZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciByb3cgPSByb3dOdW1iZXI7IHJvdyA8IHJvd051bWJlciArIG51bU9mUm93czsgcm93KyspIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChBcnJheS5wcm90b3R5cGUuaW5kZXhPZi5jYWxsKG9iai50Ym9keS5jaGlsZHJlbiwgb2JqLnJvd3Nbcm93XSkgPj0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9iai5yb3dzW3Jvd10uY2xhc3NOYW1lID0gJyc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb2JqLnJvd3Nbcm93XS5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKG9iai5yb3dzW3Jvd10pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBSZW1vdmUgZGF0YVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgcm93UmVjb3JkcyA9IG9iai5yZWNvcmRzLnNwbGljZShyb3dOdW1iZXIsIG51bU9mUm93cyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciByb3dEYXRhID0gb2JqLm9wdGlvbnMuZGF0YS5zcGxpY2Uocm93TnVtYmVyLCBudW1PZlJvd3MpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgcm93Tm9kZSA9IG9iai5yb3dzLnNwbGljZShyb3dOdW1iZXIsIG51bU9mUm93cyk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBSZXNwZWN0IHBhZ2luYXRpb25cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG9iai5vcHRpb25zLnBhZ2luYXRpb24gPiAwICYmIG9iai50Ym9keS5jaGlsZHJlbi5sZW5ndGggIT0gb2JqLm9wdGlvbnMucGFnaW5hdGlvbikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb2JqLnBhZ2Uob2JqLnBhZ2VOdW1iZXIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBSZW1vdmUgc2VsZWN0aW9uXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9iai5jb25kaXRpb25hbFNlbGVjdGlvblVwZGF0ZSgxLCByb3dOdW1iZXIsIChyb3dOdW1iZXIgKyBudW1PZlJvd3MpIC0gMSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBLZWVwIGhpc3RvcnlcclxuICAgICAgICAgICAgICAgICAgICAgICAgb2JqLnNldEhpc3Rvcnkoe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYWN0aW9uOiAnZGVsZXRlUm93JyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJvd051bWJlcjogcm93TnVtYmVyLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbnVtT2ZSb3dzOiBudW1PZlJvd3MsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnNlcnRCZWZvcmU6IDEsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByb3dSZWNvcmRzOiByb3dSZWNvcmRzLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcm93RGF0YTogcm93RGF0YSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJvd05vZGU6IHJvd05vZGVcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBSZW1vdmUgdGFibGUgcmVmZXJlbmNlc1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBvYmoudXBkYXRlVGFibGVSZWZlcmVuY2VzKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEV2ZW50c1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBvYmouZGlzcGF0Y2goJ29uZGVsZXRlcm93JywgZWwsIHJvd051bWJlciwgbnVtT2ZSb3dzLCByb3dSZWNvcmRzKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0pFWENFTC4gSXQgaXMgbm90IHBvc3NpYmxlIHRvIGRlbGV0ZSB0aGUgbGFzdCByb3cnKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIE1vdmUgY29sdW1uXHJcbiAgICAgICAgICpcclxuICAgICAgICAgKiBAcmV0dXJuIHZvaWRcclxuICAgICAgICAgKi9cclxuICAgICAgICBvYmoubW92ZUNvbHVtbiA9IGZ1bmN0aW9uIChvLCBkKSB7XHJcbiAgICAgICAgICAgIGlmIChPYmplY3Qua2V5cyhvYmoub3B0aW9ucy5tZXJnZUNlbGxzKS5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAobyA+IGQpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgaW5zZXJ0QmVmb3JlID0gMTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGluc2VydEJlZm9yZSA9IDA7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKG9iai5pc0NvbE1lcmdlZChvKS5sZW5ndGggfHwgb2JqLmlzQ29sTWVyZ2VkKGQsIGluc2VydEJlZm9yZSkubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFjb25maXJtKG9iai5vcHRpb25zLnRleHQudGhpc0FjdGlvbldpbGxEZXN0cm95QW55RXhpc3RpbmdNZXJnZWRDZWxsc0FyZVlvdVN1cmUpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBvYmouZGVzdHJveU1lcmdlZCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgdmFyIG8gPSBwYXJzZUludChvKTtcclxuICAgICAgICAgICAgdmFyIGQgPSBwYXJzZUludChkKTtcclxuXHJcbiAgICAgICAgICAgIGlmIChvID4gZCkge1xyXG4gICAgICAgICAgICAgICAgb2JqLmhlYWRlckNvbnRhaW5lci5pbnNlcnRCZWZvcmUob2JqLmhlYWRlcnNbb10sIG9iai5oZWFkZXJzW2RdKTtcclxuICAgICAgICAgICAgICAgIG9iai5jb2xncm91cENvbnRhaW5lci5pbnNlcnRCZWZvcmUob2JqLmNvbGdyb3VwW29dLCBvYmouY29sZ3JvdXBbZF0pO1xyXG5cclxuICAgICAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgb2JqLnJvd3MubGVuZ3RoOyBqKyspIHtcclxuICAgICAgICAgICAgICAgICAgICBvYmoucm93c1tqXS5pbnNlcnRCZWZvcmUob2JqLnJlY29yZHNbal1bb10sIG9iai5yZWNvcmRzW2pdW2RdKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIG9iai5oZWFkZXJDb250YWluZXIuaW5zZXJ0QmVmb3JlKG9iai5oZWFkZXJzW29dLCBvYmouaGVhZGVyc1tkXS5uZXh0U2libGluZyk7XHJcbiAgICAgICAgICAgICAgICBvYmouY29sZ3JvdXBDb250YWluZXIuaW5zZXJ0QmVmb3JlKG9iai5jb2xncm91cFtvXSwgb2JqLmNvbGdyb3VwW2RdLm5leHRTaWJsaW5nKTtcclxuXHJcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IG9iai5yb3dzLmxlbmd0aDsgaisrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgb2JqLnJvd3Nbal0uaW5zZXJ0QmVmb3JlKG9iai5yZWNvcmRzW2pdW29dLCBvYmoucmVjb3Jkc1tqXVtkXS5uZXh0U2libGluZyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIG9iai5vcHRpb25zLmNvbHVtbnMuc3BsaWNlKGQsIDAsIG9iai5vcHRpb25zLmNvbHVtbnMuc3BsaWNlKG8sIDEpWzBdKTtcclxuICAgICAgICAgICAgb2JqLmhlYWRlcnMuc3BsaWNlKGQsIDAsIG9iai5oZWFkZXJzLnNwbGljZShvLCAxKVswXSk7XHJcbiAgICAgICAgICAgIG9iai5jb2xncm91cC5zcGxpY2UoZCwgMCwgb2JqLmNvbGdyb3VwLnNwbGljZShvLCAxKVswXSk7XHJcblxyXG4gICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IG9iai5yb3dzLmxlbmd0aDsgaisrKSB7XHJcbiAgICAgICAgICAgICAgICBvYmoub3B0aW9ucy5kYXRhW2pdLnNwbGljZShkLCAwLCBvYmoub3B0aW9ucy5kYXRhW2pdLnNwbGljZShvLCAxKVswXSk7XHJcbiAgICAgICAgICAgICAgICBvYmoucmVjb3Jkc1tqXS5zcGxpY2UoZCwgMCwgb2JqLnJlY29yZHNbal0uc3BsaWNlKG8sIDEpWzBdKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gVXBkYXRlIGZvb3RlcnMgcG9zaXRpb25cclxuICAgICAgICAgICAgaWYgKG9iai5vcHRpb25zLmZvb3RlcnMpIHtcclxuICAgICAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgb2JqLm9wdGlvbnMuZm9vdGVycy5sZW5ndGg7IGorKykge1xyXG4gICAgICAgICAgICAgICAgICAgIG9iai5vcHRpb25zLmZvb3RlcnNbal0uc3BsaWNlKGQsIDAsIG9iai5vcHRpb25zLmZvb3RlcnNbal0uc3BsaWNlKG8sIDEpWzBdKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gS2VlcGluZyBoaXN0b3J5IG9mIGNoYW5nZXNcclxuICAgICAgICAgICAgb2JqLnNldEhpc3Rvcnkoe1xyXG4gICAgICAgICAgICAgICAgYWN0aW9uOiAnbW92ZUNvbHVtbicsXHJcbiAgICAgICAgICAgICAgICBvbGRWYWx1ZTogbyxcclxuICAgICAgICAgICAgICAgIG5ld1ZhbHVlOiBkLFxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIC8vIFVwZGF0ZSB0YWJsZSByZWZlcmVuY2VzXHJcbiAgICAgICAgICAgIG9iai51cGRhdGVUYWJsZVJlZmVyZW5jZXMoKTtcclxuXHJcbiAgICAgICAgICAgIC8vIEV2ZW50c1xyXG4gICAgICAgICAgICBvYmouZGlzcGF0Y2goJ29ubW92ZWNvbHVtbicsIGVsLCBvLCBkKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIEluc2VydCBhIG5ldyBjb2x1bW5cclxuICAgICAgICAgKlxyXG4gICAgICAgICAqIEBwYXJhbSBtaXhlZCAtIG51bSBvZiBjb2x1bW5zIHRvIGJlIGFkZGVkIG9yIGRhdGEgdG8gYmUgYWRkZWQgaW4gb25lIHNpbmdsZSBjb2x1bW5cclxuICAgICAgICAgKiBAcGFyYW0gaW50IGNvbHVtbk51bWJlciAtIG51bWJlciBvZiBjb2x1bW5zIHRvIGJlIGNyZWF0ZWRcclxuICAgICAgICAgKiBAcGFyYW0gYm9vbCBpbnNlcnRCZWZvcmVcclxuICAgICAgICAgKiBAcGFyYW0gb2JqZWN0IHByb3BlcnRpZXMgLSBjb2x1bW4gcHJvcGVydGllc1xyXG4gICAgICAgICAqIEByZXR1cm4gdm9pZFxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIG9iai5pbnNlcnRDb2x1bW4gPSBmdW5jdGlvbiAobWl4ZWQsIGNvbHVtbk51bWJlciwgaW5zZXJ0QmVmb3JlLCBwcm9wZXJ0aWVzKSB7XHJcbiAgICAgICAgICAgIC8vIENvbmZpZ3VyYXRpb25cclxuICAgICAgICAgICAgaWYgKG9iai5vcHRpb25zLmFsbG93SW5zZXJ0Q29sdW1uID09IHRydWUpIHtcclxuICAgICAgICAgICAgICAgIC8vIFJlY29yZHNcclxuICAgICAgICAgICAgICAgIHZhciByZWNvcmRzID0gW107XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gRGF0YSB0byBiZSBpbnNlcnRcclxuICAgICAgICAgICAgICAgIHZhciBkYXRhID0gW107XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gVGhlIGluc2VydCBjb3VsZCBiZSBsZWFkIGJ5IG51bWJlciBvZiByb3dzIG9yIHRoZSBhcnJheSBvZiBkYXRhXHJcbiAgICAgICAgICAgICAgICBpZiAobWl4ZWQgPiAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIG51bU9mQ29sdW1ucyA9IG1peGVkO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgbnVtT2ZDb2x1bW5zID0gMTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKG1peGVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEgPSBtaXhlZDtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gRGlyZWN0aW9uXHJcbiAgICAgICAgICAgICAgICB2YXIgaW5zZXJ0QmVmb3JlID0gaW5zZXJ0QmVmb3JlID8gdHJ1ZSA6IGZhbHNlO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIEN1cnJlbnQgY29sdW1uIG51bWJlclxyXG4gICAgICAgICAgICAgICAgdmFyIGxhc3RDb2x1bW4gPSBvYmoub3B0aW9ucy5jb2x1bW5zLmxlbmd0aCAtIDE7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gQ29uZmlybSBwb3NpdGlvblxyXG4gICAgICAgICAgICAgICAgaWYgKGNvbHVtbk51bWJlciA9PSB1bmRlZmluZWQgfHwgY29sdW1uTnVtYmVyID49IHBhcnNlSW50KGxhc3RDb2x1bW4pIHx8IGNvbHVtbk51bWJlciA8IDApIHtcclxuICAgICAgICAgICAgICAgICAgICBjb2x1bW5OdW1iZXIgPSBsYXN0Q29sdW1uO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIC8vIE9uYmVmb3JlaW5zZXJ0Y29sdW1uXHJcbiAgICAgICAgICAgICAgICBpZiAob2JqLmRpc3BhdGNoKCdvbmJlZm9yZWluc2VydGNvbHVtbicsIGVsLCBjb2x1bW5OdW1iZXIsIG51bU9mQ29sdW1ucywgaW5zZXJ0QmVmb3JlKSA9PT0gZmFsc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnb25iZWZvcmVpbnNlcnRjb2x1bW4gcmV0dXJuZWQgZmFsc2UnKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIC8vIE1lcmdlZCBjZWxsc1xyXG4gICAgICAgICAgICAgICAgaWYgKE9iamVjdC5rZXlzKG9iai5vcHRpb25zLm1lcmdlQ2VsbHMpLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAob2JqLmlzQ29sTWVyZ2VkKGNvbHVtbk51bWJlciwgaW5zZXJ0QmVmb3JlKS5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFjb25maXJtKG9iai5vcHRpb25zLnRleHQudGhpc0FjdGlvbldpbGxEZXN0cm95QW55RXhpc3RpbmdNZXJnZWRDZWxsc0FyZVlvdVN1cmUpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmouZGVzdHJveU1lcmdlZCgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIC8vIENyZWF0ZSBkZWZhdWx0IHByb3BlcnRpZXNcclxuICAgICAgICAgICAgICAgIGlmICghcHJvcGVydGllcykge1xyXG4gICAgICAgICAgICAgICAgICAgIHByb3BlcnRpZXMgPSBbXTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG51bU9mQ29sdW1uczsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFwcm9wZXJ0aWVzW2ldKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHByb3BlcnRpZXNbaV0gPSB7dHlwZTogJ3RleHQnLCBzb3VyY2U6IFtdLCBvcHRpb25zOiBbXSwgd2lkdGg6IG9iai5vcHRpb25zLmRlZmF1bHRDb2xXaWR0aCwgYWxpZ246IG9iai5vcHRpb25zLmRlZmF1bHRDb2xBbGlnbn07XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIC8vIEluc2VydCBiZWZvcmVcclxuICAgICAgICAgICAgICAgIHZhciBjb2x1bW5JbmRleCA9ICghaW5zZXJ0QmVmb3JlKSA/IGNvbHVtbk51bWJlciArIDEgOiBjb2x1bW5OdW1iZXI7XHJcbiAgICAgICAgICAgICAgICBvYmoub3B0aW9ucy5jb2x1bW5zID0gamV4Y2VsLmluamVjdEFycmF5KG9iai5vcHRpb25zLmNvbHVtbnMsIGNvbHVtbkluZGV4LCBwcm9wZXJ0aWVzKTtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyBPcGVuIHNwYWNlIGluIHRoZSBjb250YWluZXJzXHJcbiAgICAgICAgICAgICAgICB2YXIgY3VycmVudEhlYWRlcnMgPSBvYmouaGVhZGVycy5zcGxpY2UoY29sdW1uSW5kZXgpO1xyXG4gICAgICAgICAgICAgICAgdmFyIGN1cnJlbnRDb2xncm91cCA9IG9iai5jb2xncm91cC5zcGxpY2UoY29sdW1uSW5kZXgpO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIEhpc3RvcnlcclxuICAgICAgICAgICAgICAgIHZhciBoaXN0b3J5SGVhZGVycyA9IFtdO1xyXG4gICAgICAgICAgICAgICAgdmFyIGhpc3RvcnlDb2xncm91cCA9IFtdO1xyXG4gICAgICAgICAgICAgICAgdmFyIGhpc3RvcnlSZWNvcmRzID0gW107XHJcbiAgICAgICAgICAgICAgICB2YXIgaGlzdG9yeURhdGEgPSBbXTtcclxuICAgICAgICAgICAgICAgIHZhciBoaXN0b3J5Rm9vdGVycyA9IFtdO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIEFkZCBuZXcgaGVhZGVyc1xyXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgY29sID0gY29sdW1uSW5kZXg7IGNvbCA8IChudW1PZkNvbHVtbnMgKyBjb2x1bW5JbmRleCk7IGNvbCsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgb2JqLmNyZWF0ZUNlbGxIZWFkZXIoY29sKTtcclxuICAgICAgICAgICAgICAgICAgICBvYmouaGVhZGVyQ29udGFpbmVyLmluc2VydEJlZm9yZShvYmouaGVhZGVyc1tjb2xdLCBvYmouaGVhZGVyQ29udGFpbmVyLmNoaWxkcmVuW2NvbCArIDFdKTtcclxuICAgICAgICAgICAgICAgICAgICBvYmouY29sZ3JvdXBDb250YWluZXIuaW5zZXJ0QmVmb3JlKG9iai5jb2xncm91cFtjb2xdLCBvYmouY29sZ3JvdXBDb250YWluZXIuY2hpbGRyZW5bY29sICsgMV0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBoaXN0b3J5SGVhZGVycy5wdXNoKG9iai5oZWFkZXJzW2NvbF0pO1xyXG4gICAgICAgICAgICAgICAgICAgIGhpc3RvcnlDb2xncm91cC5wdXNoKG9iai5jb2xncm91cFtjb2xdKTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAvLyBBZGQgbmV3IGZvb3RlciBjZWxsc1xyXG4gICAgICAgICAgICAgICAgaWYgKG9iai5vcHRpb25zLmZvb3RlcnMpIHtcclxuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IG9iai5vcHRpb25zLmZvb3RlcnMubGVuZ3RoOyBqKyspIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaGlzdG9yeUZvb3RlcnNbal0gPSBbXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBudW1PZkNvbHVtbnM7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaGlzdG9yeUZvb3RlcnNbal0ucHVzaCgnJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgb2JqLm9wdGlvbnMuZm9vdGVyc1tqXS5zcGxpY2UoY29sdW1uSW5kZXgsIDAsIGhpc3RvcnlGb290ZXJzW2pdKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gQWRkaW5nIHZpc3VhbCBjb2x1bW5zXHJcbiAgICAgICAgICAgICAgICBmb3IgKHZhciByb3cgPSAwOyByb3cgPCBvYmoub3B0aW9ucy5kYXRhLmxlbmd0aDsgcm93KyspIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBLZWVwIHRoZSBjdXJyZW50IGRhdGFcclxuICAgICAgICAgICAgICAgICAgICB2YXIgY3VycmVudERhdGEgPSBvYmoub3B0aW9ucy5kYXRhW3Jvd10uc3BsaWNlKGNvbHVtbkluZGV4KTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgY3VycmVudFJlY29yZCA9IG9iai5yZWNvcmRzW3Jvd10uc3BsaWNlKGNvbHVtbkluZGV4KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgLy8gSGlzdG9yeVxyXG4gICAgICAgICAgICAgICAgICAgIGhpc3RvcnlEYXRhW3Jvd10gPSBbXTtcclxuICAgICAgICAgICAgICAgICAgICBoaXN0b3J5UmVjb3Jkc1tyb3ddID0gW107XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGNvbCA9IGNvbHVtbkluZGV4OyBjb2wgPCAobnVtT2ZDb2x1bW5zICsgY29sdW1uSW5kZXgpOyBjb2wrKykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBOZXcgdmFsdWVcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHZhbHVlID0gZGF0YVtyb3ddID8gZGF0YVtyb3ddIDogJyc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9iai5vcHRpb25zLmRhdGFbcm93XVtjb2xdID0gdmFsdWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIE5ldyBjZWxsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0ZCA9IG9iai5jcmVhdGVDZWxsKGNvbCwgcm93LCBvYmoub3B0aW9ucy5kYXRhW3Jvd11bY29sXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9iai5yZWNvcmRzW3Jvd11bY29sXSA9IHRkO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBBZGQgY2VsbCB0byB0aGUgcm93XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChvYmoucm93c1tyb3ddKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmoucm93c1tyb3ddLmluc2VydEJlZm9yZSh0ZCwgb2JqLnJvd3Nbcm93XS5jaGlsZHJlbltjb2wgKyAxXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFJlY29yZCBIaXN0b3J5XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGhpc3RvcnlEYXRhW3Jvd10ucHVzaCh2YWx1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGhpc3RvcnlSZWNvcmRzW3Jvd10ucHVzaCh0ZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAvLyBDb3B5IHRoZSBkYXRhIGJhY2sgdG8gdGhlIG1haW4gZGF0YVxyXG4gICAgICAgICAgICAgICAgICAgIEFycmF5LnByb3RvdHlwZS5wdXNoLmFwcGx5KG9iai5vcHRpb25zLmRhdGFbcm93XSwgY3VycmVudERhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgIEFycmF5LnByb3RvdHlwZS5wdXNoLmFwcGx5KG9iai5yZWNvcmRzW3Jvd10sIGN1cnJlbnRSZWNvcmQpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIEFycmF5LnByb3RvdHlwZS5wdXNoLmFwcGx5KG9iai5oZWFkZXJzLCBjdXJyZW50SGVhZGVycyk7XHJcbiAgICAgICAgICAgICAgICBBcnJheS5wcm90b3R5cGUucHVzaC5hcHBseShvYmouY29sZ3JvdXAsIGN1cnJlbnRDb2xncm91cCk7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gQWRqdXN0IG5lc3RlZCBoZWFkZXJzXHJcbiAgICAgICAgICAgICAgICBpZiAob2JqLm9wdGlvbnMubmVzdGVkSGVhZGVycyAmJiBvYmoub3B0aW9ucy5uZXN0ZWRIZWFkZXJzLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBGbGV4aWJsZSB3YXkgdG8gaGFuZGxlIG5lc3RlZGhlYWRlcnNcclxuICAgICAgICAgICAgICAgICAgICBpZiAob2JqLm9wdGlvbnMubmVzdGVkSGVhZGVyc1swXSAmJiBvYmoub3B0aW9ucy5uZXN0ZWRIZWFkZXJzWzBdWzBdKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgb2JqLm9wdGlvbnMubmVzdGVkSGVhZGVycy5sZW5ndGg7IGorKykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNvbHNwYW4gPSBwYXJzZUludChvYmoub3B0aW9ucy5uZXN0ZWRIZWFkZXJzW2pdW29iai5vcHRpb25zLm5lc3RlZEhlYWRlcnNbal0ubGVuZ3RoIC0gMV0uY29sc3BhbikgKyBudW1PZkNvbHVtbnM7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmoub3B0aW9ucy5uZXN0ZWRIZWFkZXJzW2pdW29iai5vcHRpb25zLm5lc3RlZEhlYWRlcnNbal0ubGVuZ3RoIC0gMV0uY29sc3BhbiA9IGNvbHNwYW47XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmoudGhlYWQuY2hpbGRyZW5bal0uY2hpbGRyZW5bb2JqLnRoZWFkLmNoaWxkcmVuW2pdLmNoaWxkcmVuLmxlbmd0aCAtIDFdLnNldEF0dHJpYnV0ZSgnY29sc3BhbicsIGNvbHNwYW4pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNvbHNwYW4gPSBwYXJzZUludChvYmoub3B0aW9ucy5uZXN0ZWRIZWFkZXJzWzBdLmNvbHNwYW4pICsgbnVtT2ZDb2x1bW5zO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBvYmoub3B0aW9ucy5uZXN0ZWRIZWFkZXJzWzBdLmNvbHNwYW4gPSBjb2xzcGFuO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBvYmoudGhlYWQuY2hpbGRyZW5bMF0uY2hpbGRyZW5bb2JqLnRoZWFkLmNoaWxkcmVuWzBdLmNoaWxkcmVuLmxlbmd0aCAtIDFdLnNldEF0dHJpYnV0ZSgnY29sc3BhbicsIGNvbHNwYW4pO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAvLyBLZWVwIGhpc3RvcnlcclxuICAgICAgICAgICAgICAgIG9iai5zZXRIaXN0b3J5KHtcclxuICAgICAgICAgICAgICAgICAgICBhY3Rpb246ICdpbnNlcnRDb2x1bW4nLFxyXG4gICAgICAgICAgICAgICAgICAgIGNvbHVtbk51bWJlcjogY29sdW1uTnVtYmVyLFxyXG4gICAgICAgICAgICAgICAgICAgIG51bU9mQ29sdW1uczogbnVtT2ZDb2x1bW5zLFxyXG4gICAgICAgICAgICAgICAgICAgIGluc2VydEJlZm9yZTogaW5zZXJ0QmVmb3JlLFxyXG4gICAgICAgICAgICAgICAgICAgIGNvbHVtbnM6IHByb3BlcnRpZXMsXHJcbiAgICAgICAgICAgICAgICAgICAgaGVhZGVyczogaGlzdG9yeUhlYWRlcnMsXHJcbiAgICAgICAgICAgICAgICAgICAgY29sZ3JvdXA6IGhpc3RvcnlDb2xncm91cCxcclxuICAgICAgICAgICAgICAgICAgICByZWNvcmRzOiBoaXN0b3J5UmVjb3JkcyxcclxuICAgICAgICAgICAgICAgICAgICBmb290ZXJzOiBoaXN0b3J5Rm9vdGVycyxcclxuICAgICAgICAgICAgICAgICAgICBkYXRhOiBoaXN0b3J5RGF0YSxcclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIFJlbW92ZSB0YWJsZSByZWZlcmVuY2VzXHJcbiAgICAgICAgICAgICAgICBvYmoudXBkYXRlVGFibGVSZWZlcmVuY2VzKCk7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gRXZlbnRzXHJcbiAgICAgICAgICAgICAgICBvYmouZGlzcGF0Y2goJ29uaW5zZXJ0Y29sdW1uJywgZWwsIGNvbHVtbk51bWJlciwgbnVtT2ZDb2x1bW5zLCBoaXN0b3J5UmVjb3JkcywgaW5zZXJ0QmVmb3JlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogRGVsZXRlIGEgY29sdW1uIGJ5IG51bWJlclxyXG4gICAgICAgICAqXHJcbiAgICAgICAgICogQHBhcmFtIGludGVnZXIgY29sdW1uTnVtYmVyIC0gcmVmZXJlbmNlIGNvbHVtbiB0byBiZSBleGNsdWRlZFxyXG4gICAgICAgICAqIEBwYXJhbSBpbnRlZ2VyIG51bU9mQ29sdW1ucyAtIG51bWJlciBvZiBjb2x1bW5zIHRvIGJlIGV4Y2x1ZGVkIGZyb20gdGhlIHJlZmVyZW5jZSBjb2x1bW5cclxuICAgICAgICAgKiBAcmV0dXJuIHZvaWRcclxuICAgICAgICAgKi9cclxuICAgICAgICBvYmouZGVsZXRlQ29sdW1uID0gZnVuY3Rpb24gKGNvbHVtbk51bWJlciwgbnVtT2ZDb2x1bW5zKSB7XHJcbiAgICAgICAgICAgIC8vIEdsb2JhbCBDb25maWd1cmF0aW9uXHJcbiAgICAgICAgICAgIGlmIChvYmoub3B0aW9ucy5hbGxvd0RlbGV0ZUNvbHVtbiA9PSB0cnVlKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAob2JqLmhlYWRlcnMubGVuZ3RoID4gMSkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIERlbGV0ZSBjb2x1bW4gZGVmaW5pdGlvbnNcclxuICAgICAgICAgICAgICAgICAgICBpZiAoY29sdW1uTnVtYmVyID09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgbnVtYmVyID0gb2JqLmdldFNlbGVjdGVkQ29sdW1ucyh0cnVlKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghbnVtYmVyLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gUmVtb3ZlIGxhc3QgY29sdW1uXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2x1bW5OdW1iZXIgPSBvYmouaGVhZGVycy5sZW5ndGggLSAxO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbnVtT2ZDb2x1bW5zID0gMTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFJlbW92ZSBzZWxlY3RlZFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sdW1uTnVtYmVyID0gcGFyc2VJbnQobnVtYmVyWzBdKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG51bU9mQ29sdW1ucyA9IHBhcnNlSW50KG51bWJlci5sZW5ndGgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAvLyBMYXNhdCBjb2x1bW5cclxuICAgICAgICAgICAgICAgICAgICB2YXIgbGFzdENvbHVtbiA9IG9iai5vcHRpb25zLmRhdGFbMF0ubGVuZ3RoIC0gMTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNvbHVtbk51bWJlciA9PSB1bmRlZmluZWQgfHwgY29sdW1uTnVtYmVyID4gbGFzdENvbHVtbiB8fCBjb2x1bW5OdW1iZXIgPCAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbHVtbk51bWJlciA9IGxhc3RDb2x1bW47XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAvLyBNaW5pbXVtIG9mIGNvbHVtbnMgdG8gYmUgZGVsZXRlIGlzIDFcclxuICAgICAgICAgICAgICAgICAgICBpZiAoIW51bU9mQ29sdW1ucykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBudW1PZkNvbHVtbnMgPSAxO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgLy8gQ2FuJ3QgZGVsZXRlIG1vcmUgdGhhbiB0aGUgbGltaXQgb2YgdGhlIHRhYmxlXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKG51bU9mQ29sdW1ucyA+IG9iai5vcHRpb25zLmRhdGFbMF0ubGVuZ3RoIC0gY29sdW1uTnVtYmVyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG51bU9mQ29sdW1ucyA9IG9iai5vcHRpb25zLmRhdGFbMF0ubGVuZ3RoIC0gY29sdW1uTnVtYmVyO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgLy8gb25iZWZvcmVkZWxldGVjb2x1bW5cclxuICAgICAgICAgICAgICAgICAgICBpZiAob2JqLmRpc3BhdGNoKCdvbmJlZm9yZWRlbGV0ZWNvbHVtbicsIGVsLCBjb2x1bW5OdW1iZXIsIG51bU9mQ29sdW1ucykgPT09IGZhbHNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdvbmJlZm9yZWRlbGV0ZWNvbHVtbiByZXR1cm5lZCBmYWxzZScpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAvLyBDYW4ndCByZW1vdmUgdGhlIGxhc3QgY29sdW1uXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHBhcnNlSW50KGNvbHVtbk51bWJlcikgPiAtMSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBNZXJnZWQgY2VsbHNcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG1lcmdlRXhpc3RzID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChPYmplY3Qua2V5cyhvYmoub3B0aW9ucy5tZXJnZUNlbGxzKS5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBjb2wgPSBjb2x1bW5OdW1iZXI7IGNvbCA8IGNvbHVtbk51bWJlciArIG51bU9mQ29sdW1uczsgY29sKyspIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAob2JqLmlzQ29sTWVyZ2VkKGNvbCwgZmFsc2UpLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXJnZUV4aXN0cyA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChtZXJnZUV4aXN0cykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFjb25maXJtKG9iai5vcHRpb25zLnRleHQudGhpc0FjdGlvbldpbGxEZXN0cm95QW55RXhpc3RpbmdNZXJnZWRDZWxsc0FyZVlvdVN1cmUpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmouZGVzdHJveU1lcmdlZCgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBEZWxldGUgdGhlIGNvbHVtbiBwcm9wZXJ0aWVzXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjb2x1bW5zID0gb2JqLm9wdGlvbnMuY29sdW1ucy5zcGxpY2UoY29sdW1uTnVtYmVyLCBudW1PZkNvbHVtbnMpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgY29sID0gY29sdW1uTnVtYmVyOyBjb2wgPCBjb2x1bW5OdW1iZXIgKyBudW1PZkNvbHVtbnM7IGNvbCsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmouY29sZ3JvdXBbY29sXS5jbGFzc05hbWUgPSAnJztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9iai5oZWFkZXJzW2NvbF0uY2xhc3NOYW1lID0gJyc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmouY29sZ3JvdXBbY29sXS5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKG9iai5jb2xncm91cFtjb2xdKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9iai5oZWFkZXJzW2NvbF0ucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChvYmouaGVhZGVyc1tjb2xdKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGhpc3RvcnlIZWFkZXJzID0gb2JqLmhlYWRlcnMuc3BsaWNlKGNvbHVtbk51bWJlciwgbnVtT2ZDb2x1bW5zKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGhpc3RvcnlDb2xncm91cCA9IG9iai5jb2xncm91cC5zcGxpY2UoY29sdW1uTnVtYmVyLCBudW1PZkNvbHVtbnMpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgaGlzdG9yeVJlY29yZHMgPSBbXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGhpc3RvcnlEYXRhID0gW107XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBoaXN0b3J5Rm9vdGVycyA9IFtdO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgcm93ID0gMDsgcm93IDwgb2JqLm9wdGlvbnMuZGF0YS5sZW5ndGg7IHJvdysrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBjb2wgPSBjb2x1bW5OdW1iZXI7IGNvbCA8IGNvbHVtbk51bWJlciArIG51bU9mQ29sdW1uczsgY29sKyspIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmoucmVjb3Jkc1tyb3ddW2NvbF0uY2xhc3NOYW1lID0gJyc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb2JqLnJlY29yZHNbcm93XVtjb2xdLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQob2JqLnJlY29yZHNbcm93XVtjb2xdKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gRGVsZXRlIGhlYWRlcnNcclxuICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgcm93ID0gMDsgcm93IDwgb2JqLm9wdGlvbnMuZGF0YS5sZW5ndGg7IHJvdysrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBIaXN0b3J5XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoaXN0b3J5RGF0YVtyb3ddID0gb2JqLm9wdGlvbnMuZGF0YVtyb3ddLnNwbGljZShjb2x1bW5OdW1iZXIsIG51bU9mQ29sdW1ucyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoaXN0b3J5UmVjb3Jkc1tyb3ddID0gb2JqLnJlY29yZHNbcm93XS5zcGxpY2UoY29sdW1uTnVtYmVyLCBudW1PZkNvbHVtbnMpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBEZWxldGUgZm9vdGVyc1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAob2JqLm9wdGlvbnMuZm9vdGVycykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgcm93ID0gMDsgcm93IDwgb2JqLm9wdGlvbnMuZm9vdGVycy5sZW5ndGg7IHJvdysrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaGlzdG9yeUZvb3RlcnNbcm93XSA9IG9iai5vcHRpb25zLmZvb3RlcnNbcm93XS5zcGxpY2UoY29sdW1uTnVtYmVyLCBudW1PZkNvbHVtbnMpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBSZW1vdmUgc2VsZWN0aW9uXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9iai5jb25kaXRpb25hbFNlbGVjdGlvblVwZGF0ZSgwLCBjb2x1bW5OdW1iZXIsIChjb2x1bW5OdW1iZXIgKyBudW1PZkNvbHVtbnMpIC0gMSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBBZGp1c3QgbmVzdGVkIGhlYWRlcnNcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG9iai5vcHRpb25zLm5lc3RlZEhlYWRlcnMgJiYgb2JqLm9wdGlvbnMubmVzdGVkSGVhZGVycy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBGbGV4aWJsZSB3YXkgdG8gaGFuZGxlIG5lc3RlZGhlYWRlcnNcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChvYmoub3B0aW9ucy5uZXN0ZWRIZWFkZXJzWzBdICYmIG9iai5vcHRpb25zLm5lc3RlZEhlYWRlcnNbMF1bMF0pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IG9iai5vcHRpb25zLm5lc3RlZEhlYWRlcnMubGVuZ3RoOyBqKyspIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNvbHNwYW4gPSBwYXJzZUludChvYmoub3B0aW9ucy5uZXN0ZWRIZWFkZXJzW2pdW29iai5vcHRpb25zLm5lc3RlZEhlYWRlcnNbal0ubGVuZ3RoIC0gMV0uY29sc3BhbikgLSBudW1PZkNvbHVtbnM7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9iai5vcHRpb25zLm5lc3RlZEhlYWRlcnNbal1bb2JqLm9wdGlvbnMubmVzdGVkSGVhZGVyc1tqXS5sZW5ndGggLSAxXS5jb2xzcGFuID0gY29sc3BhbjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb2JqLnRoZWFkLmNoaWxkcmVuW2pdLmNoaWxkcmVuW29iai50aGVhZC5jaGlsZHJlbltqXS5jaGlsZHJlbi5sZW5ndGggLSAxXS5zZXRBdHRyaWJ1dGUoJ2NvbHNwYW4nLCBjb2xzcGFuKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjb2xzcGFuID0gcGFyc2VJbnQob2JqLm9wdGlvbnMubmVzdGVkSGVhZGVyc1swXS5jb2xzcGFuKSAtIG51bU9mQ29sdW1ucztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmoub3B0aW9ucy5uZXN0ZWRIZWFkZXJzWzBdLmNvbHNwYW4gPSBjb2xzcGFuO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9iai50aGVhZC5jaGlsZHJlblswXS5jaGlsZHJlbltvYmoudGhlYWQuY2hpbGRyZW5bMF0uY2hpbGRyZW4ubGVuZ3RoIC0gMV0uc2V0QXR0cmlidXRlKCdjb2xzcGFuJywgY29sc3Bhbik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEtlZXBpbmcgaGlzdG9yeSBvZiBjaGFuZ2VzXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9iai5zZXRIaXN0b3J5KHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjdGlvbjogJ2RlbGV0ZUNvbHVtbicsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2x1bW5OdW1iZXI6IGNvbHVtbk51bWJlcixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG51bU9mQ29sdW1uczogbnVtT2ZDb2x1bW5zLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5zZXJ0QmVmb3JlOiAxLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sdW1uczogY29sdW1ucyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhlYWRlcnM6IGhpc3RvcnlIZWFkZXJzLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sZ3JvdXA6IGhpc3RvcnlDb2xncm91cCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlY29yZHM6IGhpc3RvcnlSZWNvcmRzLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9vdGVyczogaGlzdG9yeUZvb3RlcnMsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhOiBoaXN0b3J5RGF0YSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBVcGRhdGUgdGFibGUgcmVmZXJlbmNlc1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBvYmoudXBkYXRlVGFibGVSZWZlcmVuY2VzKCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBEZWxldGVcclxuICAgICAgICAgICAgICAgICAgICAgICAgb2JqLmRpc3BhdGNoKCdvbmRlbGV0ZWNvbHVtbicsIGVsLCBjb2x1bW5OdW1iZXIsIG51bU9mQ29sdW1ucywgaGlzdG9yeVJlY29yZHMpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignSkVYQ0VMLiBJdCBpcyBub3QgcG9zc2libGUgdG8gZGVsZXRlIHRoZSBsYXN0IGNvbHVtbicpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvKipcclxuICAgICAgICAgKiBHZXQgc2VsZXRlZCByb3dzIG51bWJlcnNcclxuICAgICAgICAgKlxyXG4gICAgICAgICAqIEByZXR1cm4gYXJyYXlcclxuICAgICAgICAgKi9cclxuICAgICAgICBvYmouZ2V0U2VsZWN0ZWRSb3dzID0gZnVuY3Rpb24gKGFzSWRzKSB7XHJcbiAgICAgICAgICAgIHZhciByb3dzID0gW107XHJcbiAgICAgICAgICAgIC8vIEdldCBhbGwgc2VsZWN0ZWQgcm93c1xyXG4gICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IG9iai5yb3dzLmxlbmd0aDsgaisrKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAob2JqLnJvd3Nbal0uY2xhc3NMaXN0LmNvbnRhaW5zKCdzZWxlY3RlZCcpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGFzSWRzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJvd3MucHVzaChqKTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByb3dzLnB1c2gob2JqLnJvd3Nbal0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgcmV0dXJuIHJvd3M7XHJcbiAgICAgICAgfSxcclxuXHJcbiAgICAgICAgICAgIC8qKlxyXG4gICAgICAgICAgICAgKiBHZXQgc2VsZXRlZCBjb2x1bW4gbnVtYmVyc1xyXG4gICAgICAgICAgICAgKlxyXG4gICAgICAgICAgICAgKiBAcmV0dXJuIGFycmF5XHJcbiAgICAgICAgICAgICAqL1xyXG4gICAgICAgICAgICBvYmouZ2V0U2VsZWN0ZWRDb2x1bW5zID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGNvbHMgPSBbXTtcclxuICAgICAgICAgICAgICAgIC8vIEdldCBhbGwgc2VsZWN0ZWQgY29sc1xyXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBvYmouaGVhZGVycy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChvYmouaGVhZGVyc1tpXS5jbGFzc0xpc3QuY29udGFpbnMoJ3NlbGVjdGVkJykpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29scy5wdXNoKGkpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gY29scztcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAvKipcclxuICAgICAgICAgKiBHZXQgaGlnaGxpZ2h0ZWRcclxuICAgICAgICAgKlxyXG4gICAgICAgICAqIEByZXR1cm4gYXJyYXlcclxuICAgICAgICAgKi9cclxuICAgICAgICBvYmouZ2V0SGlnaGxpZ2h0ZWQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBvYmouaGlnaGxpZ2h0ZWQ7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvKipcclxuICAgICAgICAgKiBVcGRhdGUgY2VsbCByZWZlcmVuY2VzXHJcbiAgICAgICAgICpcclxuICAgICAgICAgKiBAcmV0dXJuIHZvaWRcclxuICAgICAgICAgKi9cclxuICAgICAgICBvYmoudXBkYXRlVGFibGVSZWZlcmVuY2VzID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAvLyBVcGRhdGUgaGVhZGVyc1xyXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG9iai5oZWFkZXJzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgeCA9IG9iai5oZWFkZXJzW2ldLmdldEF0dHJpYnV0ZSgnZGF0YS14Jyk7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKHggIT0gaSkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIFVwZGF0ZSBjb29yZHNcclxuICAgICAgICAgICAgICAgICAgICBvYmouaGVhZGVyc1tpXS5zZXRBdHRyaWJ1dGUoJ2RhdGEteCcsIGkpO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIFRpdGxlXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFvYmouaGVhZGVyc1tpXS5nZXRBdHRyaWJ1dGUoJ3RpdGxlJykpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgb2JqLmhlYWRlcnNbaV0uaW5uZXJIVE1MID0gamV4Y2VsLmdldENvbHVtbk5hbWUoaSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBVcGRhdGUgYWxsIHJvd3NcclxuICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBvYmoucm93cy5sZW5ndGg7IGorKykge1xyXG4gICAgICAgICAgICAgICAgaWYgKG9iai5yb3dzW2pdKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHkgPSBvYmoucm93c1tqXS5nZXRBdHRyaWJ1dGUoJ2RhdGEteScpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBpZiAoeSAhPSBqKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFVwZGF0ZSBjb29yZHNcclxuICAgICAgICAgICAgICAgICAgICAgICAgb2JqLnJvd3Nbal0uc2V0QXR0cmlidXRlKCdkYXRhLXknLCBqKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgb2JqLnJvd3Nbal0uY2hpbGRyZW5bMF0uc2V0QXR0cmlidXRlKCdkYXRhLXknLCBqKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gUm93IG51bWJlclxyXG4gICAgICAgICAgICAgICAgICAgICAgICBvYmoucm93c1tqXS5jaGlsZHJlblswXS5pbm5lckhUTUwgPSBqICsgMTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIFJlZ3VsYXIgY2VsbHMgYWZmZWN0ZWQgYnkgdGhpcyBjaGFuZ2VcclxuICAgICAgICAgICAgdmFyIGFmZmVjdGVkVG9rZW5zID0gW107XHJcbiAgICAgICAgICAgIHZhciBtZXJnZUNlbGxVcGRhdGVzID0gW107XHJcblxyXG4gICAgICAgICAgICAvLyBVcGRhdGUgY2VsbFxyXG4gICAgICAgICAgICB2YXIgdXBkYXRlUG9zaXRpb24gPSBmdW5jdGlvbiAoeCwgeSwgaSwgaikge1xyXG4gICAgICAgICAgICAgICAgaWYgKHggIT0gaSkge1xyXG4gICAgICAgICAgICAgICAgICAgIG9iai5yZWNvcmRzW2pdW2ldLnNldEF0dHJpYnV0ZSgnZGF0YS14JywgaSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAoeSAhPSBqKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgb2JqLnJlY29yZHNbal1baV0uc2V0QXR0cmlidXRlKCdkYXRhLXknLCBqKTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAvLyBPdGhlciB1cGRhdGVzXHJcbiAgICAgICAgICAgICAgICBpZiAoeCAhPSBpIHx8IHkgIT0gaikge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBjb2x1bW5JZEZyb20gPSBqZXhjZWwuZ2V0Q29sdW1uTmFtZUZyb21JZChbeCwgeV0pO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBjb2x1bW5JZFRvID0gamV4Y2VsLmdldENvbHVtbk5hbWVGcm9tSWQoW2ksIGpdKTtcclxuICAgICAgICAgICAgICAgICAgICBhZmZlY3RlZFRva2Vuc1tjb2x1bW5JZEZyb21dID0gY29sdW1uSWRUbztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBvYmoucmVjb3Jkcy5sZW5ndGg7IGorKykge1xyXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBvYmoucmVjb3Jkc1swXS5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChvYmoucmVjb3Jkc1tqXVtpXSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBDdXJyZW50IHZhbHVlc1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgeCA9IG9iai5yZWNvcmRzW2pdW2ldLmdldEF0dHJpYnV0ZSgnZGF0YS14Jyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB5ID0gb2JqLnJlY29yZHNbal1baV0uZ2V0QXR0cmlidXRlKCdkYXRhLXknKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFVwZGF0ZSBjb2x1bW5cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG9iai5yZWNvcmRzW2pdW2ldLmdldEF0dHJpYnV0ZSgnZGF0YS1tZXJnZWQnKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNvbHVtbklkRnJvbSA9IGpleGNlbC5nZXRDb2x1bW5OYW1lRnJvbUlkKFt4LCB5XSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgY29sdW1uSWRUbyA9IGpleGNlbC5nZXRDb2x1bW5OYW1lRnJvbUlkKFtpLCBqXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAobWVyZ2VDZWxsVXBkYXRlc1tjb2x1bW5JZEZyb21dID09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoY29sdW1uSWRGcm9tID09IGNvbHVtbklkVG8pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWVyZ2VDZWxsVXBkYXRlc1tjb2x1bW5JZEZyb21dID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHRvdGFsWCA9IHBhcnNlSW50KGkgLSB4KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHRvdGFsWSA9IHBhcnNlSW50KGogLSB5KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWVyZ2VDZWxsVXBkYXRlc1tjb2x1bW5JZEZyb21dID0gW2NvbHVtbklkVG8sIHRvdGFsWCwgdG90YWxZXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cGRhdGVQb3NpdGlvbih4LCB5LCBpLCBqKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gVXBkYXRlIG1lcmdlZCBpZiBhcHBsaWNhYmxlXHJcbiAgICAgICAgICAgIHZhciBrZXlzID0gT2JqZWN0LmtleXMobWVyZ2VDZWxsVXBkYXRlcyk7XHJcbiAgICAgICAgICAgIGlmIChrZXlzLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBrZXlzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKG1lcmdlQ2VsbFVwZGF0ZXNba2V5c1tpXV0pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGluZm8gPSBqZXhjZWwuZ2V0SWRGcm9tQ29sdW1uTmFtZShrZXlzW2ldLCB0cnVlKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgeCA9IGluZm9bMF07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB5ID0gaW5mb1sxXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdXBkYXRlUG9zaXRpb24oeCwgeSwgeCArIG1lcmdlQ2VsbFVwZGF0ZXNba2V5c1tpXV1bMV0sIHkgKyBtZXJnZUNlbGxVcGRhdGVzW2tleXNbaV1dWzJdKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjb2x1bW5JZEZyb20gPSBrZXlzW2ldO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgY29sdW1uSWRUbyA9IG1lcmdlQ2VsbFVwZGF0ZXNba2V5c1tpXV1bMF07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgb2JqLm9wdGlvbnMubWVyZ2VDZWxsc1tjb2x1bW5JZEZyb21dWzJdLmxlbmd0aDsgaisrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgeCA9IHBhcnNlSW50KG9iai5vcHRpb25zLm1lcmdlQ2VsbHNbY29sdW1uSWRGcm9tXVsyXVtqXS5nZXRBdHRyaWJ1dGUoJ2RhdGEteCcpKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB5ID0gcGFyc2VJbnQob2JqLm9wdGlvbnMubWVyZ2VDZWxsc1tjb2x1bW5JZEZyb21dWzJdW2pdLmdldEF0dHJpYnV0ZSgnZGF0YS15JykpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb2JqLm9wdGlvbnMubWVyZ2VDZWxsc1tjb2x1bW5JZEZyb21dWzJdW2pdLnNldEF0dHJpYnV0ZSgnZGF0YS14JywgeCArIG1lcmdlQ2VsbFVwZGF0ZXNba2V5c1tpXV1bMV0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb2JqLm9wdGlvbnMubWVyZ2VDZWxsc1tjb2x1bW5JZEZyb21dWzJdW2pdLnNldEF0dHJpYnV0ZSgnZGF0YS15JywgeSArIG1lcmdlQ2VsbFVwZGF0ZXNba2V5c1tpXV1bMl0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBvYmoub3B0aW9ucy5tZXJnZUNlbGxzW2NvbHVtbklkVG9dID0gb2JqLm9wdGlvbnMubWVyZ2VDZWxsc1tjb2x1bW5JZEZyb21dO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBkZWxldGUgKG9iai5vcHRpb25zLm1lcmdlQ2VsbHNbY29sdW1uSWRGcm9tXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBVcGRhdGUgZm9ybXVsYXNcclxuICAgICAgICAgICAgb2JqLnVwZGF0ZUZvcm11bGFzKGFmZmVjdGVkVG9rZW5zKTtcclxuXHJcbiAgICAgICAgICAgIC8vIFVwZGF0ZSBtZXRhIGRhdGFcclxuICAgICAgICAgICAgb2JqLnVwZGF0ZU1ldGEoYWZmZWN0ZWRUb2tlbnMpO1xyXG5cclxuICAgICAgICAgICAgLy8gUmVmcmVzaCBzZWxlY3Rpb25cclxuICAgICAgICAgICAgb2JqLnJlZnJlc2hTZWxlY3Rpb24oKTtcclxuXHJcbiAgICAgICAgICAgIC8vIFVwZGF0ZSB0YWJsZSB3aXRoIGN1c3RvbSBjb25maWd1cmF0aW9uIGlmIGFwcGxpY2FibGVcclxuICAgICAgICAgICAgb2JqLnVwZGF0ZVRhYmxlKCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvKipcclxuICAgICAgICAgKiBDdXN0b20gc2V0dGluZ3MgZm9yIHRoZSBjZWxsc1xyXG4gICAgICAgICAqL1xyXG4gICAgICAgIG9iai51cGRhdGVUYWJsZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgLy8gQ2hlY2sgZm9yIHNwYXJlXHJcbiAgICAgICAgICAgIGlmIChvYmoub3B0aW9ucy5taW5TcGFyZVJvd3MgPiAwKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgbnVtQmxhbmtSb3dzID0gMDtcclxuICAgICAgICAgICAgICAgIGZvciAodmFyIGogPSBvYmoucm93cy5sZW5ndGggLSAxOyBqID49IDA7IGotLSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciB0ZXN0ID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBvYmouaGVhZGVycy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAob2JqLm9wdGlvbnMuZGF0YVtqXVtpXSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGVzdCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRlc3QpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbnVtQmxhbmtSb3dzKys7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGlmIChvYmoub3B0aW9ucy5taW5TcGFyZVJvd3MgLSBudW1CbGFua1Jvd3MgPiAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgb2JqLmluc2VydFJvdyhvYmoub3B0aW9ucy5taW5TcGFyZVJvd3MgLSBudW1CbGFua1Jvd3MpXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmIChvYmoub3B0aW9ucy5taW5TcGFyZUNvbHMgPiAwKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgbnVtQmxhbmtDb2xzID0gMDtcclxuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSBvYmouaGVhZGVycy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciB0ZXN0ID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBvYmoucm93cy5sZW5ndGg7IGorKykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAob2JqLm9wdGlvbnMuZGF0YVtqXVtpXSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGVzdCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRlc3QpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbnVtQmxhbmtDb2xzKys7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGlmIChvYmoub3B0aW9ucy5taW5TcGFyZUNvbHMgLSBudW1CbGFua0NvbHMgPiAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgb2JqLmluc2VydENvbHVtbihvYmoub3B0aW9ucy5taW5TcGFyZUNvbHMgLSBudW1CbGFua0NvbHMpXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIEN1c3RvbWl6YXRpb25zIGJ5IHRoZSBkZXZlbG9wZXJcclxuICAgICAgICAgICAgaWYgKHR5cGVvZiAob2JqLm9wdGlvbnMudXBkYXRlVGFibGUpID09ICdmdW5jdGlvbicpIHtcclxuICAgICAgICAgICAgICAgIGlmIChvYmoub3B0aW9ucy5kZXRhY2hGb3JVcGRhdGVzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZWwucmVtb3ZlQ2hpbGQob2JqLmNvbnRlbnQpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgb2JqLnJvd3MubGVuZ3RoOyBqKyspIHtcclxuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG9iai5oZWFkZXJzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9iai5vcHRpb25zLnVwZGF0ZVRhYmxlKGVsLCBvYmoucmVjb3Jkc1tqXVtpXSwgaSwgaiwgb2JqLm9wdGlvbnMuZGF0YVtqXVtpXSwgb2JqLnJlY29yZHNbal1baV0uaW5uZXJUZXh0LCBqZXhjZWwuZ2V0Q29sdW1uTmFtZUZyb21JZChbaSwgal0pKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKG9iai5vcHRpb25zLmRldGFjaEZvclVwZGF0ZXMpIHtcclxuICAgICAgICAgICAgICAgICAgICBlbC5pbnNlcnRCZWZvcmUob2JqLmNvbnRlbnQsIG9iai5wYWdpbmF0aW9uKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gVXBkYXRlIGZvb3RlcnNcclxuICAgICAgICAgICAgaWYgKG9iai5vcHRpb25zLmZvb3RlcnMpIHtcclxuICAgICAgICAgICAgICAgIG9iai5zZXRGb290ZXIoKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gVXBkYXRlIGNvcm5lciBwb3NpdGlvblxyXG4gICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIG9iai51cGRhdGVDb3JuZXJQb3NpdGlvbigpO1xyXG4gICAgICAgICAgICB9LCAwKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIFJlYWRvbmx5XHJcbiAgICAgICAgICovXHJcbiAgICAgICAgb2JqLmlzUmVhZE9ubHkgPSBmdW5jdGlvbiAoY2VsbCkge1xyXG4gICAgICAgICAgICBpZiAoY2VsbCA9IG9iai5nZXRDZWxsKGNlbGwpKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gY2VsbC5jbGFzc0xpc3QuY29udGFpbnMoJ3JlYWRvbmx5JykgPyB0cnVlIDogZmFsc2U7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIFJlYWRvbmx5XHJcbiAgICAgICAgICovXHJcbiAgICAgICAgb2JqLnNldFJlYWRPbmx5ID0gZnVuY3Rpb24gKGNlbGwsIHN0YXRlKSB7XHJcbiAgICAgICAgICAgIGlmIChjZWxsID0gb2JqLmdldENlbGwoY2VsbCkpIHtcclxuICAgICAgICAgICAgICAgIGlmIChzdGF0ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNlbGwuY2xhc3NMaXN0LmFkZCgncmVhZG9ubHknKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY2VsbC5jbGFzc0xpc3QucmVtb3ZlKCdyZWFkb25seScpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvKipcclxuICAgICAgICAgKiBTaG93IHJvd1xyXG4gICAgICAgICAqL1xyXG4gICAgICAgIG9iai5zaG93Um93ID0gZnVuY3Rpb24gKHJvd051bWJlcikge1xyXG4gICAgICAgICAgICBvYmoucm93c1tyb3dOdW1iZXJdLnN0eWxlLmRpc3BsYXkgPSAnJztcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIEhpZGUgcm93XHJcbiAgICAgICAgICovXHJcbiAgICAgICAgb2JqLmhpZGVSb3cgPSBmdW5jdGlvbiAocm93TnVtYmVyKSB7XHJcbiAgICAgICAgICAgIG9iai5yb3dzW3Jvd051bWJlcl0uc3R5bGUuZGlzcGxheSA9ICdub25lJztcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIFNob3cgY29sdW1uXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgb2JqLnNob3dDb2x1bW4gPSBmdW5jdGlvbiAoY29sTnVtYmVyKSB7XHJcbiAgICAgICAgICAgIG9iai5oZWFkZXJzW2NvbE51bWJlcl0uc3R5bGUuZGlzcGxheSA9ICcnO1xyXG4gICAgICAgICAgICBvYmouY29sZ3JvdXBbY29sTnVtYmVyXS5zdHlsZS5kaXNwbGF5ID0gJyc7XHJcbiAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgb2JqLm9wdGlvbnMuZGF0YS5sZW5ndGg7IGorKykge1xyXG4gICAgICAgICAgICAgICAgb2JqLnJlY29yZHNbal1bY29sTnVtYmVyXS5zdHlsZS5kaXNwbGF5ID0gJyc7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIEhpZGUgY29sdW1uXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgb2JqLmhpZGVDb2x1bW4gPSBmdW5jdGlvbiAoY29sTnVtYmVyKSB7XHJcbiAgICAgICAgICAgIG9iai5oZWFkZXJzW2NvbE51bWJlcl0uc3R5bGUuZGlzcGxheSA9ICdub25lJztcclxuICAgICAgICAgICAgb2JqLmNvbGdyb3VwW2NvbE51bWJlcl0uc3R5bGUuZGlzcGxheSA9ICdub25lJztcclxuICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBvYmoub3B0aW9ucy5kYXRhLmxlbmd0aDsgaisrKSB7XHJcbiAgICAgICAgICAgICAgICBvYmoucmVjb3Jkc1tqXVtjb2xOdW1iZXJdLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIFNob3cgaW5kZXggY29sdW1uXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgb2JqLnNob3dJbmRleCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgb2JqLnRhYmxlLmNsYXNzTGlzdC5yZW1vdmUoJ2pleGNlbF9oaWRkZW5faW5kZXgnKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIEhpZGUgaW5kZXggY29sdW1uXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgb2JqLmhpZGVJbmRleCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgb2JqLnRhYmxlLmNsYXNzTGlzdC5hZGQoJ2pleGNlbF9oaWRkZW5faW5kZXgnKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIFVwZGF0ZSBhbGwgcmVsYXRlZCBjZWxscyBpbiB0aGUgY2hhaW5cclxuICAgICAgICAgKi9cclxuICAgICAgICB2YXIgY2hhaW5Mb29wUHJvdGVjdGlvbiA9IFtdO1xyXG5cclxuICAgICAgICBvYmoudXBkYXRlRm9ybXVsYUNoYWluID0gZnVuY3Rpb24gKHgsIHksIHJlY29yZHMpIHtcclxuICAgICAgICAgICAgdmFyIGNlbGxJZCA9IGpleGNlbC5nZXRDb2x1bW5OYW1lRnJvbUlkKFt4LCB5XSk7XHJcbiAgICAgICAgICAgIGlmIChvYmouZm9ybXVsYVtjZWxsSWRdICYmIG9iai5mb3JtdWxhW2NlbGxJZF0ubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKGNoYWluTG9vcFByb3RlY3Rpb25bY2VsbElkXSkge1xyXG4gICAgICAgICAgICAgICAgICAgIG9iai5yZWNvcmRzW3ldW3hdLmlubmVySFRNTCA9ICcjRVJST1InO1xyXG4gICAgICAgICAgICAgICAgICAgIG9iai5mb3JtdWxhW2NlbGxJZF0gPSAnJztcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gUHJvdGVjdGlvblxyXG4gICAgICAgICAgICAgICAgICAgIGNoYWluTG9vcFByb3RlY3Rpb25bY2VsbElkXSA9IHRydWU7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgb2JqLmZvcm11bGFbY2VsbElkXS5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgY2VsbCA9IGpleGNlbC5nZXRJZEZyb21Db2x1bW5OYW1lKG9iai5mb3JtdWxhW2NlbGxJZF1baV0sIHRydWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBVcGRhdGUgY2VsbFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgdmFsdWUgPSAnJyArIG9iai5vcHRpb25zLmRhdGFbY2VsbFsxXV1bY2VsbFswXV07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZS5zdWJzdHIoMCwgMSkgPT0gJz0nKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWNvcmRzLnB1c2gob2JqLnVwZGF0ZUNlbGwoY2VsbFswXSwgY2VsbFsxXSwgdmFsdWUsIHRydWUpKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIE5vIGxvbmdlciBhIGZvcm11bGEsIHJlbW92ZSBmcm9tIHRoZSBjaGFpblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgT2JqZWN0LmtleXMob2JqLmZvcm11bGEpW2ldID0gbnVsbDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBvYmoudXBkYXRlRm9ybXVsYUNoYWluKGNlbGxbMF0sIGNlbGxbMV0sIHJlY29yZHMpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgY2hhaW5Mb29wUHJvdGVjdGlvbiA9IFtdO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogVXBkYXRlIGZvcm11bGFzXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgb2JqLnVwZGF0ZUZvcm11bGFzID0gZnVuY3Rpb24gKHJlZmVyZW5jZXNUb1VwZGF0ZSkge1xyXG4gICAgICAgICAgICAvLyBVcGRhdGUgZm9ybXVsYXNcclxuICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBvYmoub3B0aW9ucy5kYXRhLmxlbmd0aDsgaisrKSB7XHJcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG9iai5vcHRpb25zLmRhdGFbMF0ubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgdmFsdWUgPSAnJyArIG9iai5vcHRpb25zLmRhdGFbal1baV07XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gSXMgZm9ybXVsYVxyXG4gICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZS5zdWJzdHIoMCwgMSkgPT0gJz0nKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFJlcGxhY2UgdG9rZW5zXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBuZXdGb3JtdWxhID0gb2JqLnVwZGF0ZUZvcm11bGEodmFsdWUsIHJlZmVyZW5jZXNUb1VwZGF0ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChuZXdGb3JtdWxhICE9IHZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmoub3B0aW9ucy5kYXRhW2pdW2ldID0gbmV3Rm9ybXVsYTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gVXBkYXRlIGZvcm11bGEgY2hhaW5cclxuICAgICAgICAgICAgdmFyIGZvcm11bGEgPSBbXTtcclxuICAgICAgICAgICAgdmFyIGtleXMgPSBPYmplY3Qua2V5cyhvYmouZm9ybXVsYSk7XHJcbiAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwga2V5cy5sZW5ndGg7IGorKykge1xyXG4gICAgICAgICAgICAgICAgLy8gQ3VycmVudCBrZXkgYW5kIHZhbHVlc1xyXG4gICAgICAgICAgICAgICAgdmFyIGtleSA9IGtleXNbal07XHJcbiAgICAgICAgICAgICAgICB2YXIgdmFsdWUgPSBvYmouZm9ybXVsYVtrZXldO1xyXG4gICAgICAgICAgICAgICAgLy8gVXBkYXRlIGtleVxyXG4gICAgICAgICAgICAgICAgaWYgKHJlZmVyZW5jZXNUb1VwZGF0ZVtrZXldKSB7XHJcbiAgICAgICAgICAgICAgICAgICAga2V5ID0gcmVmZXJlbmNlc1RvVXBkYXRlW2tleV07XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAvLyBVcGRhdGUgdmFsdWVzXHJcbiAgICAgICAgICAgICAgICBmb3JtdWxhW2tleV0gPSBbXTtcclxuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdmFsdWUubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgbGV0dGVyID0gdmFsdWVbaV07XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlZmVyZW5jZXNUb1VwZGF0ZVtsZXR0ZXJdKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxldHRlciA9IHJlZmVyZW5jZXNUb1VwZGF0ZVtsZXR0ZXJdO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBmb3JtdWxhW2tleV0ucHVzaChsZXR0ZXIpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIG9iai5mb3JtdWxhID0gZm9ybXVsYTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIFVwZGF0ZSBmb3JtdWxhXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgb2JqLnVwZGF0ZUZvcm11bGEgPSBmdW5jdGlvbiAoZm9ybXVsYSwgcmVmZXJlbmNlc1RvVXBkYXRlKSB7XHJcbiAgICAgICAgICAgIHZhciB0ZXN0TGV0dGVyID0gL1tBLVpdLztcclxuICAgICAgICAgICAgdmFyIHRlc3ROdW1iZXIgPSAvWzAtOV0vO1xyXG5cclxuICAgICAgICAgICAgdmFyIG5ld0Zvcm11bGEgPSAnJztcclxuICAgICAgICAgICAgdmFyIGxldHRlciA9IG51bGw7XHJcbiAgICAgICAgICAgIHZhciBudW1iZXIgPSBudWxsO1xyXG4gICAgICAgICAgICB2YXIgdG9rZW4gPSAnJztcclxuXHJcbiAgICAgICAgICAgIGZvciAodmFyIGluZGV4ID0gMDsgaW5kZXggPCBmb3JtdWxhLmxlbmd0aDsgaW5kZXgrKykge1xyXG4gICAgICAgICAgICAgICAgaWYgKHRlc3RMZXR0ZXIuZXhlYyhmb3JtdWxhW2luZGV4XSkpIHtcclxuICAgICAgICAgICAgICAgICAgICBsZXR0ZXIgPSAxO1xyXG4gICAgICAgICAgICAgICAgICAgIG51bWJlciA9IDA7XHJcbiAgICAgICAgICAgICAgICAgICAgdG9rZW4gKz0gZm9ybXVsYVtpbmRleF07XHJcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHRlc3ROdW1iZXIuZXhlYyhmb3JtdWxhW2luZGV4XSkpIHtcclxuICAgICAgICAgICAgICAgICAgICBudW1iZXIgPSBsZXR0ZXIgPyAxIDogMDtcclxuICAgICAgICAgICAgICAgICAgICB0b2tlbiArPSBmb3JtdWxhW2luZGV4XTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGxldHRlciAmJiBudW1iZXIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW4gPSByZWZlcmVuY2VzVG9VcGRhdGVbdG9rZW5dID8gcmVmZXJlbmNlc1RvVXBkYXRlW3Rva2VuXSA6IHRva2VuO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBuZXdGb3JtdWxhICs9IHRva2VuO1xyXG4gICAgICAgICAgICAgICAgICAgIG5ld0Zvcm11bGEgKz0gZm9ybXVsYVtpbmRleF07XHJcbiAgICAgICAgICAgICAgICAgICAgbGV0dGVyID0gMDtcclxuICAgICAgICAgICAgICAgICAgICBudW1iZXIgPSAwO1xyXG4gICAgICAgICAgICAgICAgICAgIHRva2VuID0gJyc7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmICh0b2tlbikge1xyXG4gICAgICAgICAgICAgICAgaWYgKGxldHRlciAmJiBudW1iZXIpIHtcclxuICAgICAgICAgICAgICAgICAgICB0b2tlbiA9IHJlZmVyZW5jZXNUb1VwZGF0ZVt0b2tlbl0gPyByZWZlcmVuY2VzVG9VcGRhdGVbdG9rZW5dIDogdG9rZW47XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBuZXdGb3JtdWxhICs9IHRva2VuO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gbmV3Rm9ybXVsYTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIFNlY3VyZSBmb3JtdWxhXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgdmFyIHNlY3VyZUZvcm11bGEgPSBmdW5jdGlvbiAob2xkVmFsdWUpIHtcclxuICAgICAgICAgICAgdmFyIG5ld1ZhbHVlID0gJyc7XHJcbiAgICAgICAgICAgIHZhciBpbnNpZGUgPSAwO1xyXG5cclxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBvbGRWYWx1ZS5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgaWYgKG9sZFZhbHVlW2ldID09ICdcIicpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoaW5zaWRlID09IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaW5zaWRlID0gMTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpbnNpZGUgPSAwO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoaW5zaWRlID09IDEpIHtcclxuICAgICAgICAgICAgICAgICAgICBuZXdWYWx1ZSArPSBvbGRWYWx1ZVtpXTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbmV3VmFsdWUgKz0gb2xkVmFsdWVbaV0udG9VcHBlckNhc2UoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgcmV0dXJuIG5ld1ZhbHVlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogUGFyc2UgZm9ybXVsYXNcclxuICAgICAgICAgKi9cclxuICAgICAgICBvYmouZXhlY3V0ZUZvcm11bGEgPSBmdW5jdGlvbiAoZXhwcmVzc2lvbiwgeCwgeSkge1xyXG5cclxuICAgICAgICAgICAgdmFyIGZvcm11bGFSZXN1bHRzID0gW107XHJcbiAgICAgICAgICAgIHZhciBmb3JtdWxhTG9vcFByb3RlY3Rpb24gPSBbXTtcclxuXHJcbiAgICAgICAgICAgIC8vIEV4ZWN1dGUgZm9ybXVsYSB3aXRoIGxvb3AgcHJvdGVjdGlvblxyXG4gICAgICAgICAgICB2YXIgZXhlY3V0ZSA9IGZ1bmN0aW9uIChleHByZXNzaW9uLCB4LCB5KSB7XHJcbiAgICAgICAgICAgICAgICAvLyBQYXJlbnQgY29sdW1uIGlkZW50aWZpY2F0aW9uXHJcbiAgICAgICAgICAgICAgICB2YXIgcGFyZW50SWQgPSBqZXhjZWwuZ2V0Q29sdW1uTmFtZUZyb21JZChbeCwgeV0pO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIENvZGUgcHJvdGVjdGlvblxyXG4gICAgICAgICAgICAgICAgaWYgKGZvcm11bGFMb29wUHJvdGVjdGlvbltwYXJlbnRJZF0pIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCdSZWZlcmVuY2UgbG9vcCBkZXRlY3RlZCcpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAnI0VSUk9SJztcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBmb3JtdWxhTG9vcFByb3RlY3Rpb25bcGFyZW50SWRdID0gdHJ1ZTtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyBDb252ZXJ0IHJhbmdlIHRva2Vuc1xyXG4gICAgICAgICAgICAgICAgdmFyIHRva2Vuc1VwZGF0ZSA9IGZ1bmN0aW9uICh0b2tlbnMpIHtcclxuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpbmRleCA9IDA7IGluZGV4IDwgdG9rZW5zLmxlbmd0aDsgaW5kZXgrKykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgZiA9IFtdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgdG9rZW4gPSB0b2tlbnNbaW5kZXhdLnNwbGl0KCc6Jyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBlMSA9IGpleGNlbC5nZXRJZEZyb21Db2x1bW5OYW1lKHRva2VuWzBdLCB0cnVlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGUyID0gamV4Y2VsLmdldElkRnJvbUNvbHVtbk5hbWUodG9rZW5bMV0sIHRydWUpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGUxWzBdIDw9IGUyWzBdKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgeDEgPSBlMVswXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB4MiA9IGUyWzBdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHgxID0gZTJbMF07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgeDIgPSBlMVswXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGUxWzFdIDw9IGUyWzFdKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgeTEgPSBlMVsxXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB5MiA9IGUyWzFdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHkxID0gZTJbMV07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgeTIgPSBlMVsxXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaiA9IHkxOyBqIDw9IHkyOyBqKyspIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSB4MTsgaSA8PSB4MjsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZi5wdXNoKGpleGNlbC5nZXRDb2x1bW5OYW1lRnJvbUlkKFtpLCBqXSkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBleHByZXNzaW9uID0gZXhwcmVzc2lvbi5yZXBsYWNlKHRva2Vuc1tpbmRleF0sIGYuam9pbignLCcpKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gUmFuZ2Ugd2l0aCAkIHJlbW92ZSAkXHJcbiAgICAgICAgICAgICAgICBleHByZXNzaW9uID0gZXhwcmVzc2lvbi5yZXBsYWNlKC9cXCQ/KFtBLVpdKylcXCQ/KFswLTldKykvZywgXCIkMSQyXCIpO1xyXG5cclxuICAgICAgICAgICAgICAgIHZhciB0b2tlbnMgPSBleHByZXNzaW9uLm1hdGNoKC8oW0EtWl0rWzAtOV0rKVxcOihbQS1aXStbMC05XSspL2cpO1xyXG4gICAgICAgICAgICAgICAgaWYgKHRva2VucyAmJiB0b2tlbnMubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdG9rZW5zVXBkYXRlKHRva2Vucyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gU3RyaW5nXHJcbiAgICAgICAgICAgICAgICB2YXIgZXZhbHN0cmluZyA9ICcnO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIEdldCB0b2tlbnNcclxuICAgICAgICAgICAgICAgIHZhciB0b2tlbnMgPSBleHByZXNzaW9uLm1hdGNoKC8oW0EtWl0rWzAtOV0rKS9nKTtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyBEaXJlY3Qgc2VsZi1yZWZlcmVuY2UgcHJvdGVjdGlvblxyXG4gICAgICAgICAgICAgICAgaWYgKHRva2VucyAmJiB0b2tlbnMuaW5kZXhPZihwYXJlbnRJZCkgPiAtMSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ1NlbGYgUmVmZXJlbmNlIGRldGVjdGVkJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICcjRVJST1InO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodG9rZW5zKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdG9rZW5zLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBLZWVwIGNoYWluXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIW9iai5mb3JtdWxhW3Rva2Vuc1tpXV0pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmouZm9ybXVsYVt0b2tlbnNbaV1dID0gW107XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBJcyBhbHJlYWR5IGluIHRoZSByZWdpc3RlclxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG9iai5mb3JtdWxhW3Rva2Vuc1tpXV0uaW5kZXhPZihwYXJlbnRJZCkgPCAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb2JqLmZvcm11bGFbdG9rZW5zW2ldXS5wdXNoKHBhcmVudElkKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBEbyBub3QgY2FsY3VsYXRlIGFnYWluXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZXZhbCgndHlwZW9mKCcgKyB0b2tlbnNbaV0gKyAnKSA9PSBcInVuZGVmaW5lZFwiJykpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBDb29yZHNcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgcG9zaXRpb24gPSBqZXhjZWwuZ2V0SWRGcm9tQ29sdW1uTmFtZSh0b2tlbnNbaV0sIDEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIEdldCB2YWx1ZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgKG9iai5vcHRpb25zLmRhdGFbcG9zaXRpb25bMV1dKSAhPSAndW5kZWZpbmVkJyAmJiB0eXBlb2YgKG9iai5vcHRpb25zLmRhdGFbcG9zaXRpb25bMV1dW3Bvc2l0aW9uWzBdXSkgIT0gJ3VuZGVmaW5lZCcpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHZhbHVlID0gb2JqLm9wdGlvbnMuZGF0YVtwb3NpdGlvblsxXV1bcG9zaXRpb25bMF1dO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB2YWx1ZSA9ICcnO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBHZXQgY29sdW1uIGRhdGFcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoKCcnICsgdmFsdWUpLnN1YnN0cigwLCAxKSA9PSAnPScpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGZvcm11bGFSZXN1bHRzW3Rva2Vuc1tpXV0pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlID0gZm9ybXVsYVJlc3VsdHNbdG9rZW5zW2ldXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlID0gZXhlY3V0ZSh2YWx1ZSwgcG9zaXRpb25bMF0sIHBvc2l0aW9uWzFdKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcm11bGFSZXN1bHRzW3Rva2Vuc1tpXV0gPSB2YWx1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBUeXBlIVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgoJycgKyB2YWx1ZSkudHJpbSgpID09ICcnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIE51bGxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXZhbHN0cmluZyArPSBcInZhciBcIiArIHRva2Vuc1tpXSArIFwiID0gbnVsbDtcIjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodmFsdWUgPT0gTnVtYmVyKHZhbHVlKSAmJiBvYmoub3B0aW9ucy5hdXRvQ2FzdGluZyA9PSB0cnVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBOdW1iZXJcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV2YWxzdHJpbmcgKz0gXCJ2YXIgXCIgKyB0b2tlbnNbaV0gKyBcIiA9IFwiICsgTnVtYmVyKHZhbHVlKSArIFwiO1wiO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gVHJ5aW5nIGFueSBmb3JtYXR0ZWQgbnVtYmVyXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgbnVtYmVyID0gb2JqLnBhcnNlTnVtYmVyKHZhbHVlLCBwb3NpdGlvblswXSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChvYmoub3B0aW9ucy5hdXRvQ2FzdGluZyA9PSB0cnVlICYmIG51bWJlcikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFJlbmRlciBhcyBudW1iZXJcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBldmFsc3RyaW5nICs9IFwidmFyIFwiICsgdG9rZW5zW2ldICsgXCIgPSBcIiArIG51bWJlciArIFwiO1wiO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBSZW5kZXIgYXMgc3RyaW5nXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXZhbHN0cmluZyArPSBcInZhciBcIiArIHRva2Vuc1tpXSArIFwiID0gJ1wiICsgdmFsdWUgKyBcIic7XCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIC8vIENvbnZlcnQgZm9ybXVsYSB0byBqYXZhc2NyaXB0XHJcbiAgICAgICAgICAgICAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZXZhbHN0cmluZyArPSBcImZ1bmN0aW9uIENPTFVNTigpIHsgcmV0dXJuIHBhcnNlSW50KHgpICsgMTsgfTsgZnVuY3Rpb24gUk9XKCkgeyByZXR1cm4gcGFyc2VJbnQoeSkgKyAxOyB9OyBmdW5jdGlvbiBDRUxMKCkgeyByZXR1cm4gcGFyZW50SWQ7IH07IGZ1bmN0aW9uIFRBQkxFKCkgeyByZXR1cm4gb2JqOyB9OyBmdW5jdGlvbiBWQUxVRShjb2wsIHJvdykgeyByZXR1cm4gb2JqLnJlY29yZHNbcm93LTFdW2NvbC0xXS5pbm5lckhUTUw7IH07IGZ1bmN0aW9uIFRISVNST1dDRUxMKGNvbCkgeyB2YXIgaWQgPSBqZXhjZWwuZ2V0SWRGcm9tQ29sdW1uTmFtZShjb2wrKHBhcnNlSW50KHkpKzEpLCB0cnVlKTsgcmV0dXJuIG9iai5yZWNvcmRzW2lkWzFdXVtpZFswXV0uaW5uZXJIVE1MOyB9XCI7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgcmVzID0gZXZhbChldmFsc3RyaW5nICsgZXhwcmVzc2lvbi5zdWJzdHIoMSkpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHJlcyA9ICcjRVJST1InO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlcztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgcmV0dXJuIGV4ZWN1dGUoZXhwcmVzc2lvbiwgeCwgeSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvKipcclxuICAgICAgICAgKiBUcnlpbmcgdG8gZXh0cmFjdCBhIG51bWJlciBmcm9tIGEgc3RyaW5nXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgb2JqLnBhcnNlTnVtYmVyID0gZnVuY3Rpb24gKHZhbHVlLCBjb2x1bW5OdW1iZXIpIHtcclxuICAgICAgICAgICAgLy8gRGVjaW1hbCBwb2ludFxyXG4gICAgICAgICAgICB2YXIgZGVjaW1hbCA9IGNvbHVtbk51bWJlciAmJiBvYmoub3B0aW9ucy5jb2x1bW5zW2NvbHVtbk51bWJlcl0uZGVjaW1hbCA/IG9iai5vcHRpb25zLmNvbHVtbnNbY29sdW1uTnVtYmVyXS5kZWNpbWFsIDogJy4nO1xyXG5cclxuICAgICAgICAgICAgLy8gUGFyc2UgYm90aCBwYXJ0cyBvZiB0aGUgbnVtYmVyXHJcbiAgICAgICAgICAgIHZhciBudW1iZXIgPSAoJycgKyB2YWx1ZSk7XHJcbiAgICAgICAgICAgIG51bWJlciA9IG51bWJlci5zcGxpdChkZWNpbWFsKTtcclxuICAgICAgICAgICAgbnVtYmVyWzBdID0gbnVtYmVyWzBdLm1hdGNoKC9bKy1dP1swLTldL2cpO1xyXG4gICAgICAgICAgICBpZiAobnVtYmVyWzBdKSB7XHJcbiAgICAgICAgICAgICAgICBudW1iZXJbMF0gPSBudW1iZXJbMF0uam9pbignJyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKG51bWJlclsxXSkge1xyXG4gICAgICAgICAgICAgICAgbnVtYmVyWzFdID0gbnVtYmVyWzFdLm1hdGNoKC9bMC05XSovZykuam9pbignJyk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIElzIGEgdmFsaWQgbnVtYmVyXHJcbiAgICAgICAgICAgIGlmIChudW1iZXJbMF0gJiYgTnVtYmVyKG51bWJlclswXSkgPj0gMCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKCFudW1iZXJbMV0pIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgdmFsdWUgPSBOdW1iZXIobnVtYmVyWzBdICsgJy4wMCcpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgdmFsdWUgPSBOdW1iZXIobnVtYmVyWzBdICsgJy4nICsgbnVtYmVyWzFdKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHZhciB2YWx1ZSA9IG51bGw7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHJldHVybiB2YWx1ZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIEdldCByb3cgbnVtYmVyXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgb2JqLnJvdyA9IGZ1bmN0aW9uIChjZWxsKSB7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvKipcclxuICAgICAgICAgKiBHZXQgY29sIG51bWJlclxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIG9iai5jb2wgPSBmdW5jdGlvbiAoY2VsbCkge1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgb2JqLnVwID0gZnVuY3Rpb24gKHNoaWZ0S2V5LCBjdHJsS2V5KSB7XHJcbiAgICAgICAgICAgIGlmIChzaGlmdEtleSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKG9iai5zZWxlY3RlZENlbGxbM10gPiAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgb2JqLnVwLnZpc2libGUoMSwgY3RybEtleSA/IDAgOiAxKVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgaWYgKG9iai5zZWxlY3RlZENlbGxbMV0gPiAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgb2JqLnVwLnZpc2libGUoMCwgY3RybEtleSA/IDAgOiAxKVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgb2JqLnNlbGVjdGVkQ2VsbFsyXSA9IG9iai5zZWxlY3RlZENlbGxbMF07XHJcbiAgICAgICAgICAgICAgICBvYmouc2VsZWN0ZWRDZWxsWzNdID0gb2JqLnNlbGVjdGVkQ2VsbFsxXTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gVXBkYXRlIHNlbGVjdGlvblxyXG4gICAgICAgICAgICBvYmoudXBkYXRlU2VsZWN0aW9uRnJvbUNvb3JkcyhvYmouc2VsZWN0ZWRDZWxsWzBdLCBvYmouc2VsZWN0ZWRDZWxsWzFdLCBvYmouc2VsZWN0ZWRDZWxsWzJdLCBvYmouc2VsZWN0ZWRDZWxsWzNdKTtcclxuXHJcbiAgICAgICAgICAgIC8vIENoYW5nZSBwYWdlXHJcbiAgICAgICAgICAgIGlmIChvYmoub3B0aW9ucy5sYXp5TG9hZGluZyA9PSB0cnVlKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAob2JqLnNlbGVjdGVkQ2VsbFsxXSA9PSAwIHx8IG9iai5zZWxlY3RlZENlbGxbM10gPT0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgIG9iai5sb2FkUGFnZSgwKTtcclxuICAgICAgICAgICAgICAgICAgICBvYmoudXBkYXRlU2VsZWN0aW9uRnJvbUNvb3JkcyhvYmouc2VsZWN0ZWRDZWxsWzBdLCBvYmouc2VsZWN0ZWRDZWxsWzFdLCBvYmouc2VsZWN0ZWRDZWxsWzJdLCBvYmouc2VsZWN0ZWRDZWxsWzNdKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKG9iai5sb2FkVmFsaWRhdGlvbigpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9iai51cGRhdGVTZWxlY3Rpb25Gcm9tQ29vcmRzKG9iai5zZWxlY3RlZENlbGxbMF0sIG9iai5zZWxlY3RlZENlbGxbMV0sIG9iai5zZWxlY3RlZENlbGxbMl0sIG9iai5zZWxlY3RlZENlbGxbM10pO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpdGVtID0gcGFyc2VJbnQob2JqLnRib2R5LmZpcnN0Q2hpbGQuZ2V0QXR0cmlidXRlKCdkYXRhLXknKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChvYmouc2VsZWN0ZWRDZWxsWzFdIC0gaXRlbSA8IDMwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmoubG9hZFVwKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmoudXBkYXRlU2VsZWN0aW9uRnJvbUNvb3JkcyhvYmouc2VsZWN0ZWRDZWxsWzBdLCBvYmouc2VsZWN0ZWRDZWxsWzFdLCBvYmouc2VsZWN0ZWRDZWxsWzJdLCBvYmouc2VsZWN0ZWRDZWxsWzNdKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSBlbHNlIGlmIChvYmoub3B0aW9ucy5wYWdpbmF0aW9uID4gMCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIHBhZ2VOdW1iZXIgPSBvYmoud2hpY2hQYWdlKG9iai5zZWxlY3RlZENlbGxbM10pO1xyXG4gICAgICAgICAgICAgICAgaWYgKHBhZ2VOdW1iZXIgIT0gb2JqLnBhZ2VOdW1iZXIpIHtcclxuICAgICAgICAgICAgICAgICAgICBvYmoucGFnZShwYWdlTnVtYmVyKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgb2JqLnVwZGF0ZVNjcm9sbCgxKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIG9iai51cC52aXNpYmxlID0gZnVuY3Rpb24gKGdyb3VwLCBkaXJlY3Rpb24pIHtcclxuICAgICAgICAgICAgaWYgKGdyb3VwID09IDApIHtcclxuICAgICAgICAgICAgICAgIHZhciB4ID0gcGFyc2VJbnQob2JqLnNlbGVjdGVkQ2VsbFswXSk7XHJcbiAgICAgICAgICAgICAgICB2YXIgeSA9IHBhcnNlSW50KG9iai5zZWxlY3RlZENlbGxbMV0pO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdmFyIHggPSBwYXJzZUludChvYmouc2VsZWN0ZWRDZWxsWzJdKTtcclxuICAgICAgICAgICAgICAgIHZhciB5ID0gcGFyc2VJbnQob2JqLnNlbGVjdGVkQ2VsbFszXSk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmIChkaXJlY3Rpb24gPT0gMCkge1xyXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCB5OyBqKyspIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAob2JqLnJlY29yZHNbal1beF0uc3R5bGUuZGlzcGxheSAhPSAnbm9uZScgJiYgb2JqLnJvd3Nbal0uc3R5bGUuZGlzcGxheSAhPSAnbm9uZScpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgeSA9IGo7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHkgPSBvYmoudXAuZ2V0KHgsIHkpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAoZ3JvdXAgPT0gMCkge1xyXG4gICAgICAgICAgICAgICAgb2JqLnNlbGVjdGVkQ2VsbFswXSA9IHg7XHJcbiAgICAgICAgICAgICAgICBvYmouc2VsZWN0ZWRDZWxsWzFdID0geTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIG9iai5zZWxlY3RlZENlbGxbMl0gPSB4O1xyXG4gICAgICAgICAgICAgICAgb2JqLnNlbGVjdGVkQ2VsbFszXSA9IHk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIG9iai51cC5nZXQgPSBmdW5jdGlvbiAoeCwgeSkge1xyXG4gICAgICAgICAgICB2YXIgeCA9IHBhcnNlSW50KHgpO1xyXG4gICAgICAgICAgICB2YXIgeSA9IHBhcnNlSW50KHkpO1xyXG4gICAgICAgICAgICBmb3IgKHZhciBqID0gKHkgLSAxKTsgaiA+PSAwOyBqLS0pIHtcclxuICAgICAgICAgICAgICAgIGlmIChvYmoucmVjb3Jkc1tqXVt4XS5zdHlsZS5kaXNwbGF5ICE9ICdub25lJyAmJiBvYmoucm93c1tqXS5zdHlsZS5kaXNwbGF5ICE9ICdub25lJykge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChvYmoucmVjb3Jkc1tqXVt4XS5nZXRBdHRyaWJ1dGUoJ2RhdGEtbWVyZ2VkJykpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG9iai5yZWNvcmRzW2pdW3hdID09IG9iai5yZWNvcmRzW3ldW3hdKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB5ID0gajtcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgcmV0dXJuIHk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBvYmouZG93biA9IGZ1bmN0aW9uIChzaGlmdEtleSwgY3RybEtleSkge1xyXG4gICAgICAgICAgICBpZiAoc2hpZnRLZXkpIHtcclxuICAgICAgICAgICAgICAgIGlmIChvYmouc2VsZWN0ZWRDZWxsWzNdIDwgb2JqLnJlY29yZHMubGVuZ3RoIC0gMSkge1xyXG4gICAgICAgICAgICAgICAgICAgIG9iai5kb3duLnZpc2libGUoMSwgY3RybEtleSA/IDAgOiAxKVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgaWYgKG9iai5zZWxlY3RlZENlbGxbMV0gPCBvYmoucmVjb3Jkcy5sZW5ndGggLSAxKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgb2JqLmRvd24udmlzaWJsZSgwLCBjdHJsS2V5ID8gMCA6IDEpXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBvYmouc2VsZWN0ZWRDZWxsWzJdID0gb2JqLnNlbGVjdGVkQ2VsbFswXTtcclxuICAgICAgICAgICAgICAgIG9iai5zZWxlY3RlZENlbGxbM10gPSBvYmouc2VsZWN0ZWRDZWxsWzFdO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBvYmoudXBkYXRlU2VsZWN0aW9uRnJvbUNvb3JkcyhvYmouc2VsZWN0ZWRDZWxsWzBdLCBvYmouc2VsZWN0ZWRDZWxsWzFdLCBvYmouc2VsZWN0ZWRDZWxsWzJdLCBvYmouc2VsZWN0ZWRDZWxsWzNdKTtcclxuXHJcbiAgICAgICAgICAgIC8vIENoYW5nZSBwYWdlXHJcbiAgICAgICAgICAgIGlmIChvYmoub3B0aW9ucy5sYXp5TG9hZGluZyA9PSB0cnVlKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoKG9iai5zZWxlY3RlZENlbGxbMV0gPT0gb2JqLnJlY29yZHMubGVuZ3RoIC0gMSB8fCBvYmouc2VsZWN0ZWRDZWxsWzNdID09IG9iai5yZWNvcmRzLmxlbmd0aCAtIDEpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgb2JqLmxvYWRQYWdlKC0xKTtcclxuICAgICAgICAgICAgICAgICAgICBvYmoudXBkYXRlU2VsZWN0aW9uRnJvbUNvb3JkcyhvYmouc2VsZWN0ZWRDZWxsWzBdLCBvYmouc2VsZWN0ZWRDZWxsWzFdLCBvYmouc2VsZWN0ZWRDZWxsWzJdLCBvYmouc2VsZWN0ZWRDZWxsWzNdKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKG9iai5sb2FkVmFsaWRhdGlvbigpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9iai51cGRhdGVTZWxlY3Rpb25Gcm9tQ29vcmRzKG9iai5zZWxlY3RlZENlbGxbMF0sIG9iai5zZWxlY3RlZENlbGxbMV0sIG9iai5zZWxlY3RlZENlbGxbMl0sIG9iai5zZWxlY3RlZENlbGxbM10pO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpdGVtID0gcGFyc2VJbnQob2JqLnRib2R5Lmxhc3RDaGlsZC5nZXRBdHRyaWJ1dGUoJ2RhdGEteScpKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGl0ZW0gLSBvYmouc2VsZWN0ZWRDZWxsWzNdIDwgMzApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9iai5sb2FkRG93bigpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb2JqLnVwZGF0ZVNlbGVjdGlvbkZyb21Db29yZHMob2JqLnNlbGVjdGVkQ2VsbFswXSwgb2JqLnNlbGVjdGVkQ2VsbFsxXSwgb2JqLnNlbGVjdGVkQ2VsbFsyXSwgb2JqLnNlbGVjdGVkQ2VsbFszXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAob2JqLm9wdGlvbnMucGFnaW5hdGlvbiA+IDApIHtcclxuICAgICAgICAgICAgICAgIHZhciBwYWdlTnVtYmVyID0gb2JqLndoaWNoUGFnZShvYmouc2VsZWN0ZWRDZWxsWzNdKTtcclxuICAgICAgICAgICAgICAgIGlmIChwYWdlTnVtYmVyICE9IG9iai5wYWdlTnVtYmVyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgb2JqLnBhZ2UocGFnZU51bWJlcik7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIG9iai51cGRhdGVTY3JvbGwoMyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBvYmouZG93bi52aXNpYmxlID0gZnVuY3Rpb24gKGdyb3VwLCBkaXJlY3Rpb24pIHtcclxuICAgICAgICAgICAgaWYgKGdyb3VwID09IDApIHtcclxuICAgICAgICAgICAgICAgIHZhciB4ID0gcGFyc2VJbnQob2JqLnNlbGVjdGVkQ2VsbFswXSk7XHJcbiAgICAgICAgICAgICAgICB2YXIgeSA9IHBhcnNlSW50KG9iai5zZWxlY3RlZENlbGxbMV0pO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdmFyIHggPSBwYXJzZUludChvYmouc2VsZWN0ZWRDZWxsWzJdKTtcclxuICAgICAgICAgICAgICAgIHZhciB5ID0gcGFyc2VJbnQob2JqLnNlbGVjdGVkQ2VsbFszXSk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmIChkaXJlY3Rpb24gPT0gMCkge1xyXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaiA9IG9iai5yb3dzLmxlbmd0aCAtIDE7IGogPiB5OyBqLS0pIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAob2JqLnJlY29yZHNbal1beF0uc3R5bGUuZGlzcGxheSAhPSAnbm9uZScgJiYgb2JqLnJvd3Nbal0uc3R5bGUuZGlzcGxheSAhPSAnbm9uZScpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgeSA9IGo7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHkgPSBvYmouZG93bi5nZXQoeCwgeSk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmIChncm91cCA9PSAwKSB7XHJcbiAgICAgICAgICAgICAgICBvYmouc2VsZWN0ZWRDZWxsWzBdID0geDtcclxuICAgICAgICAgICAgICAgIG9iai5zZWxlY3RlZENlbGxbMV0gPSB5O1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgb2JqLnNlbGVjdGVkQ2VsbFsyXSA9IHg7XHJcbiAgICAgICAgICAgICAgICBvYmouc2VsZWN0ZWRDZWxsWzNdID0geTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgb2JqLmRvd24uZ2V0ID0gZnVuY3Rpb24gKHgsIHkpIHtcclxuICAgICAgICAgICAgdmFyIHggPSBwYXJzZUludCh4KTtcclxuICAgICAgICAgICAgdmFyIHkgPSBwYXJzZUludCh5KTtcclxuICAgICAgICAgICAgZm9yICh2YXIgaiA9ICh5ICsgMSk7IGogPCBvYmoucm93cy5sZW5ndGg7IGorKykge1xyXG4gICAgICAgICAgICAgICAgaWYgKG9iai5yZWNvcmRzW2pdW3hdLnN0eWxlLmRpc3BsYXkgIT0gJ25vbmUnICYmIG9iai5yb3dzW2pdLnN0eWxlLmRpc3BsYXkgIT0gJ25vbmUnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKG9iai5yZWNvcmRzW2pdW3hdLmdldEF0dHJpYnV0ZSgnZGF0YS1tZXJnZWQnKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAob2JqLnJlY29yZHNbal1beF0gPT0gb2JqLnJlY29yZHNbeV1beF0pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIHkgPSBqO1xyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICByZXR1cm4geTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIG9iai5yaWdodCA9IGZ1bmN0aW9uIChzaGlmdEtleSwgY3RybEtleSkge1xyXG4gICAgICAgICAgICBpZiAoc2hpZnRLZXkpIHtcclxuICAgICAgICAgICAgICAgIGlmIChvYmouc2VsZWN0ZWRDZWxsWzJdIDwgb2JqLmhlYWRlcnMubGVuZ3RoIC0gMSkge1xyXG4gICAgICAgICAgICAgICAgICAgIG9iai5yaWdodC52aXNpYmxlKDEsIGN0cmxLZXkgPyAwIDogMSlcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGlmIChvYmouc2VsZWN0ZWRDZWxsWzBdIDwgb2JqLmhlYWRlcnMubGVuZ3RoIC0gMSkge1xyXG4gICAgICAgICAgICAgICAgICAgIG9iai5yaWdodC52aXNpYmxlKDAsIGN0cmxLZXkgPyAwIDogMSlcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIG9iai5zZWxlY3RlZENlbGxbMl0gPSBvYmouc2VsZWN0ZWRDZWxsWzBdO1xyXG4gICAgICAgICAgICAgICAgb2JqLnNlbGVjdGVkQ2VsbFszXSA9IG9iai5zZWxlY3RlZENlbGxbMV07XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIG9iai51cGRhdGVTZWxlY3Rpb25Gcm9tQ29vcmRzKG9iai5zZWxlY3RlZENlbGxbMF0sIG9iai5zZWxlY3RlZENlbGxbMV0sIG9iai5zZWxlY3RlZENlbGxbMl0sIG9iai5zZWxlY3RlZENlbGxbM10pO1xyXG4gICAgICAgICAgICBvYmoudXBkYXRlU2Nyb2xsKDIpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgb2JqLnJpZ2h0LnZpc2libGUgPSBmdW5jdGlvbiAoZ3JvdXAsIGRpcmVjdGlvbikge1xyXG4gICAgICAgICAgICBpZiAoZ3JvdXAgPT0gMCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIHggPSBwYXJzZUludChvYmouc2VsZWN0ZWRDZWxsWzBdKTtcclxuICAgICAgICAgICAgICAgIHZhciB5ID0gcGFyc2VJbnQob2JqLnNlbGVjdGVkQ2VsbFsxXSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgeCA9IHBhcnNlSW50KG9iai5zZWxlY3RlZENlbGxbMl0pO1xyXG4gICAgICAgICAgICAgICAgdmFyIHkgPSBwYXJzZUludChvYmouc2VsZWN0ZWRDZWxsWzNdKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKGRpcmVjdGlvbiA9PSAwKSB7XHJcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gb2JqLmhlYWRlcnMubGVuZ3RoIC0gMTsgaSA+IHg7IGktLSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChvYmoucmVjb3Jkc1t5XVtpXS5zdHlsZS5kaXNwbGF5ICE9ICdub25lJykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB4ID0gaTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgeCA9IG9iai5yaWdodC5nZXQoeCwgeSk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmIChncm91cCA9PSAwKSB7XHJcbiAgICAgICAgICAgICAgICBvYmouc2VsZWN0ZWRDZWxsWzBdID0geDtcclxuICAgICAgICAgICAgICAgIG9iai5zZWxlY3RlZENlbGxbMV0gPSB5O1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgb2JqLnNlbGVjdGVkQ2VsbFsyXSA9IHg7XHJcbiAgICAgICAgICAgICAgICBvYmouc2VsZWN0ZWRDZWxsWzNdID0geTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgb2JqLnJpZ2h0LmdldCA9IGZ1bmN0aW9uICh4LCB5KSB7XHJcbiAgICAgICAgICAgIHZhciB4ID0gcGFyc2VJbnQoeCk7XHJcbiAgICAgICAgICAgIHZhciB5ID0gcGFyc2VJbnQoeSk7XHJcblxyXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gKHggKyAxKTsgaSA8IG9iai5oZWFkZXJzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAob2JqLnJlY29yZHNbeV1baV0uc3R5bGUuZGlzcGxheSAhPSAnbm9uZScpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAob2JqLnJlY29yZHNbeV1baV0uZ2V0QXR0cmlidXRlKCdkYXRhLW1lcmdlZCcpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChvYmoucmVjb3Jkc1t5XVtpXSA9PSBvYmoucmVjb3Jkc1t5XVt4XSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgeCA9IGk7XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHJldHVybiB4O1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgb2JqLmxlZnQgPSBmdW5jdGlvbiAoc2hpZnRLZXksIGN0cmxLZXkpIHtcclxuICAgICAgICAgICAgaWYgKHNoaWZ0S2V5KSB7XHJcbiAgICAgICAgICAgICAgICBpZiAob2JqLnNlbGVjdGVkQ2VsbFsyXSA+IDApIHtcclxuICAgICAgICAgICAgICAgICAgICBvYmoubGVmdC52aXNpYmxlKDEsIGN0cmxLZXkgPyAwIDogMSlcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGlmIChvYmouc2VsZWN0ZWRDZWxsWzBdID4gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgIG9iai5sZWZ0LnZpc2libGUoMCwgY3RybEtleSA/IDAgOiAxKVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgb2JqLnNlbGVjdGVkQ2VsbFsyXSA9IG9iai5zZWxlY3RlZENlbGxbMF07XHJcbiAgICAgICAgICAgICAgICBvYmouc2VsZWN0ZWRDZWxsWzNdID0gb2JqLnNlbGVjdGVkQ2VsbFsxXTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgb2JqLnVwZGF0ZVNlbGVjdGlvbkZyb21Db29yZHMob2JqLnNlbGVjdGVkQ2VsbFswXSwgb2JqLnNlbGVjdGVkQ2VsbFsxXSwgb2JqLnNlbGVjdGVkQ2VsbFsyXSwgb2JqLnNlbGVjdGVkQ2VsbFszXSk7XHJcbiAgICAgICAgICAgIG9iai51cGRhdGVTY3JvbGwoMCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBvYmoubGVmdC52aXNpYmxlID0gZnVuY3Rpb24gKGdyb3VwLCBkaXJlY3Rpb24pIHtcclxuICAgICAgICAgICAgaWYgKGdyb3VwID09IDApIHtcclxuICAgICAgICAgICAgICAgIHZhciB4ID0gcGFyc2VJbnQob2JqLnNlbGVjdGVkQ2VsbFswXSk7XHJcbiAgICAgICAgICAgICAgICB2YXIgeSA9IHBhcnNlSW50KG9iai5zZWxlY3RlZENlbGxbMV0pO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdmFyIHggPSBwYXJzZUludChvYmouc2VsZWN0ZWRDZWxsWzJdKTtcclxuICAgICAgICAgICAgICAgIHZhciB5ID0gcGFyc2VJbnQob2JqLnNlbGVjdGVkQ2VsbFszXSk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmIChkaXJlY3Rpb24gPT0gMCkge1xyXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB4OyBpKyspIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAob2JqLnJlY29yZHNbeV1baV0uc3R5bGUuZGlzcGxheSAhPSAnbm9uZScpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgeCA9IGk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHggPSBvYmoubGVmdC5nZXQoeCwgeSk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmIChncm91cCA9PSAwKSB7XHJcbiAgICAgICAgICAgICAgICBvYmouc2VsZWN0ZWRDZWxsWzBdID0geDtcclxuICAgICAgICAgICAgICAgIG9iai5zZWxlY3RlZENlbGxbMV0gPSB5O1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgb2JqLnNlbGVjdGVkQ2VsbFsyXSA9IHg7XHJcbiAgICAgICAgICAgICAgICBvYmouc2VsZWN0ZWRDZWxsWzNdID0geTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgb2JqLmxlZnQuZ2V0ID0gZnVuY3Rpb24gKHgsIHkpIHtcclxuICAgICAgICAgICAgdmFyIHggPSBwYXJzZUludCh4KTtcclxuICAgICAgICAgICAgdmFyIHkgPSBwYXJzZUludCh5KTtcclxuICAgICAgICAgICAgZm9yICh2YXIgaSA9ICh4IC0gMSk7IGkgPj0gMDsgaS0tKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAob2JqLnJlY29yZHNbeV1baV0uc3R5bGUuZGlzcGxheSAhPSAnbm9uZScpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAob2JqLnJlY29yZHNbeV1baV0uZ2V0QXR0cmlidXRlKCdkYXRhLW1lcmdlZCcpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChvYmoucmVjb3Jkc1t5XVtpXSA9PSBvYmoucmVjb3Jkc1t5XVt4XSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgeCA9IGk7XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHJldHVybiB4O1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgb2JqLmZpcnN0ID0gZnVuY3Rpb24gKHNoaWZ0S2V5LCBjdHJsS2V5KSB7XHJcbiAgICAgICAgICAgIGlmIChzaGlmdEtleSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKGN0cmxLZXkpIHtcclxuICAgICAgICAgICAgICAgICAgICBvYmouc2VsZWN0ZWRDZWxsWzNdID0gMDtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgb2JqLmxlZnQudmlzaWJsZSgxLCAwKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGlmIChjdHJsS2V5KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgb2JqLnNlbGVjdGVkQ2VsbFsxXSA9IDA7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIG9iai5sZWZ0LnZpc2libGUoMCwgMCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBvYmouc2VsZWN0ZWRDZWxsWzJdID0gb2JqLnNlbGVjdGVkQ2VsbFswXTtcclxuICAgICAgICAgICAgICAgIG9iai5zZWxlY3RlZENlbGxbM10gPSBvYmouc2VsZWN0ZWRDZWxsWzFdO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBDaGFuZ2UgcGFnZVxyXG4gICAgICAgICAgICBpZiAob2JqLm9wdGlvbnMubGF6eUxvYWRpbmcgPT0gdHJ1ZSAmJiAob2JqLnNlbGVjdGVkQ2VsbFsxXSA9PSAwIHx8IG9iai5zZWxlY3RlZENlbGxbM10gPT0gMCkpIHtcclxuICAgICAgICAgICAgICAgIG9iai5sb2FkUGFnZSgwKTtcclxuICAgICAgICAgICAgfSBlbHNlIGlmIChvYmoub3B0aW9ucy5wYWdpbmF0aW9uID4gMCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIHBhZ2VOdW1iZXIgPSBvYmoud2hpY2hQYWdlKG9iai5zZWxlY3RlZENlbGxbM10pO1xyXG4gICAgICAgICAgICAgICAgaWYgKHBhZ2VOdW1iZXIgIT0gb2JqLnBhZ2VOdW1iZXIpIHtcclxuICAgICAgICAgICAgICAgICAgICBvYmoucGFnZShwYWdlTnVtYmVyKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgb2JqLnVwZGF0ZVNlbGVjdGlvbkZyb21Db29yZHMob2JqLnNlbGVjdGVkQ2VsbFswXSwgb2JqLnNlbGVjdGVkQ2VsbFsxXSwgb2JqLnNlbGVjdGVkQ2VsbFsyXSwgb2JqLnNlbGVjdGVkQ2VsbFszXSk7XHJcbiAgICAgICAgICAgIG9iai51cGRhdGVTY3JvbGwoMSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBvYmoubGFzdCA9IGZ1bmN0aW9uIChzaGlmdEtleSwgY3RybEtleSkge1xyXG4gICAgICAgICAgICBpZiAoc2hpZnRLZXkpIHtcclxuICAgICAgICAgICAgICAgIGlmIChjdHJsS2V5KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgb2JqLnNlbGVjdGVkQ2VsbFszXSA9IG9iai5yZWNvcmRzLmxlbmd0aCAtIDE7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIG9iai5yaWdodC52aXNpYmxlKDEsIDApO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgaWYgKGN0cmxLZXkpIHtcclxuICAgICAgICAgICAgICAgICAgICBvYmouc2VsZWN0ZWRDZWxsWzFdID0gb2JqLnJlY29yZHMubGVuZ3RoIC0gMTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgb2JqLnJpZ2h0LnZpc2libGUoMCwgMCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBvYmouc2VsZWN0ZWRDZWxsWzJdID0gb2JqLnNlbGVjdGVkQ2VsbFswXTtcclxuICAgICAgICAgICAgICAgIG9iai5zZWxlY3RlZENlbGxbM10gPSBvYmouc2VsZWN0ZWRDZWxsWzFdO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBDaGFuZ2UgcGFnZVxyXG4gICAgICAgICAgICBpZiAob2JqLm9wdGlvbnMubGF6eUxvYWRpbmcgPT0gdHJ1ZSAmJiAob2JqLnNlbGVjdGVkQ2VsbFsxXSA9PSBvYmoucmVjb3Jkcy5sZW5ndGggLSAxIHx8IG9iai5zZWxlY3RlZENlbGxbM10gPT0gb2JqLnJlY29yZHMubGVuZ3RoIC0gMSkpIHtcclxuICAgICAgICAgICAgICAgIG9iai5sb2FkUGFnZSgtMSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAob2JqLm9wdGlvbnMucGFnaW5hdGlvbiA+IDApIHtcclxuICAgICAgICAgICAgICAgIHZhciBwYWdlTnVtYmVyID0gb2JqLndoaWNoUGFnZShvYmouc2VsZWN0ZWRDZWxsWzNdKTtcclxuICAgICAgICAgICAgICAgIGlmIChwYWdlTnVtYmVyICE9IG9iai5wYWdlTnVtYmVyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgb2JqLnBhZ2UocGFnZU51bWJlcik7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIG9iai51cGRhdGVTZWxlY3Rpb25Gcm9tQ29vcmRzKG9iai5zZWxlY3RlZENlbGxbMF0sIG9iai5zZWxlY3RlZENlbGxbMV0sIG9iai5zZWxlY3RlZENlbGxbMl0sIG9iai5zZWxlY3RlZENlbGxbM10pO1xyXG4gICAgICAgICAgICBvYmoudXBkYXRlU2Nyb2xsKDMpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgb2JqLnNlbGVjdEFsbCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgaWYgKCFvYmouc2VsZWN0ZWRDZWxsKSB7XHJcbiAgICAgICAgICAgICAgICBvYmouc2VsZWN0ZWRDZWxsID0gW107XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIG9iai5zZWxlY3RlZENlbGxbMF0gPSAwO1xyXG4gICAgICAgICAgICBvYmouc2VsZWN0ZWRDZWxsWzFdID0gMDtcclxuICAgICAgICAgICAgb2JqLnNlbGVjdGVkQ2VsbFsyXSA9IG9iai5oZWFkZXJzLmxlbmd0aCAtIDE7XHJcbiAgICAgICAgICAgIG9iai5zZWxlY3RlZENlbGxbM10gPSBvYmoucmVjb3Jkcy5sZW5ndGggLSAxO1xyXG5cclxuICAgICAgICAgICAgb2JqLnVwZGF0ZVNlbGVjdGlvbkZyb21Db29yZHMob2JqLnNlbGVjdGVkQ2VsbFswXSwgb2JqLnNlbGVjdGVkQ2VsbFsxXSwgb2JqLnNlbGVjdGVkQ2VsbFsyXSwgb2JqLnNlbGVjdGVkQ2VsbFszXSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvKipcclxuICAgICAgICAgKiBHbyB0byBhIHBhZ2UgaW4gYSBsYXp5TG9hZGluZ1xyXG4gICAgICAgICAqL1xyXG4gICAgICAgIG9iai5sb2FkUGFnZSA9IGZ1bmN0aW9uIChwYWdlTnVtYmVyKSB7XHJcbiAgICAgICAgICAgIC8vIFNlYXJjaFxyXG4gICAgICAgICAgICBpZiAob2JqLm9wdGlvbnMuc2VhcmNoID09IHRydWUgJiYgb2JqLnJlc3VsdHMpIHtcclxuICAgICAgICAgICAgICAgIHZhciByZXN1bHRzID0gb2JqLnJlc3VsdHM7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgcmVzdWx0cyA9IG9iai5yb3dzO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBQZXIgcGFnZVxyXG4gICAgICAgICAgICB2YXIgcXVhbnRpdHlQZXJQYWdlID0gMTAwO1xyXG5cclxuICAgICAgICAgICAgLy8gcGFnZU51bWJlclxyXG4gICAgICAgICAgICBpZiAocGFnZU51bWJlciA9PSBudWxsIHx8IHBhZ2VOdW1iZXIgPT0gLTEpIHtcclxuICAgICAgICAgICAgICAgIC8vIExhc3QgcGFnZVxyXG4gICAgICAgICAgICAgICAgcGFnZU51bWJlciA9IE1hdGguY2VpbChyZXN1bHRzLmxlbmd0aCAvIHF1YW50aXR5UGVyUGFnZSkgLSAxO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB2YXIgc3RhcnRSb3cgPSAocGFnZU51bWJlciAqIHF1YW50aXR5UGVyUGFnZSk7XHJcbiAgICAgICAgICAgIHZhciBmaW5hbFJvdyA9IChwYWdlTnVtYmVyICogcXVhbnRpdHlQZXJQYWdlKSArIHF1YW50aXR5UGVyUGFnZTtcclxuICAgICAgICAgICAgaWYgKGZpbmFsUm93ID4gcmVzdWx0cy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgIGZpbmFsUm93ID0gcmVzdWx0cy5sZW5ndGg7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgc3RhcnRSb3cgPSBmaW5hbFJvdyAtIDEwMDtcclxuICAgICAgICAgICAgaWYgKHN0YXJ0Um93IDwgMCkge1xyXG4gICAgICAgICAgICAgICAgc3RhcnRSb3cgPSAwO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBBcHBlZGluZyBpdGVtc1xyXG4gICAgICAgICAgICBmb3IgKHZhciBqID0gc3RhcnRSb3c7IGogPCBmaW5hbFJvdzsgaisrKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAob2JqLm9wdGlvbnMuc2VhcmNoID09IHRydWUgJiYgb2JqLnJlc3VsdHMpIHtcclxuICAgICAgICAgICAgICAgICAgICBvYmoudGJvZHkuYXBwZW5kQ2hpbGQob2JqLnJvd3NbcmVzdWx0c1tqXV0pO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBvYmoudGJvZHkuYXBwZW5kQ2hpbGQob2JqLnJvd3Nbal0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGlmIChvYmoudGJvZHkuY2hpbGRyZW4ubGVuZ3RoID4gcXVhbnRpdHlQZXJQYWdlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgb2JqLnRib2R5LnJlbW92ZUNoaWxkKG9iai50Ym9keS5maXJzdENoaWxkKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgb2JqLmxvYWRVcCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgLy8gU2VhcmNoXHJcbiAgICAgICAgICAgIGlmIChvYmoub3B0aW9ucy5zZWFyY2ggPT0gdHJ1ZSAmJiBvYmoucmVzdWx0cykge1xyXG4gICAgICAgICAgICAgICAgdmFyIHJlc3VsdHMgPSBvYmoucmVzdWx0cztcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHZhciByZXN1bHRzID0gb2JqLnJvd3M7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdmFyIHRlc3QgPSAwO1xyXG4gICAgICAgICAgICBpZiAocmVzdWx0cy5sZW5ndGggPiAxMDApIHtcclxuICAgICAgICAgICAgICAgIC8vIEdldCB0aGUgZmlyc3QgZWxlbWVudCBpbiB0aGUgcGFnZVxyXG4gICAgICAgICAgICAgICAgdmFyIGl0ZW0gPSBwYXJzZUludChvYmoudGJvZHkuZmlyc3RDaGlsZC5nZXRBdHRyaWJ1dGUoJ2RhdGEteScpKTtcclxuICAgICAgICAgICAgICAgIGlmIChvYmoub3B0aW9ucy5zZWFyY2ggPT0gdHJ1ZSAmJiBvYmoucmVzdWx0cykge1xyXG4gICAgICAgICAgICAgICAgICAgIGl0ZW0gPSByZXN1bHRzLmluZGV4T2YoaXRlbSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAoaXRlbSA+IDApIHtcclxuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IDMwOyBqKyspIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaXRlbSA9IGl0ZW0gLSAxO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbSA+IC0xKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAob2JqLm9wdGlvbnMuc2VhcmNoID09IHRydWUgJiYgb2JqLnJlc3VsdHMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmoudGJvZHkuaW5zZXJ0QmVmb3JlKG9iai5yb3dzW3Jlc3VsdHNbaXRlbV1dLCBvYmoudGJvZHkuZmlyc3RDaGlsZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9iai50Ym9keS5pbnNlcnRCZWZvcmUob2JqLnJvd3NbaXRlbV0sIG9iai50Ym9keS5maXJzdENoaWxkKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChvYmoudGJvZHkuY2hpbGRyZW4ubGVuZ3RoID4gMTAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb2JqLnRib2R5LnJlbW92ZUNoaWxkKG9iai50Ym9keS5sYXN0Q2hpbGQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRlc3QgPSAxO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiB0ZXN0O1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgb2JqLmxvYWREb3duID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAvLyBTZWFyY2hcclxuICAgICAgICAgICAgaWYgKG9iai5vcHRpb25zLnNlYXJjaCA9PSB0cnVlICYmIG9iai5yZXN1bHRzKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgcmVzdWx0cyA9IG9iai5yZXN1bHRzO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdmFyIHJlc3VsdHMgPSBvYmoucm93cztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB2YXIgdGVzdCA9IDA7XHJcbiAgICAgICAgICAgIGlmIChyZXN1bHRzLmxlbmd0aCA+IDEwMCkge1xyXG4gICAgICAgICAgICAgICAgLy8gR2V0IHRoZSBsYXN0IGVsZW1lbnQgaW4gdGhlIHBhZ2VcclxuICAgICAgICAgICAgICAgIHZhciBpdGVtID0gcGFyc2VJbnQob2JqLnRib2R5Lmxhc3RDaGlsZC5nZXRBdHRyaWJ1dGUoJ2RhdGEteScpKTtcclxuICAgICAgICAgICAgICAgIGlmIChvYmoub3B0aW9ucy5zZWFyY2ggPT0gdHJ1ZSAmJiBvYmoucmVzdWx0cykge1xyXG4gICAgICAgICAgICAgICAgICAgIGl0ZW0gPSByZXN1bHRzLmluZGV4T2YoaXRlbSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAoaXRlbSA8IG9iai5yb3dzLmxlbmd0aCAtIDEpIHtcclxuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8PSAzMDsgaisrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpdGVtIDwgcmVzdWx0cy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChvYmoub3B0aW9ucy5zZWFyY2ggPT0gdHJ1ZSAmJiBvYmoucmVzdWx0cykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9iai50Ym9keS5hcHBlbmRDaGlsZChvYmoucm93c1tyZXN1bHRzW2l0ZW1dXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9iai50Ym9keS5hcHBlbmRDaGlsZChvYmoucm93c1tpdGVtXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAob2JqLnRib2R5LmNoaWxkcmVuLmxlbmd0aCA+IDEwMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9iai50Ym9keS5yZW1vdmVDaGlsZChvYmoudGJvZHkuZmlyc3RDaGlsZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGVzdCA9IDE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgaXRlbSA9IGl0ZW0gKyAxO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgcmV0dXJuIHRlc3Q7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBvYmoubG9hZFZhbGlkYXRpb24gPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIGlmIChvYmouc2VsZWN0ZWRDZWxsKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgY3VycmVudFBhZ2UgPSBwYXJzZUludChvYmoudGJvZHkuZmlyc3RDaGlsZC5nZXRBdHRyaWJ1dGUoJ2RhdGEteScpKSAvIDEwMDtcclxuICAgICAgICAgICAgICAgIHZhciBzZWxlY3RlZFBhZ2UgPSBwYXJzZUludChvYmouc2VsZWN0ZWRDZWxsWzNdIC8gMTAwKTtcclxuICAgICAgICAgICAgICAgIHZhciB0b3RhbFBhZ2VzID0gcGFyc2VJbnQob2JqLnJvd3MubGVuZ3RoIC8gMTAwKTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoY3VycmVudFBhZ2UgIT0gc2VsZWN0ZWRQYWdlICYmIHNlbGVjdGVkUGFnZSA8PSB0b3RhbFBhZ2VzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFBcnJheS5wcm90b3R5cGUuaW5kZXhPZi5jYWxsKG9iai50Ym9keS5jaGlsZHJlbiwgb2JqLnJvd3Nbb2JqLnNlbGVjdGVkQ2VsbFszXV0pKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9iai5sb2FkUGFnZShzZWxlY3RlZFBhZ2UpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIFJlc2V0IHNlYXJjaFxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIG9iai5yZXNldFNlYXJjaCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgb2JqLnNlYXJjaElucHV0LnZhbHVlID0gJyc7XHJcbiAgICAgICAgICAgIG9iai5zZWFyY2goJycpO1xyXG4gICAgICAgICAgICBvYmoucmVzdWx0cyA9IG51bGw7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvKipcclxuICAgICAgICAgKiBTZWFyY2hcclxuICAgICAgICAgKi9cclxuICAgICAgICBvYmouc2VhcmNoID0gZnVuY3Rpb24gKHF1ZXJ5KSB7XHJcbiAgICAgICAgICAgIC8vIFF1ZXJ5XHJcbiAgICAgICAgICAgIGlmIChxdWVyeSkge1xyXG4gICAgICAgICAgICAgICAgdmFyIHF1ZXJ5ID0gcXVlcnkudG9Mb3dlckNhc2UoKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gUmVzZXQgYW55IGZpbHRlclxyXG4gICAgICAgICAgICBpZiAob2JqLm9wdGlvbnMuZmlsdGVycykge1xyXG4gICAgICAgICAgICAgICAgb2JqLnJlc2V0RmlsdGVycygpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBSZXNldCBzZWxlY3Rpb25cclxuICAgICAgICAgICAgb2JqLnJlc2V0U2VsZWN0aW9uKCk7XHJcblxyXG4gICAgICAgICAgICAvLyBUb3RhbCBvZiByZXN1bHRzXHJcbiAgICAgICAgICAgIG9iai5wYWdlTnVtYmVyID0gMDtcclxuICAgICAgICAgICAgb2JqLnJlc3VsdHMgPSBbXTtcclxuXHJcbiAgICAgICAgICAgIGlmIChxdWVyeSkge1xyXG4gICAgICAgICAgICAgICAgLy8gU2VhcmNoIGZpbHRlclxyXG4gICAgICAgICAgICAgICAgdmFyIHNlYXJjaCA9IGZ1bmN0aW9uIChpdGVtLCBxdWVyeSwgaW5kZXgpIHtcclxuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGl0ZW0ubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCgnJyArIGl0ZW1baV0pLnRvTG93ZXJDYXNlKCkuc2VhcmNoKHF1ZXJ5KSA+PSAwIHx8XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAoJycgKyBvYmoucmVjb3Jkc1tpbmRleF1baV0uaW5uZXJIVE1MKS50b0xvd2VyQ2FzZSgpLnNlYXJjaChxdWVyeSkgPj0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIC8vIFJlc3VsdFxyXG4gICAgICAgICAgICAgICAgdmFyIGFkZFRvUmVzdWx0ID0gZnVuY3Rpb24gKGspIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAob2JqLnJlc3VsdHMuaW5kZXhPZihrKSA9PSAtMSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBvYmoucmVzdWx0cy5wdXNoKGspO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAvLyBGaWx0ZXJcclxuICAgICAgICAgICAgICAgIHZhciBkYXRhID0gb2JqLm9wdGlvbnMuZGF0YS5maWx0ZXIoZnVuY3Rpb24gKHYsIGspIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoc2VhcmNoKHYsIHF1ZXJ5LCBrKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBNZXJnZWQgcm93cyBmb3VuZFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgcm93cyA9IG9iai5pc1Jvd01lcmdlZChrKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJvd3MubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHJvd3MubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgcm93ID0gamV4Y2VsLmdldElkRnJvbUNvbHVtbk5hbWUocm93c1tpXSwgdHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBvYmoub3B0aW9ucy5tZXJnZUNlbGxzW3Jvd3NbaV1dWzFdOyBqKyspIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkVG9SZXN1bHQocm93WzFdICsgaik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gTm9ybWFsIHJvdyBmb3VuZFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkVG9SZXN1bHQoayk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgb2JqLnJlc3VsdHMgPSBudWxsO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gb2JqLnVwZGF0ZVJlc3VsdCgpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgb2JqLnVwZGF0ZVJlc3VsdCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgdmFyIHRvdGFsID0gMDtcclxuICAgICAgICAgICAgdmFyIGluZGV4ID0gMDtcclxuXHJcbiAgICAgICAgICAgIC8vIFBhZ2UgMVxyXG4gICAgICAgICAgICBpZiAob2JqLm9wdGlvbnMubGF6eUxvYWRpbmcgPT0gdHJ1ZSkge1xyXG4gICAgICAgICAgICAgICAgdG90YWwgPSAxMDA7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAob2JqLm9wdGlvbnMucGFnaW5hdGlvbiA+IDApIHtcclxuICAgICAgICAgICAgICAgIHRvdGFsID0gb2JqLm9wdGlvbnMucGFnaW5hdGlvbjtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGlmIChvYmoucmVzdWx0cykge1xyXG4gICAgICAgICAgICAgICAgICAgIHRvdGFsID0gb2JqLnJlc3VsdHMubGVuZ3RoO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICB0b3RhbCA9IG9iai5yb3dzLmxlbmd0aDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gUmVzZXQgY3VycmVudCBub2Rlc1xyXG4gICAgICAgICAgICB3aGlsZSAob2JqLnRib2R5LmZpcnN0Q2hpbGQpIHtcclxuICAgICAgICAgICAgICAgIG9iai50Ym9keS5yZW1vdmVDaGlsZChvYmoudGJvZHkuZmlyc3RDaGlsZCk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIEhpZGUgYWxsIHJlY29yZHMgZnJvbSB0aGUgdGFibGVcclxuICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBvYmoucm93cy5sZW5ndGg7IGorKykge1xyXG4gICAgICAgICAgICAgICAgaWYgKCFvYmoucmVzdWx0cyB8fCBvYmoucmVzdWx0cy5pbmRleE9mKGopID4gLTEpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoaW5kZXggPCB0b3RhbCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBvYmoudGJvZHkuYXBwZW5kQ2hpbGQob2JqLnJvd3Nbal0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpbmRleCsrO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBvYmoucm93c1tqXS5zdHlsZS5kaXNwbGF5ID0gJyc7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIG9iai5yb3dzW2pdLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIFVwZGF0ZSBwYWdpbmF0aW9uXHJcbiAgICAgICAgICAgIGlmIChvYmoub3B0aW9ucy5wYWdpbmF0aW9uID4gMCkge1xyXG4gICAgICAgICAgICAgICAgb2JqLnVwZGF0ZVBhZ2luYXRpb24oKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgb2JqLnVwZGF0ZUNvcm5lclBvc2l0aW9uKCk7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gdG90YWw7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvKipcclxuICAgICAgICAgKiBXaGljaCBwYWdlIHRoZSBjZWxsIGlzXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgb2JqLndoaWNoUGFnZSA9IGZ1bmN0aW9uIChjZWxsKSB7XHJcbiAgICAgICAgICAgIC8vIFNlYXJjaFxyXG4gICAgICAgICAgICBpZiAob2JqLm9wdGlvbnMuc2VhcmNoID09IHRydWUgJiYgb2JqLnJlc3VsdHMpIHtcclxuICAgICAgICAgICAgICAgIGNlbGwgPSBvYmoucmVzdWx0cy5pbmRleE9mKGNlbGwpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gKE1hdGguY2VpbCgocGFyc2VJbnQoY2VsbCkgKyAxKSAvIHBhcnNlSW50KG9iai5vcHRpb25zLnBhZ2luYXRpb24pKSkgLSAxO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogR28gdG8gcGFnZVxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIG9iai5wYWdlID0gZnVuY3Rpb24gKHBhZ2VOdW1iZXIpIHtcclxuICAgICAgICAgICAgdmFyIG9sZFBhZ2UgPSBvYmoucGFnZU51bWJlcjtcclxuXHJcbiAgICAgICAgICAgIC8vIFNlYXJjaFxyXG4gICAgICAgICAgICBpZiAob2JqLm9wdGlvbnMuc2VhcmNoID09IHRydWUgJiYgb2JqLnJlc3VsdHMpIHtcclxuICAgICAgICAgICAgICAgIHZhciByZXN1bHRzID0gb2JqLnJlc3VsdHM7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgcmVzdWx0cyA9IG9iai5yb3dzO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBQZXIgcGFnZVxyXG4gICAgICAgICAgICB2YXIgcXVhbnRpdHlQZXJQYWdlID0gcGFyc2VJbnQob2JqLm9wdGlvbnMucGFnaW5hdGlvbik7XHJcblxyXG4gICAgICAgICAgICAvLyBwYWdlTnVtYmVyXHJcbiAgICAgICAgICAgIGlmIChwYWdlTnVtYmVyID09IG51bGwgfHwgcGFnZU51bWJlciA9PSAtMSkge1xyXG4gICAgICAgICAgICAgICAgLy8gTGFzdCBwYWdlXHJcbiAgICAgICAgICAgICAgICBwYWdlTnVtYmVyID0gTWF0aC5jZWlsKHJlc3VsdHMubGVuZ3RoIC8gcXVhbnRpdHlQZXJQYWdlKSAtIDE7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIFBhZ2UgbnVtYmVyXHJcbiAgICAgICAgICAgIG9iai5wYWdlTnVtYmVyID0gcGFnZU51bWJlcjtcclxuXHJcbiAgICAgICAgICAgIHZhciBzdGFydFJvdyA9IChwYWdlTnVtYmVyICogcXVhbnRpdHlQZXJQYWdlKTtcclxuICAgICAgICAgICAgdmFyIGZpbmFsUm93ID0gKHBhZ2VOdW1iZXIgKiBxdWFudGl0eVBlclBhZ2UpICsgcXVhbnRpdHlQZXJQYWdlO1xyXG4gICAgICAgICAgICBpZiAoZmluYWxSb3cgPiByZXN1bHRzLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgZmluYWxSb3cgPSByZXN1bHRzLmxlbmd0aDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoc3RhcnRSb3cgPCAwKSB7XHJcbiAgICAgICAgICAgICAgICBzdGFydFJvdyA9IDA7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIFJlc2V0IGNvbnRhaW5lclxyXG4gICAgICAgICAgICB3aGlsZSAob2JqLnRib2R5LmZpcnN0Q2hpbGQpIHtcclxuICAgICAgICAgICAgICAgIG9iai50Ym9keS5yZW1vdmVDaGlsZChvYmoudGJvZHkuZmlyc3RDaGlsZCk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIEFwcGVkaW5nIGl0ZW1zXHJcbiAgICAgICAgICAgIGZvciAodmFyIGogPSBzdGFydFJvdzsgaiA8IGZpbmFsUm93OyBqKyspIHtcclxuICAgICAgICAgICAgICAgIGlmIChvYmoub3B0aW9ucy5zZWFyY2ggPT0gdHJ1ZSAmJiBvYmoucmVzdWx0cykge1xyXG4gICAgICAgICAgICAgICAgICAgIG9iai50Ym9keS5hcHBlbmRDaGlsZChvYmoucm93c1tyZXN1bHRzW2pdXSk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIG9iai50Ym9keS5hcHBlbmRDaGlsZChvYmoucm93c1tqXSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmIChvYmoub3B0aW9ucy5wYWdpbmF0aW9uID4gMCkge1xyXG4gICAgICAgICAgICAgICAgb2JqLnVwZGF0ZVBhZ2luYXRpb24oKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gVXBkYXRlIGNvcm5lciBwb3NpdGlvblxyXG4gICAgICAgICAgICBvYmoudXBkYXRlQ29ybmVyUG9zaXRpb24oKTtcclxuXHJcbiAgICAgICAgICAgIC8vIEV2ZW50c1xyXG4gICAgICAgICAgICBvYmouZGlzcGF0Y2goJ29uY2hhbmdlcGFnZScsIGVsLCBwYWdlTnVtYmVyLCBvbGRQYWdlKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIFVwZGF0ZSB0aGUgcGFnaW5hdGlvblxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIG9iai51cGRhdGVQYWdpbmF0aW9uID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAvLyBSZXNldCBjb250YWluZXJcclxuICAgICAgICAgICAgb2JqLnBhZ2luYXRpb24uY2hpbGRyZW5bMF0uaW5uZXJIVE1MID0gJyc7XHJcbiAgICAgICAgICAgIG9iai5wYWdpbmF0aW9uLmNoaWxkcmVuWzFdLmlubmVySFRNTCA9ICcnO1xyXG5cclxuICAgICAgICAgICAgLy8gU3RhcnQgcGFnaW5hdGlvblxyXG4gICAgICAgICAgICBpZiAob2JqLm9wdGlvbnMucGFnaW5hdGlvbikge1xyXG4gICAgICAgICAgICAgICAgLy8gU2VhcmNoYWJsZVxyXG4gICAgICAgICAgICAgICAgaWYgKG9iai5vcHRpb25zLnNlYXJjaCA9PSB0cnVlICYmIG9iai5yZXN1bHRzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHJlc3VsdHMgPSBvYmoucmVzdWx0cy5sZW5ndGg7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciByZXN1bHRzID0gb2JqLnJvd3MubGVuZ3RoO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGlmICghcmVzdWx0cykge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIE5vIHJlY29yZHMgZm91bmRcclxuICAgICAgICAgICAgICAgICAgICBvYmoucGFnaW5hdGlvbi5jaGlsZHJlblswXS5pbm5lckhUTUwgPSBvYmoub3B0aW9ucy50ZXh0Lm5vUmVjb3Jkc0ZvdW5kO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBQYWdpbmF0aW9uIGNvbnRhaW5lclxyXG4gICAgICAgICAgICAgICAgICAgIHZhciBxdWFudHlPZlBhZ2VzID0gTWF0aC5jZWlsKHJlc3VsdHMgLyBvYmoub3B0aW9ucy5wYWdpbmF0aW9uKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKG9iai5wYWdlTnVtYmVyIDwgNikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgc3RhcnROdW1iZXIgPSAxO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgZmluYWxOdW1iZXIgPSBxdWFudHlPZlBhZ2VzIDwgMTAgPyBxdWFudHlPZlBhZ2VzIDogMTA7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChxdWFudHlPZlBhZ2VzIC0gb2JqLnBhZ2VOdW1iZXIgPCA1KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzdGFydE51bWJlciA9IHF1YW50eU9mUGFnZXMgLSA5O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgZmluYWxOdW1iZXIgPSBxdWFudHlPZlBhZ2VzO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoc3RhcnROdW1iZXIgPCAxKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGFydE51bWJlciA9IDE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgc3RhcnROdW1iZXIgPSBvYmoucGFnZU51bWJlciAtIDQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBmaW5hbE51bWJlciA9IG9iai5wYWdlTnVtYmVyICsgNTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIC8vIEZpcnN0XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHN0YXJ0TnVtYmVyID4gMSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgcGFnaW5hdGlvbkl0ZW0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcGFnaW5hdGlvbkl0ZW0uY2xhc3NOYW1lID0gJ2pleGNlbF9wYWdlJztcclxuICAgICAgICAgICAgICAgICAgICAgICAgcGFnaW5hdGlvbkl0ZW0uaW5uZXJIVE1MID0gJzwnO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBwYWdpbmF0aW9uSXRlbS50aXRsZSA9IDE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9iai5wYWdpbmF0aW9uLmNoaWxkcmVuWzFdLmFwcGVuZENoaWxkKHBhZ2luYXRpb25JdGVtKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIC8vIEdldCBwYWdlIGxpbmtzXHJcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IHN0YXJ0TnVtYmVyOyBpIDw9IGZpbmFsTnVtYmVyOyBpKyspIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHBhZ2luYXRpb25JdGVtID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHBhZ2luYXRpb25JdGVtLmNsYXNzTmFtZSA9ICdqZXhjZWxfcGFnZSc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHBhZ2luYXRpb25JdGVtLmlubmVySFRNTCA9IGk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9iai5wYWdpbmF0aW9uLmNoaWxkcmVuWzFdLmFwcGVuZENoaWxkKHBhZ2luYXRpb25JdGVtKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChvYmoucGFnZU51bWJlciA9PSAoaSAtIDEpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYWdpbmF0aW9uSXRlbS5jbGFzc0xpc3QuYWRkKCdqZXhjZWxfcGFnZV9zZWxlY3RlZCcpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAvLyBMYXN0XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGZpbmFsTnVtYmVyIDwgcXVhbnR5T2ZQYWdlcykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgcGFnaW5hdGlvbkl0ZW0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcGFnaW5hdGlvbkl0ZW0uY2xhc3NOYW1lID0gJ2pleGNlbF9wYWdlJztcclxuICAgICAgICAgICAgICAgICAgICAgICAgcGFnaW5hdGlvbkl0ZW0uaW5uZXJIVE1MID0gJz4nO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBwYWdpbmF0aW9uSXRlbS50aXRsZSA9IHF1YW50eU9mUGFnZXM7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9iai5wYWdpbmF0aW9uLmNoaWxkcmVuWzFdLmFwcGVuZENoaWxkKHBhZ2luYXRpb25JdGVtKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIC8vIFRleHRcclxuICAgICAgICAgICAgICAgICAgICB2YXIgZm9ybWF0ID0gZnVuY3Rpb24gKGZvcm1hdCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgYXJncyA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cywgMSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmb3JtYXQucmVwbGFjZSgveyhcXGQrKX0vZywgZnVuY3Rpb24gKG1hdGNoLCBudW1iZXIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0eXBlb2YgYXJnc1tudW1iZXJdICE9ICd1bmRlZmluZWQnXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPyBhcmdzW251bWJlcl1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA6IG1hdGNoXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBvYmoucGFnaW5hdGlvbi5jaGlsZHJlblswXS5pbm5lckhUTUwgPSBmb3JtYXQob2JqLm9wdGlvbnMudGV4dC5zaG93aW5nUGFnZSwgb2JqLnBhZ2VOdW1iZXIgKyAxLCBxdWFudHlPZlBhZ2VzKVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvKipcclxuICAgICAgICAgKiBEb3dubG9hZCBDU1YgdGFibGVcclxuICAgICAgICAgKlxyXG4gICAgICAgICAqIEByZXR1cm4gbnVsbFxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIG9iai5kb3dubG9hZCA9IGZ1bmN0aW9uIChpbmNsdWRlSGVhZGVycykge1xyXG4gICAgICAgICAgICBpZiAob2JqLm9wdGlvbnMuYWxsb3dFeHBvcnQgPT0gZmFsc2UpIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0V4cG9ydCBub3QgYWxsb3dlZCcpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgLy8gRGF0YVxyXG4gICAgICAgICAgICAgICAgdmFyIGRhdGEgPSAnJztcclxuICAgICAgICAgICAgICAgIGlmIChpbmNsdWRlSGVhZGVycyA9PSB0cnVlIHx8IG9iai5vcHRpb25zLmluY2x1ZGVIZWFkZXJzT25Eb3dubG9hZCA9PSB0cnVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZGF0YSArPSBvYmouZ2V0SGVhZGVycygpLnJlcGxhY2UoL1xccysvZ20sICcgJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgZGF0YSArPSBcIlxcclxcblwiO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIC8vIEdldCBkYXRhXHJcbiAgICAgICAgICAgICAgICBkYXRhICs9IG9iai5jb3B5KGZhbHNlLCBvYmoub3B0aW9ucy5jc3ZEZWxpbWl0ZXIsIHRydWUpO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIERvd25sb2FkIGVsZW1lbnRcclxuICAgICAgICAgICAgICAgIHZhciBibG9iID0gbmV3IEJsb2IoW1wiXFx1RkVGRlwiICsgZGF0YV0sIHt0eXBlOiAndGV4dC9jc3Y7Y2hhcnNldD11dGYtODsnfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gSUUgQ29tcGF0aWJpbGl0eVxyXG4gICAgICAgICAgICAgICAgaWYgKHdpbmRvdy5uYXZpZ2F0b3IgJiYgd2luZG93Lm5hdmlnYXRvci5tc1NhdmVPck9wZW5CbG9iKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgd2luZG93Lm5hdmlnYXRvci5tc1NhdmVPck9wZW5CbG9iKGJsb2IsIG9iai5vcHRpb25zLmNzdkZpbGVOYW1lICsgJy5jc3YnKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gRG93bmxvYWQgZWxlbWVudFxyXG4gICAgICAgICAgICAgICAgICAgIHZhciBwb20gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHVybCA9IFVSTC5jcmVhdGVPYmplY3RVUkwoYmxvYik7XHJcbiAgICAgICAgICAgICAgICAgICAgcG9tLmhyZWYgPSB1cmw7XHJcbiAgICAgICAgICAgICAgICAgICAgcG9tLnNldEF0dHJpYnV0ZSgnZG93bmxvYWQnLCBvYmoub3B0aW9ucy5jc3ZGaWxlTmFtZSArICcuY3N2Jyk7XHJcbiAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChwb20pO1xyXG4gICAgICAgICAgICAgICAgICAgIHBvbS5jbGljaygpO1xyXG4gICAgICAgICAgICAgICAgICAgIHBvbS5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHBvbSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIEluaXRpYWxpemVzIGEgbmV3IGhpc3RvcnkgcmVjb3JkIGZvciB1bmRvL3JlZG9cclxuICAgICAgICAgKlxyXG4gICAgICAgICAqIEByZXR1cm4gbnVsbFxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIG9iai5zZXRIaXN0b3J5ID0gZnVuY3Rpb24gKGNoYW5nZXMpIHtcclxuICAgICAgICAgICAgaWYgKG9iai5pZ25vcmVIaXN0b3J5ICE9IHRydWUpIHtcclxuICAgICAgICAgICAgICAgIC8vIEluY3JlbWVudCBhbmQgZ2V0IHRoZSBjdXJyZW50IGhpc3RvcnkgaW5kZXhcclxuICAgICAgICAgICAgICAgIHZhciBpbmRleCA9ICsrb2JqLmhpc3RvcnlJbmRleDtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyBTbGljZSB0aGUgYXJyYXkgdG8gZGlzY2FyZCB1bmRvbmUgY2hhbmdlc1xyXG4gICAgICAgICAgICAgICAgb2JqLmhpc3RvcnkgPSAob2JqLmhpc3RvcnkgPSBvYmouaGlzdG9yeS5zbGljZSgwLCBpbmRleCArIDEpKTtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyBjaGFuZ2VzID0gb2JqLmRpc3BhdGNoKCdvbnNldGhpc3RvcnknLCBjaGFuZ2VzKTtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyBLZWVwIGhpc3RvcnlcclxuICAgICAgICAgICAgICAgIG9iai5oaXN0b3J5W2luZGV4XSA9IGNoYW5nZXM7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIENvcHkgbWV0aG9kXHJcbiAgICAgICAgICpcclxuICAgICAgICAgKiBAcGFyYW0gYm9vbCBoaWdobGlnaHRlZCAtIEdldCBvbmx5IGhpZ2hsaWdodGVkIGNlbGxzXHJcbiAgICAgICAgICogQHBhcmFtIGRlbGltaXRlciAtIFxcdCBkZWZhdWx0IHRvIGtlZXAgY29tcGF0aWJpbGl0eSB3aXRoIGV4Y2VsXHJcbiAgICAgICAgICogQHJldHVybiBzdHJpbmcgdmFsdWVcclxuICAgICAgICAgKi9cclxuICAgICAgICBvYmouY29weSA9IGZ1bmN0aW9uIChoaWdobGlnaHRlZCwgZGVsaW1pdGVyLCByZXR1cm5EYXRhKSB7XHJcbiAgICAgICAgICAgIGlmICghZGVsaW1pdGVyKSB7XHJcbiAgICAgICAgICAgICAgICBkZWxpbWl0ZXIgPSBcIlxcdFwiO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBDb250cm9sc1xyXG4gICAgICAgICAgICB2YXIgaGVhZGVyID0gW107XHJcbiAgICAgICAgICAgIHZhciBjb2wgPSBbXTtcclxuICAgICAgICAgICAgdmFyIGNvbExhYmVsID0gW107XHJcbiAgICAgICAgICAgIHZhciByb3cgPSBbXTtcclxuICAgICAgICAgICAgdmFyIHJvd0xhYmVsID0gW107XHJcbiAgICAgICAgICAgIHZhciB4ID0gb2JqLm9wdGlvbnMuZGF0YVswXS5sZW5ndGhcclxuICAgICAgICAgICAgdmFyIHkgPSBvYmoub3B0aW9ucy5kYXRhLmxlbmd0aFxyXG4gICAgICAgICAgICB2YXIgdG1wID0gJyc7XHJcbiAgICAgICAgICAgIHZhciBjb3B5SGVhZGVyID0gb2JqLm9wdGlvbnMuaW5jbHVkZUhlYWRlcnNPbkNvcHk7XHJcblxyXG4gICAgICAgICAgICAvLyBSZXNldCBjb250YWluZXJcclxuICAgICAgICAgICAgb2JqLnN0eWxlID0gW107XHJcblxyXG4gICAgICAgICAgICBvYmouZGlzcGF0Y2goJ29uYmVmb3JlY29weScpO1xyXG5cclxuICAgICAgICAgICAgLy8gR28gdGhyb3VnaCB0aGUgY29sdW1ucyB0byBnZXQgdGhlIGRhdGFcclxuICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCB5OyBqKyspIHtcclxuICAgICAgICAgICAgICAgIGNvbCA9IFtdO1xyXG4gICAgICAgICAgICAgICAgY29sTGFiZWwgPSBbXTtcclxuXHJcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIElmIGNlbGwgaXMgaGlnaGxpZ2h0ZWRcclxuICAgICAgICAgICAgICAgICAgICBpZiAoIWhpZ2hsaWdodGVkIHx8IG9iai5yZWNvcmRzW2pdW2ldLmNsYXNzTGlzdC5jb250YWlucygnaGlnaGxpZ2h0JykpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNvcHlIZWFkZXIgPT0gdHJ1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaGVhZGVyLnB1c2gob2JqLmhlYWRlcnNbaV0uaW5uZXJUZXh0KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBWYWx1ZXNcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHZhbHVlID0gb2JqLm9wdGlvbnMuZGF0YVtqXVtpXTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICdvYmplY3QnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IEpTT04uc3RyaW5naWZ5KHZhbHVlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlLm1hdGNoICYmICh2YWx1ZS5tYXRjaCgvLC9nKSB8fCB2YWx1ZS5tYXRjaCgvXFxuLykgfHwgdmFsdWUubWF0Y2goL1xcXCIvKSkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlID0gdmFsdWUucmVwbGFjZShuZXcgUmVnRXhwKCdcIicsICdnJyksICdcIlwiJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9ICdcIicgKyB2YWx1ZSArICdcIic7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbC5wdXNoKHZhbHVlKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9iai5kaXNwYXRjaCgnb25jb3B5aW5nJywgdmFsdWUsIGksIGopO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gTGFiZWxzXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChvYmoub3B0aW9ucy5jb2x1bW5zW2ldLnR5cGUgPT0gJ2NoZWNrYm94JyB8fCBvYmoub3B0aW9ucy5jb2x1bW5zW2ldLnR5cGUgPT0gJ3JhZGlvJykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGxhYmVsID0gdmFsdWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAob2JqLm9wdGlvbnMuc3RyaXBIVE1MT25Db3B5ID09IHRydWUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgbGFiZWwgPSBvYmoucmVjb3Jkc1tqXVtpXS5pbm5lclRleHQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBsYWJlbCA9IG9iai5yZWNvcmRzW2pdW2ldLmlubmVySFRNTDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChsYWJlbC5tYXRjaCAmJiAobGFiZWwubWF0Y2goLywvZykgfHwgbGFiZWwubWF0Y2goL1xcbi8pIHx8IGxhYmVsLm1hdGNoKC9cXFwiLykpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gU2NhcGUgZG91YmxlIHF1b3Rlc1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsID0gbGFiZWwucmVwbGFjZShuZXcgUmVnRXhwKCdcIicsICdnJyksICdcIlwiJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWwgPSAnXCInICsgbGFiZWwgKyAnXCInO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbExhYmVsLnB1c2gobGFiZWwpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gR2V0IHN0eWxlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRtcCA9IG9iai5yZWNvcmRzW2pdW2ldLmdldEF0dHJpYnV0ZSgnc3R5bGUnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdG1wID0gdG1wLnJlcGxhY2UoJ2Rpc3BsYXk6IG5vbmU7JywgJycpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBvYmouc3R5bGUucHVzaCh0bXAgPyB0bXAgOiAnJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGlmIChjb2wubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNvcHlIZWFkZXIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcm93LnB1c2goaGVhZGVyLmpvaW4oZGVsaW1pdGVyKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIHJvdy5wdXNoKGNvbC5qb2luKGRlbGltaXRlcikpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGlmIChjb2xMYWJlbC5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoY29weUhlYWRlcikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByb3dMYWJlbC5wdXNoKGhlYWRlci5qb2luKGRlbGltaXRlcikpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICByb3dMYWJlbC5wdXNoKGNvbExhYmVsLmpvaW4oZGVsaW1pdGVyKSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBjb3B5SGVhZGVyID0gZmFsc2U7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIEZpbmFsIHN0cmluZ1xyXG4gICAgICAgICAgICB2YXIgc3RyID0gcm93LmpvaW4oXCJcXHJcXG5cIik7XHJcbiAgICAgICAgICAgIHZhciBzdHJMYWJlbCA9IHJvd0xhYmVsLmpvaW4oXCJcXHJcXG5cIik7XHJcblxyXG4gICAgICAgICAgICAvLyBDcmVhdGUgYSBoaWRkZW4gdGV4dGFyZWEgdG8gY29weSB0aGUgdmFsdWVzXHJcbiAgICAgICAgICAgIGlmICghcmV0dXJuRGF0YSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKG9iai5vcHRpb25zLmNvcHlDb21wYXRpYmlsaXR5ID09IHRydWUpIHtcclxuICAgICAgICAgICAgICAgICAgICBvYmoudGV4dGFyZWEudmFsdWUgPSBzdHJMYWJlbDtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgb2JqLnRleHRhcmVhLnZhbHVlID0gc3RyO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgb2JqLnRleHRhcmVhLnNlbGVjdCgpO1xyXG4gICAgICAgICAgICAgICAgZG9jdW1lbnQuZXhlY0NvbW1hbmQoXCJjb3B5XCIpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBLZWVwIGRhdGFcclxuICAgICAgICAgICAgaWYgKG9iai5vcHRpb25zLmNvcHlDb21wYXRpYmlsaXR5ID09IHRydWUpIHtcclxuICAgICAgICAgICAgICAgIG9iai5kYXRhID0gc3RyTGFiZWw7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBvYmouZGF0YSA9IHN0cjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAvLyBLZWVwIG5vbiB2aXNpYmxlIGluZm9ybWF0aW9uXHJcbiAgICAgICAgICAgIG9iai5oYXNoU3RyaW5nID0gb2JqLmhhc2gob2JqLmRhdGEpO1xyXG5cclxuICAgICAgICAgICAgLy8gQW55IGV4aXRpbmcgYm9yZGVyIHNob3VsZCBnb1xyXG4gICAgICAgICAgICBvYmoucmVtb3ZlQ29weWluZ1NlbGVjdGlvbigpO1xyXG5cclxuICAgICAgICAgICAgLy8gQm9yZGVyXHJcbiAgICAgICAgICAgIGlmIChvYmouaGlnaGxpZ2h0ZWQpIHtcclxuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgb2JqLmhpZ2hsaWdodGVkLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgb2JqLmhpZ2hsaWdodGVkW2ldLmNsYXNzTGlzdC5hZGQoJ2NvcHlpbmcnKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAob2JqLmhpZ2hsaWdodGVkW2ldLmNsYXNzTGlzdC5jb250YWlucygnaGlnaGxpZ2h0LWxlZnQnKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBvYmouaGlnaGxpZ2h0ZWRbaV0uY2xhc3NMaXN0LmFkZCgnY29weWluZy1sZWZ0Jyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChvYmouaGlnaGxpZ2h0ZWRbaV0uY2xhc3NMaXN0LmNvbnRhaW5zKCdoaWdobGlnaHQtcmlnaHQnKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBvYmouaGlnaGxpZ2h0ZWRbaV0uY2xhc3NMaXN0LmFkZCgnY29weWluZy1yaWdodCcpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBpZiAob2JqLmhpZ2hsaWdodGVkW2ldLmNsYXNzTGlzdC5jb250YWlucygnaGlnaGxpZ2h0LXRvcCcpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9iai5oaWdobGlnaHRlZFtpXS5jbGFzc0xpc3QuYWRkKCdjb3B5aW5nLXRvcCcpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBpZiAob2JqLmhpZ2hsaWdodGVkW2ldLmNsYXNzTGlzdC5jb250YWlucygnaGlnaGxpZ2h0LWJvdHRvbScpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9iai5oaWdobGlnaHRlZFtpXS5jbGFzc0xpc3QuYWRkKCdjb3B5aW5nLWJvdHRvbScpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gUGFzdGUgZXZlbnRcclxuICAgICAgICAgICAgb2JqLmRpc3BhdGNoKCdvbmNvcHknLCBlbCwgb2JqLm9wdGlvbnMuY29weUNvbXBhdGliaWxpdHkgPT0gdHJ1ZSA/IHJvd0xhYmVsIDogcm93LCBvYmouaGFzaFN0cmluZyk7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gb2JqLmRhdGE7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvKipcclxuICAgICAgICAgKiBqRXhjZWwgcGFzdGUgbWV0aG9kXHJcbiAgICAgICAgICpcclxuICAgICAgICAgKiBAcGFyYW0gaW50ZWdlciByb3cgbnVtYmVyXHJcbiAgICAgICAgICogQHJldHVybiBzdHJpbmcgdmFsdWVcclxuICAgICAgICAgKi9cclxuICAgICAgICAvLyBvYmoucGFzdGUgPSBmdW5jdGlvbih4LCB5LCBkYXRhKSB7XHJcbiAgICAgICAgb2JqLnBhc3RlID0gZnVuY3Rpb24gKHNlbGVjdGVkQ2VsbCwgZGF0YSkge1xyXG4gICAgICAgICAgICAvLyBQYXN0ZSBmaWx0ZXJcclxuICAgICAgICAgICAgLy8gdmFyIHJldCA9IG9iai5kaXNwYXRjaCgnb25iZWZvcmVwYXN0ZScsIGVsLCBkYXRhLCB4LCB5KTtcclxuICAgICAgICAgICAgLy9cclxuICAgICAgICAgICAgLy8gaWYgKHJldCA9PT0gZmFsc2UpIHtcclxuICAgICAgICAgICAgLy8gICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgLy8gfSBlbHNlIGlmIChyZXQpIHtcclxuICAgICAgICAgICAgLy8gICAgIHZhciBkYXRhID0gcmV0O1xyXG4gICAgICAgICAgICAvLyB9XHJcblxyXG4gICAgICAgICAgICB2YXIgeCA9IHNlbGVjdGVkQ2VsbFswXSxcclxuICAgICAgICAgICAgICAgIHkgPSBzZWxlY3RlZENlbGxbMV0sXHJcbiAgICAgICAgICAgICAgICB3ID0gc2VsZWN0ZWRDZWxsWzJdIC0geCArIDEsXHJcbiAgICAgICAgICAgICAgICBoID0gc2VsZWN0ZWRDZWxsWzNdIC0geSArIDE7XHJcblxyXG4gICAgICAgICAgICAvLyBjaGFuZ2UgcGFzdGUgcmFuZ2UgaWYgc2VsZWN0IGlzIGZyb20gcmlnaHQgdG8gbGVmdFxyXG4gICAgICAgICAgICBpZiAoc2VsZWN0ZWRDZWxsWzJdIDwgc2VsZWN0ZWRDZWxsWzBdKSB7XHJcbiAgICAgICAgICAgICAgICB4ID0gc2VsZWN0ZWRDZWxsWzJdO1xyXG4gICAgICAgICAgICAgICAgdyA9IHNlbGVjdGVkQ2VsbFswXSAtIHggKyAxO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIC8vIGNoYW5nZSBwYXN0ZSByYW5nZSBpZiBzZWxlY3QgaXMgZnJvbSBkb3duIHRvIHVwXHJcbiAgICAgICAgICAgIGlmIChzZWxlY3RlZENlbGxbM10gPCBzZWxlY3RlZENlbGxbMV0pIHtcclxuICAgICAgICAgICAgICAgIHkgPSBzZWxlY3RlZENlbGxbM107XHJcbiAgICAgICAgICAgICAgICBoID0gc2VsZWN0ZWRDZWxsWzFdIC0geSArIDE7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmICh0eXBlb2YgKG9iai5vcHRpb25zLm9uYmVmb3JlcGFzdGUpID09ICdmdW5jdGlvbicpIHtcclxuICAgICAgICAgICAgICAgIHZhciBkYXRhID0gb2JqLm9wdGlvbnMub25iZWZvcmVwYXN0ZShkYXRhLCBzZWxlY3RlZENlbGwpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAoIWRhdGEpIHtcclxuICAgICAgICAgICAgICAgIG9iai5yZW1vdmVDb3B5aW5nU2VsZWN0aW9uKCk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIENvbnRyb2xzXHJcbiAgICAgICAgICAgIHZhciBoYXNoID0gb2JqLmhhc2goZGF0YSk7XHJcbiAgICAgICAgICAgIHZhciBzdHlsZSA9IChoYXNoID09IG9iai5oYXNoU3RyaW5nKSA/IG9iai5zdHlsZSA6IG51bGw7XHJcblxyXG4gICAgICAgICAgICAvLyBEZXBlbmRpbmcgb24gdGhlIGJlaGF2aW9yXHJcbiAgICAgICAgICAgIGlmIChvYmoub3B0aW9ucy5jb3B5Q29tcGF0aWJpbGl0eSA9PSB0cnVlICYmIGhhc2ggPT0gb2JqLmhhc2hTdHJpbmcpIHtcclxuICAgICAgICAgICAgICAgIHZhciBkYXRhID0gb2JqLmRhdGE7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIFNwbGl0IG5ldyBsaW5lXHJcbiAgICAgICAgICAgIHZhciBkYXRhID0gb2JqLnBhcnNlQ1NWKGRhdGEsIFwiXFx0XCIpO1xyXG5cclxuICAgICAgICAgICAgaWYgKHcgPiAxICYgTnVtYmVyLmlzSW50ZWdlcih3IC8gZGF0YVswXS5sZW5ndGgpKSB7XHJcbiAgICAgICAgICAgICAgICBzdHlsZSA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICByZXBlYXRzID0gdyAvIGRhdGFbMF0ubGVuZ3RoO1xyXG5cclxuICAgICAgICAgICAgICAgIHZhciBhcnJheUIgPSBkYXRhLm1hcChmdW5jdGlvbiAocm93LCBpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGFycmF5QyA9IEFycmF5LmFwcGx5KG51bGwsIHtsZW5ndGg6IHJlcGVhdHMgKiByb3cubGVuZ3RofSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgLm1hcChmdW5jdGlvbiAoZSwgaSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJvd1tpICUgcm93Lmxlbmd0aF1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGFycmF5Q1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICBkYXRhID0gYXJyYXlCO1xyXG5cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoaCA+IDEgJiBOdW1iZXIuaXNJbnRlZ2VyKGggLyBkYXRhLmxlbmd0aCkpIHtcclxuICAgICAgICAgICAgICAgIHN0eWxlID0gbnVsbDtcclxuICAgICAgICAgICAgICAgIHZhciByZXBlYXRzID0gaCAvIGRhdGEubGVuZ3RoO1xyXG4gICAgICAgICAgICAgICAgdmFyIGFycmF5QiA9IEFycmF5LmFwcGx5KG51bGwsIHtsZW5ndGg6IHJlcGVhdHMgKiBkYXRhLmxlbmd0aH0pXHJcbiAgICAgICAgICAgICAgICAgICAgLm1hcChmdW5jdGlvbiAoZSwgaSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGF0YVtpICUgZGF0YS5sZW5ndGhdXHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICBkYXRhID0gYXJyYXlCO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAoeCAhPSBudWxsICYmIHkgIT0gbnVsbCAmJiBkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAvLyBSZWNvcmRzXHJcbiAgICAgICAgICAgICAgICB2YXIgaSA9IDA7XHJcbiAgICAgICAgICAgICAgICB2YXIgaiA9IDA7XHJcbiAgICAgICAgICAgICAgICB2YXIgcmVjb3JkcyA9IFtdO1xyXG4gICAgICAgICAgICAgICAgdmFyIG5ld1N0eWxlID0ge307XHJcbiAgICAgICAgICAgICAgICB2YXIgb2xkU3R5bGUgPSB7fTtcclxuICAgICAgICAgICAgICAgIHZhciBzdHlsZUluZGV4ID0gMDtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyBJbmRleFxyXG4gICAgICAgICAgICAgICAgdmFyIGNvbEluZGV4ID0gcGFyc2VJbnQoeCk7XHJcbiAgICAgICAgICAgICAgICB2YXIgcm93SW5kZXggPSBwYXJzZUludCh5KTtcclxuICAgICAgICAgICAgICAgIHZhciByb3cgPSBudWxsO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIEdvIHRocm91Z2ggdGhlIGNvbHVtbnMgdG8gZ2V0IHRoZSBkYXRhXHJcbiAgICAgICAgICAgICAgICB3aGlsZSAocm93ID0gZGF0YVtqXSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGkgPSAwO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbEluZGV4ID0gcGFyc2VJbnQoeCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHdoaWxlIChyb3dbaV0gIT0gbnVsbCkge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCBpc09iamVjdCA9IEpTT04ucGFyc2Uocm93W2ldKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpc09iamVjdCkgcm93W2ldID0gaXNPYmplY3Q7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gVXBkYXRlIGFuZCBrZWVwIGhpc3RvcnlcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHJlY29yZCA9IG9iai51cGRhdGVDZWxsKGNvbEluZGV4LCByb3dJbmRleCwgcm93W2ldKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gS2VlcCBoaXN0b3J5XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlY29yZHMucHVzaChyZWNvcmQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBVcGRhdGUgYWxsIGZvcm11bGFzIGluIHRoZSBjaGFpblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBvYmoudXBkYXRlRm9ybXVsYUNoYWluKGNvbEluZGV4LCByb3dJbmRleCwgcmVjb3Jkcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFN0eWxlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzdHlsZSAmJiBzdHlsZVtzdHlsZUluZGV4XSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNvbHVtbk5hbWUgPSBqZXhjZWwuZ2V0Q29sdW1uTmFtZUZyb21JZChbY29sSW5kZXgsIHJvd0luZGV4XSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXdTdHlsZVtjb2x1bW5OYW1lXSA9IHN0eWxlW3N0eWxlSW5kZXhdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb2xkU3R5bGVbY29sdW1uTmFtZV0gPSBvYmouZ2V0U3R5bGUoY29sdW1uTmFtZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmoucmVjb3Jkc1tyb3dJbmRleF1bY29sSW5kZXhdLnNldEF0dHJpYnV0ZSgnc3R5bGUnLCBzdHlsZVtzdHlsZUluZGV4XSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHlsZUluZGV4KytcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpKys7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyb3dbaV0gIT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNvbEluZGV4ID49IG9iai5oZWFkZXJzLmxlbmd0aCAtIDEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmouaW5zZXJ0Q29sdW1uKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2xJbmRleCA9IG9iai5yaWdodC5nZXQoY29sSW5kZXgsIHJvd0luZGV4KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaisrO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChkYXRhW2pdKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyb3dJbmRleCA+PSBvYmoucm93cy5sZW5ndGggLSAxKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmouaW5zZXJ0Um93KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgcm93SW5kZXggPSBvYmouZG93bi5nZXQoeCwgcm93SW5kZXgpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAvLyBTZWxlY3QgdGhlIG5ldyBjZWxsc1xyXG4gICAgICAgICAgICAgICAgb2JqLnVwZGF0ZVNlbGVjdGlvbkZyb21Db29yZHMoeCwgeSwgY29sSW5kZXgsIHJvd0luZGV4KTtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyBVcGRhdGUgaGlzdG9yeVxyXG4gICAgICAgICAgICAgICAgb2JqLnNldEhpc3Rvcnkoe1xyXG4gICAgICAgICAgICAgICAgICAgIGFjdGlvbjogJ3NldFZhbHVlJyxcclxuICAgICAgICAgICAgICAgICAgICByZWNvcmRzOiByZWNvcmRzLFxyXG4gICAgICAgICAgICAgICAgICAgIHNlbGVjdGlvbjogb2JqLnNlbGVjdGVkQ2VsbCxcclxuICAgICAgICAgICAgICAgICAgICBuZXdTdHlsZTogbmV3U3R5bGUsXHJcbiAgICAgICAgICAgICAgICAgICAgb2xkU3R5bGU6IG9sZFN0eWxlLFxyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gVXBkYXRlIHRhYmxlXHJcbiAgICAgICAgICAgICAgICBvYmoudXBkYXRlVGFibGUoKTtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyBQYXN0ZSBldmVudFxyXG4gICAgICAgICAgICAgICAgb2JqLmRpc3BhdGNoKCdvbnBhc3RlJywgZWwsIGRhdGEpO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIE9uIGFmdGVyIGNoYW5nZXNcclxuICAgICAgICAgICAgICAgIG9iai5vbmFmdGVyY2hhbmdlcyhlbCwgcmVjb3Jkcyk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIG9iai5yZW1vdmVDb3B5aW5nU2VsZWN0aW9uKCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvKipcclxuICAgICAgICAgKiBSZW1vdmUgY29weWluZyBib3JkZXJcclxuICAgICAgICAgKi9cclxuICAgICAgICBvYmoucmVtb3ZlQ29weWluZ1NlbGVjdGlvbiA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgdmFyIGNvcHlpbmcgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuamV4Y2VsIC5jb3B5aW5nJyk7XHJcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgY29weWluZy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgY29weWluZ1tpXS5jbGFzc0xpc3QucmVtb3ZlKCdjb3B5aW5nJyk7XHJcbiAgICAgICAgICAgICAgICBjb3B5aW5nW2ldLmNsYXNzTGlzdC5yZW1vdmUoJ2NvcHlpbmctbGVmdCcpO1xyXG4gICAgICAgICAgICAgICAgY29weWluZ1tpXS5jbGFzc0xpc3QucmVtb3ZlKCdjb3B5aW5nLXJpZ2h0Jyk7XHJcbiAgICAgICAgICAgICAgICBjb3B5aW5nW2ldLmNsYXNzTGlzdC5yZW1vdmUoJ2NvcHlpbmctdG9wJyk7XHJcbiAgICAgICAgICAgICAgICBjb3B5aW5nW2ldLmNsYXNzTGlzdC5yZW1vdmUoJ2NvcHlpbmctYm90dG9tJyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIFByb2Nlc3Mgcm93XHJcbiAgICAgICAgICovXHJcbiAgICAgICAgb2JqLmhpc3RvcnlQcm9jZXNzUm93ID0gZnVuY3Rpb24gKHR5cGUsIGhpc3RvcnlSZWNvcmQpIHtcclxuICAgICAgICAgICAgdmFyIHJvd0luZGV4ID0gKCFoaXN0b3J5UmVjb3JkLmluc2VydEJlZm9yZSkgPyBoaXN0b3J5UmVjb3JkLnJvd051bWJlciArIDEgOiBoaXN0b3J5UmVjb3JkLnJvd051bWJlcjtcclxuXHJcbiAgICAgICAgICAgIGlmIChvYmoub3B0aW9ucy5zZWFyY2ggPT0gdHJ1ZSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKG9iai5yZXN1bHRzICYmIG9iai5yZXN1bHRzLmxlbmd0aCAhPSBvYmoucm93cy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgICAgICBvYmoucmVzZXRTZWFyY2goKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gUmVtb3ZlIHJvd1xyXG4gICAgICAgICAgICBpZiAodHlwZSA9PSAxKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgbnVtT2ZSb3dzID0gaGlzdG9yeVJlY29yZC5udW1PZlJvd3M7XHJcbiAgICAgICAgICAgICAgICAvLyBSZW1vdmUgbm9kZXNcclxuICAgICAgICAgICAgICAgIGZvciAodmFyIGogPSByb3dJbmRleDsgaiA8IChudW1PZlJvd3MgKyByb3dJbmRleCk7IGorKykge1xyXG4gICAgICAgICAgICAgICAgICAgIG9iai5yb3dzW2pdLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQob2JqLnJvd3Nbal0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgLy8gUmVtb3ZlIHJlZmVyZW5jZXNcclxuICAgICAgICAgICAgICAgIG9iai5yZWNvcmRzLnNwbGljZShyb3dJbmRleCwgbnVtT2ZSb3dzKTtcclxuICAgICAgICAgICAgICAgIG9iai5vcHRpb25zLmRhdGEuc3BsaWNlKHJvd0luZGV4LCBudW1PZlJvd3MpO1xyXG4gICAgICAgICAgICAgICAgb2JqLnJvd3Muc3BsaWNlKHJvd0luZGV4LCBudW1PZlJvd3MpO1xyXG5cclxuICAgICAgICAgICAgICAgIG9iai5jb25kaXRpb25hbFNlbGVjdGlvblVwZGF0ZSgxLCByb3dJbmRleCwgKG51bU9mUm93cyArIHJvd0luZGV4KSAtIDEpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgLy8gSW5zZXJ0IGRhdGFcclxuICAgICAgICAgICAgICAgIG9iai5yZWNvcmRzID0gamV4Y2VsLmluamVjdEFycmF5KG9iai5yZWNvcmRzLCByb3dJbmRleCwgaGlzdG9yeVJlY29yZC5yb3dSZWNvcmRzKTtcclxuICAgICAgICAgICAgICAgIG9iai5vcHRpb25zLmRhdGEgPSBqZXhjZWwuaW5qZWN0QXJyYXkob2JqLm9wdGlvbnMuZGF0YSwgcm93SW5kZXgsIGhpc3RvcnlSZWNvcmQucm93RGF0YSk7XHJcbiAgICAgICAgICAgICAgICBvYmoucm93cyA9IGpleGNlbC5pbmplY3RBcnJheShvYmoucm93cywgcm93SW5kZXgsIGhpc3RvcnlSZWNvcmQucm93Tm9kZSk7XHJcbiAgICAgICAgICAgICAgICAvLyBJbnNlcnQgbm9kZXNcclxuICAgICAgICAgICAgICAgIHZhciBpbmRleCA9IDBcclxuICAgICAgICAgICAgICAgIGZvciAodmFyIGogPSByb3dJbmRleDsgaiA8IChoaXN0b3J5UmVjb3JkLm51bU9mUm93cyArIHJvd0luZGV4KTsgaisrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgb2JqLnRib2R5Lmluc2VydEJlZm9yZShoaXN0b3J5UmVjb3JkLnJvd05vZGVbaW5kZXhdLCBvYmoudGJvZHkuY2hpbGRyZW5bal0pO1xyXG4gICAgICAgICAgICAgICAgICAgIGluZGV4Kys7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIFJlc3BlY3QgcGFnaW5hdGlvblxyXG4gICAgICAgICAgICBpZiAob2JqLm9wdGlvbnMucGFnaW5hdGlvbiA+IDApIHtcclxuICAgICAgICAgICAgICAgIG9iai5wYWdlKG9iai5wYWdlTnVtYmVyKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgb2JqLnVwZGF0ZVRhYmxlUmVmZXJlbmNlcygpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogUHJvY2VzcyBjb2x1bW5cclxuICAgICAgICAgKi9cclxuICAgICAgICBvYmouaGlzdG9yeVByb2Nlc3NDb2x1bW4gPSBmdW5jdGlvbiAodHlwZSwgaGlzdG9yeVJlY29yZCkge1xyXG4gICAgICAgICAgICB2YXIgY29sdW1uSW5kZXggPSAoIWhpc3RvcnlSZWNvcmQuaW5zZXJ0QmVmb3JlKSA/IGhpc3RvcnlSZWNvcmQuY29sdW1uTnVtYmVyICsgMSA6IGhpc3RvcnlSZWNvcmQuY29sdW1uTnVtYmVyO1xyXG5cclxuICAgICAgICAgICAgLy8gUmVtb3ZlIGNvbHVtblxyXG4gICAgICAgICAgICBpZiAodHlwZSA9PSAxKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgbnVtT2ZDb2x1bW5zID0gaGlzdG9yeVJlY29yZC5udW1PZkNvbHVtbnM7XHJcblxyXG4gICAgICAgICAgICAgICAgb2JqLm9wdGlvbnMuY29sdW1ucy5zcGxpY2UoY29sdW1uSW5kZXgsIG51bU9mQ29sdW1ucyk7XHJcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gY29sdW1uSW5kZXg7IGkgPCAobnVtT2ZDb2x1bW5zICsgY29sdW1uSW5kZXgpOyBpKyspIHtcclxuICAgICAgICAgICAgICAgICAgICBvYmouaGVhZGVyc1tpXS5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKG9iai5oZWFkZXJzW2ldKTtcclxuICAgICAgICAgICAgICAgICAgICBvYmouY29sZ3JvdXBbaV0ucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChvYmouY29sZ3JvdXBbaV0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgb2JqLmhlYWRlcnMuc3BsaWNlKGNvbHVtbkluZGV4LCBudW1PZkNvbHVtbnMpO1xyXG4gICAgICAgICAgICAgICAgb2JqLmNvbGdyb3VwLnNwbGljZShjb2x1bW5JbmRleCwgbnVtT2ZDb2x1bW5zKTtcclxuICAgICAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgaGlzdG9yeVJlY29yZC5kYXRhLmxlbmd0aDsgaisrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IGNvbHVtbkluZGV4OyBpIDwgKG51bU9mQ29sdW1ucyArIGNvbHVtbkluZGV4KTsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9iai5yZWNvcmRzW2pdW2ldLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQob2JqLnJlY29yZHNbal1baV0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBvYmoucmVjb3Jkc1tqXS5zcGxpY2UoY29sdW1uSW5kZXgsIG51bU9mQ29sdW1ucyk7XHJcbiAgICAgICAgICAgICAgICAgICAgb2JqLm9wdGlvbnMuZGF0YVtqXS5zcGxpY2UoY29sdW1uSW5kZXgsIG51bU9mQ29sdW1ucyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAvLyBQcm9jZXNzIGZvb3RlcnNcclxuICAgICAgICAgICAgICAgIGlmIChvYmoub3B0aW9ucy5mb290ZXJzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBvYmoub3B0aW9ucy5mb290ZXJzLmxlbmd0aDsgaisrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9iai5vcHRpb25zLmZvb3RlcnNbal0uc3BsaWNlKGNvbHVtbkluZGV4LCBudW1PZkNvbHVtbnMpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIC8vIEluc2VydCBkYXRhXHJcbiAgICAgICAgICAgICAgICBvYmoub3B0aW9ucy5jb2x1bW5zID0gamV4Y2VsLmluamVjdEFycmF5KG9iai5vcHRpb25zLmNvbHVtbnMsIGNvbHVtbkluZGV4LCBoaXN0b3J5UmVjb3JkLmNvbHVtbnMpO1xyXG4gICAgICAgICAgICAgICAgb2JqLmhlYWRlcnMgPSBqZXhjZWwuaW5qZWN0QXJyYXkob2JqLmhlYWRlcnMsIGNvbHVtbkluZGV4LCBoaXN0b3J5UmVjb3JkLmhlYWRlcnMpO1xyXG4gICAgICAgICAgICAgICAgb2JqLmNvbGdyb3VwID0gamV4Y2VsLmluamVjdEFycmF5KG9iai5jb2xncm91cCwgY29sdW1uSW5kZXgsIGhpc3RvcnlSZWNvcmQuY29sZ3JvdXApO1xyXG5cclxuICAgICAgICAgICAgICAgIHZhciBpbmRleCA9IDBcclxuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSBjb2x1bW5JbmRleDsgaSA8IChoaXN0b3J5UmVjb3JkLm51bU9mQ29sdW1ucyArIGNvbHVtbkluZGV4KTsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgb2JqLmhlYWRlckNvbnRhaW5lci5pbnNlcnRCZWZvcmUoaGlzdG9yeVJlY29yZC5oZWFkZXJzW2luZGV4XSwgb2JqLmhlYWRlckNvbnRhaW5lci5jaGlsZHJlbltpICsgMV0pO1xyXG4gICAgICAgICAgICAgICAgICAgIG9iai5jb2xncm91cENvbnRhaW5lci5pbnNlcnRCZWZvcmUoaGlzdG9yeVJlY29yZC5jb2xncm91cFtpbmRleF0sIG9iai5jb2xncm91cENvbnRhaW5lci5jaGlsZHJlbltpICsgMV0pO1xyXG4gICAgICAgICAgICAgICAgICAgIGluZGV4Kys7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBoaXN0b3J5UmVjb3JkLmRhdGEubGVuZ3RoOyBqKyspIHtcclxuICAgICAgICAgICAgICAgICAgICBvYmoub3B0aW9ucy5kYXRhW2pdID0gamV4Y2VsLmluamVjdEFycmF5KG9iai5vcHRpb25zLmRhdGFbal0sIGNvbHVtbkluZGV4LCBoaXN0b3J5UmVjb3JkLmRhdGFbal0pO1xyXG4gICAgICAgICAgICAgICAgICAgIG9iai5yZWNvcmRzW2pdID0gamV4Y2VsLmluamVjdEFycmF5KG9iai5yZWNvcmRzW2pdLCBjb2x1bW5JbmRleCwgaGlzdG9yeVJlY29yZC5yZWNvcmRzW2pdKTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgaW5kZXggPSAwXHJcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IGNvbHVtbkluZGV4OyBpIDwgKGhpc3RvcnlSZWNvcmQubnVtT2ZDb2x1bW5zICsgY29sdW1uSW5kZXgpOyBpKyspIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgb2JqLnJvd3Nbal0uaW5zZXJ0QmVmb3JlKGhpc3RvcnlSZWNvcmQucmVjb3Jkc1tqXVtpbmRleF0sIG9iai5yb3dzW2pdLmNoaWxkcmVuW2kgKyAxXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGluZGV4Kys7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgLy8gUHJvY2VzcyBmb290ZXJzXHJcbiAgICAgICAgICAgICAgICBpZiAob2JqLm9wdGlvbnMuZm9vdGVycykge1xyXG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgb2JqLm9wdGlvbnMuZm9vdGVycy5sZW5ndGg7IGorKykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBvYmoub3B0aW9ucy5mb290ZXJzW2pdID0gamV4Y2VsLmluamVjdEFycmF5KG9iai5vcHRpb25zLmZvb3RlcnNbal0sIGNvbHVtbkluZGV4LCBoaXN0b3J5UmVjb3JkLmZvb3RlcnNbal0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gQWRqdXN0IG5lc3RlZCBoZWFkZXJzXHJcbiAgICAgICAgICAgIGlmIChvYmoub3B0aW9ucy5uZXN0ZWRIZWFkZXJzICYmIG9iai5vcHRpb25zLm5lc3RlZEhlYWRlcnMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICAgICAgLy8gRmxleGlibGUgd2F5IHRvIGhhbmRsZSBuZXN0ZWRoZWFkZXJzXHJcbiAgICAgICAgICAgICAgICBpZiAob2JqLm9wdGlvbnMubmVzdGVkSGVhZGVyc1swXSAmJiBvYmoub3B0aW9ucy5uZXN0ZWRIZWFkZXJzWzBdWzBdKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBvYmoub3B0aW9ucy5uZXN0ZWRIZWFkZXJzLmxlbmd0aDsgaisrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0eXBlID09IDEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjb2xzcGFuID0gcGFyc2VJbnQob2JqLm9wdGlvbnMubmVzdGVkSGVhZGVyc1tqXVtvYmoub3B0aW9ucy5uZXN0ZWRIZWFkZXJzW2pdLmxlbmd0aCAtIDFdLmNvbHNwYW4pIC0gaGlzdG9yeVJlY29yZC5udW1PZkNvbHVtbnM7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgY29sc3BhbiA9IHBhcnNlSW50KG9iai5vcHRpb25zLm5lc3RlZEhlYWRlcnNbal1bb2JqLm9wdGlvbnMubmVzdGVkSGVhZGVyc1tqXS5sZW5ndGggLSAxXS5jb2xzcGFuKSArIGhpc3RvcnlSZWNvcmQubnVtT2ZDb2x1bW5zO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9iai5vcHRpb25zLm5lc3RlZEhlYWRlcnNbal1bb2JqLm9wdGlvbnMubmVzdGVkSGVhZGVyc1tqXS5sZW5ndGggLSAxXS5jb2xzcGFuID0gY29sc3BhbjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgb2JqLnRoZWFkLmNoaWxkcmVuW2pdLmNoaWxkcmVuW29iai50aGVhZC5jaGlsZHJlbltqXS5jaGlsZHJlbi5sZW5ndGggLSAxXS5zZXRBdHRyaWJ1dGUoJ2NvbHNwYW4nLCBjb2xzcGFuKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0eXBlID09IDEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNvbHNwYW4gPSBwYXJzZUludChvYmoub3B0aW9ucy5uZXN0ZWRIZWFkZXJzWzBdLmNvbHNwYW4pIC0gaGlzdG9yeVJlY29yZC5udW1PZkNvbHVtbnM7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNvbHNwYW4gPSBwYXJzZUludChvYmoub3B0aW9ucy5uZXN0ZWRIZWFkZXJzWzBdLmNvbHNwYW4pICsgaGlzdG9yeVJlY29yZC5udW1PZkNvbHVtbnM7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIG9iai5vcHRpb25zLm5lc3RlZEhlYWRlcnNbMF0uY29sc3BhbiA9IGNvbHNwYW47XHJcbiAgICAgICAgICAgICAgICAgICAgb2JqLnRoZWFkLmNoaWxkcmVuWzBdLmNoaWxkcmVuW29iai50aGVhZC5jaGlsZHJlblswXS5jaGlsZHJlbi5sZW5ndGggLSAxXS5zZXRBdHRyaWJ1dGUoJ2NvbHNwYW4nLCBjb2xzcGFuKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgb2JqLnVwZGF0ZVRhYmxlUmVmZXJlbmNlcygpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogVW5kbyBsYXN0IGFjdGlvblxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIG9iai51bmRvID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAvLyBJZ25vcmUgZXZlbnRzIGFuZCBoaXN0b3J5XHJcbiAgICAgICAgICAgIHZhciBpZ25vcmVFdmVudHMgPSBvYmouaWdub3JlRXZlbnRzID8gdHJ1ZSA6IGZhbHNlO1xyXG4gICAgICAgICAgICB2YXIgaWdub3JlSGlzdG9yeSA9IG9iai5pZ25vcmVIaXN0b3J5ID8gdHJ1ZSA6IGZhbHNlO1xyXG5cclxuICAgICAgICAgICAgb2JqLmlnbm9yZUV2ZW50cyA9IHRydWU7XHJcbiAgICAgICAgICAgIG9iai5pZ25vcmVIaXN0b3J5ID0gdHJ1ZTtcclxuXHJcbiAgICAgICAgICAgIC8vIFJlY29yZHNcclxuICAgICAgICAgICAgdmFyIHJlY29yZHMgPSBbXTtcclxuXHJcbiAgICAgICAgICAgIC8vIFVwZGF0ZSBjZWxsc1xyXG4gICAgICAgICAgICBpZiAob2JqLmhpc3RvcnlJbmRleCA+PSAwKSB7XHJcbiAgICAgICAgICAgICAgICAvLyBIaXN0b3J5XHJcbiAgICAgICAgICAgICAgICB2YXIgaGlzdG9yeVJlY29yZCA9IG9iai5oaXN0b3J5W29iai5oaXN0b3J5SW5kZXgtLV07XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKGhpc3RvcnlSZWNvcmQuYWN0aW9uID09ICdpbnNlcnRSb3cnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgb2JqLmhpc3RvcnlQcm9jZXNzUm93KDEsIGhpc3RvcnlSZWNvcmQpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChoaXN0b3J5UmVjb3JkLmFjdGlvbiA9PSAnZGVsZXRlUm93Jykge1xyXG4gICAgICAgICAgICAgICAgICAgIG9iai5oaXN0b3J5UHJvY2Vzc1JvdygwLCBoaXN0b3J5UmVjb3JkKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoaGlzdG9yeVJlY29yZC5hY3Rpb24gPT0gJ2luc2VydENvbHVtbicpIHtcclxuICAgICAgICAgICAgICAgICAgICBvYmouaGlzdG9yeVByb2Nlc3NDb2x1bW4oMSwgaGlzdG9yeVJlY29yZCk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGhpc3RvcnlSZWNvcmQuYWN0aW9uID09ICdkZWxldGVDb2x1bW4nKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgb2JqLmhpc3RvcnlQcm9jZXNzQ29sdW1uKDAsIGhpc3RvcnlSZWNvcmQpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChoaXN0b3J5UmVjb3JkLmFjdGlvbiA9PSAnbW92ZVJvdycpIHtcclxuICAgICAgICAgICAgICAgICAgICBvYmoubW92ZVJvdyhoaXN0b3J5UmVjb3JkLm5ld1ZhbHVlLCBoaXN0b3J5UmVjb3JkLm9sZFZhbHVlKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoaGlzdG9yeVJlY29yZC5hY3Rpb24gPT0gJ21vdmVDb2x1bW4nKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgb2JqLm1vdmVDb2x1bW4oaGlzdG9yeVJlY29yZC5uZXdWYWx1ZSwgaGlzdG9yeVJlY29yZC5vbGRWYWx1ZSk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGhpc3RvcnlSZWNvcmQuYWN0aW9uID09ICdzZXRNZXJnZScpIHtcclxuICAgICAgICAgICAgICAgICAgICBvYmoucmVtb3ZlTWVyZ2UoaGlzdG9yeVJlY29yZC5jb2x1bW4sIGhpc3RvcnlSZWNvcmQuZGF0YSk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGhpc3RvcnlSZWNvcmQuYWN0aW9uID09ICdzZXRTdHlsZScpIHtcclxuICAgICAgICAgICAgICAgICAgICBvYmouc2V0U3R5bGUoaGlzdG9yeVJlY29yZC5vbGRWYWx1ZSwgbnVsbCwgbnVsbCwgMSk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGhpc3RvcnlSZWNvcmQuYWN0aW9uID09ICdzZXRXaWR0aCcpIHtcclxuICAgICAgICAgICAgICAgICAgICBvYmouc2V0V2lkdGgoaGlzdG9yeVJlY29yZC5jb2x1bW4sIGhpc3RvcnlSZWNvcmQub2xkVmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChoaXN0b3J5UmVjb3JkLmFjdGlvbiA9PSAnc2V0SGVpZ2h0Jykge1xyXG4gICAgICAgICAgICAgICAgICAgIG9iai5zZXRIZWlnaHQoaGlzdG9yeVJlY29yZC5yb3csIGhpc3RvcnlSZWNvcmQub2xkVmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChoaXN0b3J5UmVjb3JkLmFjdGlvbiA9PSAnc2V0SGVhZGVyJykge1xyXG4gICAgICAgICAgICAgICAgICAgIG9iai5zZXRIZWFkZXIoaGlzdG9yeVJlY29yZC5jb2x1bW4sIGhpc3RvcnlSZWNvcmQub2xkVmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChoaXN0b3J5UmVjb3JkLmFjdGlvbiA9PSAnc2V0Q29tbWVudHMnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgb2JqLnNldENvbW1lbnRzKGhpc3RvcnlSZWNvcmQuY29sdW1uLCBoaXN0b3J5UmVjb3JkLm9sZFZhbHVlWzBdLCBoaXN0b3J5UmVjb3JkLm9sZFZhbHVlWzFdKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoaGlzdG9yeVJlY29yZC5hY3Rpb24gPT0gJ29yZGVyQnknKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHJvd3MgPSBbXTtcclxuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IGhpc3RvcnlSZWNvcmQucm93cy5sZW5ndGg7IGorKykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByb3dzW2hpc3RvcnlSZWNvcmQucm93c1tqXV0gPSBqO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBvYmoudXBkYXRlT3JkZXJBcnJvdyhoaXN0b3J5UmVjb3JkLmNvbHVtbiwgaGlzdG9yeVJlY29yZC5vcmRlciA/IDAgOiAxKTtcclxuICAgICAgICAgICAgICAgICAgICBvYmoudXBkYXRlT3JkZXIocm93cyk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGhpc3RvcnlSZWNvcmQuYWN0aW9uID09ICdzZXRWYWx1ZScpIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBSZWRvIGZvciBjaGFuZ2VzIGluIGNlbGxzXHJcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBoaXN0b3J5UmVjb3JkLnJlY29yZHMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVjb3Jkcy5wdXNoKHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHg6IGhpc3RvcnlSZWNvcmQucmVjb3Jkc1tpXS54LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgeTogaGlzdG9yeVJlY29yZC5yZWNvcmRzW2ldLnksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXdWYWx1ZTogaGlzdG9yeVJlY29yZC5yZWNvcmRzW2ldLm9sZFZhbHVlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChoaXN0b3J5UmVjb3JkLm9sZFN0eWxlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmoucmVzZXRTdHlsZShoaXN0b3J5UmVjb3JkLm9sZFN0eWxlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAvLyBVcGRhdGUgcmVjb3Jkc1xyXG4gICAgICAgICAgICAgICAgICAgIG9iai5zZXRWYWx1ZShyZWNvcmRzKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgLy8gVXBkYXRlIHNlbGVjdGlvblxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChoaXN0b3J5UmVjb3JkLnNlbGVjdGlvbikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBvYmoudXBkYXRlU2VsZWN0aW9uRnJvbUNvb3JkcyhoaXN0b3J5UmVjb3JkLnNlbGVjdGlvblswXSwgaGlzdG9yeVJlY29yZC5zZWxlY3Rpb25bMV0sIGhpc3RvcnlSZWNvcmQuc2VsZWN0aW9uWzJdLCBoaXN0b3J5UmVjb3JkLnNlbGVjdGlvblszXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIG9iai5pZ25vcmVFdmVudHMgPSBpZ25vcmVFdmVudHM7XHJcbiAgICAgICAgICAgIG9iai5pZ25vcmVIaXN0b3J5ID0gaWdub3JlSGlzdG9yeTtcclxuXHJcbiAgICAgICAgICAgIC8vIEV2ZW50c1xyXG4gICAgICAgICAgICBvYmouZGlzcGF0Y2goJ29udW5kbycsIGVsLCBoaXN0b3J5UmVjb3JkKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIFJlZG8gcHJldmlvdXNseSB1bmRvbmUgYWN0aW9uXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgb2JqLnJlZG8gPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIC8vIElnbm9yZSBldmVudHMgYW5kIGhpc3RvcnlcclxuICAgICAgICAgICAgdmFyIGlnbm9yZUV2ZW50cyA9IG9iai5pZ25vcmVFdmVudHMgPyB0cnVlIDogZmFsc2U7XHJcbiAgICAgICAgICAgIHZhciBpZ25vcmVIaXN0b3J5ID0gb2JqLmlnbm9yZUhpc3RvcnkgPyB0cnVlIDogZmFsc2U7XHJcblxyXG4gICAgICAgICAgICBvYmouaWdub3JlRXZlbnRzID0gdHJ1ZTtcclxuICAgICAgICAgICAgb2JqLmlnbm9yZUhpc3RvcnkgPSB0cnVlO1xyXG5cclxuICAgICAgICAgICAgLy8gUmVjb3Jkc1xyXG4gICAgICAgICAgICB2YXIgcmVjb3JkcyA9IFtdO1xyXG5cclxuICAgICAgICAgICAgLy8gVXBkYXRlIGNlbGxzXHJcbiAgICAgICAgICAgIGlmIChvYmouaGlzdG9yeUluZGV4IDwgb2JqLmhpc3RvcnkubGVuZ3RoIC0gMSkge1xyXG4gICAgICAgICAgICAgICAgLy8gSGlzdG9yeVxyXG4gICAgICAgICAgICAgICAgdmFyIGhpc3RvcnlSZWNvcmQgPSBvYmouaGlzdG9yeVsrK29iai5oaXN0b3J5SW5kZXhdO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmIChoaXN0b3J5UmVjb3JkLmFjdGlvbiA9PSAnaW5zZXJ0Um93Jykge1xyXG4gICAgICAgICAgICAgICAgICAgIG9iai5oaXN0b3J5UHJvY2Vzc1JvdygwLCBoaXN0b3J5UmVjb3JkKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoaGlzdG9yeVJlY29yZC5hY3Rpb24gPT0gJ2RlbGV0ZVJvdycpIHtcclxuICAgICAgICAgICAgICAgICAgICBvYmouaGlzdG9yeVByb2Nlc3NSb3coMSwgaGlzdG9yeVJlY29yZCk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGhpc3RvcnlSZWNvcmQuYWN0aW9uID09ICdpbnNlcnRDb2x1bW4nKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgb2JqLmhpc3RvcnlQcm9jZXNzQ29sdW1uKDAsIGhpc3RvcnlSZWNvcmQpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChoaXN0b3J5UmVjb3JkLmFjdGlvbiA9PSAnZGVsZXRlQ29sdW1uJykge1xyXG4gICAgICAgICAgICAgICAgICAgIG9iai5oaXN0b3J5UHJvY2Vzc0NvbHVtbigxLCBoaXN0b3J5UmVjb3JkKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoaGlzdG9yeVJlY29yZC5hY3Rpb24gPT0gJ21vdmVSb3cnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgb2JqLm1vdmVSb3coaGlzdG9yeVJlY29yZC5vbGRWYWx1ZSwgaGlzdG9yeVJlY29yZC5uZXdWYWx1ZSk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGhpc3RvcnlSZWNvcmQuYWN0aW9uID09ICdtb3ZlQ29sdW1uJykge1xyXG4gICAgICAgICAgICAgICAgICAgIG9iai5tb3ZlQ29sdW1uKGhpc3RvcnlSZWNvcmQub2xkVmFsdWUsIGhpc3RvcnlSZWNvcmQubmV3VmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChoaXN0b3J5UmVjb3JkLmFjdGlvbiA9PSAnc2V0TWVyZ2UnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgb2JqLnNldE1lcmdlKGhpc3RvcnlSZWNvcmQuY29sdW1uLCBoaXN0b3J5UmVjb3JkLmNvbHNwYW4sIGhpc3RvcnlSZWNvcmQucm93c3BhbiwgMSk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGhpc3RvcnlSZWNvcmQuYWN0aW9uID09ICdzZXRTdHlsZScpIHtcclxuICAgICAgICAgICAgICAgICAgICBvYmouc2V0U3R5bGUoaGlzdG9yeVJlY29yZC5uZXdWYWx1ZSwgbnVsbCwgbnVsbCwgMSk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGhpc3RvcnlSZWNvcmQuYWN0aW9uID09ICdzZXRXaWR0aCcpIHtcclxuICAgICAgICAgICAgICAgICAgICBvYmouc2V0V2lkdGgoaGlzdG9yeVJlY29yZC5jb2x1bW4sIGhpc3RvcnlSZWNvcmQubmV3VmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChoaXN0b3J5UmVjb3JkLmFjdGlvbiA9PSAnc2V0SGVpZ2h0Jykge1xyXG4gICAgICAgICAgICAgICAgICAgIG9iai5zZXRIZWlnaHQoaGlzdG9yeVJlY29yZC5yb3csIGhpc3RvcnlSZWNvcmQubmV3VmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChoaXN0b3J5UmVjb3JkLmFjdGlvbiA9PSAnc2V0SGVhZGVyJykge1xyXG4gICAgICAgICAgICAgICAgICAgIG9iai5zZXRIZWFkZXIoaGlzdG9yeVJlY29yZC5jb2x1bW4sIGhpc3RvcnlSZWNvcmQubmV3VmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChoaXN0b3J5UmVjb3JkLmFjdGlvbiA9PSAnc2V0Q29tbWVudHMnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgb2JqLnNldENvbW1lbnRzKGhpc3RvcnlSZWNvcmQuY29sdW1uLCBoaXN0b3J5UmVjb3JkLm5ld1ZhbHVlWzBdLCBoaXN0b3J5UmVjb3JkLm5ld1ZhbHVlWzFdKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoaGlzdG9yeVJlY29yZC5hY3Rpb24gPT0gJ29yZGVyQnknKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgb2JqLnVwZGF0ZU9yZGVyQXJyb3coaGlzdG9yeVJlY29yZC5jb2x1bW4sIGhpc3RvcnlSZWNvcmQub3JkZXIpO1xyXG4gICAgICAgICAgICAgICAgICAgIG9iai51cGRhdGVPcmRlcihoaXN0b3J5UmVjb3JkLnJvd3MpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChoaXN0b3J5UmVjb3JkLmFjdGlvbiA9PSAnc2V0VmFsdWUnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgb2JqLnNldFZhbHVlKGhpc3RvcnlSZWNvcmQucmVjb3Jkcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gUmVkbyBmb3IgY2hhbmdlcyBpbiBjZWxsc1xyXG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgaGlzdG9yeVJlY29yZC5yZWNvcmRzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChoaXN0b3J5UmVjb3JkLm9sZFN0eWxlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmoucmVzZXRTdHlsZShoaXN0b3J5UmVjb3JkLm5ld1N0eWxlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAvLyBVcGRhdGUgc2VsZWN0aW9uXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGhpc3RvcnlSZWNvcmQuc2VsZWN0aW9uKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9iai51cGRhdGVTZWxlY3Rpb25Gcm9tQ29vcmRzKGhpc3RvcnlSZWNvcmQuc2VsZWN0aW9uWzBdLCBoaXN0b3J5UmVjb3JkLnNlbGVjdGlvblsxXSwgaGlzdG9yeVJlY29yZC5zZWxlY3Rpb25bMl0sIGhpc3RvcnlSZWNvcmQuc2VsZWN0aW9uWzNdKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgb2JqLmlnbm9yZUV2ZW50cyA9IGlnbm9yZUV2ZW50cztcclxuICAgICAgICAgICAgb2JqLmlnbm9yZUhpc3RvcnkgPSBpZ25vcmVIaXN0b3J5O1xyXG5cclxuICAgICAgICAgICAgLy8gRXZlbnRzXHJcbiAgICAgICAgICAgIG9iai5kaXNwYXRjaCgnb25yZWRvJywgZWwsIGhpc3RvcnlSZWNvcmQpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogR2V0IGRyb3Bkb3duIHZhbHVlIGZyb20ga2V5XHJcbiAgICAgICAgICovXHJcbiAgICAgICAgb2JqLmdldERyb3BEb3duVmFsdWUgPSBmdW5jdGlvbiAoY29sdW1uLCBrZXksIHksIGNlbGwpIHtcclxuICAgICAgICAgICAgdmFyIHZhbHVlID0gW107XHJcblxyXG4gICAgICAgICAgICBpZiAob2JqLm9wdGlvbnMuY29sdW1uc1tjb2x1bW5dICYmIG9iai5vcHRpb25zLmNvbHVtbnNbY29sdW1uXS5zb3VyY2UpIHtcclxuICAgICAgICAgICAgICAgIGlmICh0eXBlb2Ygb2JqLm9wdGlvbnMuY29sdW1uc1tjb2x1bW5dLmZpbHRlciA9PT0gJ2Z1bmN0aW9uJykge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBzb3VyY2UgPSBvYmoub3B0aW9ucy5jb2x1bW5zW2NvbHVtbl0uZmlsdGVyKGVsLCBjZWxsLCBjb2x1bW4sIHksIG9iaik7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBzb3VyY2UgPSBvYmoub3B0aW9ucy5jb2x1bW5zW2NvbHVtbl0uc291cmNlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgLy8gQ3JlYXRlIGFycmF5IGZyb20gc291cmNlXHJcbiAgICAgICAgICAgICAgICB2YXIgY29tYm8gPSBbXTtcclxuXHJcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHNvdXJjZS5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgKHNvdXJjZVtpXSkgPT0gJ29iamVjdCcpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29tYm9bc291cmNlW2ldLmlkXSA9IHNvdXJjZVtpXS5uYW1lO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbWJvW3NvdXJjZVtpXV0gPSBzb3VyY2VbaV07XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIC8vIEd1YXJhbnRlZSBzaW5nbGUgbXVsdGlwbGUgY29tcGF0aWJpbGl0eVxyXG4gICAgICAgICAgICAgICAgdmFyIGtleXMgPSBBcnJheS5pc0FycmF5KGtleSkgPyBrZXkgOiAoJycgKyBrZXkpLnNwbGl0KCc7Jyk7XHJcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGtleXMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIChrZXlzW2ldKSA9PT0gJ29iamVjdCcpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUucHVzaChjb21ib1trZXlzW2ldLmlkXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNvbWJvW2tleXNbaV1dKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZS5wdXNoKGNvbWJvW2tleXNbaV1dKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0ludmFsaWQgY29sdW1uJyk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHJldHVybiAodmFsdWUubGVuZ3RoID4gMCkgPyB2YWx1ZS5qb2luKCc7ICcpIDogJyc7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvKipcclxuICAgICAgICAgKiBGcm9tIHN0YXJja292ZXJmbG93IGNvbnRyaWJ1dGlvbnNcclxuICAgICAgICAgKi9cclxuICAgICAgICBvYmoucGFyc2VDU1YgPSBmdW5jdGlvbiAoc3RyLCBkZWxpbWl0ZXIpIHtcclxuICAgICAgICAgICAgLy8gUmVtb3ZlIGxhc3QgbGluZSBicmVha1xyXG4gICAgICAgICAgICBzdHIgPSBzdHIucmVwbGFjZSgvXFxyP1xcbiR8XFxyJHxcXG4kL2csIFwiXCIpO1xyXG4gICAgICAgICAgICAvLyBMYXN0IGNhcmFjdGVyIGlzIHRoZSBkZWxpbWl0ZXJcclxuICAgICAgICAgICAgaWYgKHN0ci5jaGFyQ29kZUF0KHN0ci5sZW5ndGggLSAxKSA9PSA5KSB7XHJcbiAgICAgICAgICAgICAgICBzdHIgKz0gXCJcXDBcIjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAvLyB1c2VyLXN1cHBsaWVkIGRlbGltZXRlciBvciBkZWZhdWx0IGNvbW1hXHJcbiAgICAgICAgICAgIGRlbGltaXRlciA9IChkZWxpbWl0ZXIgfHwgXCIsXCIpO1xyXG5cclxuICAgICAgICAgICAgdmFyIGFyciA9IFtdO1xyXG4gICAgICAgICAgICB2YXIgcXVvdGUgPSBmYWxzZTsgIC8vIHRydWUgbWVhbnMgd2UncmUgaW5zaWRlIGEgcXVvdGVkIGZpZWxkXHJcbiAgICAgICAgICAgIC8vIGl0ZXJhdGUgb3ZlciBlYWNoIGNoYXJhY3Rlciwga2VlcCB0cmFjayBvZiBjdXJyZW50IHJvdyBhbmQgY29sdW1uIChvZiB0aGUgcmV0dXJuZWQgYXJyYXkpXHJcbiAgICAgICAgICAgIGZvciAodmFyIHJvdyA9IDAsIGNvbCA9IDAsIGMgPSAwOyBjIDwgc3RyLmxlbmd0aDsgYysrKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgY2MgPSBzdHJbY10sIG5jID0gc3RyW2MgKyAxXTtcclxuICAgICAgICAgICAgICAgIGFycltyb3ddID0gYXJyW3Jvd10gfHwgW107XHJcbiAgICAgICAgICAgICAgICBhcnJbcm93XVtjb2xdID0gYXJyW3Jvd11bY29sXSB8fCAnJztcclxuXHJcbiAgICAgICAgICAgICAgICAvLyBJZiB0aGUgY3VycmVudCBjaGFyYWN0ZXIgaXMgYSBxdW90YXRpb24gbWFyaywgYW5kIHdlJ3JlIGluc2lkZSBhIHF1b3RlZCBmaWVsZCwgYW5kIHRoZSBuZXh0IGNoYXJhY3RlciBpcyBhbHNvIGEgcXVvdGF0aW9uIG1hcmssIGFkZCBhIHF1b3RhdGlvbiBtYXJrIHRvIHRoZSBjdXJyZW50IGNvbHVtbiBhbmQgc2tpcCB0aGUgbmV4dCBjaGFyYWN0ZXJcclxuICAgICAgICAgICAgICAgIGlmIChjYyA9PSAnXCInICYmIHF1b3RlICYmIG5jID09ICdcIicpIHtcclxuICAgICAgICAgICAgICAgICAgICBhcnJbcm93XVtjb2xdICs9IGNjO1xyXG4gICAgICAgICAgICAgICAgICAgICsrYztcclxuICAgICAgICAgICAgICAgICAgICBjb250aW51ZTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAvLyBJZiBpdCdzIGp1c3Qgb25lIHF1b3RhdGlvbiBtYXJrLCBiZWdpbi9lbmQgcXVvdGVkIGZpZWxkXHJcbiAgICAgICAgICAgICAgICBpZiAoY2MgPT0gJ1wiJykge1xyXG4gICAgICAgICAgICAgICAgICAgIHF1b3RlID0gIXF1b3RlO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIC8vIElmIGl0J3MgYSBjb21tYSBhbmQgd2UncmUgbm90IGluIGEgcXVvdGVkIGZpZWxkLCBtb3ZlIG9uIHRvIHRoZSBuZXh0IGNvbHVtblxyXG4gICAgICAgICAgICAgICAgaWYgKGNjID09IGRlbGltaXRlciAmJiAhcXVvdGUpIHtcclxuICAgICAgICAgICAgICAgICAgICArK2NvbDtcclxuICAgICAgICAgICAgICAgICAgICBjb250aW51ZTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAvLyBJZiBpdCdzIGEgbmV3bGluZSAoQ1JMRikgYW5kIHdlJ3JlIG5vdCBpbiBhIHF1b3RlZCBmaWVsZCwgc2tpcCB0aGUgbmV4dCBjaGFyYWN0ZXIgYW5kIG1vdmUgb24gdG8gdGhlIG5leHQgcm93IGFuZCBtb3ZlIHRvIGNvbHVtbiAwIG9mIHRoYXQgbmV3IHJvd1xyXG4gICAgICAgICAgICAgICAgaWYgKGNjID09ICdcXHInICYmIG5jID09ICdcXG4nICYmICFxdW90ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICsrcm93O1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbCA9IDA7XHJcbiAgICAgICAgICAgICAgICAgICAgKytjO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIC8vIElmIGl0J3MgYSBuZXdsaW5lIChMRiBvciBDUikgYW5kIHdlJ3JlIG5vdCBpbiBhIHF1b3RlZCBmaWVsZCwgbW92ZSBvbiB0byB0aGUgbmV4dCByb3cgYW5kIG1vdmUgdG8gY29sdW1uIDAgb2YgdGhhdCBuZXcgcm93XHJcbiAgICAgICAgICAgICAgICBpZiAoY2MgPT0gJ1xcbicgJiYgIXF1b3RlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgKytyb3c7XHJcbiAgICAgICAgICAgICAgICAgICAgY29sID0gMDtcclxuICAgICAgICAgICAgICAgICAgICBjb250aW51ZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmIChjYyA9PSAnXFxyJyAmJiAhcXVvdGUpIHtcclxuICAgICAgICAgICAgICAgICAgICArK3JvdztcclxuICAgICAgICAgICAgICAgICAgICBjb2wgPSAwO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIC8vIE90aGVyd2lzZSwgYXBwZW5kIHRoZSBjdXJyZW50IGNoYXJhY3RlciB0byB0aGUgY3VycmVudCBjb2x1bW5cclxuICAgICAgICAgICAgICAgIGFycltyb3ddW2NvbF0gKz0gY2M7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIGFycjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIG9iai5oYXNoID0gZnVuY3Rpb24gKHN0cikge1xyXG4gICAgICAgICAgICB2YXIgaGFzaCA9IDAsIGksIGNocjtcclxuXHJcbiAgICAgICAgICAgIGlmIChzdHIubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gaGFzaDtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBzdHIubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgICAgICBjaHIgPSBzdHIuY2hhckNvZGVBdChpKTtcclxuICAgICAgICAgICAgICAgICAgICBoYXNoID0gKChoYXNoIDw8IDUpIC0gaGFzaCkgKyBjaHI7XHJcbiAgICAgICAgICAgICAgICAgICAgaGFzaCB8PSAwO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBoYXNoO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgb2JqLm9uYWZ0ZXJjaGFuZ2VzID0gZnVuY3Rpb24gKGVsLCByZWNvcmRzKSB7XHJcbiAgICAgICAgICAgIC8vIEV2ZW50c1xyXG4gICAgICAgICAgICBvYmouZGlzcGF0Y2goJ29uYWZ0ZXJjaGFuZ2VzJywgZWwsIHJlY29yZHMpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgb2JqLmRlc3Ryb3kgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIGpleGNlbC5kZXN0cm95KGVsKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIEluaXRpYWxpemF0aW9uIG1ldGhvZFxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIG9iai5pbml0ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBqZXhjZWwuY3VycmVudCA9IG9iajtcclxuXHJcbiAgICAgICAgICAgIC8vIEJ1aWxkIGhhbmRsZXJzXHJcbiAgICAgICAgICAgIGlmICh0eXBlb2YgKGpleGNlbC5idWlsZCkgPT0gJ2Z1bmN0aW9uJykge1xyXG4gICAgICAgICAgICAgICAgaWYgKG9iai5vcHRpb25zLnJvb3QpIHtcclxuICAgICAgICAgICAgICAgICAgICBqZXhjZWwuYnVpbGQob2JqLm9wdGlvbnMucm9vdCk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGpleGNlbC5idWlsZChkb2N1bWVudCk7XHJcbiAgICAgICAgICAgICAgICAgICAgamV4Y2VsLmJ1aWxkID0gbnVsbDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gRXZlbnRcclxuICAgICAgICAgICAgZWwuc2V0QXR0cmlidXRlKCd0YWJpbmRleCcsIDEpO1xyXG4gICAgICAgICAgICBlbC5hZGRFdmVudExpc3RlbmVyKCdmb2N1cycsIGZ1bmN0aW9uIChlKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoamV4Y2VsLmN1cnJlbnQgJiYgIW9iai5zZWxlY3RlZENlbGwpIHtcclxuICAgICAgICAgICAgICAgICAgICBvYmoudXBkYXRlU2VsZWN0aW9uRnJvbUNvb3JkcygwLCAwLCAwLCAwKTtcclxuICAgICAgICAgICAgICAgICAgICBvYmoubGVmdCgpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIC8vIExvYWQgdGhlIHRhYmxlIGRhdGEgYmFzZWQgb24gYW4gQ1NWIGZpbGVcclxuICAgICAgICAgICAgaWYgKG9iai5vcHRpb25zLmNzdikge1xyXG4gICAgICAgICAgICAgICAgLy8gTG9hZGluZ1xyXG4gICAgICAgICAgICAgICAgaWYgKG9iai5vcHRpb25zLmxvYWRpbmdTcGluID09IHRydWUpIHtcclxuICAgICAgICAgICAgICAgICAgICBqU3VpdGVzLmxvYWRpbmcuc2hvdygpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIC8vIExvYWQgQ1NWIGZpbGVcclxuICAgICAgICAgICAgICAgIGpTdWl0ZXMuYWpheCh7XHJcbiAgICAgICAgICAgICAgICAgICAgdXJsOiBvYmoub3B0aW9ucy5jc3YsXHJcbiAgICAgICAgICAgICAgICAgICAgbWV0aG9kOiBvYmoub3B0aW9ucy5tZXRob2QsXHJcbiAgICAgICAgICAgICAgICAgICAgZGF0YTogb2JqLm9wdGlvbnMucmVxdWVzdFZhcmlhYmxlcyxcclxuICAgICAgICAgICAgICAgICAgICBkYXRhVHlwZTogJ3RleHQnLFxyXG4gICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChyZXN1bHQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gQ29udmVydCBkYXRhXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBuZXdEYXRhID0gb2JqLnBhcnNlQ1NWKHJlc3VsdCwgb2JqLm9wdGlvbnMuY3N2RGVsaW1pdGVyKVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gSGVhZGVyc1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAob2JqLm9wdGlvbnMuY3N2SGVhZGVycyA9PSB0cnVlICYmIG5ld0RhdGEubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGhlYWRlcnMgPSBuZXdEYXRhLnNoaWZ0KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGhlYWRlcnMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIW9iai5vcHRpb25zLmNvbHVtbnNbaV0pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb2JqLm9wdGlvbnMuY29sdW1uc1tpXSA9IHt0eXBlOiAndGV4dCcsIGFsaWduOiBvYmoub3B0aW9ucy5kZWZhdWx0Q29sQWxpZ24sIHdpZHRoOiBvYmoub3B0aW9ucy5kZWZhdWx0Q29sV2lkdGh9O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBQcmVjZWRlbmNlIG92ZXIgcHJlLWNvbmZpZ3VyYXRlZCB0aXRsZXNcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIG9iai5vcHRpb25zLmNvbHVtbnNbaV0udGl0bGUgPT09ICd1bmRlZmluZWQnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9iai5vcHRpb25zLmNvbHVtbnNbaV0udGl0bGUgPSBoZWFkZXJzW2ldO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBEYXRhXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9iai5vcHRpb25zLmRhdGEgPSBuZXdEYXRhO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBQcmVwYXJlIHRhYmxlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9iai5wcmVwYXJlVGFibGUoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gSGlkZSBzcGluXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChvYmoub3B0aW9ucy5sb2FkaW5nU3BpbiA9PSB0cnVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBqU3VpdGVzLmxvYWRpbmcuaGlkZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAob2JqLm9wdGlvbnMudXJsKSB7XHJcbiAgICAgICAgICAgICAgICAvLyBMb2FkaW5nXHJcbiAgICAgICAgICAgICAgICBpZiAob2JqLm9wdGlvbnMubG9hZGluZ1NwaW4gPT0gdHJ1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGpTdWl0ZXMubG9hZGluZy5zaG93KCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgalN1aXRlcy5hamF4KHtcclxuICAgICAgICAgICAgICAgICAgICB1cmw6IG9iai5vcHRpb25zLnVybCxcclxuICAgICAgICAgICAgICAgICAgICBtZXRob2Q6IG9iai5vcHRpb25zLm1ldGhvZCxcclxuICAgICAgICAgICAgICAgICAgICBkYXRhOiBvYmoub3B0aW9ucy5yZXF1ZXN0VmFyaWFibGVzLFxyXG4gICAgICAgICAgICAgICAgICAgIGRhdGFUeXBlOiAnanNvbicsXHJcbiAgICAgICAgICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24gKHJlc3VsdCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBEYXRhXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9iai5vcHRpb25zLmRhdGEgPSAocmVzdWx0LmRhdGEpID8gcmVzdWx0LmRhdGEgOiByZXN1bHQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFByZXBhcmUgdGFibGVcclxuICAgICAgICAgICAgICAgICAgICAgICAgb2JqLnByZXBhcmVUYWJsZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBIaWRlIHNwaW5cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG9iai5vcHRpb25zLmxvYWRpbmdTcGluID09IHRydWUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGpTdWl0ZXMubG9hZGluZy5oaWRlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIC8vIFByZXBhcmUgdGFibGVcclxuICAgICAgICAgICAgICAgIG9iai5wcmVwYXJlVGFibGUoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gQ29udGV4dCBtZW51XHJcbiAgICAgICAgaWYgKG9wdGlvbnMgJiYgb3B0aW9ucy5jb250ZXh0TWVudSAhPSBudWxsKSB7XHJcbiAgICAgICAgICAgIG9iai5vcHRpb25zLmNvbnRleHRNZW51ID0gb3B0aW9ucy5jb250ZXh0TWVudTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBvYmoub3B0aW9ucy5jb250ZXh0TWVudSA9IGZ1bmN0aW9uIChlbCwgeCwgeSwgZSkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGl0ZW1zID0gW107XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKG9wdGlvbnMgJiYgdHlwZW9mIG9wdGlvbnMuY29udGV4dE1lbnVJdGVtcyA9PT0gJ2Z1bmN0aW9uJykge1xyXG4gICAgICAgICAgICAgICAgICAgIGl0ZW1zID0gb3B0aW9ucy5jb250ZXh0TWVudUl0ZW1zKGl0ZW1zLCBlbCwgeCwgeSwgZSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKHkgPT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIEluc2VydCBhIG5ldyBjb2x1bW5cclxuICAgICAgICAgICAgICAgICAgICBpZiAob2JqLm9wdGlvbnMuYWxsb3dJbnNlcnRDb2x1bW4gPT0gdHJ1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpdGVtcy5wdXNoKHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlOiBvYmoub3B0aW9ucy50ZXh0Lmluc2VydEFOZXdDb2x1bW5CZWZvcmUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbmNsaWNrOiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb2JqLmluc2VydENvbHVtbigxLCBwYXJzZUludCh4KSwgMSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKG9iai5vcHRpb25zLmFsbG93SW5zZXJ0Q29sdW1uID09IHRydWUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaXRlbXMucHVzaCh7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aXRsZTogb2JqLm9wdGlvbnMudGV4dC5pbnNlcnRBTmV3Q29sdW1uQWZ0ZXIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbmNsaWNrOiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb2JqLmluc2VydENvbHVtbigxLCBwYXJzZUludCh4KSwgMCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgLy8gRGVsZXRlIGEgY29sdW1uXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKG9iai5vcHRpb25zLmFsbG93RGVsZXRlQ29sdW1uID09IHRydWUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaXRlbXMucHVzaCh7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aXRsZTogb2JqLm9wdGlvbnMudGV4dC5kZWxldGVTZWxlY3RlZENvbHVtbnMsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbmNsaWNrOiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb2JqLmRlbGV0ZUNvbHVtbihvYmouZ2V0U2VsZWN0ZWRDb2x1bW5zKCkubGVuZ3RoID8gdW5kZWZpbmVkIDogcGFyc2VJbnQoeCkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIC8vIFJlbmFtZSBjb2x1bW5cclxuICAgICAgICAgICAgICAgICAgICBpZiAob2JqLm9wdGlvbnMuYWxsb3dSZW5hbWVDb2x1bW4gPT0gdHJ1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpdGVtcy5wdXNoKHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlOiBvYmoub3B0aW9ucy50ZXh0LnJlbmFtZVRoaXNDb2x1bW4sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbmNsaWNrOiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb2JqLnNldEhlYWRlcih4KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAvLyBTb3J0aW5nXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKG9iai5vcHRpb25zLmNvbHVtblNvcnRpbmcgPT0gdHJ1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBMaW5lXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW1zLnB1c2goe3R5cGU6ICdsaW5lJ30pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgaXRlbXMucHVzaCh7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aXRsZTogb2JqLm9wdGlvbnMudGV4dC5vcmRlckFzY2VuZGluZyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uY2xpY2s6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmoub3JkZXJCeSh4LCAwKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW1zLnB1c2goe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6IG9iai5vcHRpb25zLnRleHQub3JkZXJEZXNjZW5kaW5nLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb25jbGljazogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9iai5vcmRlckJ5KHgsIDEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIEluc2VydCBuZXcgcm93XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKG9iai5vcHRpb25zLmFsbG93SW5zZXJ0Um93ID09IHRydWUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaXRlbXMucHVzaCh7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aXRsZTogb2JqLm9wdGlvbnMudGV4dC5pbnNlcnRBTmV3Um93QmVmb3JlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb25jbGljazogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9iai5pbnNlcnRSb3coMSwgcGFyc2VJbnQoeSksIDEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW1zLnB1c2goe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6IG9iai5vcHRpb25zLnRleHQuaW5zZXJ0QU5ld1Jvd0FmdGVyLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb25jbGljazogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9iai5pbnNlcnRSb3coMSwgcGFyc2VJbnQoeSkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChvYmoub3B0aW9ucy5hbGxvd0RlbGV0ZVJvdyA9PSB0cnVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW1zLnB1c2goe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6IG9iai5vcHRpb25zLnRleHQuZGVsZXRlU2VsZWN0ZWRSb3dzLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb25jbGljazogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9iai5kZWxldGVSb3cob2JqLmdldFNlbGVjdGVkUm93cygpLmxlbmd0aCA/IHVuZGVmaW5lZCA6IHBhcnNlSW50KHkpKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICBpZiAoeCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAob2JqLm9wdGlvbnMuYWxsb3dDb21tZW50cyA9PSB0cnVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtcy5wdXNoKHt0eXBlOiAnbGluZSd9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgdGl0bGUgPSBvYmoucmVjb3Jkc1t5XVt4XS5nZXRBdHRyaWJ1dGUoJ3RpdGxlJykgfHwgJyc7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaXRlbXMucHVzaCh7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6IHRpdGxlID8gb2JqLm9wdGlvbnMudGV4dC5lZGl0Q29tbWVudHMgOiBvYmoub3B0aW9ucy50ZXh0LmFkZENvbW1lbnRzLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uY2xpY2s6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNvbW1lbnQgPSBwcm9tcHQob2JqLm9wdGlvbnMudGV4dC5jb21tZW50cywgdGl0bGUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoY29tbWVudCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb2JqLnNldENvbW1lbnRzKFt4LCB5XSwgY29tbWVudCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodGl0bGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtcy5wdXNoKHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6IG9iai5vcHRpb25zLnRleHQuY2xlYXJDb21tZW50cyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb25jbGljazogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb2JqLnNldENvbW1lbnRzKFt4LCB5XSwgJycpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gTGluZVxyXG4gICAgICAgICAgICAgICAgaXRlbXMucHVzaCh7dHlwZTogJ2xpbmUnfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gQ29weVxyXG4gICAgICAgICAgICAgICAgaXRlbXMucHVzaCh7XHJcbiAgICAgICAgICAgICAgICAgICAgdGl0bGU6IG9iai5vcHRpb25zLnRleHQuY29weSxcclxuICAgICAgICAgICAgICAgICAgICBzaG9ydGN1dDogJ0N0cmwgKyBDJyxcclxuICAgICAgICAgICAgICAgICAgICBvbmNsaWNrOiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9iai5jb3B5KHRydWUpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIFBhc3RlXHJcbiAgICAgICAgICAgICAgICBpZiAobmF2aWdhdG9yICYmIG5hdmlnYXRvci5jbGlwYm9hcmQpIHtcclxuICAgICAgICAgICAgICAgICAgICBpdGVtcy5wdXNoKHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6IG9iai5vcHRpb25zLnRleHQucGFzdGUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNob3J0Y3V0OiAnQ3RybCArIFYnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBvbmNsaWNrOiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAob2JqLnNlbGVjdGVkQ2VsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hdmlnYXRvci5jbGlwYm9hcmQucmVhZFRleHQoKS50aGVuKGZ1bmN0aW9uICh0ZXh0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0ZXh0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBqZXhjZWwuY3VycmVudC5wYXN0ZShvYmouc2VsZWN0ZWRDZWxsWzBdLCBvYmouc2VsZWN0ZWRDZWxsWzFdLCB0ZXh0KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGpleGNlbC5jdXJyZW50LnBhc3RlKGpleGNlbC5jdXJyZW50LnNlbGVjdGVkQ2VsbCwgdGV4dCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIC8vIFNhdmVcclxuICAgICAgICAgICAgICAgIGlmIChvYmoub3B0aW9ucy5hbGxvd0V4cG9ydCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGl0ZW1zLnB1c2goe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aXRsZTogb2JqLm9wdGlvbnMudGV4dC5zYXZlQXMsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNob3J0Y3V0OiAnQ3RybCArIFMnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBvbmNsaWNrOiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmouZG93bmxvYWQoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIC8vIEFib3V0XHJcbiAgICAgICAgICAgICAgICBpZiAob2JqLm9wdGlvbnMuYWJvdXQpIHtcclxuICAgICAgICAgICAgICAgICAgICBpdGVtcy5wdXNoKHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6IG9iai5vcHRpb25zLnRleHQuYWJvdXQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9uY2xpY2s6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFsZXJ0KG9iai5vcHRpb25zLmFib3V0KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIHJldHVybiBpdGVtcztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgb2JqLnNjcm9sbENvbnRyb2xzID0gZnVuY3Rpb24gKGUpIHtcclxuICAgICAgICAgICAgb2JqLmRpc3BhdGNoKCdvbnNjcm9sbCcsIGVsKTtcclxuXHJcbiAgICAgICAgICAgIG9iai53aGVlbENvbnRyb2xzKCk7XHJcbiAgICAgICAgICAgIGlmIChvYmoub3B0aW9ucy5mcmVlemVDb2x1bW5zID4gMCAmJiBvYmouY29udGVudC5zY3JvbGxMZWZ0ICE9IHNjcm9sbExlZnQpIHtcclxuICAgICAgICAgICAgICAgIG9iai51cGRhdGVGcmVlemVQb3NpdGlvbigpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBDbG9zZSBlZGl0b3JcclxuICAgICAgICAgICAgaWYgKG9iai5vcHRpb25zLmxhenlMb2FkaW5nID09IHRydWUgfHwgb2JqLm9wdGlvbnMudGFibGVPdmVyZmxvdyA9PSB0cnVlKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAob2JqLmVkaXRpb24gJiYgZS50YXJnZXQuY2xhc3NOYW1lLnN1YnN0cigwLCA5KSAhPSAnamRyb3Bkb3duJykge1xyXG4gICAgICAgICAgICAgICAgICAgIG9iai5jbG9zZUVkaXRvcihvYmouZWRpdGlvblswXSwgdHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIG9iai53aGVlbENvbnRyb2xzID0gZnVuY3Rpb24gKGUpIHtcclxuICAgICAgICAgICAgaWYgKG9iai5vcHRpb25zLmxhenlMb2FkaW5nID09IHRydWUpIHtcclxuICAgICAgICAgICAgICAgIGlmIChqZXhjZWwudGltZUNvbnRyb2xMb2FkaW5nID09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgICAgICBqZXhjZWwudGltZUNvbnRyb2xMb2FkaW5nID0gc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChvYmouY29udGVudC5zY3JvbGxUb3AgKyBvYmouY29udGVudC5jbGllbnRIZWlnaHQgPj0gb2JqLmNvbnRlbnQuc2Nyb2xsSGVpZ2h0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAob2JqLmxvYWREb3duKCkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAob2JqLmNvbnRlbnQuc2Nyb2xsVG9wICsgb2JqLmNvbnRlbnQuY2xpZW50SGVpZ2h0ID4gb2JqLmNvbnRlbnQuc2Nyb2xsSGVpZ2h0IC0gMTApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb2JqLmNvbnRlbnQuc2Nyb2xsVG9wID0gb2JqLmNvbnRlbnQuc2Nyb2xsVG9wIC0gb2JqLmNvbnRlbnQuY2xpZW50SGVpZ2h0O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmoudXBkYXRlQ29ybmVyUG9zaXRpb24oKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChvYmouY29udGVudC5zY3JvbGxUb3AgPD0gb2JqLmNvbnRlbnQuY2xpZW50SGVpZ2h0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAob2JqLmxvYWRVcCgpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG9iai5jb250ZW50LnNjcm9sbFRvcCA8IDEwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9iai5jb250ZW50LnNjcm9sbFRvcCA9IG9iai5jb250ZW50LnNjcm9sbFRvcCArIG9iai5jb250ZW50LmNsaWVudEhlaWdodDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb2JqLnVwZGF0ZUNvcm5lclBvc2l0aW9uKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGpleGNlbC50aW1lQ29udHJvbExvYWRpbmcgPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgICAgIH0sIDEwMCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIEdldCB3aWR0aCBvZiBhbGwgZnJlZXplZCBjZWxscyB0b2dldGhlclxyXG4gICAgICAgIG9iai5nZXRGcmVlemVXaWR0aCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgdmFyIHdpZHRoID0gMDtcclxuICAgICAgICAgICAgaWYgKG9iai5vcHRpb25zLmZyZWV6ZUNvbHVtbnMgPiAwKSB7XHJcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG9iai5vcHRpb25zLmZyZWV6ZUNvbHVtbnM7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgIHdpZHRoICs9IHBhcnNlSW50KG9iai5vcHRpb25zLmNvbHVtbnNbaV0ud2lkdGgpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiB3aWR0aDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHZhciBzY3JvbGxMZWZ0ID0gMDtcclxuXHJcbiAgICAgICAgb2JqLnVwZGF0ZUZyZWV6ZVBvc2l0aW9uID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBzY3JvbGxMZWZ0ID0gb2JqLmNvbnRlbnQuc2Nyb2xsTGVmdDtcclxuICAgICAgICAgICAgdmFyIHdpZHRoID0gMDtcclxuICAgICAgICAgICAgaWYgKHNjcm9sbExlZnQgPiA1MCkge1xyXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBvYmoub3B0aW9ucy5mcmVlemVDb2x1bW5zOyBpKyspIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoaSA+IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGggKz0gcGFyc2VJbnQob2JqLm9wdGlvbnMuY29sdW1uc1tpIC0gMV0ud2lkdGgpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBvYmouaGVhZGVyc1tpXS5jbGFzc0xpc3QuYWRkKCdqZXhjZWxfZnJlZXplZCcpO1xyXG4gICAgICAgICAgICAgICAgICAgIG9iai5oZWFkZXJzW2ldLnN0eWxlLmxlZnQgPSB3aWR0aCArICdweCc7XHJcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBvYmoucm93cy5sZW5ndGg7IGorKykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAob2JqLnJvd3Nbal0gJiYgb2JqLnJlY29yZHNbal1baV0pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzaGlmdGVkID0gKHNjcm9sbExlZnQgKyAoaSA+IDAgPyBvYmoucmVjb3Jkc1tqXVtpIC0gMV0uc3R5bGUud2lkdGggOiAwKSkgLSA1MSArICdweCc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmoucmVjb3Jkc1tqXVtpXS5jbGFzc0xpc3QuYWRkKCdqZXhjZWxfZnJlZXplZCcpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb2JqLnJlY29yZHNbal1baV0uc3R5bGUubGVmdCA9IHNoaWZ0ZWQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG9iai5vcHRpb25zLmZyZWV6ZUNvbHVtbnM7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgIG9iai5oZWFkZXJzW2ldLmNsYXNzTGlzdC5yZW1vdmUoJ2pleGNlbF9mcmVlemVkJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgb2JqLmhlYWRlcnNbaV0uc3R5bGUubGVmdCA9ICcnO1xyXG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgb2JqLnJvd3MubGVuZ3RoOyBqKyspIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG9iai5yZWNvcmRzW2pdW2ldKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmoucmVjb3Jkc1tqXVtpXS5jbGFzc0xpc3QucmVtb3ZlKCdqZXhjZWxfZnJlZXplZCcpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb2JqLnJlY29yZHNbal1baV0uc3R5bGUubGVmdCA9ICcnO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBQbGFjZSB0aGUgY29ybmVyIGluIHRoZSBjb3JyZWN0IHBsYWNlXHJcbiAgICAgICAgICAgIG9iai51cGRhdGVDb3JuZXJQb3NpdGlvbigpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZWwuYWRkRXZlbnRMaXN0ZW5lcihcIkRPTU1vdXNlU2Nyb2xsXCIsIG9iai53aGVlbENvbnRyb2xzKTtcclxuICAgICAgICBlbC5hZGRFdmVudExpc3RlbmVyKFwibW91c2V3aGVlbFwiLCBvYmoud2hlZWxDb250cm9scyk7XHJcblxyXG4gICAgICAgIGVsLmpleGNlbCA9IG9iajtcclxuXHJcbiAgICAgICAgb2JqLmluaXQoKTtcclxuXHJcbiAgICAgICAgcmV0dXJuIG9iajtcclxuICAgIH0pO1xyXG5cclxuICAgIGpleGNlbC5jdXJyZW50ID0gbnVsbDtcclxuICAgIGpleGNlbC50aW1lQ29udHJvbCA9IG51bGw7XHJcbiAgICBqZXhjZWwudGltZUNvbnRyb2xMb2FkaW5nID0gbnVsbDtcclxuXHJcbiAgICBqZXhjZWwuZGVzdHJveSA9IGZ1bmN0aW9uIChlbGVtZW50LCBkZXN0cm95RXZlbnRIYW5kbGVycykge1xyXG4gICAgICAgIGlmIChlbGVtZW50LmpleGNlbCkge1xyXG4gICAgICAgICAgICB2YXIgcm9vdCA9IGVsZW1lbnQuamV4Y2VsLm9wdGlvbnMucm9vdCA/IGVsZW1lbnQuamV4Y2VsLm9wdGlvbnMucm9vdCA6IGRvY3VtZW50O1xyXG4gICAgICAgICAgICBlbGVtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJET01Nb3VzZVNjcm9sbFwiLCBlbGVtZW50LmpleGNlbC5zY3JvbGxDb250cm9scyk7XHJcbiAgICAgICAgICAgIGVsZW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcihcIm1vdXNld2hlZWxcIiwgZWxlbWVudC5qZXhjZWwuc2Nyb2xsQ29udHJvbHMpO1xyXG4gICAgICAgICAgICBlbGVtZW50LmpleGNlbCA9IG51bGw7XHJcbiAgICAgICAgICAgIGVsZW1lbnQuaW5uZXJIVE1MID0gJyc7XHJcblxyXG4gICAgICAgICAgICBpZiAoZGVzdHJveUV2ZW50SGFuZGxlcnMpIHtcclxuICAgICAgICAgICAgICAgIHJvb3QucmVtb3ZlRXZlbnRMaXN0ZW5lcihcIm1vdXNldXBcIiwgamV4Y2VsLm1vdXNlVXBDb250cm9scyk7XHJcbiAgICAgICAgICAgICAgICByb290LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJtb3VzZWRvd25cIiwgamV4Y2VsLm1vdXNlRG93bkNvbnRyb2xzKTtcclxuICAgICAgICAgICAgICAgIHJvb3QucmVtb3ZlRXZlbnRMaXN0ZW5lcihcIm1vdXNlbW92ZVwiLCBqZXhjZWwubW91c2VNb3ZlQ29udHJvbHMpO1xyXG4gICAgICAgICAgICAgICAgcm9vdC5yZW1vdmVFdmVudExpc3RlbmVyKFwibW91c2VvdmVyXCIsIGpleGNlbC5tb3VzZU92ZXJDb250cm9scyk7XHJcbiAgICAgICAgICAgICAgICByb290LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJkYmxjbGlja1wiLCBqZXhjZWwuZG91YmxlQ2xpY2tDb250cm9scyk7XHJcbiAgICAgICAgICAgICAgICByb290LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJwYXN0ZVwiLCBqZXhjZWwucGFzdGVDb250cm9scyk7XHJcbiAgICAgICAgICAgICAgICByb290LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJjb250ZXh0bWVudVwiLCBqZXhjZWwuY29udGV4dE1lbnVDb250cm9scyk7XHJcbiAgICAgICAgICAgICAgICByb290LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJ0b3VjaHN0YXJ0XCIsIGpleGNlbC50b3VjaFN0YXJ0Q29udHJvbHMpO1xyXG4gICAgICAgICAgICAgICAgcm9vdC5yZW1vdmVFdmVudExpc3RlbmVyKFwidG91Y2hlbmRcIiwgamV4Y2VsLnRvdWNoRW5kQ29udHJvbHMpO1xyXG4gICAgICAgICAgICAgICAgcm9vdC5yZW1vdmVFdmVudExpc3RlbmVyKFwidG91Y2hjYW5jZWxcIiwgamV4Y2VsLnRvdWNoRW5kQ29udHJvbHMpO1xyXG4gICAgICAgICAgICAgICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgamV4Y2VsLmtleURvd25Db250cm9scyk7XHJcbiAgICAgICAgICAgICAgICBqZXhjZWwgPSBudWxsO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGpleGNlbC5idWlsZCA9IGZ1bmN0aW9uIChyb290KSB7XHJcbiAgICAgICAgcm9vdC5hZGRFdmVudExpc3RlbmVyKFwibW91c2V1cFwiLCBqZXhjZWwubW91c2VVcENvbnRyb2xzKTtcclxuICAgICAgICByb290LmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZWRvd25cIiwgamV4Y2VsLm1vdXNlRG93bkNvbnRyb2xzKTtcclxuICAgICAgICByb290LmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZW1vdmVcIiwgamV4Y2VsLm1vdXNlTW92ZUNvbnRyb2xzKTtcclxuICAgICAgICByb290LmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZW92ZXJcIiwgamV4Y2VsLm1vdXNlT3ZlckNvbnRyb2xzKTtcclxuICAgICAgICByb290LmFkZEV2ZW50TGlzdGVuZXIoXCJkYmxjbGlja1wiLCBqZXhjZWwuZG91YmxlQ2xpY2tDb250cm9scyk7XHJcbiAgICAgICAgcm9vdC5hZGRFdmVudExpc3RlbmVyKFwicGFzdGVcIiwgamV4Y2VsLnBhc3RlQ29udHJvbHMpO1xyXG4gICAgICAgIHJvb3QuYWRkRXZlbnRMaXN0ZW5lcihcImNvbnRleHRtZW51XCIsIGpleGNlbC5jb250ZXh0TWVudUNvbnRyb2xzKTtcclxuICAgICAgICByb290LmFkZEV2ZW50TGlzdGVuZXIoXCJ0b3VjaHN0YXJ0XCIsIGpleGNlbC50b3VjaFN0YXJ0Q29udHJvbHMpO1xyXG4gICAgICAgIHJvb3QuYWRkRXZlbnRMaXN0ZW5lcihcInRvdWNoZW5kXCIsIGpleGNlbC50b3VjaEVuZENvbnRyb2xzKTtcclxuICAgICAgICByb290LmFkZEV2ZW50TGlzdGVuZXIoXCJ0b3VjaGNhbmNlbFwiLCBqZXhjZWwudG91Y2hFbmRDb250cm9scyk7XHJcbiAgICAgICAgcm9vdC5hZGRFdmVudExpc3RlbmVyKFwidG91Y2htb3ZlXCIsIGpleGNlbC50b3VjaEVuZENvbnRyb2xzKTtcclxuICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLCBqZXhjZWwua2V5RG93bkNvbnRyb2xzKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIEV2ZW50c1xyXG4gICAgICovXHJcbiAgICBqZXhjZWwua2V5RG93bkNvbnRyb2xzID0gZnVuY3Rpb24gKGUpIHtcclxuICAgICAgICBpZiAoamV4Y2VsLmN1cnJlbnQpIHtcclxuICAgICAgICAgICAgaWYgKGpleGNlbC5jdXJyZW50LmVkaXRpb24pIHtcclxuICAgICAgICAgICAgICAgIGlmIChlLndoaWNoID09IDI3KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gRXNjYXBlXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGpleGNlbC5jdXJyZW50LmVkaXRpb24pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gRXhpdCB3aXRob3V0IHNhdmluZ1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBqZXhjZWwuY3VycmVudC5jbG9zZUVkaXRvcihqZXhjZWwuY3VycmVudC5lZGl0aW9uWzBdLCBmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZS53aGljaCA9PSAxMykge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAvLyBFbnRlclxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChqZXhjZWwuY3VycmVudC5vcHRpb25zLmNvbHVtbnNbamV4Y2VsLmN1cnJlbnQuZWRpdGlvblsyXV0udHlwZSA9PSAnY2FsZW5kYXInKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGpleGNlbC5jdXJyZW50LmNsb3NlRWRpdG9yKGpleGNlbC5jdXJyZW50LmVkaXRpb25bMF0sIHRydWUpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoamV4Y2VsLmN1cnJlbnQub3B0aW9ucy5jb2x1bW5zW2pleGNlbC5jdXJyZW50LmVkaXRpb25bMl1dLnR5cGUgPT0gJ2Ryb3Bkb3duJyB8fFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBqZXhjZWwuY3VycmVudC5vcHRpb25zLmNvbHVtbnNbamV4Y2VsLmN1cnJlbnQuZWRpdGlvblsyXV0udHlwZSA9PSAnYXV0b2NvbXBsZXRlJykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBEbyBub3RoaW5nXHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gQWx0IGVudGVyIC0+IGRvIG5vdCBjbG9zZSBlZGl0b3JcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKChqZXhjZWwuY3VycmVudC5vcHRpb25zLndvcmRXcmFwID09IHRydWUgfHxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGpleGNlbC5jdXJyZW50Lm9wdGlvbnMuY29sdW1uc1tqZXhjZWwuY3VycmVudC5lZGl0aW9uWzJdXS53b3JkV3JhcCA9PSB0cnVlIHx8XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBqZXhjZWwuY3VycmVudC5vcHRpb25zLmRhdGFbamV4Y2VsLmN1cnJlbnQuZWRpdGlvblszXV1bamV4Y2VsLmN1cnJlbnQuZWRpdGlvblsyXV0ubGVuZ3RoID4gMjAwKSAmJiBlLmFsdEtleSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gQWRkIG5ldyBsaW5lIHRvIHRoZSBlZGl0b3JcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBlZGl0b3JUZXh0YXJlYSA9IGpleGNlbC5jdXJyZW50LmVkaXRpb25bMF0uY2hpbGRyZW5bMF07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZWRpdG9yVmFsdWUgPSBqZXhjZWwuY3VycmVudC5lZGl0aW9uWzBdLmNoaWxkcmVuWzBdLnZhbHVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGVkaXRvckluZGV4T2YgPSBlZGl0b3JUZXh0YXJlYS5zZWxlY3Rpb25TdGFydDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVkaXRvclZhbHVlID0gZWRpdG9yVmFsdWUuc2xpY2UoMCwgZWRpdG9ySW5kZXhPZikgKyBcIlxcblwiICsgZWRpdG9yVmFsdWUuc2xpY2UoZWRpdG9ySW5kZXhPZik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlZGl0b3JUZXh0YXJlYS52YWx1ZSA9IGVkaXRvclZhbHVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWRpdG9yVGV4dGFyZWEuZm9jdXMoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVkaXRvclRleHRhcmVhLnNlbGVjdGlvblN0YXJ0ID0gZWRpdG9ySW5kZXhPZiArIDE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlZGl0b3JUZXh0YXJlYS5zZWxlY3Rpb25FbmQgPSBlZGl0b3JJbmRleE9mICsgMTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGpleGNlbC5jdXJyZW50LmVkaXRpb25bMF0uY2hpbGRyZW5bMF0uYmx1cigpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChlLndoaWNoID09IDkpIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBUYWJcclxuICAgICAgICAgICAgICAgICAgICBpZiAoamV4Y2VsLmN1cnJlbnQub3B0aW9ucy5jb2x1bW5zW2pleGNlbC5jdXJyZW50LmVkaXRpb25bMl1dLnR5cGUgPT0gJ2NhbGVuZGFyJykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBqZXhjZWwuY3VycmVudC5jbG9zZUVkaXRvcihqZXhjZWwuY3VycmVudC5lZGl0aW9uWzBdLCB0cnVlKTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBqZXhjZWwuY3VycmVudC5lZGl0aW9uWzBdLmNoaWxkcmVuWzBdLmJsdXIoKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKCFqZXhjZWwuY3VycmVudC5lZGl0aW9uICYmIGpleGNlbC5jdXJyZW50LnNlbGVjdGVkQ2VsbCkge1xyXG4gICAgICAgICAgICAgICAgLy8gV2hpY2gga2V5XHJcbiAgICAgICAgICAgICAgICBpZiAoZS53aGljaCA9PSAzNykge1xyXG4gICAgICAgICAgICAgICAgICAgIGpleGNlbC5jdXJyZW50LmxlZnQoZS5zaGlmdEtleSwgZS5jdHJsS2V5KTtcclxuICAgICAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGUud2hpY2ggPT0gMzkpIHtcclxuICAgICAgICAgICAgICAgICAgICBqZXhjZWwuY3VycmVudC5yaWdodChlLnNoaWZ0S2V5LCBlLmN0cmxLZXkpO1xyXG4gICAgICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZS53aGljaCA9PSAzOCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGpleGNlbC5jdXJyZW50LnVwKGUuc2hpZnRLZXksIGUuY3RybEtleSk7XHJcbiAgICAgICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChlLndoaWNoID09IDQwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgamV4Y2VsLmN1cnJlbnQuZG93bihlLnNoaWZ0S2V5LCBlLmN0cmxLZXkpO1xyXG4gICAgICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZS53aGljaCA9PSAzNikge1xyXG4gICAgICAgICAgICAgICAgICAgIGpleGNlbC5jdXJyZW50LmZpcnN0KGUuc2hpZnRLZXksIGUuY3RybEtleSk7XHJcbiAgICAgICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChlLndoaWNoID09IDM1KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgamV4Y2VsLmN1cnJlbnQubGFzdChlLnNoaWZ0S2V5LCBlLmN0cmxLZXkpO1xyXG4gICAgICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZS53aGljaCA9PSAzMikge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChqZXhjZWwuY3VycmVudC5vcHRpb25zLmVkaXRhYmxlID09IHRydWUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgamV4Y2VsLmN1cnJlbnQuc2V0Q2hlY2tSYWRpb1ZhbHVlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZS53aGljaCA9PSA0NiB8fCBlLndoaWNoID09IDgpIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBEZWxldGVcclxuICAgICAgICAgICAgICAgICAgICBpZiAoamV4Y2VsLmN1cnJlbnQub3B0aW9ucy5lZGl0YWJsZSA9PSB0cnVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChqZXhjZWwuY3VycmVudC5zZWxlY3RlZFJvdykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGpleGNlbC5jdXJyZW50Lm9wdGlvbnMuYWxsb3dEZWxldGVSb3cgPT0gdHJ1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjb25maXJtKGpleGNlbC5jdXJyZW50Lm9wdGlvbnMudGV4dC5hcmVZb3VTdXJlVG9EZWxldGVUaGVTZWxlY3RlZFJvd3MpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGpleGNlbC5jdXJyZW50LmRlbGV0ZVJvdygpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChqZXhjZWwuY3VycmVudC5zZWxlY3RlZEhlYWRlcikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGpleGNlbC5jdXJyZW50Lm9wdGlvbnMuYWxsb3dEZWxldGVDb2x1bW4gPT0gdHJ1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjb25maXJtKGpleGNlbC5jdXJyZW50Lm9wdGlvbnMudGV4dC5hcmVZb3VTdXJlVG9EZWxldGVUaGVTZWxlY3RlZENvbHVtbnMpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGpleGNlbC5jdXJyZW50LmRlbGV0ZUNvbHVtbigpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgamV4Y2VsLmN1cnJlbnQuc2V0VmFsdWUoamV4Y2VsLmN1cnJlbnQuaGlnaGxpZ2h0ZWQsICcnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIENoYW5nZSB2YWx1ZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgamV4Y2VsLmN1cnJlbnQuc2V0VmFsdWUoamV4Y2VsLmN1cnJlbnQuaGlnaGxpZ2h0ZWQsICcnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZS53aGljaCA9PSAxMykge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIE1vdmUgY3Vyc29yXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGUuc2hpZnRLZXkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgamV4Y2VsLmN1cnJlbnQudXAoKTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoamV4Y2VsLmN1cnJlbnQub3B0aW9ucy5hbGxvd0luc2VydFJvdyA9PSB0cnVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoamV4Y2VsLmN1cnJlbnQub3B0aW9ucy5hbGxvd01hbnVhbEluc2VydFJvdyA9PSB0cnVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGpleGNlbC5jdXJyZW50LnNlbGVjdGVkQ2VsbFsxXSA9PSBqZXhjZWwuY3VycmVudC5vcHRpb25zLmRhdGEubGVuZ3RoIC0gMSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBOZXcgcmVjb3JkIGluIGNhc2Ugc2VsZWN0ZWRDZWxsIGluIHRoZSBsYXN0IHJvd1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBqZXhjZWwuY3VycmVudC5pbnNlcnRSb3coKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGpleGNlbC5jdXJyZW50LmRvd24oKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChlLndoaWNoID09IDkpIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBUYWJcclxuICAgICAgICAgICAgICAgICAgICBpZiAoZS5zaGlmdEtleSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBqZXhjZWwuY3VycmVudC5sZWZ0KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGpleGNlbC5jdXJyZW50Lm9wdGlvbnMuYWxsb3dJbnNlcnRDb2x1bW4gPT0gdHJ1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGpleGNlbC5jdXJyZW50Lm9wdGlvbnMuYWxsb3dNYW51YWxJbnNlcnRDb2x1bW4gPT0gdHJ1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChqZXhjZWwuY3VycmVudC5zZWxlY3RlZENlbGxbMF0gPT0gamV4Y2VsLmN1cnJlbnQub3B0aW9ucy5kYXRhWzBdLmxlbmd0aCAtIDEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gTmV3IHJlY29yZCBpbiBjYXNlIHNlbGVjdGVkQ2VsbCBpbiB0aGUgbGFzdCBjb2x1bW5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgamV4Y2VsLmN1cnJlbnQuaW5zZXJ0Q29sdW1uKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBqZXhjZWwuY3VycmVudC5yaWdodCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICgoZS5jdHJsS2V5IHx8IGUubWV0YUtleSkgJiYgIWUuc2hpZnRLZXkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGUud2hpY2ggPT0gNjUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIEN0cmwgKyBBXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBqZXhjZWwuY3VycmVudC5zZWxlY3RBbGwoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChlLndoaWNoID09IDgzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBDdHJsICsgU1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgamV4Y2VsLmN1cnJlbnQuZG93bmxvYWQoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChlLndoaWNoID09IDg5KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBDdHJsICsgWVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgamV4Y2VsLmN1cnJlbnQucmVkbygpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGUud2hpY2ggPT0gOTApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIEN0cmwgKyBaXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBqZXhjZWwuY3VycmVudC51bmRvKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZS53aGljaCA9PSA2Nykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gQ3RybCArIENcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGpleGNlbC5jdXJyZW50LmNvcHkodHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZS53aGljaCA9PSA2Nykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gQ3RybCArIENcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGpleGNlbC5jdXJyZW50LmNvcHkodHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZS53aGljaCA9PSA4OCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gQ3RybCArIFhcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChqZXhjZWwuY3VycmVudC5vcHRpb25zLmVkaXRhYmxlID09IHRydWUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBqZXhjZWwuY3V0Q29udHJvbHMoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgamV4Y2VsLmNvcHlDb250cm9scygpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGUud2hpY2ggPT0gODYpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIEN0cmwgKyBWXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBqZXhjZWwucGFzdGVDb250cm9scygpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGpleGNlbC5jdXJyZW50LnNlbGVjdGVkQ2VsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGpleGNlbC5jdXJyZW50Lm9wdGlvbnMuZWRpdGFibGUgPT0gdHJ1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciByb3dJZCA9IGpleGNlbC5jdXJyZW50LnNlbGVjdGVkQ2VsbFsxXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgY29sdW1uSWQgPSBqZXhjZWwuY3VycmVudC5zZWxlY3RlZENlbGxbMF07XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIElmIGlzIG5vdCByZWFkb25seVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChqZXhjZWwuY3VycmVudC5vcHRpb25zLmNvbHVtbnNbY29sdW1uSWRdLnR5cGUgIT0gJ3JlYWRvbmx5Jykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBDaGFyYWN0ZXJzIGFibGUgdG8gc3RhcnQgYSBlZGl0aW9uXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlLmtleUNvZGUgPT0gMzIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFNwYWNlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoamV4Y2VsLmN1cnJlbnQub3B0aW9ucy5jb2x1bW5zW2NvbHVtbklkXS50eXBlID09ICdjaGVja2JveCcgfHxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBqZXhjZWwuY3VycmVudC5vcHRpb25zLmNvbHVtbnNbY29sdW1uSWRdLnR5cGUgPT0gJ3JhZGlvJykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gU3RhcnQgZWRpdGlvblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGpleGNlbC5jdXJyZW50Lm9wZW5FZGl0b3IoamV4Y2VsLmN1cnJlbnQucmVjb3Jkc1tyb3dJZF1bY29sdW1uSWRdLCB0cnVlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChlLmtleUNvZGUgPT0gMTEzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBTdGFydCBlZGl0aW9uIHdpdGggY3VycmVudCBjb250ZW50IEYyXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBqZXhjZWwuY3VycmVudC5vcGVuRWRpdG9yKGpleGNlbC5jdXJyZW50LnJlY29yZHNbcm93SWRdW2NvbHVtbklkXSwgZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKChlLmtleUNvZGUgPT0gOCkgfHxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChlLmtleUNvZGUgPj0gNDggJiYgZS5rZXlDb2RlIDw9IDU3KSB8fFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKGUua2V5Q29kZSA+PSA5NiAmJiBlLmtleUNvZGUgPD0gMTExKSB8fFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKGUua2V5Q29kZSA+PSAxODcgJiYgZS5rZXlDb2RlIDw9IDE5MCkgfHxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICgoU3RyaW5nLmZyb21DaGFyQ29kZShlLmtleUNvZGUpID09IGUua2V5IHx8IFN0cmluZy5mcm9tQ2hhckNvZGUoZS5rZXlDb2RlKS50b0xvd2VyQ2FzZSgpID09IGUua2V5LnRvTG93ZXJDYXNlKCkpICYmIGpleGNlbC52YWxpZExldHRlcihTdHJpbmcuZnJvbUNoYXJDb2RlKGUua2V5Q29kZSkpKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gU3RhcnQgZWRpdGlvblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgamV4Y2VsLmN1cnJlbnQub3BlbkVkaXRvcihqZXhjZWwuY3VycmVudC5yZWNvcmRzW3Jvd0lkXVtjb2x1bW5JZF0sIHRydWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gUHJldmVudCBlbnRyaWVzIGluIHRoZSBjYWxlbmRhclxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGpleGNlbC5jdXJyZW50Lm9wdGlvbnMuY29sdW1uc1tjb2x1bW5JZF0udHlwZSA9PSAnY2FsZW5kYXInKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgaWYgKGUudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygnamV4Y2VsX3NlYXJjaCcpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGpleGNlbC50aW1lQ29udHJvbCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjbGVhclRpbWVvdXQoamV4Y2VsLnRpbWVDb250cm9sKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGpleGNlbC50aW1lQ29udHJvbCA9IHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBqZXhjZWwuY3VycmVudC5zZWFyY2goZS50YXJnZXQudmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0sIDIwMCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgamV4Y2VsLmlzTW91c2VBY3Rpb24gPSBmYWxzZTtcclxuXHJcbiAgICBqZXhjZWwubW91c2VEb3duQ29udHJvbHMgPSBmdW5jdGlvbiAoZSkge1xyXG4gICAgICAgIGUgPSBlIHx8IHdpbmRvdy5ldmVudDtcclxuICAgICAgICBpZiAoZS5idXR0b25zKSB7XHJcbiAgICAgICAgICAgIHZhciBtb3VzZUJ1dHRvbiA9IGUuYnV0dG9ucztcclxuICAgICAgICB9IGVsc2UgaWYgKGUuYnV0dG9uKSB7XHJcbiAgICAgICAgICAgIHZhciBtb3VzZUJ1dHRvbiA9IGUuYnV0dG9uO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHZhciBtb3VzZUJ1dHRvbiA9IGUud2hpY2g7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBpZiAod2luZG93LnZpSXNFZGl0aW5nKSByZXR1cm47XHJcblxyXG4gICAgICAgIC8vIEdldCBlbGVtZW50c1xyXG4gICAgICAgIHZhciBqZXhjZWxUYWJsZSA9IGpleGNlbC5nZXRFbGVtZW50KGUudGFyZ2V0KTtcclxuICAgICAgICAvLyBjb25zb2xlLmxvZyhlLnRhcmdldClcclxuICAgICAgICBpZiAoamV4Y2VsVGFibGVbMF0pIHtcclxuICAgICAgICAgICAgaWYgKGpleGNlbC5jdXJyZW50ICE9IGpleGNlbFRhYmxlWzBdLmpleGNlbCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKGpleGNlbC5jdXJyZW50KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGpleGNlbC5jdXJyZW50LmVkaXRpb24pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgamV4Y2VsLmN1cnJlbnQuY2xvc2VFZGl0b3IoamV4Y2VsLmN1cnJlbnQuZWRpdGlvblswXSwgdHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGpleGNlbC5jdXJyZW50LnJlc2V0U2VsZWN0aW9uKCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBqZXhjZWwuY3VycmVudCA9IGpleGNlbFRhYmxlWzBdLmpleGNlbDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGlmIChqZXhjZWwuY3VycmVudCkge1xyXG5cclxuICAgICAgICAgICAgICAgIGlmICh3aW5kb3cudmlJc0VkaXRpbmcpIHJldHVybjtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoamV4Y2VsLmN1cnJlbnQuZWRpdGlvbikge1xyXG4gICAgICAgICAgICAgICAgICAgIGpleGNlbC5jdXJyZW50LmNsb3NlRWRpdG9yKGpleGNlbC5jdXJyZW50LmVkaXRpb25bMF0sIHRydWUpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGpleGNlbC5jdXJyZW50LnJlc2V0U2VsZWN0aW9uKHRydWUpO1xyXG4gICAgICAgICAgICAgICAgamV4Y2VsLmN1cnJlbnQgPSBudWxsO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoamV4Y2VsLmN1cnJlbnQgJiYgbW91c2VCdXR0b24gPT0gMSkge1xyXG4gICAgICAgICAgICBpZiAoZS50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdqZXhjZWxfc2VsZWN0YWxsJykpIHtcclxuICAgICAgICAgICAgICAgIGlmIChqZXhjZWwuY3VycmVudCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGpleGNlbC5jdXJyZW50LnNlbGVjdEFsbCgpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKGUudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygnamV4Y2VsX2Nvcm5lcicpKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoamV4Y2VsLmN1cnJlbnQub3B0aW9ucy5lZGl0YWJsZSA9PSB0cnVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgamV4Y2VsLmN1cnJlbnQuc2VsZWN0ZWRDb3JuZXIgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgLy8gSGVhZGVyIGZvdW5kXHJcbiAgICAgICAgICAgICAgICBpZiAoamV4Y2VsVGFibGVbMV0gPT0gMSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBjb2x1bW5JZCA9IGUudGFyZ2V0LmdldEF0dHJpYnV0ZSgnZGF0YS14Jyk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChjb2x1bW5JZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBVcGRhdGUgY3Vyc29yXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpbmZvID0gZS50YXJnZXQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChqZXhjZWwuY3VycmVudC5vcHRpb25zLmNvbHVtblJlc2l6ZSA9PSB0cnVlICYmIGluZm8ud2lkdGggLSBlLm9mZnNldFggPCA2KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBSZXNpemUgaGVscGVyXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBqZXhjZWwuY3VycmVudC5yZXNpemluZyA9IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtb3VzZVBvc2l0aW9uOiBlLnBhZ2VYLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbHVtbjogY29sdW1uSWQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6IGluZm8ud2lkdGgsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIEJvcmRlciBpbmRpY2F0aW9uXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBqZXhjZWwuY3VycmVudC5oZWFkZXJzW2NvbHVtbklkXS5jbGFzc0xpc3QuYWRkKCdyZXNpemluZycpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBqZXhjZWwuY3VycmVudC5yZWNvcmRzLmxlbmd0aDsgaisrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGpleGNlbC5jdXJyZW50LnJlY29yZHNbal1bY29sdW1uSWRdKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGpleGNlbC5jdXJyZW50LnJlY29yZHNbal1bY29sdW1uSWRdLmNsYXNzTGlzdC5hZGQoJ3Jlc2l6aW5nJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGpleGNlbC5jdXJyZW50Lm9wdGlvbnMuY29sdW1uRHJhZyA9PSB0cnVlICYmIGluZm8uaGVpZ2h0IC0gZS5vZmZzZXRZIDwgNikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGpleGNlbC5jdXJyZW50LmlzQ29sTWVyZ2VkKGNvbHVtbklkKS5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCdKRVhDRUw6IFRoaXMgY29sdW1uIGlzIHBhcnQgb2YgYSBtZXJnZWQgY2VsbC4nKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gUmVzZXQgc2VsZWN0aW9uXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgamV4Y2VsLmN1cnJlbnQucmVzZXRTZWxlY3Rpb24oKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBEcmFnIGhlbHBlclxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGpleGNlbC5jdXJyZW50LmRyYWdnaW5nID0ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbGVtZW50OiBlLnRhcmdldCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sdW1uOiBjb2x1bW5JZCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVzdGluYXRpb246IGNvbHVtbklkLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gQm9yZGVyIGluZGljYXRpb25cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBqZXhjZWwuY3VycmVudC5oZWFkZXJzW2NvbHVtbklkXS5jbGFzc0xpc3QuYWRkKCdkcmFnZ2luZycpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgamV4Y2VsLmN1cnJlbnQucmVjb3Jkcy5sZW5ndGg7IGorKykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoamV4Y2VsLmN1cnJlbnQucmVjb3Jkc1tqXVtjb2x1bW5JZF0pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGpleGNlbC5jdXJyZW50LnJlY29yZHNbal1bY29sdW1uSWRdLmNsYXNzTGlzdC5hZGQoJ2RyYWdnaW5nJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoamV4Y2VsLmN1cnJlbnQuc2VsZWN0ZWRIZWFkZXIgJiYgKGUuc2hpZnRLZXkgfHwgZS5jdHJsS2V5KSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBvID0gamV4Y2VsLmN1cnJlbnQuc2VsZWN0ZWRIZWFkZXI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGQgPSBjb2x1bW5JZDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gUHJlc3MgdG8gcmVuYW1lXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGpleGNlbC5jdXJyZW50LnNlbGVjdGVkSGVhZGVyID09IGNvbHVtbklkICYmIGpleGNlbC5jdXJyZW50Lm9wdGlvbnMuYWxsb3dSZW5hbWVDb2x1bW4gPT0gdHJ1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBqZXhjZWwudGltZUNvbnRyb2wgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGpleGNlbC5jdXJyZW50LnNldEhlYWRlcihjb2x1bW5JZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIDgwMCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBLZWVwIHRyYWNrIG9mIHdoaWNoIGhlYWRlciB3YXMgc2VsZWN0ZWQgZmlyc3RcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBqZXhjZWwuY3VycmVudC5zZWxlY3RlZEhlYWRlciA9IGNvbHVtbklkO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBVcGRhdGUgc2VsZWN0aW9uIHNpbmdsZSBjb2x1bW5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgbyA9IGNvbHVtbklkO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBkID0gY29sdW1uSWQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gVXBkYXRlIHNlbGVjdGlvblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgamV4Y2VsLmN1cnJlbnQudXBkYXRlU2VsZWN0aW9uRnJvbUNvb3JkcyhvLCAwLCBkLCBqZXhjZWwuY3VycmVudC5vcHRpb25zLmRhdGEubGVuZ3RoIC0gMSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZS50YXJnZXQucGFyZW50Tm9kZS5jbGFzc0xpc3QuY29udGFpbnMoJ2pleGNlbF9uZXN0ZWQnKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGUudGFyZ2V0LmdldEF0dHJpYnV0ZSgnZGF0YS1jb2x1bW4nKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjb2x1bW4gPSBlLnRhcmdldC5nZXRBdHRyaWJ1dGUoJ2RhdGEtY29sdW1uJykuc3BsaXQoJywnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgYzEgPSBwYXJzZUludChjb2x1bW5bMF0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjMiA9IHBhcnNlSW50KGNvbHVtbltjb2x1bW4ubGVuZ3RoIC0gMV0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgYzEgPSAwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjMiA9IGpleGNlbC5jdXJyZW50Lm9wdGlvbnMuY29sdW1ucy5sZW5ndGggLSAxO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgamV4Y2VsLmN1cnJlbnQudXBkYXRlU2VsZWN0aW9uRnJvbUNvb3JkcyhjMSwgMCwgYzIsIGpleGNlbC5jdXJyZW50Lm9wdGlvbnMuZGF0YS5sZW5ndGggLSAxKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgamV4Y2VsLmN1cnJlbnQuc2VsZWN0ZWRIZWFkZXIgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAvLyBCb2R5IGZvdW5kXHJcbiAgICAgICAgICAgICAgICBpZiAoamV4Y2VsVGFibGVbMV0gPT0gMikge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciByb3dJZCA9IGUudGFyZ2V0LmdldEF0dHJpYnV0ZSgnZGF0YS15Jyk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChlLnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ2pleGNlbF9yb3cnKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgaW5mbyA9IGUudGFyZ2V0LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoamV4Y2VsLmN1cnJlbnQub3B0aW9ucy5yb3dSZXNpemUgPT0gdHJ1ZSAmJiBpbmZvLmhlaWdodCAtIGUub2Zmc2V0WSA8IDYpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFJlc2l6ZSBoZWxwZXJcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGpleGNlbC5jdXJyZW50LnJlc2l6aW5nID0ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnQ6IGUudGFyZ2V0LnBhcmVudE5vZGUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbW91c2VQb3NpdGlvbjogZS5wYWdlWSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByb3c6IHJvd0lkLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhlaWdodDogaW5mby5oZWlnaHQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gQm9yZGVyIGluZGljYXRpb25cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUudGFyZ2V0LnBhcmVudE5vZGUuY2xhc3NMaXN0LmFkZCgncmVzaXppbmcnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChqZXhjZWwuY3VycmVudC5vcHRpb25zLnJvd0RyYWcgPT0gdHJ1ZSAmJiBpbmZvLndpZHRoIC0gZS5vZmZzZXRYIDwgNikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGpleGNlbC5jdXJyZW50LmlzUm93TWVyZ2VkKHJvd0lkKS5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCdKRVhDRUw6IFRoaXMgcm93IGlzIHBhcnQgb2YgYSBtZXJnZWQgY2VsbCcpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChqZXhjZWwuY3VycmVudC5vcHRpb25zLnNlYXJjaCA9PSB0cnVlICYmIGpleGNlbC5jdXJyZW50LnJlc3VsdHMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCdKRVhDRUw6IFBsZWFzZSBjbGVhciB5b3VyIHNlYXJjaCBiZWZvcmUgcGVyZm9ybSB0aGlzIGFjdGlvbicpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBSZXNldCBzZWxlY3Rpb25cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBqZXhjZWwuY3VycmVudC5yZXNldFNlbGVjdGlvbigpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIERyYWcgaGVscGVyXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgamV4Y2VsLmN1cnJlbnQuZHJhZ2dpbmcgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnQ6IGUudGFyZ2V0LnBhcmVudE5vZGUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJvdzogcm93SWQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlc3RpbmF0aW9uOiByb3dJZCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIEJvcmRlciBpbmRpY2F0aW9uXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZS50YXJnZXQucGFyZW50Tm9kZS5jbGFzc0xpc3QuYWRkKCdkcmFnZ2luZycpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGpleGNlbC5jdXJyZW50LnNlbGVjdGVkUm93ICYmIChlLnNoaWZ0S2V5IHx8IGUuY3RybEtleSkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgbyA9IGpleGNlbC5jdXJyZW50LnNlbGVjdGVkUm93O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBkID0gcm93SWQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIEtlZXAgdHJhY2sgb2Ygd2hpY2ggaGVhZGVyIHdhcyBzZWxlY3RlZCBmaXJzdFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGpleGNlbC5jdXJyZW50LnNlbGVjdGVkUm93ID0gcm93SWQ7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFVwZGF0ZSBzZWxlY3Rpb24gc2luZ2xlIGNvbHVtblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBvID0gcm93SWQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGQgPSByb3dJZDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBVcGRhdGUgc2VsZWN0aW9uXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBqZXhjZWwuY3VycmVudC51cGRhdGVTZWxlY3Rpb25Gcm9tQ29vcmRzKDAsIG8sIGpleGNlbC5jdXJyZW50Lm9wdGlvbnMuZGF0YVswXS5sZW5ndGggLSAxLCBkKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEpjbG9zZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZS50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdqY2xvc2UnKSAmJiBlLnRhcmdldC5jbGllbnRXaWR0aCAtIGUub2Zmc2V0WCA8IDUwICYmIGUub2Zmc2V0WSA8IDUwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBqZXhjZWwuY3VycmVudC5jbG9zZUVkaXRvcihqZXhjZWwuY3VycmVudC5lZGl0aW9uWzBdLCB0cnVlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBnZXRDZWxsQ29vcmRzID0gZnVuY3Rpb24gKGVsZW1lbnQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgeCA9IGVsZW1lbnQuZ2V0QXR0cmlidXRlKCdkYXRhLXgnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgeSA9IGVsZW1lbnQuZ2V0QXR0cmlidXRlKCdkYXRhLXknKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoeCAmJiB5KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbeCwgeV07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGVsZW1lbnQucGFyZW50Tm9kZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGdldENlbGxDb29yZHMoZWxlbWVudC5wYXJlbnROb2RlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHBvc2l0aW9uID0gZ2V0Q2VsbENvb3JkcyhlLnRhcmdldCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocG9zaXRpb24pIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNvbHVtbklkID0gcG9zaXRpb25bMF07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHJvd0lkID0gcG9zaXRpb25bMV07XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIENsb3NlIGVkaXRpb25cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoamV4Y2VsLmN1cnJlbnQuZWRpdGlvbikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoamV4Y2VsLmN1cnJlbnQuZWRpdGlvblsyXSAhPSBjb2x1bW5JZCB8fCBqZXhjZWwuY3VycmVudC5lZGl0aW9uWzNdICE9IHJvd0lkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBqZXhjZWwuY3VycmVudC5jbG9zZUVkaXRvcihqZXhjZWwuY3VycmVudC5lZGl0aW9uWzBdLCB0cnVlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFqZXhjZWwuY3VycmVudC5lZGl0aW9uKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFVwZGF0ZSBjZWxsIHNlbGVjdGlvblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZS5zaGlmdEtleSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgamV4Y2VsLmN1cnJlbnQudXBkYXRlU2VsZWN0aW9uRnJvbUNvb3JkcyhqZXhjZWwuY3VycmVudC5zZWxlY3RlZENlbGxbMF0sIGpleGNlbC5jdXJyZW50LnNlbGVjdGVkQ2VsbFsxXSwgY29sdW1uSWQsIHJvd0lkKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGpleGNlbC5jdXJyZW50LnVwZGF0ZVNlbGVjdGlvbkZyb21Db29yZHMoY29sdW1uSWQsIHJvd0lkKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gTm8gZnVsbCByb3cgc2VsZWN0ZWRcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBqZXhjZWwuY3VycmVudC5zZWxlY3RlZEhlYWRlciA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgamV4Y2VsLmN1cnJlbnQuc2VsZWN0ZWRSb3cgPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBqZXhjZWwuY3VycmVudC5zZWxlY3RlZFJvdyA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIC8vIFBhZ2luYXRpb25cclxuICAgICAgICAgICAgICAgIGlmIChlLnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ2pleGNlbF9wYWdlJykpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoZS50YXJnZXQuaW5uZXJUZXh0ID09ICc8Jykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBqZXhjZWwuY3VycmVudC5wYWdlKDApO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZS50YXJnZXQuaW5uZXJUZXh0ID09ICc+Jykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBqZXhjZWwuY3VycmVudC5wYWdlKGUudGFyZ2V0LmdldEF0dHJpYnV0ZSgndGl0bGUnKSAtIDEpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGpleGNlbC5jdXJyZW50LnBhZ2UoZS50YXJnZXQuaW5uZXJUZXh0IC0gMSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAoamV4Y2VsLmN1cnJlbnQuZWRpdGlvbikge1xyXG4gICAgICAgICAgICAgICAgamV4Y2VsLmlzTW91c2VBY3Rpb24gPSBmYWxzZTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGpleGNlbC5pc01vdXNlQWN0aW9uID0gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGpleGNlbC5pc01vdXNlQWN0aW9uID0gZmFsc2U7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGpleGNlbC5tb3VzZVVwQ29udHJvbHMgPSBmdW5jdGlvbiAoZSkge1xyXG4gICAgICAgIGlmIChqZXhjZWwuY3VycmVudCkge1xyXG4gICAgICAgICAgICAvLyBVcGRhdGUgY2VsbCBzaXplXHJcbiAgICAgICAgICAgIGlmIChqZXhjZWwuY3VycmVudC5yZXNpemluZykge1xyXG4gICAgICAgICAgICAgICAgLy8gQ29sdW1ucyB0byBiZSB1cGRhdGVkXHJcbiAgICAgICAgICAgICAgICBpZiAoamV4Y2VsLmN1cnJlbnQucmVzaXppbmcuY29sdW1uKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gTmV3IHdpZHRoXHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIG5ld1dpZHRoID0gamV4Y2VsLmN1cnJlbnQuY29sZ3JvdXBbamV4Y2VsLmN1cnJlbnQucmVzaXppbmcuY29sdW1uXS5nZXRBdHRyaWJ1dGUoJ3dpZHRoJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gQ29sdW1uc1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBjb2x1bW5zID0gamV4Y2VsLmN1cnJlbnQuZ2V0U2VsZWN0ZWRDb2x1bW5zKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNvbHVtbnMubGVuZ3RoID4gMSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgY3VycmVudFdpZHRoID0gW107XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgY29sdW1ucy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudFdpZHRoLnB1c2gocGFyc2VJbnQoamV4Y2VsLmN1cnJlbnQuY29sZ3JvdXBbY29sdW1uc1tpXV0uZ2V0QXR0cmlidXRlKCd3aWR0aCcpKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gUHJldmlvdXMgd2lkdGhcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGluZGV4ID0gY29sdW1ucy5pbmRleE9mKHBhcnNlSW50KGpleGNlbC5jdXJyZW50LnJlc2l6aW5nLmNvbHVtbikpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50V2lkdGhbaW5kZXhdID0gamV4Y2VsLmN1cnJlbnQucmVzaXppbmcud2lkdGg7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGpleGNlbC5jdXJyZW50LnNldFdpZHRoKGNvbHVtbnMsIG5ld1dpZHRoLCBjdXJyZW50V2lkdGgpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGpleGNlbC5jdXJyZW50LnNldFdpZHRoKGpleGNlbC5jdXJyZW50LnJlc2l6aW5nLmNvbHVtbiwgbmV3V2lkdGgsIGpleGNlbC5jdXJyZW50LnJlc2l6aW5nLndpZHRoKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gUmVtb3ZlIGJvcmRlclxyXG4gICAgICAgICAgICAgICAgICAgIGpleGNlbC5jdXJyZW50LmhlYWRlcnNbamV4Y2VsLmN1cnJlbnQucmVzaXppbmcuY29sdW1uXS5jbGFzc0xpc3QucmVtb3ZlKCdyZXNpemluZycpO1xyXG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgamV4Y2VsLmN1cnJlbnQucmVjb3Jkcy5sZW5ndGg7IGorKykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoamV4Y2VsLmN1cnJlbnQucmVjb3Jkc1tqXVtqZXhjZWwuY3VycmVudC5yZXNpemluZy5jb2x1bW5dKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBqZXhjZWwuY3VycmVudC5yZWNvcmRzW2pdW2pleGNlbC5jdXJyZW50LnJlc2l6aW5nLmNvbHVtbl0uY2xhc3NMaXN0LnJlbW92ZSgncmVzaXppbmcnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gUmVtb3ZlIENsYXNzXHJcbiAgICAgICAgICAgICAgICAgICAgamV4Y2VsLmN1cnJlbnQucm93c1tqZXhjZWwuY3VycmVudC5yZXNpemluZy5yb3ddLmNoaWxkcmVuWzBdLmNsYXNzTGlzdC5yZW1vdmUoJ3Jlc2l6aW5nJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIG5ld0hlaWdodCA9IGpleGNlbC5jdXJyZW50LnJvd3NbamV4Y2VsLmN1cnJlbnQucmVzaXppbmcucm93XS5nZXRBdHRyaWJ1dGUoJ2hlaWdodCcpO1xyXG4gICAgICAgICAgICAgICAgICAgIGpleGNlbC5jdXJyZW50LnNldEhlaWdodChqZXhjZWwuY3VycmVudC5yZXNpemluZy5yb3csIG5ld0hlaWdodCwgamV4Y2VsLmN1cnJlbnQucmVzaXppbmcuaGVpZ2h0KTtcclxuICAgICAgICAgICAgICAgICAgICAvLyBSZW1vdmUgYm9yZGVyXHJcbiAgICAgICAgICAgICAgICAgICAgamV4Y2VsLmN1cnJlbnQucmVzaXppbmcuZWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKCdyZXNpemluZycpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgLy8gUmVzZXQgcmVzaXppbmcgaGVscGVyXHJcbiAgICAgICAgICAgICAgICBqZXhjZWwuY3VycmVudC5yZXNpemluZyA9IG51bGw7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoamV4Y2VsLmN1cnJlbnQuZHJhZ2dpbmcpIHtcclxuICAgICAgICAgICAgICAgIC8vIFJlc2V0IGRyYWdnaW5nIGhlbHBlclxyXG4gICAgICAgICAgICAgICAgaWYgKGpleGNlbC5jdXJyZW50LmRyYWdnaW5nKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGpleGNlbC5jdXJyZW50LmRyYWdnaW5nLmNvbHVtbikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBUYXJnZXRcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNvbHVtbklkID0gZS50YXJnZXQuZ2V0QXR0cmlidXRlKCdkYXRhLXgnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gUmVtb3ZlIG1vdmUgc3R5bGVcclxuICAgICAgICAgICAgICAgICAgICAgICAgamV4Y2VsLmN1cnJlbnQuaGVhZGVyc1tqZXhjZWwuY3VycmVudC5kcmFnZ2luZy5jb2x1bW5dLmNsYXNzTGlzdC5yZW1vdmUoJ2RyYWdnaW5nJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgamV4Y2VsLmN1cnJlbnQucm93cy5sZW5ndGg7IGorKykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGpleGNlbC5jdXJyZW50LnJlY29yZHNbal1bamV4Y2VsLmN1cnJlbnQuZHJhZ2dpbmcuY29sdW1uXSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGpleGNlbC5jdXJyZW50LnJlY29yZHNbal1bamV4Y2VsLmN1cnJlbnQuZHJhZ2dpbmcuY29sdW1uXS5jbGFzc0xpc3QucmVtb3ZlKCdkcmFnZ2luZycpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgamV4Y2VsLmN1cnJlbnQuaGVhZGVycy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgamV4Y2VsLmN1cnJlbnQuaGVhZGVyc1tpXS5jbGFzc0xpc3QucmVtb3ZlKCdkcmFnZ2luZy1sZWZ0Jyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBqZXhjZWwuY3VycmVudC5oZWFkZXJzW2ldLmNsYXNzTGlzdC5yZW1vdmUoJ2RyYWdnaW5nLXJpZ2h0Jyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gVXBkYXRlIHBvc2l0aW9uXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjb2x1bW5JZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGpleGNlbC5jdXJyZW50LmRyYWdnaW5nLmNvbHVtbiAhPSBqZXhjZWwuY3VycmVudC5kcmFnZ2luZy5kZXN0aW5hdGlvbikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGpleGNlbC5jdXJyZW50Lm1vdmVDb2x1bW4oamV4Y2VsLmN1cnJlbnQuZHJhZ2dpbmcuY29sdW1uLCBqZXhjZWwuY3VycmVudC5kcmFnZ2luZy5kZXN0aW5hdGlvbik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoamV4Y2VsLmN1cnJlbnQuZHJhZ2dpbmcuZWxlbWVudC5uZXh0U2libGluZykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHBvc2l0aW9uID0gcGFyc2VJbnQoamV4Y2VsLmN1cnJlbnQuZHJhZ2dpbmcuZWxlbWVudC5uZXh0U2libGluZy5nZXRBdHRyaWJ1dGUoJ2RhdGEteScpKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChqZXhjZWwuY3VycmVudC5kcmFnZ2luZy5yb3cgPCBwb3NpdGlvbikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uIC09IDE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgcG9zaXRpb24gPSBwYXJzZUludChqZXhjZWwuY3VycmVudC5kcmFnZ2luZy5lbGVtZW50LnByZXZpb3VzU2libGluZy5nZXRBdHRyaWJ1dGUoJ2RhdGEteScpKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoamV4Y2VsLmN1cnJlbnQuZHJhZ2dpbmcucm93ICE9IGpleGNlbC5jdXJyZW50LmRyYWdnaW5nLmRlc3RpbmF0aW9uKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBqZXhjZWwuY3VycmVudC5tb3ZlUm93KGpleGNlbC5jdXJyZW50LmRyYWdnaW5nLnJvdywgcG9zaXRpb24sIHRydWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGpleGNlbC5jdXJyZW50LmRyYWdnaW5nLmVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSgnZHJhZ2dpbmcnKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgamV4Y2VsLmN1cnJlbnQuZHJhZ2dpbmcgPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgLy8gQ2xvc2UgYW55IGNvcm5lciBzZWxlY3Rpb25cclxuICAgICAgICAgICAgICAgIGlmIChqZXhjZWwuY3VycmVudC5zZWxlY3RlZENvcm5lcikge1xyXG4gICAgICAgICAgICAgICAgICAgIGpleGNlbC5jdXJyZW50LnNlbGVjdGVkQ29ybmVyID0gZmFsc2U7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIC8vIERhdGEgdG8gYmUgY29waWVkXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGpleGNlbC5jdXJyZW50LnNlbGVjdGlvbi5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIENvcHkgZGF0YVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgamV4Y2VsLmN1cnJlbnQuY29weURhdGEoamV4Y2VsLmN1cnJlbnQuc2VsZWN0aW9uWzBdLCBqZXhjZWwuY3VycmVudC5zZWxlY3Rpb25bamV4Y2VsLmN1cnJlbnQuc2VsZWN0aW9uLmxlbmd0aCAtIDFdKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFJlbW92ZSBzZWxlY3Rpb25cclxuICAgICAgICAgICAgICAgICAgICAgICAgamV4Y2VsLmN1cnJlbnQucmVtb3ZlQ29weVNlbGVjdGlvbigpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gQ2xlYXIgYW55IHRpbWUgY29udHJvbFxyXG4gICAgICAgIGlmIChqZXhjZWwudGltZUNvbnRyb2wpIHtcclxuICAgICAgICAgICAgY2xlYXJUaW1lb3V0KGpleGNlbC50aW1lQ29udHJvbCk7XHJcbiAgICAgICAgICAgIGpleGNlbC50aW1lQ29udHJvbCA9IG51bGw7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBNb3VzZSB1cFxyXG4gICAgICAgIGpleGNlbC5pc01vdXNlQWN0aW9uID0gZmFsc2U7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gTW91c2UgbW92ZSBjb250cm9sc1xyXG4gICAgamV4Y2VsLm1vdXNlTW92ZUNvbnRyb2xzID0gZnVuY3Rpb24gKGUpIHtcclxuICAgICAgICBlID0gZSB8fCB3aW5kb3cuZXZlbnQ7XHJcbiAgICAgICAgaWYgKGUuYnV0dG9ucykge1xyXG4gICAgICAgICAgICB2YXIgbW91c2VCdXR0b24gPSBlLmJ1dHRvbnM7XHJcbiAgICAgICAgfSBlbHNlIGlmIChlLmJ1dHRvbikge1xyXG4gICAgICAgICAgICB2YXIgbW91c2VCdXR0b24gPSBlLmJ1dHRvbjtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB2YXIgbW91c2VCdXR0b24gPSBlLndoaWNoO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKCFtb3VzZUJ1dHRvbikge1xyXG4gICAgICAgICAgICBqZXhjZWwuaXNNb3VzZUFjdGlvbiA9IGZhbHNlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKGpleGNlbC5jdXJyZW50KSB7XHJcbiAgICAgICAgICAgIGlmIChqZXhjZWwuaXNNb3VzZUFjdGlvbiA9PSB0cnVlKSB7XHJcbiAgICAgICAgICAgICAgICAvLyBSZXNpemluZyBpcyBvbmdvaW5nXHJcbiAgICAgICAgICAgICAgICBpZiAoamV4Y2VsLmN1cnJlbnQucmVzaXppbmcpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoamV4Y2VsLmN1cnJlbnQucmVzaXppbmcuY29sdW1uKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB3aWR0aCA9IGUucGFnZVggLSBqZXhjZWwuY3VycmVudC5yZXNpemluZy5tb3VzZVBvc2l0aW9uO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGpleGNlbC5jdXJyZW50LnJlc2l6aW5nLndpZHRoICsgd2lkdGggPiAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgdGVtcFdpZHRoID0gamV4Y2VsLmN1cnJlbnQucmVzaXppbmcud2lkdGggKyB3aWR0aDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGpleGNlbC5jdXJyZW50LmNvbGdyb3VwW2pleGNlbC5jdXJyZW50LnJlc2l6aW5nLmNvbHVtbl0uc2V0QXR0cmlidXRlKCd3aWR0aCcsIHRlbXBXaWR0aCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgamV4Y2VsLmN1cnJlbnQudXBkYXRlQ29ybmVyUG9zaXRpb24oKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBoZWlnaHQgPSBlLnBhZ2VZIC0gamV4Y2VsLmN1cnJlbnQucmVzaXppbmcubW91c2VQb3NpdGlvbjtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChqZXhjZWwuY3VycmVudC5yZXNpemluZy5oZWlnaHQgKyBoZWlnaHQgPiAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgdGVtcEhlaWdodCA9IGpleGNlbC5jdXJyZW50LnJlc2l6aW5nLmhlaWdodCArIGhlaWdodDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGpleGNlbC5jdXJyZW50LnJvd3NbamV4Y2VsLmN1cnJlbnQucmVzaXppbmcucm93XS5zZXRBdHRyaWJ1dGUoJ2hlaWdodCcsIHRlbXBIZWlnaHQpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGpleGNlbC5jdXJyZW50LnVwZGF0ZUNvcm5lclBvc2l0aW9uKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgeCA9IGUudGFyZ2V0LmdldEF0dHJpYnV0ZSgnZGF0YS14Jyk7XHJcbiAgICAgICAgICAgICAgICB2YXIgeSA9IGUudGFyZ2V0LmdldEF0dHJpYnV0ZSgnZGF0YS15Jyk7XHJcbiAgICAgICAgICAgICAgICB2YXIgcmVjdCA9IGUudGFyZ2V0LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmIChqZXhjZWwuY3VycmVudC5jdXJzb3IpIHtcclxuICAgICAgICAgICAgICAgICAgICBqZXhjZWwuY3VycmVudC5jdXJzb3Iuc3R5bGUuY3Vyc29yID0gJyc7XHJcbiAgICAgICAgICAgICAgICAgICAgamV4Y2VsLmN1cnJlbnQuY3Vyc29yID0gbnVsbDtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoZS50YXJnZXQucGFyZW50Tm9kZS5wYXJlbnROb2RlICYmIGUudGFyZ2V0LnBhcmVudE5vZGUucGFyZW50Tm9kZS5jbGFzc05hbWUpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoZS50YXJnZXQucGFyZW50Tm9kZS5wYXJlbnROb2RlLmNsYXNzTGlzdC5jb250YWlucygncmVzaXphYmxlJykpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGUudGFyZ2V0ICYmIHggJiYgIXkgJiYgKHJlY3Qud2lkdGggLSAoZS5jbGllbnRYIC0gcmVjdC5sZWZ0KSA8IDYpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBqZXhjZWwuY3VycmVudC5jdXJzb3IgPSBlLnRhcmdldDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGpleGNlbC5jdXJyZW50LmN1cnNvci5zdHlsZS5jdXJzb3IgPSAnY29sLXJlc2l6ZSc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZS50YXJnZXQgJiYgIXggJiYgeSAmJiAocmVjdC5oZWlnaHQgLSAoZS5jbGllbnRZIC0gcmVjdC50b3ApIDwgNikpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGpleGNlbC5jdXJyZW50LmN1cnNvciA9IGUudGFyZ2V0O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgamV4Y2VsLmN1cnJlbnQuY3Vyc29yLnN0eWxlLmN1cnNvciA9ICdyb3ctcmVzaXplJztcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGUudGFyZ2V0LnBhcmVudE5vZGUucGFyZW50Tm9kZS5jbGFzc0xpc3QuY29udGFpbnMoJ2RyYWdnYWJsZScpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlLnRhcmdldCAmJiAheCAmJiB5ICYmIChyZWN0LndpZHRoIC0gKGUuY2xpZW50WCAtIHJlY3QubGVmdCkgPCA2KSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgamV4Y2VsLmN1cnJlbnQuY3Vyc29yID0gZS50YXJnZXQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBqZXhjZWwuY3VycmVudC5jdXJzb3Iuc3R5bGUuY3Vyc29yID0gJ21vdmUnO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGUudGFyZ2V0ICYmIHggJiYgIXkgJiYgKHJlY3QuaGVpZ2h0IC0gKGUuY2xpZW50WSAtIHJlY3QudG9wKSA8IDYpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBqZXhjZWwuY3VycmVudC5jdXJzb3IgPSBlLnRhcmdldDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGpleGNlbC5jdXJyZW50LmN1cnNvci5zdHlsZS5jdXJzb3IgPSAnbW92ZSc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgamV4Y2VsLm1vdXNlT3ZlckNvbnRyb2xzID0gZnVuY3Rpb24gKGUpIHtcclxuICAgICAgICBlID0gZSB8fCB3aW5kb3cuZXZlbnQ7XHJcbiAgICAgICAgaWYgKGUuYnV0dG9ucykge1xyXG4gICAgICAgICAgICB2YXIgbW91c2VCdXR0b24gPSBlLmJ1dHRvbnM7XHJcbiAgICAgICAgfSBlbHNlIGlmIChlLmJ1dHRvbikge1xyXG4gICAgICAgICAgICB2YXIgbW91c2VCdXR0b24gPSBlLmJ1dHRvbjtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB2YXIgbW91c2VCdXR0b24gPSBlLndoaWNoO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKCFtb3VzZUJ1dHRvbikge1xyXG4gICAgICAgICAgICBqZXhjZWwuaXNNb3VzZUFjdGlvbiA9IGZhbHNlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKGpleGNlbC5jdXJyZW50ICYmIGpleGNlbC5pc01vdXNlQWN0aW9uID09IHRydWUpIHtcclxuICAgICAgICAgICAgLy8gR2V0IGVsZW1lbnRzXHJcbiAgICAgICAgICAgIHZhciBqZXhjZWxUYWJsZSA9IGpleGNlbC5nZXRFbGVtZW50KGUudGFyZ2V0KTtcclxuXHJcbiAgICAgICAgICAgIGlmIChqZXhjZWxUYWJsZVswXSkge1xyXG4gICAgICAgICAgICAgICAgLy8gQXZvaWQgY3Jvc3MgcmVmZXJlbmNlXHJcbiAgICAgICAgICAgICAgICBpZiAoamV4Y2VsLmN1cnJlbnQgIT0gamV4Y2VsVGFibGVbMF0uamV4Y2VsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGpleGNlbC5jdXJyZW50KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIGNvbHVtbklkID0gZS50YXJnZXQuZ2V0QXR0cmlidXRlKCdkYXRhLXgnKTtcclxuICAgICAgICAgICAgICAgIHZhciByb3dJZCA9IGUudGFyZ2V0LmdldEF0dHJpYnV0ZSgnZGF0YS15Jyk7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKGpleGNlbC5jdXJyZW50LmRyYWdnaW5nKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGpleGNlbC5jdXJyZW50LmRyYWdnaW5nLmNvbHVtbikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoY29sdW1uSWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChqZXhjZWwuY3VycmVudC5pc0NvbE1lcmdlZChjb2x1bW5JZCkubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignSkVYQ0VMOiBUaGlzIGNvbHVtbiBpcyBwYXJ0IG9mIGEgbWVyZ2VkIGNlbGwuJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgamV4Y2VsLmN1cnJlbnQuaGVhZGVycy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBqZXhjZWwuY3VycmVudC5oZWFkZXJzW2ldLmNsYXNzTGlzdC5yZW1vdmUoJ2RyYWdnaW5nLWxlZnQnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgamV4Y2VsLmN1cnJlbnQuaGVhZGVyc1tpXS5jbGFzc0xpc3QucmVtb3ZlKCdkcmFnZ2luZy1yaWdodCcpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGpleGNlbC5jdXJyZW50LmRyYWdnaW5nLmNvbHVtbiA9PSBjb2x1bW5JZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBqZXhjZWwuY3VycmVudC5kcmFnZ2luZy5kZXN0aW5hdGlvbiA9IHBhcnNlSW50KGNvbHVtbklkKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZS50YXJnZXQuY2xpZW50V2lkdGggLyAyID4gZS5vZmZzZXRYKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoamV4Y2VsLmN1cnJlbnQuZHJhZ2dpbmcuY29sdW1uIDwgY29sdW1uSWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBqZXhjZWwuY3VycmVudC5kcmFnZ2luZy5kZXN0aW5hdGlvbiA9IHBhcnNlSW50KGNvbHVtbklkKSAtIDE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGpleGNlbC5jdXJyZW50LmRyYWdnaW5nLmRlc3RpbmF0aW9uID0gcGFyc2VJbnQoY29sdW1uSWQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgamV4Y2VsLmN1cnJlbnQuaGVhZGVyc1tjb2x1bW5JZF0uY2xhc3NMaXN0LmFkZCgnZHJhZ2dpbmctbGVmdCcpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGpleGNlbC5jdXJyZW50LmRyYWdnaW5nLmNvbHVtbiA8IGNvbHVtbklkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgamV4Y2VsLmN1cnJlbnQuZHJhZ2dpbmcuZGVzdGluYXRpb24gPSBwYXJzZUludChjb2x1bW5JZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGpleGNlbC5jdXJyZW50LmRyYWdnaW5nLmRlc3RpbmF0aW9uID0gcGFyc2VJbnQoY29sdW1uSWQpICsgMTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGpleGNlbC5jdXJyZW50LmhlYWRlcnNbY29sdW1uSWRdLmNsYXNzTGlzdC5hZGQoJ2RyYWdnaW5nLXJpZ2h0Jyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAocm93SWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChqZXhjZWwuY3VycmVudC5pc1Jvd01lcmdlZChyb3dJZCkubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignSkVYQ0VMOiBUaGlzIHJvdyBpcyBwYXJ0IG9mIGEgbWVyZ2VkIGNlbGwuJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0YXJnZXQgPSAoZS50YXJnZXQuY2xpZW50SGVpZ2h0IC8gMiA+IGUub2Zmc2V0WSkgPyBlLnRhcmdldC5wYXJlbnROb2RlLm5leHRTaWJsaW5nIDogZS50YXJnZXQucGFyZW50Tm9kZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoamV4Y2VsLmN1cnJlbnQuZHJhZ2dpbmcuZWxlbWVudCAhPSB0YXJnZXQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZS50YXJnZXQucGFyZW50Tm9kZS5wYXJlbnROb2RlLmluc2VydEJlZm9yZShqZXhjZWwuY3VycmVudC5kcmFnZ2luZy5lbGVtZW50LCB0YXJnZXQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBqZXhjZWwuY3VycmVudC5kcmFnZ2luZy5kZXN0aW5hdGlvbiA9IEFycmF5LnByb3RvdHlwZS5pbmRleE9mLmNhbGwoamV4Y2VsLmN1cnJlbnQuZHJhZ2dpbmcuZWxlbWVudC5wYXJlbnROb2RlLmNoaWxkcmVuLCBqZXhjZWwuY3VycmVudC5kcmFnZ2luZy5lbGVtZW50KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGpleGNlbC5jdXJyZW50LnJlc2l6aW5nKSB7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIEhlYWRlciBmb3VuZFxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChqZXhjZWxUYWJsZVsxXSA9PSAxKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChqZXhjZWwuY3VycmVudC5zZWxlY3RlZEhlYWRlcikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNvbHVtbklkID0gZS50YXJnZXQuZ2V0QXR0cmlidXRlKCdkYXRhLXgnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBvID0gamV4Y2VsLmN1cnJlbnQuc2VsZWN0ZWRIZWFkZXI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZCA9IGNvbHVtbklkO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gVXBkYXRlIHNlbGVjdGlvblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgamV4Y2VsLmN1cnJlbnQudXBkYXRlU2VsZWN0aW9uRnJvbUNvb3JkcyhvLCAwLCBkLCBqZXhjZWwuY3VycmVudC5vcHRpb25zLmRhdGEubGVuZ3RoIC0gMSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIC8vIEJvZHkgZm91bmRcclxuICAgICAgICAgICAgICAgICAgICBpZiAoamV4Y2VsVGFibGVbMV0gPT0gMikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZS50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdqZXhjZWxfcm93JykpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChqZXhjZWwuY3VycmVudC5zZWxlY3RlZFJvdykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBvID0gamV4Y2VsLmN1cnJlbnQuc2VsZWN0ZWRSb3c7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGQgPSByb3dJZDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBVcGRhdGUgc2VsZWN0aW9uXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgamV4Y2VsLmN1cnJlbnQudXBkYXRlU2VsZWN0aW9uRnJvbUNvb3JkcygwLCBvLCBqZXhjZWwuY3VycmVudC5vcHRpb25zLmRhdGFbMF0ubGVuZ3RoIC0gMSwgZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBEbyBub3Qgc2VsZWN0IGVkdGlvbiBpcyBpbiBwcm9ncmVzc1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFqZXhjZWwuY3VycmVudC5lZGl0aW9uKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNvbHVtbklkICYmIHJvd0lkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChqZXhjZWwuY3VycmVudC5zZWxlY3RlZENvcm5lcikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgamV4Y2VsLmN1cnJlbnQudXBkYXRlQ29weVNlbGVjdGlvbihjb2x1bW5JZCwgcm93SWQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGpleGNlbC5jdXJyZW50LnNlbGVjdGVkQ2VsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGpleGNlbC5jdXJyZW50LnVwZGF0ZVNlbGVjdGlvbkZyb21Db29yZHMoamV4Y2VsLmN1cnJlbnQuc2VsZWN0ZWRDZWxsWzBdLCBqZXhjZWwuY3VycmVudC5zZWxlY3RlZENlbGxbMV0sIGNvbHVtbklkLCByb3dJZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIENsZWFyIGFueSB0aW1lIGNvbnRyb2xcclxuICAgICAgICBpZiAoamV4Y2VsLnRpbWVDb250cm9sKSB7XHJcbiAgICAgICAgICAgIGNsZWFyVGltZW91dChqZXhjZWwudGltZUNvbnRyb2wpO1xyXG4gICAgICAgICAgICBqZXhjZWwudGltZUNvbnRyb2wgPSBudWxsO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIERvdWJsZSBjbGljayBldmVudCBoYW5kbGVyOiBjb250cm9scyB0aGUgZG91YmxlIGNsaWNrIGluIHRoZSBjb3JuZXIsIGNlbGwgZWRpdGlvbiBvciBjb2x1bW4gcmUtb3JkZXJpbmcuXHJcbiAgICAgKi9cclxuICAgIGpleGNlbC5kb3VibGVDbGlja0NvbnRyb2xzID0gZnVuY3Rpb24gKGUpIHtcclxuICAgICAgICAvLyBKZXhjZWwgaXMgc2VsZWN0ZWRcclxuICAgICAgICBpZiAoamV4Y2VsLmN1cnJlbnQpIHtcclxuICAgICAgICAgICAgLy8gQ29ybmVyIGFjdGlvblxyXG4gICAgICAgICAgICBpZiAoZS50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdqZXhjZWxfY29ybmVyJykpIHtcclxuICAgICAgICAgICAgICAgIC8vIEFueSBzZWxlY3RlZCBjZWxsc1xyXG4gICAgICAgICAgICAgICAgaWYgKGpleGNlbC5jdXJyZW50LmhpZ2hsaWdodGVkLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBDb3B5IGZyb20gdGhpc1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciB4MSA9IGpleGNlbC5jdXJyZW50LmhpZ2hsaWdodGVkWzBdLmdldEF0dHJpYnV0ZSgnZGF0YS14Jyk7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHkxID0gcGFyc2VJbnQoamV4Y2VsLmN1cnJlbnQuaGlnaGxpZ2h0ZWRbamV4Y2VsLmN1cnJlbnQuaGlnaGxpZ2h0ZWQubGVuZ3RoIC0gMV0uZ2V0QXR0cmlidXRlKCdkYXRhLXknKSkgKyAxO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIFVudGlsIHRoaXNcclxuICAgICAgICAgICAgICAgICAgICB2YXIgeDIgPSBqZXhjZWwuY3VycmVudC5oaWdobGlnaHRlZFtqZXhjZWwuY3VycmVudC5oaWdobGlnaHRlZC5sZW5ndGggLSAxXS5nZXRBdHRyaWJ1dGUoJ2RhdGEteCcpO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciB5MiA9IGpleGNlbC5jdXJyZW50LnJlY29yZHMubGVuZ3RoIC0gMVxyXG4gICAgICAgICAgICAgICAgICAgIC8vIEV4ZWN1dGUgY29weVxyXG4gICAgICAgICAgICAgICAgICAgIGpleGNlbC5jdXJyZW50LmNvcHlEYXRhKGpleGNlbC5jdXJyZW50LnJlY29yZHNbeTFdW3gxXSwgamV4Y2VsLmN1cnJlbnQucmVjb3Jkc1t5Ml1beDJdKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSBlbHNlIGlmIChlLnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ2pleGNlbF9jb2x1bW5fZmlsdGVyJykpIHtcclxuICAgICAgICAgICAgICAgIC8vIENvbHVtblxyXG4gICAgICAgICAgICAgICAgdmFyIGNvbHVtbklkID0gZS50YXJnZXQuZ2V0QXR0cmlidXRlKCdkYXRhLXgnKTtcclxuICAgICAgICAgICAgICAgIC8vIE9wZW4gZmlsdGVyXHJcbiAgICAgICAgICAgICAgICBqZXhjZWwuY3VycmVudC5vcGVuRmlsdGVyKGNvbHVtbklkKTtcclxuXHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAvLyBHZXQgdGFibGVcclxuICAgICAgICAgICAgICAgIHZhciBqZXhjZWxUYWJsZSA9IGpleGNlbC5nZXRFbGVtZW50KGUudGFyZ2V0KTtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyBEb3VibGUgY2xpY2sgb3ZlciBoZWFkZXJcclxuICAgICAgICAgICAgICAgIGlmIChqZXhjZWxUYWJsZVsxXSA9PSAxICYmIGpleGNlbC5jdXJyZW50Lm9wdGlvbnMuY29sdW1uU29ydGluZyA9PSB0cnVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gQ2hlY2sgdmFsaWQgY29sdW1uIGhlYWRlciBjb29yZHNcclxuICAgICAgICAgICAgICAgICAgICB2YXIgY29sdW1uSWQgPSBlLnRhcmdldC5nZXRBdHRyaWJ1dGUoJ2RhdGEteCcpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChjb2x1bW5JZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBqZXhjZWwuY3VycmVudC5vcmRlckJ5KGNvbHVtbklkKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gRG91YmxlIGNsaWNrIG92ZXIgYm9keVxyXG4gICAgICAgICAgICAgICAgaWYgKGpleGNlbFRhYmxlWzFdID09IDIgJiYgamV4Y2VsLmN1cnJlbnQub3B0aW9ucy5lZGl0YWJsZSA9PSB0cnVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFqZXhjZWwuY3VycmVudC5lZGl0aW9uKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBnZXRDZWxsQ29vcmRzID0gZnVuY3Rpb24gKGVsZW1lbnQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlbGVtZW50LnBhcmVudE5vZGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgeCA9IGVsZW1lbnQuZ2V0QXR0cmlidXRlKCdkYXRhLXgnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgeSA9IGVsZW1lbnQuZ2V0QXR0cmlidXRlKCdkYXRhLXknKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoeCAmJiB5KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBlbGVtZW50O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBnZXRDZWxsQ29vcmRzKGVsZW1lbnQucGFyZW50Tm9kZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjZWxsID0gZ2V0Q2VsbENvb3JkcyhlLnRhcmdldCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjZWxsICYmIGNlbGwuY2xhc3NMaXN0LmNvbnRhaW5zKCdoaWdobGlnaHQnKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgamV4Y2VsLmN1cnJlbnQub3BlbkVkaXRvcihjZWxsKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBqZXhjZWwuY29weUNvbnRyb2xzID0gZnVuY3Rpb24gKGUpIHtcclxuICAgICAgICBpZiAoamV4Y2VsLmN1cnJlbnQgJiYgamV4Y2VsLmNvcHlDb250cm9scy5lbmFibGVkKSB7XHJcbiAgICAgICAgICAgIGlmICghamV4Y2VsLmN1cnJlbnQuZWRpdGlvbikge1xyXG4gICAgICAgICAgICAgICAgamV4Y2VsLmN1cnJlbnQuY29weSh0cnVlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBqZXhjZWwuY3V0Q29udHJvbHMgPSBmdW5jdGlvbiAoZSkge1xyXG4gICAgICAgIGlmIChqZXhjZWwuY3VycmVudCkge1xyXG4gICAgICAgICAgICBpZiAoIWpleGNlbC5jdXJyZW50LmVkaXRpb24pIHtcclxuICAgICAgICAgICAgICAgIGpleGNlbC5jdXJyZW50LmNvcHkodHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICBpZiAoamV4Y2VsLmN1cnJlbnQub3B0aW9ucy5lZGl0YWJsZSA9PSB0cnVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgamV4Y2VsLmN1cnJlbnQuc2V0VmFsdWUoamV4Y2VsLmN1cnJlbnQuaGlnaGxpZ2h0ZWQsICcnKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBqZXhjZWwucGFzdGVDb250cm9scyA9IGZ1bmN0aW9uIChlKSB7XHJcbiAgICAgICAgaWYgKGpleGNlbC5jdXJyZW50ICYmIGpleGNlbC5jdXJyZW50LnNlbGVjdGVkQ2VsbCkge1xyXG4gICAgICAgICAgICBpZiAoIWpleGNlbC5jdXJyZW50LmVkaXRpb24pIHtcclxuICAgICAgICAgICAgICAgIGlmIChqZXhjZWwuY3VycmVudC5vcHRpb25zLmVkaXRhYmxlID09IHRydWUpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoZSAmJiBlLmNsaXBib2FyZERhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gamV4Y2VsLmN1cnJlbnQucGFzdGUoamV4Y2VsLmN1cnJlbnQuc2VsZWN0ZWRDZWxsWzBdLCBqZXhjZWwuY3VycmVudC5zZWxlY3RlZENlbGxbMV0sIGUuY2xpcGJvYXJkRGF0YS5nZXREYXRhKCd0ZXh0JykpOy8vaGlkZGVuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGpleGNlbC5jdXJyZW50LnBhc3RlKGpleGNlbC5jdXJyZW50LnNlbGVjdGVkQ2VsbCwgZS5jbGlwYm9hcmREYXRhLmdldERhdGEoJ3RleHQnKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHdpbmRvdy5jbGlwYm9hcmREYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGpleGNlbC5jdXJyZW50LnBhc3RlKGpleGNlbC5jdXJyZW50LnNlbGVjdGVkQ2VsbFswXSwgamV4Y2VsLmN1cnJlbnQuc2VsZWN0ZWRDZWxsWzFdLCB3aW5kb3cuY2xpcGJvYXJkRGF0YS5nZXREYXRhKCd0ZXh0JykpOy8vaGlkZGVuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGpleGNlbC5jdXJyZW50LnBhc3RlKGpleGNlbC5jdXJyZW50LnNlbGVjdGVkQ2VsbCwgZS5jbGlwYm9hcmREYXRhLmdldERhdGEoJ3RleHQnKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGpleGNlbC5jb250ZXh0TWVudUNvbnRyb2xzID0gZnVuY3Rpb24gKGUpIHtcclxuICAgICAgICBlID0gZSB8fCB3aW5kb3cuZXZlbnQ7XHJcbiAgICAgICAgaWYgKFwiYnV0dG9uc1wiIGluIGUpIHtcclxuICAgICAgICAgICAgdmFyIG1vdXNlQnV0dG9uID0gZS5idXR0b25zO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHZhciBtb3VzZUJ1dHRvbiA9IGUud2hpY2ggfHwgZS5idXR0b247XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChqZXhjZWwuY3VycmVudCkge1xyXG4gICAgICAgICAgICBpZiAoamV4Y2VsLmN1cnJlbnQuZWRpdGlvbikge1xyXG4gICAgICAgICAgICAgICAgLy8gZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKGpleGNlbC5jdXJyZW50Lm9wdGlvbnMuY29udGV4dE1lbnUpIHtcclxuICAgICAgICAgICAgICAgIGpleGNlbC5jdXJyZW50LmNvbnRleHRNZW51LmNvbnRleHRtZW51LmNsb3NlKCk7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKGpleGNlbC5jdXJyZW50KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHggPSBlLnRhcmdldC5nZXRBdHRyaWJ1dGUoJ2RhdGEteCcpO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciB5ID0gZS50YXJnZXQuZ2V0QXR0cmlidXRlKCdkYXRhLXknKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCh4ICYmIHkpID09PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBwYXJlbnQgPSBlLnRhcmdldC5wYXJlbnROb2RlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAocGFyZW50LnRhZ05hbWUgPT09ICdURCcpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHggPSBwYXJlbnQuZ2V0QXR0cmlidXRlKCdkYXRhLXgnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHkgPSBwYXJlbnQuZ2V0QXR0cmlidXRlKCdkYXRhLXknKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHggfHwgeSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoKHggPCBwYXJzZUludChqZXhjZWwuY3VycmVudC5zZWxlY3RlZENlbGxbMF0pKSB8fCAoeCA+IHBhcnNlSW50KGpleGNlbC5jdXJyZW50LnNlbGVjdGVkQ2VsbFsyXSkpIHx8XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAoeSA8IHBhcnNlSW50KGpleGNlbC5jdXJyZW50LnNlbGVjdGVkQ2VsbFsxXSkpIHx8ICh5ID4gcGFyc2VJbnQoamV4Y2VsLmN1cnJlbnQuc2VsZWN0ZWRDZWxsWzNdKSkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGpleGNlbC5jdXJyZW50LnVwZGF0ZVNlbGVjdGlvbkZyb21Db29yZHMoeCwgeSwgeCwgeSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gVGFibGUgZm91bmRcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGl0ZW1zID0gamV4Y2VsLmN1cnJlbnQub3B0aW9ucy5jb250ZXh0TWVudShqZXhjZWwuY3VycmVudCwgeCwgeSwgZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFRoZSBpZCBpcyBkZXBlbmRpbmcgb24gaGVhZGVyIGFuZCBib2R5XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGpleGNlbC5jdXJyZW50LmNvbnRleHRNZW51LmNvbnRleHRtZW51Lm9wZW4oZSwgaXRlbXMpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBBdm9pZCB0aGUgcmVhbCBvbmVcclxuICAgICAgICAgICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBqZXhjZWwudG91Y2hTdGFydENvbnRyb2xzID0gZnVuY3Rpb24gKGUpIHtcclxuICAgICAgICB2YXIgamV4Y2VsVGFibGUgPSBqZXhjZWwuZ2V0RWxlbWVudChlLnRhcmdldCk7XHJcblxyXG4gICAgICAgIGlmIChqZXhjZWxUYWJsZVswXSkge1xyXG4gICAgICAgICAgICBpZiAoamV4Y2VsLmN1cnJlbnQgIT0gamV4Y2VsVGFibGVbMF0uamV4Y2VsKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoamV4Y2VsLmN1cnJlbnQpIHtcclxuICAgICAgICAgICAgICAgICAgICBqZXhjZWwuY3VycmVudC5yZXNldFNlbGVjdGlvbigpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgamV4Y2VsLmN1cnJlbnQgPSBqZXhjZWxUYWJsZVswXS5qZXhjZWw7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBpZiAoamV4Y2VsLmN1cnJlbnQpIHtcclxuICAgICAgICAgICAgICAgIGpleGNlbC5jdXJyZW50LnJlc2V0U2VsZWN0aW9uKCk7XHJcbiAgICAgICAgICAgICAgICBqZXhjZWwuY3VycmVudCA9IG51bGw7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmIChqZXhjZWwuY3VycmVudCkge1xyXG4gICAgICAgICAgICBpZiAoIWpleGNlbC5jdXJyZW50LmVkaXRpb24pIHtcclxuICAgICAgICAgICAgICAgIHZhciBjb2x1bW5JZCA9IGUudGFyZ2V0LmdldEF0dHJpYnV0ZSgnZGF0YS14Jyk7XHJcbiAgICAgICAgICAgICAgICB2YXIgcm93SWQgPSBlLnRhcmdldC5nZXRBdHRyaWJ1dGUoJ2RhdGEteScpO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmIChjb2x1bW5JZCAmJiByb3dJZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGpleGNlbC5jdXJyZW50LnVwZGF0ZVNlbGVjdGlvbkZyb21Db29yZHMoY29sdW1uSWQsIHJvd0lkKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgamV4Y2VsLnRpbWVDb250cm9sID0gc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEtlZXAgdGVtcG9yYXJ5IHJlZmVyZW5jZSB0byB0aGUgZWxlbWVudFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoamV4Y2VsLmN1cnJlbnQub3B0aW9ucy5jb2x1bW5zW2NvbHVtbklkXS50eXBlID09ICdjb2xvcicpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGpleGNlbC50bXBFbGVtZW50ID0gbnVsbDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGpleGNlbC50bXBFbGVtZW50ID0gZS50YXJnZXQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgamV4Y2VsLmN1cnJlbnQub3BlbkVkaXRvcihlLnRhcmdldCwgZmFsc2UsIGUpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0sIDUwMCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgamV4Y2VsLnRvdWNoRW5kQ29udHJvbHMgPSBmdW5jdGlvbiAoZSkge1xyXG4gICAgICAgIC8vIENsZWFyIGFueSB0aW1lIGNvbnRyb2xcclxuICAgICAgICBpZiAoamV4Y2VsLnRpbWVDb250cm9sKSB7XHJcbiAgICAgICAgICAgIGNsZWFyVGltZW91dChqZXhjZWwudGltZUNvbnRyb2wpO1xyXG4gICAgICAgICAgICBqZXhjZWwudGltZUNvbnRyb2wgPSBudWxsO1xyXG4gICAgICAgICAgICAvLyBFbGVtZW50XHJcbiAgICAgICAgICAgIGlmIChqZXhjZWwudG1wRWxlbWVudCAmJiBqZXhjZWwudG1wRWxlbWVudC5jaGlsZHJlblswXS50YWdOYW1lID09ICdJTlBVVCcpIHtcclxuICAgICAgICAgICAgICAgIGpleGNlbC50bXBFbGVtZW50LmNoaWxkcmVuWzBdLmZvY3VzKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgamV4Y2VsLnRtcEVsZW1lbnQgPSBudWxsO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIEpleGNlbCBleHRlbnNpb25zXHJcbiAgICAgKi9cclxuXHJcbiAgICBqZXhjZWwudGFicyA9IGZ1bmN0aW9uICh0YWJzLCByZXN1bHQpIHtcclxuICAgICAgICB2YXIgaW5zdGFuY2VzID0gW107XHJcbiAgICAgICAgLy8gQ3JlYXRlIHRhYiBjb250YWluZXJcclxuICAgICAgICBpZiAoIXRhYnMuY2xhc3NMaXN0LmNvbnRhaW5zKCdqZXhjZWxfdGFicycpKSB7XHJcbiAgICAgICAgICAgIHRhYnMuaW5uZXJIVE1MID0gJyc7XHJcbiAgICAgICAgICAgIHRhYnMuY2xhc3NMaXN0LmFkZCgnamV4Y2VsX3RhYnMnKVxyXG4gICAgICAgICAgICB0YWJzLmpleGNlbCA9IFtdO1xyXG5cclxuICAgICAgICAgICAgdmFyIGRpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG4gICAgICAgICAgICB2YXIgaGVhZGVycyA9IHRhYnMuYXBwZW5kQ2hpbGQoZGl2KTtcclxuICAgICAgICAgICAgdmFyIGRpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG4gICAgICAgICAgICB2YXIgY29udGVudCA9IHRhYnMuYXBwZW5kQ2hpbGQoZGl2KTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB2YXIgaGVhZGVycyA9IHRhYnMuY2hpbGRyZW5bMF07XHJcbiAgICAgICAgICAgIHZhciBjb250ZW50ID0gdGFicy5jaGlsZHJlblsxXTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHZhciBzcHJlYWRzaGVldCA9IFtdXHJcbiAgICAgICAgdmFyIGxpbmsgPSBbXTtcclxuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHJlc3VsdC5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAvLyBTcHJlYWRzaGVldCBjb250YWluZXJcclxuICAgICAgICAgICAgc3ByZWFkc2hlZXRbaV0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuICAgICAgICAgICAgc3ByZWFkc2hlZXRbaV0uY2xhc3NMaXN0LmFkZCgnamV4Y2VsX3RhYicpO1xyXG4gICAgICAgICAgICB2YXIgd29ya3NoZWV0ID0gamV4Y2VsKHNwcmVhZHNoZWV0W2ldLCByZXN1bHRbaV0pO1xyXG4gICAgICAgICAgICBjb250ZW50LmFwcGVuZENoaWxkKHNwcmVhZHNoZWV0W2ldKTtcclxuICAgICAgICAgICAgaW5zdGFuY2VzW2ldID0gdGFicy5qZXhjZWwucHVzaCh3b3Jrc2hlZXQpO1xyXG5cclxuICAgICAgICAgICAgLy8gVGFiIGxpbmtcclxuICAgICAgICAgICAgbGlua1tpXSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG4gICAgICAgICAgICBsaW5rW2ldLmNsYXNzTGlzdC5hZGQoJ2pleGNlbF90YWJfbGluaycpO1xyXG4gICAgICAgICAgICBsaW5rW2ldLnNldEF0dHJpYnV0ZSgnZGF0YS1zcHJlYWRzaGVldCcsIHRhYnMuamV4Y2VsLmxlbmd0aCAtIDEpO1xyXG4gICAgICAgICAgICBsaW5rW2ldLmlubmVySFRNTCA9IHJlc3VsdFtpXS5zaGVldE5hbWU7XHJcbiAgICAgICAgICAgIGxpbmtbaV0ub25jbGljayA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgaGVhZGVycy5jaGlsZHJlbi5sZW5ndGg7IGorKykge1xyXG4gICAgICAgICAgICAgICAgICAgIGhlYWRlcnMuY2hpbGRyZW5bal0uY2xhc3NMaXN0LnJlbW92ZSgnc2VsZWN0ZWQnKTtcclxuICAgICAgICAgICAgICAgICAgICBjb250ZW50LmNoaWxkcmVuW2pdLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB2YXIgaSA9IHRoaXMuZ2V0QXR0cmlidXRlKCdkYXRhLXNwcmVhZHNoZWV0Jyk7XHJcbiAgICAgICAgICAgICAgICBjb250ZW50LmNoaWxkcmVuW2ldLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snO1xyXG4gICAgICAgICAgICAgICAgaGVhZGVycy5jaGlsZHJlbltpXS5jbGFzc0xpc3QuYWRkKCdzZWxlY3RlZCcpXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaGVhZGVycy5hcHBlbmRDaGlsZChsaW5rW2ldKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIEZpcnN0IHRhYlxyXG4gICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgaGVhZGVycy5jaGlsZHJlbi5sZW5ndGg7IGorKykge1xyXG4gICAgICAgICAgICBoZWFkZXJzLmNoaWxkcmVuW2pdLmNsYXNzTGlzdC5yZW1vdmUoJ3NlbGVjdGVkJyk7XHJcbiAgICAgICAgICAgIGNvbnRlbnQuY2hpbGRyZW5bal0uc3R5bGUuZGlzcGxheSA9ICdub25lJztcclxuICAgICAgICB9XHJcbiAgICAgICAgaGVhZGVycy5jaGlsZHJlbltoZWFkZXJzLmNoaWxkcmVuLmxlbmd0aCAtIDFdLmNsYXNzTGlzdC5hZGQoJ3NlbGVjdGVkJyk7XHJcbiAgICAgICAgY29udGVudC5jaGlsZHJlbltoZWFkZXJzLmNoaWxkcmVuLmxlbmd0aCAtIDFdLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snO1xyXG5cclxuICAgICAgICByZXR1cm4gaW5zdGFuY2VzO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIENvbXBhYmlsaXR5IHRvIG9sZGVyIHZlcnNpb25zXHJcbiAgICBqZXhjZWwuY3JlYXRlVGFicyA9IGpleGNlbC50YWJzO1xyXG5cclxuICAgIGpleGNlbC5mcm9tU3ByZWFkc2hlZXQgPSBmdW5jdGlvbiAoZmlsZSwgX19jYWxsYmFjaykge1xyXG4gICAgICAgIHZhciBjb252ZXJ0ID0gZnVuY3Rpb24gKHdvcmtib29rKSB7XHJcbiAgICAgICAgICAgIHZhciBzcHJlYWRzaGVldHMgPSBbXTtcclxuICAgICAgICAgICAgd29ya2Jvb2suU2hlZXROYW1lcy5mb3JFYWNoKGZ1bmN0aW9uIChzaGVldE5hbWUpIHtcclxuICAgICAgICAgICAgICAgIHZhciBzcHJlYWRzaGVldCA9IHt9O1xyXG4gICAgICAgICAgICAgICAgc3ByZWFkc2hlZXQucm93cyA9IFtdO1xyXG4gICAgICAgICAgICAgICAgc3ByZWFkc2hlZXQuY29sdW1ucyA9IFtdO1xyXG4gICAgICAgICAgICAgICAgc3ByZWFkc2hlZXQuZGF0YSA9IFtdO1xyXG4gICAgICAgICAgICAgICAgc3ByZWFkc2hlZXQuc3R5bGUgPSB7fTtcclxuICAgICAgICAgICAgICAgIHNwcmVhZHNoZWV0LnNoZWV0TmFtZSA9IHNoZWV0TmFtZTtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyBDb2x1bW4gd2lkdGhzXHJcbiAgICAgICAgICAgICAgICB2YXIgdGVtcCA9IHdvcmtib29rLlNoZWV0c1tzaGVldE5hbWVdWychY29scyddO1xyXG4gICAgICAgICAgICAgICAgaWYgKHRlbXAgJiYgdGVtcC5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRlbXAubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc3ByZWFkc2hlZXQuY29sdW1uc1tpXSA9IHt9O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodGVtcFtpXSAmJiB0ZW1wW2ldLndweCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3ByZWFkc2hlZXQuY29sdW1uc1tpXS53aWR0aCA9IHRlbXBbaV0ud3B4ICsgJ3B4JztcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIC8vIFJvd3MgaGVpZ2h0c1xyXG4gICAgICAgICAgICAgICAgdmFyIHRlbXAgPSB3b3JrYm9vay5TaGVldHNbc2hlZXROYW1lXVsnIXJvd3MnXTtcclxuICAgICAgICAgICAgICAgIGlmICh0ZW1wICYmIHRlbXAubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0ZW1wLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0ZW1wW2ldICYmIHRlbXBbaV0uaHB4KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzcHJlYWRzaGVldC5yb3dzW2ldID0ge307XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzcHJlYWRzaGVldC5yb3dzW2ldLmhlaWdodCA9IHRlbXBbaV0uaHB4ICsgJ3B4JztcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIC8vIE1lcmdlIGNlbGxzXHJcbiAgICAgICAgICAgICAgICB2YXIgdGVtcCA9IHdvcmtib29rLlNoZWV0c1tzaGVldE5hbWVdWychbWVyZ2VzJ107XHJcbiAgICAgICAgICAgICAgICBpZiAodGVtcCAmJiB0ZW1wLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgICAgICBzcHJlYWRzaGVldC5tZXJnZUNlbGxzID0gW107XHJcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0ZW1wLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB4MSA9IHRlbXBbaV0ucy5jO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgeTEgPSB0ZW1wW2ldLnMucjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHgyID0gdGVtcFtpXS5lLmM7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB5MiA9IHRlbXBbaV0uZS5yO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIga2V5ID0gamV4Y2VsLmdldENvbHVtbk5hbWVGcm9tSWQoW3gxLCB5MV0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzcHJlYWRzaGVldC5tZXJnZUNlbGxzW2tleV0gPSBbeDIgLSB4MSArIDEsIHkyIC0geTEgKyAxXTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAvLyBEYXRhIGNvbnRhaW5lclxyXG4gICAgICAgICAgICAgICAgdmFyIG1heF94ID0gMDtcclxuICAgICAgICAgICAgICAgIHZhciBtYXhfeSA9IDA7XHJcbiAgICAgICAgICAgICAgICB2YXIgdGVtcCA9IE9iamVjdC5rZXlzKHdvcmtib29rLlNoZWV0c1tzaGVldE5hbWVdKTtcclxuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGVtcC5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0ZW1wW2ldLnN1YnN0cigwLCAxKSAhPSAnIScpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNlbGwgPSB3b3JrYm9vay5TaGVldHNbc2hlZXROYW1lXVt0ZW1wW2ldXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGluZm8gPSBqZXhjZWwuZ2V0SWRGcm9tQ29sdW1uTmFtZSh0ZW1wW2ldLCB0cnVlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFzcHJlYWRzaGVldC5kYXRhW2luZm9bMV1dKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzcHJlYWRzaGVldC5kYXRhW2luZm9bMV1dID0gW107XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgc3ByZWFkc2hlZXQuZGF0YVtpbmZvWzFdXVtpbmZvWzBdXSA9IGNlbGwuZiA/ICc9JyArIGNlbGwuZiA6IGNlbGwudztcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG1heF94IDwgaW5mb1swXSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbWF4X3ggPSBpbmZvWzBdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChtYXhfeSA8IGluZm9bMV0pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1heF95ID0gaW5mb1sxXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBTdHlsZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoY2VsbC5zdHlsZSAmJiBPYmplY3Qua2V5cyhjZWxsLnN0eWxlKS5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzcHJlYWRzaGVldC5zdHlsZVt0ZW1wW2ldXSA9IGNlbGwuc3R5bGU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNlbGwucyAmJiBjZWxsLnMuZmdDb2xvcikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNwcmVhZHNoZWV0LnN0eWxlW3RlbXBbaV1dKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3ByZWFkc2hlZXQuc3R5bGVbdGVtcFtpXV0gKz0gJzsnO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3ByZWFkc2hlZXQuc3R5bGVbdGVtcFtpXV0gKz0gJ2JhY2tncm91bmQtY29sb3I6IycgKyBjZWxsLnMuZmdDb2xvci5yZ2I7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB2YXIgbnVtQ29sdW1ucyA9IHNwcmVhZHNoZWV0LmNvbHVtbnM7XHJcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8PSBtYXhfeTsgaisrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPD0gbWF4X3g7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXNwcmVhZHNoZWV0LmRhdGFbal0pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNwcmVhZHNoZWV0LmRhdGFbal0gPSBbXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXNwcmVhZHNoZWV0LmRhdGFbal1baV0pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChudW1Db2x1bW5zIDwgaSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNwcmVhZHNoZWV0LmRhdGFbal1baV0gPSAnJztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHNwcmVhZHNoZWV0cy5wdXNoKHNwcmVhZHNoZWV0KTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gc3ByZWFkc2hlZXRzO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdmFyIG9SZXE7XHJcbiAgICAgICAgb1JlcSA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpO1xyXG4gICAgICAgIG9SZXEub3BlbihcIkdFVFwiLCBmaWxlLCB0cnVlKTtcclxuXHJcbiAgICAgICAgaWYgKHR5cGVvZiBVaW50OEFycmF5ICE9PSAndW5kZWZpbmVkJykge1xyXG4gICAgICAgICAgICBvUmVxLnJlc3BvbnNlVHlwZSA9IFwiYXJyYXlidWZmZXJcIjtcclxuICAgICAgICAgICAgb1JlcS5vbmxvYWQgPSBmdW5jdGlvbiAoZSkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGFycmF5YnVmZmVyID0gb1JlcS5yZXNwb25zZTtcclxuICAgICAgICAgICAgICAgIHZhciBkYXRhID0gbmV3IFVpbnQ4QXJyYXkoYXJyYXlidWZmZXIpO1xyXG4gICAgICAgICAgICAgICAgdmFyIHdiID0gWExTWC5yZWFkKGRhdGEsIHt0eXBlOiBcImFycmF5XCIsIGNlbGxGb3JtdWxhOiB0cnVlLCBjZWxsU3R5bGVzOiB0cnVlfSk7XHJcbiAgICAgICAgICAgICAgICBfX2NhbGxiYWNrKGNvbnZlcnQod2IpKVxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIG9SZXEuc2V0UmVxdWVzdEhlYWRlcihcIkFjY2VwdC1DaGFyc2V0XCIsIFwieC11c2VyLWRlZmluZWRcIik7XHJcbiAgICAgICAgICAgIG9SZXEub25yZWFkeXN0YXRlY2hhbmdlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKG9SZXEucmVhZHlTdGF0ZSA9PSA0ICYmIG9SZXEuc3RhdHVzID09IDIwMCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBmZiA9IGNvbnZlcnRSZXNwb25zZUJvZHlUb1RleHQob1JlcS5yZXNwb25zZUJvZHkpO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciB3YiA9IFhMU1gucmVhZChmZiwge3R5cGU6IFwiYmluYXJ5XCIsIGNlbGxGb3JtdWxhOiB0cnVlLCBjZWxsU3R5bGVzOiB0cnVlfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgX19jYWxsYmFjayhjb252ZXJ0KHdiKSlcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIG9SZXEuc2VuZCgpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogVmFsaWQgaW50ZXJuYXRpb25hbCBsZXR0ZXJcclxuICAgICAqL1xyXG5cclxuICAgIGpleGNlbC52YWxpZExldHRlciA9IGZ1bmN0aW9uICh0ZXh0KSB7XHJcbiAgICAgICAgdmFyIHJlZ2V4ID0gLyhbXFx1MDA0MS1cXHUwMDVBXFx1MDA2MS1cXHUwMDdBXFx1MDBBQVxcdTAwQjVcXHUwMEJBXFx1MDBDMC1cXHUwMEQ2XFx1MDBEOC1cXHUwMEY2XFx1MDBGOC1cXHUwMkMxXFx1MDJDNi1cXHUwMkQxXFx1MDJFMC1cXHUwMkU0XFx1MDJFQ1xcdTAyRUVcXHUwMzcwLVxcdTAzNzRcXHUwMzc2XFx1MDM3N1xcdTAzN0EtXFx1MDM3RFxcdTAzODZcXHUwMzg4LVxcdTAzOEFcXHUwMzhDXFx1MDM4RS1cXHUwM0ExXFx1MDNBMy1cXHUwM0Y1XFx1MDNGNy1cXHUwNDgxXFx1MDQ4QS1cXHUwNTI3XFx1MDUzMS1cXHUwNTU2XFx1MDU1OVxcdTA1NjEtXFx1MDU4N1xcdTA1RDAtXFx1MDVFQVxcdTA1RjAtXFx1MDVGMlxcdTA2MjAtXFx1MDY0QVxcdTA2NkVcXHUwNjZGXFx1MDY3MS1cXHUwNkQzXFx1MDZENVxcdTA2RTVcXHUwNkU2XFx1MDZFRVxcdTA2RUZcXHUwNkZBLVxcdTA2RkNcXHUwNkZGXFx1MDcxMFxcdTA3MTItXFx1MDcyRlxcdTA3NEQtXFx1MDdBNVxcdTA3QjFcXHUwN0NBLVxcdTA3RUFcXHUwN0Y0XFx1MDdGNVxcdTA3RkFcXHUwODAwLVxcdTA4MTVcXHUwODFBXFx1MDgyNFxcdTA4MjhcXHUwODQwLVxcdTA4NThcXHUwOEEwXFx1MDhBMi1cXHUwOEFDXFx1MDkwNC1cXHUwOTM5XFx1MDkzRFxcdTA5NTBcXHUwOTU4LVxcdTA5NjFcXHUwOTcxLVxcdTA5NzdcXHUwOTc5LVxcdTA5N0ZcXHUwOTg1LVxcdTA5OENcXHUwOThGXFx1MDk5MFxcdTA5OTMtXFx1MDlBOFxcdTA5QUEtXFx1MDlCMFxcdTA5QjJcXHUwOUI2LVxcdTA5QjlcXHUwOUJEXFx1MDlDRVxcdTA5RENcXHUwOUREXFx1MDlERi1cXHUwOUUxXFx1MDlGMFxcdTA5RjFcXHUwQTA1LVxcdTBBMEFcXHUwQTBGXFx1MEExMFxcdTBBMTMtXFx1MEEyOFxcdTBBMkEtXFx1MEEzMFxcdTBBMzJcXHUwQTMzXFx1MEEzNVxcdTBBMzZcXHUwQTM4XFx1MEEzOVxcdTBBNTktXFx1MEE1Q1xcdTBBNUVcXHUwQTcyLVxcdTBBNzRcXHUwQTg1LVxcdTBBOERcXHUwQThGLVxcdTBBOTFcXHUwQTkzLVxcdTBBQThcXHUwQUFBLVxcdTBBQjBcXHUwQUIyXFx1MEFCM1xcdTBBQjUtXFx1MEFCOVxcdTBBQkRcXHUwQUQwXFx1MEFFMFxcdTBBRTFcXHUwQjA1LVxcdTBCMENcXHUwQjBGXFx1MEIxMFxcdTBCMTMtXFx1MEIyOFxcdTBCMkEtXFx1MEIzMFxcdTBCMzJcXHUwQjMzXFx1MEIzNS1cXHUwQjM5XFx1MEIzRFxcdTBCNUNcXHUwQjVEXFx1MEI1Ri1cXHUwQjYxXFx1MEI3MVxcdTBCODNcXHUwQjg1LVxcdTBCOEFcXHUwQjhFLVxcdTBCOTBcXHUwQjkyLVxcdTBCOTVcXHUwQjk5XFx1MEI5QVxcdTBCOUNcXHUwQjlFXFx1MEI5RlxcdTBCQTNcXHUwQkE0XFx1MEJBOC1cXHUwQkFBXFx1MEJBRS1cXHUwQkI5XFx1MEJEMFxcdTBDMDUtXFx1MEMwQ1xcdTBDMEUtXFx1MEMxMFxcdTBDMTItXFx1MEMyOFxcdTBDMkEtXFx1MEMzM1xcdTBDMzUtXFx1MEMzOVxcdTBDM0RcXHUwQzU4XFx1MEM1OVxcdTBDNjBcXHUwQzYxXFx1MEM4NS1cXHUwQzhDXFx1MEM4RS1cXHUwQzkwXFx1MEM5Mi1cXHUwQ0E4XFx1MENBQS1cXHUwQ0IzXFx1MENCNS1cXHUwQ0I5XFx1MENCRFxcdTBDREVcXHUwQ0UwXFx1MENFMVxcdTBDRjFcXHUwQ0YyXFx1MEQwNS1cXHUwRDBDXFx1MEQwRS1cXHUwRDEwXFx1MEQxMi1cXHUwRDNBXFx1MEQzRFxcdTBENEVcXHUwRDYwXFx1MEQ2MVxcdTBEN0EtXFx1MEQ3RlxcdTBEODUtXFx1MEQ5NlxcdTBEOUEtXFx1MERCMVxcdTBEQjMtXFx1MERCQlxcdTBEQkRcXHUwREMwLVxcdTBEQzZcXHUwRTAxLVxcdTBFMzBcXHUwRTMyXFx1MEUzM1xcdTBFNDAtXFx1MEU0NlxcdTBFODFcXHUwRTgyXFx1MEU4NFxcdTBFODdcXHUwRTg4XFx1MEU4QVxcdTBFOERcXHUwRTk0LVxcdTBFOTdcXHUwRTk5LVxcdTBFOUZcXHUwRUExLVxcdTBFQTNcXHUwRUE1XFx1MEVBN1xcdTBFQUFcXHUwRUFCXFx1MEVBRC1cXHUwRUIwXFx1MEVCMlxcdTBFQjNcXHUwRUJEXFx1MEVDMC1cXHUwRUM0XFx1MEVDNlxcdTBFREMtXFx1MEVERlxcdTBGMDBcXHUwRjQwLVxcdTBGNDdcXHUwRjQ5LVxcdTBGNkNcXHUwRjg4LVxcdTBGOENcXHUxMDAwLVxcdTEwMkFcXHUxMDNGXFx1MTA1MC1cXHUxMDU1XFx1MTA1QS1cXHUxMDVEXFx1MTA2MVxcdTEwNjVcXHUxMDY2XFx1MTA2RS1cXHUxMDcwXFx1MTA3NS1cXHUxMDgxXFx1MTA4RVxcdTEwQTAtXFx1MTBDNVxcdTEwQzdcXHUxMENEXFx1MTBEMC1cXHUxMEZBXFx1MTBGQy1cXHUxMjQ4XFx1MTI0QS1cXHUxMjREXFx1MTI1MC1cXHUxMjU2XFx1MTI1OFxcdTEyNUEtXFx1MTI1RFxcdTEyNjAtXFx1MTI4OFxcdTEyOEEtXFx1MTI4RFxcdTEyOTAtXFx1MTJCMFxcdTEyQjItXFx1MTJCNVxcdTEyQjgtXFx1MTJCRVxcdTEyQzBcXHUxMkMyLVxcdTEyQzVcXHUxMkM4LVxcdTEyRDZcXHUxMkQ4LVxcdTEzMTBcXHUxMzEyLVxcdTEzMTVcXHUxMzE4LVxcdTEzNUFcXHUxMzgwLVxcdTEzOEZcXHUxM0EwLVxcdTEzRjRcXHUxNDAxLVxcdTE2NkNcXHUxNjZGLVxcdTE2N0ZcXHUxNjgxLVxcdTE2OUFcXHUxNkEwLVxcdTE2RUFcXHUxNzAwLVxcdTE3MENcXHUxNzBFLVxcdTE3MTFcXHUxNzIwLVxcdTE3MzFcXHUxNzQwLVxcdTE3NTFcXHUxNzYwLVxcdTE3NkNcXHUxNzZFLVxcdTE3NzBcXHUxNzgwLVxcdTE3QjNcXHUxN0Q3XFx1MTdEQ1xcdTE4MjAtXFx1MTg3N1xcdTE4ODAtXFx1MThBOFxcdTE4QUFcXHUxOEIwLVxcdTE4RjVcXHUxOTAwLVxcdTE5MUNcXHUxOTUwLVxcdTE5NkRcXHUxOTcwLVxcdTE5NzRcXHUxOTgwLVxcdTE5QUJcXHUxOUMxLVxcdTE5QzdcXHUxQTAwLVxcdTFBMTZcXHUxQTIwLVxcdTFBNTRcXHUxQUE3XFx1MUIwNS1cXHUxQjMzXFx1MUI0NS1cXHUxQjRCXFx1MUI4My1cXHUxQkEwXFx1MUJBRVxcdTFCQUZcXHUxQkJBLVxcdTFCRTVcXHUxQzAwLVxcdTFDMjNcXHUxQzRELVxcdTFDNEZcXHUxQzVBLVxcdTFDN0RcXHUxQ0U5LVxcdTFDRUNcXHUxQ0VFLVxcdTFDRjFcXHUxQ0Y1XFx1MUNGNlxcdTFEMDAtXFx1MURCRlxcdTFFMDAtXFx1MUYxNVxcdTFGMTgtXFx1MUYxRFxcdTFGMjAtXFx1MUY0NVxcdTFGNDgtXFx1MUY0RFxcdTFGNTAtXFx1MUY1N1xcdTFGNTlcXHUxRjVCXFx1MUY1RFxcdTFGNUYtXFx1MUY3RFxcdTFGODAtXFx1MUZCNFxcdTFGQjYtXFx1MUZCQ1xcdTFGQkVcXHUxRkMyLVxcdTFGQzRcXHUxRkM2LVxcdTFGQ0NcXHUxRkQwLVxcdTFGRDNcXHUxRkQ2LVxcdTFGREJcXHUxRkUwLVxcdTFGRUNcXHUxRkYyLVxcdTFGRjRcXHUxRkY2LVxcdTFGRkNcXHUyMDcxXFx1MjA3RlxcdTIwOTAtXFx1MjA5Q1xcdTIxMDJcXHUyMTA3XFx1MjEwQS1cXHUyMTEzXFx1MjExNVxcdTIxMTktXFx1MjExRFxcdTIxMjRcXHUyMTI2XFx1MjEyOFxcdTIxMkEtXFx1MjEyRFxcdTIxMkYtXFx1MjEzOVxcdTIxM0MtXFx1MjEzRlxcdTIxNDUtXFx1MjE0OVxcdTIxNEVcXHUyMTgzXFx1MjE4NFxcdTJDMDAtXFx1MkMyRVxcdTJDMzAtXFx1MkM1RVxcdTJDNjAtXFx1MkNFNFxcdTJDRUItXFx1MkNFRVxcdTJDRjJcXHUyQ0YzXFx1MkQwMC1cXHUyRDI1XFx1MkQyN1xcdTJEMkRcXHUyRDMwLVxcdTJENjdcXHUyRDZGXFx1MkQ4MC1cXHUyRDk2XFx1MkRBMC1cXHUyREE2XFx1MkRBOC1cXHUyREFFXFx1MkRCMC1cXHUyREI2XFx1MkRCOC1cXHUyREJFXFx1MkRDMC1cXHUyREM2XFx1MkRDOC1cXHUyRENFXFx1MkREMC1cXHUyREQ2XFx1MkREOC1cXHUyRERFXFx1MkUyRlxcdTMwMDVcXHUzMDA2XFx1MzAzMS1cXHUzMDM1XFx1MzAzQlxcdTMwM0NcXHUzMDQxLVxcdTMwOTZcXHUzMDlELVxcdTMwOUZcXHUzMEExLVxcdTMwRkFcXHUzMEZDLVxcdTMwRkZcXHUzMTA1LVxcdTMxMkRcXHUzMTMxLVxcdTMxOEVcXHUzMUEwLVxcdTMxQkFcXHUzMUYwLVxcdTMxRkZcXHUzNDAwLVxcdTREQjVcXHU0RTAwLVxcdTlGQ0NcXHVBMDAwLVxcdUE0OENcXHVBNEQwLVxcdUE0RkRcXHVBNTAwLVxcdUE2MENcXHVBNjEwLVxcdUE2MUZcXHVBNjJBXFx1QTYyQlxcdUE2NDAtXFx1QTY2RVxcdUE2N0YtXFx1QTY5N1xcdUE2QTAtXFx1QTZFNVxcdUE3MTctXFx1QTcxRlxcdUE3MjItXFx1QTc4OFxcdUE3OEItXFx1QTc4RVxcdUE3OTAtXFx1QTc5M1xcdUE3QTAtXFx1QTdBQVxcdUE3RjgtXFx1QTgwMVxcdUE4MDMtXFx1QTgwNVxcdUE4MDctXFx1QTgwQVxcdUE4MEMtXFx1QTgyMlxcdUE4NDAtXFx1QTg3M1xcdUE4ODItXFx1QThCM1xcdUE4RjItXFx1QThGN1xcdUE4RkJcXHVBOTBBLVxcdUE5MjVcXHVBOTMwLVxcdUE5NDZcXHVBOTYwLVxcdUE5N0NcXHVBOTg0LVxcdUE5QjJcXHVBOUNGXFx1QUEwMC1cXHVBQTI4XFx1QUE0MC1cXHVBQTQyXFx1QUE0NC1cXHVBQTRCXFx1QUE2MC1cXHVBQTc2XFx1QUE3QVxcdUFBODAtXFx1QUFBRlxcdUFBQjFcXHVBQUI1XFx1QUFCNlxcdUFBQjktXFx1QUFCRFxcdUFBQzBcXHVBQUMyXFx1QUFEQi1cXHVBQUREXFx1QUFFMC1cXHVBQUVBXFx1QUFGMi1cXHVBQUY0XFx1QUIwMS1cXHVBQjA2XFx1QUIwOS1cXHVBQjBFXFx1QUIxMS1cXHVBQjE2XFx1QUIyMC1cXHVBQjI2XFx1QUIyOC1cXHVBQjJFXFx1QUJDMC1cXHVBQkUyXFx1QUMwMC1cXHVEN0EzXFx1RDdCMC1cXHVEN0M2XFx1RDdDQi1cXHVEN0ZCXFx1RjkwMC1cXHVGQTZEXFx1RkE3MC1cXHVGQUQ5XFx1RkIwMC1cXHVGQjA2XFx1RkIxMy1cXHVGQjE3XFx1RkIxRFxcdUZCMUYtXFx1RkIyOFxcdUZCMkEtXFx1RkIzNlxcdUZCMzgtXFx1RkIzQ1xcdUZCM0VcXHVGQjQwXFx1RkI0MVxcdUZCNDNcXHVGQjQ0XFx1RkI0Ni1cXHVGQkIxXFx1RkJEMy1cXHVGRDNEXFx1RkQ1MC1cXHVGRDhGXFx1RkQ5Mi1cXHVGREM3XFx1RkRGMC1cXHVGREZCXFx1RkU3MC1cXHVGRTc0XFx1RkU3Ni1cXHVGRUZDXFx1RkYyMS1cXHVGRjNBXFx1RkY0MS1cXHVGRjVBXFx1RkY2Ni1cXHVGRkJFXFx1RkZDMi1cXHVGRkM3XFx1RkZDQS1cXHVGRkNGXFx1RkZEMi1cXHVGRkQ3XFx1RkZEQS1cXHVGRkRDLVxcdTA0MDAtXFx1MDRGRiddKykvZztcclxuICAgICAgICByZXR1cm4gdGV4dC5tYXRjaChyZWdleCkgPyAxIDogMDtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIEhlbHBlciBpbmplY3RBcnJheVxyXG4gICAgICovXHJcbiAgICBqZXhjZWwuaW5qZWN0QXJyYXkgPSBmdW5jdGlvbiAobywgaWR4LCBhcnIpIHtcclxuICAgICAgICByZXR1cm4gby5zbGljZSgwLCBpZHgpLmNvbmNhdChhcnIpLmNvbmNhdChvLnNsaWNlKGlkeCkpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogR2V0IGxldHRlciBiYXNlZCBvbiBhIG51bWJlclxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBpbnRlZ2VyIGlcclxuICAgICAqIEByZXR1cm4gc3RyaW5nIGxldHRlclxyXG4gICAgICovXHJcbiAgICBqZXhjZWwuZ2V0Q29sdW1uTmFtZSA9IGZ1bmN0aW9uIChpKSB7XHJcbiAgICAgICAgdmFyIGxldHRlciA9ICcnO1xyXG4gICAgICAgIGlmIChpID4gNzAxKSB7XHJcbiAgICAgICAgICAgIGxldHRlciArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKDY0ICsgcGFyc2VJbnQoaSAvIDY3NikpO1xyXG4gICAgICAgICAgICBsZXR0ZXIgKz0gU3RyaW5nLmZyb21DaGFyQ29kZSg2NCArIHBhcnNlSW50KChpICUgNjc2KSAvIDI2KSk7XHJcbiAgICAgICAgfSBlbHNlIGlmIChpID4gMjUpIHtcclxuICAgICAgICAgICAgbGV0dGVyICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoNjQgKyBwYXJzZUludChpIC8gMjYpKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgbGV0dGVyICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoNjUgKyAoaSAlIDI2KSk7XHJcbiAgICAgICAgcmV0dXJuIGxldHRlcjtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIENvbnZlcnQgZXhjZWwgbGlrZSBjb2x1bW4gdG8gamV4Y2VsIGlkXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIHN0cmluZyBpZFxyXG4gICAgICogQHJldHVybiBzdHJpbmcgaWRcclxuICAgICAqL1xyXG4gICAgamV4Y2VsLmdldElkRnJvbUNvbHVtbk5hbWUgPSBmdW5jdGlvbiAoaWQsIGFycikge1xyXG4gICAgICAgIC8vIEdldCB0aGUgbGV0dGVyc1xyXG4gICAgICAgIHZhciB0ID0gL15bYS16QS1aXSsvLmV4ZWMoaWQpO1xyXG5cclxuICAgICAgICBpZiAodCkge1xyXG4gICAgICAgICAgICAvLyBCYXNlIDI2IGNhbGN1bGF0aW9uXHJcbiAgICAgICAgICAgIHZhciBjb2RlID0gMDtcclxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0WzBdLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICBjb2RlICs9IHBhcnNlSW50KHRbMF0uY2hhckNvZGVBdChpKSAtIDY0KSAqIE1hdGgucG93KDI2LCAodFswXS5sZW5ndGggLSAxIC0gaSkpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGNvZGUtLTtcclxuICAgICAgICAgICAgLy8gTWFrZSBzdXJlIGpleGNlbCBzdGFydHMgb24gemVyb1xyXG4gICAgICAgICAgICBpZiAoY29kZSA8IDApIHtcclxuICAgICAgICAgICAgICAgIGNvZGUgPSAwO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBOdW1iZXJcclxuICAgICAgICAgICAgdmFyIG51bWJlciA9IHBhcnNlSW50KC9bMC05XSskLy5leGVjKGlkKSk7XHJcbiAgICAgICAgICAgIGlmIChudW1iZXIgPiAwKSB7XHJcbiAgICAgICAgICAgICAgICBudW1iZXItLTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKGFyciA9PSB0cnVlKSB7XHJcbiAgICAgICAgICAgICAgICBpZCA9IFtjb2RlLCBudW1iZXJdO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgaWQgPSBjb2RlICsgJy0nICsgbnVtYmVyO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gaWQ7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBDb252ZXJ0IGpleGNlbCBpZCB0byBleGNlbCBsaWtlIGNvbHVtbiBuYW1lXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIHN0cmluZyBpZFxyXG4gICAgICogQHJldHVybiBzdHJpbmcgaWRcclxuICAgICAqL1xyXG4gICAgamV4Y2VsLmdldENvbHVtbk5hbWVGcm9tSWQgPSBmdW5jdGlvbiAoY2VsbElkKSB7XHJcbiAgICAgICAgaWYgKCFBcnJheS5pc0FycmF5KGNlbGxJZCkpIHtcclxuICAgICAgICAgICAgY2VsbElkID0gY2VsbElkLnNwbGl0KCctJyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gamV4Y2VsLmdldENvbHVtbk5hbWUocGFyc2VJbnQoY2VsbElkWzBdKSkgKyAocGFyc2VJbnQoY2VsbElkWzFdKSArIDEpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogVmVyaWZ5IGVsZW1lbnQgaW5zaWRlIGpleGNlbCB0YWJsZVxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBzdHJpbmcgaWRcclxuICAgICAqIEByZXR1cm4gc3RyaW5nIGlkXHJcbiAgICAgKi9cclxuICAgIGpleGNlbC5nZXRFbGVtZW50ID0gZnVuY3Rpb24gKGVsZW1lbnQpIHtcclxuICAgICAgICB2YXIgamV4Y2VsU2VjdGlvbiA9IDA7XHJcbiAgICAgICAgdmFyIGpleGNlbEVsZW1lbnQgPSAwO1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBwYXRoKGVsZW1lbnQpIHtcclxuICAgICAgICAgICAgaWYgKGVsZW1lbnQuY2xhc3NOYW1lKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoZWxlbWVudC5jbGFzc0xpc3QuY29udGFpbnMoJ2pleGNlbF9jb250YWluZXInKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGpleGNlbEVsZW1lbnQgPSBlbGVtZW50O1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAoZWxlbWVudC50YWdOYW1lID09ICdUSEVBRCcpIHtcclxuICAgICAgICAgICAgICAgIGpleGNlbFNlY3Rpb24gPSAxO1xyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKGVsZW1lbnQudGFnTmFtZSA9PSAnVEJPRFknKSB7XHJcbiAgICAgICAgICAgICAgICBqZXhjZWxTZWN0aW9uID0gMjtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKGVsZW1lbnQucGFyZW50Tm9kZSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKCFqZXhjZWxFbGVtZW50KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcGF0aChlbGVtZW50LnBhcmVudE5vZGUpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwYXRoKGVsZW1lbnQpO1xyXG4gICAgICAgIHJldHVybiBbamV4Y2VsRWxlbWVudCwgamV4Y2VsU2VjdGlvbl07XHJcbiAgICB9XHJcblxyXG4gICAgamV4Y2VsLmRvdWJsZURpZ2l0Rm9ybWF0ID0gZnVuY3Rpb24gKHYpIHtcclxuICAgICAgICB2ID0gJycgKyB2O1xyXG4gICAgICAgIGlmICh2Lmxlbmd0aCA9PSAxKSB7XHJcbiAgICAgICAgICAgIHYgPSAnMCcgKyB2O1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdjtcclxuICAgIH1cclxuXHJcbiAgICBqZXhjZWwuY3JlYXRlRnJvbVRhYmxlID0gZnVuY3Rpb24gKGVsLCBvcHRpb25zKSB7XHJcbiAgICAgICAgaWYgKGVsLnRhZ05hbWUgIT0gJ1RBQkxFJykge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZygnRWxlbWVudCBpcyBub3QgYSB0YWJsZScpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIC8vIENvbmZpZ3VyYXRpb25cclxuICAgICAgICAgICAgaWYgKCFvcHRpb25zKSB7XHJcbiAgICAgICAgICAgICAgICBvcHRpb25zID0ge307XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgb3B0aW9ucy5jb2x1bW5zID0gW107XHJcbiAgICAgICAgICAgIG9wdGlvbnMuZGF0YSA9IFtdO1xyXG5cclxuICAgICAgICAgICAgLy8gQ29sZ3JvdXBcclxuICAgICAgICAgICAgdmFyIGNvbGdyb3VwID0gZWwucXVlcnlTZWxlY3RvckFsbCgnY29sZ3JvdXAgPiBjb2wnKTtcclxuICAgICAgICAgICAgaWYgKGNvbGdyb3VwLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgLy8gR2V0IGNvbHVtbiB3aWR0aFxyXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBjb2xncm91cC5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciB3aWR0aCA9IGNvbGdyb3VwW2ldLnN0eWxlLndpZHRoO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICghd2lkdGgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHdpZHRoID0gY29sZ3JvdXBbaV0uZ2V0QXR0cmlidXRlKCd3aWR0aCcpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAvLyBTZXQgY29sdW1uIHdpZHRoXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHdpZHRoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghb3B0aW9ucy5jb2x1bW5zW2ldKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zLmNvbHVtbnNbaV0gPSB7fVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuY29sdW1uc1tpXS53aWR0aCA9IHdpZHRoO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gUGFyc2UgaGVhZGVyXHJcbiAgICAgICAgICAgIHZhciBwYXJzZUhlYWRlciA9IGZ1bmN0aW9uIChoZWFkZXIpIHtcclxuICAgICAgICAgICAgICAgIC8vIEdldCB3aWR0aCBpbmZvcm1hdGlvblxyXG4gICAgICAgICAgICAgICAgdmFyIGluZm8gPSBoZWFkZXIuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XHJcbiAgICAgICAgICAgICAgICB2YXIgd2lkdGggPSBpbmZvLndpZHRoID4gNTAgPyBpbmZvLndpZHRoIDogNTA7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gQ3JlYXRlIGNvbHVtbiBvcHRpb25cclxuICAgICAgICAgICAgICAgIGlmICghb3B0aW9ucy5jb2x1bW5zW2ldKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5jb2x1bW5zW2ldID0ge307XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAoaGVhZGVyLmdldEF0dHJpYnV0ZSgnZGF0YS1jZWxsdHlwZScpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5jb2x1bW5zW2ldLnR5cGUgPSBoZWFkZXIuZ2V0QXR0cmlidXRlKCdkYXRhLWNlbGx0eXBlJyk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuY29sdW1uc1tpXS50eXBlID0gJ3RleHQnO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgb3B0aW9ucy5jb2x1bW5zW2ldLndpZHRoID0gd2lkdGggKyAncHgnO1xyXG4gICAgICAgICAgICAgICAgb3B0aW9ucy5jb2x1bW5zW2ldLnRpdGxlID0gaGVhZGVyLmlubmVySFRNTDtcclxuICAgICAgICAgICAgICAgIG9wdGlvbnMuY29sdW1uc1tpXS5hbGlnbiA9IGhlYWRlci5zdHlsZS50ZXh0QWxpZ24gfHwgJ2NlbnRlcic7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIEhlYWRlcnNcclxuICAgICAgICAgICAgdmFyIGhlYWRlcnMgPSBlbC5xdWVyeVNlbGVjdG9yQWxsKCd0aGVhZCA+IHRyJyk7XHJcbiAgICAgICAgICAgIGlmIChoZWFkZXJzLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgLy8gR2V0IHRoZSBsYXN0IHJvdyBpbiB0aGUgdGhlYWRcclxuICAgICAgICAgICAgICAgIGhlYWRlcnMgPSBoZWFkZXJzW2hlYWRlcnMubGVuZ3RoIC0gMV0uY2hpbGRyZW47XHJcbiAgICAgICAgICAgICAgICAvLyBHbyB0aG91Z2ggdGhlIGhlYWRlcnNcclxuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgaGVhZGVycy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgIHBhcnNlSGVhZGVyKGhlYWRlcnNbaV0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBDb250ZW50XHJcbiAgICAgICAgICAgIHZhciByb3dOdW1iZXIgPSAwO1xyXG4gICAgICAgICAgICB2YXIgbWVyZ2VDZWxscyA9IHt9O1xyXG4gICAgICAgICAgICB2YXIgcm93cyA9IHt9O1xyXG4gICAgICAgICAgICB2YXIgc3R5bGUgPSB7fTtcclxuICAgICAgICAgICAgdmFyIGNsYXNzZXMgPSB7fTtcclxuXHJcbiAgICAgICAgICAgIHZhciBjb250ZW50ID0gZWwucXVlcnlTZWxlY3RvckFsbCgndGFibGUgPiB0ciwgdGJvZHkgdHInKTtcclxuICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBjb250ZW50Lmxlbmd0aDsgaisrKSB7XHJcbiAgICAgICAgICAgICAgICBvcHRpb25zLmRhdGFbcm93TnVtYmVyXSA9IFtdO1xyXG4gICAgICAgICAgICAgICAgaWYgKG9wdGlvbnMucGFyc2VUYWJsZUZpcnN0Um93QXNIZWFkZXIgPT0gdHJ1ZSAmJiAhaGVhZGVycy5sZW5ndGggJiYgaiA9PSAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBjb250ZW50W2pdLmNoaWxkcmVuLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHBhcnNlSGVhZGVyKGNvbnRlbnRbal0uY2hpbGRyZW5baV0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBjb250ZW50W2pdLmNoaWxkcmVuLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFdpY2tlZEdyaWQgZm9ybXVsYSBjb21wYXRpYmlsaXR5XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB2YWx1ZSA9IGNvbnRlbnRbal0uY2hpbGRyZW5baV0uZ2V0QXR0cmlidXRlKCdkYXRhLWZvcm11bGEnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodmFsdWUuc3Vic3RyKDAsIDEpICE9ICc9Jykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlID0gJz0nICsgdmFsdWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgdmFsdWUgPSBjb250ZW50W2pdLmNoaWxkcmVuW2ldLmlubmVySFRNTDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zLmRhdGFbcm93TnVtYmVyXS5wdXNoKHZhbHVlKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEtleVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgY2VsbE5hbWUgPSBqZXhjZWwuZ2V0Q29sdW1uTmFtZUZyb21JZChbaSwgal0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gQ2xhc3Nlc1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgdG1wID0gY29udGVudFtqXS5jaGlsZHJlbltpXS5nZXRBdHRyaWJ1dGUoJ2NsYXNzJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0bXApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzZXNbY2VsbE5hbWVdID0gdG1wO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBNZXJnZWQgY2VsbHNcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG1lcmdlZENvbHNwYW4gPSBwYXJzZUludChjb250ZW50W2pdLmNoaWxkcmVuW2ldLmdldEF0dHJpYnV0ZSgnY29sc3BhbicpKSB8fCAwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgbWVyZ2VkUm93c3BhbiA9IHBhcnNlSW50KGNvbnRlbnRbal0uY2hpbGRyZW5baV0uZ2V0QXR0cmlidXRlKCdyb3dzcGFuJykpIHx8IDA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChtZXJnZWRDb2xzcGFuIHx8IG1lcmdlZFJvd3NwYW4pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lcmdlQ2VsbHNbY2VsbE5hbWVdID0gW21lcmdlZENvbHNwYW4gfHwgMSwgbWVyZ2VkUm93c3BhbiB8fCAxXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gQXZvaWQgcHJvYmxlbXMgd2l0aCBoaWRkZW4gY2VsbHNcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHMgPSBjb250ZW50W2pdLmNoaWxkcmVuW2ldLnN0eWxlICYmIGNvbnRlbnRbal0uY2hpbGRyZW5baV0uc3R5bGUuZGlzcGxheSA9PSAnbm9uZScpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnRbal0uY2hpbGRyZW5baV0uc3R5bGUuZGlzcGxheSA9ICcnO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEdldCBzdHlsZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgcyA9IGNvbnRlbnRbal0uY2hpbGRyZW5baV0uZ2V0QXR0cmlidXRlKCdzdHlsZScpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAocykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3R5bGVbY2VsbE5hbWVdID0gcztcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBCb2xkXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjb250ZW50W2pdLmNoaWxkcmVuW2ldLmNsYXNzTGlzdC5jb250YWlucygnc3R5bGVCb2xkJykpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzdHlsZVtjZWxsTmFtZV0pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHlsZVtjZWxsTmFtZV0gKz0gJzsgZm9udC13ZWlnaHQ6Ym9sZDsnO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHlsZVtjZWxsTmFtZV0gPSAnZm9udC13ZWlnaHQ6Ym9sZDsnO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAvLyBSb3cgSGVpZ2h0XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNvbnRlbnRbal0uc3R5bGUgJiYgY29udGVudFtqXS5zdHlsZS5oZWlnaHQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcm93c1tqXSA9IHtoZWlnaHQ6IGNvbnRlbnRbal0uc3R5bGUuaGVpZ2h0fTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIC8vIEluZGV4XHJcbiAgICAgICAgICAgICAgICAgICAgcm93TnVtYmVyKys7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIFN0eWxlXHJcbiAgICAgICAgICAgIGlmIChPYmplY3Qua2V5cyhzdHlsZSkubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICAgICAgLy9vcHRpb25zLnN0eWxlID0gc3R5bGU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgLy8gTWVyZ2VkXHJcbiAgICAgICAgICAgIGlmIChPYmplY3Qua2V5cyhtZXJnZUNlbGxzKS5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgICAgICBvcHRpb25zLm1lcmdlQ2VsbHMgPSBtZXJnZUNlbGxzO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIC8vIFJvdyBoZWlnaHRcclxuICAgICAgICAgICAgaWYgKE9iamVjdC5rZXlzKHJvd3MpLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgIG9wdGlvbnMucm93cyA9IHJvd3M7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgLy8gQ2xhc3Nlc1xyXG4gICAgICAgICAgICBpZiAoT2JqZWN0LmtleXMoY2xhc3NlcykubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICAgICAgb3B0aW9ucy5jbGFzc2VzID0gY2xhc3NlcztcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gVE9ETzogZGF0YS1oaWRkZW5jb2x1bW5zPVwiMyw0XCJcclxuXHJcbiAgICAgICAgICAgIC8vIEkgZ3Vlc3MgaW4gdGVybXMgdGhlIGJldHRlciBjb2x1bW4gdHlwZVxyXG4gICAgICAgICAgICBpZiAob3B0aW9ucy5wYXJzZVRhYmxlQXV0b0NlbGxUeXBlID09IHRydWUpIHtcclxuICAgICAgICAgICAgICAgIHZhciBwYXR0ZXJuID0gW107XHJcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG9wdGlvbnMuY29sdW1ucy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciB0ZXN0ID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgdGVzdENhbGVuZGFyID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICBwYXR0ZXJuW2ldID0gW107XHJcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBvcHRpb25zLmRhdGEubGVuZ3RoOyBqKyspIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHZhbHVlID0gb3B0aW9ucy5kYXRhW2pdW2ldO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXBhdHRlcm5baV1bdmFsdWVdKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXR0ZXJuW2ldW3ZhbHVlXSA9IDA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgcGF0dGVybltpXVt2YWx1ZV0rKztcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlLmxlbmd0aCA+IDI1KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZXN0ID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlLmxlbmd0aCA9PSAxMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCEodmFsdWUuc3Vic3RyKDQsIDEpID09ICctJyAmJiB2YWx1ZS5zdWJzdHIoNywgMSkgPT0gJy0nKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRlc3RDYWxlbmRhciA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGVzdENhbGVuZGFyID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHZhciBrZXlzID0gT2JqZWN0LmtleXMocGF0dGVybltpXSkubGVuZ3RoO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0ZXN0Q2FsZW5kYXIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5jb2x1bW5zW2ldLnR5cGUgPSAnY2FsZW5kYXInO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodGVzdCA9PSB0cnVlICYmIGtleXMgPiAxICYmIGtleXMgPD0gcGFyc2VJbnQob3B0aW9ucy5kYXRhLmxlbmd0aCAqIDAuMSkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5jb2x1bW5zW2ldLnR5cGUgPSAnZHJvcGRvd24nO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zLmNvbHVtbnNbaV0uc291cmNlID0gT2JqZWN0LmtleXMocGF0dGVybltpXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gb3B0aW9ucztcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBKcXVlcnkgU3VwcG9ydFxyXG4gICAgICovXHJcbiAgICBpZiAodHlwZW9mIChqUXVlcnkpICE9ICd1bmRlZmluZWQnKSB7XHJcbiAgICAgICAgKGZ1bmN0aW9uICgkKSB7XHJcbiAgICAgICAgICAgICQuZm4uamV4Y2VsID0gZnVuY3Rpb24gKG1ldGhvZCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIHNwcmVhZHNoZWV0Q29udGFpbmVyID0gJCh0aGlzKS5nZXQoMCk7XHJcbiAgICAgICAgICAgICAgICBpZiAoIXNwcmVhZHNoZWV0Q29udGFpbmVyLmpleGNlbCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBqZXhjZWwoJCh0aGlzKS5nZXQoMCksIGFyZ3VtZW50c1swXSk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBzcHJlYWRzaGVldENvbnRhaW5lci5qZXhjZWxbbWV0aG9kXS5hcHBseSh0aGlzLCBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMsIDEpKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgfSkoalF1ZXJ5KTtcclxuICAgIH1cclxuXHJcblxyXG4gICAgLy8gQmFzZWQgb24gc3V0b2lrdSB3b3JrIChodHRwczovL2dpdGh1Yi5jb20vc3V0b2lrdSlcclxuXHJcbiAgICB2YXIgZXJyb3IgPSAoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHZhciBleHBvcnRzID0ge307XHJcblxyXG4gICAgICAgIGV4cG9ydHMubmlsID0gbmV3IEVycm9yKCcjTlVMTCEnKTtcclxuICAgICAgICBleHBvcnRzLmRpdjAgPSBuZXcgRXJyb3IoJyNESVYvMCEnKTtcclxuICAgICAgICBleHBvcnRzLnZhbHVlID0gbmV3IEVycm9yKCcjVkFMVUUhJyk7XHJcbiAgICAgICAgZXhwb3J0cy5yZWYgPSBuZXcgRXJyb3IoJyNSRUYhJyk7XHJcbiAgICAgICAgZXhwb3J0cy5uYW1lID0gbmV3IEVycm9yKCcjTkFNRT8nKTtcclxuICAgICAgICBleHBvcnRzLm51bSA9IG5ldyBFcnJvcignI05VTSEnKTtcclxuICAgICAgICBleHBvcnRzLm5hID0gbmV3IEVycm9yKCcjTi9BJyk7XHJcbiAgICAgICAgZXhwb3J0cy5lcnJvciA9IG5ldyBFcnJvcignI0VSUk9SIScpO1xyXG4gICAgICAgIGV4cG9ydHMuZGF0YSA9IG5ldyBFcnJvcignI0dFVFRJTkdfREFUQScpO1xyXG5cclxuICAgICAgICByZXR1cm4gZXhwb3J0cztcclxuICAgIH0pKCk7XHJcblxyXG4gICAgdmFyIHV0aWxzID0gKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB2YXIgZXhwb3J0cyA9IHt9O1xyXG5cclxuICAgICAgICBleHBvcnRzLmZsYXR0ZW5TaGFsbG93ID0gZnVuY3Rpb24gKGFycmF5KSB7XHJcbiAgICAgICAgICAgIGlmICghYXJyYXkgfHwgIWFycmF5LnJlZHVjZSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGFycmF5O1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gYXJyYXkucmVkdWNlKGZ1bmN0aW9uIChhLCBiKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgYUlzQXJyYXkgPSBBcnJheS5pc0FycmF5KGEpO1xyXG4gICAgICAgICAgICAgICAgdmFyIGJJc0FycmF5ID0gQXJyYXkuaXNBcnJheShiKTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoYUlzQXJyYXkgJiYgYklzQXJyYXkpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gYS5jb25jYXQoYik7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAoYUlzQXJyYXkpIHtcclxuICAgICAgICAgICAgICAgICAgICBhLnB1c2goYik7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBhO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKGJJc0FycmF5KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFthXS5jb25jYXQoYik7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIFthLCBiXTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZXhwb3J0cy5pc0ZsYXQgPSBmdW5jdGlvbiAoYXJyYXkpIHtcclxuICAgICAgICAgICAgaWYgKCFhcnJheSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGFycmF5Lmxlbmd0aDsgKytpKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShhcnJheVtpXSkpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGV4cG9ydHMuZmxhdHRlbiA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgdmFyIHJlc3VsdCA9IGV4cG9ydHMuYXJnc1RvQXJyYXkuYXBwbHkobnVsbCwgYXJndW1lbnRzKTtcclxuXHJcbiAgICAgICAgICAgIHdoaWxlICghZXhwb3J0cy5pc0ZsYXQocmVzdWx0KSkge1xyXG4gICAgICAgICAgICAgICAgcmVzdWx0ID0gZXhwb3J0cy5mbGF0dGVuU2hhbGxvdyhyZXN1bHQpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGV4cG9ydHMuYXJnc1RvQXJyYXkgPSBmdW5jdGlvbiAoYXJncykge1xyXG4gICAgICAgICAgICB2YXIgcmVzdWx0ID0gW107XHJcblxyXG4gICAgICAgICAgICBleHBvcnRzLmFycmF5RWFjaChhcmdzLCBmdW5jdGlvbiAodmFsdWUpIHtcclxuICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKHZhbHVlKTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGV4cG9ydHMubnVtYmVycyA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgdmFyIHBvc3NpYmxlTnVtYmVycyA9IHRoaXMuZmxhdHRlbi5hcHBseShudWxsLCBhcmd1bWVudHMpO1xyXG4gICAgICAgICAgICByZXR1cm4gcG9zc2libGVOdW1iZXJzLmZpbHRlcihmdW5jdGlvbiAoZWwpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0eXBlb2YgZWwgPT09ICdudW1iZXInO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBleHBvcnRzLmNsZWFuRmxvYXQgPSBmdW5jdGlvbiAobnVtYmVyKSB7XHJcbiAgICAgICAgICAgIHZhciBwb3dlciA9IDFlMTQ7XHJcbiAgICAgICAgICAgIHJldHVybiBNYXRoLnJvdW5kKG51bWJlciAqIHBvd2VyKSAvIHBvd2VyO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGV4cG9ydHMucGFyc2VCb29sID0gZnVuY3Rpb24gKGJvb2wpIHtcclxuICAgICAgICAgICAgaWYgKHR5cGVvZiBib29sID09PSAnYm9vbGVhbicpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBib29sO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAoYm9vbCBpbnN0YW5jZW9mIEVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gYm9vbDtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKHR5cGVvZiBib29sID09PSAnbnVtYmVyJykge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGJvb2wgIT09IDA7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmICh0eXBlb2YgYm9vbCA9PT0gJ3N0cmluZycpIHtcclxuICAgICAgICAgICAgICAgIHZhciB1cCA9IGJvb2wudG9VcHBlckNhc2UoKTtcclxuICAgICAgICAgICAgICAgIGlmICh1cCA9PT0gJ1RSVUUnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKHVwID09PSAnRkFMU0UnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAoYm9vbCBpbnN0YW5jZW9mIERhdGUgJiYgIWlzTmFOKGJvb2wpKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgcmV0dXJuIGVycm9yLnZhbHVlO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGV4cG9ydHMucGFyc2VOdW1iZXIgPSBmdW5jdGlvbiAoc3RyaW5nKSB7XHJcbiAgICAgICAgICAgIGlmIChzdHJpbmcgPT09IHVuZGVmaW5lZCB8fCBzdHJpbmcgPT09ICcnKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZXJyb3IudmFsdWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKCFpc05hTihzdHJpbmcpKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gcGFyc2VGbG9hdChzdHJpbmcpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gZXJyb3IudmFsdWU7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZXhwb3J0cy5wYXJzZU51bWJlckFycmF5ID0gZnVuY3Rpb24gKGFycikge1xyXG4gICAgICAgICAgICB2YXIgbGVuO1xyXG5cclxuICAgICAgICAgICAgaWYgKCFhcnIgfHwgKGxlbiA9IGFyci5sZW5ndGgpID09PSAwKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZXJyb3IudmFsdWU7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHZhciBwYXJzZWQ7XHJcblxyXG4gICAgICAgICAgICB3aGlsZSAobGVuLS0pIHtcclxuICAgICAgICAgICAgICAgIHBhcnNlZCA9IGV4cG9ydHMucGFyc2VOdW1iZXIoYXJyW2xlbl0pO1xyXG4gICAgICAgICAgICAgICAgaWYgKHBhcnNlZCA9PT0gZXJyb3IudmFsdWUpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcGFyc2VkO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgYXJyW2xlbl0gPSBwYXJzZWQ7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHJldHVybiBhcnI7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZXhwb3J0cy5wYXJzZU1hdHJpeCA9IGZ1bmN0aW9uIChtYXRyaXgpIHtcclxuICAgICAgICAgICAgdmFyIG47XHJcblxyXG4gICAgICAgICAgICBpZiAoIW1hdHJpeCB8fCAobiA9IG1hdHJpeC5sZW5ndGgpID09PSAwKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZXJyb3IudmFsdWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdmFyIHBuYXJyO1xyXG5cclxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBtYXRyaXgubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgIHBuYXJyID0gZXhwb3J0cy5wYXJzZU51bWJlckFycmF5KG1hdHJpeFtpXSk7XHJcbiAgICAgICAgICAgICAgICBtYXRyaXhbaV0gPSBwbmFycjtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAocG5hcnIgaW5zdGFuY2VvZiBFcnJvcikge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBwbmFycjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgcmV0dXJuIG1hdHJpeDtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZDE5MDAgPSBuZXcgRGF0ZShEYXRlLlVUQygxOTAwLCAwLCAxKSk7XHJcbiAgICAgICAgZXhwb3J0cy5wYXJzZURhdGUgPSBmdW5jdGlvbiAoZGF0ZSkge1xyXG4gICAgICAgICAgICBpZiAoIWlzTmFOKGRhdGUpKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoZGF0ZSBpbnN0YW5jZW9mIERhdGUpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IERhdGUoZGF0ZSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB2YXIgZCA9IHBhcnNlSW50KGRhdGUsIDEwKTtcclxuICAgICAgICAgICAgICAgIGlmIChkIDwgMCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBlcnJvci5udW07XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAoZCA8PSA2MCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgRGF0ZShkMTkwMC5nZXRUaW1lKCkgKyAoZCAtIDEpICogODY0MDAwMDApO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBEYXRlKGQxOTAwLmdldFRpbWUoKSArIChkIC0gMikgKiA4NjQwMDAwMCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKHR5cGVvZiBkYXRlID09PSAnc3RyaW5nJykge1xyXG4gICAgICAgICAgICAgICAgZGF0ZSA9IG5ldyBEYXRlKGRhdGUpO1xyXG4gICAgICAgICAgICAgICAgaWYgKCFpc05hTihkYXRlKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBkYXRlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBlcnJvci52YWx1ZTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBleHBvcnRzLnBhcnNlRGF0ZUFycmF5ID0gZnVuY3Rpb24gKGFycikge1xyXG4gICAgICAgICAgICB2YXIgbGVuID0gYXJyLmxlbmd0aDtcclxuICAgICAgICAgICAgdmFyIHBhcnNlZDtcclxuICAgICAgICAgICAgd2hpbGUgKGxlbi0tKSB7XHJcbiAgICAgICAgICAgICAgICBwYXJzZWQgPSB0aGlzLnBhcnNlRGF0ZShhcnJbbGVuXSk7XHJcbiAgICAgICAgICAgICAgICBpZiAocGFyc2VkID09PSBlcnJvci52YWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBwYXJzZWQ7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBhcnJbbGVuXSA9IHBhcnNlZDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gYXJyO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGV4cG9ydHMuYW55SXNFcnJvciA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgdmFyIG4gPSBhcmd1bWVudHMubGVuZ3RoO1xyXG4gICAgICAgICAgICB3aGlsZSAobi0tKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoYXJndW1lbnRzW25dIGluc3RhbmNlb2YgRXJyb3IpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZXhwb3J0cy5hcnJheVZhbHVlc1RvTnVtYmVycyA9IGZ1bmN0aW9uIChhcnIpIHtcclxuICAgICAgICAgICAgdmFyIG4gPSBhcnIubGVuZ3RoO1xyXG4gICAgICAgICAgICB2YXIgZWw7XHJcbiAgICAgICAgICAgIHdoaWxlIChuLS0pIHtcclxuICAgICAgICAgICAgICAgIGVsID0gYXJyW25dO1xyXG4gICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBlbCA9PT0gJ251bWJlcicpIHtcclxuICAgICAgICAgICAgICAgICAgICBjb250aW51ZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmIChlbCA9PT0gdHJ1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGFycltuXSA9IDE7XHJcbiAgICAgICAgICAgICAgICAgICAgY29udGludWU7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAoZWwgPT09IGZhbHNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgYXJyW25dID0gMDtcclxuICAgICAgICAgICAgICAgICAgICBjb250aW51ZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgZWwgPT09ICdzdHJpbmcnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIG51bWJlciA9IHRoaXMucGFyc2VOdW1iZXIoZWwpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChudW1iZXIgaW5zdGFuY2VvZiBFcnJvcikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBhcnJbbl0gPSAwO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFycltuXSA9IG51bWJlcjtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIGFycjtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBleHBvcnRzLnJlc3QgPSBmdW5jdGlvbiAoYXJyYXksIGlkeCkge1xyXG4gICAgICAgICAgICBpZHggPSBpZHggfHwgMTtcclxuICAgICAgICAgICAgaWYgKCFhcnJheSB8fCB0eXBlb2YgYXJyYXkuc2xpY2UgIT09ICdmdW5jdGlvbicpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBhcnJheTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gYXJyYXkuc2xpY2UoaWR4KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBleHBvcnRzLmluaXRpYWwgPSBmdW5jdGlvbiAoYXJyYXksIGlkeCkge1xyXG4gICAgICAgICAgICBpZHggPSBpZHggfHwgMTtcclxuICAgICAgICAgICAgaWYgKCFhcnJheSB8fCB0eXBlb2YgYXJyYXkuc2xpY2UgIT09ICdmdW5jdGlvbicpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBhcnJheTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gYXJyYXkuc2xpY2UoMCwgYXJyYXkubGVuZ3RoIC0gaWR4KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBleHBvcnRzLmFycmF5RWFjaCA9IGZ1bmN0aW9uIChhcnJheSwgaXRlcmF0ZWUpIHtcclxuICAgICAgICAgICAgdmFyIGluZGV4ID0gLTEsIGxlbmd0aCA9IGFycmF5Lmxlbmd0aDtcclxuXHJcbiAgICAgICAgICAgIHdoaWxlICgrK2luZGV4IDwgbGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoaXRlcmF0ZWUoYXJyYXlbaW5kZXhdLCBpbmRleCwgYXJyYXkpID09PSBmYWxzZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gYXJyYXk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZXhwb3J0cy50cmFuc3Bvc2UgPSBmdW5jdGlvbiAobWF0cml4KSB7XHJcbiAgICAgICAgICAgIGlmICghbWF0cml4KSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZXJyb3IudmFsdWU7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHJldHVybiBtYXRyaXhbMF0ubWFwKGZ1bmN0aW9uIChjb2wsIGkpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBtYXRyaXgubWFwKGZ1bmN0aW9uIChyb3cpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcm93W2ldO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHJldHVybiBleHBvcnRzO1xyXG4gICAgfSkoKTtcclxuXHJcbiAgICBqZXhjZWwubWV0aG9kcyA9IHt9O1xyXG5cclxuICAgIGpleGNlbC5tZXRob2RzLmRhdGV0aW1lID0gKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB2YXIgZXhwb3J0cyA9IHt9O1xyXG5cclxuICAgICAgICB2YXIgZDE5MDAgPSBuZXcgRGF0ZSgxOTAwLCAwLCAxKTtcclxuICAgICAgICB2YXIgV0VFS19TVEFSVFMgPSBbXHJcbiAgICAgICAgICAgIHVuZGVmaW5lZCxcclxuICAgICAgICAgICAgMCxcclxuICAgICAgICAgICAgMSxcclxuICAgICAgICAgICAgdW5kZWZpbmVkLFxyXG4gICAgICAgICAgICB1bmRlZmluZWQsXHJcbiAgICAgICAgICAgIHVuZGVmaW5lZCxcclxuICAgICAgICAgICAgdW5kZWZpbmVkLFxyXG4gICAgICAgICAgICB1bmRlZmluZWQsXHJcbiAgICAgICAgICAgIHVuZGVmaW5lZCxcclxuICAgICAgICAgICAgdW5kZWZpbmVkLFxyXG4gICAgICAgICAgICB1bmRlZmluZWQsXHJcbiAgICAgICAgICAgIHVuZGVmaW5lZCxcclxuICAgICAgICAgICAgMSxcclxuICAgICAgICAgICAgMixcclxuICAgICAgICAgICAgMyxcclxuICAgICAgICAgICAgNCxcclxuICAgICAgICAgICAgNSxcclxuICAgICAgICAgICAgNixcclxuICAgICAgICAgICAgMFxyXG4gICAgICAgIF07XHJcbiAgICAgICAgdmFyIFdFRUtfVFlQRVMgPSBbXHJcbiAgICAgICAgICAgIFtdLFxyXG4gICAgICAgICAgICBbMSwgMiwgMywgNCwgNSwgNiwgN10sXHJcbiAgICAgICAgICAgIFs3LCAxLCAyLCAzLCA0LCA1LCA2XSxcclxuICAgICAgICAgICAgWzYsIDAsIDEsIDIsIDMsIDQsIDVdLFxyXG4gICAgICAgICAgICBbXSxcclxuICAgICAgICAgICAgW10sXHJcbiAgICAgICAgICAgIFtdLFxyXG4gICAgICAgICAgICBbXSxcclxuICAgICAgICAgICAgW10sXHJcbiAgICAgICAgICAgIFtdLFxyXG4gICAgICAgICAgICBbXSxcclxuICAgICAgICAgICAgWzcsIDEsIDIsIDMsIDQsIDUsIDZdLFxyXG4gICAgICAgICAgICBbNiwgNywgMSwgMiwgMywgNCwgNV0sXHJcbiAgICAgICAgICAgIFs1LCA2LCA3LCAxLCAyLCAzLCA0XSxcclxuICAgICAgICAgICAgWzQsIDUsIDYsIDcsIDEsIDIsIDNdLFxyXG4gICAgICAgICAgICBbMywgNCwgNSwgNiwgNywgMSwgMl0sXHJcbiAgICAgICAgICAgIFsyLCAzLCA0LCA1LCA2LCA3LCAxXSxcclxuICAgICAgICAgICAgWzEsIDIsIDMsIDQsIDUsIDYsIDddXHJcbiAgICAgICAgXTtcclxuICAgICAgICB2YXIgV0VFS0VORF9UWVBFUyA9IFtcclxuICAgICAgICAgICAgW10sXHJcbiAgICAgICAgICAgIFs2LCAwXSxcclxuICAgICAgICAgICAgWzAsIDFdLFxyXG4gICAgICAgICAgICBbMSwgMl0sXHJcbiAgICAgICAgICAgIFsyLCAzXSxcclxuICAgICAgICAgICAgWzMsIDRdLFxyXG4gICAgICAgICAgICBbNCwgNV0sXHJcbiAgICAgICAgICAgIFs1LCA2XSxcclxuICAgICAgICAgICAgdW5kZWZpbmVkLFxyXG4gICAgICAgICAgICB1bmRlZmluZWQsXHJcbiAgICAgICAgICAgIHVuZGVmaW5lZCwgWzAsIDBdLFxyXG4gICAgICAgICAgICBbMSwgMV0sXHJcbiAgICAgICAgICAgIFsyLCAyXSxcclxuICAgICAgICAgICAgWzMsIDNdLFxyXG4gICAgICAgICAgICBbNCwgNF0sXHJcbiAgICAgICAgICAgIFs1LCA1XSxcclxuICAgICAgICAgICAgWzYsIDZdXHJcbiAgICAgICAgXTtcclxuXHJcbiAgICAgICAgZXhwb3J0cy5EQVRFID0gZnVuY3Rpb24gKHllYXIsIG1vbnRoLCBkYXkpIHtcclxuICAgICAgICAgICAgeWVhciA9IHV0aWxzLnBhcnNlTnVtYmVyKHllYXIpO1xyXG4gICAgICAgICAgICBtb250aCA9IHV0aWxzLnBhcnNlTnVtYmVyKG1vbnRoKTtcclxuICAgICAgICAgICAgZGF5ID0gdXRpbHMucGFyc2VOdW1iZXIoZGF5KTtcclxuICAgICAgICAgICAgaWYgKHV0aWxzLmFueUlzRXJyb3IoeWVhciwgbW9udGgsIGRheSkpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBlcnJvci52YWx1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoeWVhciA8IDAgfHwgbW9udGggPCAwIHx8IGRheSA8IDApIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBlcnJvci5udW07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdmFyIGRhdGUgPSBuZXcgRGF0ZSh5ZWFyLCBtb250aCAtIDEsIGRheSk7XHJcbiAgICAgICAgICAgIHJldHVybiBkYXRlO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGV4cG9ydHMuREFURVZBTFVFID0gZnVuY3Rpb24gKGRhdGVfdGV4dCkge1xyXG4gICAgICAgICAgICBpZiAodHlwZW9mIGRhdGVfdGV4dCAhPT0gJ3N0cmluZycpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBlcnJvci52YWx1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB2YXIgZGF0ZSA9IERhdGUucGFyc2UoZGF0ZV90ZXh0KTtcclxuICAgICAgICAgICAgaWYgKGlzTmFOKGRhdGUpKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZXJyb3IudmFsdWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKGRhdGUgPD0gLTIyMDM4OTEyMDAwMDApIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiAoZGF0ZSAtIGQxOTAwKSAvIDg2NDAwMDAwICsgMTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gKGRhdGUgLSBkMTkwMCkgLyA4NjQwMDAwMCArIDI7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZXhwb3J0cy5EQVkgPSBmdW5jdGlvbiAoc2VyaWFsX251bWJlcikge1xyXG4gICAgICAgICAgICB2YXIgZGF0ZSA9IHV0aWxzLnBhcnNlRGF0ZShzZXJpYWxfbnVtYmVyKTtcclxuICAgICAgICAgICAgaWYgKGRhdGUgaW5zdGFuY2VvZiBFcnJvcikge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGRhdGU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIGRhdGUuZ2V0RGF0ZSgpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGV4cG9ydHMuREFZUyA9IGZ1bmN0aW9uIChlbmRfZGF0ZSwgc3RhcnRfZGF0ZSkge1xyXG4gICAgICAgICAgICBlbmRfZGF0ZSA9IHV0aWxzLnBhcnNlRGF0ZShlbmRfZGF0ZSk7XHJcbiAgICAgICAgICAgIHN0YXJ0X2RhdGUgPSB1dGlscy5wYXJzZURhdGUoc3RhcnRfZGF0ZSk7XHJcbiAgICAgICAgICAgIGlmIChlbmRfZGF0ZSBpbnN0YW5jZW9mIEVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZW5kX2RhdGU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKHN0YXJ0X2RhdGUgaW5zdGFuY2VvZiBFcnJvcikge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHN0YXJ0X2RhdGU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIHNlcmlhbChlbmRfZGF0ZSkgLSBzZXJpYWwoc3RhcnRfZGF0ZSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZXhwb3J0cy5EQVlTMzYwID0gZnVuY3Rpb24gKHN0YXJ0X2RhdGUsIGVuZF9kYXRlLCBtZXRob2QpIHtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBleHBvcnRzLkVEQVRFID0gZnVuY3Rpb24gKHN0YXJ0X2RhdGUsIG1vbnRocykge1xyXG4gICAgICAgICAgICBzdGFydF9kYXRlID0gdXRpbHMucGFyc2VEYXRlKHN0YXJ0X2RhdGUpO1xyXG4gICAgICAgICAgICBpZiAoc3RhcnRfZGF0ZSBpbnN0YW5jZW9mIEVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gc3RhcnRfZGF0ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoaXNOYU4obW9udGhzKSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGVycm9yLnZhbHVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIG1vbnRocyA9IHBhcnNlSW50KG1vbnRocywgMTApO1xyXG4gICAgICAgICAgICBzdGFydF9kYXRlLnNldE1vbnRoKHN0YXJ0X2RhdGUuZ2V0TW9udGgoKSArIG1vbnRocyk7XHJcbiAgICAgICAgICAgIHJldHVybiBzZXJpYWwoc3RhcnRfZGF0ZSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZXhwb3J0cy5FT01PTlRIID0gZnVuY3Rpb24gKHN0YXJ0X2RhdGUsIG1vbnRocykge1xyXG4gICAgICAgICAgICBzdGFydF9kYXRlID0gdXRpbHMucGFyc2VEYXRlKHN0YXJ0X2RhdGUpO1xyXG4gICAgICAgICAgICBpZiAoc3RhcnRfZGF0ZSBpbnN0YW5jZW9mIEVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gc3RhcnRfZGF0ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoaXNOYU4obW9udGhzKSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGVycm9yLnZhbHVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIG1vbnRocyA9IHBhcnNlSW50KG1vbnRocywgMTApO1xyXG4gICAgICAgICAgICByZXR1cm4gc2VyaWFsKG5ldyBEYXRlKHN0YXJ0X2RhdGUuZ2V0RnVsbFllYXIoKSwgc3RhcnRfZGF0ZS5nZXRNb250aCgpICsgbW9udGhzICsgMSwgMCkpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGV4cG9ydHMuSE9VUiA9IGZ1bmN0aW9uIChzZXJpYWxfbnVtYmVyKSB7XHJcbiAgICAgICAgICAgIHNlcmlhbF9udW1iZXIgPSB1dGlscy5wYXJzZURhdGUoc2VyaWFsX251bWJlcik7XHJcbiAgICAgICAgICAgIGlmIChzZXJpYWxfbnVtYmVyIGluc3RhbmNlb2YgRXJyb3IpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBzZXJpYWxfbnVtYmVyO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBzZXJpYWxfbnVtYmVyLmdldEhvdXJzKCk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZXhwb3J0cy5JTlRFUlZBTCA9IGZ1bmN0aW9uIChzZWNvbmQpIHtcclxuICAgICAgICAgICAgaWYgKHR5cGVvZiBzZWNvbmQgIT09ICdudW1iZXInICYmIHR5cGVvZiBzZWNvbmQgIT09ICdzdHJpbmcnKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZXJyb3IudmFsdWU7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBzZWNvbmQgPSBwYXJzZUludChzZWNvbmQsIDEwKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgdmFyIHllYXIgPSBNYXRoLmZsb29yKHNlY29uZCAvIDk0NjA4MDAwMCk7XHJcbiAgICAgICAgICAgIHNlY29uZCA9IHNlY29uZCAlIDk0NjA4MDAwMDtcclxuICAgICAgICAgICAgdmFyIG1vbnRoID0gTWF0aC5mbG9vcihzZWNvbmQgLyAyNTkyMDAwKTtcclxuICAgICAgICAgICAgc2Vjb25kID0gc2Vjb25kICUgMjU5MjAwMDtcclxuICAgICAgICAgICAgdmFyIGRheSA9IE1hdGguZmxvb3Ioc2Vjb25kIC8gODY0MDApO1xyXG4gICAgICAgICAgICBzZWNvbmQgPSBzZWNvbmQgJSA4NjQwMDtcclxuXHJcbiAgICAgICAgICAgIHZhciBob3VyID0gTWF0aC5mbG9vcihzZWNvbmQgLyAzNjAwKTtcclxuICAgICAgICAgICAgc2Vjb25kID0gc2Vjb25kICUgMzYwMDtcclxuICAgICAgICAgICAgdmFyIG1pbiA9IE1hdGguZmxvb3Ioc2Vjb25kIC8gNjApO1xyXG4gICAgICAgICAgICBzZWNvbmQgPSBzZWNvbmQgJSA2MDtcclxuICAgICAgICAgICAgdmFyIHNlYyA9IHNlY29uZDtcclxuXHJcbiAgICAgICAgICAgIHllYXIgPSAoeWVhciA+IDApID8geWVhciArICdZJyA6ICcnO1xyXG4gICAgICAgICAgICBtb250aCA9IChtb250aCA+IDApID8gbW9udGggKyAnTScgOiAnJztcclxuICAgICAgICAgICAgZGF5ID0gKGRheSA+IDApID8gZGF5ICsgJ0QnIDogJyc7XHJcbiAgICAgICAgICAgIGhvdXIgPSAoaG91ciA+IDApID8gaG91ciArICdIJyA6ICcnO1xyXG4gICAgICAgICAgICBtaW4gPSAobWluID4gMCkgPyBtaW4gKyAnTScgOiAnJztcclxuICAgICAgICAgICAgc2VjID0gKHNlYyA+IDApID8gc2VjICsgJ1MnIDogJyc7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gJ1AnICsgeWVhciArIG1vbnRoICsgZGF5ICsgJ1QnICsgaG91ciArIG1pbiArIHNlYztcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBleHBvcnRzLklTT1dFRUtOVU0gPSBmdW5jdGlvbiAoZGF0ZSkge1xyXG4gICAgICAgICAgICBkYXRlID0gdXRpbHMucGFyc2VEYXRlKGRhdGUpO1xyXG4gICAgICAgICAgICBpZiAoZGF0ZSBpbnN0YW5jZW9mIEVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZGF0ZTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgZGF0ZS5zZXRIb3VycygwLCAwLCAwKTtcclxuICAgICAgICAgICAgZGF0ZS5zZXREYXRlKGRhdGUuZ2V0RGF0ZSgpICsgNCAtIChkYXRlLmdldERheSgpIHx8IDcpKTtcclxuICAgICAgICAgICAgdmFyIHllYXJTdGFydCA9IG5ldyBEYXRlKGRhdGUuZ2V0RnVsbFllYXIoKSwgMCwgMSk7XHJcbiAgICAgICAgICAgIHJldHVybiBNYXRoLmNlaWwoKCgoZGF0ZSAtIHllYXJTdGFydCkgLyA4NjQwMDAwMCkgKyAxKSAvIDcpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGV4cG9ydHMuTUlOVVRFID0gZnVuY3Rpb24gKHNlcmlhbF9udW1iZXIpIHtcclxuICAgICAgICAgICAgc2VyaWFsX251bWJlciA9IHV0aWxzLnBhcnNlRGF0ZShzZXJpYWxfbnVtYmVyKTtcclxuICAgICAgICAgICAgaWYgKHNlcmlhbF9udW1iZXIgaW5zdGFuY2VvZiBFcnJvcikge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHNlcmlhbF9udW1iZXI7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIHNlcmlhbF9udW1iZXIuZ2V0TWludXRlcygpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGV4cG9ydHMuTU9OVEggPSBmdW5jdGlvbiAoc2VyaWFsX251bWJlcikge1xyXG4gICAgICAgICAgICBzZXJpYWxfbnVtYmVyID0gdXRpbHMucGFyc2VEYXRlKHNlcmlhbF9udW1iZXIpO1xyXG4gICAgICAgICAgICBpZiAoc2VyaWFsX251bWJlciBpbnN0YW5jZW9mIEVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gc2VyaWFsX251bWJlcjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gc2VyaWFsX251bWJlci5nZXRNb250aCgpICsgMTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBleHBvcnRzLk5FVFdPUktEQVlTID0gZnVuY3Rpb24gKHN0YXJ0X2RhdGUsIGVuZF9kYXRlLCBob2xpZGF5cykge1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGV4cG9ydHMuTkVUV09SS0RBWVMuSU5UTCA9IGZ1bmN0aW9uIChzdGFydF9kYXRlLCBlbmRfZGF0ZSwgd2Vla2VuZCwgaG9saWRheXMpIHtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBleHBvcnRzLk5PVyA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBEYXRlKCk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZXhwb3J0cy5TRUNPTkQgPSBmdW5jdGlvbiAoc2VyaWFsX251bWJlcikge1xyXG4gICAgICAgICAgICBzZXJpYWxfbnVtYmVyID0gdXRpbHMucGFyc2VEYXRlKHNlcmlhbF9udW1iZXIpO1xyXG4gICAgICAgICAgICBpZiAoc2VyaWFsX251bWJlciBpbnN0YW5jZW9mIEVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gc2VyaWFsX251bWJlcjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gc2VyaWFsX251bWJlci5nZXRTZWNvbmRzKCk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZXhwb3J0cy5USU1FID0gZnVuY3Rpb24gKGhvdXIsIG1pbnV0ZSwgc2Vjb25kKSB7XHJcbiAgICAgICAgICAgIGhvdXIgPSB1dGlscy5wYXJzZU51bWJlcihob3VyKTtcclxuICAgICAgICAgICAgbWludXRlID0gdXRpbHMucGFyc2VOdW1iZXIobWludXRlKTtcclxuICAgICAgICAgICAgc2Vjb25kID0gdXRpbHMucGFyc2VOdW1iZXIoc2Vjb25kKTtcclxuICAgICAgICAgICAgaWYgKHV0aWxzLmFueUlzRXJyb3IoaG91ciwgbWludXRlLCBzZWNvbmQpKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZXJyb3IudmFsdWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKGhvdXIgPCAwIHx8IG1pbnV0ZSA8IDAgfHwgc2Vjb25kIDwgMCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGVycm9yLm51bTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gKDM2MDAgKiBob3VyICsgNjAgKiBtaW51dGUgKyBzZWNvbmQpIC8gODY0MDA7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZXhwb3J0cy5USU1FVkFMVUUgPSBmdW5jdGlvbiAodGltZV90ZXh0KSB7XHJcbiAgICAgICAgICAgIHRpbWVfdGV4dCA9IHV0aWxzLnBhcnNlRGF0ZSh0aW1lX3RleHQpO1xyXG4gICAgICAgICAgICBpZiAodGltZV90ZXh0IGluc3RhbmNlb2YgRXJyb3IpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0aW1lX3RleHQ7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuICgzNjAwICogdGltZV90ZXh0LmdldEhvdXJzKCkgKyA2MCAqIHRpbWVfdGV4dC5nZXRNaW51dGVzKCkgKyB0aW1lX3RleHQuZ2V0U2Vjb25kcygpKSAvIDg2NDAwO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGV4cG9ydHMuVE9EQVkgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgRGF0ZSgpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGV4cG9ydHMuV0VFS0RBWSA9IGZ1bmN0aW9uIChzZXJpYWxfbnVtYmVyLCByZXR1cm5fdHlwZSkge1xyXG4gICAgICAgICAgICBzZXJpYWxfbnVtYmVyID0gdXRpbHMucGFyc2VEYXRlKHNlcmlhbF9udW1iZXIpO1xyXG4gICAgICAgICAgICBpZiAoc2VyaWFsX251bWJlciBpbnN0YW5jZW9mIEVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gc2VyaWFsX251bWJlcjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAocmV0dXJuX3R5cGUgPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuX3R5cGUgPSAxO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHZhciBkYXkgPSBzZXJpYWxfbnVtYmVyLmdldERheSgpO1xyXG4gICAgICAgICAgICByZXR1cm4gV0VFS19UWVBFU1tyZXR1cm5fdHlwZV1bZGF5XTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBleHBvcnRzLldFRUtOVU0gPSBmdW5jdGlvbiAoc2VyaWFsX251bWJlciwgcmV0dXJuX3R5cGUpIHtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBleHBvcnRzLldPUktEQVkgPSBmdW5jdGlvbiAoc3RhcnRfZGF0ZSwgZGF5cywgaG9saWRheXMpIHtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBleHBvcnRzLldPUktEQVkuSU5UTCA9IGZ1bmN0aW9uIChzdGFydF9kYXRlLCBkYXlzLCB3ZWVrZW5kLCBob2xpZGF5cykge1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGV4cG9ydHMuWUVBUiA9IGZ1bmN0aW9uIChzZXJpYWxfbnVtYmVyKSB7XHJcbiAgICAgICAgICAgIHNlcmlhbF9udW1iZXIgPSB1dGlscy5wYXJzZURhdGUoc2VyaWFsX251bWJlcik7XHJcbiAgICAgICAgICAgIGlmIChzZXJpYWxfbnVtYmVyIGluc3RhbmNlb2YgRXJyb3IpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBzZXJpYWxfbnVtYmVyO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBzZXJpYWxfbnVtYmVyLmdldEZ1bGxZZWFyKCk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gaXNMZWFwWWVhcih5ZWFyKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgRGF0ZSh5ZWFyLCAxLCAyOSkuZ2V0TW9udGgoKSA9PT0gMTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGV4cG9ydHMuWUVBUkZSQUMgPSBmdW5jdGlvbiAoc3RhcnRfZGF0ZSwgZW5kX2RhdGUsIGJhc2lzKSB7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gc2VyaWFsKGRhdGUpIHtcclxuICAgICAgICAgICAgdmFyIGFkZE9uID0gKGRhdGUgPiAtMjIwMzg5MTIwMDAwMCkgPyAyIDogMTtcclxuICAgICAgICAgICAgcmV0dXJuIChkYXRlIC0gZDE5MDApIC8gODY0MDAwMDAgKyBhZGRPbjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBleHBvcnRzO1xyXG4gICAgfSkoKTtcclxuXHJcbiAgICBqZXhjZWwubWV0aG9kcy5kYXRhYmFzZSA9IChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdmFyIGV4cG9ydHMgPSB7fTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gY29tcGFjdChhcnJheSkge1xyXG4gICAgICAgICAgICBpZiAoIWFycmF5KSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gYXJyYXk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdmFyIHJlc3VsdCA9IFtdO1xyXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGFycmF5Lmxlbmd0aDsgKytpKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoIWFycmF5W2ldKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29udGludWU7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICByZXN1bHQucHVzaChhcnJheVtpXSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGV4cG9ydHMuRklOREZJRUxEID0gZnVuY3Rpb24gKGRhdGFiYXNlLCB0aXRsZSkge1xyXG4gICAgICAgICAgICB2YXIgaW5kZXggPSBudWxsO1xyXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGRhdGFiYXNlLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoZGF0YWJhc2VbaV1bMF0gPT09IHRpdGxlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaW5kZXggPSBpO1xyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBSZXR1cm4gZXJyb3IgaWYgdGhlIGlucHV0IGZpZWxkIHRpdGxlIGlzIGluY29ycmVjdFxyXG4gICAgICAgICAgICBpZiAoaW5kZXggPT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGVycm9yLnZhbHVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBpbmRleDtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBmaW5kUmVzdWx0SW5kZXgoZGF0YWJhc2UsIGNyaXRlcmlhcykge1xyXG4gICAgICAgICAgICB2YXIgbWF0Y2hlcyA9IHt9O1xyXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMTsgaSA8IGRhdGFiYXNlWzBdLmxlbmd0aDsgKytpKSB7XHJcbiAgICAgICAgICAgICAgICBtYXRjaGVzW2ldID0gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB2YXIgbWF4Q3JpdGVyaWFMZW5ndGggPSBjcml0ZXJpYXNbMF0ubGVuZ3RoO1xyXG4gICAgICAgICAgICBmb3IgKGkgPSAxOyBpIDwgY3JpdGVyaWFzLmxlbmd0aDsgKytpKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoY3JpdGVyaWFzW2ldLmxlbmd0aCA+IG1heENyaXRlcmlhTGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbWF4Q3JpdGVyaWFMZW5ndGggPSBjcml0ZXJpYXNbaV0ubGVuZ3RoO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBmb3IgKHZhciBrID0gMTsgayA8IGRhdGFiYXNlLmxlbmd0aDsgKytrKSB7XHJcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBsID0gMTsgbCA8IGRhdGFiYXNlW2tdLmxlbmd0aDsgKytsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGN1cnJlbnRDcml0ZXJpYVJlc3VsdCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBoYXNNYXRjaGluZ0NyaXRlcmlhID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBjcml0ZXJpYXMubGVuZ3RoOyArK2opIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNyaXRlcmlhID0gY3JpdGVyaWFzW2pdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoY3JpdGVyaWEubGVuZ3RoIDwgbWF4Q3JpdGVyaWFMZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgY3JpdGVyaWFGaWVsZCA9IGNyaXRlcmlhWzBdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YWJhc2Vba11bMF0gIT09IGNyaXRlcmlhRmllbGQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGhhc01hdGNoaW5nQ3JpdGVyaWEgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBwID0gMTsgcCA8IGNyaXRlcmlhLmxlbmd0aDsgKytwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50Q3JpdGVyaWFSZXN1bHQgPSBjdXJyZW50Q3JpdGVyaWFSZXN1bHRcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB8fCBldmFsKGRhdGFiYXNlW2tdW2xdICsgY3JpdGVyaWFbcF0pOyAvLyBqc2hpbnRcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGlnbm9yZTpsaW5lXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGhhc01hdGNoaW5nQ3JpdGVyaWEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbWF0Y2hlc1tsXSA9IG1hdGNoZXNbbF0gJiYgY3VycmVudENyaXRlcmlhUmVzdWx0O1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgdmFyIHJlc3VsdCA9IFtdO1xyXG4gICAgICAgICAgICBmb3IgKHZhciBuID0gMDsgbiA8IGRhdGFiYXNlWzBdLmxlbmd0aDsgKytuKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAobWF0Y2hlc1tuXSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKG4gLSAxKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gRGF0YWJhc2UgZnVuY3Rpb25zXHJcbiAgICAgICAgZXhwb3J0cy5EQVZFUkFHRSA9IGZ1bmN0aW9uIChkYXRhYmFzZSwgZmllbGQsIGNyaXRlcmlhKSB7XHJcbiAgICAgICAgICAgIC8vIFJldHVybiBlcnJvciBpZiBmaWVsZCBpcyBub3QgYSBudW1iZXIgYW5kIG5vdCBhIHN0cmluZ1xyXG4gICAgICAgICAgICBpZiAoaXNOYU4oZmllbGQpICYmICh0eXBlb2YgZmllbGQgIT09IFwic3RyaW5nXCIpKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZXJyb3IudmFsdWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdmFyIHJlc3VsdEluZGV4ZXMgPSBmaW5kUmVzdWx0SW5kZXgoZGF0YWJhc2UsIGNyaXRlcmlhKTtcclxuICAgICAgICAgICAgdmFyIHRhcmdldEZpZWxkcyA9IFtdO1xyXG4gICAgICAgICAgICBpZiAodHlwZW9mIGZpZWxkID09PSBcInN0cmluZ1wiKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgaW5kZXggPSBleHBvcnRzLkZJTkRGSUVMRChkYXRhYmFzZSwgZmllbGQpO1xyXG4gICAgICAgICAgICAgICAgdGFyZ2V0RmllbGRzID0gdXRpbHMucmVzdChkYXRhYmFzZVtpbmRleF0pO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdGFyZ2V0RmllbGRzID0gdXRpbHMucmVzdChkYXRhYmFzZVtmaWVsZF0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHZhciBzdW0gPSAwO1xyXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHJlc3VsdEluZGV4ZXMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgIHN1bSArPSB0YXJnZXRGaWVsZHNbcmVzdWx0SW5kZXhlc1tpXV07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdEluZGV4ZXMubGVuZ3RoID09PSAwID8gZXJyb3IuZGl2MCA6IHN1bSAvIHJlc3VsdEluZGV4ZXMubGVuZ3RoO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGV4cG9ydHMuRENPVU5UID0gZnVuY3Rpb24gKGRhdGFiYXNlLCBmaWVsZCwgY3JpdGVyaWEpIHtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBleHBvcnRzLkRDT1VOVEEgPSBmdW5jdGlvbiAoZGF0YWJhc2UsIGZpZWxkLCBjcml0ZXJpYSkge1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGV4cG9ydHMuREdFVCA9IGZ1bmN0aW9uIChkYXRhYmFzZSwgZmllbGQsIGNyaXRlcmlhKSB7XHJcbiAgICAgICAgICAgIC8vIFJldHVybiBlcnJvciBpZiBmaWVsZCBpcyBub3QgYSBudW1iZXIgYW5kIG5vdCBhIHN0cmluZ1xyXG4gICAgICAgICAgICBpZiAoaXNOYU4oZmllbGQpICYmICh0eXBlb2YgZmllbGQgIT09IFwic3RyaW5nXCIpKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZXJyb3IudmFsdWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdmFyIHJlc3VsdEluZGV4ZXMgPSBmaW5kUmVzdWx0SW5kZXgoZGF0YWJhc2UsIGNyaXRlcmlhKTtcclxuICAgICAgICAgICAgdmFyIHRhcmdldEZpZWxkcyA9IFtdO1xyXG4gICAgICAgICAgICBpZiAodHlwZW9mIGZpZWxkID09PSBcInN0cmluZ1wiKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgaW5kZXggPSBleHBvcnRzLkZJTkRGSUVMRChkYXRhYmFzZSwgZmllbGQpO1xyXG4gICAgICAgICAgICAgICAgdGFyZ2V0RmllbGRzID0gdXRpbHMucmVzdChkYXRhYmFzZVtpbmRleF0pO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdGFyZ2V0RmllbGRzID0gdXRpbHMucmVzdChkYXRhYmFzZVtmaWVsZF0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIC8vIFJldHVybiBlcnJvciBpZiBubyByZWNvcmQgbWVldHMgdGhlIGNyaXRlcmlhXHJcbiAgICAgICAgICAgIGlmIChyZXN1bHRJbmRleGVzLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGVycm9yLnZhbHVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIC8vIFJldHVybnMgdGhlICNOVU0hIGVycm9yIHZhbHVlIGJlY2F1c2UgbW9yZSB0aGFuIG9uZSByZWNvcmQgbWVldHMgdGhlXHJcbiAgICAgICAgICAgIC8vIGNyaXRlcmlhXHJcbiAgICAgICAgICAgIGlmIChyZXN1bHRJbmRleGVzLmxlbmd0aCA+IDEpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBlcnJvci5udW07XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHJldHVybiB0YXJnZXRGaWVsZHNbcmVzdWx0SW5kZXhlc1swXV07XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZXhwb3J0cy5ETUFYID0gZnVuY3Rpb24gKGRhdGFiYXNlLCBmaWVsZCwgY3JpdGVyaWEpIHtcclxuICAgICAgICAgICAgLy8gUmV0dXJuIGVycm9yIGlmIGZpZWxkIGlzIG5vdCBhIG51bWJlciBhbmQgbm90IGEgc3RyaW5nXHJcbiAgICAgICAgICAgIGlmIChpc05hTihmaWVsZCkgJiYgKHR5cGVvZiBmaWVsZCAhPT0gXCJzdHJpbmdcIikpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBlcnJvci52YWx1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB2YXIgcmVzdWx0SW5kZXhlcyA9IGZpbmRSZXN1bHRJbmRleChkYXRhYmFzZSwgY3JpdGVyaWEpO1xyXG4gICAgICAgICAgICB2YXIgdGFyZ2V0RmllbGRzID0gW107XHJcbiAgICAgICAgICAgIGlmICh0eXBlb2YgZmllbGQgPT09IFwic3RyaW5nXCIpIHtcclxuICAgICAgICAgICAgICAgIHZhciBpbmRleCA9IGV4cG9ydHMuRklOREZJRUxEKGRhdGFiYXNlLCBmaWVsZCk7XHJcbiAgICAgICAgICAgICAgICB0YXJnZXRGaWVsZHMgPSB1dGlscy5yZXN0KGRhdGFiYXNlW2luZGV4XSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0YXJnZXRGaWVsZHMgPSB1dGlscy5yZXN0KGRhdGFiYXNlW2ZpZWxkXSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdmFyIG1heFZhbHVlID0gdGFyZ2V0RmllbGRzW3Jlc3VsdEluZGV4ZXNbMF1dO1xyXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMTsgaSA8IHJlc3VsdEluZGV4ZXMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgIGlmIChtYXhWYWx1ZSA8IHRhcmdldEZpZWxkc1tyZXN1bHRJbmRleGVzW2ldXSkge1xyXG4gICAgICAgICAgICAgICAgICAgIG1heFZhbHVlID0gdGFyZ2V0RmllbGRzW3Jlc3VsdEluZGV4ZXNbaV1dO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBtYXhWYWx1ZTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBleHBvcnRzLkRNSU4gPSBmdW5jdGlvbiAoZGF0YWJhc2UsIGZpZWxkLCBjcml0ZXJpYSkge1xyXG4gICAgICAgICAgICAvLyBSZXR1cm4gZXJyb3IgaWYgZmllbGQgaXMgbm90IGEgbnVtYmVyIGFuZCBub3QgYSBzdHJpbmdcclxuICAgICAgICAgICAgaWYgKGlzTmFOKGZpZWxkKSAmJiAodHlwZW9mIGZpZWxkICE9PSBcInN0cmluZ1wiKSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGVycm9yLnZhbHVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHZhciByZXN1bHRJbmRleGVzID0gZmluZFJlc3VsdEluZGV4KGRhdGFiYXNlLCBjcml0ZXJpYSk7XHJcbiAgICAgICAgICAgIHZhciB0YXJnZXRGaWVsZHMgPSBbXTtcclxuICAgICAgICAgICAgaWYgKHR5cGVvZiBmaWVsZCA9PT0gXCJzdHJpbmdcIikge1xyXG4gICAgICAgICAgICAgICAgdmFyIGluZGV4ID0gZXhwb3J0cy5GSU5ERklFTEQoZGF0YWJhc2UsIGZpZWxkKTtcclxuICAgICAgICAgICAgICAgIHRhcmdldEZpZWxkcyA9IHV0aWxzLnJlc3QoZGF0YWJhc2VbaW5kZXhdKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHRhcmdldEZpZWxkcyA9IHV0aWxzLnJlc3QoZGF0YWJhc2VbZmllbGRdKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB2YXIgbWluVmFsdWUgPSB0YXJnZXRGaWVsZHNbcmVzdWx0SW5kZXhlc1swXV07XHJcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAxOyBpIDwgcmVzdWx0SW5kZXhlcy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgaWYgKG1pblZhbHVlID4gdGFyZ2V0RmllbGRzW3Jlc3VsdEluZGV4ZXNbaV1dKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbWluVmFsdWUgPSB0YXJnZXRGaWVsZHNbcmVzdWx0SW5kZXhlc1tpXV07XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIG1pblZhbHVlO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGV4cG9ydHMuRFBST0RVQ1QgPSBmdW5jdGlvbiAoZGF0YWJhc2UsIGZpZWxkLCBjcml0ZXJpYSkge1xyXG4gICAgICAgICAgICAvLyBSZXR1cm4gZXJyb3IgaWYgZmllbGQgaXMgbm90IGEgbnVtYmVyIGFuZCBub3QgYSBzdHJpbmdcclxuICAgICAgICAgICAgaWYgKGlzTmFOKGZpZWxkKSAmJiAodHlwZW9mIGZpZWxkICE9PSBcInN0cmluZ1wiKSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGVycm9yLnZhbHVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHZhciByZXN1bHRJbmRleGVzID0gZmluZFJlc3VsdEluZGV4KGRhdGFiYXNlLCBjcml0ZXJpYSk7XHJcbiAgICAgICAgICAgIHZhciB0YXJnZXRGaWVsZHMgPSBbXTtcclxuICAgICAgICAgICAgaWYgKHR5cGVvZiBmaWVsZCA9PT0gXCJzdHJpbmdcIikge1xyXG4gICAgICAgICAgICAgICAgdmFyIGluZGV4ID0gZXhwb3J0cy5GSU5ERklFTEQoZGF0YWJhc2UsIGZpZWxkKTtcclxuICAgICAgICAgICAgICAgIHRhcmdldEZpZWxkcyA9IHV0aWxzLnJlc3QoZGF0YWJhc2VbaW5kZXhdKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHRhcmdldEZpZWxkcyA9IHV0aWxzLnJlc3QoZGF0YWJhc2VbZmllbGRdKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB2YXIgdGFyZ2V0VmFsdWVzID0gW107XHJcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcmVzdWx0SW5kZXhlcy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgdGFyZ2V0VmFsdWVzW2ldID0gdGFyZ2V0RmllbGRzW3Jlc3VsdEluZGV4ZXNbaV1dO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRhcmdldFZhbHVlcyA9IGNvbXBhY3QodGFyZ2V0VmFsdWVzKTtcclxuICAgICAgICAgICAgdmFyIHJlc3VsdCA9IDE7XHJcbiAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCB0YXJnZXRWYWx1ZXMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgIHJlc3VsdCAqPSB0YXJnZXRWYWx1ZXNbaV07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBleHBvcnRzLkRTVERFViA9IGZ1bmN0aW9uIChkYXRhYmFzZSwgZmllbGQsIGNyaXRlcmlhKSB7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZXhwb3J0cy5EU1RERVZQID0gZnVuY3Rpb24gKGRhdGFiYXNlLCBmaWVsZCwgY3JpdGVyaWEpIHtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBleHBvcnRzLkRTVU0gPSBmdW5jdGlvbiAoZGF0YWJhc2UsIGZpZWxkLCBjcml0ZXJpYSkge1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGV4cG9ydHMuRFZBUiA9IGZ1bmN0aW9uIChkYXRhYmFzZSwgZmllbGQsIGNyaXRlcmlhKSB7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZXhwb3J0cy5EVkFSUCA9IGZ1bmN0aW9uIChkYXRhYmFzZSwgZmllbGQsIGNyaXRlcmlhKSB7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZXhwb3J0cy5NQVRDSCA9IGZ1bmN0aW9uIChsb29rdXBWYWx1ZSwgbG9va3VwQXJyYXksIG1hdGNoVHlwZSkge1xyXG4gICAgICAgICAgICBpZiAoIWxvb2t1cFZhbHVlICYmICFsb29rdXBBcnJheSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGVycm9yLm5hO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChhcmd1bWVudHMubGVuZ3RoID09PSAyKSB7XHJcbiAgICAgICAgICAgICAgICBtYXRjaFR5cGUgPSAxO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICghKGxvb2t1cEFycmF5IGluc3RhbmNlb2YgQXJyYXkpKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZXJyb3IubmE7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKG1hdGNoVHlwZSAhPT0gLTEgJiYgbWF0Y2hUeXBlICE9PSAwICYmIG1hdGNoVHlwZSAhPT0gMSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGVycm9yLm5hO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB2YXIgaW5kZXg7XHJcbiAgICAgICAgICAgIHZhciBpbmRleFZhbHVlO1xyXG5cclxuICAgICAgICAgICAgZm9yICh2YXIgaWR4ID0gMDsgaWR4IDwgbG9va3VwQXJyYXkubGVuZ3RoOyBpZHgrKykge1xyXG4gICAgICAgICAgICAgICAgaWYgKG1hdGNoVHlwZSA9PT0gMSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChsb29rdXBBcnJheVtpZHhdID09PSBsb29rdXBWYWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gaWR4ICsgMTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGxvb2t1cEFycmF5W2lkeF0gPCBsb29rdXBWYWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWluZGV4VmFsdWUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluZGV4ID0gaWR4ICsgMTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluZGV4VmFsdWUgPSBsb29rdXBBcnJheVtpZHhdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGxvb2t1cEFycmF5W2lkeF0gPiBpbmRleFZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbmRleCA9IGlkeCArIDE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbmRleFZhbHVlID0gbG9va3VwQXJyYXlbaWR4XTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAobWF0Y2hUeXBlID09PSAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBsb29rdXBWYWx1ZSA9PT0gJ3N0cmluZycpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbG9va3VwVmFsdWUgPSBsb29rdXBWYWx1ZS5yZXBsYWNlKC9cXD8vZywgJy4nKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGxvb2t1cEFycmF5W2lkeF0udG9Mb3dlckNhc2UoKS5tYXRjaChsb29rdXBWYWx1ZS50b0xvd2VyQ2FzZSgpKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGlkeCArIDE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAobG9va3VwQXJyYXlbaWR4XSA9PT0gbG9va3VwVmFsdWUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBpZHggKyAxO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChtYXRjaFR5cGUgPT09IC0xKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGxvb2t1cEFycmF5W2lkeF0gPT09IGxvb2t1cFZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBpZHggKyAxO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAobG9va3VwQXJyYXlbaWR4XSA+IGxvb2t1cFZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghaW5kZXhWYWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5kZXggPSBpZHggKyAxO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5kZXhWYWx1ZSA9IGxvb2t1cEFycmF5W2lkeF07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAobG9va3VwQXJyYXlbaWR4XSA8IGluZGV4VmFsdWUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluZGV4ID0gaWR4ICsgMTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluZGV4VmFsdWUgPSBsb29rdXBBcnJheVtpZHhdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gaW5kZXggPyBpbmRleCA6IGVycm9yLm5hO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHJldHVybiBleHBvcnRzO1xyXG4gICAgfSkoKTtcclxuXHJcbiAgICBqZXhjZWwubWV0aG9kcy5lbmdpbmVlcmluZyA9IChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdmFyIGV4cG9ydHMgPSB7fTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gaXNWYWxpZEJpbmFyeU51bWJlcihudW1iZXIpIHtcclxuICAgICAgICAgICAgcmV0dXJuICgvXlswMV17MSwxMH0kLykudGVzdChudW1iZXIpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZXhwb3J0cy5CRVNTRUxJID0gZnVuY3Rpb24gKHgsIG4pIHtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBleHBvcnRzLkJFU1NFTEogPSBmdW5jdGlvbiAoeCwgbikge1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGV4cG9ydHMuQkVTU0VMSyA9IGZ1bmN0aW9uICh4LCBuKSB7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZXhwb3J0cy5CRVNTRUxZID0gZnVuY3Rpb24gKHgsIG4pIHtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBleHBvcnRzLkJJTjJERUMgPSBmdW5jdGlvbiAobnVtYmVyKSB7XHJcbiAgICAgICAgICAgIC8vIFJldHVybiBlcnJvciBpZiBudW1iZXIgaXMgbm90IGJpbmFyeSBvciBjb250YWlucyBtb3JlIHRoYW4gMTBcclxuICAgICAgICAgICAgLy8gY2hhcmFjdGVycyAoMTAgZGlnaXRzKVxyXG4gICAgICAgICAgICBpZiAoIWlzVmFsaWRCaW5hcnlOdW1iZXIobnVtYmVyKSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGVycm9yLm51bTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gQ29udmVydCBiaW5hcnkgbnVtYmVyIHRvIGRlY2ltYWxcclxuICAgICAgICAgICAgdmFyIHJlc3VsdCA9IHBhcnNlSW50KG51bWJlciwgMik7XHJcblxyXG4gICAgICAgICAgICAvLyBIYW5kbGUgbmVnYXRpdmUgbnVtYmVyc1xyXG4gICAgICAgICAgICB2YXIgc3RyaW5naWZpZWQgPSBudW1iZXIudG9TdHJpbmcoKTtcclxuICAgICAgICAgICAgaWYgKHN0cmluZ2lmaWVkLmxlbmd0aCA9PT0gMTAgJiYgc3RyaW5naWZpZWQuc3Vic3RyaW5nKDAsIDEpID09PSAnMScpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBwYXJzZUludChzdHJpbmdpZmllZC5zdWJzdHJpbmcoMSksIDIpIC0gNTEyO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGV4cG9ydHMuQklOMkhFWCA9IGZ1bmN0aW9uIChudW1iZXIsIHBsYWNlcykge1xyXG4gICAgICAgICAgICAvLyBSZXR1cm4gZXJyb3IgaWYgbnVtYmVyIGlzIG5vdCBiaW5hcnkgb3IgY29udGFpbnMgbW9yZSB0aGFuIDEwXHJcbiAgICAgICAgICAgIC8vIGNoYXJhY3RlcnMgKDEwIGRpZ2l0cylcclxuICAgICAgICAgICAgaWYgKCFpc1ZhbGlkQmluYXJ5TnVtYmVyKG51bWJlcikpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBlcnJvci5udW07XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIElnbm9yZSBwbGFjZXMgYW5kIHJldHVybiBhIDEwLWNoYXJhY3RlciBoZXhhZGVjaW1hbCBudW1iZXIgaWYgbnVtYmVyXHJcbiAgICAgICAgICAgIC8vIGlzIG5lZ2F0aXZlXHJcbiAgICAgICAgICAgIHZhciBzdHJpbmdpZmllZCA9IG51bWJlci50b1N0cmluZygpO1xyXG4gICAgICAgICAgICBpZiAoc3RyaW5naWZpZWQubGVuZ3RoID09PSAxMCAmJiBzdHJpbmdpZmllZC5zdWJzdHJpbmcoMCwgMSkgPT09ICcxJykge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuICgxMDk5NTExNjI3MjY0ICsgcGFyc2VJbnQoc3RyaW5naWZpZWQuc3Vic3RyaW5nKDEpLCAyKSkudG9TdHJpbmcoMTYpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBDb252ZXJ0IGJpbmFyeSBudW1iZXIgdG8gaGV4YWRlY2ltYWxcclxuICAgICAgICAgICAgdmFyIHJlc3VsdCA9IHBhcnNlSW50KG51bWJlciwgMikudG9TdHJpbmcoMTYpO1xyXG5cclxuICAgICAgICAgICAgLy8gUmV0dXJuIGhleGFkZWNpbWFsIG51bWJlciB1c2luZyB0aGUgbWluaW11bSBudW1iZXIgb2YgY2hhcmFjdGVyc1xyXG4gICAgICAgICAgICAvLyBuZWNlc3NhcnkgaWYgcGxhY2VzIGlzIHVuZGVmaW5lZFxyXG4gICAgICAgICAgICBpZiAocGxhY2VzID09PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAvLyBSZXR1cm4gZXJyb3IgaWYgcGxhY2VzIGlzIG5vbm51bWVyaWNcclxuICAgICAgICAgICAgICAgIGlmIChpc05hTihwbGFjZXMpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGVycm9yLnZhbHVlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIC8vIFJldHVybiBlcnJvciBpZiBwbGFjZXMgaXMgbmVnYXRpdmVcclxuICAgICAgICAgICAgICAgIGlmIChwbGFjZXMgPCAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGVycm9yLm51bTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAvLyBUcnVuY2F0ZSBwbGFjZXMgaW4gY2FzZSBpdCBpcyBub3QgYW4gaW50ZWdlclxyXG4gICAgICAgICAgICAgICAgcGxhY2VzID0gTWF0aC5mbG9vcihwbGFjZXMpO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIFBhZCByZXR1cm4gdmFsdWUgd2l0aCBsZWFkaW5nIDBzICh6ZXJvcykgaWYgbmVjZXNzYXJ5ICh1c2luZ1xyXG4gICAgICAgICAgICAgICAgLy8gVW5kZXJzY29yZS5zdHJpbmcpXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gKHBsYWNlcyA+PSByZXN1bHQubGVuZ3RoKSA/IFJFUFQoJzAnLCBwbGFjZXMgLSByZXN1bHQubGVuZ3RoKSArIHJlc3VsdCA6IGVycm9yLm51bTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGV4cG9ydHMuQklOMk9DVCA9IGZ1bmN0aW9uIChudW1iZXIsIHBsYWNlcykge1xyXG4gICAgICAgICAgICAvLyBSZXR1cm4gZXJyb3IgaWYgbnVtYmVyIGlzIG5vdCBiaW5hcnkgb3IgY29udGFpbnMgbW9yZSB0aGFuIDEwXHJcbiAgICAgICAgICAgIC8vIGNoYXJhY3RlcnMgKDEwIGRpZ2l0cylcclxuICAgICAgICAgICAgaWYgKCFpc1ZhbGlkQmluYXJ5TnVtYmVyKG51bWJlcikpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBlcnJvci5udW07XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIElnbm9yZSBwbGFjZXMgYW5kIHJldHVybiBhIDEwLWNoYXJhY3RlciBvY3RhbCBudW1iZXIgaWYgbnVtYmVyIGlzXHJcbiAgICAgICAgICAgIC8vIG5lZ2F0aXZlXHJcbiAgICAgICAgICAgIHZhciBzdHJpbmdpZmllZCA9IG51bWJlci50b1N0cmluZygpO1xyXG4gICAgICAgICAgICBpZiAoc3RyaW5naWZpZWQubGVuZ3RoID09PSAxMCAmJiBzdHJpbmdpZmllZC5zdWJzdHJpbmcoMCwgMSkgPT09ICcxJykge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuICgxMDczNzQxMzEyICsgcGFyc2VJbnQoc3RyaW5naWZpZWQuc3Vic3RyaW5nKDEpLCAyKSkudG9TdHJpbmcoOCk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIENvbnZlcnQgYmluYXJ5IG51bWJlciB0byBvY3RhbFxyXG4gICAgICAgICAgICB2YXIgcmVzdWx0ID0gcGFyc2VJbnQobnVtYmVyLCAyKS50b1N0cmluZyg4KTtcclxuXHJcbiAgICAgICAgICAgIC8vIFJldHVybiBvY3RhbCBudW1iZXIgdXNpbmcgdGhlIG1pbmltdW0gbnVtYmVyIG9mIGNoYXJhY3RlcnMgbmVjZXNzYXJ5XHJcbiAgICAgICAgICAgIC8vIGlmIHBsYWNlcyBpcyB1bmRlZmluZWRcclxuICAgICAgICAgICAgaWYgKHBsYWNlcyA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgLy8gUmV0dXJuIGVycm9yIGlmIHBsYWNlcyBpcyBub25udW1lcmljXHJcbiAgICAgICAgICAgICAgICBpZiAoaXNOYU4ocGxhY2VzKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBlcnJvci52YWx1ZTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAvLyBSZXR1cm4gZXJyb3IgaWYgcGxhY2VzIGlzIG5lZ2F0aXZlXHJcbiAgICAgICAgICAgICAgICBpZiAocGxhY2VzIDwgMCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBlcnJvci5udW07XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gVHJ1bmNhdGUgcGxhY2VzIGluIGNhc2UgaXQgaXMgbm90IGFuIGludGVnZXJcclxuICAgICAgICAgICAgICAgIHBsYWNlcyA9IE1hdGguZmxvb3IocGxhY2VzKTtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyBQYWQgcmV0dXJuIHZhbHVlIHdpdGggbGVhZGluZyAwcyAoemVyb3MpIGlmIG5lY2Vzc2FyeSAodXNpbmdcclxuICAgICAgICAgICAgICAgIC8vIFVuZGVyc2NvcmUuc3RyaW5nKVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIChwbGFjZXMgPj0gcmVzdWx0Lmxlbmd0aCkgPyBSRVBUKCcwJywgcGxhY2VzIC0gcmVzdWx0Lmxlbmd0aCkgKyByZXN1bHQgOiBlcnJvci5udW07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBleHBvcnRzLkJJVEFORCA9IGZ1bmN0aW9uIChudW1iZXIxLCBudW1iZXIyKSB7XHJcbiAgICAgICAgICAgIC8vIFJldHVybiBlcnJvciBpZiBlaXRoZXIgbnVtYmVyIGlzIGEgbm9uLW51bWVyaWMgdmFsdWVcclxuICAgICAgICAgICAgbnVtYmVyMSA9IHV0aWxzLnBhcnNlTnVtYmVyKG51bWJlcjEpO1xyXG4gICAgICAgICAgICBudW1iZXIyID0gdXRpbHMucGFyc2VOdW1iZXIobnVtYmVyMik7XHJcbiAgICAgICAgICAgIGlmICh1dGlscy5hbnlJc0Vycm9yKG51bWJlcjEsIG51bWJlcjIpKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZXJyb3IudmFsdWU7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIFJldHVybiBlcnJvciBpZiBlaXRoZXIgbnVtYmVyIGlzIGxlc3MgdGhhbiAwXHJcbiAgICAgICAgICAgIGlmIChudW1iZXIxIDwgMCB8fCBudW1iZXIyIDwgMCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGVycm9yLm51bTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gUmV0dXJuIGVycm9yIGlmIGVpdGhlciBudW1iZXIgaXMgYSBub24taW50ZWdlclxyXG4gICAgICAgICAgICBpZiAoTWF0aC5mbG9vcihudW1iZXIxKSAhPT0gbnVtYmVyMSB8fCBNYXRoLmZsb29yKG51bWJlcjIpICE9PSBudW1iZXIyKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZXJyb3IubnVtO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBSZXR1cm4gZXJyb3IgaWYgZWl0aGVyIG51bWJlciBpcyBncmVhdGVyIHRoYW4gKDJeNDgpLTFcclxuICAgICAgICAgICAgaWYgKG51bWJlcjEgPiAyODE0NzQ5NzY3MTA2NTUgfHwgbnVtYmVyMiA+IDI4MTQ3NDk3NjcxMDY1NSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGVycm9yLm51bTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gUmV0dXJuIGJpdHdpc2UgQU5EIG9mIHR3byBudW1iZXJzXHJcbiAgICAgICAgICAgIHJldHVybiBudW1iZXIxICYgbnVtYmVyMjtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBleHBvcnRzLkJJVExTSElGVCA9IGZ1bmN0aW9uIChudW1iZXIsIHNoaWZ0KSB7XHJcbiAgICAgICAgICAgIG51bWJlciA9IHV0aWxzLnBhcnNlTnVtYmVyKG51bWJlcik7XHJcbiAgICAgICAgICAgIHNoaWZ0ID0gdXRpbHMucGFyc2VOdW1iZXIoc2hpZnQpO1xyXG4gICAgICAgICAgICBpZiAodXRpbHMuYW55SXNFcnJvcihudW1iZXIsIHNoaWZ0KSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGVycm9yLnZhbHVlO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBSZXR1cm4gZXJyb3IgaWYgbnVtYmVyIGlzIGxlc3MgdGhhbiAwXHJcbiAgICAgICAgICAgIGlmIChudW1iZXIgPCAwKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZXJyb3IubnVtO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBSZXR1cm4gZXJyb3IgaWYgbnVtYmVyIGlzIGEgbm9uLWludGVnZXJcclxuICAgICAgICAgICAgaWYgKE1hdGguZmxvb3IobnVtYmVyKSAhPT0gbnVtYmVyKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZXJyb3IubnVtO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBSZXR1cm4gZXJyb3IgaWYgbnVtYmVyIGlzIGdyZWF0ZXIgdGhhbiAoMl40OCktMVxyXG4gICAgICAgICAgICBpZiAobnVtYmVyID4gMjgxNDc0OTc2NzEwNjU1KSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZXJyb3IubnVtO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBSZXR1cm4gZXJyb3IgaWYgdGhlIGFic29sdXRlIHZhbHVlIG9mIHNoaWZ0IGlzIGdyZWF0ZXIgdGhhbiA1M1xyXG4gICAgICAgICAgICBpZiAoTWF0aC5hYnMoc2hpZnQpID4gNTMpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBlcnJvci5udW07XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIFJldHVybiBudW1iZXIgc2hpZnRlZCBieSBzaGlmdCBiaXRzIHRvIHRoZSBsZWZ0IG9yIHRvIHRoZSByaWdodCBpZlxyXG4gICAgICAgICAgICAvLyBzaGlmdCBpcyBuZWdhdGl2ZVxyXG4gICAgICAgICAgICByZXR1cm4gKHNoaWZ0ID49IDApID8gbnVtYmVyIDw8IHNoaWZ0IDogbnVtYmVyID4+IC1zaGlmdDtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBleHBvcnRzLkJJVE9SID0gZnVuY3Rpb24gKG51bWJlcjEsIG51bWJlcjIpIHtcclxuICAgICAgICAgICAgbnVtYmVyMSA9IHV0aWxzLnBhcnNlTnVtYmVyKG51bWJlcjEpO1xyXG4gICAgICAgICAgICBudW1iZXIyID0gdXRpbHMucGFyc2VOdW1iZXIobnVtYmVyMik7XHJcbiAgICAgICAgICAgIGlmICh1dGlscy5hbnlJc0Vycm9yKG51bWJlcjEsIG51bWJlcjIpKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZXJyb3IudmFsdWU7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIFJldHVybiBlcnJvciBpZiBlaXRoZXIgbnVtYmVyIGlzIGxlc3MgdGhhbiAwXHJcbiAgICAgICAgICAgIGlmIChudW1iZXIxIDwgMCB8fCBudW1iZXIyIDwgMCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGVycm9yLm51bTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gUmV0dXJuIGVycm9yIGlmIGVpdGhlciBudW1iZXIgaXMgYSBub24taW50ZWdlclxyXG4gICAgICAgICAgICBpZiAoTWF0aC5mbG9vcihudW1iZXIxKSAhPT0gbnVtYmVyMSB8fCBNYXRoLmZsb29yKG51bWJlcjIpICE9PSBudW1iZXIyKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZXJyb3IubnVtO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBSZXR1cm4gZXJyb3IgaWYgZWl0aGVyIG51bWJlciBpcyBncmVhdGVyIHRoYW4gKDJeNDgpLTFcclxuICAgICAgICAgICAgaWYgKG51bWJlcjEgPiAyODE0NzQ5NzY3MTA2NTUgfHwgbnVtYmVyMiA+IDI4MTQ3NDk3NjcxMDY1NSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGVycm9yLm51bTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gUmV0dXJuIGJpdHdpc2UgT1Igb2YgdHdvIG51bWJlcnNcclxuICAgICAgICAgICAgcmV0dXJuIG51bWJlcjEgfCBudW1iZXIyO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGV4cG9ydHMuQklUUlNISUZUID0gZnVuY3Rpb24gKG51bWJlciwgc2hpZnQpIHtcclxuICAgICAgICAgICAgbnVtYmVyID0gdXRpbHMucGFyc2VOdW1iZXIobnVtYmVyKTtcclxuICAgICAgICAgICAgc2hpZnQgPSB1dGlscy5wYXJzZU51bWJlcihzaGlmdCk7XHJcbiAgICAgICAgICAgIGlmICh1dGlscy5hbnlJc0Vycm9yKG51bWJlciwgc2hpZnQpKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZXJyb3IudmFsdWU7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIFJldHVybiBlcnJvciBpZiBudW1iZXIgaXMgbGVzcyB0aGFuIDBcclxuICAgICAgICAgICAgaWYgKG51bWJlciA8IDApIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBlcnJvci5udW07XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIFJldHVybiBlcnJvciBpZiBudW1iZXIgaXMgYSBub24taW50ZWdlclxyXG4gICAgICAgICAgICBpZiAoTWF0aC5mbG9vcihudW1iZXIpICE9PSBudW1iZXIpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBlcnJvci5udW07XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIFJldHVybiBlcnJvciBpZiBudW1iZXIgaXMgZ3JlYXRlciB0aGFuICgyXjQ4KS0xXHJcbiAgICAgICAgICAgIGlmIChudW1iZXIgPiAyODE0NzQ5NzY3MTA2NTUpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBlcnJvci5udW07XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIFJldHVybiBlcnJvciBpZiB0aGUgYWJzb2x1dGUgdmFsdWUgb2Ygc2hpZnQgaXMgZ3JlYXRlciB0aGFuIDUzXHJcbiAgICAgICAgICAgIGlmIChNYXRoLmFicyhzaGlmdCkgPiA1Mykge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGVycm9yLm51bTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gUmV0dXJuIG51bWJlciBzaGlmdGVkIGJ5IHNoaWZ0IGJpdHMgdG8gdGhlIHJpZ2h0IG9yIHRvIHRoZSBsZWZ0IGlmXHJcbiAgICAgICAgICAgIC8vIHNoaWZ0IGlzIG5lZ2F0aXZlXHJcbiAgICAgICAgICAgIHJldHVybiAoc2hpZnQgPj0gMCkgPyBudW1iZXIgPj4gc2hpZnQgOiBudW1iZXIgPDwgLXNoaWZ0O1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGV4cG9ydHMuQklUWE9SID0gZnVuY3Rpb24gKG51bWJlcjEsIG51bWJlcjIpIHtcclxuICAgICAgICAgICAgbnVtYmVyMSA9IHV0aWxzLnBhcnNlTnVtYmVyKG51bWJlcjEpO1xyXG4gICAgICAgICAgICBudW1iZXIyID0gdXRpbHMucGFyc2VOdW1iZXIobnVtYmVyMik7XHJcbiAgICAgICAgICAgIGlmICh1dGlscy5hbnlJc0Vycm9yKG51bWJlcjEsIG51bWJlcjIpKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZXJyb3IudmFsdWU7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIFJldHVybiBlcnJvciBpZiBlaXRoZXIgbnVtYmVyIGlzIGxlc3MgdGhhbiAwXHJcbiAgICAgICAgICAgIGlmIChudW1iZXIxIDwgMCB8fCBudW1iZXIyIDwgMCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGVycm9yLm51bTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gUmV0dXJuIGVycm9yIGlmIGVpdGhlciBudW1iZXIgaXMgYSBub24taW50ZWdlclxyXG4gICAgICAgICAgICBpZiAoTWF0aC5mbG9vcihudW1iZXIxKSAhPT0gbnVtYmVyMSB8fCBNYXRoLmZsb29yKG51bWJlcjIpICE9PSBudW1iZXIyKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZXJyb3IubnVtO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBSZXR1cm4gZXJyb3IgaWYgZWl0aGVyIG51bWJlciBpcyBncmVhdGVyIHRoYW4gKDJeNDgpLTFcclxuICAgICAgICAgICAgaWYgKG51bWJlcjEgPiAyODE0NzQ5NzY3MTA2NTUgfHwgbnVtYmVyMiA+IDI4MTQ3NDk3NjcxMDY1NSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGVycm9yLm51bTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gUmV0dXJuIGJpdHdpc2UgWE9SIG9mIHR3byBudW1iZXJzXHJcbiAgICAgICAgICAgIHJldHVybiBudW1iZXIxIF4gbnVtYmVyMjtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBleHBvcnRzLkNPTVBMRVggPSBmdW5jdGlvbiAocmVhbCwgaW1hZ2luYXJ5LCBzdWZmaXgpIHtcclxuICAgICAgICAgICAgcmVhbCA9IHV0aWxzLnBhcnNlTnVtYmVyKHJlYWwpO1xyXG4gICAgICAgICAgICBpbWFnaW5hcnkgPSB1dGlscy5wYXJzZU51bWJlcihpbWFnaW5hcnkpO1xyXG4gICAgICAgICAgICBpZiAodXRpbHMuYW55SXNFcnJvcihyZWFsLCBpbWFnaW5hcnkpKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVhbDtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gU2V0IHN1ZmZpeFxyXG4gICAgICAgICAgICBzdWZmaXggPSAoc3VmZml4ID09PSB1bmRlZmluZWQpID8gJ2knIDogc3VmZml4O1xyXG5cclxuICAgICAgICAgICAgLy8gUmV0dXJuIGVycm9yIGlmIHN1ZmZpeCBpcyBuZWl0aGVyIFwiaVwiIG5vciBcImpcIlxyXG4gICAgICAgICAgICBpZiAoc3VmZml4ICE9PSAnaScgJiYgc3VmZml4ICE9PSAnaicpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBlcnJvci52YWx1ZTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gUmV0dXJuIGNvbXBsZXggbnVtYmVyXHJcbiAgICAgICAgICAgIGlmIChyZWFsID09PSAwICYmIGltYWdpbmFyeSA9PT0gMCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIDA7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAocmVhbCA9PT0gMCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIChpbWFnaW5hcnkgPT09IDEpID8gc3VmZml4IDogaW1hZ2luYXJ5LnRvU3RyaW5nKCkgKyBzdWZmaXg7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoaW1hZ2luYXJ5ID09PSAwKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVhbC50b1N0cmluZygpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdmFyIHNpZ24gPSAoaW1hZ2luYXJ5ID4gMCkgPyAnKycgOiAnJztcclxuICAgICAgICAgICAgICAgIHJldHVybiByZWFsLnRvU3RyaW5nKCkgKyBzaWduICsgKChpbWFnaW5hcnkgPT09IDEpID8gc3VmZml4IDogaW1hZ2luYXJ5LnRvU3RyaW5nKCkgKyBzdWZmaXgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZXhwb3J0cy5DT05WRVJUID0gZnVuY3Rpb24gKG51bWJlciwgZnJvbV91bml0LCB0b191bml0KSB7XHJcbiAgICAgICAgICAgIG51bWJlciA9IHV0aWxzLnBhcnNlTnVtYmVyKG51bWJlcik7XHJcbiAgICAgICAgICAgIGlmIChudW1iZXIgaW5zdGFuY2VvZiBFcnJvcikge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG51bWJlcjtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gTGlzdCBvZiB1bml0cyBzdXBwb3J0ZWQgYnkgQ09OVkVSVCBhbmQgdW5pdHMgZGVmaW5lZCBieSB0aGVcclxuICAgICAgICAgICAgLy8gSW50ZXJuYXRpb25hbCBTeXN0ZW0gb2YgVW5pdHNcclxuICAgICAgICAgICAgLy8gW05hbWUsIFN5bWJvbCwgQWx0ZXJuYXRlIHN5bWJvbHMsIFF1YW50aXR5LCBJU1UsIENPTlZFUlQsIENvbnZlcnNpb25cclxuICAgICAgICAgICAgLy8gcmF0aW9dXHJcbiAgICAgICAgICAgIHZhciB1bml0cyA9IFtcclxuICAgICAgICAgICAgICAgIFtcImEudS4gb2YgYWN0aW9uXCIsIFwiP1wiLCBudWxsLCBcImFjdGlvblwiLCBmYWxzZSwgZmFsc2UsIDEuMDU0NTcxNjgxODE4MThlLTM0XSxcclxuICAgICAgICAgICAgICAgIFtcImEudS4gb2YgY2hhcmdlXCIsIFwiZVwiLCBudWxsLCBcImVsZWN0cmljX2NoYXJnZVwiLCBmYWxzZSwgZmFsc2UsIDEuNjAyMTc2NTMxNDE0MTRlLTE5XSxcclxuICAgICAgICAgICAgICAgIFtcImEudS4gb2YgZW5lcmd5XCIsIFwiRWhcIiwgbnVsbCwgXCJlbmVyZ3lcIiwgZmFsc2UsIGZhbHNlLCA0LjM1OTc0NDE3NzU3NTc2ZS0xOF0sXHJcbiAgICAgICAgICAgICAgICBbXCJhLnUuIG9mIGxlbmd0aFwiLCBcImE/XCIsIG51bGwsIFwibGVuZ3RoXCIsIGZhbHNlLCBmYWxzZSwgNS4yOTE3NzIxMDgxODE4MmUtMTFdLFxyXG4gICAgICAgICAgICAgICAgW1wiYS51LiBvZiBtYXNzXCIsIFwibT9cIiwgbnVsbCwgXCJtYXNzXCIsIGZhbHNlLCBmYWxzZSwgOS4xMDkzODI2MTYxNjE2MmUtMzFdLFxyXG4gICAgICAgICAgICAgICAgW1wiYS51LiBvZiB0aW1lXCIsIFwiPy9FaFwiLCBudWxsLCBcInRpbWVcIiwgZmFsc2UsIGZhbHNlLCAyLjQxODg4NDMyNjUwNTE2ZS0xN10sXHJcbiAgICAgICAgICAgICAgICBbXCJhZG1pcmFsdHkga25vdFwiLCBcImFkbWtuXCIsIG51bGwsIFwic3BlZWRcIiwgZmFsc2UsIHRydWUsIDAuNTE0NzczMzMzXSxcclxuICAgICAgICAgICAgICAgIFtcImFtcGVyZVwiLCBcIkFcIiwgbnVsbCwgXCJlbGVjdHJpY19jdXJyZW50XCIsIHRydWUsIGZhbHNlLCAxXSxcclxuICAgICAgICAgICAgICAgIFtcImFtcGVyZSBwZXIgbWV0ZXJcIiwgXCJBL21cIiwgbnVsbCwgXCJtYWduZXRpY19maWVsZF9pbnRlbnNpdHlcIiwgdHJ1ZSwgZmFsc2UsIDFdLFxyXG4gICAgICAgICAgICAgICAgW1wiw4PCpW5nc3Ryw4PCtm1cIiwgXCLDg+KAplwiLCBbXCJhbmdcIl0sIFwibGVuZ3RoXCIsIGZhbHNlLCB0cnVlLCAxZS0xMF0sXHJcbiAgICAgICAgICAgICAgICBbXCJhcmVcIiwgXCJhclwiLCBudWxsLCBcImFyZWFcIiwgZmFsc2UsIHRydWUsIDEwMF0sXHJcbiAgICAgICAgICAgICAgICBbXCJhc3Ryb25vbWljYWwgdW5pdFwiLCBcInVhXCIsIG51bGwsIFwibGVuZ3RoXCIsIGZhbHNlLCBmYWxzZSwgMS40OTU5Nzg3MDY5MTY2N2UtMTFdLFxyXG4gICAgICAgICAgICAgICAgW1wiYmFyXCIsIFwiYmFyXCIsIG51bGwsIFwicHJlc3N1cmVcIiwgZmFsc2UsIGZhbHNlLCAxMDAwMDBdLFxyXG4gICAgICAgICAgICAgICAgW1wiYmFyblwiLCBcImJcIiwgbnVsbCwgXCJhcmVhXCIsIGZhbHNlLCBmYWxzZSwgMWUtMjhdLFxyXG4gICAgICAgICAgICAgICAgW1wiYmVjcXVlcmVsXCIsIFwiQnFcIiwgbnVsbCwgXCJyYWRpb2FjdGl2aXR5XCIsIHRydWUsIGZhbHNlLCAxXSxcclxuICAgICAgICAgICAgICAgIFtcImJpdFwiLCBcImJpdFwiLCBbXCJiXCJdLCBcImluZm9ybWF0aW9uXCIsIGZhbHNlLCB0cnVlLCAxXSxcclxuICAgICAgICAgICAgICAgIFtcImJ0dVwiLCBcIkJUVVwiLCBbXCJidHVcIl0sIFwiZW5lcmd5XCIsIGZhbHNlLCB0cnVlLCAxMDU1LjA1NTg1MjYyXSxcclxuICAgICAgICAgICAgICAgIFtcImJ5dGVcIiwgXCJieXRlXCIsIG51bGwsIFwiaW5mb3JtYXRpb25cIiwgZmFsc2UsIHRydWUsIDhdLFxyXG4gICAgICAgICAgICAgICAgW1wiY2FuZGVsYVwiLCBcImNkXCIsIG51bGwsIFwibHVtaW5vdXNfaW50ZW5zaXR5XCIsIHRydWUsIGZhbHNlLCAxXSxcclxuICAgICAgICAgICAgICAgIFtcImNhbmRlbGEgcGVyIHNxdWFyZSBtZXRyZVwiLCBcImNkL20/XCIsIG51bGwsIFwibHVtaW5hbmNlXCIsIHRydWUsIGZhbHNlLCAxXSxcclxuICAgICAgICAgICAgICAgIFtcImNvdWxvbWJcIiwgXCJDXCIsIG51bGwsIFwiZWxlY3RyaWNfY2hhcmdlXCIsIHRydWUsIGZhbHNlLCAxXSxcclxuICAgICAgICAgICAgICAgIFtcImN1YmljIMODwqVuZ3N0csODwrZtXCIsIFwiYW5nM1wiLCBbXCJhbmdeM1wiXSwgXCJ2b2x1bWVcIiwgZmFsc2UsIHRydWUsIDFlLTMwXSxcclxuICAgICAgICAgICAgICAgIFtcImN1YmljIGZvb3RcIiwgXCJmdDNcIiwgW1wiZnReM1wiXSwgXCJ2b2x1bWVcIiwgZmFsc2UsIHRydWUsIDAuMDI4MzE2ODQ2NTkyXSxcclxuICAgICAgICAgICAgICAgIFtcImN1YmljIGluY2hcIiwgXCJpbjNcIiwgW1wiaW5eM1wiXSwgXCJ2b2x1bWVcIiwgZmFsc2UsIHRydWUsIDAuMDAwMDE2Mzg3MDY0XSxcclxuICAgICAgICAgICAgICAgIFtcImN1YmljIGxpZ2h0LXllYXJcIiwgXCJseTNcIiwgW1wibHleM1wiXSwgXCJ2b2x1bWVcIiwgZmFsc2UsIHRydWUsIDguNDY3ODY2NjQ2MjM3MTVlLTQ3XSxcclxuICAgICAgICAgICAgICAgIFtcImN1YmljIG1ldHJlXCIsIFwibT9cIiwgbnVsbCwgXCJ2b2x1bWVcIiwgdHJ1ZSwgdHJ1ZSwgMV0sXHJcbiAgICAgICAgICAgICAgICBbXCJjdWJpYyBtaWxlXCIsIFwibWkzXCIsIFtcIm1pXjNcIl0sIFwidm9sdW1lXCIsIGZhbHNlLCB0cnVlLCA0MTY4MTgxODI1LjQ0MDU4XSxcclxuICAgICAgICAgICAgICAgIFtcImN1YmljIG5hdXRpY2FsIG1pbGVcIiwgXCJObWkzXCIsIFtcIk5taV4zXCJdLCBcInZvbHVtZVwiLCBmYWxzZSwgdHJ1ZSwgNjM1MjE4MjIwOF0sXHJcbiAgICAgICAgICAgICAgICBbXCJjdWJpYyBQaWNhXCIsIFwiUGljYTNcIiwgW1wiUGljYXB0M1wiLCBcIlBpY2FeM1wiLCBcIlBpY2FwdF4zXCJdLCBcInZvbHVtZVwiLCBmYWxzZSwgdHJ1ZSwgNy41ODY2MDM3MDM3MDM2OWUtOF0sXHJcbiAgICAgICAgICAgICAgICBbXCJjdWJpYyB5YXJkXCIsIFwieWQzXCIsIFtcInlkXjNcIl0sIFwidm9sdW1lXCIsIGZhbHNlLCB0cnVlLCAwLjc2NDU1NDg1Nzk4NF0sXHJcbiAgICAgICAgICAgICAgICBbXCJjdXBcIiwgXCJjdXBcIiwgbnVsbCwgXCJ2b2x1bWVcIiwgZmFsc2UsIHRydWUsIDAuMDAwMjM2NTg4MjM2NV0sXHJcbiAgICAgICAgICAgICAgICBbXCJkYWx0b25cIiwgXCJEYVwiLCBbXCJ1XCJdLCBcIm1hc3NcIiwgZmFsc2UsIGZhbHNlLCAxLjY2MDUzODg2MjgyODI4ZS0yN10sXHJcbiAgICAgICAgICAgICAgICBbXCJkYXlcIiwgXCJkXCIsIFtcImRheVwiXSwgXCJ0aW1lXCIsIGZhbHNlLCB0cnVlLCA4NjQwMF0sXHJcbiAgICAgICAgICAgICAgICBbXCJkZWdyZWVcIiwgXCLDgsKwXCIsIG51bGwsIFwiYW5nbGVcIiwgZmFsc2UsIGZhbHNlLCAwLjAxNzQ1MzI5MjUxOTk0MzNdLFxyXG4gICAgICAgICAgICAgICAgW1wiZGVncmVlcyBSYW5raW5lXCIsIFwiUmFua1wiLCBudWxsLCBcInRlbXBlcmF0dXJlXCIsIGZhbHNlLCB0cnVlLCAwLjU1NTU1NTU1NTU1NTU1Nl0sXHJcbiAgICAgICAgICAgICAgICBbXCJkeW5lXCIsIFwiZHluXCIsIFtcImR5XCJdLCBcImZvcmNlXCIsIGZhbHNlLCB0cnVlLCAwLjAwMDAxXSxcclxuICAgICAgICAgICAgICAgIFtcImVsZWN0cm9udm9sdFwiLCBcImVWXCIsIFtcImV2XCJdLCBcImVuZXJneVwiLCBmYWxzZSwgdHJ1ZSwgMS42MDIxNzY1NjUxNDE0MV0sXHJcbiAgICAgICAgICAgICAgICBbXCJlbGxcIiwgXCJlbGxcIiwgbnVsbCwgXCJsZW5ndGhcIiwgZmFsc2UsIHRydWUsIDEuMTQzXSxcclxuICAgICAgICAgICAgICAgIFtcImVyZ1wiLCBcImVyZ1wiLCBbXCJlXCJdLCBcImVuZXJneVwiLCBmYWxzZSwgdHJ1ZSwgMWUtN10sXHJcbiAgICAgICAgICAgICAgICBbXCJmYXJhZFwiLCBcIkZcIiwgbnVsbCwgXCJlbGVjdHJpY19jYXBhY2l0YW5jZVwiLCB0cnVlLCBmYWxzZSwgMV0sXHJcbiAgICAgICAgICAgICAgICBbXCJmbHVpZCBvdW5jZVwiLCBcIm96XCIsIG51bGwsIFwidm9sdW1lXCIsIGZhbHNlLCB0cnVlLCAwLjAwMDAyOTU3MzUyOTU2MjVdLFxyXG4gICAgICAgICAgICAgICAgW1wiZm9vdFwiLCBcImZ0XCIsIG51bGwsIFwibGVuZ3RoXCIsIGZhbHNlLCB0cnVlLCAwLjMwNDhdLFxyXG4gICAgICAgICAgICAgICAgW1wiZm9vdC1wb3VuZFwiLCBcImZsYlwiLCBudWxsLCBcImVuZXJneVwiLCBmYWxzZSwgdHJ1ZSwgMS4zNTU4MTc5NDgzMzE0XSxcclxuICAgICAgICAgICAgICAgIFtcImdhbFwiLCBcIkdhbFwiLCBudWxsLCBcImFjY2VsZXJhdGlvblwiLCBmYWxzZSwgZmFsc2UsIDAuMDFdLFxyXG4gICAgICAgICAgICAgICAgW1wiZ2FsbG9uXCIsIFwiZ2FsXCIsIG51bGwsIFwidm9sdW1lXCIsIGZhbHNlLCB0cnVlLCAwLjAwMzc4NTQxMTc4NF0sXHJcbiAgICAgICAgICAgICAgICBbXCJnYXVzc1wiLCBcIkdcIiwgW1wiZ2FcIl0sIFwibWFnbmV0aWNfZmx1eF9kZW5zaXR5XCIsIGZhbHNlLCB0cnVlLCAxXSxcclxuICAgICAgICAgICAgICAgIFtcImdyYWluXCIsIFwiZ3JhaW5cIiwgbnVsbCwgXCJtYXNzXCIsIGZhbHNlLCB0cnVlLCAwLjAwMDA2NDc5ODldLFxyXG4gICAgICAgICAgICAgICAgW1wiZ3JhbVwiLCBcImdcIiwgbnVsbCwgXCJtYXNzXCIsIGZhbHNlLCB0cnVlLCAwLjAwMV0sXHJcbiAgICAgICAgICAgICAgICBbXCJncmF5XCIsIFwiR3lcIiwgbnVsbCwgXCJhYnNvcmJlZF9kb3NlXCIsIHRydWUsIGZhbHNlLCAxXSxcclxuICAgICAgICAgICAgICAgIFtcImdyb3NzIHJlZ2lzdGVyZWQgdG9uXCIsIFwiR1JUXCIsIFtcInJlZ3RvblwiXSwgXCJ2b2x1bWVcIiwgZmFsc2UsIHRydWUsIDIuODMxNjg0NjU5Ml0sXHJcbiAgICAgICAgICAgICAgICBbXCJoZWN0YXJlXCIsIFwiaGFcIiwgbnVsbCwgXCJhcmVhXCIsIGZhbHNlLCB0cnVlLCAxMDAwMF0sXHJcbiAgICAgICAgICAgICAgICBbXCJoZW5yeVwiLCBcIkhcIiwgbnVsbCwgXCJpbmR1Y3RhbmNlXCIsIHRydWUsIGZhbHNlLCAxXSxcclxuICAgICAgICAgICAgICAgIFtcImhlcnR6XCIsIFwiSHpcIiwgbnVsbCwgXCJmcmVxdWVuY3lcIiwgdHJ1ZSwgZmFsc2UsIDFdLFxyXG4gICAgICAgICAgICAgICAgW1wiaG9yc2Vwb3dlclwiLCBcIkhQXCIsIFtcImhcIl0sIFwicG93ZXJcIiwgZmFsc2UsIHRydWUsIDc0NS42OTk4NzE1ODIyN10sXHJcbiAgICAgICAgICAgICAgICBbXCJob3JzZXBvd2VyLWhvdXJcIiwgXCJIUGhcIiwgW1wiaGhcIiwgXCJocGhcIl0sIFwiZW5lcmd5XCIsIGZhbHNlLCB0cnVlLCAyNjg0NTE5LjUzOF0sXHJcbiAgICAgICAgICAgICAgICBbXCJob3VyXCIsIFwiaFwiLCBbXCJoclwiXSwgXCJ0aW1lXCIsIGZhbHNlLCB0cnVlLCAzNjAwXSxcclxuICAgICAgICAgICAgICAgIFtcImltcGVyaWFsIGdhbGxvbiAoVS5LLilcIiwgXCJ1a19nYWxcIiwgbnVsbCwgXCJ2b2x1bWVcIiwgZmFsc2UsIHRydWUsIDAuMDA0NTQ2MDldLFxyXG4gICAgICAgICAgICAgICAgW1wiaW1wZXJpYWwgaHVuZHJlZHdlaWdodFwiLCBcImxjd3RcIiwgW1widWtfY3d0XCIsIFwiaHdlaWdodFwiXSwgXCJtYXNzXCIsIGZhbHNlLCB0cnVlLCA1MC44MDIzNDVdLFxyXG4gICAgICAgICAgICAgICAgW1wiaW1wZXJpYWwgcXVhcnQgKFUuSylcIiwgXCJ1a19xdFwiLCBudWxsLCBcInZvbHVtZVwiLCBmYWxzZSwgdHJ1ZSwgMC4wMDExMzY1MjI1XSxcclxuICAgICAgICAgICAgICAgIFtcImltcGVyaWFsIHRvblwiLCBcImJydG9uXCIsIFtcInVrX3RvblwiLCBcIkxUT05cIl0sIFwibWFzc1wiLCBmYWxzZSwgdHJ1ZSwgMTAxNi4wNDY5MDldLFxyXG4gICAgICAgICAgICAgICAgW1wiaW5jaFwiLCBcImluXCIsIG51bGwsIFwibGVuZ3RoXCIsIGZhbHNlLCB0cnVlLCAwLjAyNTRdLFxyXG4gICAgICAgICAgICAgICAgW1wiaW50ZXJuYXRpb25hbCBhY3JlXCIsIFwidWtfYWNyZVwiLCBudWxsLCBcImFyZWFcIiwgZmFsc2UsIHRydWUsIDQwNDYuODU2NDIyNF0sXHJcbiAgICAgICAgICAgICAgICBbXCJJVCBjYWxvcmllXCIsIFwiY2FsXCIsIG51bGwsIFwiZW5lcmd5XCIsIGZhbHNlLCB0cnVlLCA0LjE4NjhdLFxyXG4gICAgICAgICAgICAgICAgW1wiam91bGVcIiwgXCJKXCIsIG51bGwsIFwiZW5lcmd5XCIsIHRydWUsIHRydWUsIDFdLFxyXG4gICAgICAgICAgICAgICAgW1wia2F0YWxcIiwgXCJrYXRcIiwgbnVsbCwgXCJjYXRhbHl0aWNfYWN0aXZpdHlcIiwgdHJ1ZSwgZmFsc2UsIDFdLFxyXG4gICAgICAgICAgICAgICAgW1wia2VsdmluXCIsIFwiS1wiLCBbXCJrZWxcIl0sIFwidGVtcGVyYXR1cmVcIiwgdHJ1ZSwgdHJ1ZSwgMV0sXHJcbiAgICAgICAgICAgICAgICBbXCJraWxvZ3JhbVwiLCBcImtnXCIsIG51bGwsIFwibWFzc1wiLCB0cnVlLCB0cnVlLCAxXSxcclxuICAgICAgICAgICAgICAgIFtcImtub3RcIiwgXCJrblwiLCBudWxsLCBcInNwZWVkXCIsIGZhbHNlLCB0cnVlLCAwLjUxNDQ0NDQ0NDQ0NDQ0NF0sXHJcbiAgICAgICAgICAgICAgICBbXCJsaWdodC15ZWFyXCIsIFwibHlcIiwgbnVsbCwgXCJsZW5ndGhcIiwgZmFsc2UsIHRydWUsIDk0NjA3MzA0NzI1ODA4MDBdLFxyXG4gICAgICAgICAgICAgICAgW1wibGl0cmVcIiwgXCJMXCIsIFtcImxcIiwgXCJsdFwiXSwgXCJ2b2x1bWVcIiwgZmFsc2UsIHRydWUsIDAuMDAxXSxcclxuICAgICAgICAgICAgICAgIFtcImx1bWVuXCIsIFwibG1cIiwgbnVsbCwgXCJsdW1pbm91c19mbHV4XCIsIHRydWUsIGZhbHNlLCAxXSxcclxuICAgICAgICAgICAgICAgIFtcImx1eFwiLCBcImx4XCIsIG51bGwsIFwiaWxsdW1pbmFuY2VcIiwgdHJ1ZSwgZmFsc2UsIDFdLFxyXG4gICAgICAgICAgICAgICAgW1wibWF4d2VsbFwiLCBcIk14XCIsIG51bGwsIFwibWFnbmV0aWNfZmx1eFwiLCBmYWxzZSwgZmFsc2UsIDFlLTE4XSxcclxuICAgICAgICAgICAgICAgIFtcIm1lYXN1cmVtZW50IHRvblwiLCBcIk1UT05cIiwgbnVsbCwgXCJ2b2x1bWVcIiwgZmFsc2UsIHRydWUsIDEuMTMyNjczODYzNjhdLFxyXG4gICAgICAgICAgICAgICAgW1wibWV0ZXIgcGVyIGhvdXJcIiwgXCJtL2hcIiwgW1wibS9oclwiXSwgXCJzcGVlZFwiLCBmYWxzZSwgdHJ1ZSwgMC4wMDAyNzc3Nzc3Nzc3Nzc3OF0sXHJcbiAgICAgICAgICAgICAgICBbXCJtZXRlciBwZXIgc2Vjb25kXCIsIFwibS9zXCIsIFtcIm0vc2VjXCJdLCBcInNwZWVkXCIsIHRydWUsIHRydWUsIDFdLFxyXG4gICAgICAgICAgICAgICAgW1wibWV0ZXIgcGVyIHNlY29uZCBzcXVhcmVkXCIsIFwibT9zPz9cIiwgbnVsbCwgXCJhY2NlbGVyYXRpb25cIiwgdHJ1ZSwgZmFsc2UsIDFdLFxyXG4gICAgICAgICAgICAgICAgW1wicGFyc2VjXCIsIFwicGNcIiwgW1wicGFyc2VjXCJdLCBcImxlbmd0aFwiLCBmYWxzZSwgdHJ1ZSwgMzA4NTY3NzU4MTQ2NzE5MDBdLFxyXG4gICAgICAgICAgICAgICAgW1wibWV0ZXIgc3F1YXJlZCBwZXIgc2Vjb25kXCIsIFwibT8vc1wiLCBudWxsLCBcImtpbmVtYXRpY192aXNjb3NpdHlcIiwgdHJ1ZSwgZmFsc2UsIDFdLFxyXG4gICAgICAgICAgICAgICAgW1wibWV0cmVcIiwgXCJtXCIsIG51bGwsIFwibGVuZ3RoXCIsIHRydWUsIHRydWUsIDFdLFxyXG4gICAgICAgICAgICAgICAgW1wibWlsZXMgcGVyIGhvdXJcIiwgXCJtcGhcIiwgbnVsbCwgXCJzcGVlZFwiLCBmYWxzZSwgdHJ1ZSwgMC40NDcwNF0sXHJcbiAgICAgICAgICAgICAgICBbXCJtaWxsaW1ldHJlIG9mIG1lcmN1cnlcIiwgXCJtbUhnXCIsIG51bGwsIFwicHJlc3N1cmVcIiwgZmFsc2UsIGZhbHNlLCAxMzMuMzIyXSxcclxuICAgICAgICAgICAgICAgIFtcIm1pbnV0ZVwiLCBcIj9cIiwgbnVsbCwgXCJhbmdsZVwiLCBmYWxzZSwgZmFsc2UsIDAuMDAwMjkwODg4MjA4NjY1NzIyXSxcclxuICAgICAgICAgICAgICAgIFtcIm1pbnV0ZVwiLCBcIm1pblwiLCBbXCJtblwiXSwgXCJ0aW1lXCIsIGZhbHNlLCB0cnVlLCA2MF0sXHJcbiAgICAgICAgICAgICAgICBbXCJtb2Rlcm4gdGVhc3Bvb25cIiwgXCJ0c3BtXCIsIG51bGwsIFwidm9sdW1lXCIsIGZhbHNlLCB0cnVlLCAwLjAwMDAwNV0sXHJcbiAgICAgICAgICAgICAgICBbXCJtb2xlXCIsIFwibW9sXCIsIG51bGwsIFwiYW1vdW50X29mX3N1YnN0YW5jZVwiLCB0cnVlLCBmYWxzZSwgMV0sXHJcbiAgICAgICAgICAgICAgICBbXCJtb3JnZW5cIiwgXCJNb3JnZW5cIiwgbnVsbCwgXCJhcmVhXCIsIGZhbHNlLCB0cnVlLCAyNTAwXSxcclxuICAgICAgICAgICAgICAgIFtcIm4udS4gb2YgYWN0aW9uXCIsIFwiP1wiLCBudWxsLCBcImFjdGlvblwiLCBmYWxzZSwgZmFsc2UsIDEuMDU0NTcxNjgxODE4MThlLTM0XSxcclxuICAgICAgICAgICAgICAgIFtcIm4udS4gb2YgbWFzc1wiLCBcIm0/XCIsIG51bGwsIFwibWFzc1wiLCBmYWxzZSwgZmFsc2UsIDkuMTA5MzgyNjE2MTYxNjJlLTMxXSxcclxuICAgICAgICAgICAgICAgIFtcIm4udS4gb2Ygc3BlZWRcIiwgXCJjP1wiLCBudWxsLCBcInNwZWVkXCIsIGZhbHNlLCBmYWxzZSwgMjk5NzkyNDU4XSxcclxuICAgICAgICAgICAgICAgIFtcIm4udS4gb2YgdGltZVwiLCBcIj8vKG1lP2M/PylcIiwgbnVsbCwgXCJ0aW1lXCIsIGZhbHNlLCBmYWxzZSwgMS4yODgwODg2Njc3ODY4N2UtMjFdLFxyXG4gICAgICAgICAgICAgICAgW1wibmF1dGljYWwgbWlsZVwiLCBcIk1cIiwgW1wiTm1pXCJdLCBcImxlbmd0aFwiLCBmYWxzZSwgdHJ1ZSwgMTg1Ml0sXHJcbiAgICAgICAgICAgICAgICBbXCJuZXd0b25cIiwgXCJOXCIsIG51bGwsIFwiZm9yY2VcIiwgdHJ1ZSwgdHJ1ZSwgMV0sXHJcbiAgICAgICAgICAgICAgICBbXCLDheKAnHJzdGVkXCIsIFwiT2UgXCIsIG51bGwsIFwibWFnbmV0aWNfZmllbGRfaW50ZW5zaXR5XCIsIGZhbHNlLCBmYWxzZSwgNzkuNTc3NDcxNTQ1OTQ3N10sXHJcbiAgICAgICAgICAgICAgICBbXCJvaG1cIiwgXCLDjsKpXCIsIG51bGwsIFwiZWxlY3RyaWNfcmVzaXN0YW5jZVwiLCB0cnVlLCBmYWxzZSwgMV0sXHJcbiAgICAgICAgICAgICAgICBbXCJvdW5jZSBtYXNzXCIsIFwib3ptXCIsIG51bGwsIFwibWFzc1wiLCBmYWxzZSwgdHJ1ZSwgMC4wMjgzNDk1MjMxMjVdLFxyXG4gICAgICAgICAgICAgICAgW1wicGFzY2FsXCIsIFwiUGFcIiwgbnVsbCwgXCJwcmVzc3VyZVwiLCB0cnVlLCBmYWxzZSwgMV0sXHJcbiAgICAgICAgICAgICAgICBbXCJwYXNjYWwgc2Vjb25kXCIsIFwiUGE/c1wiLCBudWxsLCBcImR5bmFtaWNfdmlzY29zaXR5XCIsIHRydWUsIGZhbHNlLCAxXSxcclxuICAgICAgICAgICAgICAgIFtcInBmZXJkZXN0w4PCpHJrZVwiLCBcIlBTXCIsIG51bGwsIFwicG93ZXJcIiwgZmFsc2UsIHRydWUsIDczNS40OTg3NV0sXHJcbiAgICAgICAgICAgICAgICBbXCJwaG90XCIsIFwicGhcIiwgbnVsbCwgXCJpbGx1bWluYW5jZVwiLCBmYWxzZSwgZmFsc2UsIDAuMDAwMV0sXHJcbiAgICAgICAgICAgICAgICBbXCJwaWNhICgxLzYgaW5jaClcIiwgXCJwaWNhXCIsIG51bGwsIFwibGVuZ3RoXCIsIGZhbHNlLCB0cnVlLCAwLjAwMDM1Mjc3Nzc3Nzc3Nzc4XSxcclxuICAgICAgICAgICAgICAgIFtcInBpY2EgKDEvNzIgaW5jaClcIiwgXCJQaWNhXCIsIFtcIlBpY2FwdFwiXSwgXCJsZW5ndGhcIiwgZmFsc2UsIHRydWUsIDAuMDA0MjMzMzMzMzMzMzMzMzNdLFxyXG4gICAgICAgICAgICAgICAgW1wicG9pc2VcIiwgXCJQXCIsIG51bGwsIFwiZHluYW1pY192aXNjb3NpdHlcIiwgZmFsc2UsIGZhbHNlLCAwLjFdLFxyXG4gICAgICAgICAgICAgICAgW1wicG9uZFwiLCBcInBvbmRcIiwgbnVsbCwgXCJmb3JjZVwiLCBmYWxzZSwgdHJ1ZSwgMC4wMDk4MDY2NV0sXHJcbiAgICAgICAgICAgICAgICBbXCJwb3VuZCBmb3JjZVwiLCBcImxiZlwiLCBudWxsLCBcImZvcmNlXCIsIGZhbHNlLCB0cnVlLCA0LjQ0ODIyMTYxNTI2MDVdLFxyXG4gICAgICAgICAgICAgICAgW1wicG91bmQgbWFzc1wiLCBcImxibVwiLCBudWxsLCBcIm1hc3NcIiwgZmFsc2UsIHRydWUsIDAuNDUzNTkyMzddLFxyXG4gICAgICAgICAgICAgICAgW1wicXVhcnRcIiwgXCJxdFwiLCBudWxsLCBcInZvbHVtZVwiLCBmYWxzZSwgdHJ1ZSwgMC4wMDA5NDYzNTI5NDZdLFxyXG4gICAgICAgICAgICAgICAgW1wicmFkaWFuXCIsIFwicmFkXCIsIG51bGwsIFwiYW5nbGVcIiwgdHJ1ZSwgZmFsc2UsIDFdLFxyXG4gICAgICAgICAgICAgICAgW1wic2Vjb25kXCIsIFwiP1wiLCBudWxsLCBcImFuZ2xlXCIsIGZhbHNlLCBmYWxzZSwgMC4wMDAwMDQ4NDgxMzY4MTEwOTUzNl0sXHJcbiAgICAgICAgICAgICAgICBbXCJzZWNvbmRcIiwgXCJzXCIsIFtcInNlY1wiXSwgXCJ0aW1lXCIsIHRydWUsIHRydWUsIDFdLFxyXG4gICAgICAgICAgICAgICAgW1wic2hvcnQgaHVuZHJlZHdlaWdodFwiLCBcImN3dFwiLCBbXCJzaHdlaWdodFwiXSwgXCJtYXNzXCIsIGZhbHNlLCB0cnVlLCA0NS4zNTkyMzddLFxyXG4gICAgICAgICAgICAgICAgW1wic2llbWVuc1wiLCBcIlNcIiwgbnVsbCwgXCJlbGVjdHJpY2FsX2NvbmR1Y3RhbmNlXCIsIHRydWUsIGZhbHNlLCAxXSxcclxuICAgICAgICAgICAgICAgIFtcInNpZXZlcnRcIiwgXCJTdlwiLCBudWxsLCBcImVxdWl2YWxlbnRfZG9zZVwiLCB0cnVlLCBmYWxzZSwgMV0sXHJcbiAgICAgICAgICAgICAgICBbXCJzbHVnXCIsIFwic2dcIiwgbnVsbCwgXCJtYXNzXCIsIGZhbHNlLCB0cnVlLCAxNC41OTM5MDI5NF0sXHJcbiAgICAgICAgICAgICAgICBbXCJzcXVhcmUgw4PCpW5nc3Ryw4PCtm1cIiwgXCJhbmcyXCIsIFtcImFuZ14yXCJdLCBcImFyZWFcIiwgZmFsc2UsIHRydWUsIDFlLTIwXSxcclxuICAgICAgICAgICAgICAgIFtcInNxdWFyZSBmb290XCIsIFwiZnQyXCIsIFtcImZ0XjJcIl0sIFwiYXJlYVwiLCBmYWxzZSwgdHJ1ZSwgMC4wOTI5MDMwNF0sXHJcbiAgICAgICAgICAgICAgICBbXCJzcXVhcmUgaW5jaFwiLCBcImluMlwiLCBbXCJpbl4yXCJdLCBcImFyZWFcIiwgZmFsc2UsIHRydWUsIDAuMDAwNjQ1MTZdLFxyXG4gICAgICAgICAgICAgICAgW1wic3F1YXJlIGxpZ2h0LXllYXJcIiwgXCJseTJcIiwgW1wibHleMlwiXSwgXCJhcmVhXCIsIGZhbHNlLCB0cnVlLCA4Ljk1MDU0MjEwNzQ4MTg5ZSszMV0sXHJcbiAgICAgICAgICAgICAgICBbXCJzcXVhcmUgbWV0ZXJcIiwgXCJtP1wiLCBudWxsLCBcImFyZWFcIiwgdHJ1ZSwgdHJ1ZSwgMV0sXHJcbiAgICAgICAgICAgICAgICBbXCJzcXVhcmUgbWlsZVwiLCBcIm1pMlwiLCBbXCJtaV4yXCJdLCBcImFyZWFcIiwgZmFsc2UsIHRydWUsIDI1ODk5ODguMTEwMzM2XSxcclxuICAgICAgICAgICAgICAgIFtcInNxdWFyZSBuYXV0aWNhbCBtaWxlXCIsIFwiTm1pMlwiLCBbXCJObWleMlwiXSwgXCJhcmVhXCIsIGZhbHNlLCB0cnVlLCAzNDI5OTA0XSxcclxuICAgICAgICAgICAgICAgIFtcInNxdWFyZSBQaWNhXCIsIFwiUGljYTJcIiwgW1wiUGljYXB0MlwiLCBcIlBpY2FeMlwiLCBcIlBpY2FwdF4yXCJdLCBcImFyZWFcIiwgZmFsc2UsIHRydWUsIDAuMDAwMDE3OTIxMTExMTExMTFdLFxyXG4gICAgICAgICAgICAgICAgW1wic3F1YXJlIHlhcmRcIiwgXCJ5ZDJcIiwgW1wieWReMlwiXSwgXCJhcmVhXCIsIGZhbHNlLCB0cnVlLCAwLjgzNjEyNzM2XSxcclxuICAgICAgICAgICAgICAgIFtcInN0YXR1dGUgbWlsZVwiLCBcIm1pXCIsIG51bGwsIFwibGVuZ3RoXCIsIGZhbHNlLCB0cnVlLCAxNjA5LjM0NF0sXHJcbiAgICAgICAgICAgICAgICBbXCJzdGVyYWRpYW5cIiwgXCJzclwiLCBudWxsLCBcInNvbGlkX2FuZ2xlXCIsIHRydWUsIGZhbHNlLCAxXSxcclxuICAgICAgICAgICAgICAgIFtcInN0aWxiXCIsIFwic2JcIiwgbnVsbCwgXCJsdW1pbmFuY2VcIiwgZmFsc2UsIGZhbHNlLCAwLjAwMDFdLFxyXG4gICAgICAgICAgICAgICAgW1wic3Rva2VzXCIsIFwiU3RcIiwgbnVsbCwgXCJraW5lbWF0aWNfdmlzY29zaXR5XCIsIGZhbHNlLCBmYWxzZSwgMC4wMDAxXSxcclxuICAgICAgICAgICAgICAgIFtcInN0b25lXCIsIFwic3RvbmVcIiwgbnVsbCwgXCJtYXNzXCIsIGZhbHNlLCB0cnVlLCA2LjM1MDI5MzE4XSxcclxuICAgICAgICAgICAgICAgIFtcInRhYmxlc3Bvb25cIiwgXCJ0YnNcIiwgbnVsbCwgXCJ2b2x1bWVcIiwgZmFsc2UsIHRydWUsIDAuMDAwMDE0Nzg2OF0sXHJcbiAgICAgICAgICAgICAgICBbXCJ0ZWFzcG9vblwiLCBcInRzcFwiLCBudWxsLCBcInZvbHVtZVwiLCBmYWxzZSwgdHJ1ZSwgMC4wMDAwMDQ5Mjg5Ml0sXHJcbiAgICAgICAgICAgICAgICBbXCJ0ZXNsYVwiLCBcIlRcIiwgbnVsbCwgXCJtYWduZXRpY19mbHV4X2RlbnNpdHlcIiwgdHJ1ZSwgdHJ1ZSwgMV0sXHJcbiAgICAgICAgICAgICAgICBbXCJ0aGVybW9keW5hbWljIGNhbG9yaWVcIiwgXCJjXCIsIG51bGwsIFwiZW5lcmd5XCIsIGZhbHNlLCB0cnVlLCA0LjE4NF0sXHJcbiAgICAgICAgICAgICAgICBbXCJ0b25cIiwgXCJ0b25cIiwgbnVsbCwgXCJtYXNzXCIsIGZhbHNlLCB0cnVlLCA5MDcuMTg0NzRdLFxyXG4gICAgICAgICAgICAgICAgW1widG9ubmVcIiwgXCJ0XCIsIG51bGwsIFwibWFzc1wiLCBmYWxzZSwgZmFsc2UsIDEwMDBdLFxyXG4gICAgICAgICAgICAgICAgW1wiVS5LLiBwaW50XCIsIFwidWtfcHRcIiwgbnVsbCwgXCJ2b2x1bWVcIiwgZmFsc2UsIHRydWUsIDAuMDAwNTY4MjYxMjVdLFxyXG4gICAgICAgICAgICAgICAgW1wiVS5TLiBidXNoZWxcIiwgXCJidXNoZWxcIiwgbnVsbCwgXCJ2b2x1bWVcIiwgZmFsc2UsIHRydWUsIDAuMDM1MjM5MDddLFxyXG4gICAgICAgICAgICAgICAgW1wiVS5TLiBvaWwgYmFycmVsXCIsIFwiYmFycmVsXCIsIG51bGwsIFwidm9sdW1lXCIsIGZhbHNlLCB0cnVlLCAwLjE1ODk4NzI5NV0sXHJcbiAgICAgICAgICAgICAgICBbXCJVLlMuIHBpbnRcIiwgXCJwdFwiLCBbXCJ1c19wdFwiXSwgXCJ2b2x1bWVcIiwgZmFsc2UsIHRydWUsIDAuMDAwNDczMTc2NDczXSxcclxuICAgICAgICAgICAgICAgIFtcIlUuUy4gc3VydmV5IG1pbGVcIiwgXCJzdXJ2ZXlfbWlcIiwgbnVsbCwgXCJsZW5ndGhcIiwgZmFsc2UsIHRydWUsIDE2MDkuMzQ3MjE5XSxcclxuICAgICAgICAgICAgICAgIFtcIlUuUy4gc3VydmV5L3N0YXR1dGUgYWNyZVwiLCBcInVzX2FjcmVcIiwgbnVsbCwgXCJhcmVhXCIsIGZhbHNlLCB0cnVlLCA0MDQ2Ljg3MjYxXSxcclxuICAgICAgICAgICAgICAgIFtcInZvbHRcIiwgXCJWXCIsIG51bGwsIFwidm9sdGFnZVwiLCB0cnVlLCBmYWxzZSwgMV0sXHJcbiAgICAgICAgICAgICAgICBbXCJ3YXR0XCIsIFwiV1wiLCBudWxsLCBcInBvd2VyXCIsIHRydWUsIHRydWUsIDFdLFxyXG4gICAgICAgICAgICAgICAgW1wid2F0dC1ob3VyXCIsIFwiV2hcIiwgW1wid2hcIl0sIFwiZW5lcmd5XCIsIGZhbHNlLCB0cnVlLCAzNjAwXSxcclxuICAgICAgICAgICAgICAgIFtcIndlYmVyXCIsIFwiV2JcIiwgbnVsbCwgXCJtYWduZXRpY19mbHV4XCIsIHRydWUsIGZhbHNlLCAxXSxcclxuICAgICAgICAgICAgICAgIFtcInlhcmRcIiwgXCJ5ZFwiLCBudWxsLCBcImxlbmd0aFwiLCBmYWxzZSwgdHJ1ZSwgMC45MTQ0XSxcclxuICAgICAgICAgICAgICAgIFtcInllYXJcIiwgXCJ5clwiLCBudWxsLCBcInRpbWVcIiwgZmFsc2UsIHRydWUsIDMxNTU3NjAwXVxyXG4gICAgICAgICAgICBdO1xyXG5cclxuICAgICAgICAgICAgLy8gQmluYXJ5IHByZWZpeGVzXHJcbiAgICAgICAgICAgIC8vIFtOYW1lLCBQcmVmaXggcG93ZXIgb2YgMiB2YWx1ZSwgUHJldml4IHZhbHVlLCBBYmJyZXZpYXRpb24sIERlcml2ZWRcclxuICAgICAgICAgICAgLy8gZnJvbV1cclxuICAgICAgICAgICAgdmFyIGJpbmFyeV9wcmVmaXhlcyA9IHtcclxuICAgICAgICAgICAgICAgIFlpOiBbXCJ5b2JpXCIsIDgwLCAxMjA4OTI1ODE5NjE0NjI5MTc0NzA2MTc2LCBcIllpXCIsIFwieW90dGFcIl0sXHJcbiAgICAgICAgICAgICAgICBaaTogW1wiemViaVwiLCA3MCwgMTE4MDU5MTYyMDcxNzQxMTMwMzQyNCwgXCJaaVwiLCBcInpldHRhXCJdLFxyXG4gICAgICAgICAgICAgICAgRWk6IFtcImV4YmlcIiwgNjAsIDExNTI5MjE1MDQ2MDY4NDY5NzYsIFwiRWlcIiwgXCJleGFcIl0sXHJcbiAgICAgICAgICAgICAgICBQaTogW1wicGViaVwiLCA1MCwgMTEyNTg5OTkwNjg0MjYyNCwgXCJQaVwiLCBcInBldGFcIl0sXHJcbiAgICAgICAgICAgICAgICBUaTogW1widGViaVwiLCA0MCwgMTA5OTUxMTYyNzc3NiwgXCJUaVwiLCBcInRlcmFcIl0sXHJcbiAgICAgICAgICAgICAgICBHaTogW1wiZ2liaVwiLCAzMCwgMTA3Mzc0MTgyNCwgXCJHaVwiLCBcImdpZ2FcIl0sXHJcbiAgICAgICAgICAgICAgICBNaTogW1wibWViaVwiLCAyMCwgMTA0ODU3NiwgXCJNaVwiLCBcIm1lZ2FcIl0sXHJcbiAgICAgICAgICAgICAgICBraTogW1wia2liaVwiLCAxMCwgMTAyNCwgXCJraVwiLCBcImtpbG9cIl1cclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgIC8vIFVuaXQgcHJlZml4ZXNcclxuICAgICAgICAgICAgLy8gW05hbWUsIE11bHRpcGxpZXIsIEFiYnJldmlhdGlvbl1cclxuICAgICAgICAgICAgdmFyIHVuaXRfcHJlZml4ZXMgPSB7XHJcbiAgICAgICAgICAgICAgICBZOiBbXCJ5b3R0YVwiLCAxZSsyNCwgXCJZXCJdLFxyXG4gICAgICAgICAgICAgICAgWjogW1wiemV0dGFcIiwgMWUrMjEsIFwiWlwiXSxcclxuICAgICAgICAgICAgICAgIEU6IFtcImV4YVwiLCAxZSsxOCwgXCJFXCJdLFxyXG4gICAgICAgICAgICAgICAgUDogW1wicGV0YVwiLCAxZSsxNSwgXCJQXCJdLFxyXG4gICAgICAgICAgICAgICAgVDogW1widGVyYVwiLCAxZSsxMiwgXCJUXCJdLFxyXG4gICAgICAgICAgICAgICAgRzogW1wiZ2lnYVwiLCAxZSswOSwgXCJHXCJdLFxyXG4gICAgICAgICAgICAgICAgTTogW1wibWVnYVwiLCAxZSswNiwgXCJNXCJdLFxyXG4gICAgICAgICAgICAgICAgazogW1wia2lsb1wiLCAxZSswMywgXCJrXCJdLFxyXG4gICAgICAgICAgICAgICAgaDogW1wiaGVjdG9cIiwgMWUrMDIsIFwiaFwiXSxcclxuICAgICAgICAgICAgICAgIGU6IFtcImRla2FvXCIsIDFlKzAxLCBcImVcIl0sXHJcbiAgICAgICAgICAgICAgICBkOiBbXCJkZWNpXCIsIDFlLTAxLCBcImRcIl0sXHJcbiAgICAgICAgICAgICAgICBjOiBbXCJjZW50aVwiLCAxZS0wMiwgXCJjXCJdLFxyXG4gICAgICAgICAgICAgICAgbTogW1wibWlsbGlcIiwgMWUtMDMsIFwibVwiXSxcclxuICAgICAgICAgICAgICAgIHU6IFtcIm1pY3JvXCIsIDFlLTA2LCBcInVcIl0sXHJcbiAgICAgICAgICAgICAgICBuOiBbXCJuYW5vXCIsIDFlLTA5LCBcIm5cIl0sXHJcbiAgICAgICAgICAgICAgICBwOiBbXCJwaWNvXCIsIDFlLTEyLCBcInBcIl0sXHJcbiAgICAgICAgICAgICAgICBmOiBbXCJmZW10b1wiLCAxZS0xNSwgXCJmXCJdLFxyXG4gICAgICAgICAgICAgICAgYTogW1wiYXR0b1wiLCAxZS0xOCwgXCJhXCJdLFxyXG4gICAgICAgICAgICAgICAgejogW1wiemVwdG9cIiwgMWUtMjEsIFwielwiXSxcclxuICAgICAgICAgICAgICAgIHk6IFtcInlvY3RvXCIsIDFlLTI0LCBcInlcIl1cclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgIC8vIEluaXRpYWxpemUgdW5pdHMgYW5kIG11bHRpcGxpZXJzXHJcbiAgICAgICAgICAgIHZhciBmcm9tID0gbnVsbDtcclxuICAgICAgICAgICAgdmFyIHRvID0gbnVsbDtcclxuICAgICAgICAgICAgdmFyIGJhc2VfZnJvbV91bml0ID0gZnJvbV91bml0O1xyXG4gICAgICAgICAgICB2YXIgYmFzZV90b191bml0ID0gdG9fdW5pdDtcclxuICAgICAgICAgICAgdmFyIGZyb21fbXVsdGlwbGllciA9IDE7XHJcbiAgICAgICAgICAgIHZhciB0b19tdWx0aXBsaWVyID0gMTtcclxuICAgICAgICAgICAgdmFyIGFsdDtcclxuXHJcbiAgICAgICAgICAgIC8vIExvb2t1cCBmcm9tIGFuZCB0byB1bml0c1xyXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHVuaXRzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICBhbHQgPSAodW5pdHNbaV1bMl0gPT09IG51bGwpID8gW10gOiB1bml0c1tpXVsyXTtcclxuICAgICAgICAgICAgICAgIGlmICh1bml0c1tpXVsxXSA9PT0gYmFzZV9mcm9tX3VuaXQgfHwgYWx0LmluZGV4T2YoYmFzZV9mcm9tX3VuaXQpID49IDApIHtcclxuICAgICAgICAgICAgICAgICAgICBmcm9tID0gdW5pdHNbaV07XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAodW5pdHNbaV1bMV0gPT09IGJhc2VfdG9fdW5pdCB8fCBhbHQuaW5kZXhPZihiYXNlX3RvX3VuaXQpID49IDApIHtcclxuICAgICAgICAgICAgICAgICAgICB0byA9IHVuaXRzW2ldO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBMb29rdXAgZnJvbSBwcmVmaXhcclxuICAgICAgICAgICAgaWYgKGZyb20gPT09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgIHZhciBmcm9tX2JpbmFyeV9wcmVmaXggPSBiaW5hcnlfcHJlZml4ZXNbZnJvbV91bml0LnN1YnN0cmluZygwLCAyKV07XHJcbiAgICAgICAgICAgICAgICB2YXIgZnJvbV91bml0X3ByZWZpeCA9IHVuaXRfcHJlZml4ZXNbZnJvbV91bml0LnN1YnN0cmluZygwLCAxKV07XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gSGFuZGxlIGRla2FvIHVuaXQgcHJlZml4IChvbmx5IHVuaXQgcHJlZml4IHdpdGggdHdvIGNoYXJhY3RlcnMpXHJcbiAgICAgICAgICAgICAgICBpZiAoZnJvbV91bml0LnN1YnN0cmluZygwLCAyKSA9PT0gJ2RhJykge1xyXG4gICAgICAgICAgICAgICAgICAgIGZyb21fdW5pdF9wcmVmaXggPSBbXCJkZWthb1wiLCAxZSswMSwgXCJkYVwiXTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAvLyBIYW5kbGUgYmluYXJ5IHByZWZpeGVzIGZpcnN0IChzbyB0aGF0ICdZaScgaXMgcHJvY2Vzc2VkIGJlZm9yZVxyXG4gICAgICAgICAgICAgICAgLy8gJ1knKVxyXG4gICAgICAgICAgICAgICAgaWYgKGZyb21fYmluYXJ5X3ByZWZpeCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGZyb21fbXVsdGlwbGllciA9IGZyb21fYmluYXJ5X3ByZWZpeFsyXTtcclxuICAgICAgICAgICAgICAgICAgICBiYXNlX2Zyb21fdW5pdCA9IGZyb21fdW5pdC5zdWJzdHJpbmcoMik7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGZyb21fdW5pdF9wcmVmaXgpIHtcclxuICAgICAgICAgICAgICAgICAgICBmcm9tX211bHRpcGxpZXIgPSBmcm9tX3VuaXRfcHJlZml4WzFdO1xyXG4gICAgICAgICAgICAgICAgICAgIGJhc2VfZnJvbV91bml0ID0gZnJvbV91bml0LnN1YnN0cmluZyhmcm9tX3VuaXRfcHJlZml4WzJdLmxlbmd0aCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gTG9va3VwIGZyb20gdW5pdFxyXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCB1bml0cy5sZW5ndGg7IGorKykge1xyXG4gICAgICAgICAgICAgICAgICAgIGFsdCA9ICh1bml0c1tqXVsyXSA9PT0gbnVsbCkgPyBbXSA6IHVuaXRzW2pdWzJdO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh1bml0c1tqXVsxXSA9PT0gYmFzZV9mcm9tX3VuaXQgfHwgYWx0LmluZGV4T2YoYmFzZV9mcm9tX3VuaXQpID49IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZnJvbSA9IHVuaXRzW2pdO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gTG9va3VwIHRvIHByZWZpeFxyXG4gICAgICAgICAgICBpZiAodG8gPT09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgIHZhciB0b19iaW5hcnlfcHJlZml4ID0gYmluYXJ5X3ByZWZpeGVzW3RvX3VuaXQuc3Vic3RyaW5nKDAsIDIpXTtcclxuICAgICAgICAgICAgICAgIHZhciB0b191bml0X3ByZWZpeCA9IHVuaXRfcHJlZml4ZXNbdG9fdW5pdC5zdWJzdHJpbmcoMCwgMSldO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIEhhbmRsZSBkZWthbyB1bml0IHByZWZpeCAob25seSB1bml0IHByZWZpeCB3aXRoIHR3byBjaGFyYWN0ZXJzKVxyXG4gICAgICAgICAgICAgICAgaWYgKHRvX3VuaXQuc3Vic3RyaW5nKDAsIDIpID09PSAnZGEnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdG9fdW5pdF9wcmVmaXggPSBbXCJkZWthb1wiLCAxZSswMSwgXCJkYVwiXTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAvLyBIYW5kbGUgYmluYXJ5IHByZWZpeGVzIGZpcnN0IChzbyB0aGF0ICdZaScgaXMgcHJvY2Vzc2VkIGJlZm9yZVxyXG4gICAgICAgICAgICAgICAgLy8gJ1knKVxyXG4gICAgICAgICAgICAgICAgaWYgKHRvX2JpbmFyeV9wcmVmaXgpIHtcclxuICAgICAgICAgICAgICAgICAgICB0b19tdWx0aXBsaWVyID0gdG9fYmluYXJ5X3ByZWZpeFsyXTtcclxuICAgICAgICAgICAgICAgICAgICBiYXNlX3RvX3VuaXQgPSB0b191bml0LnN1YnN0cmluZygyKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodG9fdW5pdF9wcmVmaXgpIHtcclxuICAgICAgICAgICAgICAgICAgICB0b19tdWx0aXBsaWVyID0gdG9fdW5pdF9wcmVmaXhbMV07XHJcbiAgICAgICAgICAgICAgICAgICAgYmFzZV90b191bml0ID0gdG9fdW5pdC5zdWJzdHJpbmcodG9fdW5pdF9wcmVmaXhbMl0ubGVuZ3RoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAvLyBMb29rdXAgdG8gdW5pdFxyXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgayA9IDA7IGsgPCB1bml0cy5sZW5ndGg7IGsrKykge1xyXG4gICAgICAgICAgICAgICAgICAgIGFsdCA9ICh1bml0c1trXVsyXSA9PT0gbnVsbCkgPyBbXSA6IHVuaXRzW2tdWzJdO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh1bml0c1trXVsxXSA9PT0gYmFzZV90b191bml0IHx8IGFsdC5pbmRleE9mKGJhc2VfdG9fdW5pdCkgPj0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0byA9IHVuaXRzW2tdO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gUmV0dXJuIGVycm9yIGlmIGEgdW5pdCBkb2VzIG5vdCBleGlzdFxyXG4gICAgICAgICAgICBpZiAoZnJvbSA9PT0gbnVsbCB8fCB0byA9PT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGVycm9yLm5hO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBSZXR1cm4gZXJyb3IgaWYgdW5pdHMgcmVwcmVzZW50IGRpZmZlcmVudCBxdWFudGl0aWVzXHJcbiAgICAgICAgICAgIGlmIChmcm9tWzNdICE9PSB0b1szXSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGVycm9yLm5hO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBSZXR1cm4gY29udmVydGVkIG51bWJlclxyXG4gICAgICAgICAgICByZXR1cm4gbnVtYmVyICogZnJvbVs2XSAqIGZyb21fbXVsdGlwbGllciAvICh0b1s2XSAqIHRvX211bHRpcGxpZXIpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGV4cG9ydHMuREVDMkJJTiA9IGZ1bmN0aW9uIChudW1iZXIsIHBsYWNlcykge1xyXG4gICAgICAgICAgICBudW1iZXIgPSB1dGlscy5wYXJzZU51bWJlcihudW1iZXIpO1xyXG4gICAgICAgICAgICBpZiAobnVtYmVyIGluc3RhbmNlb2YgRXJyb3IpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBudW1iZXI7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIFJldHVybiBlcnJvciBpZiBudW1iZXIgaXMgbm90IGRlY2ltYWwsIGlzIGxvd2VyIHRoYW4gLTUxMiwgb3IgaXNcclxuICAgICAgICAgICAgLy8gZ3JlYXRlciB0aGFuIDUxMVxyXG4gICAgICAgICAgICBpZiAoIS9eLT9bMC05XXsxLDN9JC8udGVzdChudW1iZXIpIHx8IG51bWJlciA8IC01MTIgfHwgbnVtYmVyID4gNTExKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZXJyb3IubnVtO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBJZ25vcmUgcGxhY2VzIGFuZCByZXR1cm4gYSAxMC1jaGFyYWN0ZXIgYmluYXJ5IG51bWJlciBpZiBudW1iZXIgaXNcclxuICAgICAgICAgICAgLy8gbmVnYXRpdmVcclxuICAgICAgICAgICAgaWYgKG51bWJlciA8IDApIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiAnMScgKyBSRVBUKCcwJywgOSAtICg1MTIgKyBudW1iZXIpLnRvU3RyaW5nKDIpLmxlbmd0aCkgKyAoNTEyICsgbnVtYmVyKS50b1N0cmluZygyKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gQ29udmVydCBkZWNpbWFsIG51bWJlciB0byBiaW5hcnlcclxuICAgICAgICAgICAgdmFyIHJlc3VsdCA9IHBhcnNlSW50KG51bWJlciwgMTApLnRvU3RyaW5nKDIpO1xyXG5cclxuICAgICAgICAgICAgLy8gUmV0dXJuIGJpbmFyeSBudW1iZXIgdXNpbmcgdGhlIG1pbmltdW0gbnVtYmVyIG9mIGNoYXJhY3RlcnMgbmVjZXNzYXJ5XHJcbiAgICAgICAgICAgIC8vIGlmIHBsYWNlcyBpcyB1bmRlZmluZWRcclxuICAgICAgICAgICAgaWYgKHR5cGVvZiBwbGFjZXMgPT09ICd1bmRlZmluZWQnKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgLy8gUmV0dXJuIGVycm9yIGlmIHBsYWNlcyBpcyBub25udW1lcmljXHJcbiAgICAgICAgICAgICAgICBpZiAoaXNOYU4ocGxhY2VzKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBlcnJvci52YWx1ZTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAvLyBSZXR1cm4gZXJyb3IgaWYgcGxhY2VzIGlzIG5lZ2F0aXZlXHJcbiAgICAgICAgICAgICAgICBpZiAocGxhY2VzIDwgMCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBlcnJvci5udW07XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gVHJ1bmNhdGUgcGxhY2VzIGluIGNhc2UgaXQgaXMgbm90IGFuIGludGVnZXJcclxuICAgICAgICAgICAgICAgIHBsYWNlcyA9IE1hdGguZmxvb3IocGxhY2VzKTtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyBQYWQgcmV0dXJuIHZhbHVlIHdpdGggbGVhZGluZyAwcyAoemVyb3MpIGlmIG5lY2Vzc2FyeSAodXNpbmdcclxuICAgICAgICAgICAgICAgIC8vIFVuZGVyc2NvcmUuc3RyaW5nKVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIChwbGFjZXMgPj0gcmVzdWx0Lmxlbmd0aCkgPyBSRVBUKCcwJywgcGxhY2VzIC0gcmVzdWx0Lmxlbmd0aCkgKyByZXN1bHQgOiBlcnJvci5udW07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBleHBvcnRzLkRFQzJIRVggPSBmdW5jdGlvbiAobnVtYmVyLCBwbGFjZXMpIHtcclxuICAgICAgICAgICAgbnVtYmVyID0gdXRpbHMucGFyc2VOdW1iZXIobnVtYmVyKTtcclxuICAgICAgICAgICAgaWYgKG51bWJlciBpbnN0YW5jZW9mIEVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbnVtYmVyO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBSZXR1cm4gZXJyb3IgaWYgbnVtYmVyIGlzIG5vdCBkZWNpbWFsLCBpcyBsb3dlciB0aGFuIC01NDk3NTU4MTM4ODgsXHJcbiAgICAgICAgICAgIC8vIG9yIGlzIGdyZWF0ZXIgdGhhbiA1NDk3NTU4MTM4ODdcclxuICAgICAgICAgICAgaWYgKCEvXi0/WzAtOV17MSwxMn0kLy50ZXN0KG51bWJlcikgfHwgbnVtYmVyIDwgLTU0OTc1NTgxMzg4OCB8fCBudW1iZXIgPiA1NDk3NTU4MTM4ODcpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBlcnJvci5udW07XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIElnbm9yZSBwbGFjZXMgYW5kIHJldHVybiBhIDEwLWNoYXJhY3RlciBoZXhhZGVjaW1hbCBudW1iZXIgaWYgbnVtYmVyXHJcbiAgICAgICAgICAgIC8vIGlzIG5lZ2F0aXZlXHJcbiAgICAgICAgICAgIGlmIChudW1iZXIgPCAwKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gKDEwOTk1MTE2Mjc3NzYgKyBudW1iZXIpLnRvU3RyaW5nKDE2KTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gQ29udmVydCBkZWNpbWFsIG51bWJlciB0byBoZXhhZGVjaW1hbFxyXG4gICAgICAgICAgICB2YXIgcmVzdWx0ID0gcGFyc2VJbnQobnVtYmVyLCAxMCkudG9TdHJpbmcoMTYpO1xyXG5cclxuICAgICAgICAgICAgLy8gUmV0dXJuIGhleGFkZWNpbWFsIG51bWJlciB1c2luZyB0aGUgbWluaW11bSBudW1iZXIgb2YgY2hhcmFjdGVyc1xyXG4gICAgICAgICAgICAvLyBuZWNlc3NhcnkgaWYgcGxhY2VzIGlzIHVuZGVmaW5lZFxyXG4gICAgICAgICAgICBpZiAodHlwZW9mIHBsYWNlcyA9PT0gJ3VuZGVmaW5lZCcpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAvLyBSZXR1cm4gZXJyb3IgaWYgcGxhY2VzIGlzIG5vbm51bWVyaWNcclxuICAgICAgICAgICAgICAgIGlmIChpc05hTihwbGFjZXMpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGVycm9yLnZhbHVlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIC8vIFJldHVybiBlcnJvciBpZiBwbGFjZXMgaXMgbmVnYXRpdmVcclxuICAgICAgICAgICAgICAgIGlmIChwbGFjZXMgPCAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGVycm9yLm51bTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAvLyBUcnVuY2F0ZSBwbGFjZXMgaW4gY2FzZSBpdCBpcyBub3QgYW4gaW50ZWdlclxyXG4gICAgICAgICAgICAgICAgcGxhY2VzID0gTWF0aC5mbG9vcihwbGFjZXMpO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIFBhZCByZXR1cm4gdmFsdWUgd2l0aCBsZWFkaW5nIDBzICh6ZXJvcykgaWYgbmVjZXNzYXJ5ICh1c2luZ1xyXG4gICAgICAgICAgICAgICAgLy8gVW5kZXJzY29yZS5zdHJpbmcpXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gKHBsYWNlcyA+PSByZXN1bHQubGVuZ3RoKSA/IFJFUFQoJzAnLCBwbGFjZXMgLSByZXN1bHQubGVuZ3RoKSArIHJlc3VsdCA6IGVycm9yLm51bTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGV4cG9ydHMuREVDMk9DVCA9IGZ1bmN0aW9uIChudW1iZXIsIHBsYWNlcykge1xyXG4gICAgICAgICAgICBudW1iZXIgPSB1dGlscy5wYXJzZU51bWJlcihudW1iZXIpO1xyXG4gICAgICAgICAgICBpZiAobnVtYmVyIGluc3RhbmNlb2YgRXJyb3IpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBudW1iZXI7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIFJldHVybiBlcnJvciBpZiBudW1iZXIgaXMgbm90IGRlY2ltYWwsIGlzIGxvd2VyIHRoYW4gLTU0OTc1NTgxMzg4OCxcclxuICAgICAgICAgICAgLy8gb3IgaXMgZ3JlYXRlciB0aGFuIDU0OTc1NTgxMzg4N1xyXG4gICAgICAgICAgICBpZiAoIS9eLT9bMC05XXsxLDl9JC8udGVzdChudW1iZXIpIHx8IG51bWJlciA8IC01MzY4NzA5MTIgfHwgbnVtYmVyID4gNTM2ODcwOTExKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZXJyb3IubnVtO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBJZ25vcmUgcGxhY2VzIGFuZCByZXR1cm4gYSAxMC1jaGFyYWN0ZXIgb2N0YWwgbnVtYmVyIGlmIG51bWJlciBpc1xyXG4gICAgICAgICAgICAvLyBuZWdhdGl2ZVxyXG4gICAgICAgICAgICBpZiAobnVtYmVyIDwgMCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuICgxMDczNzQxODI0ICsgbnVtYmVyKS50b1N0cmluZyg4KTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gQ29udmVydCBkZWNpbWFsIG51bWJlciB0byBvY3RhbFxyXG4gICAgICAgICAgICB2YXIgcmVzdWx0ID0gcGFyc2VJbnQobnVtYmVyLCAxMCkudG9TdHJpbmcoOCk7XHJcblxyXG4gICAgICAgICAgICAvLyBSZXR1cm4gb2N0YWwgbnVtYmVyIHVzaW5nIHRoZSBtaW5pbXVtIG51bWJlciBvZiBjaGFyYWN0ZXJzIG5lY2Vzc2FyeVxyXG4gICAgICAgICAgICAvLyBpZiBwbGFjZXMgaXMgdW5kZWZpbmVkXHJcbiAgICAgICAgICAgIGlmICh0eXBlb2YgcGxhY2VzID09PSAndW5kZWZpbmVkJykge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIC8vIFJldHVybiBlcnJvciBpZiBwbGFjZXMgaXMgbm9ubnVtZXJpY1xyXG4gICAgICAgICAgICAgICAgaWYgKGlzTmFOKHBsYWNlcykpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZXJyb3IudmFsdWU7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gUmV0dXJuIGVycm9yIGlmIHBsYWNlcyBpcyBuZWdhdGl2ZVxyXG4gICAgICAgICAgICAgICAgaWYgKHBsYWNlcyA8IDApIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZXJyb3IubnVtO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIC8vIFRydW5jYXRlIHBsYWNlcyBpbiBjYXNlIGl0IGlzIG5vdCBhbiBpbnRlZ2VyXHJcbiAgICAgICAgICAgICAgICBwbGFjZXMgPSBNYXRoLmZsb29yKHBsYWNlcyk7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gUGFkIHJldHVybiB2YWx1ZSB3aXRoIGxlYWRpbmcgMHMgKHplcm9zKSBpZiBuZWNlc3NhcnkgKHVzaW5nXHJcbiAgICAgICAgICAgICAgICAvLyBVbmRlcnNjb3JlLnN0cmluZylcclxuICAgICAgICAgICAgICAgIHJldHVybiAocGxhY2VzID49IHJlc3VsdC5sZW5ndGgpID8gUkVQVCgnMCcsIHBsYWNlcyAtIHJlc3VsdC5sZW5ndGgpICsgcmVzdWx0IDogZXJyb3IubnVtO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZXhwb3J0cy5ERUxUQSA9IGZ1bmN0aW9uIChudW1iZXIxLCBudW1iZXIyKSB7XHJcbiAgICAgICAgICAgIC8vIFNldCBudW1iZXIyIHRvIHplcm8gaWYgdW5kZWZpbmVkXHJcbiAgICAgICAgICAgIG51bWJlcjIgPSAobnVtYmVyMiA9PT0gdW5kZWZpbmVkKSA/IDAgOiBudW1iZXIyO1xyXG4gICAgICAgICAgICBudW1iZXIxID0gdXRpbHMucGFyc2VOdW1iZXIobnVtYmVyMSk7XHJcbiAgICAgICAgICAgIG51bWJlcjIgPSB1dGlscy5wYXJzZU51bWJlcihudW1iZXIyKTtcclxuICAgICAgICAgICAgaWYgKHV0aWxzLmFueUlzRXJyb3IobnVtYmVyMSwgbnVtYmVyMikpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBlcnJvci52YWx1ZTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gUmV0dXJuIGRlbHRhXHJcbiAgICAgICAgICAgIHJldHVybiAobnVtYmVyMSA9PT0gbnVtYmVyMikgPyAxIDogMDtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBleHBvcnRzLkVSRiA9IGZ1bmN0aW9uIChsb3dlcl9ib3VuZCwgdXBwZXJfYm91bmQpIHtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBleHBvcnRzLkVSRi5QUkVDSVNFID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGV4cG9ydHMuRVJGQyA9IGZ1bmN0aW9uICh4KSB7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZXhwb3J0cy5FUkZDLlBSRUNJU0UgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZXhwb3J0cy5HRVNURVAgPSBmdW5jdGlvbiAobnVtYmVyLCBzdGVwKSB7XHJcbiAgICAgICAgICAgIHN0ZXAgPSBzdGVwIHx8IDA7XHJcbiAgICAgICAgICAgIG51bWJlciA9IHV0aWxzLnBhcnNlTnVtYmVyKG51bWJlcik7XHJcbiAgICAgICAgICAgIGlmICh1dGlscy5hbnlJc0Vycm9yKHN0ZXAsIG51bWJlcikpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBudW1iZXI7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIFJldHVybiBkZWx0YVxyXG4gICAgICAgICAgICByZXR1cm4gKG51bWJlciA+PSBzdGVwKSA/IDEgOiAwO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGV4cG9ydHMuSEVYMkJJTiA9IGZ1bmN0aW9uIChudW1iZXIsIHBsYWNlcykge1xyXG4gICAgICAgICAgICAvLyBSZXR1cm4gZXJyb3IgaWYgbnVtYmVyIGlzIG5vdCBoZXhhZGVjaW1hbCBvciBjb250YWlucyBtb3JlIHRoYW4gdGVuXHJcbiAgICAgICAgICAgIC8vIGNoYXJhY3RlcnMgKDEwIGRpZ2l0cylcclxuICAgICAgICAgICAgaWYgKCEvXlswLTlBLUZhLWZdezEsMTB9JC8udGVzdChudW1iZXIpKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZXJyb3IubnVtO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBDaGVjayBpZiBudW1iZXIgaXMgbmVnYXRpdmVcclxuICAgICAgICAgICAgdmFyIG5lZ2F0aXZlID0gKG51bWJlci5sZW5ndGggPT09IDEwICYmIG51bWJlci5zdWJzdHJpbmcoMCwgMSkudG9Mb3dlckNhc2UoKSA9PT0gJ2YnKSA/IHRydWUgOiBmYWxzZTtcclxuXHJcbiAgICAgICAgICAgIC8vIENvbnZlcnQgaGV4YWRlY2ltYWwgbnVtYmVyIHRvIGRlY2ltYWxcclxuICAgICAgICAgICAgdmFyIGRlY2ltYWwgPSAobmVnYXRpdmUpID8gcGFyc2VJbnQobnVtYmVyLCAxNikgLSAxMDk5NTExNjI3Nzc2IDogcGFyc2VJbnQobnVtYmVyLCAxNik7XHJcblxyXG4gICAgICAgICAgICAvLyBSZXR1cm4gZXJyb3IgaWYgbnVtYmVyIGlzIGxvd2VyIHRoYW4gLTUxMiBvciBncmVhdGVyIHRoYW4gNTExXHJcbiAgICAgICAgICAgIGlmIChkZWNpbWFsIDwgLTUxMiB8fCBkZWNpbWFsID4gNTExKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZXJyb3IubnVtO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBJZ25vcmUgcGxhY2VzIGFuZCByZXR1cm4gYSAxMC1jaGFyYWN0ZXIgYmluYXJ5IG51bWJlciBpZiBudW1iZXIgaXNcclxuICAgICAgICAgICAgLy8gbmVnYXRpdmVcclxuICAgICAgICAgICAgaWYgKG5lZ2F0aXZlKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gJzEnICsgUkVQVCgnMCcsIDkgLSAoNTEyICsgZGVjaW1hbCkudG9TdHJpbmcoMikubGVuZ3RoKSArICg1MTIgKyBkZWNpbWFsKS50b1N0cmluZygyKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gQ29udmVydCBkZWNpbWFsIG51bWJlciB0byBiaW5hcnlcclxuICAgICAgICAgICAgdmFyIHJlc3VsdCA9IGRlY2ltYWwudG9TdHJpbmcoMik7XHJcblxyXG4gICAgICAgICAgICAvLyBSZXR1cm4gYmluYXJ5IG51bWJlciB1c2luZyB0aGUgbWluaW11bSBudW1iZXIgb2YgY2hhcmFjdGVycyBuZWNlc3NhcnlcclxuICAgICAgICAgICAgLy8gaWYgcGxhY2VzIGlzIHVuZGVmaW5lZFxyXG4gICAgICAgICAgICBpZiAocGxhY2VzID09PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAvLyBSZXR1cm4gZXJyb3IgaWYgcGxhY2VzIGlzIG5vbm51bWVyaWNcclxuICAgICAgICAgICAgICAgIGlmIChpc05hTihwbGFjZXMpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGVycm9yLnZhbHVlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIC8vIFJldHVybiBlcnJvciBpZiBwbGFjZXMgaXMgbmVnYXRpdmVcclxuICAgICAgICAgICAgICAgIGlmIChwbGFjZXMgPCAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGVycm9yLm51bTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAvLyBUcnVuY2F0ZSBwbGFjZXMgaW4gY2FzZSBpdCBpcyBub3QgYW4gaW50ZWdlclxyXG4gICAgICAgICAgICAgICAgcGxhY2VzID0gTWF0aC5mbG9vcihwbGFjZXMpO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIFBhZCByZXR1cm4gdmFsdWUgd2l0aCBsZWFkaW5nIDBzICh6ZXJvcykgaWYgbmVjZXNzYXJ5ICh1c2luZ1xyXG4gICAgICAgICAgICAgICAgLy8gVW5kZXJzY29yZS5zdHJpbmcpXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gKHBsYWNlcyA+PSByZXN1bHQubGVuZ3RoKSA/IFJFUFQoJzAnLCBwbGFjZXMgLSByZXN1bHQubGVuZ3RoKSArIHJlc3VsdCA6IGVycm9yLm51bTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGV4cG9ydHMuSEVYMkRFQyA9IGZ1bmN0aW9uIChudW1iZXIpIHtcclxuICAgICAgICAgICAgLy8gUmV0dXJuIGVycm9yIGlmIG51bWJlciBpcyBub3QgaGV4YWRlY2ltYWwgb3IgY29udGFpbnMgbW9yZSB0aGFuIHRlblxyXG4gICAgICAgICAgICAvLyBjaGFyYWN0ZXJzICgxMCBkaWdpdHMpXHJcbiAgICAgICAgICAgIGlmICghL15bMC05QS1GYS1mXXsxLDEwfSQvLnRlc3QobnVtYmVyKSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGVycm9yLm51bTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gQ29udmVydCBoZXhhZGVjaW1hbCBudW1iZXIgdG8gZGVjaW1hbFxyXG4gICAgICAgICAgICB2YXIgZGVjaW1hbCA9IHBhcnNlSW50KG51bWJlciwgMTYpO1xyXG5cclxuICAgICAgICAgICAgLy8gUmV0dXJuIGRlY2ltYWwgbnVtYmVyXHJcbiAgICAgICAgICAgIHJldHVybiAoZGVjaW1hbCA+PSA1NDk3NTU4MTM4ODgpID8gZGVjaW1hbCAtIDEwOTk1MTE2Mjc3NzYgOiBkZWNpbWFsO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGV4cG9ydHMuSEVYMk9DVCA9IGZ1bmN0aW9uIChudW1iZXIsIHBsYWNlcykge1xyXG4gICAgICAgICAgICAvLyBSZXR1cm4gZXJyb3IgaWYgbnVtYmVyIGlzIG5vdCBoZXhhZGVjaW1hbCBvciBjb250YWlucyBtb3JlIHRoYW4gdGVuXHJcbiAgICAgICAgICAgIC8vIGNoYXJhY3RlcnMgKDEwIGRpZ2l0cylcclxuICAgICAgICAgICAgaWYgKCEvXlswLTlBLUZhLWZdezEsMTB9JC8udGVzdChudW1iZXIpKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZXJyb3IubnVtO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBDb252ZXJ0IGhleGFkZWNpbWFsIG51bWJlciB0byBkZWNpbWFsXHJcbiAgICAgICAgICAgIHZhciBkZWNpbWFsID0gcGFyc2VJbnQobnVtYmVyLCAxNik7XHJcblxyXG4gICAgICAgICAgICAvLyBSZXR1cm4gZXJyb3IgaWYgbnVtYmVyIGlzIHBvc2l0aXZlIGFuZCBncmVhdGVyIHRoYW4gMHgxZmZmZmZmZlxyXG4gICAgICAgICAgICAvLyAoNTM2ODcwOTExKVxyXG4gICAgICAgICAgICBpZiAoZGVjaW1hbCA+IDUzNjg3MDkxMSAmJiBkZWNpbWFsIDwgMTA5ODk3NDc1Njg2NCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGVycm9yLm51bTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gSWdub3JlIHBsYWNlcyBhbmQgcmV0dXJuIGEgMTAtY2hhcmFjdGVyIG9jdGFsIG51bWJlciBpZiBudW1iZXIgaXNcclxuICAgICAgICAgICAgLy8gbmVnYXRpdmVcclxuICAgICAgICAgICAgaWYgKGRlY2ltYWwgPj0gMTA5ODk3NDc1Njg2NCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIChkZWNpbWFsIC0gMTA5ODQzNzg4NTk1MikudG9TdHJpbmcoOCk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIENvbnZlcnQgZGVjaW1hbCBudW1iZXIgdG8gb2N0YWxcclxuICAgICAgICAgICAgdmFyIHJlc3VsdCA9IGRlY2ltYWwudG9TdHJpbmcoOCk7XHJcblxyXG4gICAgICAgICAgICAvLyBSZXR1cm4gb2N0YWwgbnVtYmVyIHVzaW5nIHRoZSBtaW5pbXVtIG51bWJlciBvZiBjaGFyYWN0ZXJzIG5lY2Vzc2FyeVxyXG4gICAgICAgICAgICAvLyBpZiBwbGFjZXMgaXMgdW5kZWZpbmVkXHJcbiAgICAgICAgICAgIGlmIChwbGFjZXMgPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIC8vIFJldHVybiBlcnJvciBpZiBwbGFjZXMgaXMgbm9ubnVtZXJpY1xyXG4gICAgICAgICAgICAgICAgaWYgKGlzTmFOKHBsYWNlcykpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZXJyb3IudmFsdWU7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gUmV0dXJuIGVycm9yIGlmIHBsYWNlcyBpcyBuZWdhdGl2ZVxyXG4gICAgICAgICAgICAgICAgaWYgKHBsYWNlcyA8IDApIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZXJyb3IubnVtO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIC8vIFRydW5jYXRlIHBsYWNlcyBpbiBjYXNlIGl0IGlzIG5vdCBhbiBpbnRlZ2VyXHJcbiAgICAgICAgICAgICAgICBwbGFjZXMgPSBNYXRoLmZsb29yKHBsYWNlcyk7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gUGFkIHJldHVybiB2YWx1ZSB3aXRoIGxlYWRpbmcgMHMgKHplcm9zKSBpZiBuZWNlc3NhcnkgKHVzaW5nXHJcbiAgICAgICAgICAgICAgICAvLyBVbmRlcnNjb3JlLnN0cmluZylcclxuICAgICAgICAgICAgICAgIHJldHVybiAocGxhY2VzID49IHJlc3VsdC5sZW5ndGgpID8gUkVQVCgnMCcsIHBsYWNlcyAtIHJlc3VsdC5sZW5ndGgpICsgcmVzdWx0IDogZXJyb3IubnVtO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZXhwb3J0cy5JTUFCUyA9IGZ1bmN0aW9uIChpbnVtYmVyKSB7XHJcbiAgICAgICAgICAgIC8vIExvb2t1cCByZWFsIGFuZCBpbWFnaW5hcnkgY29lZmZpY2llbnRzIHVzaW5nIGV4cG9ydHMuanNcclxuICAgICAgICAgICAgLy8gW2h0dHA6Ly9mb3JtdWxhanMub3JnXVxyXG4gICAgICAgICAgICB2YXIgeCA9IGV4cG9ydHMuSU1SRUFMKGludW1iZXIpO1xyXG4gICAgICAgICAgICB2YXIgeSA9IGV4cG9ydHMuSU1BR0lOQVJZKGludW1iZXIpO1xyXG5cclxuICAgICAgICAgICAgLy8gUmV0dXJuIGVycm9yIGlmIGVpdGhlciBjb2VmZmljaWVudCBpcyBub3QgYSBudW1iZXJcclxuICAgICAgICAgICAgaWYgKHV0aWxzLmFueUlzRXJyb3IoeCwgeSkpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBlcnJvci52YWx1ZTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gUmV0dXJuIGFic29sdXRlIHZhbHVlIG9mIGNvbXBsZXggbnVtYmVyXHJcbiAgICAgICAgICAgIHJldHVybiBNYXRoLnNxcnQoTWF0aC5wb3coeCwgMikgKyBNYXRoLnBvdyh5LCAyKSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZXhwb3J0cy5JTUFHSU5BUlkgPSBmdW5jdGlvbiAoaW51bWJlcikge1xyXG4gICAgICAgICAgICBpZiAoaW51bWJlciA9PT0gdW5kZWZpbmVkIHx8IGludW1iZXIgPT09IHRydWUgfHwgaW51bWJlciA9PT0gZmFsc2UpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBlcnJvci52YWx1ZTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gUmV0dXJuIDAgaWYgaW51bWJlciBpcyBlcXVhbCB0byAwXHJcbiAgICAgICAgICAgIGlmIChpbnVtYmVyID09PSAwIHx8IGludW1iZXIgPT09ICcwJykge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIDA7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIEhhbmRsZSBzcGVjaWFsIGNhc2VzXHJcbiAgICAgICAgICAgIGlmIChbJ2knLCAnaiddLmluZGV4T2YoaW51bWJlcikgPj0gMCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIDE7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIE5vcm1hbGl6ZSBpbWFnaW5hcnkgY29lZmZpY2llbnRcclxuICAgICAgICAgICAgaW51bWJlciA9IGludW1iZXIucmVwbGFjZSgnK2knLCAnKzFpJykucmVwbGFjZSgnLWknLCAnLTFpJykucmVwbGFjZSgnK2onLCAnKzFqJykucmVwbGFjZSgnLWonLCAnLTFqJyk7XHJcblxyXG4gICAgICAgICAgICAvLyBMb29rdXAgc2lnblxyXG4gICAgICAgICAgICB2YXIgcGx1cyA9IGludW1iZXIuaW5kZXhPZignKycpO1xyXG4gICAgICAgICAgICB2YXIgbWludXMgPSBpbnVtYmVyLmluZGV4T2YoJy0nKTtcclxuICAgICAgICAgICAgaWYgKHBsdXMgPT09IDApIHtcclxuICAgICAgICAgICAgICAgIHBsdXMgPSBpbnVtYmVyLmluZGV4T2YoJysnLCAxKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKG1pbnVzID09PSAwKSB7XHJcbiAgICAgICAgICAgICAgICBtaW51cyA9IGludW1iZXIuaW5kZXhPZignLScsIDEpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBMb29rdXAgaW1hZ2luYXJ5IHVuaXRcclxuICAgICAgICAgICAgdmFyIGxhc3QgPSBpbnVtYmVyLnN1YnN0cmluZyhpbnVtYmVyLmxlbmd0aCAtIDEsIGludW1iZXIubGVuZ3RoKTtcclxuICAgICAgICAgICAgdmFyIHVuaXQgPSAobGFzdCA9PT0gJ2knIHx8IGxhc3QgPT09ICdqJyk7XHJcblxyXG4gICAgICAgICAgICBpZiAocGx1cyA+PSAwIHx8IG1pbnVzID49IDApIHtcclxuICAgICAgICAgICAgICAgIC8vIFJldHVybiBlcnJvciBpZiBpbWFnaW5hcnkgdW5pdCBpcyBuZWl0aGVyIGkgbm9yIGpcclxuICAgICAgICAgICAgICAgIGlmICghdW5pdCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBlcnJvci5udW07XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gUmV0dXJuIGltYWdpbmFyeSBjb2VmZmljaWVudCBvZiBjb21wbGV4IG51bWJlclxyXG4gICAgICAgICAgICAgICAgaWYgKHBsdXMgPj0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAoaXNOYU4oaW51bWJlci5zdWJzdHJpbmcoMCwgcGx1cykpIHx8IGlzTmFOKGludW1iZXIuc3Vic3RyaW5nKHBsdXMgKyAxLCBpbnVtYmVyLmxlbmd0aCAtIDEpKSkgP1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBlcnJvci5udW0gOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICBOdW1iZXIoaW51bWJlci5zdWJzdHJpbmcocGx1cyArIDEsIGludW1iZXIubGVuZ3RoIC0gMSkpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gKGlzTmFOKGludW1iZXIuc3Vic3RyaW5nKDAsIG1pbnVzKSkgfHwgaXNOYU4oaW51bWJlci5zdWJzdHJpbmcobWludXMgKyAxLCBpbnVtYmVyLmxlbmd0aCAtIDEpKSkgP1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBlcnJvci5udW0gOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAtTnVtYmVyKGludW1iZXIuc3Vic3RyaW5nKG1pbnVzICsgMSwgaW51bWJlci5sZW5ndGggLSAxKSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBpZiAodW5pdCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAoaXNOYU4oaW51bWJlci5zdWJzdHJpbmcoMCwgaW51bWJlci5sZW5ndGggLSAxKSkpID8gZXJyb3IubnVtIDogaW51bWJlci5zdWJzdHJpbmcoMCwgaW51bWJlci5sZW5ndGggLSAxKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIChpc05hTihpbnVtYmVyKSkgPyBlcnJvci5udW0gOiAwO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZXhwb3J0cy5JTUFSR1VNRU5UID0gZnVuY3Rpb24gKGludW1iZXIpIHtcclxuICAgICAgICAgICAgLy8gTG9va3VwIHJlYWwgYW5kIGltYWdpbmFyeSBjb2VmZmljaWVudHMgdXNpbmcgZXhwb3J0cy5qc1xyXG4gICAgICAgICAgICAvLyBbaHR0cDovL2Zvcm11bGFqcy5vcmddXHJcbiAgICAgICAgICAgIHZhciB4ID0gZXhwb3J0cy5JTVJFQUwoaW51bWJlcik7XHJcbiAgICAgICAgICAgIHZhciB5ID0gZXhwb3J0cy5JTUFHSU5BUlkoaW51bWJlcik7XHJcblxyXG4gICAgICAgICAgICAvLyBSZXR1cm4gZXJyb3IgaWYgZWl0aGVyIGNvZWZmaWNpZW50IGlzIG5vdCBhIG51bWJlclxyXG4gICAgICAgICAgICBpZiAodXRpbHMuYW55SXNFcnJvcih4LCB5KSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGVycm9yLnZhbHVlO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBSZXR1cm4gZXJyb3IgaWYgaW51bWJlciBpcyBlcXVhbCB0byB6ZXJvXHJcbiAgICAgICAgICAgIGlmICh4ID09PSAwICYmIHkgPT09IDApIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBlcnJvci5kaXYwO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBSZXR1cm4gUEkvMiBpZiB4IGlzIGVxdWFsIHRvIHplcm8gYW5kIHkgaXMgcG9zaXRpdmVcclxuICAgICAgICAgICAgaWYgKHggPT09IDAgJiYgeSA+IDApIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBNYXRoLlBJIC8gMjtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gUmV0dXJuIC1QSS8yIGlmIHggaXMgZXF1YWwgdG8gemVybyBhbmQgeSBpcyBuZWdhdGl2ZVxyXG4gICAgICAgICAgICBpZiAoeCA9PT0gMCAmJiB5IDwgMCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIC1NYXRoLlBJIC8gMjtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gUmV0dXJuIHplcm8gaWYgeCBpcyBuZWdhdGl2ZSBhbmQgeSBpcyBlcXVhbCB0byB6ZXJvXHJcbiAgICAgICAgICAgIGlmICh5ID09PSAwICYmIHggPiAwKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gMDtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gUmV0dXJuIHplcm8gaWYgeCBpcyBuZWdhdGl2ZSBhbmQgeSBpcyBlcXVhbCB0byB6ZXJvXHJcbiAgICAgICAgICAgIGlmICh5ID09PSAwICYmIHggPCAwKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gLU1hdGguUEk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIFJldHVybiBhcmd1bWVudCBvZiBjb21wbGV4IG51bWJlclxyXG4gICAgICAgICAgICBpZiAoeCA+IDApIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBNYXRoLmF0YW4oeSAvIHgpO1xyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKHggPCAwICYmIHkgPj0gMCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIE1hdGguYXRhbih5IC8geCkgKyBNYXRoLlBJO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIE1hdGguYXRhbih5IC8geCkgLSBNYXRoLlBJO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZXhwb3J0cy5JTUNPTkpVR0FURSA9IGZ1bmN0aW9uIChpbnVtYmVyKSB7XHJcbiAgICAgICAgICAgIC8vIExvb2t1cCByZWFsIGFuZCBpbWFnaW5hcnkgY29lZmZpY2llbnRzIHVzaW5nIGV4cG9ydHMuanNcclxuICAgICAgICAgICAgLy8gW2h0dHA6Ly9mb3JtdWxhanMub3JnXVxyXG4gICAgICAgICAgICB2YXIgeCA9IGV4cG9ydHMuSU1SRUFMKGludW1iZXIpO1xyXG4gICAgICAgICAgICB2YXIgeSA9IGV4cG9ydHMuSU1BR0lOQVJZKGludW1iZXIpO1xyXG5cclxuICAgICAgICAgICAgaWYgKHV0aWxzLmFueUlzRXJyb3IoeCwgeSkpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBlcnJvci52YWx1ZTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gTG9va3VwIGltYWdpbmFyeSB1bml0XHJcbiAgICAgICAgICAgIHZhciB1bml0ID0gaW51bWJlci5zdWJzdHJpbmcoaW51bWJlci5sZW5ndGggLSAxKTtcclxuICAgICAgICAgICAgdW5pdCA9ICh1bml0ID09PSAnaScgfHwgdW5pdCA9PT0gJ2onKSA/IHVuaXQgOiAnaSc7XHJcblxyXG4gICAgICAgICAgICAvLyBSZXR1cm4gY29uanVnYXRlIG9mIGNvbXBsZXggbnVtYmVyXHJcbiAgICAgICAgICAgIHJldHVybiAoeSAhPT0gMCkgPyBleHBvcnRzLkNPTVBMRVgoeCwgLXksIHVuaXQpIDogaW51bWJlcjtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBleHBvcnRzLklNQ09TID0gZnVuY3Rpb24gKGludW1iZXIpIHtcclxuICAgICAgICAgICAgLy8gTG9va3VwIHJlYWwgYW5kIGltYWdpbmFyeSBjb2VmZmljaWVudHMgdXNpbmcgZXhwb3J0cy5qc1xyXG4gICAgICAgICAgICAvLyBbaHR0cDovL2Zvcm11bGFqcy5vcmddXHJcbiAgICAgICAgICAgIHZhciB4ID0gZXhwb3J0cy5JTVJFQUwoaW51bWJlcik7XHJcbiAgICAgICAgICAgIHZhciB5ID0gZXhwb3J0cy5JTUFHSU5BUlkoaW51bWJlcik7XHJcblxyXG4gICAgICAgICAgICBpZiAodXRpbHMuYW55SXNFcnJvcih4LCB5KSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGVycm9yLnZhbHVlO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBMb29rdXAgaW1hZ2luYXJ5IHVuaXRcclxuICAgICAgICAgICAgdmFyIHVuaXQgPSBpbnVtYmVyLnN1YnN0cmluZyhpbnVtYmVyLmxlbmd0aCAtIDEpO1xyXG4gICAgICAgICAgICB1bml0ID0gKHVuaXQgPT09ICdpJyB8fCB1bml0ID09PSAnaicpID8gdW5pdCA6ICdpJztcclxuXHJcbiAgICAgICAgICAgIC8vIFJldHVybiBjb3NpbmUgb2YgY29tcGxleCBudW1iZXJcclxuICAgICAgICAgICAgcmV0dXJuIGV4cG9ydHMuQ09NUExFWChNYXRoLmNvcyh4KSAqIChNYXRoLmV4cCh5KSArIE1hdGguZXhwKC15KSkgLyAyLCAtTWF0aC5zaW4oeCkgKiAoTWF0aC5leHAoeSkgLSBNYXRoLmV4cCgteSkpIC8gMiwgdW5pdCk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZXhwb3J0cy5JTUNPU0ggPSBmdW5jdGlvbiAoaW51bWJlcikge1xyXG4gICAgICAgICAgICAvLyBMb29rdXAgcmVhbCBhbmQgaW1hZ2luYXJ5IGNvZWZmaWNpZW50cyB1c2luZyBleHBvcnRzLmpzXHJcbiAgICAgICAgICAgIC8vIFtodHRwOi8vZm9ybXVsYWpzLm9yZ11cclxuICAgICAgICAgICAgdmFyIHggPSBleHBvcnRzLklNUkVBTChpbnVtYmVyKTtcclxuICAgICAgICAgICAgdmFyIHkgPSBleHBvcnRzLklNQUdJTkFSWShpbnVtYmVyKTtcclxuXHJcbiAgICAgICAgICAgIGlmICh1dGlscy5hbnlJc0Vycm9yKHgsIHkpKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZXJyb3IudmFsdWU7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIExvb2t1cCBpbWFnaW5hcnkgdW5pdFxyXG4gICAgICAgICAgICB2YXIgdW5pdCA9IGludW1iZXIuc3Vic3RyaW5nKGludW1iZXIubGVuZ3RoIC0gMSk7XHJcbiAgICAgICAgICAgIHVuaXQgPSAodW5pdCA9PT0gJ2knIHx8IHVuaXQgPT09ICdqJykgPyB1bml0IDogJ2knO1xyXG5cclxuICAgICAgICAgICAgLy8gUmV0dXJuIGh5cGVyYm9saWMgY29zaW5lIG9mIGNvbXBsZXggbnVtYmVyXHJcbiAgICAgICAgICAgIHJldHVybiBleHBvcnRzLkNPTVBMRVgoTWF0aC5jb3MoeSkgKiAoTWF0aC5leHAoeCkgKyBNYXRoLmV4cCgteCkpIC8gMiwgTWF0aC5zaW4oeSkgKiAoTWF0aC5leHAoeCkgLSBNYXRoLmV4cCgteCkpIC8gMiwgdW5pdCk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZXhwb3J0cy5JTUNPVCA9IGZ1bmN0aW9uIChpbnVtYmVyKSB7XHJcbiAgICAgICAgICAgIC8vIExvb2t1cCByZWFsIGFuZCBpbWFnaW5hcnkgY29lZmZpY2llbnRzIHVzaW5nIEZvcm11bGEuanNcclxuICAgICAgICAgICAgLy8gW2h0dHA6Ly9mb3JtdWxhanMub3JnXVxyXG4gICAgICAgICAgICB2YXIgeCA9IGV4cG9ydHMuSU1SRUFMKGludW1iZXIpO1xyXG4gICAgICAgICAgICB2YXIgeSA9IGV4cG9ydHMuSU1BR0lOQVJZKGludW1iZXIpO1xyXG5cclxuICAgICAgICAgICAgaWYgKHV0aWxzLmFueUlzRXJyb3IoeCwgeSkpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBlcnJvci52YWx1ZTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gUmV0dXJuIGNvdGFuZ2VudCBvZiBjb21wbGV4IG51bWJlclxyXG4gICAgICAgICAgICByZXR1cm4gZXhwb3J0cy5JTURJVihleHBvcnRzLklNQ09TKGludW1iZXIpLCBleHBvcnRzLklNU0lOKGludW1iZXIpKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBleHBvcnRzLklNRElWID0gZnVuY3Rpb24gKGludW1iZXIxLCBpbnVtYmVyMikge1xyXG4gICAgICAgICAgICAvLyBMb29rdXAgcmVhbCBhbmQgaW1hZ2luYXJ5IGNvZWZmaWNpZW50cyB1c2luZyBGb3JtdWxhLmpzXHJcbiAgICAgICAgICAgIC8vIFtodHRwOi8vZm9ybXVsYWpzLm9yZ11cclxuICAgICAgICAgICAgdmFyIGEgPSBleHBvcnRzLklNUkVBTChpbnVtYmVyMSk7XHJcbiAgICAgICAgICAgIHZhciBiID0gZXhwb3J0cy5JTUFHSU5BUlkoaW51bWJlcjEpO1xyXG4gICAgICAgICAgICB2YXIgYyA9IGV4cG9ydHMuSU1SRUFMKGludW1iZXIyKTtcclxuICAgICAgICAgICAgdmFyIGQgPSBleHBvcnRzLklNQUdJTkFSWShpbnVtYmVyMik7XHJcblxyXG4gICAgICAgICAgICBpZiAodXRpbHMuYW55SXNFcnJvcihhLCBiLCBjLCBkKSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGVycm9yLnZhbHVlO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBMb29rdXAgaW1hZ2luYXJ5IHVuaXRcclxuICAgICAgICAgICAgdmFyIHVuaXQxID0gaW51bWJlcjEuc3Vic3RyaW5nKGludW1iZXIxLmxlbmd0aCAtIDEpO1xyXG4gICAgICAgICAgICB2YXIgdW5pdDIgPSBpbnVtYmVyMi5zdWJzdHJpbmcoaW51bWJlcjIubGVuZ3RoIC0gMSk7XHJcbiAgICAgICAgICAgIHZhciB1bml0ID0gJ2knO1xyXG4gICAgICAgICAgICBpZiAodW5pdDEgPT09ICdqJykge1xyXG4gICAgICAgICAgICAgICAgdW5pdCA9ICdqJztcclxuICAgICAgICAgICAgfSBlbHNlIGlmICh1bml0MiA9PT0gJ2onKSB7XHJcbiAgICAgICAgICAgICAgICB1bml0ID0gJ2onO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBSZXR1cm4gZXJyb3IgaWYgaW51bWJlcjIgaXMgbnVsbFxyXG4gICAgICAgICAgICBpZiAoYyA9PT0gMCAmJiBkID09PSAwKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZXJyb3IubnVtO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBSZXR1cm4gZXhwb25lbnRpYWwgb2YgY29tcGxleCBudW1iZXJcclxuICAgICAgICAgICAgdmFyIGRlbiA9IGMgKiBjICsgZCAqIGQ7XHJcbiAgICAgICAgICAgIHJldHVybiBleHBvcnRzLkNPTVBMRVgoKGEgKiBjICsgYiAqIGQpIC8gZGVuLCAoYiAqIGMgLSBhICogZCkgLyBkZW4sIHVuaXQpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGV4cG9ydHMuSU1FWFAgPSBmdW5jdGlvbiAoaW51bWJlcikge1xyXG4gICAgICAgICAgICAvLyBMb29rdXAgcmVhbCBhbmQgaW1hZ2luYXJ5IGNvZWZmaWNpZW50cyB1c2luZyBGb3JtdWxhLmpzXHJcbiAgICAgICAgICAgIC8vIFtodHRwOi8vZm9ybXVsYWpzLm9yZ11cclxuICAgICAgICAgICAgdmFyIHggPSBleHBvcnRzLklNUkVBTChpbnVtYmVyKTtcclxuICAgICAgICAgICAgdmFyIHkgPSBleHBvcnRzLklNQUdJTkFSWShpbnVtYmVyKTtcclxuXHJcbiAgICAgICAgICAgIGlmICh1dGlscy5hbnlJc0Vycm9yKHgsIHkpKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZXJyb3IudmFsdWU7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIExvb2t1cCBpbWFnaW5hcnkgdW5pdFxyXG4gICAgICAgICAgICB2YXIgdW5pdCA9IGludW1iZXIuc3Vic3RyaW5nKGludW1iZXIubGVuZ3RoIC0gMSk7XHJcbiAgICAgICAgICAgIHVuaXQgPSAodW5pdCA9PT0gJ2knIHx8IHVuaXQgPT09ICdqJykgPyB1bml0IDogJ2knO1xyXG5cclxuICAgICAgICAgICAgLy8gUmV0dXJuIGV4cG9uZW50aWFsIG9mIGNvbXBsZXggbnVtYmVyXHJcbiAgICAgICAgICAgIHZhciBlID0gTWF0aC5leHAoeCk7XHJcbiAgICAgICAgICAgIHJldHVybiBleHBvcnRzLkNPTVBMRVgoZSAqIE1hdGguY29zKHkpLCBlICogTWF0aC5zaW4oeSksIHVuaXQpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGV4cG9ydHMuSU1MTiA9IGZ1bmN0aW9uIChpbnVtYmVyKSB7XHJcbiAgICAgICAgICAgIC8vIExvb2t1cCByZWFsIGFuZCBpbWFnaW5hcnkgY29lZmZpY2llbnRzIHVzaW5nIEZvcm11bGEuanNcclxuICAgICAgICAgICAgLy8gW2h0dHA6Ly9mb3JtdWxhanMub3JnXVxyXG4gICAgICAgICAgICB2YXIgeCA9IGV4cG9ydHMuSU1SRUFMKGludW1iZXIpO1xyXG4gICAgICAgICAgICB2YXIgeSA9IGV4cG9ydHMuSU1BR0lOQVJZKGludW1iZXIpO1xyXG5cclxuICAgICAgICAgICAgaWYgKHV0aWxzLmFueUlzRXJyb3IoeCwgeSkpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBlcnJvci52YWx1ZTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gTG9va3VwIGltYWdpbmFyeSB1bml0XHJcbiAgICAgICAgICAgIHZhciB1bml0ID0gaW51bWJlci5zdWJzdHJpbmcoaW51bWJlci5sZW5ndGggLSAxKTtcclxuICAgICAgICAgICAgdW5pdCA9ICh1bml0ID09PSAnaScgfHwgdW5pdCA9PT0gJ2onKSA/IHVuaXQgOiAnaSc7XHJcblxyXG4gICAgICAgICAgICAvLyBSZXR1cm4gZXhwb25lbnRpYWwgb2YgY29tcGxleCBudW1iZXJcclxuICAgICAgICAgICAgcmV0dXJuIGV4cG9ydHMuQ09NUExFWChNYXRoLmxvZyhNYXRoLnNxcnQoeCAqIHggKyB5ICogeSkpLCBNYXRoLmF0YW4oeSAvIHgpLCB1bml0KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBleHBvcnRzLklNTE9HMTAgPSBmdW5jdGlvbiAoaW51bWJlcikge1xyXG4gICAgICAgICAgICAvLyBMb29rdXAgcmVhbCBhbmQgaW1hZ2luYXJ5IGNvZWZmaWNpZW50cyB1c2luZyBGb3JtdWxhLmpzXHJcbiAgICAgICAgICAgIC8vIFtodHRwOi8vZm9ybXVsYWpzLm9yZ11cclxuICAgICAgICAgICAgdmFyIHggPSBleHBvcnRzLklNUkVBTChpbnVtYmVyKTtcclxuICAgICAgICAgICAgdmFyIHkgPSBleHBvcnRzLklNQUdJTkFSWShpbnVtYmVyKTtcclxuXHJcbiAgICAgICAgICAgIGlmICh1dGlscy5hbnlJc0Vycm9yKHgsIHkpKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZXJyb3IudmFsdWU7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIExvb2t1cCBpbWFnaW5hcnkgdW5pdFxyXG4gICAgICAgICAgICB2YXIgdW5pdCA9IGludW1iZXIuc3Vic3RyaW5nKGludW1iZXIubGVuZ3RoIC0gMSk7XHJcbiAgICAgICAgICAgIHVuaXQgPSAodW5pdCA9PT0gJ2knIHx8IHVuaXQgPT09ICdqJykgPyB1bml0IDogJ2knO1xyXG5cclxuICAgICAgICAgICAgLy8gUmV0dXJuIGV4cG9uZW50aWFsIG9mIGNvbXBsZXggbnVtYmVyXHJcbiAgICAgICAgICAgIHJldHVybiBleHBvcnRzLkNPTVBMRVgoTWF0aC5sb2coTWF0aC5zcXJ0KHggKiB4ICsgeSAqIHkpKSAvIE1hdGgubG9nKDEwKSwgTWF0aC5hdGFuKHkgLyB4KSAvIE1hdGgubG9nKDEwKSwgdW5pdCk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZXhwb3J0cy5JTUxPRzIgPSBmdW5jdGlvbiAoaW51bWJlcikge1xyXG4gICAgICAgICAgICAvLyBMb29rdXAgcmVhbCBhbmQgaW1hZ2luYXJ5IGNvZWZmaWNpZW50cyB1c2luZyBGb3JtdWxhLmpzXHJcbiAgICAgICAgICAgIC8vIFtodHRwOi8vZm9ybXVsYWpzLm9yZ11cclxuICAgICAgICAgICAgdmFyIHggPSBleHBvcnRzLklNUkVBTChpbnVtYmVyKTtcclxuICAgICAgICAgICAgdmFyIHkgPSBleHBvcnRzLklNQUdJTkFSWShpbnVtYmVyKTtcclxuXHJcbiAgICAgICAgICAgIGlmICh1dGlscy5hbnlJc0Vycm9yKHgsIHkpKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZXJyb3IudmFsdWU7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIExvb2t1cCBpbWFnaW5hcnkgdW5pdFxyXG4gICAgICAgICAgICB2YXIgdW5pdCA9IGludW1iZXIuc3Vic3RyaW5nKGludW1iZXIubGVuZ3RoIC0gMSk7XHJcbiAgICAgICAgICAgIHVuaXQgPSAodW5pdCA9PT0gJ2knIHx8IHVuaXQgPT09ICdqJykgPyB1bml0IDogJ2knO1xyXG5cclxuICAgICAgICAgICAgLy8gUmV0dXJuIGV4cG9uZW50aWFsIG9mIGNvbXBsZXggbnVtYmVyXHJcbiAgICAgICAgICAgIHJldHVybiBleHBvcnRzLkNPTVBMRVgoTWF0aC5sb2coTWF0aC5zcXJ0KHggKiB4ICsgeSAqIHkpKSAvIE1hdGgubG9nKDIpLCBNYXRoLmF0YW4oeSAvIHgpIC8gTWF0aC5sb2coMiksIHVuaXQpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGV4cG9ydHMuSU1QT1dFUiA9IGZ1bmN0aW9uIChpbnVtYmVyLCBudW1iZXIpIHtcclxuICAgICAgICAgICAgbnVtYmVyID0gdXRpbHMucGFyc2VOdW1iZXIobnVtYmVyKTtcclxuICAgICAgICAgICAgdmFyIHggPSBleHBvcnRzLklNUkVBTChpbnVtYmVyKTtcclxuICAgICAgICAgICAgdmFyIHkgPSBleHBvcnRzLklNQUdJTkFSWShpbnVtYmVyKTtcclxuICAgICAgICAgICAgaWYgKHV0aWxzLmFueUlzRXJyb3IobnVtYmVyLCB4LCB5KSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGVycm9yLnZhbHVlO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBMb29rdXAgaW1hZ2luYXJ5IHVuaXRcclxuICAgICAgICAgICAgdmFyIHVuaXQgPSBpbnVtYmVyLnN1YnN0cmluZyhpbnVtYmVyLmxlbmd0aCAtIDEpO1xyXG4gICAgICAgICAgICB1bml0ID0gKHVuaXQgPT09ICdpJyB8fCB1bml0ID09PSAnaicpID8gdW5pdCA6ICdpJztcclxuXHJcbiAgICAgICAgICAgIC8vIENhbGN1bGF0ZSBwb3dlciBvZiBtb2R1bHVzXHJcbiAgICAgICAgICAgIHZhciBwID0gTWF0aC5wb3coZXhwb3J0cy5JTUFCUyhpbnVtYmVyKSwgbnVtYmVyKTtcclxuXHJcbiAgICAgICAgICAgIC8vIENhbGN1bGF0ZSBhcmd1bWVudFxyXG4gICAgICAgICAgICB2YXIgdCA9IGV4cG9ydHMuSU1BUkdVTUVOVChpbnVtYmVyKTtcclxuXHJcbiAgICAgICAgICAgIC8vIFJldHVybiBleHBvbmVudGlhbCBvZiBjb21wbGV4IG51bWJlclxyXG4gICAgICAgICAgICByZXR1cm4gZXhwb3J0cy5DT01QTEVYKHAgKiBNYXRoLmNvcyhudW1iZXIgKiB0KSwgcCAqIE1hdGguc2luKG51bWJlciAqIHQpLCB1bml0KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBleHBvcnRzLklNUFJPRFVDVCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgLy8gSW5pdGlhbGl6ZSByZXN1bHRcclxuICAgICAgICAgICAgdmFyIHJlc3VsdCA9IGFyZ3VtZW50c1swXTtcclxuXHJcbiAgICAgICAgICAgIC8vIExvb3Agb24gYWxsIG51bWJlcnNcclxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDE7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgIC8vIExvb2t1cCBjb2VmZmljaWVudHMgb2YgdHdvIGNvbXBsZXggbnVtYmVyc1xyXG4gICAgICAgICAgICAgICAgdmFyIGEgPSBleHBvcnRzLklNUkVBTChyZXN1bHQpO1xyXG4gICAgICAgICAgICAgICAgdmFyIGIgPSBleHBvcnRzLklNQUdJTkFSWShyZXN1bHQpO1xyXG4gICAgICAgICAgICAgICAgdmFyIGMgPSBleHBvcnRzLklNUkVBTChhcmd1bWVudHNbaV0pO1xyXG4gICAgICAgICAgICAgICAgdmFyIGQgPSBleHBvcnRzLklNQUdJTkFSWShhcmd1bWVudHNbaV0pO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmICh1dGlscy5hbnlJc0Vycm9yKGEsIGIsIGMsIGQpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGVycm9yLnZhbHVlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIC8vIENvbXBsdXRlIHByb2R1Y3Qgb2YgdHdvIGNvbXBsZXggbnVtYmVyc1xyXG4gICAgICAgICAgICAgICAgcmVzdWx0ID0gZXhwb3J0cy5DT01QTEVYKGEgKiBjIC0gYiAqIGQsIGEgKiBkICsgYiAqIGMpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBSZXR1cm4gcHJvZHVjdCBvZiBjb21wbGV4IG51bWJlcnNcclxuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBleHBvcnRzLklNUkVBTCA9IGZ1bmN0aW9uIChpbnVtYmVyKSB7XHJcbiAgICAgICAgICAgIGlmIChpbnVtYmVyID09PSB1bmRlZmluZWQgfHwgaW51bWJlciA9PT0gdHJ1ZSB8fCBpbnVtYmVyID09PSBmYWxzZSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGVycm9yLnZhbHVlO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBSZXR1cm4gMCBpZiBpbnVtYmVyIGlzIGVxdWFsIHRvIDBcclxuICAgICAgICAgICAgaWYgKGludW1iZXIgPT09IDAgfHwgaW51bWJlciA9PT0gJzAnKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gMDtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gSGFuZGxlIHNwZWNpYWwgY2FzZXNcclxuICAgICAgICAgICAgaWYgKFsnaScsICcraScsICcxaScsICcrMWknLCAnLWknLCAnLTFpJywgJ2onLCAnK2onLCAnMWonLCAnKzFqJywgJy1qJywgJy0xaiddLmluZGV4T2YoaW51bWJlcikgPj0gMCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIDA7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIExvb2t1cCBzaWduXHJcbiAgICAgICAgICAgIHZhciBwbHVzID0gaW51bWJlci5pbmRleE9mKCcrJyk7XHJcbiAgICAgICAgICAgIHZhciBtaW51cyA9IGludW1iZXIuaW5kZXhPZignLScpO1xyXG4gICAgICAgICAgICBpZiAocGx1cyA9PT0gMCkge1xyXG4gICAgICAgICAgICAgICAgcGx1cyA9IGludW1iZXIuaW5kZXhPZignKycsIDEpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChtaW51cyA9PT0gMCkge1xyXG4gICAgICAgICAgICAgICAgbWludXMgPSBpbnVtYmVyLmluZGV4T2YoJy0nLCAxKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gTG9va3VwIGltYWdpbmFyeSB1bml0XHJcbiAgICAgICAgICAgIHZhciBsYXN0ID0gaW51bWJlci5zdWJzdHJpbmcoaW51bWJlci5sZW5ndGggLSAxLCBpbnVtYmVyLmxlbmd0aCk7XHJcbiAgICAgICAgICAgIHZhciB1bml0ID0gKGxhc3QgPT09ICdpJyB8fCBsYXN0ID09PSAnaicpO1xyXG5cclxuICAgICAgICAgICAgaWYgKHBsdXMgPj0gMCB8fCBtaW51cyA+PSAwKSB7XHJcbiAgICAgICAgICAgICAgICAvLyBSZXR1cm4gZXJyb3IgaWYgaW1hZ2luYXJ5IHVuaXQgaXMgbmVpdGhlciBpIG5vciBqXHJcbiAgICAgICAgICAgICAgICBpZiAoIXVuaXQpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZXJyb3IubnVtO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIC8vIFJldHVybiByZWFsIGNvZWZmaWNpZW50IG9mIGNvbXBsZXggbnVtYmVyXHJcbiAgICAgICAgICAgICAgICBpZiAocGx1cyA+PSAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIChpc05hTihpbnVtYmVyLnN1YnN0cmluZygwLCBwbHVzKSkgfHwgaXNOYU4oaW51bWJlci5zdWJzdHJpbmcocGx1cyArIDEsIGludW1iZXIubGVuZ3RoIC0gMSkpKSA/XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yLm51bSA6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIE51bWJlcihpbnVtYmVyLnN1YnN0cmluZygwLCBwbHVzKSk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAoaXNOYU4oaW51bWJlci5zdWJzdHJpbmcoMCwgbWludXMpKSB8fCBpc05hTihpbnVtYmVyLnN1YnN0cmluZyhtaW51cyArIDEsIGludW1iZXIubGVuZ3RoIC0gMSkpKSA/XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yLm51bSA6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIE51bWJlcihpbnVtYmVyLnN1YnN0cmluZygwLCBtaW51cykpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgaWYgKHVuaXQpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gKGlzTmFOKGludW1iZXIuc3Vic3RyaW5nKDAsIGludW1iZXIubGVuZ3RoIC0gMSkpKSA/IGVycm9yLm51bSA6IDA7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAoaXNOYU4oaW51bWJlcikpID8gZXJyb3IubnVtIDogaW51bWJlcjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGV4cG9ydHMuSU1TRUMgPSBmdW5jdGlvbiAoaW51bWJlcikge1xyXG4gICAgICAgICAgICAvLyBSZXR1cm4gZXJyb3IgaWYgaW51bWJlciBpcyBhIGxvZ2ljYWwgdmFsdWVcclxuICAgICAgICAgICAgaWYgKGludW1iZXIgPT09IHRydWUgfHwgaW51bWJlciA9PT0gZmFsc2UpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBlcnJvci52YWx1ZTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gTG9va3VwIHJlYWwgYW5kIGltYWdpbmFyeSBjb2VmZmljaWVudHMgdXNpbmcgRm9ybXVsYS5qc1xyXG4gICAgICAgICAgICAvLyBbaHR0cDovL2Zvcm11bGFqcy5vcmddXHJcbiAgICAgICAgICAgIHZhciB4ID0gZXhwb3J0cy5JTVJFQUwoaW51bWJlcik7XHJcbiAgICAgICAgICAgIHZhciB5ID0gZXhwb3J0cy5JTUFHSU5BUlkoaW51bWJlcik7XHJcblxyXG4gICAgICAgICAgICBpZiAodXRpbHMuYW55SXNFcnJvcih4LCB5KSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGVycm9yLnZhbHVlO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBSZXR1cm4gc2VjYW50IG9mIGNvbXBsZXggbnVtYmVyXHJcbiAgICAgICAgICAgIHJldHVybiBleHBvcnRzLklNRElWKCcxJywgZXhwb3J0cy5JTUNPUyhpbnVtYmVyKSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZXhwb3J0cy5JTVNFQ0ggPSBmdW5jdGlvbiAoaW51bWJlcikge1xyXG4gICAgICAgICAgICAvLyBMb29rdXAgcmVhbCBhbmQgaW1hZ2luYXJ5IGNvZWZmaWNpZW50cyB1c2luZyBGb3JtdWxhLmpzXHJcbiAgICAgICAgICAgIC8vIFtodHRwOi8vZm9ybXVsYWpzLm9yZ11cclxuICAgICAgICAgICAgdmFyIHggPSBleHBvcnRzLklNUkVBTChpbnVtYmVyKTtcclxuICAgICAgICAgICAgdmFyIHkgPSBleHBvcnRzLklNQUdJTkFSWShpbnVtYmVyKTtcclxuXHJcbiAgICAgICAgICAgIGlmICh1dGlscy5hbnlJc0Vycm9yKHgsIHkpKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZXJyb3IudmFsdWU7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIFJldHVybiBoeXBlcmJvbGljIHNlY2FudCBvZiBjb21wbGV4IG51bWJlclxyXG4gICAgICAgICAgICByZXR1cm4gZXhwb3J0cy5JTURJVignMScsIGV4cG9ydHMuSU1DT1NIKGludW1iZXIpKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBleHBvcnRzLklNU0lOID0gZnVuY3Rpb24gKGludW1iZXIpIHtcclxuICAgICAgICAgICAgLy8gTG9va3VwIHJlYWwgYW5kIGltYWdpbmFyeSBjb2VmZmljaWVudHMgdXNpbmcgRm9ybXVsYS5qc1xyXG4gICAgICAgICAgICAvLyBbaHR0cDovL2Zvcm11bGFqcy5vcmddXHJcbiAgICAgICAgICAgIHZhciB4ID0gZXhwb3J0cy5JTVJFQUwoaW51bWJlcik7XHJcbiAgICAgICAgICAgIHZhciB5ID0gZXhwb3J0cy5JTUFHSU5BUlkoaW51bWJlcik7XHJcblxyXG4gICAgICAgICAgICBpZiAodXRpbHMuYW55SXNFcnJvcih4LCB5KSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGVycm9yLnZhbHVlO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBMb29rdXAgaW1hZ2luYXJ5IHVuaXRcclxuICAgICAgICAgICAgdmFyIHVuaXQgPSBpbnVtYmVyLnN1YnN0cmluZyhpbnVtYmVyLmxlbmd0aCAtIDEpO1xyXG4gICAgICAgICAgICB1bml0ID0gKHVuaXQgPT09ICdpJyB8fCB1bml0ID09PSAnaicpID8gdW5pdCA6ICdpJztcclxuXHJcbiAgICAgICAgICAgIC8vIFJldHVybiBzaW5lIG9mIGNvbXBsZXggbnVtYmVyXHJcbiAgICAgICAgICAgIHJldHVybiBleHBvcnRzLkNPTVBMRVgoTWF0aC5zaW4oeCkgKiAoTWF0aC5leHAoeSkgKyBNYXRoLmV4cCgteSkpIC8gMiwgTWF0aC5jb3MoeCkgKiAoTWF0aC5leHAoeSkgLSBNYXRoLmV4cCgteSkpIC8gMiwgdW5pdCk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZXhwb3J0cy5JTVNJTkggPSBmdW5jdGlvbiAoaW51bWJlcikge1xyXG4gICAgICAgICAgICAvLyBMb29rdXAgcmVhbCBhbmQgaW1hZ2luYXJ5IGNvZWZmaWNpZW50cyB1c2luZyBGb3JtdWxhLmpzXHJcbiAgICAgICAgICAgIC8vIFtodHRwOi8vZm9ybXVsYWpzLm9yZ11cclxuICAgICAgICAgICAgdmFyIHggPSBleHBvcnRzLklNUkVBTChpbnVtYmVyKTtcclxuICAgICAgICAgICAgdmFyIHkgPSBleHBvcnRzLklNQUdJTkFSWShpbnVtYmVyKTtcclxuXHJcbiAgICAgICAgICAgIGlmICh1dGlscy5hbnlJc0Vycm9yKHgsIHkpKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZXJyb3IudmFsdWU7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIExvb2t1cCBpbWFnaW5hcnkgdW5pdFxyXG4gICAgICAgICAgICB2YXIgdW5pdCA9IGludW1iZXIuc3Vic3RyaW5nKGludW1iZXIubGVuZ3RoIC0gMSk7XHJcbiAgICAgICAgICAgIHVuaXQgPSAodW5pdCA9PT0gJ2knIHx8IHVuaXQgPT09ICdqJykgPyB1bml0IDogJ2knO1xyXG5cclxuICAgICAgICAgICAgLy8gUmV0dXJuIGh5cGVyYm9saWMgc2luZSBvZiBjb21wbGV4IG51bWJlclxyXG4gICAgICAgICAgICByZXR1cm4gZXhwb3J0cy5DT01QTEVYKE1hdGguY29zKHkpICogKE1hdGguZXhwKHgpIC0gTWF0aC5leHAoLXgpKSAvIDIsIE1hdGguc2luKHkpICogKE1hdGguZXhwKHgpICsgTWF0aC5leHAoLXgpKSAvIDIsIHVuaXQpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGV4cG9ydHMuSU1TUVJUID0gZnVuY3Rpb24gKGludW1iZXIpIHtcclxuICAgICAgICAgICAgLy8gTG9va3VwIHJlYWwgYW5kIGltYWdpbmFyeSBjb2VmZmljaWVudHMgdXNpbmcgRm9ybXVsYS5qc1xyXG4gICAgICAgICAgICAvLyBbaHR0cDovL2Zvcm11bGFqcy5vcmddXHJcbiAgICAgICAgICAgIHZhciB4ID0gZXhwb3J0cy5JTVJFQUwoaW51bWJlcik7XHJcbiAgICAgICAgICAgIHZhciB5ID0gZXhwb3J0cy5JTUFHSU5BUlkoaW51bWJlcik7XHJcblxyXG4gICAgICAgICAgICBpZiAodXRpbHMuYW55SXNFcnJvcih4LCB5KSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGVycm9yLnZhbHVlO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBMb29rdXAgaW1hZ2luYXJ5IHVuaXRcclxuICAgICAgICAgICAgdmFyIHVuaXQgPSBpbnVtYmVyLnN1YnN0cmluZyhpbnVtYmVyLmxlbmd0aCAtIDEpO1xyXG4gICAgICAgICAgICB1bml0ID0gKHVuaXQgPT09ICdpJyB8fCB1bml0ID09PSAnaicpID8gdW5pdCA6ICdpJztcclxuXHJcbiAgICAgICAgICAgIC8vIENhbGN1bGF0ZSBwb3dlciBvZiBtb2R1bHVzXHJcbiAgICAgICAgICAgIHZhciBzID0gTWF0aC5zcXJ0KGV4cG9ydHMuSU1BQlMoaW51bWJlcikpO1xyXG5cclxuICAgICAgICAgICAgLy8gQ2FsY3VsYXRlIGFyZ3VtZW50XHJcbiAgICAgICAgICAgIHZhciB0ID0gZXhwb3J0cy5JTUFSR1VNRU5UKGludW1iZXIpO1xyXG5cclxuICAgICAgICAgICAgLy8gUmV0dXJuIGV4cG9uZW50aWFsIG9mIGNvbXBsZXggbnVtYmVyXHJcbiAgICAgICAgICAgIHJldHVybiBleHBvcnRzLkNPTVBMRVgocyAqIE1hdGguY29zKHQgLyAyKSwgcyAqIE1hdGguc2luKHQgLyAyKSwgdW5pdCk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZXhwb3J0cy5JTUNTQyA9IGZ1bmN0aW9uIChpbnVtYmVyKSB7XHJcbiAgICAgICAgICAgIC8vIFJldHVybiBlcnJvciBpZiBpbnVtYmVyIGlzIGEgbG9naWNhbCB2YWx1ZVxyXG4gICAgICAgICAgICBpZiAoaW51bWJlciA9PT0gdHJ1ZSB8fCBpbnVtYmVyID09PSBmYWxzZSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGVycm9yLnZhbHVlO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBMb29rdXAgcmVhbCBhbmQgaW1hZ2luYXJ5IGNvZWZmaWNpZW50cyB1c2luZyBGb3JtdWxhLmpzXHJcbiAgICAgICAgICAgIC8vIFtodHRwOi8vZm9ybXVsYWpzLm9yZ11cclxuICAgICAgICAgICAgdmFyIHggPSBleHBvcnRzLklNUkVBTChpbnVtYmVyKTtcclxuICAgICAgICAgICAgdmFyIHkgPSBleHBvcnRzLklNQUdJTkFSWShpbnVtYmVyKTtcclxuXHJcbiAgICAgICAgICAgIC8vIFJldHVybiBlcnJvciBpZiBlaXRoZXIgY29lZmZpY2llbnQgaXMgbm90IGEgbnVtYmVyXHJcbiAgICAgICAgICAgIGlmICh1dGlscy5hbnlJc0Vycm9yKHgsIHkpKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZXJyb3IubnVtO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBSZXR1cm4gY29zZWNhbnQgb2YgY29tcGxleCBudW1iZXJcclxuICAgICAgICAgICAgcmV0dXJuIGV4cG9ydHMuSU1ESVYoJzEnLCBleHBvcnRzLklNU0lOKGludW1iZXIpKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBleHBvcnRzLklNQ1NDSCA9IGZ1bmN0aW9uIChpbnVtYmVyKSB7XHJcbiAgICAgICAgICAgIC8vIFJldHVybiBlcnJvciBpZiBpbnVtYmVyIGlzIGEgbG9naWNhbCB2YWx1ZVxyXG4gICAgICAgICAgICBpZiAoaW51bWJlciA9PT0gdHJ1ZSB8fCBpbnVtYmVyID09PSBmYWxzZSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGVycm9yLnZhbHVlO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBMb29rdXAgcmVhbCBhbmQgaW1hZ2luYXJ5IGNvZWZmaWNpZW50cyB1c2luZyBGb3JtdWxhLmpzXHJcbiAgICAgICAgICAgIC8vIFtodHRwOi8vZm9ybXVsYWpzLm9yZ11cclxuICAgICAgICAgICAgdmFyIHggPSBleHBvcnRzLklNUkVBTChpbnVtYmVyKTtcclxuICAgICAgICAgICAgdmFyIHkgPSBleHBvcnRzLklNQUdJTkFSWShpbnVtYmVyKTtcclxuXHJcbiAgICAgICAgICAgIC8vIFJldHVybiBlcnJvciBpZiBlaXRoZXIgY29lZmZpY2llbnQgaXMgbm90IGEgbnVtYmVyXHJcbiAgICAgICAgICAgIGlmICh1dGlscy5hbnlJc0Vycm9yKHgsIHkpKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZXJyb3IubnVtO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBSZXR1cm4gaHlwZXJib2xpYyBjb3NlY2FudCBvZiBjb21wbGV4IG51bWJlclxyXG4gICAgICAgICAgICByZXR1cm4gZXhwb3J0cy5JTURJVignMScsIGV4cG9ydHMuSU1TSU5IKGludW1iZXIpKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBleHBvcnRzLklNU1VCID0gZnVuY3Rpb24gKGludW1iZXIxLCBpbnVtYmVyMikge1xyXG4gICAgICAgICAgICAvLyBMb29rdXAgcmVhbCBhbmQgaW1hZ2luYXJ5IGNvZWZmaWNpZW50cyB1c2luZyBGb3JtdWxhLmpzXHJcbiAgICAgICAgICAgIC8vIFtodHRwOi8vZm9ybXVsYWpzLm9yZ11cclxuICAgICAgICAgICAgdmFyIGEgPSB0aGlzLklNUkVBTChpbnVtYmVyMSk7XHJcbiAgICAgICAgICAgIHZhciBiID0gdGhpcy5JTUFHSU5BUlkoaW51bWJlcjEpO1xyXG4gICAgICAgICAgICB2YXIgYyA9IHRoaXMuSU1SRUFMKGludW1iZXIyKTtcclxuICAgICAgICAgICAgdmFyIGQgPSB0aGlzLklNQUdJTkFSWShpbnVtYmVyMik7XHJcblxyXG4gICAgICAgICAgICBpZiAodXRpbHMuYW55SXNFcnJvcihhLCBiLCBjLCBkKSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGVycm9yLnZhbHVlO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBMb29rdXAgaW1hZ2luYXJ5IHVuaXRcclxuICAgICAgICAgICAgdmFyIHVuaXQxID0gaW51bWJlcjEuc3Vic3RyaW5nKGludW1iZXIxLmxlbmd0aCAtIDEpO1xyXG4gICAgICAgICAgICB2YXIgdW5pdDIgPSBpbnVtYmVyMi5zdWJzdHJpbmcoaW51bWJlcjIubGVuZ3RoIC0gMSk7XHJcbiAgICAgICAgICAgIHZhciB1bml0ID0gJ2knO1xyXG4gICAgICAgICAgICBpZiAodW5pdDEgPT09ICdqJykge1xyXG4gICAgICAgICAgICAgICAgdW5pdCA9ICdqJztcclxuICAgICAgICAgICAgfSBlbHNlIGlmICh1bml0MiA9PT0gJ2onKSB7XHJcbiAgICAgICAgICAgICAgICB1bml0ID0gJ2onO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBSZXR1cm4gXyBvZiB0d28gY29tcGxleCBudW1iZXJzXHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLkNPTVBMRVgoYSAtIGMsIGIgLSBkLCB1bml0KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBleHBvcnRzLklNU1VNID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICB2YXIgYXJncyA9IHV0aWxzLmZsYXR0ZW4oYXJndW1lbnRzKTtcclxuXHJcbiAgICAgICAgICAgIC8vIEluaXRpYWxpemUgcmVzdWx0XHJcbiAgICAgICAgICAgIHZhciByZXN1bHQgPSBhcmdzWzBdO1xyXG5cclxuICAgICAgICAgICAgLy8gTG9vcCBvbiBhbGwgbnVtYmVyc1xyXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMTsgaSA8IGFyZ3MubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgIC8vIExvb2t1cCBjb2VmZmljaWVudHMgb2YgdHdvIGNvbXBsZXggbnVtYmVyc1xyXG4gICAgICAgICAgICAgICAgdmFyIGEgPSB0aGlzLklNUkVBTChyZXN1bHQpO1xyXG4gICAgICAgICAgICAgICAgdmFyIGIgPSB0aGlzLklNQUdJTkFSWShyZXN1bHQpO1xyXG4gICAgICAgICAgICAgICAgdmFyIGMgPSB0aGlzLklNUkVBTChhcmdzW2ldKTtcclxuICAgICAgICAgICAgICAgIHZhciBkID0gdGhpcy5JTUFHSU5BUlkoYXJnc1tpXSk7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKHV0aWxzLmFueUlzRXJyb3IoYSwgYiwgYywgZCkpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZXJyb3IudmFsdWU7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gQ29tcGx1dGUgcHJvZHVjdCBvZiB0d28gY29tcGxleCBudW1iZXJzXHJcbiAgICAgICAgICAgICAgICByZXN1bHQgPSB0aGlzLkNPTVBMRVgoYSArIGMsIGIgKyBkKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gUmV0dXJuIHN1bSBvZiBjb21wbGV4IG51bWJlcnNcclxuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBleHBvcnRzLklNVEFOID0gZnVuY3Rpb24gKGludW1iZXIpIHtcclxuICAgICAgICAgICAgLy8gUmV0dXJuIGVycm9yIGlmIGludW1iZXIgaXMgYSBsb2dpY2FsIHZhbHVlXHJcbiAgICAgICAgICAgIGlmIChpbnVtYmVyID09PSB0cnVlIHx8IGludW1iZXIgPT09IGZhbHNlKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZXJyb3IudmFsdWU7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIExvb2t1cCByZWFsIGFuZCBpbWFnaW5hcnkgY29lZmZpY2llbnRzIHVzaW5nIEZvcm11bGEuanNcclxuICAgICAgICAgICAgLy8gW2h0dHA6Ly9mb3JtdWxhanMub3JnXVxyXG4gICAgICAgICAgICB2YXIgeCA9IGV4cG9ydHMuSU1SRUFMKGludW1iZXIpO1xyXG4gICAgICAgICAgICB2YXIgeSA9IGV4cG9ydHMuSU1BR0lOQVJZKGludW1iZXIpO1xyXG5cclxuICAgICAgICAgICAgaWYgKHV0aWxzLmFueUlzRXJyb3IoeCwgeSkpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBlcnJvci52YWx1ZTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gUmV0dXJuIHRhbmdlbnQgb2YgY29tcGxleCBudW1iZXJcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuSU1ESVYodGhpcy5JTVNJTihpbnVtYmVyKSwgdGhpcy5JTUNPUyhpbnVtYmVyKSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZXhwb3J0cy5PQ1QyQklOID0gZnVuY3Rpb24gKG51bWJlciwgcGxhY2VzKSB7XHJcbiAgICAgICAgICAgIC8vIFJldHVybiBlcnJvciBpZiBudW1iZXIgaXMgbm90IGhleGFkZWNpbWFsIG9yIGNvbnRhaW5zIG1vcmUgdGhhbiB0ZW5cclxuICAgICAgICAgICAgLy8gY2hhcmFjdGVycyAoMTAgZGlnaXRzKVxyXG4gICAgICAgICAgICBpZiAoIS9eWzAtN117MSwxMH0kLy50ZXN0KG51bWJlcikpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBlcnJvci5udW07XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIENoZWNrIGlmIG51bWJlciBpcyBuZWdhdGl2ZVxyXG4gICAgICAgICAgICB2YXIgbmVnYXRpdmUgPSAobnVtYmVyLmxlbmd0aCA9PT0gMTAgJiYgbnVtYmVyLnN1YnN0cmluZygwLCAxKSA9PT0gJzcnKSA/IHRydWUgOiBmYWxzZTtcclxuXHJcbiAgICAgICAgICAgIC8vIENvbnZlcnQgb2N0YWwgbnVtYmVyIHRvIGRlY2ltYWxcclxuICAgICAgICAgICAgdmFyIGRlY2ltYWwgPSAobmVnYXRpdmUpID8gcGFyc2VJbnQobnVtYmVyLCA4KSAtIDEwNzM3NDE4MjQgOiBwYXJzZUludChudW1iZXIsIDgpO1xyXG5cclxuICAgICAgICAgICAgLy8gUmV0dXJuIGVycm9yIGlmIG51bWJlciBpcyBsb3dlciB0aGFuIC01MTIgb3IgZ3JlYXRlciB0aGFuIDUxMVxyXG4gICAgICAgICAgICBpZiAoZGVjaW1hbCA8IC01MTIgfHwgZGVjaW1hbCA+IDUxMSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGVycm9yLm51bTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gSWdub3JlIHBsYWNlcyBhbmQgcmV0dXJuIGEgMTAtY2hhcmFjdGVyIGJpbmFyeSBudW1iZXIgaWYgbnVtYmVyIGlzXHJcbiAgICAgICAgICAgIC8vIG5lZ2F0aXZlXHJcbiAgICAgICAgICAgIGlmIChuZWdhdGl2ZSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuICcxJyArIFJFUFQoJzAnLCA5IC0gKDUxMiArIGRlY2ltYWwpLnRvU3RyaW5nKDIpLmxlbmd0aCkgKyAoNTEyICsgZGVjaW1hbCkudG9TdHJpbmcoMik7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIENvbnZlcnQgZGVjaW1hbCBudW1iZXIgdG8gYmluYXJ5XHJcbiAgICAgICAgICAgIHZhciByZXN1bHQgPSBkZWNpbWFsLnRvU3RyaW5nKDIpO1xyXG5cclxuICAgICAgICAgICAgLy8gUmV0dXJuIGJpbmFyeSBudW1iZXIgdXNpbmcgdGhlIG1pbmltdW0gbnVtYmVyIG9mIGNoYXJhY3RlcnMgbmVjZXNzYXJ5XHJcbiAgICAgICAgICAgIC8vIGlmIHBsYWNlcyBpcyB1bmRlZmluZWRcclxuICAgICAgICAgICAgaWYgKHR5cGVvZiBwbGFjZXMgPT09ICd1bmRlZmluZWQnKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgLy8gUmV0dXJuIGVycm9yIGlmIHBsYWNlcyBpcyBub25udW1lcmljXHJcbiAgICAgICAgICAgICAgICBpZiAoaXNOYU4ocGxhY2VzKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBlcnJvci52YWx1ZTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAvLyBSZXR1cm4gZXJyb3IgaWYgcGxhY2VzIGlzIG5lZ2F0aXZlXHJcbiAgICAgICAgICAgICAgICBpZiAocGxhY2VzIDwgMCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBlcnJvci5udW07XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gVHJ1bmNhdGUgcGxhY2VzIGluIGNhc2UgaXQgaXMgbm90IGFuIGludGVnZXJcclxuICAgICAgICAgICAgICAgIHBsYWNlcyA9IE1hdGguZmxvb3IocGxhY2VzKTtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyBQYWQgcmV0dXJuIHZhbHVlIHdpdGggbGVhZGluZyAwcyAoemVyb3MpIGlmIG5lY2Vzc2FyeSAodXNpbmdcclxuICAgICAgICAgICAgICAgIC8vIFVuZGVyc2NvcmUuc3RyaW5nKVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIChwbGFjZXMgPj0gcmVzdWx0Lmxlbmd0aCkgPyBSRVBUKCcwJywgcGxhY2VzIC0gcmVzdWx0Lmxlbmd0aCkgKyByZXN1bHQgOiBlcnJvci5udW07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBleHBvcnRzLk9DVDJERUMgPSBmdW5jdGlvbiAobnVtYmVyKSB7XHJcbiAgICAgICAgICAgIC8vIFJldHVybiBlcnJvciBpZiBudW1iZXIgaXMgbm90IG9jdGFsIG9yIGNvbnRhaW5zIG1vcmUgdGhhbiB0ZW5cclxuICAgICAgICAgICAgLy8gY2hhcmFjdGVycyAoMTAgZGlnaXRzKVxyXG4gICAgICAgICAgICBpZiAoIS9eWzAtN117MSwxMH0kLy50ZXN0KG51bWJlcikpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBlcnJvci5udW07XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIENvbnZlcnQgb2N0YWwgbnVtYmVyIHRvIGRlY2ltYWxcclxuICAgICAgICAgICAgdmFyIGRlY2ltYWwgPSBwYXJzZUludChudW1iZXIsIDgpO1xyXG5cclxuICAgICAgICAgICAgLy8gUmV0dXJuIGRlY2ltYWwgbnVtYmVyXHJcbiAgICAgICAgICAgIHJldHVybiAoZGVjaW1hbCA+PSA1MzY4NzA5MTIpID8gZGVjaW1hbCAtIDEwNzM3NDE4MjQgOiBkZWNpbWFsO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGV4cG9ydHMuT0NUMkhFWCA9IGZ1bmN0aW9uIChudW1iZXIsIHBsYWNlcykge1xyXG4gICAgICAgICAgICAvLyBSZXR1cm4gZXJyb3IgaWYgbnVtYmVyIGlzIG5vdCBvY3RhbCBvciBjb250YWlucyBtb3JlIHRoYW4gdGVuXHJcbiAgICAgICAgICAgIC8vIGNoYXJhY3RlcnMgKDEwIGRpZ2l0cylcclxuICAgICAgICAgICAgaWYgKCEvXlswLTddezEsMTB9JC8udGVzdChudW1iZXIpKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZXJyb3IubnVtO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBDb252ZXJ0IG9jdGFsIG51bWJlciB0byBkZWNpbWFsXHJcbiAgICAgICAgICAgIHZhciBkZWNpbWFsID0gcGFyc2VJbnQobnVtYmVyLCA4KTtcclxuXHJcbiAgICAgICAgICAgIC8vIElnbm9yZSBwbGFjZXMgYW5kIHJldHVybiBhIDEwLWNoYXJhY3RlciBvY3RhbCBudW1iZXIgaWYgbnVtYmVyIGlzXHJcbiAgICAgICAgICAgIC8vIG5lZ2F0aXZlXHJcbiAgICAgICAgICAgIGlmIChkZWNpbWFsID49IDUzNjg3MDkxMikge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuICdmZicgKyAoZGVjaW1hbCArIDMyMjEyMjU0NzIpLnRvU3RyaW5nKDE2KTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gQ29udmVydCBkZWNpbWFsIG51bWJlciB0byBoZXhhZGVjaW1hbFxyXG4gICAgICAgICAgICB2YXIgcmVzdWx0ID0gZGVjaW1hbC50b1N0cmluZygxNik7XHJcblxyXG4gICAgICAgICAgICAvLyBSZXR1cm4gaGV4YWRlY2ltYWwgbnVtYmVyIHVzaW5nIHRoZSBtaW5pbXVtIG51bWJlciBvZiBjaGFyYWN0ZXJzXHJcbiAgICAgICAgICAgIC8vIG5lY2Vzc2FyeSBpZiBwbGFjZXMgaXMgdW5kZWZpbmVkXHJcbiAgICAgICAgICAgIGlmIChwbGFjZXMgPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIC8vIFJldHVybiBlcnJvciBpZiBwbGFjZXMgaXMgbm9ubnVtZXJpY1xyXG4gICAgICAgICAgICAgICAgaWYgKGlzTmFOKHBsYWNlcykpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZXJyb3IudmFsdWU7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gUmV0dXJuIGVycm9yIGlmIHBsYWNlcyBpcyBuZWdhdGl2ZVxyXG4gICAgICAgICAgICAgICAgaWYgKHBsYWNlcyA8IDApIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZXJyb3IubnVtO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIC8vIFRydW5jYXRlIHBsYWNlcyBpbiBjYXNlIGl0IGlzIG5vdCBhbiBpbnRlZ2VyXHJcbiAgICAgICAgICAgICAgICBwbGFjZXMgPSBNYXRoLmZsb29yKHBsYWNlcyk7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gUGFkIHJldHVybiB2YWx1ZSB3aXRoIGxlYWRpbmcgMHMgKHplcm9zKSBpZiBuZWNlc3NhcnkgKHVzaW5nXHJcbiAgICAgICAgICAgICAgICAvLyBVbmRlcnNjb3JlLnN0cmluZylcclxuICAgICAgICAgICAgICAgIHJldHVybiAocGxhY2VzID49IHJlc3VsdC5sZW5ndGgpID8gUkVQVCgnMCcsIHBsYWNlcyAtIHJlc3VsdC5sZW5ndGgpICsgcmVzdWx0IDogZXJyb3IubnVtO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgcmV0dXJuIGV4cG9ydHM7XHJcbiAgICB9KSgpO1xyXG5cclxuICAgIGpleGNlbC5tZXRob2RzLmZpbmFuY2lhbCA9IChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdmFyIGV4cG9ydHMgPSB7fTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gdmFsaWREYXRlKGQpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGQgJiYgZC5nZXRUaW1lICYmICFpc05hTihkLmdldFRpbWUoKSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBlbnN1cmVEYXRlKGQpIHtcclxuICAgICAgICAgICAgcmV0dXJuIChkIGluc3RhbmNlb2YgRGF0ZSkgPyBkIDogbmV3IERhdGUoZCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBleHBvcnRzLkFDQ1JJTlQgPSBmdW5jdGlvbiAoaXNzdWUsIGZpcnN0LCBzZXR0bGVtZW50LCByYXRlLCBwYXIsIGZyZXF1ZW5jeSwgYmFzaXMpIHtcclxuICAgICAgICAgICAgLy8gUmV0dXJuIGVycm9yIGlmIGVpdGhlciBkYXRlIGlzIGludmFsaWRcclxuICAgICAgICAgICAgaXNzdWUgPSBlbnN1cmVEYXRlKGlzc3VlKTtcclxuICAgICAgICAgICAgZmlyc3QgPSBlbnN1cmVEYXRlKGZpcnN0KTtcclxuICAgICAgICAgICAgc2V0dGxlbWVudCA9IGVuc3VyZURhdGUoc2V0dGxlbWVudCk7XHJcbiAgICAgICAgICAgIGlmICghdmFsaWREYXRlKGlzc3VlKSB8fCAhdmFsaWREYXRlKGZpcnN0KSB8fCAhdmFsaWREYXRlKHNldHRsZW1lbnQpKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gJyNWQUxVRSEnO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBSZXR1cm4gZXJyb3IgaWYgZWl0aGVyIHJhdGUgb3IgcGFyIGFyZSBsb3dlciB0aGFuIG9yIGVxdWFsIHRvIHplcm9cclxuICAgICAgICAgICAgaWYgKHJhdGUgPD0gMCB8fCBwYXIgPD0gMCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuICcjTlVNISc7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIFJldHVybiBlcnJvciBpZiBmcmVxdWVuY3kgaXMgbmVpdGhlciAxLCAyLCBvciA0XHJcbiAgICAgICAgICAgIGlmIChbMSwgMiwgNF0uaW5kZXhPZihmcmVxdWVuY3kpID09PSAtMSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuICcjTlVNISc7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIFJldHVybiBlcnJvciBpZiBiYXNpcyBpcyBuZWl0aGVyIDAsIDEsIDIsIDMsIG9yIDRcclxuICAgICAgICAgICAgaWYgKFswLCAxLCAyLCAzLCA0XS5pbmRleE9mKGJhc2lzKSA9PT0gLTEpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiAnI05VTSEnO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBSZXR1cm4gZXJyb3IgaWYgc2V0dGxlbWVudCBpcyBiZWZvcmUgb3IgZXF1YWwgdG8gaXNzdWVcclxuICAgICAgICAgICAgaWYgKHNldHRsZW1lbnQgPD0gaXNzdWUpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiAnI05VTSEnO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBTZXQgZGVmYXVsdCB2YWx1ZXNcclxuICAgICAgICAgICAgcGFyID0gcGFyIHx8IDA7XHJcbiAgICAgICAgICAgIGJhc2lzID0gYmFzaXMgfHwgMDtcclxuXHJcbiAgICAgICAgICAgIC8vIENvbXB1dGUgYWNjcnVlZCBpbnRlcmVzdFxyXG4gICAgICAgICAgICByZXR1cm4gcGFyICogcmF0ZSAqIFlFQVJGUkFDKGlzc3VlLCBzZXR0bGVtZW50LCBiYXNpcyk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZXhwb3J0cy5BQ0NSSU5UTSA9IG51bGw7XHJcblxyXG4gICAgICAgIGV4cG9ydHMuQU1PUkRFR1JDID0gbnVsbDtcclxuXHJcbiAgICAgICAgZXhwb3J0cy5BTU9STElOQyA9IG51bGw7XHJcblxyXG4gICAgICAgIGV4cG9ydHMuQ09VUERBWUJTID0gbnVsbDtcclxuXHJcbiAgICAgICAgZXhwb3J0cy5DT1VQREFZUyA9IG51bGw7XHJcblxyXG4gICAgICAgIGV4cG9ydHMuQ09VUERBWVNOQyA9IG51bGw7XHJcblxyXG4gICAgICAgIGV4cG9ydHMuQ09VUE5DRCA9IG51bGw7XHJcblxyXG4gICAgICAgIGV4cG9ydHMuQ09VUE5VTSA9IG51bGw7XHJcblxyXG4gICAgICAgIGV4cG9ydHMuQ09VUFBDRCA9IG51bGw7XHJcblxyXG4gICAgICAgIGV4cG9ydHMuQ1VNSVBNVCA9IGZ1bmN0aW9uIChyYXRlLCBwZXJpb2RzLCB2YWx1ZSwgc3RhcnQsIGVuZCwgdHlwZSkge1xyXG4gICAgICAgICAgICAvLyBDcmVkaXRzOiBhbGdvcml0aG0gaW5zcGlyZWQgYnkgQXBhY2hlIE9wZW5PZmZpY2VcclxuICAgICAgICAgICAgLy8gQ3JlZGl0czogSGFubmVzIFN0aWViaXR6aG9mZXIgZm9yIHRoZSB0cmFuc2xhdGlvbnMgb2YgZnVuY3Rpb24gYW5kXHJcbiAgICAgICAgICAgIC8vIHZhcmlhYmxlIG5hbWVzXHJcbiAgICAgICAgICAgIC8vIFJlcXVpcmVzIGV4cG9ydHMuRlYoKSBhbmQgZXhwb3J0cy5QTVQoKSBmcm9tIGV4cG9ydHMuanNcclxuICAgICAgICAgICAgLy8gW2h0dHA6Ly9zdG9pYy5jb20vZXhwb3J0cy9dXHJcblxyXG4gICAgICAgICAgICByYXRlID0gdXRpbHMucGFyc2VOdW1iZXIocmF0ZSk7XHJcbiAgICAgICAgICAgIHBlcmlvZHMgPSB1dGlscy5wYXJzZU51bWJlcihwZXJpb2RzKTtcclxuICAgICAgICAgICAgdmFsdWUgPSB1dGlscy5wYXJzZU51bWJlcih2YWx1ZSk7XHJcbiAgICAgICAgICAgIGlmICh1dGlscy5hbnlJc0Vycm9yKHJhdGUsIHBlcmlvZHMsIHZhbHVlKSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGVycm9yLnZhbHVlO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBSZXR1cm4gZXJyb3IgaWYgZWl0aGVyIHJhdGUsIHBlcmlvZHMsIG9yIHZhbHVlIGFyZSBsb3dlciB0aGFuIG9yXHJcbiAgICAgICAgICAgIC8vIGVxdWFsIHRvIHplcm9cclxuICAgICAgICAgICAgaWYgKHJhdGUgPD0gMCB8fCBwZXJpb2RzIDw9IDAgfHwgdmFsdWUgPD0gMCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGVycm9yLm51bTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gUmV0dXJuIGVycm9yIGlmIHN0YXJ0IDwgMSwgZW5kIDwgMSwgb3Igc3RhcnQgPiBlbmRcclxuICAgICAgICAgICAgaWYgKHN0YXJ0IDwgMSB8fCBlbmQgPCAxIHx8IHN0YXJ0ID4gZW5kKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZXJyb3IubnVtO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBSZXR1cm4gZXJyb3IgaWYgdHlwZSBpcyBuZWl0aGVyIDAgbm9yIDFcclxuICAgICAgICAgICAgaWYgKHR5cGUgIT09IDAgJiYgdHlwZSAhPT0gMSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGVycm9yLm51bTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gQ29tcHV0ZSBjdW11bGF0aXZlIGludGVyZXN0XHJcbiAgICAgICAgICAgIHZhciBwYXltZW50ID0gZXhwb3J0cy5QTVQocmF0ZSwgcGVyaW9kcywgdmFsdWUsIDAsIHR5cGUpO1xyXG4gICAgICAgICAgICB2YXIgaW50ZXJlc3QgPSAwO1xyXG5cclxuICAgICAgICAgICAgaWYgKHN0YXJ0ID09PSAxKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAodHlwZSA9PT0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGludGVyZXN0ID0gLXZhbHVlO1xyXG4gICAgICAgICAgICAgICAgICAgIHN0YXJ0Kys7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSBzdGFydDsgaSA8PSBlbmQ7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgaWYgKHR5cGUgPT09IDEpIHtcclxuICAgICAgICAgICAgICAgICAgICBpbnRlcmVzdCArPSBleHBvcnRzLkZWKHJhdGUsIGkgLSAyLCBwYXltZW50LCB2YWx1ZSwgMSkgLSBwYXltZW50O1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBpbnRlcmVzdCArPSBleHBvcnRzLkZWKHJhdGUsIGkgLSAxLCBwYXltZW50LCB2YWx1ZSwgMCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaW50ZXJlc3QgKj0gcmF0ZTtcclxuXHJcbiAgICAgICAgICAgIC8vIFJldHVybiBjdW11bGF0aXZlIGludGVyZXN0XHJcbiAgICAgICAgICAgIHJldHVybiBpbnRlcmVzdDtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBleHBvcnRzLkNVTVBSSU5DID0gZnVuY3Rpb24gKHJhdGUsIHBlcmlvZHMsIHZhbHVlLCBzdGFydCwgZW5kLCB0eXBlKSB7XHJcbiAgICAgICAgICAgIC8vIENyZWRpdHM6IGFsZ29yaXRobSBpbnNwaXJlZCBieSBBcGFjaGUgT3Blbk9mZmljZVxyXG4gICAgICAgICAgICAvLyBDcmVkaXRzOiBIYW5uZXMgU3RpZWJpdHpob2ZlciBmb3IgdGhlIHRyYW5zbGF0aW9ucyBvZiBmdW5jdGlvbiBhbmRcclxuICAgICAgICAgICAgLy8gdmFyaWFibGUgbmFtZXNcclxuXHJcbiAgICAgICAgICAgIHJhdGUgPSB1dGlscy5wYXJzZU51bWJlcihyYXRlKTtcclxuICAgICAgICAgICAgcGVyaW9kcyA9IHV0aWxzLnBhcnNlTnVtYmVyKHBlcmlvZHMpO1xyXG4gICAgICAgICAgICB2YWx1ZSA9IHV0aWxzLnBhcnNlTnVtYmVyKHZhbHVlKTtcclxuICAgICAgICAgICAgaWYgKHV0aWxzLmFueUlzRXJyb3IocmF0ZSwgcGVyaW9kcywgdmFsdWUpKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZXJyb3IudmFsdWU7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIFJldHVybiBlcnJvciBpZiBlaXRoZXIgcmF0ZSwgcGVyaW9kcywgb3IgdmFsdWUgYXJlIGxvd2VyIHRoYW4gb3JcclxuICAgICAgICAgICAgLy8gZXF1YWwgdG8gemVyb1xyXG4gICAgICAgICAgICBpZiAocmF0ZSA8PSAwIHx8IHBlcmlvZHMgPD0gMCB8fCB2YWx1ZSA8PSAwKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZXJyb3IubnVtO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBSZXR1cm4gZXJyb3IgaWYgc3RhcnQgPCAxLCBlbmQgPCAxLCBvciBzdGFydCA+IGVuZFxyXG4gICAgICAgICAgICBpZiAoc3RhcnQgPCAxIHx8IGVuZCA8IDEgfHwgc3RhcnQgPiBlbmQpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBlcnJvci5udW07XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIFJldHVybiBlcnJvciBpZiB0eXBlIGlzIG5laXRoZXIgMCBub3IgMVxyXG4gICAgICAgICAgICBpZiAodHlwZSAhPT0gMCAmJiB0eXBlICE9PSAxKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZXJyb3IubnVtO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBDb21wdXRlIGN1bXVsYXRpdmUgcHJpbmNpcGFsXHJcbiAgICAgICAgICAgIHZhciBwYXltZW50ID0gZXhwb3J0cy5QTVQocmF0ZSwgcGVyaW9kcywgdmFsdWUsIDAsIHR5cGUpO1xyXG4gICAgICAgICAgICB2YXIgcHJpbmNpcGFsID0gMDtcclxuICAgICAgICAgICAgaWYgKHN0YXJ0ID09PSAxKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAodHlwZSA9PT0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHByaW5jaXBhbCA9IHBheW1lbnQgKyB2YWx1ZSAqIHJhdGU7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHByaW5jaXBhbCA9IHBheW1lbnQ7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBzdGFydCsrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSBzdGFydDsgaSA8PSBlbmQ7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgaWYgKHR5cGUgPiAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcHJpbmNpcGFsICs9IHBheW1lbnQgLSAoZXhwb3J0cy5GVihyYXRlLCBpIC0gMiwgcGF5bWVudCwgdmFsdWUsIDEpIC0gcGF5bWVudCkgKiByYXRlO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBwcmluY2lwYWwgKz0gcGF5bWVudCAtIGV4cG9ydHMuRlYocmF0ZSwgaSAtIDEsIHBheW1lbnQsIHZhbHVlLCAwKSAqIHJhdGU7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIFJldHVybiBjdW11bGF0aXZlIHByaW5jaXBhbFxyXG4gICAgICAgICAgICByZXR1cm4gcHJpbmNpcGFsO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGV4cG9ydHMuREIgPSBmdW5jdGlvbiAoY29zdCwgc2FsdmFnZSwgbGlmZSwgcGVyaW9kLCBtb250aCkge1xyXG4gICAgICAgICAgICAvLyBJbml0aWFsaXplIG1vbnRoXHJcbiAgICAgICAgICAgIG1vbnRoID0gKG1vbnRoID09PSB1bmRlZmluZWQpID8gMTIgOiBtb250aDtcclxuXHJcbiAgICAgICAgICAgIGNvc3QgPSB1dGlscy5wYXJzZU51bWJlcihjb3N0KTtcclxuICAgICAgICAgICAgc2FsdmFnZSA9IHV0aWxzLnBhcnNlTnVtYmVyKHNhbHZhZ2UpO1xyXG4gICAgICAgICAgICBsaWZlID0gdXRpbHMucGFyc2VOdW1iZXIobGlmZSk7XHJcbiAgICAgICAgICAgIHBlcmlvZCA9IHV0aWxzLnBhcnNlTnVtYmVyKHBlcmlvZCk7XHJcbiAgICAgICAgICAgIG1vbnRoID0gdXRpbHMucGFyc2VOdW1iZXIobW9udGgpO1xyXG4gICAgICAgICAgICBpZiAodXRpbHMuYW55SXNFcnJvcihjb3N0LCBzYWx2YWdlLCBsaWZlLCBwZXJpb2QsIG1vbnRoKSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGVycm9yLnZhbHVlO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBSZXR1cm4gZXJyb3IgaWYgYW55IG9mIHRoZSBwYXJhbWV0ZXJzIGlzIG5lZ2F0aXZlXHJcbiAgICAgICAgICAgIGlmIChjb3N0IDwgMCB8fCBzYWx2YWdlIDwgMCB8fCBsaWZlIDwgMCB8fCBwZXJpb2QgPCAwKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZXJyb3IubnVtO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBSZXR1cm4gZXJyb3IgaWYgbW9udGggaXMgbm90IGFuIGludGVnZXIgYmV0d2VlbiAxIGFuZCAxMlxyXG4gICAgICAgICAgICBpZiAoWzEsIDIsIDMsIDQsIDUsIDYsIDcsIDgsIDksIDEwLCAxMSwgMTJdLmluZGV4T2YobW9udGgpID09PSAtMSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGVycm9yLm51bTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gUmV0dXJuIGVycm9yIGlmIHBlcmlvZCBpcyBncmVhdGVyIHRoYW4gbGlmZVxyXG4gICAgICAgICAgICBpZiAocGVyaW9kID4gbGlmZSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGVycm9yLm51bTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gUmV0dXJuIDAgKHplcm8pIGlmIHNhbHZhZ2UgaXMgZ3JlYXRlciB0aGFuIG9yIGVxdWFsIHRvIGNvc3RcclxuICAgICAgICAgICAgaWYgKHNhbHZhZ2UgPj0gY29zdCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIDA7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIFJhdGUgaXMgcm91bmRlZCB0byB0aHJlZSBkZWNpbWFscyBwbGFjZXNcclxuICAgICAgICAgICAgdmFyIHJhdGUgPSAoMSAtIE1hdGgucG93KHNhbHZhZ2UgLyBjb3N0LCAxIC8gbGlmZSkpLnRvRml4ZWQoMyk7XHJcblxyXG4gICAgICAgICAgICAvLyBDb21wdXRlIGluaXRpYWwgZGVwcmVjaWF0aW9uXHJcbiAgICAgICAgICAgIHZhciBpbml0aWFsID0gY29zdCAqIHJhdGUgKiBtb250aCAvIDEyO1xyXG5cclxuICAgICAgICAgICAgLy8gQ29tcHV0ZSB0b3RhbCBkZXByZWNpYXRpb25cclxuICAgICAgICAgICAgdmFyIHRvdGFsID0gaW5pdGlhbDtcclxuICAgICAgICAgICAgdmFyIGN1cnJlbnQgPSAwO1xyXG4gICAgICAgICAgICB2YXIgY2VpbGluZyA9IChwZXJpb2QgPT09IGxpZmUpID8gbGlmZSAtIDEgOiBwZXJpb2Q7XHJcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAyOyBpIDw9IGNlaWxpbmc7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgY3VycmVudCA9IChjb3N0IC0gdG90YWwpICogcmF0ZTtcclxuICAgICAgICAgICAgICAgIHRvdGFsICs9IGN1cnJlbnQ7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIERlcHJlY2lhdGlvbiBmb3IgdGhlIGZpcnN0IGFuZCBsYXN0IHBlcmlvZHMgYXJlIHNwZWNpYWwgY2FzZXNcclxuICAgICAgICAgICAgaWYgKHBlcmlvZCA9PT0gMSkge1xyXG4gICAgICAgICAgICAgICAgLy8gRmlyc3QgcGVyaW9kXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gaW5pdGlhbDtcclxuICAgICAgICAgICAgfSBlbHNlIGlmIChwZXJpb2QgPT09IGxpZmUpIHtcclxuICAgICAgICAgICAgICAgIC8vIExhc3QgcGVyaW9kXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gKGNvc3QgLSB0b3RhbCkgKiByYXRlO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGN1cnJlbnQ7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBleHBvcnRzLkREQiA9IGZ1bmN0aW9uIChjb3N0LCBzYWx2YWdlLCBsaWZlLCBwZXJpb2QsIGZhY3Rvcikge1xyXG4gICAgICAgICAgICAvLyBJbml0aWFsaXplIGZhY3RvclxyXG4gICAgICAgICAgICBmYWN0b3IgPSAoZmFjdG9yID09PSB1bmRlZmluZWQpID8gMiA6IGZhY3RvcjtcclxuXHJcbiAgICAgICAgICAgIGNvc3QgPSB1dGlscy5wYXJzZU51bWJlcihjb3N0KTtcclxuICAgICAgICAgICAgc2FsdmFnZSA9IHV0aWxzLnBhcnNlTnVtYmVyKHNhbHZhZ2UpO1xyXG4gICAgICAgICAgICBsaWZlID0gdXRpbHMucGFyc2VOdW1iZXIobGlmZSk7XHJcbiAgICAgICAgICAgIHBlcmlvZCA9IHV0aWxzLnBhcnNlTnVtYmVyKHBlcmlvZCk7XHJcbiAgICAgICAgICAgIGZhY3RvciA9IHV0aWxzLnBhcnNlTnVtYmVyKGZhY3Rvcik7XHJcbiAgICAgICAgICAgIGlmICh1dGlscy5hbnlJc0Vycm9yKGNvc3QsIHNhbHZhZ2UsIGxpZmUsIHBlcmlvZCwgZmFjdG9yKSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGVycm9yLnZhbHVlO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBSZXR1cm4gZXJyb3IgaWYgYW55IG9mIHRoZSBwYXJhbWV0ZXJzIGlzIG5lZ2F0aXZlIG9yIGlmIGZhY3RvciBpc1xyXG4gICAgICAgICAgICAvLyBudWxsXHJcbiAgICAgICAgICAgIGlmIChjb3N0IDwgMCB8fCBzYWx2YWdlIDwgMCB8fCBsaWZlIDwgMCB8fCBwZXJpb2QgPCAwIHx8IGZhY3RvciA8PSAwKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZXJyb3IubnVtO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBSZXR1cm4gZXJyb3IgaWYgcGVyaW9kIGlzIGdyZWF0ZXIgdGhhbiBsaWZlXHJcbiAgICAgICAgICAgIGlmIChwZXJpb2QgPiBsaWZlKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZXJyb3IubnVtO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBSZXR1cm4gMCAoemVybykgaWYgc2FsdmFnZSBpcyBncmVhdGVyIHRoYW4gb3IgZXF1YWwgdG8gY29zdFxyXG4gICAgICAgICAgICBpZiAoc2FsdmFnZSA+PSBjb3N0KSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gMDtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gQ29tcHV0ZSBkZXByZWNpYXRpb25cclxuICAgICAgICAgICAgdmFyIHRvdGFsID0gMDtcclxuICAgICAgICAgICAgdmFyIGN1cnJlbnQgPSAwO1xyXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMTsgaSA8PSBwZXJpb2Q7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgY3VycmVudCA9IE1hdGgubWluKChjb3N0IC0gdG90YWwpICogKGZhY3RvciAvIGxpZmUpLCAoY29zdCAtIHNhbHZhZ2UgLSB0b3RhbCkpO1xyXG4gICAgICAgICAgICAgICAgdG90YWwgKz0gY3VycmVudDtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gUmV0dXJuIGRlcHJlY2lhdGlvblxyXG4gICAgICAgICAgICByZXR1cm4gY3VycmVudDtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBleHBvcnRzLkRJU0MgPSBudWxsO1xyXG5cclxuICAgICAgICBleHBvcnRzLkRPTExBUkRFID0gZnVuY3Rpb24gKGRvbGxhciwgZnJhY3Rpb24pIHtcclxuICAgICAgICAgICAgLy8gQ3JlZGl0czogYWxnb3JpdGhtIGluc3BpcmVkIGJ5IEFwYWNoZSBPcGVuT2ZmaWNlXHJcblxyXG4gICAgICAgICAgICBkb2xsYXIgPSB1dGlscy5wYXJzZU51bWJlcihkb2xsYXIpO1xyXG4gICAgICAgICAgICBmcmFjdGlvbiA9IHV0aWxzLnBhcnNlTnVtYmVyKGZyYWN0aW9uKTtcclxuICAgICAgICAgICAgaWYgKHV0aWxzLmFueUlzRXJyb3IoZG9sbGFyLCBmcmFjdGlvbikpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBlcnJvci52YWx1ZTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gUmV0dXJuIGVycm9yIGlmIGZyYWN0aW9uIGlzIG5lZ2F0aXZlXHJcbiAgICAgICAgICAgIGlmIChmcmFjdGlvbiA8IDApIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBlcnJvci5udW07XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIFJldHVybiBlcnJvciBpZiBmcmFjdGlvbiBpcyBncmVhdGVyIHRoYW4gb3IgZXF1YWwgdG8gMCBhbmQgbGVzcyB0aGFuXHJcbiAgICAgICAgICAgIC8vIDFcclxuICAgICAgICAgICAgaWYgKGZyYWN0aW9uID49IDAgJiYgZnJhY3Rpb24gPCAxKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZXJyb3IuZGl2MDtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gVHJ1bmNhdGUgZnJhY3Rpb24gaWYgaXQgaXMgbm90IGFuIGludGVnZXJcclxuICAgICAgICAgICAgZnJhY3Rpb24gPSBwYXJzZUludChmcmFjdGlvbiwgMTApO1xyXG5cclxuICAgICAgICAgICAgLy8gQ29tcHV0ZSBpbnRlZ2VyIHBhcnRcclxuICAgICAgICAgICAgdmFyIHJlc3VsdCA9IHBhcnNlSW50KGRvbGxhciwgMTApO1xyXG5cclxuICAgICAgICAgICAgLy8gQWRkIGRlY2ltYWwgcGFydFxyXG4gICAgICAgICAgICByZXN1bHQgKz0gKGRvbGxhciAlIDEpICogTWF0aC5wb3coMTAsIE1hdGguY2VpbChNYXRoLmxvZyhmcmFjdGlvbikgLyBNYXRoLkxOMTApKSAvIGZyYWN0aW9uO1xyXG5cclxuICAgICAgICAgICAgLy8gUm91bmQgcmVzdWx0XHJcbiAgICAgICAgICAgIHZhciBwb3dlciA9IE1hdGgucG93KDEwLCBNYXRoLmNlaWwoTWF0aC5sb2coZnJhY3Rpb24pIC8gTWF0aC5MTjIpICsgMSk7XHJcbiAgICAgICAgICAgIHJlc3VsdCA9IE1hdGgucm91bmQocmVzdWx0ICogcG93ZXIpIC8gcG93ZXI7XHJcblxyXG4gICAgICAgICAgICAvLyBSZXR1cm4gY29udmVydGVkIGRvbGxhciBwcmljZVxyXG4gICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGV4cG9ydHMuRE9MTEFSRlIgPSBmdW5jdGlvbiAoZG9sbGFyLCBmcmFjdGlvbikge1xyXG4gICAgICAgICAgICAvLyBDcmVkaXRzOiBhbGdvcml0aG0gaW5zcGlyZWQgYnkgQXBhY2hlIE9wZW5PZmZpY2VcclxuXHJcbiAgICAgICAgICAgIGRvbGxhciA9IHV0aWxzLnBhcnNlTnVtYmVyKGRvbGxhcik7XHJcbiAgICAgICAgICAgIGZyYWN0aW9uID0gdXRpbHMucGFyc2VOdW1iZXIoZnJhY3Rpb24pO1xyXG4gICAgICAgICAgICBpZiAodXRpbHMuYW55SXNFcnJvcihkb2xsYXIsIGZyYWN0aW9uKSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGVycm9yLnZhbHVlO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBSZXR1cm4gZXJyb3IgaWYgZnJhY3Rpb24gaXMgbmVnYXRpdmVcclxuICAgICAgICAgICAgaWYgKGZyYWN0aW9uIDwgMCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGVycm9yLm51bTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gUmV0dXJuIGVycm9yIGlmIGZyYWN0aW9uIGlzIGdyZWF0ZXIgdGhhbiBvciBlcXVhbCB0byAwIGFuZCBsZXNzIHRoYW5cclxuICAgICAgICAgICAgLy8gMVxyXG4gICAgICAgICAgICBpZiAoZnJhY3Rpb24gPj0gMCAmJiBmcmFjdGlvbiA8IDEpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBlcnJvci5kaXYwO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBUcnVuY2F0ZSBmcmFjdGlvbiBpZiBpdCBpcyBub3QgYW4gaW50ZWdlclxyXG4gICAgICAgICAgICBmcmFjdGlvbiA9IHBhcnNlSW50KGZyYWN0aW9uLCAxMCk7XHJcblxyXG4gICAgICAgICAgICAvLyBDb21wdXRlIGludGVnZXIgcGFydFxyXG4gICAgICAgICAgICB2YXIgcmVzdWx0ID0gcGFyc2VJbnQoZG9sbGFyLCAxMCk7XHJcblxyXG4gICAgICAgICAgICAvLyBBZGQgZGVjaW1hbCBwYXJ0XHJcbiAgICAgICAgICAgIHJlc3VsdCArPSAoZG9sbGFyICUgMSkgKiBNYXRoLnBvdygxMCwgLU1hdGguY2VpbChNYXRoLmxvZyhmcmFjdGlvbikgLyBNYXRoLkxOMTApKSAqIGZyYWN0aW9uO1xyXG5cclxuICAgICAgICAgICAgLy8gUmV0dXJuIGNvbnZlcnRlZCBkb2xsYXIgcHJpY2VcclxuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBleHBvcnRzLkRVUkFUSU9OID0gbnVsbDtcclxuXHJcbiAgICAgICAgZXhwb3J0cy5FRkZFQ1QgPSBmdW5jdGlvbiAocmF0ZSwgcGVyaW9kcykge1xyXG4gICAgICAgICAgICByYXRlID0gdXRpbHMucGFyc2VOdW1iZXIocmF0ZSk7XHJcbiAgICAgICAgICAgIHBlcmlvZHMgPSB1dGlscy5wYXJzZU51bWJlcihwZXJpb2RzKTtcclxuICAgICAgICAgICAgaWYgKHV0aWxzLmFueUlzRXJyb3IocmF0ZSwgcGVyaW9kcykpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBlcnJvci52YWx1ZTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gUmV0dXJuIGVycm9yIGlmIHJhdGUgPD0wIG9yIHBlcmlvZHMgPCAxXHJcbiAgICAgICAgICAgIGlmIChyYXRlIDw9IDAgfHwgcGVyaW9kcyA8IDEpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBlcnJvci5udW07XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIFRydW5jYXRlIHBlcmlvZHMgaWYgaXQgaXMgbm90IGFuIGludGVnZXJcclxuICAgICAgICAgICAgcGVyaW9kcyA9IHBhcnNlSW50KHBlcmlvZHMsIDEwKTtcclxuXHJcbiAgICAgICAgICAgIC8vIFJldHVybiBlZmZlY3RpdmUgYW5udWFsIGludGVyZXN0IHJhdGVcclxuICAgICAgICAgICAgcmV0dXJuIE1hdGgucG93KDEgKyByYXRlIC8gcGVyaW9kcywgcGVyaW9kcykgLSAxO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGV4cG9ydHMuRlYgPSBmdW5jdGlvbiAocmF0ZSwgcGVyaW9kcywgcGF5bWVudCwgdmFsdWUsIHR5cGUpIHtcclxuICAgICAgICAgICAgLy8gQ3JlZGl0czogYWxnb3JpdGhtIGluc3BpcmVkIGJ5IEFwYWNoZSBPcGVuT2ZmaWNlXHJcblxyXG4gICAgICAgICAgICB2YWx1ZSA9IHZhbHVlIHx8IDA7XHJcbiAgICAgICAgICAgIHR5cGUgPSB0eXBlIHx8IDA7XHJcblxyXG4gICAgICAgICAgICByYXRlID0gdXRpbHMucGFyc2VOdW1iZXIocmF0ZSk7XHJcbiAgICAgICAgICAgIHBlcmlvZHMgPSB1dGlscy5wYXJzZU51bWJlcihwZXJpb2RzKTtcclxuICAgICAgICAgICAgcGF5bWVudCA9IHV0aWxzLnBhcnNlTnVtYmVyKHBheW1lbnQpO1xyXG4gICAgICAgICAgICB2YWx1ZSA9IHV0aWxzLnBhcnNlTnVtYmVyKHZhbHVlKTtcclxuICAgICAgICAgICAgdHlwZSA9IHV0aWxzLnBhcnNlTnVtYmVyKHR5cGUpO1xyXG4gICAgICAgICAgICBpZiAodXRpbHMuYW55SXNFcnJvcihyYXRlLCBwZXJpb2RzLCBwYXltZW50LCB2YWx1ZSwgdHlwZSkpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBlcnJvci52YWx1ZTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gUmV0dXJuIGZ1dHVyZSB2YWx1ZVxyXG4gICAgICAgICAgICB2YXIgcmVzdWx0O1xyXG4gICAgICAgICAgICBpZiAocmF0ZSA9PT0gMCkge1xyXG4gICAgICAgICAgICAgICAgcmVzdWx0ID0gdmFsdWUgKyBwYXltZW50ICogcGVyaW9kcztcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHZhciB0ZXJtID0gTWF0aC5wb3coMSArIHJhdGUsIHBlcmlvZHMpO1xyXG4gICAgICAgICAgICAgICAgaWYgKHR5cGUgPT09IDEpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXN1bHQgPSB2YWx1ZSAqIHRlcm0gKyBwYXltZW50ICogKDEgKyByYXRlKSAqICh0ZXJtIC0gMSkgLyByYXRlO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICByZXN1bHQgPSB2YWx1ZSAqIHRlcm0gKyBwYXltZW50ICogKHRlcm0gLSAxKSAvIHJhdGU7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIC1yZXN1bHQ7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZXhwb3J0cy5GVlNDSEVEVUxFID0gZnVuY3Rpb24gKHByaW5jaXBhbCwgc2NoZWR1bGUpIHtcclxuICAgICAgICAgICAgcHJpbmNpcGFsID0gdXRpbHMucGFyc2VOdW1iZXIocHJpbmNpcGFsKTtcclxuICAgICAgICAgICAgc2NoZWR1bGUgPSB1dGlscy5wYXJzZU51bWJlckFycmF5KHV0aWxzLmZsYXR0ZW4oc2NoZWR1bGUpKTtcclxuICAgICAgICAgICAgaWYgKHV0aWxzLmFueUlzRXJyb3IocHJpbmNpcGFsLCBzY2hlZHVsZSkpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBlcnJvci52YWx1ZTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgdmFyIG4gPSBzY2hlZHVsZS5sZW5ndGg7XHJcbiAgICAgICAgICAgIHZhciBmdXR1cmUgPSBwcmluY2lwYWw7XHJcblxyXG4gICAgICAgICAgICAvLyBBcHBseSBhbGwgaW50ZXJlc3RzIGluIHNjaGVkdWxlXHJcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbjsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAvLyBBcHBseSBzY2hlZHVsZWQgaW50ZXJlc3RcclxuICAgICAgICAgICAgICAgIGZ1dHVyZSAqPSAxICsgc2NoZWR1bGVbaV07XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIFJldHVybiBmdXR1cmUgdmFsdWVcclxuICAgICAgICAgICAgcmV0dXJuIGZ1dHVyZTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBleHBvcnRzLklOVFJBVEUgPSBudWxsO1xyXG5cclxuICAgICAgICBleHBvcnRzLklQTVQgPSBmdW5jdGlvbiAocmF0ZSwgcGVyaW9kLCBwZXJpb2RzLCBwcmVzZW50LCBmdXR1cmUsIHR5cGUpIHtcclxuICAgICAgICAgICAgLy8gQ3JlZGl0czogYWxnb3JpdGhtIGluc3BpcmVkIGJ5IEFwYWNoZSBPcGVuT2ZmaWNlXHJcblxyXG4gICAgICAgICAgICBmdXR1cmUgPSBmdXR1cmUgfHwgMDtcclxuICAgICAgICAgICAgdHlwZSA9IHR5cGUgfHwgMDtcclxuXHJcbiAgICAgICAgICAgIHJhdGUgPSB1dGlscy5wYXJzZU51bWJlcihyYXRlKTtcclxuICAgICAgICAgICAgcGVyaW9kID0gdXRpbHMucGFyc2VOdW1iZXIocGVyaW9kKTtcclxuICAgICAgICAgICAgcGVyaW9kcyA9IHV0aWxzLnBhcnNlTnVtYmVyKHBlcmlvZHMpO1xyXG4gICAgICAgICAgICBwcmVzZW50ID0gdXRpbHMucGFyc2VOdW1iZXIocHJlc2VudCk7XHJcbiAgICAgICAgICAgIGZ1dHVyZSA9IHV0aWxzLnBhcnNlTnVtYmVyKGZ1dHVyZSk7XHJcbiAgICAgICAgICAgIHR5cGUgPSB1dGlscy5wYXJzZU51bWJlcih0eXBlKTtcclxuICAgICAgICAgICAgaWYgKHV0aWxzLmFueUlzRXJyb3IocmF0ZSwgcGVyaW9kLCBwZXJpb2RzLCBwcmVzZW50LCBmdXR1cmUsIHR5cGUpKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZXJyb3IudmFsdWU7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIENvbXB1dGUgcGF5bWVudFxyXG4gICAgICAgICAgICB2YXIgcGF5bWVudCA9IGV4cG9ydHMuUE1UKHJhdGUsIHBlcmlvZHMsIHByZXNlbnQsIGZ1dHVyZSwgdHlwZSk7XHJcblxyXG4gICAgICAgICAgICAvLyBDb21wdXRlIGludGVyZXN0XHJcbiAgICAgICAgICAgIHZhciBpbnRlcmVzdDtcclxuICAgICAgICAgICAgaWYgKHBlcmlvZCA9PT0gMSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKHR5cGUgPT09IDEpIHtcclxuICAgICAgICAgICAgICAgICAgICBpbnRlcmVzdCA9IDA7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGludGVyZXN0ID0gLXByZXNlbnQ7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBpZiAodHlwZSA9PT0gMSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGludGVyZXN0ID0gZXhwb3J0cy5GVihyYXRlLCBwZXJpb2QgLSAyLCBwYXltZW50LCBwcmVzZW50LCAxKSAtIHBheW1lbnQ7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGludGVyZXN0ID0gZXhwb3J0cy5GVihyYXRlLCBwZXJpb2QgLSAxLCBwYXltZW50LCBwcmVzZW50LCAwKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gUmV0dXJuIGludGVyZXN0XHJcbiAgICAgICAgICAgIHJldHVybiBpbnRlcmVzdCAqIHJhdGU7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZXhwb3J0cy5JUlIgPSBmdW5jdGlvbiAodmFsdWVzLCBndWVzcykge1xyXG4gICAgICAgICAgICAvLyBDcmVkaXRzOiBhbGdvcml0aG0gaW5zcGlyZWQgYnkgQXBhY2hlIE9wZW5PZmZpY2VcclxuXHJcbiAgICAgICAgICAgIGd1ZXNzID0gZ3Vlc3MgfHwgMDtcclxuXHJcbiAgICAgICAgICAgIHZhbHVlcyA9IHV0aWxzLnBhcnNlTnVtYmVyQXJyYXkodXRpbHMuZmxhdHRlbih2YWx1ZXMpKTtcclxuICAgICAgICAgICAgZ3Vlc3MgPSB1dGlscy5wYXJzZU51bWJlcihndWVzcyk7XHJcbiAgICAgICAgICAgIGlmICh1dGlscy5hbnlJc0Vycm9yKHZhbHVlcywgZ3Vlc3MpKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZXJyb3IudmFsdWU7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIENhbGN1bGF0ZXMgdGhlIHJlc3VsdGluZyBhbW91bnRcclxuICAgICAgICAgICAgdmFyIGlyclJlc3VsdCA9IGZ1bmN0aW9uICh2YWx1ZXMsIGRhdGVzLCByYXRlKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgciA9IHJhdGUgKyAxO1xyXG4gICAgICAgICAgICAgICAgdmFyIHJlc3VsdCA9IHZhbHVlc1swXTtcclxuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAxOyBpIDwgdmFsdWVzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0ICs9IHZhbHVlc1tpXSAvIE1hdGgucG93KHIsIChkYXRlc1tpXSAtIGRhdGVzWzBdKSAvIDM2NSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgLy8gQ2FsY3VsYXRlcyB0aGUgZmlyc3QgZGVyaXZhdGlvblxyXG4gICAgICAgICAgICB2YXIgaXJyUmVzdWx0RGVyaXYgPSBmdW5jdGlvbiAodmFsdWVzLCBkYXRlcywgcmF0ZSkge1xyXG4gICAgICAgICAgICAgICAgdmFyIHIgPSByYXRlICsgMTtcclxuICAgICAgICAgICAgICAgIHZhciByZXN1bHQgPSAwO1xyXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDE7IGkgPCB2YWx1ZXMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgZnJhYyA9IChkYXRlc1tpXSAtIGRhdGVzWzBdKSAvIDM2NTtcclxuICAgICAgICAgICAgICAgICAgICByZXN1bHQgLT0gZnJhYyAqIHZhbHVlc1tpXSAvIE1hdGgucG93KHIsIGZyYWMgKyAxKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XHJcbiAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAvLyBJbml0aWFsaXplIGRhdGVzIGFuZCBjaGVjayB0aGF0IHZhbHVlcyBjb250YWlucyBhdCBsZWFzdCBvbmUgcG9zaXRpdmVcclxuICAgICAgICAgICAgLy8gdmFsdWUgYW5kIG9uZSBuZWdhdGl2ZSB2YWx1ZVxyXG4gICAgICAgICAgICB2YXIgZGF0ZXMgPSBbXTtcclxuICAgICAgICAgICAgdmFyIHBvc2l0aXZlID0gZmFsc2U7XHJcbiAgICAgICAgICAgIHZhciBuZWdhdGl2ZSA9IGZhbHNlO1xyXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHZhbHVlcy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgZGF0ZXNbaV0gPSAoaSA9PT0gMCkgPyAwIDogZGF0ZXNbaSAtIDFdICsgMzY1O1xyXG4gICAgICAgICAgICAgICAgaWYgKHZhbHVlc1tpXSA+IDApIHtcclxuICAgICAgICAgICAgICAgICAgICBwb3NpdGl2ZSA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAodmFsdWVzW2ldIDwgMCkge1xyXG4gICAgICAgICAgICAgICAgICAgIG5lZ2F0aXZlID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gUmV0dXJuIGVycm9yIGlmIHZhbHVlcyBkb2VzIG5vdCBjb250YWluIGF0IGxlYXN0IG9uZSBwb3NpdGl2ZSB2YWx1ZVxyXG4gICAgICAgICAgICAvLyBhbmQgb25lIG5lZ2F0aXZlIHZhbHVlXHJcbiAgICAgICAgICAgIGlmICghcG9zaXRpdmUgfHwgIW5lZ2F0aXZlKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZXJyb3IubnVtO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBJbml0aWFsaXplIGd1ZXNzIGFuZCByZXN1bHRSYXRlXHJcbiAgICAgICAgICAgIGd1ZXNzID0gKGd1ZXNzID09PSB1bmRlZmluZWQpID8gMC4xIDogZ3Vlc3M7XHJcbiAgICAgICAgICAgIHZhciByZXN1bHRSYXRlID0gZ3Vlc3M7XHJcblxyXG4gICAgICAgICAgICAvLyBTZXQgbWF4aW11bSBlcHNpbG9uIGZvciBlbmQgb2YgaXRlcmF0aW9uXHJcbiAgICAgICAgICAgIHZhciBlcHNNYXggPSAxZS0xMDtcclxuXHJcbiAgICAgICAgICAgIC8vIEltcGxlbWVudCBOZXd0b24ncyBtZXRob2RcclxuICAgICAgICAgICAgdmFyIG5ld1JhdGUsIGVwc1JhdGUsIHJlc3VsdFZhbHVlO1xyXG4gICAgICAgICAgICB2YXIgY29udExvb3AgPSB0cnVlO1xyXG4gICAgICAgICAgICBkbyB7XHJcbiAgICAgICAgICAgICAgICByZXN1bHRWYWx1ZSA9IGlyclJlc3VsdCh2YWx1ZXMsIGRhdGVzLCByZXN1bHRSYXRlKTtcclxuICAgICAgICAgICAgICAgIG5ld1JhdGUgPSByZXN1bHRSYXRlIC0gcmVzdWx0VmFsdWUgLyBpcnJSZXN1bHREZXJpdih2YWx1ZXMsIGRhdGVzLCByZXN1bHRSYXRlKTtcclxuICAgICAgICAgICAgICAgIGVwc1JhdGUgPSBNYXRoLmFicyhuZXdSYXRlIC0gcmVzdWx0UmF0ZSk7XHJcbiAgICAgICAgICAgICAgICByZXN1bHRSYXRlID0gbmV3UmF0ZTtcclxuICAgICAgICAgICAgICAgIGNvbnRMb29wID0gKGVwc1JhdGUgPiBlcHNNYXgpICYmIChNYXRoLmFicyhyZXN1bHRWYWx1ZSkgPiBlcHNNYXgpO1xyXG4gICAgICAgICAgICB9IHdoaWxlIChjb250TG9vcCk7XHJcblxyXG4gICAgICAgICAgICAvLyBSZXR1cm4gaW50ZXJuYWwgcmF0ZSBvZiByZXR1cm5cclxuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdFJhdGU7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZXhwb3J0cy5JU1BNVCA9IGZ1bmN0aW9uIChyYXRlLCBwZXJpb2QsIHBlcmlvZHMsIHZhbHVlKSB7XHJcbiAgICAgICAgICAgIHJhdGUgPSB1dGlscy5wYXJzZU51bWJlcihyYXRlKTtcclxuICAgICAgICAgICAgcGVyaW9kID0gdXRpbHMucGFyc2VOdW1iZXIocGVyaW9kKTtcclxuICAgICAgICAgICAgcGVyaW9kcyA9IHV0aWxzLnBhcnNlTnVtYmVyKHBlcmlvZHMpO1xyXG4gICAgICAgICAgICB2YWx1ZSA9IHV0aWxzLnBhcnNlTnVtYmVyKHZhbHVlKTtcclxuICAgICAgICAgICAgaWYgKHV0aWxzLmFueUlzRXJyb3IocmF0ZSwgcGVyaW9kLCBwZXJpb2RzLCB2YWx1ZSkpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBlcnJvci52YWx1ZTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gUmV0dXJuIGludGVyZXN0XHJcbiAgICAgICAgICAgIHJldHVybiB2YWx1ZSAqIHJhdGUgKiAocGVyaW9kIC8gcGVyaW9kcyAtIDEpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGV4cG9ydHMuTURVUkFUSU9OID0gbnVsbDtcclxuXHJcbiAgICAgICAgZXhwb3J0cy5NSVJSID0gZnVuY3Rpb24gKHZhbHVlcywgZmluYW5jZV9yYXRlLCByZWludmVzdF9yYXRlKSB7XHJcbiAgICAgICAgICAgIHZhbHVlcyA9IHV0aWxzLnBhcnNlTnVtYmVyQXJyYXkodXRpbHMuZmxhdHRlbih2YWx1ZXMpKTtcclxuICAgICAgICAgICAgZmluYW5jZV9yYXRlID0gdXRpbHMucGFyc2VOdW1iZXIoZmluYW5jZV9yYXRlKTtcclxuICAgICAgICAgICAgcmVpbnZlc3RfcmF0ZSA9IHV0aWxzLnBhcnNlTnVtYmVyKHJlaW52ZXN0X3JhdGUpO1xyXG4gICAgICAgICAgICBpZiAodXRpbHMuYW55SXNFcnJvcih2YWx1ZXMsIGZpbmFuY2VfcmF0ZSwgcmVpbnZlc3RfcmF0ZSkpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBlcnJvci52YWx1ZTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gSW5pdGlhbGl6ZSBudW1iZXIgb2YgdmFsdWVzXHJcbiAgICAgICAgICAgIHZhciBuID0gdmFsdWVzLmxlbmd0aDtcclxuXHJcbiAgICAgICAgICAgIC8vIExvb2t1cCBwYXltZW50cyAobmVnYXRpdmUgdmFsdWVzKSBhbmQgaW5jb21lcyAocG9zaXRpdmUgdmFsdWVzKVxyXG4gICAgICAgICAgICB2YXIgcGF5bWVudHMgPSBbXTtcclxuICAgICAgICAgICAgdmFyIGluY29tZXMgPSBbXTtcclxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBuOyBpKyspIHtcclxuICAgICAgICAgICAgICAgIGlmICh2YWx1ZXNbaV0gPCAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcGF5bWVudHMucHVzaCh2YWx1ZXNbaV0pO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBpbmNvbWVzLnB1c2godmFsdWVzW2ldKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gUmV0dXJuIG1vZGlmaWVkIGludGVybmFsIHJhdGUgb2YgcmV0dXJuXHJcbiAgICAgICAgICAgIHZhciBudW0gPSAtZXhwb3J0cy5OUFYocmVpbnZlc3RfcmF0ZSwgaW5jb21lcykgKiBNYXRoLnBvdygxICsgcmVpbnZlc3RfcmF0ZSwgbiAtIDEpO1xyXG4gICAgICAgICAgICB2YXIgZGVuID0gZXhwb3J0cy5OUFYoZmluYW5jZV9yYXRlLCBwYXltZW50cykgKiAoMSArIGZpbmFuY2VfcmF0ZSk7XHJcbiAgICAgICAgICAgIHJldHVybiBNYXRoLnBvdyhudW0gLyBkZW4sIDEgLyAobiAtIDEpKSAtIDE7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZXhwb3J0cy5OT01JTkFMID0gZnVuY3Rpb24gKHJhdGUsIHBlcmlvZHMpIHtcclxuICAgICAgICAgICAgcmF0ZSA9IHV0aWxzLnBhcnNlTnVtYmVyKHJhdGUpO1xyXG4gICAgICAgICAgICBwZXJpb2RzID0gdXRpbHMucGFyc2VOdW1iZXIocGVyaW9kcyk7XHJcbiAgICAgICAgICAgIGlmICh1dGlscy5hbnlJc0Vycm9yKHJhdGUsIHBlcmlvZHMpKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZXJyb3IudmFsdWU7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIFJldHVybiBlcnJvciBpZiByYXRlIDw9MCBvciBwZXJpb2RzIDwgMVxyXG4gICAgICAgICAgICBpZiAocmF0ZSA8PSAwIHx8IHBlcmlvZHMgPCAxKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZXJyb3IubnVtO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBUcnVuY2F0ZSBwZXJpb2RzIGlmIGl0IGlzIG5vdCBhbiBpbnRlZ2VyXHJcbiAgICAgICAgICAgIHBlcmlvZHMgPSBwYXJzZUludChwZXJpb2RzLCAxMCk7XHJcblxyXG4gICAgICAgICAgICAvLyBSZXR1cm4gbm9taW5hbCBhbm51YWwgaW50ZXJlc3QgcmF0ZVxyXG4gICAgICAgICAgICByZXR1cm4gKE1hdGgucG93KHJhdGUgKyAxLCAxIC8gcGVyaW9kcykgLSAxKSAqIHBlcmlvZHM7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZXhwb3J0cy5OUEVSID0gZnVuY3Rpb24gKHJhdGUsIHBheW1lbnQsIHByZXNlbnQsIGZ1dHVyZSwgdHlwZSkge1xyXG4gICAgICAgICAgICB0eXBlID0gKHR5cGUgPT09IHVuZGVmaW5lZCkgPyAwIDogdHlwZTtcclxuICAgICAgICAgICAgZnV0dXJlID0gKGZ1dHVyZSA9PT0gdW5kZWZpbmVkKSA/IDAgOiBmdXR1cmU7XHJcblxyXG4gICAgICAgICAgICByYXRlID0gdXRpbHMucGFyc2VOdW1iZXIocmF0ZSk7XHJcbiAgICAgICAgICAgIHBheW1lbnQgPSB1dGlscy5wYXJzZU51bWJlcihwYXltZW50KTtcclxuICAgICAgICAgICAgcHJlc2VudCA9IHV0aWxzLnBhcnNlTnVtYmVyKHByZXNlbnQpO1xyXG4gICAgICAgICAgICBmdXR1cmUgPSB1dGlscy5wYXJzZU51bWJlcihmdXR1cmUpO1xyXG4gICAgICAgICAgICB0eXBlID0gdXRpbHMucGFyc2VOdW1iZXIodHlwZSk7XHJcbiAgICAgICAgICAgIGlmICh1dGlscy5hbnlJc0Vycm9yKHJhdGUsIHBheW1lbnQsIHByZXNlbnQsIGZ1dHVyZSwgdHlwZSkpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBlcnJvci52YWx1ZTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gUmV0dXJuIG51bWJlciBvZiBwZXJpb2RzXHJcbiAgICAgICAgICAgIHZhciBudW0gPSBwYXltZW50ICogKDEgKyByYXRlICogdHlwZSkgLSBmdXR1cmUgKiByYXRlO1xyXG4gICAgICAgICAgICB2YXIgZGVuID0gKHByZXNlbnQgKiByYXRlICsgcGF5bWVudCAqICgxICsgcmF0ZSAqIHR5cGUpKTtcclxuICAgICAgICAgICAgcmV0dXJuIE1hdGgubG9nKG51bSAvIGRlbikgLyBNYXRoLmxvZygxICsgcmF0ZSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZXhwb3J0cy5OUFYgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHZhciBhcmdzID0gdXRpbHMucGFyc2VOdW1iZXJBcnJheSh1dGlscy5mbGF0dGVuKGFyZ3VtZW50cykpO1xyXG4gICAgICAgICAgICBpZiAoYXJncyBpbnN0YW5jZW9mIEVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gYXJncztcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gTG9va3VwIHJhdGVcclxuICAgICAgICAgICAgdmFyIHJhdGUgPSBhcmdzWzBdO1xyXG5cclxuICAgICAgICAgICAgLy8gSW5pdGlhbGl6ZSBuZXQgcHJlc2VudCB2YWx1ZVxyXG4gICAgICAgICAgICB2YXIgdmFsdWUgPSAwO1xyXG5cclxuICAgICAgICAgICAgLy8gTG9vcCBvbiBhbGwgdmFsdWVzXHJcbiAgICAgICAgICAgIGZvciAodmFyIGogPSAxOyBqIDwgYXJncy5sZW5ndGg7IGorKykge1xyXG4gICAgICAgICAgICAgICAgdmFsdWUgKz0gYXJnc1tqXSAvIE1hdGgucG93KDEgKyByYXRlLCBqKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gUmV0dXJuIG5ldCBwcmVzZW50IHZhbHVlXHJcbiAgICAgICAgICAgIHJldHVybiB2YWx1ZTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBleHBvcnRzLk9EREZQUklDRSA9IG51bGw7XHJcblxyXG4gICAgICAgIGV4cG9ydHMuT0RERllJRUxEID0gbnVsbDtcclxuXHJcbiAgICAgICAgZXhwb3J0cy5PRERMUFJJQ0UgPSBudWxsO1xyXG5cclxuICAgICAgICBleHBvcnRzLk9ERExZSUVMRCA9IG51bGw7XHJcblxyXG4gICAgICAgIGV4cG9ydHMuUERVUkFUSU9OID0gZnVuY3Rpb24gKHJhdGUsIHByZXNlbnQsIGZ1dHVyZSkge1xyXG4gICAgICAgICAgICByYXRlID0gdXRpbHMucGFyc2VOdW1iZXIocmF0ZSk7XHJcbiAgICAgICAgICAgIHByZXNlbnQgPSB1dGlscy5wYXJzZU51bWJlcihwcmVzZW50KTtcclxuICAgICAgICAgICAgZnV0dXJlID0gdXRpbHMucGFyc2VOdW1iZXIoZnV0dXJlKTtcclxuICAgICAgICAgICAgaWYgKHV0aWxzLmFueUlzRXJyb3IocmF0ZSwgcHJlc2VudCwgZnV0dXJlKSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGVycm9yLnZhbHVlO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBSZXR1cm4gZXJyb3IgaWYgcmF0ZSA8PTBcclxuICAgICAgICAgICAgaWYgKHJhdGUgPD0gMCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGVycm9yLm51bTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gUmV0dXJuIG51bWJlciBvZiBwZXJpb2RzXHJcbiAgICAgICAgICAgIHJldHVybiAoTWF0aC5sb2coZnV0dXJlKSAtIE1hdGgubG9nKHByZXNlbnQpKSAvIE1hdGgubG9nKDEgKyByYXRlKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBleHBvcnRzLlBNVCA9IGZ1bmN0aW9uIChyYXRlLCBwZXJpb2RzLCBwcmVzZW50LCBmdXR1cmUsIHR5cGUpIHtcclxuICAgICAgICAgICAgLy8gQ3JlZGl0czogYWxnb3JpdGhtIGluc3BpcmVkIGJ5IEFwYWNoZSBPcGVuT2ZmaWNlXHJcblxyXG4gICAgICAgICAgICBmdXR1cmUgPSBmdXR1cmUgfHwgMDtcclxuICAgICAgICAgICAgdHlwZSA9IHR5cGUgfHwgMDtcclxuXHJcbiAgICAgICAgICAgIHJhdGUgPSB1dGlscy5wYXJzZU51bWJlcihyYXRlKTtcclxuICAgICAgICAgICAgcGVyaW9kcyA9IHV0aWxzLnBhcnNlTnVtYmVyKHBlcmlvZHMpO1xyXG4gICAgICAgICAgICBwcmVzZW50ID0gdXRpbHMucGFyc2VOdW1iZXIocHJlc2VudCk7XHJcbiAgICAgICAgICAgIGZ1dHVyZSA9IHV0aWxzLnBhcnNlTnVtYmVyKGZ1dHVyZSk7XHJcbiAgICAgICAgICAgIHR5cGUgPSB1dGlscy5wYXJzZU51bWJlcih0eXBlKTtcclxuICAgICAgICAgICAgaWYgKHV0aWxzLmFueUlzRXJyb3IocmF0ZSwgcGVyaW9kcywgcHJlc2VudCwgZnV0dXJlLCB0eXBlKSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGVycm9yLnZhbHVlO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBSZXR1cm4gcGF5bWVudFxyXG4gICAgICAgICAgICB2YXIgcmVzdWx0O1xyXG4gICAgICAgICAgICBpZiAocmF0ZSA9PT0gMCkge1xyXG4gICAgICAgICAgICAgICAgcmVzdWx0ID0gKHByZXNlbnQgKyBmdXR1cmUpIC8gcGVyaW9kcztcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHZhciB0ZXJtID0gTWF0aC5wb3coMSArIHJhdGUsIHBlcmlvZHMpO1xyXG4gICAgICAgICAgICAgICAgaWYgKHR5cGUgPT09IDEpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXN1bHQgPSAoZnV0dXJlICogcmF0ZSAvICh0ZXJtIC0gMSkgKyBwcmVzZW50ICogcmF0ZSAvICgxIC0gMSAvIHRlcm0pKSAvICgxICsgcmF0ZSk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IGZ1dHVyZSAqIHJhdGUgLyAodGVybSAtIDEpICsgcHJlc2VudCAqIHJhdGUgLyAoMSAtIDEgLyB0ZXJtKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gLXJlc3VsdDtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBleHBvcnRzLlBQTVQgPSBmdW5jdGlvbiAocmF0ZSwgcGVyaW9kLCBwZXJpb2RzLCBwcmVzZW50LCBmdXR1cmUsIHR5cGUpIHtcclxuICAgICAgICAgICAgZnV0dXJlID0gZnV0dXJlIHx8IDA7XHJcbiAgICAgICAgICAgIHR5cGUgPSB0eXBlIHx8IDA7XHJcblxyXG4gICAgICAgICAgICByYXRlID0gdXRpbHMucGFyc2VOdW1iZXIocmF0ZSk7XHJcbiAgICAgICAgICAgIHBlcmlvZHMgPSB1dGlscy5wYXJzZU51bWJlcihwZXJpb2RzKTtcclxuICAgICAgICAgICAgcHJlc2VudCA9IHV0aWxzLnBhcnNlTnVtYmVyKHByZXNlbnQpO1xyXG4gICAgICAgICAgICBmdXR1cmUgPSB1dGlscy5wYXJzZU51bWJlcihmdXR1cmUpO1xyXG4gICAgICAgICAgICB0eXBlID0gdXRpbHMucGFyc2VOdW1iZXIodHlwZSk7XHJcbiAgICAgICAgICAgIGlmICh1dGlscy5hbnlJc0Vycm9yKHJhdGUsIHBlcmlvZHMsIHByZXNlbnQsIGZ1dHVyZSwgdHlwZSkpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBlcnJvci52YWx1ZTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgcmV0dXJuIGV4cG9ydHMuUE1UKHJhdGUsIHBlcmlvZHMsIHByZXNlbnQsIGZ1dHVyZSwgdHlwZSkgLSBleHBvcnRzLklQTVQocmF0ZSwgcGVyaW9kLCBwZXJpb2RzLCBwcmVzZW50LCBmdXR1cmUsIHR5cGUpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGV4cG9ydHMuUFJJQ0UgPSBudWxsO1xyXG5cclxuICAgICAgICBleHBvcnRzLlBSSUNFRElTQyA9IG51bGw7XHJcblxyXG4gICAgICAgIGV4cG9ydHMuUFJJQ0VNQVQgPSBudWxsO1xyXG5cclxuICAgICAgICBleHBvcnRzLlBWID0gZnVuY3Rpb24gKHJhdGUsIHBlcmlvZHMsIHBheW1lbnQsIGZ1dHVyZSwgdHlwZSkge1xyXG4gICAgICAgICAgICBmdXR1cmUgPSBmdXR1cmUgfHwgMDtcclxuICAgICAgICAgICAgdHlwZSA9IHR5cGUgfHwgMDtcclxuXHJcbiAgICAgICAgICAgIHJhdGUgPSB1dGlscy5wYXJzZU51bWJlcihyYXRlKTtcclxuICAgICAgICAgICAgcGVyaW9kcyA9IHV0aWxzLnBhcnNlTnVtYmVyKHBlcmlvZHMpO1xyXG4gICAgICAgICAgICBwYXltZW50ID0gdXRpbHMucGFyc2VOdW1iZXIocGF5bWVudCk7XHJcbiAgICAgICAgICAgIGZ1dHVyZSA9IHV0aWxzLnBhcnNlTnVtYmVyKGZ1dHVyZSk7XHJcbiAgICAgICAgICAgIHR5cGUgPSB1dGlscy5wYXJzZU51bWJlcih0eXBlKTtcclxuICAgICAgICAgICAgaWYgKHV0aWxzLmFueUlzRXJyb3IocmF0ZSwgcGVyaW9kcywgcGF5bWVudCwgZnV0dXJlLCB0eXBlKSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGVycm9yLnZhbHVlO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBSZXR1cm4gcHJlc2VudCB2YWx1ZVxyXG4gICAgICAgICAgICBpZiAocmF0ZSA9PT0gMCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIC1wYXltZW50ICogcGVyaW9kcyAtIGZ1dHVyZTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiAoKCgxIC0gTWF0aC5wb3coMSArIHJhdGUsIHBlcmlvZHMpKSAvIHJhdGUpICogcGF5bWVudCAqICgxICsgcmF0ZSAqIHR5cGUpIC0gZnV0dXJlKSAvIE1hdGgucG93KDEgKyByYXRlLCBwZXJpb2RzKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGV4cG9ydHMuUkFURSA9IGZ1bmN0aW9uIChwZXJpb2RzLCBwYXltZW50LCBwcmVzZW50LCBmdXR1cmUsIHR5cGUsIGd1ZXNzKSB7XHJcbiAgICAgICAgICAgIC8vIENyZWRpdHM6IHJhYnVnZW50b1xyXG5cclxuICAgICAgICAgICAgZ3Vlc3MgPSAoZ3Vlc3MgPT09IHVuZGVmaW5lZCkgPyAwLjAxIDogZ3Vlc3M7XHJcbiAgICAgICAgICAgIGZ1dHVyZSA9IChmdXR1cmUgPT09IHVuZGVmaW5lZCkgPyAwIDogZnV0dXJlO1xyXG4gICAgICAgICAgICB0eXBlID0gKHR5cGUgPT09IHVuZGVmaW5lZCkgPyAwIDogdHlwZTtcclxuXHJcbiAgICAgICAgICAgIHBlcmlvZHMgPSB1dGlscy5wYXJzZU51bWJlcihwZXJpb2RzKTtcclxuICAgICAgICAgICAgcGF5bWVudCA9IHV0aWxzLnBhcnNlTnVtYmVyKHBheW1lbnQpO1xyXG4gICAgICAgICAgICBwcmVzZW50ID0gdXRpbHMucGFyc2VOdW1iZXIocHJlc2VudCk7XHJcbiAgICAgICAgICAgIGZ1dHVyZSA9IHV0aWxzLnBhcnNlTnVtYmVyKGZ1dHVyZSk7XHJcbiAgICAgICAgICAgIHR5cGUgPSB1dGlscy5wYXJzZU51bWJlcih0eXBlKTtcclxuICAgICAgICAgICAgZ3Vlc3MgPSB1dGlscy5wYXJzZU51bWJlcihndWVzcyk7XHJcbiAgICAgICAgICAgIGlmICh1dGlscy5hbnlJc0Vycm9yKHBlcmlvZHMsIHBheW1lbnQsIHByZXNlbnQsIGZ1dHVyZSwgdHlwZSwgZ3Vlc3MpKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZXJyb3IudmFsdWU7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIFNldCBtYXhpbXVtIGVwc2lsb24gZm9yIGVuZCBvZiBpdGVyYXRpb25cclxuICAgICAgICAgICAgdmFyIGVwc01heCA9IDFlLTY7XHJcblxyXG4gICAgICAgICAgICAvLyBTZXQgbWF4aW11bSBudW1iZXIgb2YgaXRlcmF0aW9uc1xyXG4gICAgICAgICAgICB2YXIgaXRlck1heCA9IDEwMDtcclxuICAgICAgICAgICAgdmFyIGl0ZXIgPSAwO1xyXG4gICAgICAgICAgICB2YXIgY2xvc2UgPSBmYWxzZTtcclxuICAgICAgICAgICAgdmFyIHJhdGUgPSBndWVzcztcclxuXHJcbiAgICAgICAgICAgIHdoaWxlIChpdGVyIDwgaXRlck1heCAmJiAhY2xvc2UpIHtcclxuICAgICAgICAgICAgICAgIHZhciB0MSA9IE1hdGgucG93KHJhdGUgKyAxLCBwZXJpb2RzKTtcclxuICAgICAgICAgICAgICAgIHZhciB0MiA9IE1hdGgucG93KHJhdGUgKyAxLCBwZXJpb2RzIC0gMSk7XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIGYxID0gZnV0dXJlICsgdDEgKiBwcmVzZW50ICsgcGF5bWVudCAqICh0MSAtIDEpICogKHJhdGUgKiB0eXBlICsgMSkgLyByYXRlO1xyXG4gICAgICAgICAgICAgICAgdmFyIGYyID0gcGVyaW9kcyAqIHQyICogcHJlc2VudCAtIHBheW1lbnQgKiAodDEgLSAxKSAqIChyYXRlICogdHlwZSArIDEpIC8gTWF0aC5wb3cocmF0ZSwgMik7XHJcbiAgICAgICAgICAgICAgICB2YXIgZjMgPSBwZXJpb2RzICogcGF5bWVudCAqIHQyICogKHJhdGUgKiB0eXBlICsgMSkgLyByYXRlICsgcGF5bWVudCAqICh0MSAtIDEpICogdHlwZSAvIHJhdGU7XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIG5ld1JhdGUgPSByYXRlIC0gZjEgLyAoZjIgKyBmMyk7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKE1hdGguYWJzKG5ld1JhdGUgLSByYXRlKSA8IGVwc01heCkgY2xvc2UgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgaXRlcisrXHJcbiAgICAgICAgICAgICAgICByYXRlID0gbmV3UmF0ZTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKCFjbG9zZSkgcmV0dXJuIE51bWJlci5OYU4gKyByYXRlO1xyXG4gICAgICAgICAgICByZXR1cm4gcmF0ZTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAvLyBUT0RPXHJcbiAgICAgICAgZXhwb3J0cy5SRUNFSVZFRCA9IG51bGw7XHJcblxyXG4gICAgICAgIGV4cG9ydHMuUlJJID0gZnVuY3Rpb24gKHBlcmlvZHMsIHByZXNlbnQsIGZ1dHVyZSkge1xyXG4gICAgICAgICAgICBwZXJpb2RzID0gdXRpbHMucGFyc2VOdW1iZXIocGVyaW9kcyk7XHJcbiAgICAgICAgICAgIHByZXNlbnQgPSB1dGlscy5wYXJzZU51bWJlcihwcmVzZW50KTtcclxuICAgICAgICAgICAgZnV0dXJlID0gdXRpbHMucGFyc2VOdW1iZXIoZnV0dXJlKTtcclxuICAgICAgICAgICAgaWYgKHV0aWxzLmFueUlzRXJyb3IocGVyaW9kcywgcHJlc2VudCwgZnV0dXJlKSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGVycm9yLnZhbHVlO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBSZXR1cm4gZXJyb3IgaWYgcGVyaW9kcyBvciBwcmVzZW50IGlzIGVxdWFsIHRvIDAgKHplcm8pXHJcbiAgICAgICAgICAgIGlmIChwZXJpb2RzID09PSAwIHx8IHByZXNlbnQgPT09IDApIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBlcnJvci5udW07XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIFJldHVybiBlcXVpdmFsZW50IGludGVyZXN0IHJhdGVcclxuICAgICAgICAgICAgcmV0dXJuIE1hdGgucG93KGZ1dHVyZSAvIHByZXNlbnQsIDEgLyBwZXJpb2RzKSAtIDE7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZXhwb3J0cy5TTE4gPSBmdW5jdGlvbiAoY29zdCwgc2FsdmFnZSwgbGlmZSkge1xyXG4gICAgICAgICAgICBjb3N0ID0gdXRpbHMucGFyc2VOdW1iZXIoY29zdCk7XHJcbiAgICAgICAgICAgIHNhbHZhZ2UgPSB1dGlscy5wYXJzZU51bWJlcihzYWx2YWdlKTtcclxuICAgICAgICAgICAgbGlmZSA9IHV0aWxzLnBhcnNlTnVtYmVyKGxpZmUpO1xyXG4gICAgICAgICAgICBpZiAodXRpbHMuYW55SXNFcnJvcihjb3N0LCBzYWx2YWdlLCBsaWZlKSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGVycm9yLnZhbHVlO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBSZXR1cm4gZXJyb3IgaWYgbGlmZSBlcXVhbCB0byAwICh6ZXJvKVxyXG4gICAgICAgICAgICBpZiAobGlmZSA9PT0gMCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGVycm9yLm51bTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gUmV0dXJuIHN0cmFpZ2h0LWxpbmUgZGVwcmVjaWF0aW9uXHJcbiAgICAgICAgICAgIHJldHVybiAoY29zdCAtIHNhbHZhZ2UpIC8gbGlmZTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBleHBvcnRzLlNZRCA9IGZ1bmN0aW9uIChjb3N0LCBzYWx2YWdlLCBsaWZlLCBwZXJpb2QpIHtcclxuICAgICAgICAgICAgLy8gUmV0dXJuIGVycm9yIGlmIGFueSBvZiB0aGUgcGFyYW1ldGVycyBpcyBub3QgYSBudW1iZXJcclxuICAgICAgICAgICAgY29zdCA9IHV0aWxzLnBhcnNlTnVtYmVyKGNvc3QpO1xyXG4gICAgICAgICAgICBzYWx2YWdlID0gdXRpbHMucGFyc2VOdW1iZXIoc2FsdmFnZSk7XHJcbiAgICAgICAgICAgIGxpZmUgPSB1dGlscy5wYXJzZU51bWJlcihsaWZlKTtcclxuICAgICAgICAgICAgcGVyaW9kID0gdXRpbHMucGFyc2VOdW1iZXIocGVyaW9kKTtcclxuICAgICAgICAgICAgaWYgKHV0aWxzLmFueUlzRXJyb3IoY29zdCwgc2FsdmFnZSwgbGlmZSwgcGVyaW9kKSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGVycm9yLnZhbHVlO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBSZXR1cm4gZXJyb3IgaWYgbGlmZSBlcXVhbCB0byAwICh6ZXJvKVxyXG4gICAgICAgICAgICBpZiAobGlmZSA9PT0gMCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGVycm9yLm51bTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gUmV0dXJuIGVycm9yIGlmIHBlcmlvZCBpcyBsb3dlciB0aGFuIDEgb3IgZ3JlYXRlciB0aGFuIGxpZmVcclxuICAgICAgICAgICAgaWYgKHBlcmlvZCA8IDEgfHwgcGVyaW9kID4gbGlmZSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGVycm9yLm51bTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gVHJ1bmNhdGUgcGVyaW9kIGlmIGl0IGlzIG5vdCBhbiBpbnRlZ2VyXHJcbiAgICAgICAgICAgIHBlcmlvZCA9IHBhcnNlSW50KHBlcmlvZCwgMTApO1xyXG5cclxuICAgICAgICAgICAgLy8gUmV0dXJuIHN0cmFpZ2h0LWxpbmUgZGVwcmVjaWF0aW9uXHJcbiAgICAgICAgICAgIHJldHVybiAoKGNvc3QgLSBzYWx2YWdlKSAqIChsaWZlIC0gcGVyaW9kICsgMSkgKiAyKSAvIChsaWZlICogKGxpZmUgKyAxKSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZXhwb3J0cy5UQklMTEVRID0gZnVuY3Rpb24gKHNldHRsZW1lbnQsIG1hdHVyaXR5LCBkaXNjb3VudCkge1xyXG4gICAgICAgICAgICBzZXR0bGVtZW50ID0gdXRpbHMucGFyc2VEYXRlKHNldHRsZW1lbnQpO1xyXG4gICAgICAgICAgICBtYXR1cml0eSA9IHV0aWxzLnBhcnNlRGF0ZShtYXR1cml0eSk7XHJcbiAgICAgICAgICAgIGRpc2NvdW50ID0gdXRpbHMucGFyc2VOdW1iZXIoZGlzY291bnQpO1xyXG4gICAgICAgICAgICBpZiAodXRpbHMuYW55SXNFcnJvcihzZXR0bGVtZW50LCBtYXR1cml0eSwgZGlzY291bnQpKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZXJyb3IudmFsdWU7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIFJldHVybiBlcnJvciBpZiBkaXNjb3VudCBpcyBsb3dlciB0aGFuIG9yIGVxdWFsIHRvIHplcm9cclxuICAgICAgICAgICAgaWYgKGRpc2NvdW50IDw9IDApIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBlcnJvci5udW07XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIFJldHVybiBlcnJvciBpZiBzZXR0bGVtZW50IGlzIGdyZWF0ZXIgdGhhbiBtYXR1cml0eVxyXG4gICAgICAgICAgICBpZiAoc2V0dGxlbWVudCA+IG1hdHVyaXR5KSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZXJyb3IubnVtO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBSZXR1cm4gZXJyb3IgaWYgbWF0dXJpdHkgaXMgbW9yZSB0aGFuIG9uZSB5ZWFyIGFmdGVyIHNldHRsZW1lbnRcclxuICAgICAgICAgICAgaWYgKG1hdHVyaXR5IC0gc2V0dGxlbWVudCA+IDM2NSAqIDI0ICogNjAgKiA2MCAqIDEwMDApIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBlcnJvci5udW07XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIFJldHVybiBib25kLWVxdWl2YWxlbnQgeWllbGRcclxuICAgICAgICAgICAgcmV0dXJuICgzNjUgKiBkaXNjb3VudCkgLyAoMzYwIC0gZGlzY291bnQgKiBEQVlTMzYwKHNldHRsZW1lbnQsIG1hdHVyaXR5LCBmYWxzZSkpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGV4cG9ydHMuVEJJTExQUklDRSA9IGZ1bmN0aW9uIChzZXR0bGVtZW50LCBtYXR1cml0eSwgZGlzY291bnQpIHtcclxuICAgICAgICAgICAgc2V0dGxlbWVudCA9IHV0aWxzLnBhcnNlRGF0ZShzZXR0bGVtZW50KTtcclxuICAgICAgICAgICAgbWF0dXJpdHkgPSB1dGlscy5wYXJzZURhdGUobWF0dXJpdHkpO1xyXG4gICAgICAgICAgICBkaXNjb3VudCA9IHV0aWxzLnBhcnNlTnVtYmVyKGRpc2NvdW50KTtcclxuICAgICAgICAgICAgaWYgKHV0aWxzLmFueUlzRXJyb3Ioc2V0dGxlbWVudCwgbWF0dXJpdHksIGRpc2NvdW50KSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGVycm9yLnZhbHVlO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBSZXR1cm4gZXJyb3IgaWYgZGlzY291bnQgaXMgbG93ZXIgdGhhbiBvciBlcXVhbCB0byB6ZXJvXHJcbiAgICAgICAgICAgIGlmIChkaXNjb3VudCA8PSAwKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZXJyb3IubnVtO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBSZXR1cm4gZXJyb3IgaWYgc2V0dGxlbWVudCBpcyBncmVhdGVyIHRoYW4gbWF0dXJpdHlcclxuICAgICAgICAgICAgaWYgKHNldHRsZW1lbnQgPiBtYXR1cml0eSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGVycm9yLm51bTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gUmV0dXJuIGVycm9yIGlmIG1hdHVyaXR5IGlzIG1vcmUgdGhhbiBvbmUgeWVhciBhZnRlciBzZXR0bGVtZW50XHJcbiAgICAgICAgICAgIGlmIChtYXR1cml0eSAtIHNldHRsZW1lbnQgPiAzNjUgKiAyNCAqIDYwICogNjAgKiAxMDAwKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZXJyb3IubnVtO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBSZXR1cm4gYm9uZC1lcXVpdmFsZW50IHlpZWxkXHJcbiAgICAgICAgICAgIHJldHVybiAxMDAgKiAoMSAtIGRpc2NvdW50ICogREFZUzM2MChzZXR0bGVtZW50LCBtYXR1cml0eSwgZmFsc2UpIC8gMzYwKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBleHBvcnRzLlRCSUxMWUlFTEQgPSBmdW5jdGlvbiAoc2V0dGxlbWVudCwgbWF0dXJpdHksIHByaWNlKSB7XHJcbiAgICAgICAgICAgIHNldHRsZW1lbnQgPSB1dGlscy5wYXJzZURhdGUoc2V0dGxlbWVudCk7XHJcbiAgICAgICAgICAgIG1hdHVyaXR5ID0gdXRpbHMucGFyc2VEYXRlKG1hdHVyaXR5KTtcclxuICAgICAgICAgICAgcHJpY2UgPSB1dGlscy5wYXJzZU51bWJlcihwcmljZSk7XHJcbiAgICAgICAgICAgIGlmICh1dGlscy5hbnlJc0Vycm9yKHNldHRsZW1lbnQsIG1hdHVyaXR5LCBwcmljZSkpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBlcnJvci52YWx1ZTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gUmV0dXJuIGVycm9yIGlmIHByaWNlIGlzIGxvd2VyIHRoYW4gb3IgZXF1YWwgdG8gemVyb1xyXG4gICAgICAgICAgICBpZiAocHJpY2UgPD0gMCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGVycm9yLm51bTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gUmV0dXJuIGVycm9yIGlmIHNldHRsZW1lbnQgaXMgZ3JlYXRlciB0aGFuIG1hdHVyaXR5XHJcbiAgICAgICAgICAgIGlmIChzZXR0bGVtZW50ID4gbWF0dXJpdHkpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBlcnJvci5udW07XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIFJldHVybiBlcnJvciBpZiBtYXR1cml0eSBpcyBtb3JlIHRoYW4gb25lIHllYXIgYWZ0ZXIgc2V0dGxlbWVudFxyXG4gICAgICAgICAgICBpZiAobWF0dXJpdHkgLSBzZXR0bGVtZW50ID4gMzY1ICogMjQgKiA2MCAqIDYwICogMTAwMCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGVycm9yLm51bTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gUmV0dXJuIGJvbmQtZXF1aXZhbGVudCB5aWVsZFxyXG4gICAgICAgICAgICByZXR1cm4gKDEwMCAtIHByaWNlKSAqIDM2MCAvIChwcmljZSAqIERBWVMzNjAoc2V0dGxlbWVudCwgbWF0dXJpdHksIGZhbHNlKSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZXhwb3J0cy5WREIgPSBudWxsO1xyXG5cclxuICAgICAgICBleHBvcnRzLlhJUlIgPSBmdW5jdGlvbiAodmFsdWVzLCBkYXRlcywgZ3Vlc3MpIHtcclxuICAgICAgICAgICAgLy8gQ3JlZGl0czogYWxnb3JpdGhtIGluc3BpcmVkIGJ5IEFwYWNoZSBPcGVuT2ZmaWNlXHJcblxyXG4gICAgICAgICAgICB2YWx1ZXMgPSB1dGlscy5wYXJzZU51bWJlckFycmF5KHV0aWxzLmZsYXR0ZW4odmFsdWVzKSk7XHJcbiAgICAgICAgICAgIGRhdGVzID0gdXRpbHMucGFyc2VEYXRlQXJyYXkodXRpbHMuZmxhdHRlbihkYXRlcykpO1xyXG4gICAgICAgICAgICBndWVzcyA9IHV0aWxzLnBhcnNlTnVtYmVyKGd1ZXNzKTtcclxuICAgICAgICAgICAgaWYgKHV0aWxzLmFueUlzRXJyb3IodmFsdWVzLCBkYXRlcywgZ3Vlc3MpKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZXJyb3IudmFsdWU7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIENhbGN1bGF0ZXMgdGhlIHJlc3VsdGluZyBhbW91bnRcclxuICAgICAgICAgICAgdmFyIGlyclJlc3VsdCA9IGZ1bmN0aW9uICh2YWx1ZXMsIGRhdGVzLCByYXRlKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgciA9IHJhdGUgKyAxO1xyXG4gICAgICAgICAgICAgICAgdmFyIHJlc3VsdCA9IHZhbHVlc1swXTtcclxuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAxOyBpIDwgdmFsdWVzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0ICs9IHZhbHVlc1tpXSAvIE1hdGgucG93KHIsIERBWVMoZGF0ZXNbaV0sIGRhdGVzWzBdKSAvIDM2NSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgLy8gQ2FsY3VsYXRlcyB0aGUgZmlyc3QgZGVyaXZhdGlvblxyXG4gICAgICAgICAgICB2YXIgaXJyUmVzdWx0RGVyaXYgPSBmdW5jdGlvbiAodmFsdWVzLCBkYXRlcywgcmF0ZSkge1xyXG4gICAgICAgICAgICAgICAgdmFyIHIgPSByYXRlICsgMTtcclxuICAgICAgICAgICAgICAgIHZhciByZXN1bHQgPSAwO1xyXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDE7IGkgPCB2YWx1ZXMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgZnJhYyA9IERBWVMoZGF0ZXNbaV0sIGRhdGVzWzBdKSAvIDM2NTtcclxuICAgICAgICAgICAgICAgICAgICByZXN1bHQgLT0gZnJhYyAqIHZhbHVlc1tpXSAvIE1hdGgucG93KHIsIGZyYWMgKyAxKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XHJcbiAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAvLyBDaGVjayB0aGF0IHZhbHVlcyBjb250YWlucyBhdCBsZWFzdCBvbmUgcG9zaXRpdmUgdmFsdWUgYW5kIG9uZVxyXG4gICAgICAgICAgICAvLyBuZWdhdGl2ZSB2YWx1ZVxyXG4gICAgICAgICAgICB2YXIgcG9zaXRpdmUgPSBmYWxzZTtcclxuICAgICAgICAgICAgdmFyIG5lZ2F0aXZlID0gZmFsc2U7XHJcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdmFsdWVzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAodmFsdWVzW2ldID4gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHBvc2l0aXZlID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmICh2YWx1ZXNbaV0gPCAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbmVnYXRpdmUgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBSZXR1cm4gZXJyb3IgaWYgdmFsdWVzIGRvZXMgbm90IGNvbnRhaW4gYXQgbGVhc3Qgb25lIHBvc2l0aXZlIHZhbHVlXHJcbiAgICAgICAgICAgIC8vIGFuZCBvbmUgbmVnYXRpdmUgdmFsdWVcclxuICAgICAgICAgICAgaWYgKCFwb3NpdGl2ZSB8fCAhbmVnYXRpdmUpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBlcnJvci5udW07XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIEluaXRpYWxpemUgZ3Vlc3MgYW5kIHJlc3VsdFJhdGVcclxuICAgICAgICAgICAgZ3Vlc3MgPSBndWVzcyB8fCAwLjE7XHJcbiAgICAgICAgICAgIHZhciByZXN1bHRSYXRlID0gZ3Vlc3M7XHJcblxyXG4gICAgICAgICAgICAvLyBTZXQgbWF4aW11bSBlcHNpbG9uIGZvciBlbmQgb2YgaXRlcmF0aW9uXHJcbiAgICAgICAgICAgIHZhciBlcHNNYXggPSAxZS0xMDtcclxuXHJcbiAgICAgICAgICAgIC8vIEltcGxlbWVudCBOZXd0b24ncyBtZXRob2RcclxuICAgICAgICAgICAgdmFyIG5ld1JhdGUsIGVwc1JhdGUsIHJlc3VsdFZhbHVlO1xyXG4gICAgICAgICAgICB2YXIgY29udExvb3AgPSB0cnVlO1xyXG4gICAgICAgICAgICBkbyB7XHJcbiAgICAgICAgICAgICAgICByZXN1bHRWYWx1ZSA9IGlyclJlc3VsdCh2YWx1ZXMsIGRhdGVzLCByZXN1bHRSYXRlKTtcclxuICAgICAgICAgICAgICAgIG5ld1JhdGUgPSByZXN1bHRSYXRlIC0gcmVzdWx0VmFsdWUgLyBpcnJSZXN1bHREZXJpdih2YWx1ZXMsIGRhdGVzLCByZXN1bHRSYXRlKTtcclxuICAgICAgICAgICAgICAgIGVwc1JhdGUgPSBNYXRoLmFicyhuZXdSYXRlIC0gcmVzdWx0UmF0ZSk7XHJcbiAgICAgICAgICAgICAgICByZXN1bHRSYXRlID0gbmV3UmF0ZTtcclxuICAgICAgICAgICAgICAgIGNvbnRMb29wID0gKGVwc1JhdGUgPiBlcHNNYXgpICYmIChNYXRoLmFicyhyZXN1bHRWYWx1ZSkgPiBlcHNNYXgpO1xyXG4gICAgICAgICAgICB9IHdoaWxlIChjb250TG9vcCk7XHJcblxyXG4gICAgICAgICAgICAvLyBSZXR1cm4gaW50ZXJuYWwgcmF0ZSBvZiByZXR1cm5cclxuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdFJhdGU7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZXhwb3J0cy5YTlBWID0gZnVuY3Rpb24gKHJhdGUsIHZhbHVlcywgZGF0ZXMpIHtcclxuICAgICAgICAgICAgcmF0ZSA9IHV0aWxzLnBhcnNlTnVtYmVyKHJhdGUpO1xyXG4gICAgICAgICAgICB2YWx1ZXMgPSB1dGlscy5wYXJzZU51bWJlckFycmF5KHV0aWxzLmZsYXR0ZW4odmFsdWVzKSk7XHJcbiAgICAgICAgICAgIGRhdGVzID0gdXRpbHMucGFyc2VEYXRlQXJyYXkodXRpbHMuZmxhdHRlbihkYXRlcykpO1xyXG4gICAgICAgICAgICBpZiAodXRpbHMuYW55SXNFcnJvcihyYXRlLCB2YWx1ZXMsIGRhdGVzKSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGVycm9yLnZhbHVlO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB2YXIgcmVzdWx0ID0gMDtcclxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB2YWx1ZXMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgIHJlc3VsdCArPSB2YWx1ZXNbaV0gLyBNYXRoLnBvdygxICsgcmF0ZSwgREFZUyhkYXRlc1tpXSwgZGF0ZXNbMF0pIC8gMzY1KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGV4cG9ydHMuWUlFTEQgPSBudWxsO1xyXG5cclxuICAgICAgICBleHBvcnRzLllJRUxERElTQyA9IG51bGw7XHJcblxyXG4gICAgICAgIGV4cG9ydHMuWUlFTERNQVQgPSBudWxsO1xyXG5cclxuICAgICAgICByZXR1cm4gZXhwb3J0cztcclxuICAgIH0pKCk7XHJcblxyXG4gICAgamV4Y2VsLm1ldGhvZHMuaW5mb3JtYXRpb24gPSAoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHZhciBleHBvcnRzID0ge307XHJcbiAgICAgICAgZXhwb3J0cy5DRUxMID0gbnVsbDtcclxuXHJcbiAgICAgICAgZXhwb3J0cy5FUlJPUiA9IHt9O1xyXG4gICAgICAgIGV4cG9ydHMuRVJST1IuVFlQRSA9IGZ1bmN0aW9uIChlcnJvcl92YWwpIHtcclxuICAgICAgICAgICAgc3dpdGNoIChlcnJvcl92YWwpIHtcclxuICAgICAgICAgICAgICAgIGNhc2UgZXJyb3IubmlsOlxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAxO1xyXG4gICAgICAgICAgICAgICAgY2FzZSBlcnJvci5kaXYwOlxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAyO1xyXG4gICAgICAgICAgICAgICAgY2FzZSBlcnJvci52YWx1ZTpcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gMztcclxuICAgICAgICAgICAgICAgIGNhc2UgZXJyb3IucmVmOlxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiA0O1xyXG4gICAgICAgICAgICAgICAgY2FzZSBlcnJvci5uYW1lOlxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiA1O1xyXG4gICAgICAgICAgICAgICAgY2FzZSBlcnJvci5udW06XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDY7XHJcbiAgICAgICAgICAgICAgICBjYXNlIGVycm9yLm5hOlxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiA3O1xyXG4gICAgICAgICAgICAgICAgY2FzZSBlcnJvci5kYXRhOlxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiA4O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBlcnJvci5uYTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBleHBvcnRzLklORk8gPSBudWxsO1xyXG5cclxuICAgICAgICBleHBvcnRzLklTQkxBTksgPSBmdW5jdGlvbiAodmFsdWUpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHZhbHVlID09PSBudWxsO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGV4cG9ydHMuSVNCSU5BUlkgPSBmdW5jdGlvbiAobnVtYmVyKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAoL15bMDFdezEsMTB9JC8pLnRlc3QobnVtYmVyKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBleHBvcnRzLklTRVJSID0gZnVuY3Rpb24gKHZhbHVlKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAoW2Vycm9yLnZhbHVlLCBlcnJvci5yZWYsIGVycm9yLmRpdjAsIGVycm9yLm51bSwgZXJyb3IubmFtZSwgZXJyb3IubmlsXSkuaW5kZXhPZih2YWx1ZSkgPj0gMCB8fFxyXG4gICAgICAgICAgICAgICAgKHR5cGVvZiB2YWx1ZSA9PT0gJ251bWJlcicgJiYgKGlzTmFOKHZhbHVlKSB8fCAhaXNGaW5pdGUodmFsdWUpKSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZXhwb3J0cy5JU0VSUk9SID0gZnVuY3Rpb24gKHZhbHVlKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBleHBvcnRzLklTRVJSKHZhbHVlKSB8fCB2YWx1ZSA9PT0gZXJyb3IubmE7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZXhwb3J0cy5JU0VWRU4gPSBmdW5jdGlvbiAobnVtYmVyKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAoTWF0aC5mbG9vcihNYXRoLmFicyhudW1iZXIpKSAmIDEpID8gZmFsc2UgOiB0cnVlO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIC8vIFRPRE9cclxuICAgICAgICBleHBvcnRzLklTRk9STVVMQSA9IG51bGw7XHJcblxyXG4gICAgICAgIGV4cG9ydHMuSVNMT0dJQ0FMID0gZnVuY3Rpb24gKHZhbHVlKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB2YWx1ZSA9PT0gdHJ1ZSB8fCB2YWx1ZSA9PT0gZmFsc2U7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZXhwb3J0cy5JU05BID0gZnVuY3Rpb24gKHZhbHVlKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB2YWx1ZSA9PT0gZXJyb3IubmE7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZXhwb3J0cy5JU05PTlRFWFQgPSBmdW5jdGlvbiAodmFsdWUpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHR5cGVvZiAodmFsdWUpICE9PSAnc3RyaW5nJztcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBleHBvcnRzLklTTlVNQkVSID0gZnVuY3Rpb24gKHZhbHVlKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0eXBlb2YgKHZhbHVlKSA9PT0gJ251bWJlcicgJiYgIWlzTmFOKHZhbHVlKSAmJiBpc0Zpbml0ZSh2YWx1ZSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZXhwb3J0cy5JU09ERCA9IGZ1bmN0aW9uIChudW1iZXIpIHtcclxuICAgICAgICAgICAgcmV0dXJuIChNYXRoLmZsb29yKE1hdGguYWJzKG51bWJlcikpICYgMSkgPyB0cnVlIDogZmFsc2U7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZXhwb3J0cy5JU1JFRiA9IG51bGw7XHJcblxyXG4gICAgICAgIGV4cG9ydHMuSVNURVhUID0gZnVuY3Rpb24gKHZhbHVlKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0eXBlb2YgKHZhbHVlKSA9PT0gJ3N0cmluZyc7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZXhwb3J0cy5OID0gZnVuY3Rpb24gKHZhbHVlKSB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLklTTlVNQkVSKHZhbHVlKSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHZhbHVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICh2YWx1ZSBpbnN0YW5jZW9mIERhdGUpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB2YWx1ZS5nZXRUaW1lKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKHZhbHVlID09PSB0cnVlKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gMTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAodmFsdWUgPT09IGZhbHNlKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gMDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAodGhpcy5JU0VSUk9SKHZhbHVlKSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHZhbHVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiAwO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGV4cG9ydHMuTkEgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBlcnJvci5uYTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBleHBvcnRzLlNIRUVUID0gbnVsbDtcclxuXHJcbiAgICAgICAgZXhwb3J0cy5TSEVFVFMgPSBudWxsO1xyXG5cclxuICAgICAgICBleHBvcnRzLlRZUEUgPSBmdW5jdGlvbiAodmFsdWUpIHtcclxuICAgICAgICAgICAgaWYgKHRoaXMuSVNOVU1CRVIodmFsdWUpKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gMTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAodGhpcy5JU1RFWFQodmFsdWUpKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gMjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAodGhpcy5JU0xPR0lDQUwodmFsdWUpKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gNDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAodGhpcy5JU0VSUk9SKHZhbHVlKSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIDE2O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChBcnJheS5pc0FycmF5KHZhbHVlKSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIDY0O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgcmV0dXJuIGV4cG9ydHM7XHJcbiAgICB9KSgpO1xyXG5cclxuICAgIGpleGNlbC5tZXRob2RzLmxvZ2ljYWwgPSAoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHZhciBleHBvcnRzID0ge307XHJcblxyXG4gICAgICAgIGV4cG9ydHMuQU5EID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICB2YXIgYXJncyA9IHV0aWxzLmZsYXR0ZW4oYXJndW1lbnRzKTtcclxuICAgICAgICAgICAgdmFyIHJlc3VsdCA9IHRydWU7XHJcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgYXJncy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgaWYgKCFhcmdzW2ldKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBleHBvcnRzLkNIT09TRSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPCAyKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZXJyb3IubmE7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHZhciBpbmRleCA9IGFyZ3VtZW50c1swXTtcclxuICAgICAgICAgICAgaWYgKGluZGV4IDwgMSB8fCBpbmRleCA+IDI1NCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGVycm9yLnZhbHVlO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA8IGluZGV4ICsgMSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGVycm9yLnZhbHVlO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gYXJndW1lbnRzW2luZGV4XTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBleHBvcnRzLkZBTFNFID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZXhwb3J0cy5JRiA9IGZ1bmN0aW9uICh0ZXN0LCB0aGVuX3ZhbHVlLCBvdGhlcndpc2VfdmFsdWUpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRlc3QgPyB0aGVuX3ZhbHVlIDogb3RoZXJ3aXNlX3ZhbHVlO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGV4cG9ydHMuSUZFUlJPUiA9IGZ1bmN0aW9uICh2YWx1ZSwgdmFsdWVJZkVycm9yKSB7XHJcbiAgICAgICAgICAgIGlmIChJU0VSUk9SKHZhbHVlKSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHZhbHVlSWZFcnJvcjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gdmFsdWU7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZXhwb3J0cy5JRk5BID0gZnVuY3Rpb24gKHZhbHVlLCB2YWx1ZV9pZl9uYSkge1xyXG4gICAgICAgICAgICByZXR1cm4gdmFsdWUgPT09IGVycm9yLm5hID8gdmFsdWVfaWZfbmEgOiB2YWx1ZTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBleHBvcnRzLk5PVCA9IGZ1bmN0aW9uIChsb2dpY2FsKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAhbG9naWNhbDtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBleHBvcnRzLk9SID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICB2YXIgYXJncyA9IHV0aWxzLmZsYXR0ZW4oYXJndW1lbnRzKTtcclxuICAgICAgICAgICAgdmFyIHJlc3VsdCA9IGZhbHNlO1xyXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGFyZ3MubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgIGlmIChhcmdzW2ldKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGV4cG9ydHMuVFJVRSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZXhwb3J0cy5YT1IgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHZhciBhcmdzID0gdXRpbHMuZmxhdHRlbihhcmd1bWVudHMpO1xyXG4gICAgICAgICAgICB2YXIgcmVzdWx0ID0gMDtcclxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBhcmdzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoYXJnc1tpXSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdCsrO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiAoTWF0aC5mbG9vcihNYXRoLmFicyhyZXN1bHQpKSAmIDEpID8gdHJ1ZSA6IGZhbHNlO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGV4cG9ydHMuU1dJVENIID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICB2YXIgcmVzdWx0O1xyXG4gICAgICAgICAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgIHZhciB0YXJnZXRWYWx1ZSA9IGFyZ3VtZW50c1swXTtcclxuICAgICAgICAgICAgICAgIHZhciBhcmdjID0gYXJndW1lbnRzLmxlbmd0aCAtIDE7XHJcbiAgICAgICAgICAgICAgICB2YXIgc3dpdGNoQ291bnQgPSBNYXRoLmZsb29yKGFyZ2MgLyAyKTtcclxuICAgICAgICAgICAgICAgIHZhciBzd2l0Y2hTYXRpc2ZpZWQgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIHZhciBkZWZhdWx0Q2xhdXNlID0gYXJnYyAlIDIgPT09IDAgPyBudWxsIDogYXJndW1lbnRzW2FyZ3VtZW50cy5sZW5ndGggLSAxXTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoc3dpdGNoQ291bnQpIHtcclxuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpbmRleCA9IDA7IGluZGV4IDwgc3dpdGNoQ291bnQ7IGluZGV4KyspIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRhcmdldFZhbHVlID09PSBhcmd1bWVudHNbaW5kZXggKiAyICsgMV0pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IGFyZ3VtZW50c1tpbmRleCAqIDIgKyAyXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN3aXRjaFNhdGlzZmllZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoIXN3aXRjaFNhdGlzZmllZCAmJiBkZWZhdWx0Q2xhdXNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gZGVmYXVsdENsYXVzZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICByZXR1cm4gZXhwb3J0cztcclxuICAgIH0pKCk7XHJcblxyXG4gICAgamV4Y2VsLm1ldGhvZHMubWF0aCA9IChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdmFyIGV4cG9ydHMgPSB7fTtcclxuXHJcbiAgICAgICAgZXhwb3J0cy5BQlMgPSBmdW5jdGlvbiAobnVtYmVyKSB7XHJcbiAgICAgICAgICAgIG51bWJlciA9IHV0aWxzLnBhcnNlTnVtYmVyKG51bWJlcik7XHJcbiAgICAgICAgICAgIGlmIChudW1iZXIgaW5zdGFuY2VvZiBFcnJvcikge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG51bWJlcjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gTWF0aC5hYnModXRpbHMucGFyc2VOdW1iZXIobnVtYmVyKSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZXhwb3J0cy5BQ09TID0gZnVuY3Rpb24gKG51bWJlcikge1xyXG4gICAgICAgICAgICBudW1iZXIgPSB1dGlscy5wYXJzZU51bWJlcihudW1iZXIpO1xyXG4gICAgICAgICAgICBpZiAobnVtYmVyIGluc3RhbmNlb2YgRXJyb3IpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBudW1iZXI7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIE1hdGguYWNvcyhudW1iZXIpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGV4cG9ydHMuQUNPU0ggPSBmdW5jdGlvbiAobnVtYmVyKSB7XHJcbiAgICAgICAgICAgIG51bWJlciA9IHV0aWxzLnBhcnNlTnVtYmVyKG51bWJlcik7XHJcbiAgICAgICAgICAgIGlmIChudW1iZXIgaW5zdGFuY2VvZiBFcnJvcikge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG51bWJlcjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gTWF0aC5sb2cobnVtYmVyICsgTWF0aC5zcXJ0KG51bWJlciAqIG51bWJlciAtIDEpKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBleHBvcnRzLkFDT1QgPSBmdW5jdGlvbiAobnVtYmVyKSB7XHJcbiAgICAgICAgICAgIG51bWJlciA9IHV0aWxzLnBhcnNlTnVtYmVyKG51bWJlcik7XHJcbiAgICAgICAgICAgIGlmIChudW1iZXIgaW5zdGFuY2VvZiBFcnJvcikge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG51bWJlcjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gTWF0aC5hdGFuKDEgLyBudW1iZXIpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGV4cG9ydHMuQUNPVEggPSBmdW5jdGlvbiAobnVtYmVyKSB7XHJcbiAgICAgICAgICAgIG51bWJlciA9IHV0aWxzLnBhcnNlTnVtYmVyKG51bWJlcik7XHJcbiAgICAgICAgICAgIGlmIChudW1iZXIgaW5zdGFuY2VvZiBFcnJvcikge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG51bWJlcjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gMC41ICogTWF0aC5sb2coKG51bWJlciArIDEpIC8gKG51bWJlciAtIDEpKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBleHBvcnRzLkFHR1JFR0FURSA9IG51bGxcclxuXHJcbiAgICAgICAgZXhwb3J0cy5BUkFCSUMgPSBmdW5jdGlvbiAodGV4dCkge1xyXG4gICAgICAgICAgICAvLyBDcmVkaXRzOiBSYWZhPyBLdWthd3NraVxyXG4gICAgICAgICAgICBpZiAoIS9eTSooPzpEP0N7MCwzfXxDW01EXSkoPzpMP1h7MCwzfXxYW0NMXSkoPzpWP0l7MCwzfXxJW1hWXSkkLy50ZXN0KHRleHQpKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZXJyb3IudmFsdWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdmFyIHIgPSAwO1xyXG4gICAgICAgICAgICB0ZXh0LnJlcGxhY2UoL1tNRExWXXxDW01EXT98WFtDTF0/fElbWFZdPy9nLCBmdW5jdGlvbiAoaSkge1xyXG4gICAgICAgICAgICAgICAgciArPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgTTogMTAwMCxcclxuICAgICAgICAgICAgICAgICAgICBDTTogOTAwLFxyXG4gICAgICAgICAgICAgICAgICAgIEQ6IDUwMCxcclxuICAgICAgICAgICAgICAgICAgICBDRDogNDAwLFxyXG4gICAgICAgICAgICAgICAgICAgIEM6IDEwMCxcclxuICAgICAgICAgICAgICAgICAgICBYQzogOTAsXHJcbiAgICAgICAgICAgICAgICAgICAgTDogNTAsXHJcbiAgICAgICAgICAgICAgICAgICAgWEw6IDQwLFxyXG4gICAgICAgICAgICAgICAgICAgIFg6IDEwLFxyXG4gICAgICAgICAgICAgICAgICAgIElYOiA5LFxyXG4gICAgICAgICAgICAgICAgICAgIFY6IDUsXHJcbiAgICAgICAgICAgICAgICAgICAgSVY6IDQsXHJcbiAgICAgICAgICAgICAgICAgICAgSTogMVxyXG4gICAgICAgICAgICAgICAgfVtpXTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIHJldHVybiByO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGV4cG9ydHMuQVNJTiA9IGZ1bmN0aW9uIChudW1iZXIpIHtcclxuICAgICAgICAgICAgbnVtYmVyID0gdXRpbHMucGFyc2VOdW1iZXIobnVtYmVyKTtcclxuICAgICAgICAgICAgaWYgKG51bWJlciBpbnN0YW5jZW9mIEVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbnVtYmVyO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBNYXRoLmFzaW4obnVtYmVyKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBleHBvcnRzLkFTSU5IID0gZnVuY3Rpb24gKG51bWJlcikge1xyXG4gICAgICAgICAgICBudW1iZXIgPSB1dGlscy5wYXJzZU51bWJlcihudW1iZXIpO1xyXG4gICAgICAgICAgICBpZiAobnVtYmVyIGluc3RhbmNlb2YgRXJyb3IpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBudW1iZXI7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIE1hdGgubG9nKG51bWJlciArIE1hdGguc3FydChudW1iZXIgKiBudW1iZXIgKyAxKSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZXhwb3J0cy5BVEFOID0gZnVuY3Rpb24gKG51bWJlcikge1xyXG4gICAgICAgICAgICBudW1iZXIgPSB1dGlscy5wYXJzZU51bWJlcihudW1iZXIpO1xyXG4gICAgICAgICAgICBpZiAobnVtYmVyIGluc3RhbmNlb2YgRXJyb3IpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBudW1iZXI7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIE1hdGguYXRhbihudW1iZXIpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGV4cG9ydHMuQVRBTjIgPSBmdW5jdGlvbiAobnVtYmVyX3gsIG51bWJlcl95KSB7XHJcbiAgICAgICAgICAgIG51bWJlcl94ID0gdXRpbHMucGFyc2VOdW1iZXIobnVtYmVyX3gpO1xyXG4gICAgICAgICAgICBudW1iZXJfeSA9IHV0aWxzLnBhcnNlTnVtYmVyKG51bWJlcl95KTtcclxuICAgICAgICAgICAgaWYgKHV0aWxzLmFueUlzRXJyb3IobnVtYmVyX3gsIG51bWJlcl95KSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGVycm9yLnZhbHVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBNYXRoLmF0YW4yKG51bWJlcl94LCBudW1iZXJfeSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZXhwb3J0cy5BVEFOSCA9IGZ1bmN0aW9uIChudW1iZXIpIHtcclxuICAgICAgICAgICAgbnVtYmVyID0gdXRpbHMucGFyc2VOdW1iZXIobnVtYmVyKTtcclxuICAgICAgICAgICAgaWYgKG51bWJlciBpbnN0YW5jZW9mIEVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbnVtYmVyO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBNYXRoLmxvZygoMSArIG51bWJlcikgLyAoMSAtIG51bWJlcikpIC8gMjtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBleHBvcnRzLkJBU0UgPSBmdW5jdGlvbiAobnVtYmVyLCByYWRpeCwgbWluX2xlbmd0aCkge1xyXG4gICAgICAgICAgICBtaW5fbGVuZ3RoID0gbWluX2xlbmd0aCB8fCAwO1xyXG5cclxuICAgICAgICAgICAgbnVtYmVyID0gdXRpbHMucGFyc2VOdW1iZXIobnVtYmVyKTtcclxuICAgICAgICAgICAgcmFkaXggPSB1dGlscy5wYXJzZU51bWJlcihyYWRpeCk7XHJcbiAgICAgICAgICAgIG1pbl9sZW5ndGggPSB1dGlscy5wYXJzZU51bWJlcihtaW5fbGVuZ3RoKTtcclxuICAgICAgICAgICAgaWYgKHV0aWxzLmFueUlzRXJyb3IobnVtYmVyLCByYWRpeCwgbWluX2xlbmd0aCkpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBlcnJvci52YWx1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBtaW5fbGVuZ3RoID0gKG1pbl9sZW5ndGggPT09IHVuZGVmaW5lZCkgPyAwIDogbWluX2xlbmd0aDtcclxuICAgICAgICAgICAgdmFyIHJlc3VsdCA9IG51bWJlci50b1N0cmluZyhyYWRpeCk7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgQXJyYXkoTWF0aC5tYXgobWluX2xlbmd0aCArIDEgLSByZXN1bHQubGVuZ3RoLCAwKSkuam9pbignMCcpICsgcmVzdWx0O1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGV4cG9ydHMuQ0VJTElORyA9IGZ1bmN0aW9uIChudW1iZXIsIHNpZ25pZmljYW5jZSwgbW9kZSkge1xyXG4gICAgICAgICAgICBzaWduaWZpY2FuY2UgPSAoc2lnbmlmaWNhbmNlID09PSB1bmRlZmluZWQpID8gMSA6IHNpZ25pZmljYW5jZTtcclxuICAgICAgICAgICAgbW9kZSA9IChtb2RlID09PSB1bmRlZmluZWQpID8gMCA6IG1vZGU7XHJcblxyXG4gICAgICAgICAgICBudW1iZXIgPSB1dGlscy5wYXJzZU51bWJlcihudW1iZXIpO1xyXG4gICAgICAgICAgICBzaWduaWZpY2FuY2UgPSB1dGlscy5wYXJzZU51bWJlcihzaWduaWZpY2FuY2UpO1xyXG4gICAgICAgICAgICBtb2RlID0gdXRpbHMucGFyc2VOdW1iZXIobW9kZSk7XHJcbiAgICAgICAgICAgIGlmICh1dGlscy5hbnlJc0Vycm9yKG51bWJlciwgc2lnbmlmaWNhbmNlLCBtb2RlKSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGVycm9yLnZhbHVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChzaWduaWZpY2FuY2UgPT09IDApIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiAwO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBzaWduaWZpY2FuY2UgPSBNYXRoLmFicyhzaWduaWZpY2FuY2UpO1xyXG4gICAgICAgICAgICBpZiAobnVtYmVyID49IDApIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBNYXRoLmNlaWwobnVtYmVyIC8gc2lnbmlmaWNhbmNlKSAqIHNpZ25pZmljYW5jZTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGlmIChtb2RlID09PSAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIC0xICogTWF0aC5mbG9vcihNYXRoLmFicyhudW1iZXIpIC8gc2lnbmlmaWNhbmNlKSAqIHNpZ25pZmljYW5jZTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIC0xICogTWF0aC5jZWlsKE1hdGguYWJzKG51bWJlcikgLyBzaWduaWZpY2FuY2UpICogc2lnbmlmaWNhbmNlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZXhwb3J0cy5DRUlMSU5HLk1BVEggPSBleHBvcnRzLkNFSUxJTkc7XHJcblxyXG4gICAgICAgIGV4cG9ydHMuQ0VJTElORy5QUkVDSVNFID0gZXhwb3J0cy5DRUlMSU5HO1xyXG5cclxuICAgICAgICBleHBvcnRzLkNPTUJJTiA9IGZ1bmN0aW9uIChudW1iZXIsIG51bWJlcl9jaG9zZW4pIHtcclxuICAgICAgICAgICAgbnVtYmVyID0gdXRpbHMucGFyc2VOdW1iZXIobnVtYmVyKTtcclxuICAgICAgICAgICAgbnVtYmVyX2Nob3NlbiA9IHV0aWxzLnBhcnNlTnVtYmVyKG51bWJlcl9jaG9zZW4pO1xyXG4gICAgICAgICAgICBpZiAodXRpbHMuYW55SXNFcnJvcihudW1iZXIsIG51bWJlcl9jaG9zZW4pKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZXJyb3IudmFsdWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIGV4cG9ydHMuRkFDVChudW1iZXIpIC8gKGV4cG9ydHMuRkFDVChudW1iZXJfY2hvc2VuKSAqIGV4cG9ydHMuRkFDVChudW1iZXIgLSBudW1iZXJfY2hvc2VuKSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZXhwb3J0cy5DT01CSU5BID0gZnVuY3Rpb24gKG51bWJlciwgbnVtYmVyX2Nob3Nlbikge1xyXG4gICAgICAgICAgICBudW1iZXIgPSB1dGlscy5wYXJzZU51bWJlcihudW1iZXIpO1xyXG4gICAgICAgICAgICBudW1iZXJfY2hvc2VuID0gdXRpbHMucGFyc2VOdW1iZXIobnVtYmVyX2Nob3Nlbik7XHJcbiAgICAgICAgICAgIGlmICh1dGlscy5hbnlJc0Vycm9yKG51bWJlciwgbnVtYmVyX2Nob3NlbikpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBlcnJvci52YWx1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gKG51bWJlciA9PT0gMCAmJiBudW1iZXJfY2hvc2VuID09PSAwKSA/IDEgOiBleHBvcnRzLkNPTUJJTihudW1iZXIgKyBudW1iZXJfY2hvc2VuIC0gMSwgbnVtYmVyIC0gMSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZXhwb3J0cy5DT1MgPSBmdW5jdGlvbiAobnVtYmVyKSB7XHJcbiAgICAgICAgICAgIG51bWJlciA9IHV0aWxzLnBhcnNlTnVtYmVyKG51bWJlcik7XHJcbiAgICAgICAgICAgIGlmIChudW1iZXIgaW5zdGFuY2VvZiBFcnJvcikge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG51bWJlcjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gTWF0aC5jb3MobnVtYmVyKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBleHBvcnRzLkNPU0ggPSBmdW5jdGlvbiAobnVtYmVyKSB7XHJcbiAgICAgICAgICAgIG51bWJlciA9IHV0aWxzLnBhcnNlTnVtYmVyKG51bWJlcik7XHJcbiAgICAgICAgICAgIGlmIChudW1iZXIgaW5zdGFuY2VvZiBFcnJvcikge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG51bWJlcjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gKE1hdGguZXhwKG51bWJlcikgKyBNYXRoLmV4cCgtbnVtYmVyKSkgLyAyO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGV4cG9ydHMuQ09UID0gZnVuY3Rpb24gKG51bWJlcikge1xyXG4gICAgICAgICAgICBudW1iZXIgPSB1dGlscy5wYXJzZU51bWJlcihudW1iZXIpO1xyXG4gICAgICAgICAgICBpZiAobnVtYmVyIGluc3RhbmNlb2YgRXJyb3IpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBudW1iZXI7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIDEgLyBNYXRoLnRhbihudW1iZXIpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGV4cG9ydHMuQ09USCA9IGZ1bmN0aW9uIChudW1iZXIpIHtcclxuICAgICAgICAgICAgbnVtYmVyID0gdXRpbHMucGFyc2VOdW1iZXIobnVtYmVyKTtcclxuICAgICAgICAgICAgaWYgKG51bWJlciBpbnN0YW5jZW9mIEVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbnVtYmVyO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHZhciBlMiA9IE1hdGguZXhwKDIgKiBudW1iZXIpO1xyXG4gICAgICAgICAgICByZXR1cm4gKGUyICsgMSkgLyAoZTIgLSAxKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBleHBvcnRzLkNTQyA9IGZ1bmN0aW9uIChudW1iZXIpIHtcclxuICAgICAgICAgICAgbnVtYmVyID0gdXRpbHMucGFyc2VOdW1iZXIobnVtYmVyKTtcclxuICAgICAgICAgICAgaWYgKG51bWJlciBpbnN0YW5jZW9mIEVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbnVtYmVyO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiAxIC8gTWF0aC5zaW4obnVtYmVyKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBleHBvcnRzLkNTQ0ggPSBmdW5jdGlvbiAobnVtYmVyKSB7XHJcbiAgICAgICAgICAgIG51bWJlciA9IHV0aWxzLnBhcnNlTnVtYmVyKG51bWJlcik7XHJcbiAgICAgICAgICAgIGlmIChudW1iZXIgaW5zdGFuY2VvZiBFcnJvcikge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG51bWJlcjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gMiAvIChNYXRoLmV4cChudW1iZXIpIC0gTWF0aC5leHAoLW51bWJlcikpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGV4cG9ydHMuREVDSU1BTCA9IGZ1bmN0aW9uIChudW1iZXIsIHJhZGl4KSB7XHJcbiAgICAgICAgICAgIGlmIChhcmd1bWVudHMubGVuZ3RoIDwgMSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGVycm9yLnZhbHVlO1xyXG4gICAgICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICAgICAgcmV0dXJuIHBhcnNlSW50KG51bWJlciwgcmFkaXgpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGV4cG9ydHMuREVHUkVFUyA9IGZ1bmN0aW9uIChudW1iZXIpIHtcclxuICAgICAgICAgICAgbnVtYmVyID0gdXRpbHMucGFyc2VOdW1iZXIobnVtYmVyKTtcclxuICAgICAgICAgICAgaWYgKG51bWJlciBpbnN0YW5jZW9mIEVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbnVtYmVyO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBudW1iZXIgKiAxODAgLyBNYXRoLlBJO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGV4cG9ydHMuRVZFTiA9IGZ1bmN0aW9uIChudW1iZXIpIHtcclxuICAgICAgICAgICAgbnVtYmVyID0gdXRpbHMucGFyc2VOdW1iZXIobnVtYmVyKTtcclxuICAgICAgICAgICAgaWYgKG51bWJlciBpbnN0YW5jZW9mIEVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbnVtYmVyO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBleHBvcnRzLkNFSUxJTkcobnVtYmVyLCAtMiwgLTEpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGV4cG9ydHMuRVhQID0gTWF0aC5leHA7XHJcblxyXG4gICAgICAgIHZhciBNRU1PSVpFRF9GQUNUID0gW107XHJcbiAgICAgICAgZXhwb3J0cy5GQUNUID0gZnVuY3Rpb24gKG51bWJlcikge1xyXG4gICAgICAgICAgICBudW1iZXIgPSB1dGlscy5wYXJzZU51bWJlcihudW1iZXIpO1xyXG4gICAgICAgICAgICBpZiAobnVtYmVyIGluc3RhbmNlb2YgRXJyb3IpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBudW1iZXI7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdmFyIG4gPSBNYXRoLmZsb29yKG51bWJlcik7XHJcbiAgICAgICAgICAgIGlmIChuID09PSAwIHx8IG4gPT09IDEpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiAxO1xyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKE1FTU9JWkVEX0ZBQ1Rbbl0gPiAwKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gTUVNT0laRURfRkFDVFtuXTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIE1FTU9JWkVEX0ZBQ1Rbbl0gPSBleHBvcnRzLkZBQ1QobiAtIDEpICogbjtcclxuICAgICAgICAgICAgICAgIHJldHVybiBNRU1PSVpFRF9GQUNUW25dO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZXhwb3J0cy5GQUNURE9VQkxFID0gZnVuY3Rpb24gKG51bWJlcikge1xyXG4gICAgICAgICAgICBudW1iZXIgPSB1dGlscy5wYXJzZU51bWJlcihudW1iZXIpO1xyXG4gICAgICAgICAgICBpZiAobnVtYmVyIGluc3RhbmNlb2YgRXJyb3IpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBudW1iZXI7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdmFyIG4gPSBNYXRoLmZsb29yKG51bWJlcik7XHJcbiAgICAgICAgICAgIGlmIChuIDw9IDApIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiAxO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG4gKiBleHBvcnRzLkZBQ1RET1VCTEUobiAtIDIpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZXhwb3J0cy5GTE9PUiA9IGZ1bmN0aW9uIChudW1iZXIsIHNpZ25pZmljYW5jZSwgbW9kZSkge1xyXG4gICAgICAgICAgICBzaWduaWZpY2FuY2UgPSAoc2lnbmlmaWNhbmNlID09PSB1bmRlZmluZWQpID8gMSA6IHNpZ25pZmljYW5jZTtcclxuICAgICAgICAgICAgbW9kZSA9IChtb2RlID09PSB1bmRlZmluZWQpID8gMCA6IG1vZGU7XHJcblxyXG4gICAgICAgICAgICBudW1iZXIgPSB1dGlscy5wYXJzZU51bWJlcihudW1iZXIpO1xyXG4gICAgICAgICAgICBzaWduaWZpY2FuY2UgPSB1dGlscy5wYXJzZU51bWJlcihzaWduaWZpY2FuY2UpO1xyXG4gICAgICAgICAgICBtb2RlID0gdXRpbHMucGFyc2VOdW1iZXIobW9kZSk7XHJcbiAgICAgICAgICAgIGlmICh1dGlscy5hbnlJc0Vycm9yKG51bWJlciwgc2lnbmlmaWNhbmNlLCBtb2RlKSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGVycm9yLnZhbHVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChzaWduaWZpY2FuY2UgPT09IDApIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiAwO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBzaWduaWZpY2FuY2UgPSBNYXRoLmFicyhzaWduaWZpY2FuY2UpO1xyXG4gICAgICAgICAgICBpZiAobnVtYmVyID49IDApIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBNYXRoLmZsb29yKG51bWJlciAvIHNpZ25pZmljYW5jZSkgKiBzaWduaWZpY2FuY2U7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBpZiAobW9kZSA9PT0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAtMSAqIE1hdGguY2VpbChNYXRoLmFicyhudW1iZXIpIC8gc2lnbmlmaWNhbmNlKSAqIHNpZ25pZmljYW5jZTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIC0xICogTWF0aC5mbG9vcihNYXRoLmFicyhudW1iZXIpIC8gc2lnbmlmaWNhbmNlKSAqIHNpZ25pZmljYW5jZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGV4cG9ydHMuRkxPT1IuTUFUSCA9IGV4cG9ydHMuRkxPT1I7XHJcblxyXG4gICAgICAgIGV4cG9ydHMuR0NEID0gbnVsbDtcclxuXHJcbiAgICAgICAgZXhwb3J0cy5JTlQgPSBmdW5jdGlvbiAobnVtYmVyKSB7XHJcbiAgICAgICAgICAgIG51bWJlciA9IHV0aWxzLnBhcnNlTnVtYmVyKG51bWJlcik7XHJcbiAgICAgICAgICAgIGlmIChudW1iZXIgaW5zdGFuY2VvZiBFcnJvcikge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG51bWJlcjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gTWF0aC5mbG9vcihudW1iZXIpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGV4cG9ydHMuTENNID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAvLyBDcmVkaXRzOiBKb25hcyBSYW9uaSBTb2FyZXMgU2lsdmFcclxuICAgICAgICAgICAgdmFyIG8gPSB1dGlscy5wYXJzZU51bWJlckFycmF5KHV0aWxzLmZsYXR0ZW4oYXJndW1lbnRzKSk7XHJcbiAgICAgICAgICAgIGlmIChvIGluc3RhbmNlb2YgRXJyb3IpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBvO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGZvciAodmFyIGksIGosIG4sIGQsIHIgPSAxO1xyXG4gICAgICAgICAgICAgICAgIChuID0gby5wb3AoKSkgIT09IHVuZGVmaW5lZDspIHtcclxuICAgICAgICAgICAgICAgIHdoaWxlIChuID4gMSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChuICUgMikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGkgPSAzLCBqID0gTWF0aC5mbG9vcihNYXRoLnNxcnQobikpOyBpIDw9IGogJiYgbiAlIGk7IGkgKz0gMikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9lbXB0eVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGQgPSAoaSA8PSBqKSA/IGkgOiBuO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGQgPSAyO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBmb3IgKG4gLz0gZCwgciAqPSBkLCBpID0gby5sZW5ndGg7IGk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAob1stLWldICUgZCkgPT09IDAgJiYgKG9baV0gLz0gZCkgPT09IDEgJiYgby5zcGxpY2UoaSwgMSkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy9lbXB0eVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gcjtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBleHBvcnRzLkxOID0gZnVuY3Rpb24gKG51bWJlcikge1xyXG4gICAgICAgICAgICBudW1iZXIgPSB1dGlscy5wYXJzZU51bWJlcihudW1iZXIpO1xyXG4gICAgICAgICAgICBpZiAobnVtYmVyIGluc3RhbmNlb2YgRXJyb3IpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBudW1iZXI7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIE1hdGgubG9nKG51bWJlcik7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZXhwb3J0cy5MT0cgPSBmdW5jdGlvbiAobnVtYmVyLCBiYXNlKSB7XHJcbiAgICAgICAgICAgIG51bWJlciA9IHV0aWxzLnBhcnNlTnVtYmVyKG51bWJlcik7XHJcbiAgICAgICAgICAgIGJhc2UgPSAoYmFzZSA9PT0gdW5kZWZpbmVkKSA/IDEwIDogdXRpbHMucGFyc2VOdW1iZXIoYmFzZSk7XHJcblxyXG4gICAgICAgICAgICBpZiAodXRpbHMuYW55SXNFcnJvcihudW1iZXIsIGJhc2UpKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZXJyb3IudmFsdWU7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHJldHVybiBNYXRoLmxvZyhudW1iZXIpIC8gTWF0aC5sb2coYmFzZSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZXhwb3J0cy5MT0cxMCA9IGZ1bmN0aW9uIChudW1iZXIpIHtcclxuICAgICAgICAgICAgbnVtYmVyID0gdXRpbHMucGFyc2VOdW1iZXIobnVtYmVyKTtcclxuICAgICAgICAgICAgaWYgKG51bWJlciBpbnN0YW5jZW9mIEVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbnVtYmVyO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBNYXRoLmxvZyhudW1iZXIpIC8gTWF0aC5sb2coMTApO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGV4cG9ydHMuTURFVEVSTSA9IG51bGw7XHJcblxyXG4gICAgICAgIGV4cG9ydHMuTUlOVkVSU0UgPSBudWxsO1xyXG5cclxuICAgICAgICBleHBvcnRzLk1NVUxUID0gbnVsbDtcclxuXHJcbiAgICAgICAgZXhwb3J0cy5NT0QgPSBmdW5jdGlvbiAoZGl2aWRlbmQsIGRpdmlzb3IpIHtcclxuICAgICAgICAgICAgZGl2aWRlbmQgPSB1dGlscy5wYXJzZU51bWJlcihkaXZpZGVuZCk7XHJcbiAgICAgICAgICAgIGRpdmlzb3IgPSB1dGlscy5wYXJzZU51bWJlcihkaXZpc29yKTtcclxuICAgICAgICAgICAgaWYgKHV0aWxzLmFueUlzRXJyb3IoZGl2aWRlbmQsIGRpdmlzb3IpKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZXJyb3IudmFsdWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKGRpdmlzb3IgPT09IDApIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBlcnJvci5kaXYwO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHZhciBtb2R1bHVzID0gTWF0aC5hYnMoZGl2aWRlbmQgJSBkaXZpc29yKTtcclxuICAgICAgICAgICAgcmV0dXJuIChkaXZpc29yID4gMCkgPyBtb2R1bHVzIDogLW1vZHVsdXM7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZXhwb3J0cy5NUk9VTkQgPSBmdW5jdGlvbiAobnVtYmVyLCBtdWx0aXBsZSkge1xyXG4gICAgICAgICAgICBudW1iZXIgPSB1dGlscy5wYXJzZU51bWJlcihudW1iZXIpO1xyXG4gICAgICAgICAgICBtdWx0aXBsZSA9IHV0aWxzLnBhcnNlTnVtYmVyKG11bHRpcGxlKTtcclxuICAgICAgICAgICAgaWYgKHV0aWxzLmFueUlzRXJyb3IobnVtYmVyLCBtdWx0aXBsZSkpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBlcnJvci52YWx1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAobnVtYmVyICogbXVsdGlwbGUgPCAwKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZXJyb3IubnVtO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gTWF0aC5yb3VuZChudW1iZXIgLyBtdWx0aXBsZSkgKiBtdWx0aXBsZTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBleHBvcnRzLk1VTFRJTk9NSUFMID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICB2YXIgYXJncyA9IHV0aWxzLnBhcnNlTnVtYmVyQXJyYXkodXRpbHMuZmxhdHRlbihhcmd1bWVudHMpKTtcclxuICAgICAgICAgICAgaWYgKGFyZ3MgaW5zdGFuY2VvZiBFcnJvcikge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGFyZ3M7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdmFyIHN1bSA9IDA7XHJcbiAgICAgICAgICAgIHZhciBkaXZpc29yID0gMTtcclxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBhcmdzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICBzdW0gKz0gYXJnc1tpXTtcclxuICAgICAgICAgICAgICAgIGRpdmlzb3IgKj0gZXhwb3J0cy5GQUNUKGFyZ3NbaV0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBleHBvcnRzLkZBQ1Qoc3VtKSAvIGRpdmlzb3I7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZXhwb3J0cy5NVU5JVCA9IG51bGw7XHJcblxyXG4gICAgICAgIGV4cG9ydHMuT0REID0gZnVuY3Rpb24gKG51bWJlcikge1xyXG4gICAgICAgICAgICBudW1iZXIgPSB1dGlscy5wYXJzZU51bWJlcihudW1iZXIpO1xyXG4gICAgICAgICAgICBpZiAobnVtYmVyIGluc3RhbmNlb2YgRXJyb3IpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBudW1iZXI7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdmFyIHRlbXAgPSBNYXRoLmNlaWwoTWF0aC5hYnMobnVtYmVyKSk7XHJcbiAgICAgICAgICAgIHRlbXAgPSAodGVtcCAmIDEpID8gdGVtcCA6IHRlbXAgKyAxO1xyXG4gICAgICAgICAgICByZXR1cm4gKG51bWJlciA+IDApID8gdGVtcCA6IC10ZW1wO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGV4cG9ydHMuUEkgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBNYXRoLlBJO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGV4cG9ydHMuUE9XRVIgPSBmdW5jdGlvbiAobnVtYmVyLCBwb3dlcikge1xyXG4gICAgICAgICAgICBudW1iZXIgPSB1dGlscy5wYXJzZU51bWJlcihudW1iZXIpO1xyXG4gICAgICAgICAgICBwb3dlciA9IHV0aWxzLnBhcnNlTnVtYmVyKHBvd2VyKTtcclxuICAgICAgICAgICAgaWYgKHV0aWxzLmFueUlzRXJyb3IobnVtYmVyLCBwb3dlcikpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBlcnJvci52YWx1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB2YXIgcmVzdWx0ID0gTWF0aC5wb3cobnVtYmVyLCBwb3dlcik7XHJcbiAgICAgICAgICAgIGlmIChpc05hTihyZXN1bHQpKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZXJyb3IubnVtO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGV4cG9ydHMuUFJPRFVDVCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgdmFyIGFyZ3MgPSB1dGlscy5wYXJzZU51bWJlckFycmF5KHV0aWxzLmZsYXR0ZW4oYXJndW1lbnRzKSk7XHJcbiAgICAgICAgICAgIGlmIChhcmdzIGluc3RhbmNlb2YgRXJyb3IpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBhcmdzO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHZhciByZXN1bHQgPSAxO1xyXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGFyZ3MubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgIHJlc3VsdCAqPSBhcmdzW2ldO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZXhwb3J0cy5RVU9USUVOVCA9IGZ1bmN0aW9uIChudW1lcmF0b3IsIGRlbm9taW5hdG9yKSB7XHJcbiAgICAgICAgICAgIG51bWVyYXRvciA9IHV0aWxzLnBhcnNlTnVtYmVyKG51bWVyYXRvcik7XHJcbiAgICAgICAgICAgIGRlbm9taW5hdG9yID0gdXRpbHMucGFyc2VOdW1iZXIoZGVub21pbmF0b3IpO1xyXG4gICAgICAgICAgICBpZiAodXRpbHMuYW55SXNFcnJvcihudW1lcmF0b3IsIGRlbm9taW5hdG9yKSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGVycm9yLnZhbHVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBwYXJzZUludChudW1lcmF0b3IgLyBkZW5vbWluYXRvciwgMTApO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGV4cG9ydHMuUkFESUFOUyA9IGZ1bmN0aW9uIChudW1iZXIpIHtcclxuICAgICAgICAgICAgbnVtYmVyID0gdXRpbHMucGFyc2VOdW1iZXIobnVtYmVyKTtcclxuICAgICAgICAgICAgaWYgKG51bWJlciBpbnN0YW5jZW9mIEVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbnVtYmVyO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBudW1iZXIgKiBNYXRoLlBJIC8gMTgwO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGV4cG9ydHMuUkFORCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIE1hdGgucmFuZG9tKCk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZXhwb3J0cy5SQU5EQkVUV0VFTiA9IGZ1bmN0aW9uIChib3R0b20sIHRvcCkge1xyXG4gICAgICAgICAgICBib3R0b20gPSB1dGlscy5wYXJzZU51bWJlcihib3R0b20pO1xyXG4gICAgICAgICAgICB0b3AgPSB1dGlscy5wYXJzZU51bWJlcih0b3ApO1xyXG4gICAgICAgICAgICBpZiAodXRpbHMuYW55SXNFcnJvcihib3R0b20sIHRvcCkpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBlcnJvci52YWx1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAvLyBDcmVhdGl2ZSBDb21tb25zIEF0dHJpYnV0aW9uIDMuMCBMaWNlbnNlXHJcbiAgICAgICAgICAgIC8vIENvcHlyaWdodCAoYykgMjAxMiBlcWNvZGVcclxuICAgICAgICAgICAgcmV0dXJuIGJvdHRvbSArIE1hdGguY2VpbCgodG9wIC0gYm90dG9tICsgMSkgKiBNYXRoLnJhbmRvbSgpKSAtIDE7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZXhwb3J0cy5ST01BTiA9IG51bGw7XHJcblxyXG4gICAgICAgIGV4cG9ydHMuUk9VTkQgPSBmdW5jdGlvbiAobnVtYmVyLCBkaWdpdHMpIHtcclxuICAgICAgICAgICAgbnVtYmVyID0gdXRpbHMucGFyc2VOdW1iZXIobnVtYmVyKTtcclxuICAgICAgICAgICAgZGlnaXRzID0gdXRpbHMucGFyc2VOdW1iZXIoZGlnaXRzKTtcclxuICAgICAgICAgICAgaWYgKHV0aWxzLmFueUlzRXJyb3IobnVtYmVyLCBkaWdpdHMpKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZXJyb3IudmFsdWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIE1hdGgucm91bmQobnVtYmVyICogTWF0aC5wb3coMTAsIGRpZ2l0cykpIC8gTWF0aC5wb3coMTAsIGRpZ2l0cyk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZXhwb3J0cy5ST1VORERPV04gPSBmdW5jdGlvbiAobnVtYmVyLCBkaWdpdHMpIHtcclxuICAgICAgICAgICAgbnVtYmVyID0gdXRpbHMucGFyc2VOdW1iZXIobnVtYmVyKTtcclxuICAgICAgICAgICAgZGlnaXRzID0gdXRpbHMucGFyc2VOdW1iZXIoZGlnaXRzKTtcclxuICAgICAgICAgICAgaWYgKHV0aWxzLmFueUlzRXJyb3IobnVtYmVyLCBkaWdpdHMpKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZXJyb3IudmFsdWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdmFyIHNpZ24gPSAobnVtYmVyID4gMCkgPyAxIDogLTE7XHJcbiAgICAgICAgICAgIHJldHVybiBzaWduICogKE1hdGguZmxvb3IoTWF0aC5hYnMobnVtYmVyKSAqIE1hdGgucG93KDEwLCBkaWdpdHMpKSkgLyBNYXRoLnBvdygxMCwgZGlnaXRzKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBleHBvcnRzLlJPVU5EVVAgPSBmdW5jdGlvbiAobnVtYmVyLCBkaWdpdHMpIHtcclxuICAgICAgICAgICAgbnVtYmVyID0gdXRpbHMucGFyc2VOdW1iZXIobnVtYmVyKTtcclxuICAgICAgICAgICAgZGlnaXRzID0gdXRpbHMucGFyc2VOdW1iZXIoZGlnaXRzKTtcclxuICAgICAgICAgICAgaWYgKHV0aWxzLmFueUlzRXJyb3IobnVtYmVyLCBkaWdpdHMpKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZXJyb3IudmFsdWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdmFyIHNpZ24gPSAobnVtYmVyID4gMCkgPyAxIDogLTE7XHJcbiAgICAgICAgICAgIHJldHVybiBzaWduICogKE1hdGguY2VpbChNYXRoLmFicyhudW1iZXIpICogTWF0aC5wb3coMTAsIGRpZ2l0cykpKSAvIE1hdGgucG93KDEwLCBkaWdpdHMpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGV4cG9ydHMuU0VDID0gZnVuY3Rpb24gKG51bWJlcikge1xyXG4gICAgICAgICAgICBudW1iZXIgPSB1dGlscy5wYXJzZU51bWJlcihudW1iZXIpO1xyXG4gICAgICAgICAgICBpZiAobnVtYmVyIGluc3RhbmNlb2YgRXJyb3IpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBudW1iZXI7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIDEgLyBNYXRoLmNvcyhudW1iZXIpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGV4cG9ydHMuU0VDSCA9IGZ1bmN0aW9uIChudW1iZXIpIHtcclxuICAgICAgICAgICAgbnVtYmVyID0gdXRpbHMucGFyc2VOdW1iZXIobnVtYmVyKTtcclxuICAgICAgICAgICAgaWYgKG51bWJlciBpbnN0YW5jZW9mIEVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbnVtYmVyO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiAyIC8gKE1hdGguZXhwKG51bWJlcikgKyBNYXRoLmV4cCgtbnVtYmVyKSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZXhwb3J0cy5TRVJJRVNTVU0gPSBmdW5jdGlvbiAoeCwgbiwgbSwgY29lZmZpY2llbnRzKSB7XHJcbiAgICAgICAgICAgIHggPSB1dGlscy5wYXJzZU51bWJlcih4KTtcclxuICAgICAgICAgICAgbiA9IHV0aWxzLnBhcnNlTnVtYmVyKG4pO1xyXG4gICAgICAgICAgICBtID0gdXRpbHMucGFyc2VOdW1iZXIobSk7XHJcbiAgICAgICAgICAgIGNvZWZmaWNpZW50cyA9IHV0aWxzLnBhcnNlTnVtYmVyQXJyYXkoY29lZmZpY2llbnRzKTtcclxuICAgICAgICAgICAgaWYgKHV0aWxzLmFueUlzRXJyb3IoeCwgbiwgbSwgY29lZmZpY2llbnRzKSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGVycm9yLnZhbHVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHZhciByZXN1bHQgPSBjb2VmZmljaWVudHNbMF0gKiBNYXRoLnBvdyh4LCBuKTtcclxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDE7IGkgPCBjb2VmZmljaWVudHMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgIHJlc3VsdCArPSBjb2VmZmljaWVudHNbaV0gKiBNYXRoLnBvdyh4LCBuICsgaSAqIG0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZXhwb3J0cy5TSUdOID0gZnVuY3Rpb24gKG51bWJlcikge1xyXG4gICAgICAgICAgICBudW1iZXIgPSB1dGlscy5wYXJzZU51bWJlcihudW1iZXIpO1xyXG4gICAgICAgICAgICBpZiAobnVtYmVyIGluc3RhbmNlb2YgRXJyb3IpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBudW1iZXI7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKG51bWJlciA8IDApIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiAtMTtcclxuICAgICAgICAgICAgfSBlbHNlIGlmIChudW1iZXIgPT09IDApIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiAwO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIDE7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBleHBvcnRzLlNJTiA9IGZ1bmN0aW9uIChudW1iZXIpIHtcclxuICAgICAgICAgICAgbnVtYmVyID0gdXRpbHMucGFyc2VOdW1iZXIobnVtYmVyKTtcclxuICAgICAgICAgICAgaWYgKG51bWJlciBpbnN0YW5jZW9mIEVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbnVtYmVyO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBNYXRoLnNpbihudW1iZXIpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGV4cG9ydHMuU0lOSCA9IGZ1bmN0aW9uIChudW1iZXIpIHtcclxuICAgICAgICAgICAgbnVtYmVyID0gdXRpbHMucGFyc2VOdW1iZXIobnVtYmVyKTtcclxuICAgICAgICAgICAgaWYgKG51bWJlciBpbnN0YW5jZW9mIEVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbnVtYmVyO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiAoTWF0aC5leHAobnVtYmVyKSAtIE1hdGguZXhwKC1udW1iZXIpKSAvIDI7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZXhwb3J0cy5TUVJUID0gZnVuY3Rpb24gKG51bWJlcikge1xyXG4gICAgICAgICAgICBudW1iZXIgPSB1dGlscy5wYXJzZU51bWJlcihudW1iZXIpO1xyXG4gICAgICAgICAgICBpZiAobnVtYmVyIGluc3RhbmNlb2YgRXJyb3IpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBudW1iZXI7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKG51bWJlciA8IDApIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBlcnJvci5udW07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIE1hdGguc3FydChudW1iZXIpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGV4cG9ydHMuU1FSVFBJID0gZnVuY3Rpb24gKG51bWJlcikge1xyXG4gICAgICAgICAgICBudW1iZXIgPSB1dGlscy5wYXJzZU51bWJlcihudW1iZXIpO1xyXG4gICAgICAgICAgICBpZiAobnVtYmVyIGluc3RhbmNlb2YgRXJyb3IpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBudW1iZXI7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIE1hdGguc3FydChudW1iZXIgKiBNYXRoLlBJKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBleHBvcnRzLlNVQlRPVEFMID0gbnVsbDtcclxuXHJcbiAgICAgICAgZXhwb3J0cy5BREQgPSBmdW5jdGlvbiAobnVtMSwgbnVtMikge1xyXG4gICAgICAgICAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCAhPT0gMikge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGVycm9yLm5hO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBudW0xID0gdXRpbHMucGFyc2VOdW1iZXIobnVtMSk7XHJcbiAgICAgICAgICAgIG51bTIgPSB1dGlscy5wYXJzZU51bWJlcihudW0yKTtcclxuICAgICAgICAgICAgaWYgKHV0aWxzLmFueUlzRXJyb3IobnVtMSwgbnVtMikpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBlcnJvci52YWx1ZTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgcmV0dXJuIG51bTEgKyBudW0yO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGV4cG9ydHMuTUlOVVMgPSBmdW5jdGlvbiAobnVtMSwgbnVtMikge1xyXG4gICAgICAgICAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCAhPT0gMikge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGVycm9yLm5hO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBudW0xID0gdXRpbHMucGFyc2VOdW1iZXIobnVtMSk7XHJcbiAgICAgICAgICAgIG51bTIgPSB1dGlscy5wYXJzZU51bWJlcihudW0yKTtcclxuICAgICAgICAgICAgaWYgKHV0aWxzLmFueUlzRXJyb3IobnVtMSwgbnVtMikpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBlcnJvci52YWx1ZTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgcmV0dXJuIG51bTEgLSBudW0yO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGV4cG9ydHMuRElWSURFID0gZnVuY3Rpb24gKGRpdmlkZW5kLCBkaXZpc29yKSB7XHJcbiAgICAgICAgICAgIGlmIChhcmd1bWVudHMubGVuZ3RoICE9PSAyKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZXJyb3IubmE7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGRpdmlkZW5kID0gdXRpbHMucGFyc2VOdW1iZXIoZGl2aWRlbmQpO1xyXG4gICAgICAgICAgICBkaXZpc29yID0gdXRpbHMucGFyc2VOdW1iZXIoZGl2aXNvcik7XHJcbiAgICAgICAgICAgIGlmICh1dGlscy5hbnlJc0Vycm9yKGRpdmlkZW5kLCBkaXZpc29yKSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGVycm9yLnZhbHVlO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAoZGl2aXNvciA9PT0gMCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGVycm9yLmRpdjA7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHJldHVybiBkaXZpZGVuZCAvIGRpdmlzb3I7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZXhwb3J0cy5NVUxUSVBMWSA9IGZ1bmN0aW9uIChmYWN0b3IxLCBmYWN0b3IyKSB7XHJcbiAgICAgICAgICAgIGlmIChhcmd1bWVudHMubGVuZ3RoICE9PSAyKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZXJyb3IubmE7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGZhY3RvcjEgPSB1dGlscy5wYXJzZU51bWJlcihmYWN0b3IxKTtcclxuICAgICAgICAgICAgZmFjdG9yMiA9IHV0aWxzLnBhcnNlTnVtYmVyKGZhY3RvcjIpO1xyXG4gICAgICAgICAgICBpZiAodXRpbHMuYW55SXNFcnJvcihmYWN0b3IxLCBmYWN0b3IyKSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGVycm9yLnZhbHVlO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gZmFjdG9yMSAqIGZhY3RvcjI7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZXhwb3J0cy5HVEUgPSBmdW5jdGlvbiAobnVtMSwgbnVtMikge1xyXG4gICAgICAgICAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCAhPT0gMikge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGVycm9yLm5hO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBudW0xID0gdXRpbHMucGFyc2VOdW1iZXIobnVtMSk7XHJcbiAgICAgICAgICAgIG51bTIgPSB1dGlscy5wYXJzZU51bWJlcihudW0yKTtcclxuICAgICAgICAgICAgaWYgKHV0aWxzLmFueUlzRXJyb3IobnVtMSwgbnVtMikpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBlcnJvci5lcnJvcjtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgcmV0dXJuIG51bTEgPj0gbnVtMjtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBleHBvcnRzLkxUID0gZnVuY3Rpb24gKG51bTEsIG51bTIpIHtcclxuICAgICAgICAgICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggIT09IDIpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBlcnJvci5uYTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgbnVtMSA9IHV0aWxzLnBhcnNlTnVtYmVyKG51bTEpO1xyXG4gICAgICAgICAgICBudW0yID0gdXRpbHMucGFyc2VOdW1iZXIobnVtMik7XHJcbiAgICAgICAgICAgIGlmICh1dGlscy5hbnlJc0Vycm9yKG51bTEsIG51bTIpKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZXJyb3IuZXJyb3I7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHJldHVybiBudW0xIDwgbnVtMjtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBleHBvcnRzLkxURSA9IGZ1bmN0aW9uIChudW0xLCBudW0yKSB7XHJcbiAgICAgICAgICAgIGlmIChhcmd1bWVudHMubGVuZ3RoICE9PSAyKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZXJyb3IubmE7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIG51bTEgPSB1dGlscy5wYXJzZU51bWJlcihudW0xKTtcclxuICAgICAgICAgICAgbnVtMiA9IHV0aWxzLnBhcnNlTnVtYmVyKG51bTIpO1xyXG4gICAgICAgICAgICBpZiAodXRpbHMuYW55SXNFcnJvcihudW0xLCBudW0yKSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGVycm9yLmVycm9yO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gbnVtMSA8PSBudW0yO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGV4cG9ydHMuRVEgPSBmdW5jdGlvbiAodmFsdWUxLCB2YWx1ZTIpIHtcclxuICAgICAgICAgICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggIT09IDIpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBlcnJvci5uYTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgcmV0dXJuIHZhbHVlMSA9PT0gdmFsdWUyO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGV4cG9ydHMuTkUgPSBmdW5jdGlvbiAodmFsdWUxLCB2YWx1ZTIpIHtcclxuICAgICAgICAgICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggIT09IDIpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBlcnJvci5uYTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgcmV0dXJuIHZhbHVlMSAhPT0gdmFsdWUyO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGV4cG9ydHMuUE9XID0gZnVuY3Rpb24gKGJhc2UsIGV4cG9uZW50KSB7XHJcbiAgICAgICAgICAgIGlmIChhcmd1bWVudHMubGVuZ3RoICE9PSAyKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZXJyb3IubmE7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGJhc2UgPSB1dGlscy5wYXJzZU51bWJlcihiYXNlKTtcclxuICAgICAgICAgICAgZXhwb25lbnQgPSB1dGlscy5wYXJzZU51bWJlcihleHBvbmVudCk7XHJcbiAgICAgICAgICAgIGlmICh1dGlscy5hbnlJc0Vycm9yKGJhc2UsIGV4cG9uZW50KSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGVycm9yLmVycm9yO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gZXhwb3J0cy5QT1dFUihiYXNlLCBleHBvbmVudCk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZXhwb3J0cy5TVU0gPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHZhciByZXN1bHQgPSAwO1xyXG4gICAgICAgICAgICB2YXIgYXJnc0tleXMgPSBPYmplY3Qua2V5cyhhcmd1bWVudHMpO1xyXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGFyZ3NLZXlzLmxlbmd0aDsgKytpKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgZWx0ID0gYXJndW1lbnRzW2FyZ3NLZXlzW2ldXTtcclxuICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgZWx0ID09PSAnbnVtYmVyJykge1xyXG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdCArPSBlbHQ7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiBlbHQgPT09ICdzdHJpbmcnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHBhcnNlZCA9IHBhcnNlRmxvYXQoZWx0KTtcclxuICAgICAgICAgICAgICAgICAgICAhaXNOYU4ocGFyc2VkKSAmJiAocmVzdWx0ICs9IHBhcnNlZCk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkoZWx0KSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdCArPSBleHBvcnRzLlNVTS5hcHBseShudWxsLCBlbHQpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZXhwb3J0cy5TVU1JRiA9IGZ1bmN0aW9uIChyYW5nZSwgY3JpdGVyaWEpIHtcclxuICAgICAgICAgICAgcmFuZ2UgPSB1dGlscy5wYXJzZU51bWJlckFycmF5KHV0aWxzLmZsYXR0ZW4ocmFuZ2UpKTtcclxuICAgICAgICAgICAgaWYgKHJhbmdlIGluc3RhbmNlb2YgRXJyb3IpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiByYW5nZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB2YXIgcmVzdWx0ID0gMDtcclxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCByYW5nZS5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgcmVzdWx0ICs9IChldmFsKHJhbmdlW2ldICsgY3JpdGVyaWEpKSA/IHJhbmdlW2ldIDogMDsgLy8ganNoaW50IGlnbm9yZTpsaW5lXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBleHBvcnRzLlNVTUlGUyA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgdmFyIGFyZ3MgPSB1dGlscy5hcmdzVG9BcnJheShhcmd1bWVudHMpO1xyXG4gICAgICAgICAgICB2YXIgcmFuZ2UgPSB1dGlscy5wYXJzZU51bWJlckFycmF5KHV0aWxzLmZsYXR0ZW4oYXJncy5zaGlmdCgpKSk7XHJcbiAgICAgICAgICAgIGlmIChyYW5nZSBpbnN0YW5jZW9mIEVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gcmFuZ2U7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdmFyIGNyaXRlcmlhID0gYXJncztcclxuXHJcbiAgICAgICAgICAgIHZhciBuX3JhbmdlX2VsZW1lbnRzID0gcmFuZ2UubGVuZ3RoO1xyXG4gICAgICAgICAgICB2YXIgbl9jcml0ZXJpYXMgPSBjcml0ZXJpYS5sZW5ndGg7XHJcblxyXG4gICAgICAgICAgICB2YXIgcmVzdWx0ID0gMDtcclxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBuX3JhbmdlX2VsZW1lbnRzOyBpKyspIHtcclxuICAgICAgICAgICAgICAgIHZhciBlbCA9IHJhbmdlW2ldO1xyXG4gICAgICAgICAgICAgICAgdmFyIGNvbmRpdGlvbiA9ICcnO1xyXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgYyA9IDA7IGMgPCBuX2NyaXRlcmlhczsgYysrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uZGl0aW9uICs9IGVsICsgY3JpdGVyaWFbY107XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGMgIT09IG5fY3JpdGVyaWFzIC0gMSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25kaXRpb24gKz0gJyYmJztcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAoZXZhbChjb25kaXRpb24pKSB7IC8vIGpzaGludCBpZ25vcmU6bGluZVxyXG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdCArPSBlbDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGV4cG9ydHMuU1VNUFJPRFVDVCA9IG51bGw7XHJcblxyXG4gICAgICAgIGV4cG9ydHMuU1VNU1EgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHZhciBudW1iZXJzID0gdXRpbHMucGFyc2VOdW1iZXJBcnJheSh1dGlscy5mbGF0dGVuKGFyZ3VtZW50cykpO1xyXG4gICAgICAgICAgICBpZiAobnVtYmVycyBpbnN0YW5jZW9mIEVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbnVtYmVycztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB2YXIgcmVzdWx0ID0gMDtcclxuICAgICAgICAgICAgdmFyIGxlbmd0aCA9IG51bWJlcnMubGVuZ3RoO1xyXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICByZXN1bHQgKz0gKElTTlVNQkVSKG51bWJlcnNbaV0pKSA/IG51bWJlcnNbaV0gKiBudW1iZXJzW2ldIDogMDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGV4cG9ydHMuU1VNWDJNWTIgPSBmdW5jdGlvbiAoYXJyYXlfeCwgYXJyYXlfeSkge1xyXG4gICAgICAgICAgICBhcnJheV94ID0gdXRpbHMucGFyc2VOdW1iZXJBcnJheSh1dGlscy5mbGF0dGVuKGFycmF5X3gpKTtcclxuICAgICAgICAgICAgYXJyYXlfeSA9IHV0aWxzLnBhcnNlTnVtYmVyQXJyYXkodXRpbHMuZmxhdHRlbihhcnJheV95KSk7XHJcbiAgICAgICAgICAgIGlmICh1dGlscy5hbnlJc0Vycm9yKGFycmF5X3gsIGFycmF5X3kpKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZXJyb3IudmFsdWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdmFyIHJlc3VsdCA9IDA7XHJcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgYXJyYXlfeC5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgcmVzdWx0ICs9IGFycmF5X3hbaV0gKiBhcnJheV94W2ldIC0gYXJyYXlfeVtpXSAqIGFycmF5X3lbaV07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBleHBvcnRzLlNVTVgyUFkyID0gZnVuY3Rpb24gKGFycmF5X3gsIGFycmF5X3kpIHtcclxuICAgICAgICAgICAgYXJyYXlfeCA9IHV0aWxzLnBhcnNlTnVtYmVyQXJyYXkodXRpbHMuZmxhdHRlbihhcnJheV94KSk7XHJcbiAgICAgICAgICAgIGFycmF5X3kgPSB1dGlscy5wYXJzZU51bWJlckFycmF5KHV0aWxzLmZsYXR0ZW4oYXJyYXlfeSkpO1xyXG4gICAgICAgICAgICBpZiAodXRpbHMuYW55SXNFcnJvcihhcnJheV94LCBhcnJheV95KSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGVycm9yLnZhbHVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHZhciByZXN1bHQgPSAwO1xyXG4gICAgICAgICAgICBhcnJheV94ID0gdXRpbHMucGFyc2VOdW1iZXJBcnJheSh1dGlscy5mbGF0dGVuKGFycmF5X3gpKTtcclxuICAgICAgICAgICAgYXJyYXlfeSA9IHV0aWxzLnBhcnNlTnVtYmVyQXJyYXkodXRpbHMuZmxhdHRlbihhcnJheV95KSk7XHJcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgYXJyYXlfeC5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgcmVzdWx0ICs9IGFycmF5X3hbaV0gKiBhcnJheV94W2ldICsgYXJyYXlfeVtpXSAqIGFycmF5X3lbaV07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBleHBvcnRzLlNVTVhNWTIgPSBmdW5jdGlvbiAoYXJyYXlfeCwgYXJyYXlfeSkge1xyXG4gICAgICAgICAgICBhcnJheV94ID0gdXRpbHMucGFyc2VOdW1iZXJBcnJheSh1dGlscy5mbGF0dGVuKGFycmF5X3gpKTtcclxuICAgICAgICAgICAgYXJyYXlfeSA9IHV0aWxzLnBhcnNlTnVtYmVyQXJyYXkodXRpbHMuZmxhdHRlbihhcnJheV95KSk7XHJcbiAgICAgICAgICAgIGlmICh1dGlscy5hbnlJc0Vycm9yKGFycmF5X3gsIGFycmF5X3kpKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZXJyb3IudmFsdWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdmFyIHJlc3VsdCA9IDA7XHJcbiAgICAgICAgICAgIGFycmF5X3ggPSB1dGlscy5mbGF0dGVuKGFycmF5X3gpO1xyXG4gICAgICAgICAgICBhcnJheV95ID0gdXRpbHMuZmxhdHRlbihhcnJheV95KTtcclxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBhcnJheV94Lmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICByZXN1bHQgKz0gTWF0aC5wb3coYXJyYXlfeFtpXSAtIGFycmF5X3lbaV0sIDIpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZXhwb3J0cy5UQU4gPSBmdW5jdGlvbiAobnVtYmVyKSB7XHJcbiAgICAgICAgICAgIG51bWJlciA9IHV0aWxzLnBhcnNlTnVtYmVyKG51bWJlcik7XHJcbiAgICAgICAgICAgIGlmIChudW1iZXIgaW5zdGFuY2VvZiBFcnJvcikge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG51bWJlcjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gTWF0aC50YW4obnVtYmVyKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBleHBvcnRzLlRBTkggPSBmdW5jdGlvbiAobnVtYmVyKSB7XHJcbiAgICAgICAgICAgIG51bWJlciA9IHV0aWxzLnBhcnNlTnVtYmVyKG51bWJlcik7XHJcbiAgICAgICAgICAgIGlmIChudW1iZXIgaW5zdGFuY2VvZiBFcnJvcikge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG51bWJlcjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB2YXIgZTIgPSBNYXRoLmV4cCgyICogbnVtYmVyKTtcclxuICAgICAgICAgICAgcmV0dXJuIChlMiAtIDEpIC8gKGUyICsgMSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZXhwb3J0cy5UUlVOQyA9IGZ1bmN0aW9uIChudW1iZXIsIGRpZ2l0cykge1xyXG4gICAgICAgICAgICBkaWdpdHMgPSAoZGlnaXRzID09PSB1bmRlZmluZWQpID8gMCA6IGRpZ2l0cztcclxuICAgICAgICAgICAgbnVtYmVyID0gdXRpbHMucGFyc2VOdW1iZXIobnVtYmVyKTtcclxuICAgICAgICAgICAgZGlnaXRzID0gdXRpbHMucGFyc2VOdW1iZXIoZGlnaXRzKTtcclxuICAgICAgICAgICAgaWYgKHV0aWxzLmFueUlzRXJyb3IobnVtYmVyLCBkaWdpdHMpKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZXJyb3IudmFsdWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdmFyIHNpZ24gPSAobnVtYmVyID4gMCkgPyAxIDogLTE7XHJcbiAgICAgICAgICAgIHJldHVybiBzaWduICogKE1hdGguZmxvb3IoTWF0aC5hYnMobnVtYmVyKSAqIE1hdGgucG93KDEwLCBkaWdpdHMpKSkgLyBNYXRoLnBvdygxMCwgZGlnaXRzKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICByZXR1cm4gZXhwb3J0cztcclxuICAgIH0pKCk7XHJcblxyXG4gICAgamV4Y2VsLm1ldGhvZHMubWlzYyA9IChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdmFyIGV4cG9ydHMgPSB7fTtcclxuXHJcbiAgICAgICAgZXhwb3J0cy5VTklRVUUgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHZhciByZXN1bHQgPSBbXTtcclxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyArK2kpIHtcclxuICAgICAgICAgICAgICAgIHZhciBoYXNFbGVtZW50ID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICB2YXIgZWxlbWVudCA9IGFyZ3VtZW50c1tpXTtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyBDaGVjayBpZiB3ZSd2ZSBhbHJlYWR5IHNlZW4gdGhpcyBlbGVtZW50LlxyXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCByZXN1bHQubGVuZ3RoOyArK2opIHtcclxuICAgICAgICAgICAgICAgICAgICBoYXNFbGVtZW50ID0gcmVzdWx0W2pdID09PSBlbGVtZW50O1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChoYXNFbGVtZW50KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAvLyBJZiB3ZSBkaWQgbm90IGZpbmQgaXQsIGFkZCBpdCB0byB0aGUgcmVzdWx0LlxyXG4gICAgICAgICAgICAgICAgaWYgKCFoYXNFbGVtZW50KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnB1c2goZWxlbWVudCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBleHBvcnRzLkZMQVRURU4gPSB1dGlscy5mbGF0dGVuO1xyXG5cclxuICAgICAgICBleHBvcnRzLkFSR1MyQVJSQVkgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMsIDApO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGV4cG9ydHMuUkVGRVJFTkNFID0gZnVuY3Rpb24gKGNvbnRleHQsIHJlZmVyZW5jZSkge1xyXG4gICAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAgICAgdmFyIHBhdGggPSByZWZlcmVuY2Uuc3BsaXQoJy4nKTtcclxuICAgICAgICAgICAgICAgIHZhciByZXN1bHQgPSBjb250ZXh0O1xyXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBwYXRoLmxlbmd0aDsgKytpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHN0ZXAgPSBwYXRoW2ldO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChzdGVwW3N0ZXAubGVuZ3RoIC0gMV0gPT09ICddJykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgb3BlbmluZyA9IHN0ZXAuaW5kZXhPZignWycpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgaW5kZXggPSBzdGVwLnN1YnN0cmluZyhvcGVuaW5nICsgMSwgc3RlcC5sZW5ndGggLSAxKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gcmVzdWx0W3N0ZXAuc3Vic3RyaW5nKDAsIG9wZW5pbmcpXVtpbmRleF07XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gcmVzdWx0W3N0ZXBdO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XHJcbiAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBleHBvcnRzLkpPSU4gPSBmdW5jdGlvbiAoYXJyYXksIHNlcGFyYXRvcikge1xyXG4gICAgICAgICAgICByZXR1cm4gYXJyYXkuam9pbihzZXBhcmF0b3IpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGV4cG9ydHMuTlVNQkVSUyA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgdmFyIHBvc3NpYmxlTnVtYmVycyA9IHV0aWxzLmZsYXR0ZW4oYXJndW1lbnRzKTtcclxuICAgICAgICAgICAgcmV0dXJuIHBvc3NpYmxlTnVtYmVycy5maWx0ZXIoZnVuY3Rpb24gKGVsKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdHlwZW9mIGVsID09PSAnbnVtYmVyJztcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZXhwb3J0cy5OVU1FUkFMID0gbnVsbDtcclxuXHJcbiAgICAgICAgcmV0dXJuIGV4cG9ydHM7XHJcbiAgICB9KSgpO1xyXG5cclxuICAgIGpleGNlbC5tZXRob2RzLnRleHQgPSAoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHZhciBleHBvcnRzID0ge307XHJcblxyXG4gICAgICAgIGV4cG9ydHMuQVNDID0gbnVsbDtcclxuXHJcbiAgICAgICAgZXhwb3J0cy5CQUhUVEVYVCA9IG51bGw7XHJcblxyXG4gICAgICAgIGV4cG9ydHMuQ0hBUiA9IGZ1bmN0aW9uIChudW1iZXIpIHtcclxuICAgICAgICAgICAgbnVtYmVyID0gdXRpbHMucGFyc2VOdW1iZXIobnVtYmVyKTtcclxuICAgICAgICAgICAgaWYgKG51bWJlciBpbnN0YW5jZW9mIEVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbnVtYmVyO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBTdHJpbmcuZnJvbUNoYXJDb2RlKG51bWJlcik7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZXhwb3J0cy5DTEVBTiA9IGZ1bmN0aW9uICh0ZXh0KSB7XHJcbiAgICAgICAgICAgIHRleHQgPSB0ZXh0IHx8ICcnO1xyXG4gICAgICAgICAgICB2YXIgcmUgPSAvW1xcMC1cXHgxRl0vZztcclxuICAgICAgICAgICAgcmV0dXJuIHRleHQucmVwbGFjZShyZSwgXCJcIik7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZXhwb3J0cy5DT0RFID0gZnVuY3Rpb24gKHRleHQpIHtcclxuICAgICAgICAgICAgdGV4dCA9IHRleHQgfHwgJyc7XHJcbiAgICAgICAgICAgIHJldHVybiB0ZXh0LmNoYXJDb2RlQXQoMCk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZXhwb3J0cy5DT05DQVRFTkFURSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgdmFyIGFyZ3MgPSB1dGlscy5mbGF0dGVuKGFyZ3VtZW50cyk7XHJcblxyXG4gICAgICAgICAgICB2YXIgdHJ1ZUZvdW5kID0gMDtcclxuICAgICAgICAgICAgd2hpbGUgKCh0cnVlRm91bmQgPSBhcmdzLmluZGV4T2YodHJ1ZSkpID4gLTEpIHtcclxuICAgICAgICAgICAgICAgIGFyZ3NbdHJ1ZUZvdW5kXSA9ICdUUlVFJztcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgdmFyIGZhbHNlRm91bmQgPSAwO1xyXG4gICAgICAgICAgICB3aGlsZSAoKGZhbHNlRm91bmQgPSBhcmdzLmluZGV4T2YoZmFsc2UpKSA+IC0xKSB7XHJcbiAgICAgICAgICAgICAgICBhcmdzW2ZhbHNlRm91bmRdID0gJ0ZBTFNFJztcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgcmV0dXJuIGFyZ3Muam9pbignJyk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZXhwb3J0cy5EQkNTID0gbnVsbDtcclxuXHJcbiAgICAgICAgZXhwb3J0cy5ET0xMQVIgPSBudWxsO1xyXG5cclxuICAgICAgICBleHBvcnRzLkVYQUNUID0gZnVuY3Rpb24gKHRleHQxLCB0ZXh0Mikge1xyXG4gICAgICAgICAgICByZXR1cm4gdGV4dDEgPT09IHRleHQyO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGV4cG9ydHMuRklORCA9IGZ1bmN0aW9uIChmaW5kX3RleHQsIHdpdGhpbl90ZXh0LCBwb3NpdGlvbikge1xyXG4gICAgICAgICAgICBwb3NpdGlvbiA9IChwb3NpdGlvbiA9PT0gdW5kZWZpbmVkKSA/IDAgOiBwb3NpdGlvbjtcclxuICAgICAgICAgICAgcmV0dXJuIHdpdGhpbl90ZXh0ID8gd2l0aGluX3RleHQuaW5kZXhPZihmaW5kX3RleHQsIHBvc2l0aW9uIC0gMSkgKyAxIDogbnVsbDtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBleHBvcnRzLkZJWEVEID0gbnVsbDtcclxuXHJcbiAgICAgICAgZXhwb3J0cy5IVE1MMlRFWFQgPSBmdW5jdGlvbiAodmFsdWUpIHtcclxuICAgICAgICAgICAgdmFyIHJlc3VsdCA9ICcnO1xyXG5cclxuICAgICAgICAgICAgaWYgKHZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAodmFsdWUgaW5zdGFuY2VvZiBBcnJheSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhbHVlLmZvckVhY2goZnVuY3Rpb24gKGxpbmUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3VsdCAhPT0gJycpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCArPSAnXFxuJztcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQgKz0gKGxpbmUucmVwbGFjZSgvPCg/Oi58XFxuKSo/Pi9nbSwgJycpKTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gdmFsdWUucmVwbGFjZSgvPCg/Oi58XFxuKSo/Pi9nbSwgJycpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGV4cG9ydHMuTEVGVCA9IGZ1bmN0aW9uICh0ZXh0LCBudW1iZXIpIHtcclxuICAgICAgICAgICAgbnVtYmVyID0gKG51bWJlciA9PT0gdW5kZWZpbmVkKSA/IDEgOiBudW1iZXI7XHJcbiAgICAgICAgICAgIG51bWJlciA9IHV0aWxzLnBhcnNlTnVtYmVyKG51bWJlcik7XHJcbiAgICAgICAgICAgIGlmIChudW1iZXIgaW5zdGFuY2VvZiBFcnJvciB8fCB0eXBlb2YgdGV4dCAhPT0gJ3N0cmluZycpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBlcnJvci52YWx1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gdGV4dCA/IHRleHQuc3Vic3RyaW5nKDAsIG51bWJlcikgOiBudWxsO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGV4cG9ydHMuTEVOID0gZnVuY3Rpb24gKHRleHQpIHtcclxuICAgICAgICAgICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT09IDApIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBlcnJvci5lcnJvcjtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKHR5cGVvZiB0ZXh0ID09PSAnc3RyaW5nJykge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRleHQgPyB0ZXh0Lmxlbmd0aCA6IDA7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmICh0ZXh0Lmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRleHQubGVuZ3RoO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gZXJyb3IudmFsdWU7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZXhwb3J0cy5MT1dFUiA9IGZ1bmN0aW9uICh0ZXh0KSB7XHJcbiAgICAgICAgICAgIGlmICh0eXBlb2YgdGV4dCAhPT0gJ3N0cmluZycpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBlcnJvci52YWx1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gdGV4dCA/IHRleHQudG9Mb3dlckNhc2UoKSA6IHRleHQ7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZXhwb3J0cy5NSUQgPSBmdW5jdGlvbiAodGV4dCwgc3RhcnQsIG51bWJlcikge1xyXG4gICAgICAgICAgICBzdGFydCA9IHV0aWxzLnBhcnNlTnVtYmVyKHN0YXJ0KTtcclxuICAgICAgICAgICAgbnVtYmVyID0gdXRpbHMucGFyc2VOdW1iZXIobnVtYmVyKTtcclxuICAgICAgICAgICAgaWYgKHV0aWxzLmFueUlzRXJyb3Ioc3RhcnQsIG51bWJlcikgfHwgdHlwZW9mIHRleHQgIT09ICdzdHJpbmcnKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbnVtYmVyO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB2YXIgYmVnaW4gPSBzdGFydCAtIDE7XHJcbiAgICAgICAgICAgIHZhciBlbmQgPSBiZWdpbiArIG51bWJlcjtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiB0ZXh0LnN1YnN0cmluZyhiZWdpbiwgZW5kKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBleHBvcnRzLk5VTUJFUlZBTFVFID0gbnVsbDtcclxuXHJcbiAgICAgICAgZXhwb3J0cy5QUk9ORVRJQyA9IG51bGw7XHJcblxyXG4gICAgICAgIGV4cG9ydHMuUFJPUEVSID0gZnVuY3Rpb24gKHRleHQpIHtcclxuICAgICAgICAgICAgaWYgKHRleHQgPT09IHVuZGVmaW5lZCB8fCB0ZXh0Lmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGVycm9yLnZhbHVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICh0ZXh0ID09PSB0cnVlKSB7XHJcbiAgICAgICAgICAgICAgICB0ZXh0ID0gJ1RSVUUnO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICh0ZXh0ID09PSBmYWxzZSkge1xyXG4gICAgICAgICAgICAgICAgdGV4dCA9ICdGQUxTRSc7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKGlzTmFOKHRleHQpICYmIHR5cGVvZiB0ZXh0ID09PSAnbnVtYmVyJykge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGVycm9yLnZhbHVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICh0eXBlb2YgdGV4dCA9PT0gJ251bWJlcicpIHtcclxuICAgICAgICAgICAgICAgIHRleHQgPSAnJyArIHRleHQ7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHJldHVybiB0ZXh0LnJlcGxhY2UoL1xcd1xcUyovZywgZnVuY3Rpb24gKHR4dCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHR4dC5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIHR4dC5zdWJzdHIoMSkudG9Mb3dlckNhc2UoKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZXhwb3J0cy5SRUdFWEVYVFJBQ1QgPSBmdW5jdGlvbiAodGV4dCwgcmVndWxhcl9leHByZXNzaW9uKSB7XHJcbiAgICAgICAgICAgIHZhciBtYXRjaCA9IHRleHQubWF0Y2gobmV3IFJlZ0V4cChyZWd1bGFyX2V4cHJlc3Npb24pKTtcclxuICAgICAgICAgICAgcmV0dXJuIG1hdGNoID8gKG1hdGNoW21hdGNoLmxlbmd0aCA+IDEgPyBtYXRjaC5sZW5ndGggLSAxIDogMF0pIDogbnVsbDtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBleHBvcnRzLlJFR0VYTUFUQ0ggPSBmdW5jdGlvbiAodGV4dCwgcmVndWxhcl9leHByZXNzaW9uLCBmdWxsKSB7XHJcbiAgICAgICAgICAgIHZhciBtYXRjaCA9IHRleHQubWF0Y2gobmV3IFJlZ0V4cChyZWd1bGFyX2V4cHJlc3Npb24pKTtcclxuICAgICAgICAgICAgcmV0dXJuIGZ1bGwgPyBtYXRjaCA6ICEhbWF0Y2g7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZXhwb3J0cy5SRUdFWFJFUExBQ0UgPSBmdW5jdGlvbiAodGV4dCwgcmVndWxhcl9leHByZXNzaW9uLCByZXBsYWNlbWVudCkge1xyXG4gICAgICAgICAgICByZXR1cm4gdGV4dC5yZXBsYWNlKG5ldyBSZWdFeHAocmVndWxhcl9leHByZXNzaW9uKSwgcmVwbGFjZW1lbnQpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGV4cG9ydHMuUkVQTEFDRSA9IGZ1bmN0aW9uICh0ZXh0LCBwb3NpdGlvbiwgbGVuZ3RoLCBuZXdfdGV4dCkge1xyXG4gICAgICAgICAgICBwb3NpdGlvbiA9IHV0aWxzLnBhcnNlTnVtYmVyKHBvc2l0aW9uKTtcclxuICAgICAgICAgICAgbGVuZ3RoID0gdXRpbHMucGFyc2VOdW1iZXIobGVuZ3RoKTtcclxuICAgICAgICAgICAgaWYgKHV0aWxzLmFueUlzRXJyb3IocG9zaXRpb24sIGxlbmd0aCkgfHxcclxuICAgICAgICAgICAgICAgIHR5cGVvZiB0ZXh0ICE9PSAnc3RyaW5nJyB8fFxyXG4gICAgICAgICAgICAgICAgdHlwZW9mIG5ld190ZXh0ICE9PSAnc3RyaW5nJykge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGVycm9yLnZhbHVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiB0ZXh0LnN1YnN0cigwLCBwb3NpdGlvbiAtIDEpICsgbmV3X3RleHQgKyB0ZXh0LnN1YnN0cihwb3NpdGlvbiAtIDEgKyBsZW5ndGgpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGV4cG9ydHMuUkVQVCA9IGZ1bmN0aW9uICh0ZXh0LCBudW1iZXIpIHtcclxuICAgICAgICAgICAgbnVtYmVyID0gdXRpbHMucGFyc2VOdW1iZXIobnVtYmVyKTtcclxuICAgICAgICAgICAgaWYgKG51bWJlciBpbnN0YW5jZW9mIEVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbnVtYmVyO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgQXJyYXkobnVtYmVyICsgMSkuam9pbih0ZXh0KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBleHBvcnRzLlJJR0hUID0gZnVuY3Rpb24gKHRleHQsIG51bWJlcikge1xyXG4gICAgICAgICAgICBudW1iZXIgPSAobnVtYmVyID09PSB1bmRlZmluZWQpID8gMSA6IG51bWJlcjtcclxuICAgICAgICAgICAgbnVtYmVyID0gdXRpbHMucGFyc2VOdW1iZXIobnVtYmVyKTtcclxuICAgICAgICAgICAgaWYgKG51bWJlciBpbnN0YW5jZW9mIEVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbnVtYmVyO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiB0ZXh0ID8gdGV4dC5zdWJzdHJpbmcodGV4dC5sZW5ndGggLSBudW1iZXIpIDogbnVsbDtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBleHBvcnRzLlNFQVJDSCA9IGZ1bmN0aW9uIChmaW5kX3RleHQsIHdpdGhpbl90ZXh0LCBwb3NpdGlvbikge1xyXG4gICAgICAgICAgICB2YXIgZm91bmRBdDtcclxuICAgICAgICAgICAgaWYgKHR5cGVvZiBmaW5kX3RleHQgIT09ICdzdHJpbmcnIHx8IHR5cGVvZiB3aXRoaW5fdGV4dCAhPT0gJ3N0cmluZycpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBlcnJvci52YWx1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBwb3NpdGlvbiA9IChwb3NpdGlvbiA9PT0gdW5kZWZpbmVkKSA/IDAgOiBwb3NpdGlvbjtcclxuICAgICAgICAgICAgZm91bmRBdCA9IHdpdGhpbl90ZXh0LnRvTG93ZXJDYXNlKCkuaW5kZXhPZihmaW5kX3RleHQudG9Mb3dlckNhc2UoKSwgcG9zaXRpb24gLSAxKSArIDE7XHJcbiAgICAgICAgICAgIHJldHVybiAoZm91bmRBdCA9PT0gMCkgPyBlcnJvci52YWx1ZSA6IGZvdW5kQXQ7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZXhwb3J0cy5TUExJVCA9IGZ1bmN0aW9uICh0ZXh0LCBzZXBhcmF0b3IpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRleHQuc3BsaXQoc2VwYXJhdG9yKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBleHBvcnRzLlNVQlNUSVRVVEUgPSBmdW5jdGlvbiAodGV4dCwgb2xkX3RleHQsIG5ld190ZXh0LCBvY2N1cnJlbmNlKSB7XHJcbiAgICAgICAgICAgIGlmICghdGV4dCB8fCAhb2xkX3RleHQgfHwgIW5ld190ZXh0KSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdGV4dDtcclxuICAgICAgICAgICAgfSBlbHNlIGlmIChvY2N1cnJlbmNlID09PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0ZXh0LnJlcGxhY2UobmV3IFJlZ0V4cChvbGRfdGV4dCwgJ2cnKSwgbmV3X3RleHQpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdmFyIGluZGV4ID0gMDtcclxuICAgICAgICAgICAgICAgIHZhciBpID0gMDtcclxuICAgICAgICAgICAgICAgIHdoaWxlICh0ZXh0LmluZGV4T2Yob2xkX3RleHQsIGluZGV4KSA+IDApIHtcclxuICAgICAgICAgICAgICAgICAgICBpbmRleCA9IHRleHQuaW5kZXhPZihvbGRfdGV4dCwgaW5kZXggKyAxKTtcclxuICAgICAgICAgICAgICAgICAgICBpKys7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGkgPT09IG9jY3VycmVuY2UpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRleHQuc3Vic3RyaW5nKDAsIGluZGV4KSArIG5ld190ZXh0ICsgdGV4dC5zdWJzdHJpbmcoaW5kZXggKyBvbGRfdGV4dC5sZW5ndGgpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGV4cG9ydHMuVCA9IGZ1bmN0aW9uICh2YWx1ZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gKHR5cGVvZiB2YWx1ZSA9PT0gXCJzdHJpbmdcIikgPyB2YWx1ZSA6ICcnO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGV4cG9ydHMuVEVYVCA9IG51bGw7XHJcblxyXG4gICAgICAgIGV4cG9ydHMuVFJJTSA9IGZ1bmN0aW9uICh0ZXh0KSB7XHJcbiAgICAgICAgICAgIGlmICh0eXBlb2YgdGV4dCAhPT0gJ3N0cmluZycpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBlcnJvci52YWx1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gdGV4dC5yZXBsYWNlKC8gKy9nLCAnICcpLnRyaW0oKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBleHBvcnRzLlVOSUNIQVIgPSBleHBvcnRzLkNIQVI7XHJcblxyXG4gICAgICAgIGV4cG9ydHMuVU5JQ09ERSA9IGV4cG9ydHMuQ09ERTtcclxuXHJcbiAgICAgICAgZXhwb3J0cy5VUFBFUiA9IGZ1bmN0aW9uICh0ZXh0KSB7XHJcbiAgICAgICAgICAgIGlmICh0eXBlb2YgdGV4dCAhPT0gJ3N0cmluZycpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBlcnJvci52YWx1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gdGV4dC50b1VwcGVyQ2FzZSgpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGV4cG9ydHMuVkFMVUUgPSBudWxsO1xyXG5cclxuICAgICAgICByZXR1cm4gZXhwb3J0cztcclxuICAgIH0pKCk7XHJcblxyXG4gICAgamV4Y2VsLm1ldGhvZHMuc3RhdHMgPSAoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHZhciBleHBvcnRzID0ge307XHJcblxyXG4gICAgICAgIHZhciBTUVJUMlBJID0gMi41MDY2MjgyNzQ2MzEwMDAyO1xyXG5cclxuICAgICAgICBleHBvcnRzLkFWRURFViA9IG51bGw7XHJcblxyXG4gICAgICAgIGV4cG9ydHMuQVZFUkFHRSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgdmFyIHJhbmdlID0gdXRpbHMubnVtYmVycyh1dGlscy5mbGF0dGVuKGFyZ3VtZW50cykpO1xyXG4gICAgICAgICAgICB2YXIgbiA9IHJhbmdlLmxlbmd0aDtcclxuICAgICAgICAgICAgdmFyIHN1bSA9IDA7XHJcbiAgICAgICAgICAgIHZhciBjb3VudCA9IDA7XHJcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbjsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICBzdW0gKz0gcmFuZ2VbaV07XHJcbiAgICAgICAgICAgICAgICBjb3VudCArPSAxO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBzdW0gLyBjb3VudDtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBleHBvcnRzLkFWRVJBR0VBID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICB2YXIgcmFuZ2UgPSB1dGlscy5mbGF0dGVuKGFyZ3VtZW50cyk7XHJcbiAgICAgICAgICAgIHZhciBuID0gcmFuZ2UubGVuZ3RoO1xyXG4gICAgICAgICAgICB2YXIgc3VtID0gMDtcclxuICAgICAgICAgICAgdmFyIGNvdW50ID0gMDtcclxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBuOyBpKyspIHtcclxuICAgICAgICAgICAgICAgIHZhciBlbCA9IHJhbmdlW2ldO1xyXG4gICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBlbCA9PT0gJ251bWJlcicpIHtcclxuICAgICAgICAgICAgICAgICAgICBzdW0gKz0gZWw7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAoZWwgPT09IHRydWUpIHtcclxuICAgICAgICAgICAgICAgICAgICBzdW0rKztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmIChlbCAhPT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvdW50Kys7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIHN1bSAvIGNvdW50O1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGV4cG9ydHMuQVZFUkFHRUlGID0gZnVuY3Rpb24gKHJhbmdlLCBjcml0ZXJpYSwgYXZlcmFnZV9yYW5nZSkge1xyXG4gICAgICAgICAgICBhdmVyYWdlX3JhbmdlID0gYXZlcmFnZV9yYW5nZSB8fCByYW5nZTtcclxuICAgICAgICAgICAgcmFuZ2UgPSB1dGlscy5mbGF0dGVuKHJhbmdlKTtcclxuICAgICAgICAgICAgYXZlcmFnZV9yYW5nZSA9IHV0aWxzLnBhcnNlTnVtYmVyQXJyYXkodXRpbHMuZmxhdHRlbihhdmVyYWdlX3JhbmdlKSk7XHJcbiAgICAgICAgICAgIGlmIChhdmVyYWdlX3JhbmdlIGluc3RhbmNlb2YgRXJyb3IpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBhdmVyYWdlX3JhbmdlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHZhciBhdmVyYWdlX2NvdW50ID0gMDtcclxuICAgICAgICAgICAgdmFyIHJlc3VsdCA9IDA7XHJcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcmFuZ2UubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgIGlmIChldmFsKHJhbmdlW2ldICsgY3JpdGVyaWEpKSB7IC8vIGpzaGludCBpZ25vcmU6bGluZVxyXG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdCArPSBhdmVyYWdlX3JhbmdlW2ldO1xyXG4gICAgICAgICAgICAgICAgICAgIGF2ZXJhZ2VfY291bnQrKztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gcmVzdWx0IC8gYXZlcmFnZV9jb3VudDtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBleHBvcnRzLkFWRVJBR0VJRlMgPSBudWxsO1xyXG5cclxuICAgICAgICBleHBvcnRzLkNPVU5UID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gdXRpbHMubnVtYmVycyh1dGlscy5mbGF0dGVuKGFyZ3VtZW50cykpLmxlbmd0aDtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBleHBvcnRzLkNPVU5UQSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgdmFyIHJhbmdlID0gdXRpbHMuZmxhdHRlbihhcmd1bWVudHMpO1xyXG4gICAgICAgICAgICByZXR1cm4gcmFuZ2UubGVuZ3RoIC0gZXhwb3J0cy5DT1VOVEJMQU5LKHJhbmdlKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBleHBvcnRzLkNPVU5USU4gPSBmdW5jdGlvbiAocmFuZ2UsIHZhbHVlKSB7XHJcbiAgICAgICAgICAgIHZhciByZXN1bHQgPSAwO1xyXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHJhbmdlLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAocmFuZ2VbaV0gPT09IHZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0Kys7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBleHBvcnRzLkNPVU5UQkxBTksgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHZhciByYW5nZSA9IHV0aWxzLmZsYXR0ZW4oYXJndW1lbnRzKTtcclxuICAgICAgICAgICAgdmFyIGJsYW5rcyA9IDA7XHJcbiAgICAgICAgICAgIHZhciBlbGVtZW50O1xyXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHJhbmdlLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICBlbGVtZW50ID0gcmFuZ2VbaV07XHJcbiAgICAgICAgICAgICAgICBpZiAoZWxlbWVudCA9PT0gbnVsbCB8fCBlbGVtZW50ID09PSAnJykge1xyXG4gICAgICAgICAgICAgICAgICAgIGJsYW5rcysrO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBibGFua3M7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZXhwb3J0cy5DT1VOVElGID0gZnVuY3Rpb24gKHJhbmdlLCBjcml0ZXJpYSkge1xyXG4gICAgICAgICAgICByYW5nZSA9IHV0aWxzLmZsYXR0ZW4ocmFuZ2UpO1xyXG4gICAgICAgICAgICBpZiAoIS9bPD49IV0vLnRlc3QoY3JpdGVyaWEpKSB7XHJcbiAgICAgICAgICAgICAgICBjcml0ZXJpYSA9ICc9PVwiJyArIGNyaXRlcmlhICsgJ1wiJztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB2YXIgbWF0Y2hlcyA9IDA7XHJcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcmFuZ2UubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgcmFuZ2VbaV0gIT09ICdzdHJpbmcnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGV2YWwocmFuZ2VbaV0gKyBjcml0ZXJpYSkpIHsgLy8ganNoaW50IGlnbm9yZTpsaW5lXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG1hdGNoZXMrKztcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChldmFsKCdcIicgKyByYW5nZVtpXSArICdcIicgKyBjcml0ZXJpYSkpIHsgLy8ganNoaW50IGlnbm9yZTpsaW5lXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG1hdGNoZXMrKztcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIG1hdGNoZXM7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZXhwb3J0cy5DT1VOVElGUyA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgdmFyIGFyZ3MgPSB1dGlscy5hcmdzVG9BcnJheShhcmd1bWVudHMpO1xyXG4gICAgICAgICAgICB2YXIgcmVzdWx0cyA9IG5ldyBBcnJheSh1dGlscy5mbGF0dGVuKGFyZ3NbMF0pLmxlbmd0aCk7XHJcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcmVzdWx0cy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgcmVzdWx0c1tpXSA9IHRydWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IGFyZ3MubGVuZ3RoOyBpICs9IDIpIHtcclxuICAgICAgICAgICAgICAgIHZhciByYW5nZSA9IHV0aWxzLmZsYXR0ZW4oYXJnc1tpXSk7XHJcbiAgICAgICAgICAgICAgICB2YXIgY3JpdGVyaWEgPSBhcmdzW2kgKyAxXTtcclxuICAgICAgICAgICAgICAgIGlmICghL1s8Pj0hXS8udGVzdChjcml0ZXJpYSkpIHtcclxuICAgICAgICAgICAgICAgICAgICBjcml0ZXJpYSA9ICc9PVwiJyArIGNyaXRlcmlhICsgJ1wiJztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgcmFuZ2UubGVuZ3RoOyBqKyspIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHJhbmdlW2pdICE9PSAnc3RyaW5nJykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHRzW2pdID0gcmVzdWx0c1tqXSAmJiBldmFsKHJhbmdlW2pdICsgY3JpdGVyaWEpOyAvLyBqc2hpbnQgaWdub3JlOmxpbmVcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHRzW2pdID0gcmVzdWx0c1tqXSAmJiBldmFsKCdcIicgKyByYW5nZVtqXSArICdcIicgKyBjcml0ZXJpYSk7IC8vIGpzaGludCBpZ25vcmU6bGluZVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB2YXIgcmVzdWx0ID0gMDtcclxuICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IHJlc3VsdHMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgIGlmIChyZXN1bHRzW2ldKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0Kys7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBleHBvcnRzLkNPVU5UVU5JUVVFID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gVU5JUVVFLmFwcGx5KG51bGwsIHV0aWxzLmZsYXR0ZW4oYXJndW1lbnRzKSkubGVuZ3RoO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGV4cG9ydHMuRklTSEVSID0gZnVuY3Rpb24gKHgpIHtcclxuICAgICAgICAgICAgeCA9IHV0aWxzLnBhcnNlTnVtYmVyKHgpO1xyXG4gICAgICAgICAgICBpZiAoeCBpbnN0YW5jZW9mIEVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4geDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gTWF0aC5sb2coKDEgKyB4KSAvICgxIC0geCkpIC8gMjtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBleHBvcnRzLkZJU0hFUklOViA9IGZ1bmN0aW9uICh5KSB7XHJcbiAgICAgICAgICAgIHkgPSB1dGlscy5wYXJzZU51bWJlcih5KTtcclxuICAgICAgICAgICAgaWYgKHkgaW5zdGFuY2VvZiBFcnJvcikge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdmFyIGUyeSA9IE1hdGguZXhwKDIgKiB5KTtcclxuICAgICAgICAgICAgcmV0dXJuIChlMnkgLSAxKSAvIChlMnkgKyAxKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBleHBvcnRzLkZSRVFVRU5DWSA9IGZ1bmN0aW9uIChkYXRhLCBiaW5zKSB7XHJcbiAgICAgICAgICAgIGRhdGEgPSB1dGlscy5wYXJzZU51bWJlckFycmF5KHV0aWxzLmZsYXR0ZW4oZGF0YSkpO1xyXG4gICAgICAgICAgICBiaW5zID0gdXRpbHMucGFyc2VOdW1iZXJBcnJheSh1dGlscy5mbGF0dGVuKGJpbnMpKTtcclxuICAgICAgICAgICAgaWYgKHV0aWxzLmFueUlzRXJyb3IoZGF0YSwgYmlucykpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBlcnJvci52YWx1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB2YXIgbiA9IGRhdGEubGVuZ3RoO1xyXG4gICAgICAgICAgICB2YXIgYiA9IGJpbnMubGVuZ3RoO1xyXG4gICAgICAgICAgICB2YXIgciA9IFtdO1xyXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8PSBiOyBpKyspIHtcclxuICAgICAgICAgICAgICAgIHJbaV0gPSAwO1xyXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBuOyBqKyspIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoaSA9PT0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YVtqXSA8PSBiaW5zWzBdKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByWzBdICs9IDE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGkgPCBiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkYXRhW2pdID4gYmluc1tpIC0gMV0gJiYgZGF0YVtqXSA8PSBiaW5zW2ldKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByW2ldICs9IDE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGkgPT09IGIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGFbal0gPiBiaW5zW2IgLSAxXSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcltiXSArPSAxO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiByO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGV4cG9ydHMuTEFSR0UgPSBmdW5jdGlvbiAocmFuZ2UsIGspIHtcclxuICAgICAgICAgICAgcmFuZ2UgPSB1dGlscy5wYXJzZU51bWJlckFycmF5KHV0aWxzLmZsYXR0ZW4ocmFuZ2UpKTtcclxuICAgICAgICAgICAgayA9IHV0aWxzLnBhcnNlTnVtYmVyKGspO1xyXG4gICAgICAgICAgICBpZiAodXRpbHMuYW55SXNFcnJvcihyYW5nZSwgaykpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiByYW5nZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gcmFuZ2Uuc29ydChmdW5jdGlvbiAoYSwgYikge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGIgLSBhO1xyXG4gICAgICAgICAgICB9KVtrIC0gMV07XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZXhwb3J0cy5NQVggPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHZhciByYW5nZSA9IHV0aWxzLm51bWJlcnModXRpbHMuZmxhdHRlbihhcmd1bWVudHMpKTtcclxuICAgICAgICAgICAgcmV0dXJuIChyYW5nZS5sZW5ndGggPT09IDApID8gMCA6IE1hdGgubWF4LmFwcGx5KE1hdGgsIHJhbmdlKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBleHBvcnRzLk1BWEEgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHZhciByYW5nZSA9IHV0aWxzLmFycmF5VmFsdWVzVG9OdW1iZXJzKHV0aWxzLmZsYXR0ZW4oYXJndW1lbnRzKSk7XHJcbiAgICAgICAgICAgIHJldHVybiAocmFuZ2UubGVuZ3RoID09PSAwKSA/IDAgOiBNYXRoLm1heC5hcHBseShNYXRoLCByYW5nZSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZXhwb3J0cy5NSU4gPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHZhciByYW5nZSA9IHV0aWxzLm51bWJlcnModXRpbHMuZmxhdHRlbihhcmd1bWVudHMpKTtcclxuICAgICAgICAgICAgcmV0dXJuIChyYW5nZS5sZW5ndGggPT09IDApID8gMCA6IE1hdGgubWluLmFwcGx5KE1hdGgsIHJhbmdlKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBleHBvcnRzLk1JTkEgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHZhciByYW5nZSA9IHV0aWxzLmFycmF5VmFsdWVzVG9OdW1iZXJzKHV0aWxzLmZsYXR0ZW4oYXJndW1lbnRzKSk7XHJcbiAgICAgICAgICAgIHJldHVybiAocmFuZ2UubGVuZ3RoID09PSAwKSA/IDAgOiBNYXRoLm1pbi5hcHBseShNYXRoLCByYW5nZSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZXhwb3J0cy5NT0RFID0ge307XHJcblxyXG4gICAgICAgIGV4cG9ydHMuTU9ERS5NVUxUID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAvLyBDcmVkaXRzOiBSb8ODwrZuYcODwqRuXHJcbiAgICAgICAgICAgIHZhciByYW5nZSA9IHV0aWxzLnBhcnNlTnVtYmVyQXJyYXkodXRpbHMuZmxhdHRlbihhcmd1bWVudHMpKTtcclxuICAgICAgICAgICAgaWYgKHJhbmdlIGluc3RhbmNlb2YgRXJyb3IpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiByYW5nZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB2YXIgbiA9IHJhbmdlLmxlbmd0aDtcclxuICAgICAgICAgICAgdmFyIGNvdW50ID0ge307XHJcbiAgICAgICAgICAgIHZhciBtYXhJdGVtcyA9IFtdO1xyXG4gICAgICAgICAgICB2YXIgbWF4ID0gMDtcclxuICAgICAgICAgICAgdmFyIGN1cnJlbnRJdGVtO1xyXG5cclxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBuOyBpKyspIHtcclxuICAgICAgICAgICAgICAgIGN1cnJlbnRJdGVtID0gcmFuZ2VbaV07XHJcbiAgICAgICAgICAgICAgICBjb3VudFtjdXJyZW50SXRlbV0gPSBjb3VudFtjdXJyZW50SXRlbV0gPyBjb3VudFtjdXJyZW50SXRlbV0gKyAxIDogMTtcclxuICAgICAgICAgICAgICAgIGlmIChjb3VudFtjdXJyZW50SXRlbV0gPiBtYXgpIHtcclxuICAgICAgICAgICAgICAgICAgICBtYXggPSBjb3VudFtjdXJyZW50SXRlbV07XHJcbiAgICAgICAgICAgICAgICAgICAgbWF4SXRlbXMgPSBbXTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmIChjb3VudFtjdXJyZW50SXRlbV0gPT09IG1heCkge1xyXG4gICAgICAgICAgICAgICAgICAgIG1heEl0ZW1zW21heEl0ZW1zLmxlbmd0aF0gPSBjdXJyZW50SXRlbTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gbWF4SXRlbXM7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZXhwb3J0cy5NT0RFLlNOR0wgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHZhciByYW5nZSA9IHV0aWxzLnBhcnNlTnVtYmVyQXJyYXkodXRpbHMuZmxhdHRlbihhcmd1bWVudHMpKTtcclxuICAgICAgICAgICAgaWYgKHJhbmdlIGluc3RhbmNlb2YgRXJyb3IpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiByYW5nZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gZXhwb3J0cy5NT0RFLk1VTFQocmFuZ2UpLnNvcnQoZnVuY3Rpb24gKGEsIGIpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBhIC0gYjtcclxuICAgICAgICAgICAgfSlbMF07XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZXhwb3J0cy5QRVJDRU5USUxFID0ge307XHJcblxyXG4gICAgICAgIGV4cG9ydHMuUEVSQ0VOVElMRS5FWEMgPSBmdW5jdGlvbiAoYXJyYXksIGspIHtcclxuICAgICAgICAgICAgYXJyYXkgPSB1dGlscy5wYXJzZU51bWJlckFycmF5KHV0aWxzLmZsYXR0ZW4oYXJyYXkpKTtcclxuICAgICAgICAgICAgayA9IHV0aWxzLnBhcnNlTnVtYmVyKGspO1xyXG4gICAgICAgICAgICBpZiAodXRpbHMuYW55SXNFcnJvcihhcnJheSwgaykpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBlcnJvci52YWx1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBhcnJheSA9IGFycmF5LnNvcnQoZnVuY3Rpb24gKGEsIGIpIHtcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gYSAtIGI7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB2YXIgbiA9IGFycmF5Lmxlbmd0aDtcclxuICAgICAgICAgICAgaWYgKGsgPCAxIC8gKG4gKyAxKSB8fCBrID4gMSAtIDEgLyAobiArIDEpKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZXJyb3IubnVtO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHZhciBsID0gayAqIChuICsgMSkgLSAxO1xyXG4gICAgICAgICAgICB2YXIgZmwgPSBNYXRoLmZsb29yKGwpO1xyXG4gICAgICAgICAgICByZXR1cm4gdXRpbHMuY2xlYW5GbG9hdCgobCA9PT0gZmwpID8gYXJyYXlbbF0gOiBhcnJheVtmbF0gKyAobCAtIGZsKSAqIChhcnJheVtmbCArIDFdIC0gYXJyYXlbZmxdKSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZXhwb3J0cy5QRVJDRU5USUxFLklOQyA9IGZ1bmN0aW9uIChhcnJheSwgaykge1xyXG4gICAgICAgICAgICBhcnJheSA9IHV0aWxzLnBhcnNlTnVtYmVyQXJyYXkodXRpbHMuZmxhdHRlbihhcnJheSkpO1xyXG4gICAgICAgICAgICBrID0gdXRpbHMucGFyc2VOdW1iZXIoayk7XHJcbiAgICAgICAgICAgIGlmICh1dGlscy5hbnlJc0Vycm9yKGFycmF5LCBrKSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGVycm9yLnZhbHVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGFycmF5ID0gYXJyYXkuc29ydChmdW5jdGlvbiAoYSwgYikge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGEgLSBiO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgdmFyIG4gPSBhcnJheS5sZW5ndGg7XHJcbiAgICAgICAgICAgIHZhciBsID0gayAqIChuIC0gMSk7XHJcbiAgICAgICAgICAgIHZhciBmbCA9IE1hdGguZmxvb3IobCk7XHJcbiAgICAgICAgICAgIHJldHVybiB1dGlscy5jbGVhbkZsb2F0KChsID09PSBmbCkgPyBhcnJheVtsXSA6IGFycmF5W2ZsXSArIChsIC0gZmwpICogKGFycmF5W2ZsICsgMV0gLSBhcnJheVtmbF0pKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBleHBvcnRzLlBFUkNFTlRSQU5LID0ge307XHJcblxyXG4gICAgICAgIGV4cG9ydHMuUEVSQ0VOVFJBTksuRVhDID0gZnVuY3Rpb24gKGFycmF5LCB4LCBzaWduaWZpY2FuY2UpIHtcclxuICAgICAgICAgICAgc2lnbmlmaWNhbmNlID0gKHNpZ25pZmljYW5jZSA9PT0gdW5kZWZpbmVkKSA/IDMgOiBzaWduaWZpY2FuY2U7XHJcbiAgICAgICAgICAgIGFycmF5ID0gdXRpbHMucGFyc2VOdW1iZXJBcnJheSh1dGlscy5mbGF0dGVuKGFycmF5KSk7XHJcbiAgICAgICAgICAgIHggPSB1dGlscy5wYXJzZU51bWJlcih4KTtcclxuICAgICAgICAgICAgc2lnbmlmaWNhbmNlID0gdXRpbHMucGFyc2VOdW1iZXIoc2lnbmlmaWNhbmNlKTtcclxuICAgICAgICAgICAgaWYgKHV0aWxzLmFueUlzRXJyb3IoYXJyYXksIHgsIHNpZ25pZmljYW5jZSkpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBlcnJvci52YWx1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBhcnJheSA9IGFycmF5LnNvcnQoZnVuY3Rpb24gKGEsIGIpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBhIC0gYjtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIHZhciB1bmlxdWVzID0gVU5JUVVFLmFwcGx5KG51bGwsIGFycmF5KTtcclxuICAgICAgICAgICAgdmFyIG4gPSBhcnJheS5sZW5ndGg7XHJcbiAgICAgICAgICAgIHZhciBtID0gdW5pcXVlcy5sZW5ndGg7XHJcbiAgICAgICAgICAgIHZhciBwb3dlciA9IE1hdGgucG93KDEwLCBzaWduaWZpY2FuY2UpO1xyXG4gICAgICAgICAgICB2YXIgcmVzdWx0ID0gMDtcclxuICAgICAgICAgICAgdmFyIG1hdGNoID0gZmFsc2U7XHJcbiAgICAgICAgICAgIHZhciBpID0gMDtcclxuICAgICAgICAgICAgd2hpbGUgKCFtYXRjaCAmJiBpIDwgbSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKHggPT09IHVuaXF1ZXNbaV0pIHtcclxuICAgICAgICAgICAgICAgICAgICByZXN1bHQgPSAoYXJyYXkuaW5kZXhPZih1bmlxdWVzW2ldKSArIDEpIC8gKG4gKyAxKTtcclxuICAgICAgICAgICAgICAgICAgICBtYXRjaCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHggPj0gdW5pcXVlc1tpXSAmJiAoeCA8IHVuaXF1ZXNbaSArIDFdIHx8IGkgPT09IG0gLSAxKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IChhcnJheS5pbmRleE9mKHVuaXF1ZXNbaV0pICsgMSArICh4IC0gdW5pcXVlc1tpXSkgLyAodW5pcXVlc1tpICsgMV0gLSB1bmlxdWVzW2ldKSkgLyAobiArIDEpO1xyXG4gICAgICAgICAgICAgICAgICAgIG1hdGNoID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGkrKztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gTWF0aC5mbG9vcihyZXN1bHQgKiBwb3dlcikgLyBwb3dlcjtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBleHBvcnRzLlBFUkNFTlRSQU5LLklOQyA9IGZ1bmN0aW9uIChhcnJheSwgeCwgc2lnbmlmaWNhbmNlKSB7XHJcbiAgICAgICAgICAgIHNpZ25pZmljYW5jZSA9IChzaWduaWZpY2FuY2UgPT09IHVuZGVmaW5lZCkgPyAzIDogc2lnbmlmaWNhbmNlO1xyXG4gICAgICAgICAgICBhcnJheSA9IHV0aWxzLnBhcnNlTnVtYmVyQXJyYXkodXRpbHMuZmxhdHRlbihhcnJheSkpO1xyXG4gICAgICAgICAgICB4ID0gdXRpbHMucGFyc2VOdW1iZXIoeCk7XHJcbiAgICAgICAgICAgIHNpZ25pZmljYW5jZSA9IHV0aWxzLnBhcnNlTnVtYmVyKHNpZ25pZmljYW5jZSk7XHJcbiAgICAgICAgICAgIGlmICh1dGlscy5hbnlJc0Vycm9yKGFycmF5LCB4LCBzaWduaWZpY2FuY2UpKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZXJyb3IudmFsdWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgYXJyYXkgPSBhcnJheS5zb3J0KGZ1bmN0aW9uIChhLCBiKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gYSAtIGI7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB2YXIgdW5pcXVlcyA9IFVOSVFVRS5hcHBseShudWxsLCBhcnJheSk7XHJcbiAgICAgICAgICAgIHZhciBuID0gYXJyYXkubGVuZ3RoO1xyXG4gICAgICAgICAgICB2YXIgbSA9IHVuaXF1ZXMubGVuZ3RoO1xyXG4gICAgICAgICAgICB2YXIgcG93ZXIgPSBNYXRoLnBvdygxMCwgc2lnbmlmaWNhbmNlKTtcclxuICAgICAgICAgICAgdmFyIHJlc3VsdCA9IDA7XHJcbiAgICAgICAgICAgIHZhciBtYXRjaCA9IGZhbHNlO1xyXG4gICAgICAgICAgICB2YXIgaSA9IDA7XHJcbiAgICAgICAgICAgIHdoaWxlICghbWF0Y2ggJiYgaSA8IG0pIHtcclxuICAgICAgICAgICAgICAgIGlmICh4ID09PSB1bmlxdWVzW2ldKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gYXJyYXkuaW5kZXhPZih1bmlxdWVzW2ldKSAvIChuIC0gMSk7XHJcbiAgICAgICAgICAgICAgICAgICAgbWF0Y2ggPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmICh4ID49IHVuaXF1ZXNbaV0gJiYgKHggPCB1bmlxdWVzW2kgKyAxXSB8fCBpID09PSBtIC0gMSkpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXN1bHQgPSAoYXJyYXkuaW5kZXhPZih1bmlxdWVzW2ldKSArICh4IC0gdW5pcXVlc1tpXSkgLyAodW5pcXVlc1tpICsgMV0gLSB1bmlxdWVzW2ldKSkgLyAobiAtIDEpO1xyXG4gICAgICAgICAgICAgICAgICAgIG1hdGNoID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGkrKztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gTWF0aC5mbG9vcihyZXN1bHQgKiBwb3dlcikgLyBwb3dlcjtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBleHBvcnRzLlBFUk1VVCA9IGZ1bmN0aW9uIChudW1iZXIsIG51bWJlcl9jaG9zZW4pIHtcclxuICAgICAgICAgICAgbnVtYmVyID0gdXRpbHMucGFyc2VOdW1iZXIobnVtYmVyKTtcclxuICAgICAgICAgICAgbnVtYmVyX2Nob3NlbiA9IHV0aWxzLnBhcnNlTnVtYmVyKG51bWJlcl9jaG9zZW4pO1xyXG4gICAgICAgICAgICBpZiAodXRpbHMuYW55SXNFcnJvcihudW1iZXIsIG51bWJlcl9jaG9zZW4pKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZXJyb3IudmFsdWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIEZBQ1QobnVtYmVyKSAvIEZBQ1QobnVtYmVyIC0gbnVtYmVyX2Nob3Nlbik7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZXhwb3J0cy5QRVJNVVRBVElPTkEgPSBmdW5jdGlvbiAobnVtYmVyLCBudW1iZXJfY2hvc2VuKSB7XHJcbiAgICAgICAgICAgIG51bWJlciA9IHV0aWxzLnBhcnNlTnVtYmVyKG51bWJlcik7XHJcbiAgICAgICAgICAgIG51bWJlcl9jaG9zZW4gPSB1dGlscy5wYXJzZU51bWJlcihudW1iZXJfY2hvc2VuKTtcclxuICAgICAgICAgICAgaWYgKHV0aWxzLmFueUlzRXJyb3IobnVtYmVyLCBudW1iZXJfY2hvc2VuKSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGVycm9yLnZhbHVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBNYXRoLnBvdyhudW1iZXIsIG51bWJlcl9jaG9zZW4pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGV4cG9ydHMuUEhJID0gZnVuY3Rpb24gKHgpIHtcclxuICAgICAgICAgICAgeCA9IHV0aWxzLnBhcnNlTnVtYmVyKHgpO1xyXG4gICAgICAgICAgICBpZiAoeCBpbnN0YW5jZW9mIEVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZXJyb3IudmFsdWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIE1hdGguZXhwKC0wLjUgKiB4ICogeCkgLyBTUVJUMlBJO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGV4cG9ydHMuUFJPQiA9IGZ1bmN0aW9uIChyYW5nZSwgcHJvYmFiaWxpdHksIGxvd2VyLCB1cHBlcikge1xyXG4gICAgICAgICAgICBpZiAobG93ZXIgPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIDA7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdXBwZXIgPSAodXBwZXIgPT09IHVuZGVmaW5lZCkgPyBsb3dlciA6IHVwcGVyO1xyXG5cclxuICAgICAgICAgICAgcmFuZ2UgPSB1dGlscy5wYXJzZU51bWJlckFycmF5KHV0aWxzLmZsYXR0ZW4ocmFuZ2UpKTtcclxuICAgICAgICAgICAgcHJvYmFiaWxpdHkgPSB1dGlscy5wYXJzZU51bWJlckFycmF5KHV0aWxzLmZsYXR0ZW4ocHJvYmFiaWxpdHkpKTtcclxuICAgICAgICAgICAgbG93ZXIgPSB1dGlscy5wYXJzZU51bWJlcihsb3dlcik7XHJcbiAgICAgICAgICAgIHVwcGVyID0gdXRpbHMucGFyc2VOdW1iZXIodXBwZXIpO1xyXG4gICAgICAgICAgICBpZiAodXRpbHMuYW55SXNFcnJvcihyYW5nZSwgcHJvYmFiaWxpdHksIGxvd2VyLCB1cHBlcikpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBlcnJvci52YWx1ZTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKGxvd2VyID09PSB1cHBlcikge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIChyYW5nZS5pbmRleE9mKGxvd2VyKSA+PSAwKSA/IHByb2JhYmlsaXR5W3JhbmdlLmluZGV4T2YobG93ZXIpXSA6IDA7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHZhciBzb3J0ZWQgPSByYW5nZS5zb3J0KGZ1bmN0aW9uIChhLCBiKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gYSAtIGI7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB2YXIgbiA9IHNvcnRlZC5sZW5ndGg7XHJcbiAgICAgICAgICAgIHZhciByZXN1bHQgPSAwO1xyXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG47IGkrKykge1xyXG4gICAgICAgICAgICAgICAgaWYgKHNvcnRlZFtpXSA+PSBsb3dlciAmJiBzb3J0ZWRbaV0gPD0gdXBwZXIpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXN1bHQgKz0gcHJvYmFiaWxpdHlbcmFuZ2UuaW5kZXhPZihzb3J0ZWRbaV0pXTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGV4cG9ydHMuUVVBUlRJTEUgPSB7fTtcclxuXHJcbiAgICAgICAgZXhwb3J0cy5RVUFSVElMRS5FWEMgPSBmdW5jdGlvbiAocmFuZ2UsIHF1YXJ0KSB7XHJcbiAgICAgICAgICAgIHJhbmdlID0gdXRpbHMucGFyc2VOdW1iZXJBcnJheSh1dGlscy5mbGF0dGVuKHJhbmdlKSk7XHJcbiAgICAgICAgICAgIHF1YXJ0ID0gdXRpbHMucGFyc2VOdW1iZXIocXVhcnQpO1xyXG4gICAgICAgICAgICBpZiAodXRpbHMuYW55SXNFcnJvcihyYW5nZSwgcXVhcnQpKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZXJyb3IudmFsdWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgc3dpdGNoIChxdWFydCkge1xyXG4gICAgICAgICAgICAgICAgY2FzZSAxOlxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBleHBvcnRzLlBFUkNFTlRJTEUuRVhDKHJhbmdlLCAwLjI1KTtcclxuICAgICAgICAgICAgICAgIGNhc2UgMjpcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZXhwb3J0cy5QRVJDRU5USUxFLkVYQyhyYW5nZSwgMC41KTtcclxuICAgICAgICAgICAgICAgIGNhc2UgMzpcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZXhwb3J0cy5QRVJDRU5USUxFLkVYQyhyYW5nZSwgMC43NSk7XHJcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBlcnJvci5udW07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBleHBvcnRzLlFVQVJUSUxFLklOQyA9IGZ1bmN0aW9uIChyYW5nZSwgcXVhcnQpIHtcclxuICAgICAgICAgICAgcmFuZ2UgPSB1dGlscy5wYXJzZU51bWJlckFycmF5KHV0aWxzLmZsYXR0ZW4ocmFuZ2UpKTtcclxuICAgICAgICAgICAgcXVhcnQgPSB1dGlscy5wYXJzZU51bWJlcihxdWFydCk7XHJcbiAgICAgICAgICAgIGlmICh1dGlscy5hbnlJc0Vycm9yKHJhbmdlLCBxdWFydCkpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBlcnJvci52YWx1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBzd2l0Y2ggKHF1YXJ0KSB7XHJcbiAgICAgICAgICAgICAgICBjYXNlIDE6XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGV4cG9ydHMuUEVSQ0VOVElMRS5JTkMocmFuZ2UsIDAuMjUpO1xyXG4gICAgICAgICAgICAgICAgY2FzZSAyOlxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBleHBvcnRzLlBFUkNFTlRJTEUuSU5DKHJhbmdlLCAwLjUpO1xyXG4gICAgICAgICAgICAgICAgY2FzZSAzOlxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBleHBvcnRzLlBFUkNFTlRJTEUuSU5DKHJhbmdlLCAwLjc1KTtcclxuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGVycm9yLm51bTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGV4cG9ydHMuUkFOSyA9IHt9O1xyXG5cclxuICAgICAgICBleHBvcnRzLlJBTksuQVZHID0gZnVuY3Rpb24gKG51bWJlciwgcmFuZ2UsIG9yZGVyKSB7XHJcbiAgICAgICAgICAgIG51bWJlciA9IHV0aWxzLnBhcnNlTnVtYmVyKG51bWJlcik7XHJcbiAgICAgICAgICAgIHJhbmdlID0gdXRpbHMucGFyc2VOdW1iZXJBcnJheSh1dGlscy5mbGF0dGVuKHJhbmdlKSk7XHJcbiAgICAgICAgICAgIGlmICh1dGlscy5hbnlJc0Vycm9yKG51bWJlciwgcmFuZ2UpKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZXJyb3IudmFsdWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmFuZ2UgPSB1dGlscy5mbGF0dGVuKHJhbmdlKTtcclxuICAgICAgICAgICAgb3JkZXIgPSBvcmRlciB8fCBmYWxzZTtcclxuICAgICAgICAgICAgdmFyIHNvcnQgPSAob3JkZXIpID8gZnVuY3Rpb24gKGEsIGIpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBhIC0gYjtcclxuICAgICAgICAgICAgfSA6IGZ1bmN0aW9uIChhLCBiKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gYiAtIGE7XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIHJhbmdlID0gcmFuZ2Uuc29ydChzb3J0KTtcclxuXHJcbiAgICAgICAgICAgIHZhciBsZW5ndGggPSByYW5nZS5sZW5ndGg7XHJcbiAgICAgICAgICAgIHZhciBjb3VudCA9IDA7XHJcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgIGlmIChyYW5nZVtpXSA9PT0gbnVtYmVyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY291bnQrKztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgcmV0dXJuIChjb3VudCA+IDEpID8gKDIgKiByYW5nZS5pbmRleE9mKG51bWJlcikgKyBjb3VudCArIDEpIC8gMiA6IHJhbmdlLmluZGV4T2YobnVtYmVyKSArIDE7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZXhwb3J0cy5SQU5LLkVRID0gZnVuY3Rpb24gKG51bWJlciwgcmFuZ2UsIG9yZGVyKSB7XHJcbiAgICAgICAgICAgIG51bWJlciA9IHV0aWxzLnBhcnNlTnVtYmVyKG51bWJlcik7XHJcbiAgICAgICAgICAgIHJhbmdlID0gdXRpbHMucGFyc2VOdW1iZXJBcnJheSh1dGlscy5mbGF0dGVuKHJhbmdlKSk7XHJcbiAgICAgICAgICAgIGlmICh1dGlscy5hbnlJc0Vycm9yKG51bWJlciwgcmFuZ2UpKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZXJyb3IudmFsdWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgb3JkZXIgPSBvcmRlciB8fCBmYWxzZTtcclxuICAgICAgICAgICAgdmFyIHNvcnQgPSAob3JkZXIpID8gZnVuY3Rpb24gKGEsIGIpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBhIC0gYjtcclxuICAgICAgICAgICAgfSA6IGZ1bmN0aW9uIChhLCBiKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gYiAtIGE7XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIHJhbmdlID0gcmFuZ2Uuc29ydChzb3J0KTtcclxuICAgICAgICAgICAgcmV0dXJuIHJhbmdlLmluZGV4T2YobnVtYmVyKSArIDE7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZXhwb3J0cy5SU1EgPSBmdW5jdGlvbiAoZGF0YV94LCBkYXRhX3kpIHsgLy8gbm8gbmVlZCB0byBmbGF0dGVuIGhlcmUsIFBFQVJTT04gd2lsbCB0YWtlIGNhcmUgb2YgdGhhdFxyXG4gICAgICAgICAgICBkYXRhX3ggPSB1dGlscy5wYXJzZU51bWJlckFycmF5KHV0aWxzLmZsYXR0ZW4oZGF0YV94KSk7XHJcbiAgICAgICAgICAgIGRhdGFfeSA9IHV0aWxzLnBhcnNlTnVtYmVyQXJyYXkodXRpbHMuZmxhdHRlbihkYXRhX3kpKTtcclxuICAgICAgICAgICAgaWYgKHV0aWxzLmFueUlzRXJyb3IoZGF0YV94LCBkYXRhX3kpKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZXJyb3IudmFsdWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIE1hdGgucG93KGV4cG9ydHMuUEVBUlNPTihkYXRhX3gsIGRhdGFfeSksIDIpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGV4cG9ydHMuU01BTEwgPSBmdW5jdGlvbiAocmFuZ2UsIGspIHtcclxuICAgICAgICAgICAgcmFuZ2UgPSB1dGlscy5wYXJzZU51bWJlckFycmF5KHV0aWxzLmZsYXR0ZW4ocmFuZ2UpKTtcclxuICAgICAgICAgICAgayA9IHV0aWxzLnBhcnNlTnVtYmVyKGspO1xyXG4gICAgICAgICAgICBpZiAodXRpbHMuYW55SXNFcnJvcihyYW5nZSwgaykpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiByYW5nZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gcmFuZ2Uuc29ydChmdW5jdGlvbiAoYSwgYikge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGEgLSBiO1xyXG4gICAgICAgICAgICB9KVtrIC0gMV07XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZXhwb3J0cy5TVEFOREFSRElaRSA9IGZ1bmN0aW9uICh4LCBtZWFuLCBzZCkge1xyXG4gICAgICAgICAgICB4ID0gdXRpbHMucGFyc2VOdW1iZXIoeCk7XHJcbiAgICAgICAgICAgIG1lYW4gPSB1dGlscy5wYXJzZU51bWJlcihtZWFuKTtcclxuICAgICAgICAgICAgc2QgPSB1dGlscy5wYXJzZU51bWJlcihzZCk7XHJcbiAgICAgICAgICAgIGlmICh1dGlscy5hbnlJc0Vycm9yKHgsIG1lYW4sIHNkKSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGVycm9yLnZhbHVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiAoeCAtIG1lYW4pIC8gc2Q7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZXhwb3J0cy5TVERFViA9IHt9O1xyXG5cclxuICAgICAgICBleHBvcnRzLlNUREVWLlAgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHZhciB2ID0gZXhwb3J0cy5WQVIuUC5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xyXG4gICAgICAgICAgICByZXR1cm4gTWF0aC5zcXJ0KHYpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGV4cG9ydHMuU1RERVYuUyA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgdmFyIHYgPSBleHBvcnRzLlZBUi5TLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XHJcbiAgICAgICAgICAgIHJldHVybiBNYXRoLnNxcnQodik7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZXhwb3J0cy5TVERFVkEgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHZhciB2ID0gZXhwb3J0cy5WQVJBLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XHJcbiAgICAgICAgICAgIHJldHVybiBNYXRoLnNxcnQodik7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZXhwb3J0cy5TVERFVlBBID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICB2YXIgdiA9IGV4cG9ydHMuVkFSUEEuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcclxuICAgICAgICAgICAgcmV0dXJuIE1hdGguc3FydCh2KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBleHBvcnRzLlZBUiA9IHt9O1xyXG5cclxuICAgICAgICBleHBvcnRzLlZBUi5QID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICB2YXIgcmFuZ2UgPSB1dGlscy5udW1iZXJzKHV0aWxzLmZsYXR0ZW4oYXJndW1lbnRzKSk7XHJcbiAgICAgICAgICAgIHZhciBuID0gcmFuZ2UubGVuZ3RoO1xyXG4gICAgICAgICAgICB2YXIgc2lnbWEgPSAwO1xyXG4gICAgICAgICAgICB2YXIgbWVhbiA9IGV4cG9ydHMuQVZFUkFHRShyYW5nZSk7XHJcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbjsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICBzaWdtYSArPSBNYXRoLnBvdyhyYW5nZVtpXSAtIG1lYW4sIDIpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBzaWdtYSAvIG47XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZXhwb3J0cy5WQVIuUyA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgdmFyIHJhbmdlID0gdXRpbHMubnVtYmVycyh1dGlscy5mbGF0dGVuKGFyZ3VtZW50cykpO1xyXG4gICAgICAgICAgICB2YXIgbiA9IHJhbmdlLmxlbmd0aDtcclxuICAgICAgICAgICAgdmFyIHNpZ21hID0gMDtcclxuICAgICAgICAgICAgdmFyIG1lYW4gPSBleHBvcnRzLkFWRVJBR0UocmFuZ2UpO1xyXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG47IGkrKykge1xyXG4gICAgICAgICAgICAgICAgc2lnbWEgKz0gTWF0aC5wb3cocmFuZ2VbaV0gLSBtZWFuLCAyKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gc2lnbWEgLyAobiAtIDEpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGV4cG9ydHMuVkFSQSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgdmFyIHJhbmdlID0gdXRpbHMuZmxhdHRlbihhcmd1bWVudHMpO1xyXG4gICAgICAgICAgICB2YXIgbiA9IHJhbmdlLmxlbmd0aDtcclxuICAgICAgICAgICAgdmFyIHNpZ21hID0gMDtcclxuICAgICAgICAgICAgdmFyIGNvdW50ID0gMDtcclxuICAgICAgICAgICAgdmFyIG1lYW4gPSBleHBvcnRzLkFWRVJBR0VBKHJhbmdlKTtcclxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBuOyBpKyspIHtcclxuICAgICAgICAgICAgICAgIHZhciBlbCA9IHJhbmdlW2ldO1xyXG4gICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBlbCA9PT0gJ251bWJlcicpIHtcclxuICAgICAgICAgICAgICAgICAgICBzaWdtYSArPSBNYXRoLnBvdyhlbCAtIG1lYW4sIDIpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChlbCA9PT0gdHJ1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHNpZ21hICs9IE1hdGgucG93KDEgLSBtZWFuLCAyKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc2lnbWEgKz0gTWF0aC5wb3coMCAtIG1lYW4sIDIpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGlmIChlbCAhPT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvdW50Kys7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIHNpZ21hIC8gKGNvdW50IC0gMSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZXhwb3J0cy5WQVJQQSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgdmFyIHJhbmdlID0gdXRpbHMuZmxhdHRlbihhcmd1bWVudHMpO1xyXG4gICAgICAgICAgICB2YXIgbiA9IHJhbmdlLmxlbmd0aDtcclxuICAgICAgICAgICAgdmFyIHNpZ21hID0gMDtcclxuICAgICAgICAgICAgdmFyIGNvdW50ID0gMDtcclxuICAgICAgICAgICAgdmFyIG1lYW4gPSBleHBvcnRzLkFWRVJBR0VBKHJhbmdlKTtcclxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBuOyBpKyspIHtcclxuICAgICAgICAgICAgICAgIHZhciBlbCA9IHJhbmdlW2ldO1xyXG4gICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBlbCA9PT0gJ251bWJlcicpIHtcclxuICAgICAgICAgICAgICAgICAgICBzaWdtYSArPSBNYXRoLnBvdyhlbCAtIG1lYW4sIDIpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChlbCA9PT0gdHJ1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHNpZ21hICs9IE1hdGgucG93KDEgLSBtZWFuLCAyKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc2lnbWEgKz0gTWF0aC5wb3coMCAtIG1lYW4sIDIpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGlmIChlbCAhPT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvdW50Kys7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIHNpZ21hIC8gY291bnQ7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZXhwb3J0cy5XRUlCVUxMID0ge307XHJcblxyXG4gICAgICAgIGV4cG9ydHMuV0VJQlVMTC5ESVNUID0gZnVuY3Rpb24gKHgsIGFscGhhLCBiZXRhLCBjdW11bGF0aXZlKSB7XHJcbiAgICAgICAgICAgIHggPSB1dGlscy5wYXJzZU51bWJlcih4KTtcclxuICAgICAgICAgICAgYWxwaGEgPSB1dGlscy5wYXJzZU51bWJlcihhbHBoYSk7XHJcbiAgICAgICAgICAgIGJldGEgPSB1dGlscy5wYXJzZU51bWJlcihiZXRhKTtcclxuICAgICAgICAgICAgaWYgKHV0aWxzLmFueUlzRXJyb3IoeCwgYWxwaGEsIGJldGEpKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZXJyb3IudmFsdWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIChjdW11bGF0aXZlKSA/IDEgLSBNYXRoLmV4cCgtTWF0aC5wb3coeCAvIGJldGEsIGFscGhhKSkgOiBNYXRoLnBvdyh4LCBhbHBoYSAtIDEpICogTWF0aC5leHAoLU1hdGgucG93KHggLyBiZXRhLCBhbHBoYSkpICogYWxwaGEgLyBNYXRoLnBvdyhiZXRhLCBhbHBoYSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZXhwb3J0cy5aID0ge307XHJcblxyXG4gICAgICAgIGV4cG9ydHMuWi5URVNUID0gZnVuY3Rpb24gKHJhbmdlLCB4LCBzZCkge1xyXG4gICAgICAgICAgICByYW5nZSA9IHV0aWxzLnBhcnNlTnVtYmVyQXJyYXkodXRpbHMuZmxhdHRlbihyYW5nZSkpO1xyXG4gICAgICAgICAgICB4ID0gdXRpbHMucGFyc2VOdW1iZXIoeCk7XHJcbiAgICAgICAgICAgIGlmICh1dGlscy5hbnlJc0Vycm9yKHJhbmdlLCB4KSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGVycm9yLnZhbHVlO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBzZCA9IHNkIHx8IGV4cG9ydHMuU1RERVYuUyhyYW5nZSk7XHJcbiAgICAgICAgICAgIHZhciBuID0gcmFuZ2UubGVuZ3RoO1xyXG4gICAgICAgICAgICByZXR1cm4gMSAtIGV4cG9ydHMuTk9STS5TLkRJU1QoKGV4cG9ydHMuQVZFUkFHRShyYW5nZSkgLSB4KSAvIChzZCAvIE1hdGguc3FydChuKSksIHRydWUpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHJldHVybiBleHBvcnRzO1xyXG4gICAgfSkoKTtcclxuXHJcbiAgICBqZXhjZWwubWV0aG9kcy51dGlscyA9IChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdmFyIGV4cG9ydHMgPSB7fTtcclxuXHJcbiAgICAgICAgZXhwb3J0cy5QUk9HUkVTUyA9IGZ1bmN0aW9uIChwLCBjKSB7XHJcbiAgICAgICAgICAgIHZhciBjb2xvciA9IGMgPyBjIDogJ3JlZCc7XHJcbiAgICAgICAgICAgIHZhciB2YWx1ZSA9IHAgPyBwIDogJzAnO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuICc8ZGl2IHN0eWxlPVwid2lkdGg6JyArIHZhbHVlICsgJyU7aGVpZ2h0OjRweDtiYWNrZ3JvdW5kLWNvbG9yOicgKyBjb2xvciArICc7bWFyZ2luLXRvcDoxcHg7XCI+PC9kaXY+JztcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBleHBvcnRzLlJBVElORyA9IGZ1bmN0aW9uICh2KSB7XHJcbiAgICAgICAgICAgIHZhciBodG1sID0gJzxkaXYgY2xhc3M9XCJqcmF0aW5nXCI+JztcclxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCA1OyBpKyspIHtcclxuICAgICAgICAgICAgICAgIGlmIChpIDwgdikge1xyXG4gICAgICAgICAgICAgICAgICAgIGh0bWwgKz0gJzxkaXYgY2xhc3M9XCJqcmF0aW5nLXNlbGVjdGVkXCI+PC9kaXY+JztcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaHRtbCArPSAnPGRpdj48L2Rpdj4nO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGh0bWwgKz0gJzwvZGl2Pic7XHJcbiAgICAgICAgICAgIHJldHVybiBodG1sO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIGV4cG9ydHM7XHJcbiAgICB9KSgpO1xyXG5cclxuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgT2JqZWN0LmtleXMoamV4Y2VsLm1ldGhvZHMpLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgdmFyIG1ldGhvZHMgPSBqZXhjZWwubWV0aG9kc1tPYmplY3Qua2V5cyhqZXhjZWwubWV0aG9kcylbaV1dO1xyXG4gICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgT2JqZWN0LmtleXMobWV0aG9kcykubGVuZ3RoOyBqKyspIHtcclxuICAgICAgICAgICAgaWYgKHR5cGVvZiAobWV0aG9kc1tPYmplY3Qua2V5cyhtZXRob2RzKVtqXV0pID09ICdmdW5jdGlvbicpIHtcclxuICAgICAgICAgICAgICAgIHdpbmRvd1tPYmplY3Qua2V5cyhtZXRob2RzKVtqXV0gPSBtZXRob2RzW09iamVjdC5rZXlzKG1ldGhvZHMpW2pdXTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHdpbmRvd1tPYmplY3Qua2V5cyhtZXRob2RzKVtqXV0gPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIE9iamVjdC5rZXlzKG1ldGhvZHMpW2pdICsgJ05vdCBpbXBsZW1lbnRlZCc7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIGpleGNlbDtcclxufSkpKTsiLCIvLyBUaGUgbW9kdWxlIGNhY2hlXG52YXIgX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fID0ge307XG5cbi8vIFRoZSByZXF1aXJlIGZ1bmN0aW9uXG5mdW5jdGlvbiBfX3dlYnBhY2tfcmVxdWlyZV9fKG1vZHVsZUlkKSB7XG5cdC8vIENoZWNrIGlmIG1vZHVsZSBpcyBpbiBjYWNoZVxuXHR2YXIgY2FjaGVkTW9kdWxlID0gX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fW21vZHVsZUlkXTtcblx0aWYgKGNhY2hlZE1vZHVsZSAhPT0gdW5kZWZpbmVkKSB7XG5cdFx0cmV0dXJuIGNhY2hlZE1vZHVsZS5leHBvcnRzO1xuXHR9XG5cdC8vIENyZWF0ZSBhIG5ldyBtb2R1bGUgKGFuZCBwdXQgaXQgaW50byB0aGUgY2FjaGUpXG5cdHZhciBtb2R1bGUgPSBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX19bbW9kdWxlSWRdID0ge1xuXHRcdC8vIG5vIG1vZHVsZS5pZCBuZWVkZWRcblx0XHQvLyBubyBtb2R1bGUubG9hZGVkIG5lZWRlZFxuXHRcdGV4cG9ydHM6IHt9XG5cdH07XG5cblx0Ly8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uXG5cdF9fd2VicGFja19tb2R1bGVzX19bbW9kdWxlSWRdLmNhbGwobW9kdWxlLmV4cG9ydHMsIG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pO1xuXG5cdC8vIFJldHVybiB0aGUgZXhwb3J0cyBvZiB0aGUgbW9kdWxlXG5cdHJldHVybiBtb2R1bGUuZXhwb3J0cztcbn1cblxuIiwiLy8gc3RhcnR1cFxuLy8gTG9hZCBlbnRyeSBtb2R1bGUgYW5kIHJldHVybiBleHBvcnRzXG4vLyBUaGlzIGVudHJ5IG1vZHVsZSBpcyByZWZlcmVuY2VkIGJ5IG90aGVyIG1vZHVsZXMgc28gaXQgY2FuJ3QgYmUgaW5saW5lZFxudmFyIF9fd2VicGFja19leHBvcnRzX18gPSBfX3dlYnBhY2tfcmVxdWlyZV9fKFwiLi9zcmMvamV4Y2VsLmpzXCIpO1xuIl0sInNvdXJjZVJvb3QiOiIifQ==