!function(){"use strict";document.addEventListener("DOMContentLoaded",()=>{0!==document.getElementsByClassName("mdp-liker-box").length&&document.querySelectorAll(".mdp-liker-box").forEach(e=>new t(e))});class t{constructor(t){this.wpData=window.mdpLiker,this.host=window.location.hostname,this.id=t.id.replace("mdp-liker-",""),this.likerButtons=t.querySelectorAll(".mdp-liker-buttons button"),this.fNew=!0,this.canceled=!1,this.voted=!1,this.val_1=null,this.val_2=null,this.val_3=null,this.old_val_1=null,this.old_val_2=null,this.old_val_3=null,this.previousValue=[],this.sessionPostID=this.id,this.likerHover=!1,this.likerTouch=!1,this.previousActive=document.activeElement;const{displayBefore:e,results:i}=this.wpData;this.createLocalStorage(),this.likerData=JSON.parse(window.localStorage.getItem("mdpLikerData"))[this.host],this.flushExpiredLocalStorage(t),this.findOldVotes(t),this.addListeners(),"on"!==e&&this.fNew||this.getResults(),"show"===i&&this.displayResults(!this.fNew)}createLocalStorage(){const t=JSON.parse(window.localStorage.getItem("mdpLikerData"));let e={};null===t?(e[this.host]={guid:this.getGUID(),timestamp:Math.floor(Date.now()/1e3)},window.localStorage.setItem("mdpLikerData",JSON.stringify(e))):void 0!==t.guid&&void 0!==t.timestamp&&(e[this.host]=JSON.parse(window.localStorage.getItem("mdpLikerData")),window.localStorage.setItem("mdpLikerData",JSON.stringify(e)))}flushExpiredLocalStorage(){const{resetTimestamp:t}=this.wpData;if(void 0!==t&&this.likerData.timestamp<t){let t=JSON.parse(window.localStorage.getItem("mdpLikerData"));t[this.host]={guid:this.getGUID(),timestamp:Math.floor(Date.now()/1e3)},window.localStorage.setItem("mdpLikerData",JSON.stringify(t))}}updateLocalStorage(){this.val_1+this.val_2+this.val_3>0?(this.likerData["val_1_"+this.id]=this.val_1,this.likerData["val_2_"+this.id]=this.val_2,this.likerData["val_3_"+this.id]=this.val_3):(delete this.likerData["val_1_"+this.id],delete this.likerData["val_2_"+this.id],delete this.likerData["val_3_"+this.id]),this.likerData.timestamp=Math.floor(Date.now()/1e3);let t=JSON.parse(window.localStorage.getItem("mdpLikerData"));t[this.host]=this.likerData,window.localStorage.setItem("mdpLikerData",JSON.stringify(t))}getGUID(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){const e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)}))}findOldVotes(t){if("on"!==t.getAttribute("data-memory"))return;if(void 0===this.likerData["val_1_"+this.id])return;this.fNew=!1,this.previousValue[1]=this.likerData["val_1_"+this.id],this.previousValue[2]=this.likerData["val_2_"+this.id],this.previousValue[3]=this.likerData["val_3_"+this.id];let e={};this.previousValue.forEach((t,i)=>{t>0&&(e=document.querySelectorAll(`#mdp-liker-${this.id} #mdp-liker-btn-${i}`))}),e.forEach(t=>t.classList.add("mdp-active"))}addListeners(){for(let t=0;t<this.likerButtons.length;t++)this.likerButtons[t].removeEventListener("click",t=>{this.doLike(t)}),this.likerButtons[t].addEventListener("click",t=>{this.doLike(t)}),this.likerButtons[t].addEventListener("mouseenter",t=>{this.likerHover=t.target.id},{passive:!0}),this.likerButtons[t].addEventListener("mouseleave",()=>{this.likerHover=!1},{passive:!0}),this.likerButtons[t].addEventListener("touchstart",t=>{this.likerTouch=t.target.id},{passive:!0}),this.likerButtons[t].addEventListener("touchend",()=>{this.likerTouch=!1},{passive:!0});window.addEventListener("keypress",()=>{this.previousActive=document.activeElement},!1)}doLike(t){if(this.chitChecker(t))return;t.preventDefault(),this.pageDisable(),this.canceled=!1,0===this.old_val_1?(this.old_val_1=this.likerData["old_val_1_"+this.id],this.old_val_2=this.likerData["old_val_2_"+this.id],this.old_val_3=this.likerData["old_val_3_"+this.id]):(this.old_val_1=this.val_1,this.old_val_2=this.val_2,this.old_val_3=this.val_3);const e=this.catchVote(t.target);this.cancelLike();const i={liker_id:this.id,val_1:this.val_1,val_2:this.val_2,val_3:this.val_3,voteId:e,guid:this.likerData.guid,new_like:this.fNew};this.request(i)}chitChecker(t){const e=t.target.id===this.likerHover,i=t.target.id===this.likerTouch,s=t.target.id===this.previousActive.id;return!e&&!s&&!i}pageDisable(){document.querySelectorAll(".mdp-liker-msg").length>2&&(document.body.style.filter=`blur( ${document.querySelectorAll(".mdp-liker-msg").length-2}px )`,document.body.addEventListener("click",(function(t){t.target.id.includes("mdp-liker-btn-")||(document.body.style.filter="unset")})))}catchVote(t){t=t.closest("button"),this.val_1=0,this.val_2=0,this.val_3=0;let e=0;return"mdp-liker-btn-1"===t.id?(this.val_1=1,e=1):"mdp-liker-btn-2"===t.id?(this.val_2=1,e=2):"mdp-liker-btn-3"===t.id&&(this.val_3=1,e=3),e}cancelLike(){null!==this.old_val_1&&null!==this.val_1&&(1===this.old_val_1&&1===this.val_1&&(this.old_val_1=0,this.val_1=0,this.canceled=!0),1===this.old_val_2&&1===this.val_2&&(this.old_val_2=0,this.val_2=0,this.canceled=!0),1===this.old_val_3&&1===this.val_3&&(this.old_val_3=0,this.val_3=0,this.canceled=!0)),null===this.old_val_1&&null!==this.val_1&&(1===this.likerData["val_1_"+this.id]&&1===this.val_1&&(this.old_val_1=0,this.val_1=0,this.canceled=!0),1===this.likerData["val_2_"+this.id]&&1===this.val_2&&(this.old_val_2=0,this.val_2=0,this.canceled=!0),1===this.likerData["val_3_"+this.id]&&1===this.val_3&&(this.old_val_3=0,this.val_3=0,this.canceled=!0))}getResults(){const{url:t,nonceGetLike:e}=this.wpData,i=new XMLHttpRequest;i.open("POST",`${t}?nonce=${e}&action=get_like`,!0),i.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),i.onload=()=>{if(i.status){if(200!==i.status)console.error("Get likes error! Returned status of "+i.status);else if(200===i.status){const{status:t,liker:e}=JSON.parse(i.response);t&&this.updateResults(e)}}else console.error("Get likes failed! See below:"),console.error(data)},i.send(encodeURI("liker_id="+this.id))}updateResults(t){if("undefined"===t.positive)return;let e=[],i=[];i[1]=t.positive,i[2]=t.neutral,i[3]=t.negative;for(let t=1;t<=i.length;t++)null!==document.querySelector(`#mdp-liker-${this.id} .mdp-liker-buttons span.val-${t}`)&&(e[t]=document.querySelector(`#mdp-liker-${this.id} .mdp-liker-buttons span.val-${t}`),e[t].innerHTML=i[t]);"show"===this.wpData.results&&this.displayResults(this.voted||!this.fNew),this.previousValue=i}displayResults(t){if(t)for(let t=0;t<this.likerButtons.length;t++)this.likerButtons[t].querySelector("span").classList.add("mdp-liker-result")}request(t){const{liker_id:e,val_1:i,val_2:s,val_3:l,voteId:a,guid:o,new_like:r}=t,{url:d,nonceProcessLike:h}=this.wpData;let n=window.sessionStorage.getItem("likerSession"),u=null===n?0:1;this.sessionPostID=e,null!==n&&parseInt(n)!==parseInt(e)&&(this.sessionPostID=e,u=0),window.sessionStorage.setItem("likerSession",this.sessionPostID),this.buttonsDisable(!0);const c=new XMLHttpRequest;c.open("POST",`${d}?nonce=${h}&action=process_like`,!0),c.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),c.onload=()=>{if(c.status){if(200!==c.status)console.error("Request error! Returned status of "+c.status);else if(200===c.status){const{liker:t,callback:e}=JSON.parse(c.response);this.voted=!0,e.status?(this.updateResults(t),this.buttonsDisable(!1),this.activateButton(document.querySelector(`#mdp-liker-${this.id} #mdp-liker-btn-${a}`)),this.updateLocalStorage()):(this.showMessage(e.message),this.hideMessage(),this.buttonsDisable(!1)),this.fNew=!1}}else console.error("Request failed! See below:"),console.error(t)},c.send(encodeURI(`liker_id=${e}&val_1=${i}&val_2=${s}&val_3=${l}&guid=${o}&new_like=${r}&session=${u}`))}buttonsDisable(t){for(let e=0;e<this.likerButtons.length;e++)this.likerButtons[e].disabled=t}activateButton(t){this.deActivateButtons(),this.canceled||t.classList.add("mdp-active")}deActivateButtons(){for(let t=0;t<this.likerButtons.length;t++)this.likerButtons[t].classList.remove("mdp-active")}showMessage(t){for(let e of document.querySelectorAll(`#mdp-liker-${this.id} .mdp-liker-buttons`)){const i=document.createElement("p");i.classList.add("mdp-liker-msg"),i.innerHTML=t,e.appendChild(i)}}hideMessage(){for(let t of document.querySelectorAll(`#mdp-liker-${this.id} .mdp-liker-msg`))t.classList.add("mdp-liker-fade"),setTimeout(()=>{t.remove()},3001)}}}();